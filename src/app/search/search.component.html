<div class="search-container">
    <!-- Search Header -->
    <div class="search-header">
        <div class="header-top">
            <button class="close-glass-btn" (click)="goBack()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <div class="location-context" (click)="openLocationModal()">
                <svg class="location-pin" width="16" height="16" viewBox="0 0 24 24" fill="none">
                    <path
                        d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"
                        fill="currentColor" />
                </svg>
                <span class="location-text">{{locationName}}</span>
                <svg class="chevron-down" width="12" height="12" viewBox="0 0 24 24" fill="none">
                    <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
            </div>
        </div>

        <div class="search-bar">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                class="search-icon">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" placeholder="Search dosa, vada pav, biryani..." [(ngModel)]="searchQuery"
                (ngModelChange)="applyFilters()">
        </div>
    </div>

    <!-- Location Selector Modal -->
    <div class="modal-overlay" *ngIf="showLocationModal" (click)="closeLocationModal()">
        <div class="location-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>Select Location</h2>
                <button class="close-btn" (click)="closeLocationModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </button>
            </div>

            <div class="modal-search-box">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2" />
                    <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
                <input type="text" [(ngModel)]="locationSearchQuery" placeholder="Search for a location..."
                    class="search-input" />
            </div>

            <div class="locations-list">
                <div class="location-item" *ngFor="let loc of filteredLocations" (click)="selectLocation(loc)">
                    <div class="location-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path
                                d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"
                                fill="currentColor" />
                        </svg>
                    </div>
                    <div class="location-info">
                        <div class="location-name">{{loc.name}}</div>
                        <div class="location-area">Pincode: {{loc.pincode}}</div>
                    </div>
                    <svg class="chevron-right" width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </div>

                <div class="no-results" *ngIf="filteredLocations.length === 0">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                        <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2" />
                        <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                    <p>No locations found</p>
                    <span>Try searching for a different area</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters Section -->
    <!-- Compact Filters -->
    <div class="filters-compact" *ngIf="hasSearchMatches">
        <div class="filter-row">
            <!-- Sort Options -->
            <button *ngFor="let sort of sortOptions" class="chip" [class.active]="selectedSort === sort"
                (click)="selectSort(sort)">
                <span *ngIf="selectedSort === sort" class="check">✓</span>
                {{sort}}
            </button>

            <div class="vertical-divider"></div>

            <!-- Distance Options -->
            <button *ngFor="let dist of distances" class="chip" [class.active]="selectedDistance === dist"
                (click)="selectDistance(dist)">
                {{dist.label}}
            </button>
        </div>

        <div class="filter-row">
            <!-- Price Options -->
            <button *ngFor="let range of priceRanges" class="chip" [class.active]="selectedPriceRange === range"
                (click)="selectPrice(range)">
                {{range.label}}
            </button>
        </div>
    </div>

    <!-- Results Grid -->
    <div class="results-grid">
        <div class="loading-spinner" *ngIf="isLoading">
            <div class="spinner"></div>
        </div>

        <div class="empty-state" *ngIf="!isLoading && filteredReels.length === 0">
            <div *ngIf="reels.length === 0; else noResults">
                <p>Search for your favorite food or browse categories!</p>
            </div>
            <ng-template #noResults>
                <p>No tasty bites found matching your search.</p>
            </ng-template>
        </div>

        <div class="food-card" *ngFor="let reel of filteredReels" (click)="openReel(reel)">
            <div class="card-image">
                <video [src]="reel.videoUrl" muted playsinline preload="metadata" #videoThumb
                    [style.opacity]="loadedThumbs.has(reel.id!) ? 1 : 0" (loadeddata)="onThumbLoad(reel.id!)"
                    (loadedmetadata)="videoThumb.currentTime=0.1"></video>
                <!-- <img [src]="reel.thumbnailUrl" alt="Food"> -->
                <div class="distance-badge">{{reel.distanceStr}}</div>
            </div>
            <div class="card-details">
                <div class="header-row">
                    <h3 class="dish-name">{{reel.title}}</h3>
                    <!-- <span class="rating">
                        {{reel.rating}} <span class="star">★</span>
                    </span> -->
                </div>
                <p class="vendor-name">{{reel.vendor}}</p>
                <div class="price-row">
                    <span class="price">₹{{reel.price}}</span>
                    <!-- <span class="offer">20% OFF</span> -->
                </div>
            </div>
        </div>
    </div>
</div>