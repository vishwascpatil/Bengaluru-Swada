<div class="video-card" [class.active]="active" [class.prev]="relativeIndex < 0" [class.next]="relativeIndex > 0">
  <video #videoEl class="video-player" loop [muted]="!active || isMuted" playsinline webkit-playsinline
    [preload]="priority === 'high' ? 'auto' : 'none'" x-webkit-airplay="allow" disablePictureInPicture
    [poster]="displayPoster" [src]="displaySrc" (click)="onVideoTap($event)" (touchend)="onVideoTap($event)">
  </video>

  <!-- Loading Spinner Removed for simplicity -->
  <div class="loading-spinner" *ngIf="isLoading && showRetry">
    <button class="retry-btn" *ngIf="showRetry" (click)="retryLoad($event)">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M23 4v6h-6M1 20v-6h6" />
        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 1 20.49 15" />
      </svg>
      <span>Retry</span>
    </button>
  </div>

  <!-- Double-tap Like Animation -->
  <div class="like-animation" *ngIf="showLikeAnimation">
    <svg width="100" height="100" viewBox="0 0 24 24" fill="white">
      <path
        d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
    </svg>
  </div>

  <!-- Mute/Unmute Animation -->
  <div class="mute-animation" *ngIf="showMuteIcon">
    <div class="mute-icon-bg">
      <svg *ngIf="isMuted" width="40" height="40" viewBox="0 0 24 24" fill="white">
        <path
          d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z" />
      </svg>
      <svg *ngIf="!isMuted" width="40" height="40" viewBox="0 0 24 24" fill="white">
        <path
          d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" />
      </svg>
    </div>
  </div>

  <div class="video-overlay">
    <div class="video-info">
      <div class="food-details">
        <div class="title-category-row">
          <h3 class="dish-name">{{displayTitle}}</h3>
          <span class="category-badge">{{reel?.category}}</span>
        </div>
        <p class="vendor-name">{{displayVendor}}</p>
        <div class="price-distance">
          <span class="price">â‚¹{{displayPrice}}</span>
          <span class="distance">{{displayDistance}} away</span>
        </div>
      </div>
    </div>

    <div class="action-buttons">
      <!-- View Count -->
      <div class="view-count-action" *ngIf="displayViewCount > 0">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" />
          <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" />
        </svg>
        <span class="count-text">{{ formatViewCount(displayViewCount) }}</span>
      </div>
      <button class="action-btn like-btn" [class.liked]="displayIsLiked" (click)="toggleLike()">
        <svg class="action-icon" width="28" height="28" viewBox="0 0 24 24"
          [attr.fill]="displayIsLiked ? 'currentColor' : 'none'">
          <path
            d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        <span class="like-count" *ngIf="displayLikes > 0">{{ displayLikes }}</span>
      </button>

      <button class="action-btn bookmark-btn" [class.bookmarked]="displayIsBookmarked" (click)="bookmark()">
        <svg class="action-icon" width="28" height="28" viewBox="0 0 24 24"
          [attr.fill]="displayIsBookmarked ? 'currentColor' : 'none'">
          <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </button>

      <button class="action-btn map-btn" (click)="openGoogleMaps()">
        <svg class="action-icon navigate-icon" width="28" height="28" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="3 11 22 2 13 21 11 13 3 11"></polygon>
        </svg>
      </button>

      <!-- Delete Button (Owner Only) -->
      <button class="action-btn delete-btn" *ngIf="canDelete" (click)="onDelete($event)">
        <svg class="action-icon" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#ff4444"
          stroke-width="2">
          <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          <line x1="10" y1="11" x2="10" y2="17"></line>
          <line x1="14" y1="11" x2="14" y2="17"></line>
        </svg>
      </button>
    </div>
  </div>

  <!-- Video Progress Bar -->
  <div class="progress-container" [class.visible]="isProgressBarVisible" (click)="onProgressBarClick($event)"
    (touchstart)="onProgressBarTouchStart($event)" (touchmove)="onProgressBarTouchMove($event)"
    (touchend)="onProgressBarTouchEnd()" (mouseenter)="isProgressBarVisible = true"
    (mouseleave)="isProgressBarVisible = false">
    <div class="progress-bar" [style.width.%]="progress"></div>
  </div>
</div>