<div class="upload-container">
    <div class="upload-header">

        <h1>Upload Reel</h1>
        <div class="spacer"></div>
    </div>

    <div class="upload-content">
        <!-- Video Preview Section -->
        <div class="video-preview-section">
            <div class="video-preview selected" *ngIf="selectedFile; else fileSelector">
                <div class="file-info-header">
                    <div class="file-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                            <path d="M15 10L19 14L15 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"
                                stroke="currentColor" stroke-width="2" />
                        </svg>
                    </div>
                    <div class="file-details">
                        <p class="file-name">{{selectedFile.name}}</p>
                        <p class="file-size">{{(selectedFile.size / (1024 * 1024)).toFixed(2)}} MB</p>
                    </div>
                    <button class="remove-video-btn" (click)="removeFile()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                    </button>
                </div>

                <div class="ready-progress">
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" style="width: 100%"></div>
                    </div>
                    <p class="progress-status">Ready to Upload</p>
                </div>
            </div>

            <ng-template #fileSelector>
                <label class="file-selector">
                    <input type="file" accept="video/mp4,video/quicktime,video/webm" (change)="onFileSelected($event)"
                        hidden>
                    <div class="file-selector-content">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"
                                stroke="currentColor" stroke-width="2" />
                            <circle cx="12" cy="13" r="4" stroke="currentColor" stroke-width="2" />
                        </svg>
                        <p class="selector-title">Select Video</p>
                        <p class="selector-subtitle">MP4, MOV, or WebM (max 100MB)</p>
                    </div>
                </label>
            </ng-template>
        </div>

        <!-- Form Section -->
        <div class="form-section">
            <div class="form-group">
                <label for="title">Dish Name *</label>
                <input type="text" id="title" [(ngModel)]="title" (input)="autoCategorize()"
                    placeholder="e.g., Masala Dosa" [disabled]="isUploading">
            </div>

            <div class="form-group">
                <label for="category">Category *</label>
                <input type="text" id="category" [(ngModel)]="category" placeholder="e.g., South Indian"
                    [disabled]="isUploading">
                <small class="helper-text">Auto-detected based on dish name</small>
            </div>

            <div class="form-group">
                <label for="vendor">Vendor Name *</label>
                <input type="text" id="vendor" [(ngModel)]="vendor" placeholder="e.g., Vidyarthi Bhavan"
                    [disabled]="isUploading">
            </div>

            <div class="form-group">
                <label for="price">Price (â‚¹) *</label>
                <input type="number" id="price" [(ngModel)]="price" placeholder="50" min="0" [disabled]="isUploading">
            </div>

            <div class="form-group location-group">
                <label>Store Location *</label>
                <div class="location-actions">
                    <button type="button" class="location-card" (click)="getCurrentLocation()" [disabled]="isUploading">
                        <div class="card-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <circle cx="12" cy="9" r="2.5" fill="currentColor" />
                            </svg>
                        </div>
                        <div class="card-content">
                            <span class="card-title">Current Location</span>
                            <span class="card-subtitle">Use GPS coordinates</span>
                        </div>
                    </button>

                    <button type="button" class="location-card map-card" (click)="openLocationPicker()"
                        [disabled]="isUploading">
                        <div class="card-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M3 11V21H21V11M3 11L12 3L21 11M3 11H21" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                                <circle cx="12" cy="14" r="3" stroke="currentColor" stroke-width="2" />
                            </svg>
                        </div>
                        <div class="card-content">
                            <span class="card-title">Pick on Map</span>
                            <span class="card-subtitle">Select manually</span>
                        </div>
                    </button>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="latitude">Latitude *</label>
                    <input type="number" id="latitude" [(ngModel)]="latitude" placeholder="12.9352" step="0.0001"
                        [disabled]="isUploading">
                </div>

                <div class="form-group">
                    <label for="longitude">Longitude *</label>
                    <input type="number" id="longitude" [(ngModel)]="longitude" placeholder="77.6245" step="0.0001"
                        [disabled]="isUploading">
                </div>
            </div>

            <!-- Error Message -->
            <div class="error-message" *ngIf="uploadError">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                    <path d="M12 8v4M12 16h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
                {{ uploadError }}
            </div>

            <!-- Success Message -->
            <div class="success-message" *ngIf="uploadSuccess">
                <div class="success-info">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" />
                        <path d="M22 4L12 14.01l-3-3" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                    <span>Upload successful! Redirecting...</span>
                </div>
                <button class="done-btn-fallback" (click)="cancel()">Done</button>
            </div>

            <!-- Upload Progress -->
            <div class="upload-progress" *ngIf="isUploading">
                <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="uploadProgress"></div>
                </div>
                <p class="progress-text">Uploading... {{ uploadProgress }}%</p>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <!-- <button class="cancel-btn" (click)="cancel()" [disabled]="isUploading">
                    Cancel
                </button> -->
                <button class="upload-btn" (click)="uploadReel()" [disabled]="!isFormValid() || isUploading">
                    <span *ngIf="!isUploading">Upload Reel</span>
                    <span *ngIf="isUploading">Uploading...</span>
                </button>
            </div>
        </div>
    </div>

    <app-location-picker *ngIf="showLocationPicker" (locationSelected)="onLocationSelected($event)"
        (cancel)="closeLocationPicker()">
    </app-location-picker>
</div>