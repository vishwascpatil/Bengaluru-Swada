<div class="ios-upload-layout">

    <!-- Header -->
    <div class="upload-header">
        <div class="header-left">
            <!-- Optional Back Button -->
        </div>
        <h1 class="page-title">New Reel</h1>
        <div class="header-right">
            <!-- Optional Action -->
        </div>
    </div>

    <div class="scroll-content">

        <!-- Video Preview / Selector Hero -->
        <div class="video-hero-section">
            <div class="video-preview-card" *ngIf="selectedFile; else emptyState">
                <div class="file-icon-badge">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <polygon points="23 7 16 12 23 17 23 7"></polygon>
                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                    </svg>
                </div>
                <div class="file-info">
                    <p class="filename">{{selectedFile.name}}</p>
                    <p class="filesize">{{(selectedFile.size / (1024 * 1024)).toFixed(1)}} MB</p>
                </div>
                <button class="remove-btn" (click)="removeFile()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <ng-template #emptyState>
                <label class="upload-placeholder">
                    <input type="file" accept="video/mp4,video/quicktime,video/webm" (change)="onFileSelected($event)"
                        hidden>
                    <div class="icon-circle">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#10B981" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                    </div>
                    <span class="upload-label">Select Video for Reel</span>
                    <span class="upload-sub">MP4, MOV (Max 100MB)</span>
                </label>
            </ng-template>
        </div>

        <!-- Form Fields -->
        <div class="form-wrapper">

            <!-- Dish Name -->
            <div class="input-group">
                <label>Dish Name</label>
                <input type="text" [(ngModel)]="title" placeholder="e.g. Masala Dosa" [disabled]="isUploading">
            </div>

            <!-- Categories -->
            <div class="input-group">
                <label>Categories</label>
                <div class="tags-row">
                    <div class="tag-pill" *ngFor="let cat of categories; let i = index">
                        {{cat}}
                        <span class="remove-x" (click)="removeTag(i)">×</span>
                    </div>
                </div>
                <input type="text" [(ngModel)]="tagInput" (input)="handleTagInput()"
                    placeholder="Add category (e.g. Spicy)..." [disabled]="isUploading" class="secondary-input">
            </div>

            <!-- Vendor -->
            <div class="input-group">
                <label>Vendor Name</label>
                <input type="text" [(ngModel)]="vendor" placeholder="e.g. CTR" [disabled]="isUploading">
            </div>

            <!-- Price -->
            <div class="input-group">
                <label>Price (₹)</label>
                <input type="number" [(ngModel)]="price" placeholder="0" [disabled]="isUploading">
            </div>

            <!-- Location -->
            <div class="input-group">
                <label>Store Location</label>
                <div class="location-grid">
                    <div class="location-tile" (click)="getCurrentLocation()" [class.disabled]="isUploading">
                        <div class="tile-icon orange">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" />
                                <circle cx="12" cy="9" r="2.5" />
                            </svg>
                        </div>
                        <span>Current Location</span>
                    </div>

                    <div class="location-tile" (click)="openLocationPicker()" [class.disabled]="isUploading">
                        <div class="tile-icon blue">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
                                <line x1="8" y1="2" x2="8" y2="18"></line>
                                <line x1="16" y1="6" x2="16" y2="22"></line>
                            </svg>
                        </div>
                        <span>Pick on Map</span>
                    </div>
                </div>

                <!-- Lat/Lng Readonly -->
                <div class="coords-row" *ngIf="latitude || longitude">
                    <div class="coord-pill">{{latitude || 0}}</div>
                    <div class="coord-pill">{{longitude || 0}}</div>
                </div>
            </div>

        </div>

        <!-- Padding for bottom bar -->
        <div style="height: 200px;"></div>

    </div>

    <!-- Bottom Submit Bar -->
    <div class="submit-bar">

        <!-- Status Messages -->
        <div class="status-toast error" *ngIf="uploadError">{{uploadError}}</div>
        <div class="status-toast success" *ngIf="uploadSuccess">Upload Successful!</div>

        <!-- Progress -->
        <div class="progress-area" *ngIf="isUploading || isTranscoding">
            <div class="progress-track">
                <div class="progress-bar" [style.width.%]="isTranscoding ? transcodeProgress : uploadProgress"></div>
            </div>
            <span class="progress-label">{{isTranscoding ? 'Optimizing Video...' : 'Uploading...'}}</span>
        </div>

        <button class="primary-btn" (click)="uploadReel()" [disabled]="!isFormValid() || isUploading">
            {{ isUploading ? 'Processing...' : 'Upload Reel' }}
        </button>
    </div>

    <app-location-picker *ngIf="showLocationPicker" (locationSelected)="onLocationSelected($event)"
        (cancel)="closeLocationPicker()">
    </app-location-picker>

</div>