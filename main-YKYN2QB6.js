import{a as de,b as qe,c as pE,d as o3,e as a3,f as pa,g as U,h as F1}from"./chunk-SMQ6CQ3U.js";var P$=o3((eE,D$)=>{"use strict";(function(n,e){typeof eE=="object"&&typeof D$<"u"?e(eE):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.leaflet={}))})(eE,function(n){"use strict";var e="1.9.4";function t(c){var h,g,_,b;for(g=1,_=arguments.length;g<_;g++){b=arguments[g];for(h in b)c[h]=b[h]}return c}var i=Object.create||function(){function c(){}return function(h){return c.prototype=h,new c}}();function r(c,h){var g=Array.prototype.slice;if(c.bind)return c.bind.apply(c,g.call(arguments,1));var _=g.call(arguments,2);return function(){return c.apply(h,_.length?_.concat(g.call(arguments)):arguments)}}var s=0;function o(c){return"_leaflet_id"in c||(c._leaflet_id=++s),c._leaflet_id}function a(c,h,g){var _,b,k,z;return z=function(){_=!1,b&&(k.apply(g,b),b=!1)},k=function(){_?b=arguments:(c.apply(g,arguments),setTimeout(z,h),_=!0)},k}function l(c,h,g){var _=h[1],b=h[0],k=_-b;return c===_&&g?c:((c-b)%k+k)%k+b}function u(){return!1}function d(c,h){if(h===!1)return c;var g=Math.pow(10,h===void 0?6:h);return Math.round(c*g)/g}function f(c){return c.trim?c.trim():c.replace(/^\s+|\s+$/g,"")}function m(c){return f(c).split(/\s+/)}function y(c,h){Object.prototype.hasOwnProperty.call(c,"options")||(c.options=c.options?i(c.options):{});for(var g in h)c.options[g]=h[g];return c.options}function v(c,h,g){var _=[];for(var b in c)_.push(encodeURIComponent(g?b.toUpperCase():b)+"="+encodeURIComponent(c[b]));return(!h||h.indexOf("?")===-1?"?":"&")+_.join("&")}var E=/\{ *([\w_ -]+) *\}/g;function T(c,h){return c.replace(E,function(g,_){var b=h[_];if(b===void 0)throw new Error("No value provided for variable "+g);return typeof b=="function"&&(b=b(h)),b})}var C=Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"};function D(c,h){for(var g=0;g<c.length;g++)if(c[g]===h)return g;return-1}var P="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function V(c){return window["webkit"+c]||window["moz"+c]||window["ms"+c]}var G=0;function H(c){var h=+new Date,g=Math.max(0,16-(h-G));return G=h+g,window.setTimeout(c,g)}var A=window.requestAnimationFrame||V("RequestAnimationFrame")||H,x=window.cancelAnimationFrame||V("CancelAnimationFrame")||V("CancelRequestAnimationFrame")||function(c){window.clearTimeout(c)};function R(c,h,g){if(g&&A===H)c.call(h);else return A.call(window,r(c,h))}function M(c){c&&x.call(window,c)}var F={__proto__:null,extend:t,create:i,bind:r,get lastId(){return s},stamp:o,throttle:a,wrapNum:l,falseFn:u,formatNum:d,trim:f,splitWords:m,setOptions:y,getParamString:v,template:T,isArray:C,indexOf:D,emptyImageUrl:P,requestFn:A,cancelFn:x,requestAnimFrame:R,cancelAnimFrame:M};function j(){}j.extend=function(c){var h=function(){y(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},g=h.__super__=this.prototype,_=i(g);_.constructor=h,h.prototype=_;for(var b in this)Object.prototype.hasOwnProperty.call(this,b)&&b!=="prototype"&&b!=="__super__"&&(h[b]=this[b]);return c.statics&&t(h,c.statics),c.includes&&(B(c.includes),t.apply(null,[_].concat(c.includes))),t(_,c),delete _.statics,delete _.includes,_.options&&(_.options=g.options?i(g.options):{},t(_.options,c.options)),_._initHooks=[],_.callInitHooks=function(){if(!this._initHooksCalled){g.callInitHooks&&g.callInitHooks.call(this),this._initHooksCalled=!0;for(var k=0,z=_._initHooks.length;k<z;k++)_._initHooks[k].call(this)}},h},j.include=function(c){var h=this.prototype.options;return t(this.prototype,c),c.options&&(this.prototype.options=h,this.mergeOptions(c.options)),this},j.mergeOptions=function(c){return t(this.prototype.options,c),this},j.addInitHook=function(c){var h=Array.prototype.slice.call(arguments,1),g=typeof c=="function"?c:function(){this[c].apply(this,h)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(g),this};function B(c){if(!(typeof L>"u"||!L||!L.Mixin)){c=C(c)?c:[c];for(var h=0;h<c.length;h++)c[h]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var ge={on:function(c,h,g){if(typeof c=="object")for(var _ in c)this._on(_,c[_],h);else{c=m(c);for(var b=0,k=c.length;b<k;b++)this._on(c[b],h,g)}return this},off:function(c,h,g){if(!arguments.length)delete this._events;else if(typeof c=="object")for(var _ in c)this._off(_,c[_],h);else{c=m(c);for(var b=arguments.length===1,k=0,z=c.length;k<z;k++)b?this._off(c[k]):this._off(c[k],h,g)}return this},_on:function(c,h,g,_){if(typeof h!="function"){console.warn("wrong listener type: "+typeof h);return}if(this._listens(c,h,g)===!1){g===this&&(g=void 0);var b={fn:h,ctx:g};_&&(b.once=!0),this._events=this._events||{},this._events[c]=this._events[c]||[],this._events[c].push(b)}},_off:function(c,h,g){var _,b,k;if(this._events&&(_=this._events[c],!!_)){if(arguments.length===1){if(this._firingCount)for(b=0,k=_.length;b<k;b++)_[b].fn=u;delete this._events[c];return}if(typeof h!="function"){console.warn("wrong listener type: "+typeof h);return}var z=this._listens(c,h,g);if(z!==!1){var Z=_[z];this._firingCount&&(Z.fn=u,this._events[c]=_=_.slice()),_.splice(z,1)}}},fire:function(c,h,g){if(!this.listens(c,g))return this;var _=t({},h,{type:c,target:this,sourceTarget:h&&h.sourceTarget||this});if(this._events){var b=this._events[c];if(b){this._firingCount=this._firingCount+1||1;for(var k=0,z=b.length;k<z;k++){var Z=b[k],X=Z.fn;Z.once&&this.off(c,X,Z.ctx),X.call(Z.ctx||this,_)}this._firingCount--}}return g&&this._propagateEvent(_),this},listens:function(c,h,g,_){typeof c!="string"&&console.warn('"string" type argument expected');var b=h;typeof h!="function"&&(_=!!h,b=void 0,g=void 0);var k=this._events&&this._events[c];if(k&&k.length&&this._listens(c,b,g)!==!1)return!0;if(_){for(var z in this._eventParents)if(this._eventParents[z].listens(c,h,g,_))return!0}return!1},_listens:function(c,h,g){if(!this._events)return!1;var _=this._events[c]||[];if(!h)return!!_.length;g===this&&(g=void 0);for(var b=0,k=_.length;b<k;b++)if(_[b].fn===h&&_[b].ctx===g)return b;return!1},once:function(c,h,g){if(typeof c=="object")for(var _ in c)this._on(_,c[_],h,!0);else{c=m(c);for(var b=0,k=c.length;b<k;b++)this._on(c[b],h,g,!0)}return this},addEventParent:function(c){return this._eventParents=this._eventParents||{},this._eventParents[o(c)]=c,this},removeEventParent:function(c){return this._eventParents&&delete this._eventParents[o(c)],this},_propagateEvent:function(c){for(var h in this._eventParents)this._eventParents[h].fire(c.type,t({layer:c.target,propagatedFrom:c.target},c),!0)}};ge.addEventListener=ge.on,ge.removeEventListener=ge.clearAllEventListeners=ge.off,ge.addOneTimeEventListener=ge.once,ge.fireEvent=ge.fire,ge.hasEventListeners=ge.listens;var we=j.extend(ge);function q(c,h,g){this.x=g?Math.round(c):c,this.y=g?Math.round(h):h}var te=Math.trunc||function(c){return c>0?Math.floor(c):Math.ceil(c)};q.prototype={clone:function(){return new q(this.x,this.y)},add:function(c){return this.clone()._add(K(c))},_add:function(c){return this.x+=c.x,this.y+=c.y,this},subtract:function(c){return this.clone()._subtract(K(c))},_subtract:function(c){return this.x-=c.x,this.y-=c.y,this},divideBy:function(c){return this.clone()._divideBy(c)},_divideBy:function(c){return this.x/=c,this.y/=c,this},multiplyBy:function(c){return this.clone()._multiplyBy(c)},_multiplyBy:function(c){return this.x*=c,this.y*=c,this},scaleBy:function(c){return new q(this.x*c.x,this.y*c.y)},unscaleBy:function(c){return new q(this.x/c.x,this.y/c.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=te(this.x),this.y=te(this.y),this},distanceTo:function(c){c=K(c);var h=c.x-this.x,g=c.y-this.y;return Math.sqrt(h*h+g*g)},equals:function(c){return c=K(c),c.x===this.x&&c.y===this.y},contains:function(c){return c=K(c),Math.abs(c.x)<=Math.abs(this.x)&&Math.abs(c.y)<=Math.abs(this.y)},toString:function(){return"Point("+d(this.x)+", "+d(this.y)+")"}};function K(c,h,g){return c instanceof q?c:C(c)?new q(c[0],c[1]):c==null?c:typeof c=="object"&&"x"in c&&"y"in c?new q(c.x,c.y):new q(c,h,g)}function ne(c,h){if(c)for(var g=h?[c,h]:c,_=0,b=g.length;_<b;_++)this.extend(g[_])}ne.prototype={extend:function(c){var h,g;if(!c)return this;if(c instanceof q||typeof c[0]=="number"||"x"in c)h=g=K(c);else if(c=Ee(c),h=c.min,g=c.max,!h||!g)return this;return!this.min&&!this.max?(this.min=h.clone(),this.max=g.clone()):(this.min.x=Math.min(h.x,this.min.x),this.max.x=Math.max(g.x,this.max.x),this.min.y=Math.min(h.y,this.min.y),this.max.y=Math.max(g.y,this.max.y)),this},getCenter:function(c){return K((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,c)},getBottomLeft:function(){return K(this.min.x,this.max.y)},getTopRight:function(){return K(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(c){var h,g;return typeof c[0]=="number"||c instanceof q?c=K(c):c=Ee(c),c instanceof ne?(h=c.min,g=c.max):h=g=c,h.x>=this.min.x&&g.x<=this.max.x&&h.y>=this.min.y&&g.y<=this.max.y},intersects:function(c){c=Ee(c);var h=this.min,g=this.max,_=c.min,b=c.max,k=b.x>=h.x&&_.x<=g.x,z=b.y>=h.y&&_.y<=g.y;return k&&z},overlaps:function(c){c=Ee(c);var h=this.min,g=this.max,_=c.min,b=c.max,k=b.x>h.x&&_.x<g.x,z=b.y>h.y&&_.y<g.y;return k&&z},isValid:function(){return!!(this.min&&this.max)},pad:function(c){var h=this.min,g=this.max,_=Math.abs(h.x-g.x)*c,b=Math.abs(h.y-g.y)*c;return Ee(K(h.x-_,h.y-b),K(g.x+_,g.y+b))},equals:function(c){return c?(c=Ee(c),this.min.equals(c.getTopLeft())&&this.max.equals(c.getBottomRight())):!1}};function Ee(c,h){return!c||c instanceof ne?c:new ne(c,h)}function oe(c,h){if(c)for(var g=h?[c,h]:c,_=0,b=g.length;_<b;_++)this.extend(g[_])}oe.prototype={extend:function(c){var h=this._southWest,g=this._northEast,_,b;if(c instanceof fe)_=c,b=c;else if(c instanceof oe){if(_=c._southWest,b=c._northEast,!_||!b)return this}else return c?this.extend(me(c)||ie(c)):this;return!h&&!g?(this._southWest=new fe(_.lat,_.lng),this._northEast=new fe(b.lat,b.lng)):(h.lat=Math.min(_.lat,h.lat),h.lng=Math.min(_.lng,h.lng),g.lat=Math.max(b.lat,g.lat),g.lng=Math.max(b.lng,g.lng)),this},pad:function(c){var h=this._southWest,g=this._northEast,_=Math.abs(h.lat-g.lat)*c,b=Math.abs(h.lng-g.lng)*c;return new oe(new fe(h.lat-_,h.lng-b),new fe(g.lat+_,g.lng+b))},getCenter:function(){return new fe((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new fe(this.getNorth(),this.getWest())},getSouthEast:function(){return new fe(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(c){typeof c[0]=="number"||c instanceof fe||"lat"in c?c=me(c):c=ie(c);var h=this._southWest,g=this._northEast,_,b;return c instanceof oe?(_=c.getSouthWest(),b=c.getNorthEast()):_=b=c,_.lat>=h.lat&&b.lat<=g.lat&&_.lng>=h.lng&&b.lng<=g.lng},intersects:function(c){c=ie(c);var h=this._southWest,g=this._northEast,_=c.getSouthWest(),b=c.getNorthEast(),k=b.lat>=h.lat&&_.lat<=g.lat,z=b.lng>=h.lng&&_.lng<=g.lng;return k&&z},overlaps:function(c){c=ie(c);var h=this._southWest,g=this._northEast,_=c.getSouthWest(),b=c.getNorthEast(),k=b.lat>h.lat&&_.lat<g.lat,z=b.lng>h.lng&&_.lng<g.lng;return k&&z},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(c,h){return c?(c=ie(c),this._southWest.equals(c.getSouthWest(),h)&&this._northEast.equals(c.getNorthEast(),h)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ie(c,h){return c instanceof oe?c:new oe(c,h)}function fe(c,h,g){if(isNaN(c)||isNaN(h))throw new Error("Invalid LatLng object: ("+c+", "+h+")");this.lat=+c,this.lng=+h,g!==void 0&&(this.alt=+g)}fe.prototype={equals:function(c,h){if(!c)return!1;c=me(c);var g=Math.max(Math.abs(this.lat-c.lat),Math.abs(this.lng-c.lng));return g<=(h===void 0?1e-9:h)},toString:function(c){return"LatLng("+d(this.lat,c)+", "+d(this.lng,c)+")"},distanceTo:function(c){return Ge.distance(this,me(c))},wrap:function(){return Ge.wrapLatLng(this)},toBounds:function(c){var h=180*c/40075017,g=h/Math.cos(Math.PI/180*this.lat);return ie([this.lat-h,this.lng-g],[this.lat+h,this.lng+g])},clone:function(){return new fe(this.lat,this.lng,this.alt)}};function me(c,h,g){return c instanceof fe?c:C(c)&&typeof c[0]!="object"?c.length===3?new fe(c[0],c[1],c[2]):c.length===2?new fe(c[0],c[1]):null:c==null?c:typeof c=="object"&&"lat"in c?new fe(c.lat,"lng"in c?c.lng:c.lon,c.alt):h===void 0?null:new fe(c,h,g)}var Fe={latLngToPoint:function(c,h){var g=this.projection.project(c),_=this.scale(h);return this.transformation._transform(g,_)},pointToLatLng:function(c,h){var g=this.scale(h),_=this.transformation.untransform(c,g);return this.projection.unproject(_)},project:function(c){return this.projection.project(c)},unproject:function(c){return this.projection.unproject(c)},scale:function(c){return 256*Math.pow(2,c)},zoom:function(c){return Math.log(c/256)/Math.LN2},getProjectedBounds:function(c){if(this.infinite)return null;var h=this.projection.bounds,g=this.scale(c),_=this.transformation.transform(h.min,g),b=this.transformation.transform(h.max,g);return new ne(_,b)},infinite:!1,wrapLatLng:function(c){var h=this.wrapLng?l(c.lng,this.wrapLng,!0):c.lng,g=this.wrapLat?l(c.lat,this.wrapLat,!0):c.lat,_=c.alt;return new fe(g,h,_)},wrapLatLngBounds:function(c){var h=c.getCenter(),g=this.wrapLatLng(h),_=h.lat-g.lat,b=h.lng-g.lng;if(_===0&&b===0)return c;var k=c.getSouthWest(),z=c.getNorthEast(),Z=new fe(k.lat-_,k.lng-b),X=new fe(z.lat-_,z.lng-b);return new oe(Z,X)}},Ge=t({},Fe,{wrapLng:[-180,180],R:6371e3,distance:function(c,h){var g=Math.PI/180,_=c.lat*g,b=h.lat*g,k=Math.sin((h.lat-c.lat)*g/2),z=Math.sin((h.lng-c.lng)*g/2),Z=k*k+Math.cos(_)*Math.cos(b)*z*z,X=2*Math.atan2(Math.sqrt(Z),Math.sqrt(1-Z));return this.R*X}}),et=6378137,Lt={R:et,MAX_LATITUDE:85.0511287798,project:function(c){var h=Math.PI/180,g=this.MAX_LATITUDE,_=Math.max(Math.min(g,c.lat),-g),b=Math.sin(_*h);return new q(this.R*c.lng*h,this.R*Math.log((1+b)/(1-b))/2)},unproject:function(c){var h=180/Math.PI;return new fe((2*Math.atan(Math.exp(c.y/this.R))-Math.PI/2)*h,c.x*h/this.R)},bounds:function(){var c=et*Math.PI;return new ne([-c,-c],[c,c])}()};function Ot(c,h,g,_){if(C(c)){this._a=c[0],this._b=c[1],this._c=c[2],this._d=c[3];return}this._a=c,this._b=h,this._c=g,this._d=_}Ot.prototype={transform:function(c,h){return this._transform(c.clone(),h)},_transform:function(c,h){return h=h||1,c.x=h*(this._a*c.x+this._b),c.y=h*(this._c*c.y+this._d),c},untransform:function(c,h){return h=h||1,new q((c.x/h-this._b)/this._a,(c.y/h-this._d)/this._c)}};function Xt(c,h,g,_){return new Ot(c,h,g,_)}var Sn=t({},Ge,{code:"EPSG:3857",projection:Lt,transformation:function(){var c=.5/(Math.PI*Lt.R);return Xt(c,.5,-c,.5)}()}),vl=t({},Sn,{code:"EPSG:900913"});function ds(c){return document.createElementNS("http://www.w3.org/2000/svg",c)}function hs(c,h){var g="",_,b,k,z,Z,X;for(_=0,k=c.length;_<k;_++){for(Z=c[_],b=0,z=Z.length;b<z;b++)X=Z[b],g+=(b?"L":"M")+X.x+" "+X.y;g+=h?ke.svg?"z":"x":""}return g||"M0 0"}var na=document.documentElement.style,ct="ActiveXObject"in window,Tn=ct&&!document.addEventListener,Zn="msLaunchUri"in navigator&&!("documentMode"in document),Mi=Yi("webkit"),Xn=Yi("android"),Ki=Yi("android 2")||Yi("android 3"),_r=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Kc=Xn&&Yi("Google")&&_r<537&&!("AudioNode"in window),Er=!!window.opera,so=!Zn&&Yi("chrome"),Tr=Yi("gecko")&&!Mi&&!Er&&!ct,wn=!so&&Yi("safari"),Cn=Yi("phantom"),fs="OTransition"in na,_l=navigator.platform.indexOf("Win")===0,Br=ct&&"transition"in na,oh="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Ki,ia="MozPerspective"in na,nm=!window.L_DISABLE_3D&&(Br||oh||ia)&&!fs&&!Cn,ra=typeof orientation<"u"||Yi("mobile"),ah=ra&&Mi,oE=ra&&oh,im=!window.PointerEvent&&window.MSPointerEvent,Yc=!!(window.PointerEvent||im),lh="ontouchstart"in window||!!window.TouchEvent,rm=!window.L_NO_TOUCH&&(lh||Yc),El=ra&&Er,ch=ra&&Tr,uh=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,oo=function(){var c=!1;try{var h=Object.defineProperty({},"passive",{get:function(){c=!0}});window.addEventListener("testPassiveEventSupport",u,h),window.removeEventListener("testPassiveEventSupport",u,h)}catch{}return c}(),sm=function(){return!!document.createElement("canvas").getContext}(),sa=!!(document.createElementNS&&ds("svg").createSVGRect),om=!!sa&&function(){var c=document.createElement("div");return c.innerHTML="<svg/>",(c.firstChild&&c.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Tl=!sa&&function(){try{var c=document.createElement("div");c.innerHTML='<v:shape adj="1"/>';var h=c.firstChild;return h.style.behavior="url(#default#VML)",h&&typeof h.adj=="object"}catch{return!1}}(),am=navigator.platform.indexOf("Mac")===0,Jn=navigator.platform.indexOf("Linux")===0;function Yi(c){return navigator.userAgent.toLowerCase().indexOf(c)>=0}var ke={ie:ct,ielt9:Tn,edge:Zn,webkit:Mi,android:Xn,android23:Ki,androidStock:Kc,opera:Er,chrome:so,gecko:Tr,safari:wn,phantom:Cn,opera12:fs,win:_l,ie3d:Br,webkit3d:oh,gecko3d:ia,any3d:nm,mobile:ra,mobileWebkit:ah,mobileWebkit3d:oE,msPointer:im,pointer:Yc,touch:rm,touchNative:lh,mobileOpera:El,mobileGecko:ch,retina:uh,passiveEvents:oo,canvas:sm,svg:sa,vml:Tl,inlineSvg:om,mac:am,linux:Jn},oa=ke.msPointer?"MSPointerDown":"pointerdown",lm=ke.msPointer?"MSPointerMove":"pointermove",cm=ke.msPointer?"MSPointerUp":"pointerup",ao=ke.msPointer?"MSPointerCancel":"pointercancel",dh={touchstart:oa,touchmove:lm,touchend:cm,touchcancel:ao},um={touchstart:hm,touchmove:aa,touchend:aa,touchcancel:aa},Ur={},hh=!1;function fh(c,h,g){return h==="touchstart"&&mh(),um[h]?(g=um[h].bind(this,g),c.addEventListener(dh[h],g,!1),g):(console.warn("wrong event specified:",h),u)}function Qc(c,h,g){if(!dh[h]){console.warn("wrong event specified:",h);return}c.removeEventListener(dh[h],g,!1)}function ps(c){Ur[c.pointerId]=c}function dm(c){Ur[c.pointerId]&&(Ur[c.pointerId]=c)}function ph(c){delete Ur[c.pointerId]}function mh(){hh||(document.addEventListener(oa,ps,!0),document.addEventListener(lm,dm,!0),document.addEventListener(cm,ph,!0),document.addEventListener(ao,ph,!0),hh=!0)}function aa(c,h){if(h.pointerType!==(h.MSPOINTER_TYPE_MOUSE||"mouse")){h.touches=[];for(var g in Ur)h.touches.push(Ur[g]);h.changedTouches=[h],c(h)}}function hm(c,h){h.MSPOINTER_TYPE_TOUCH&&h.pointerType===h.MSPOINTER_TYPE_TOUCH&&dn(h),aa(c,h)}function fm(c){var h={},g,_;for(_ in c)g=c[_],h[_]=g&&g.bind?g.bind(c):g;return c=h,h.type="dblclick",h.detail=2,h.isTrusted=!1,h._simulated=!0,h}var aE=200;function Zc(c,h){c.addEventListener("dblclick",h);var g=0,_;function b(k){if(k.detail!==1){_=k.detail;return}if(!(k.pointerType==="mouse"||k.sourceCapabilities&&!k.sourceCapabilities.firesTouchEvents)){var z=Ih(k);if(!(z.some(function(X){return X instanceof HTMLLabelElement&&X.attributes.for})&&!z.some(function(X){return X instanceof HTMLInputElement||X instanceof HTMLSelectElement}))){var Z=Date.now();Z-g<=aE?(_++,_===2&&h(fm(k))):_=1,g=Z}}}return c.addEventListener("click",b),{dblclick:h,simDblclick:b}}function pm(c,h){c.removeEventListener("dblclick",h.dblclick),c.removeEventListener("click",h.simDblclick)}var wl=wr(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),$r=wr(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ms=$r==="webkitTransition"||$r==="OTransition"?$r+"End":"transitionend";function Xc(c){return typeof c=="string"?document.getElementById(c):c}function bl(c,h){var g=c.style[h]||c.currentStyle&&c.currentStyle[h];if((!g||g==="auto")&&document.defaultView){var _=document.defaultView.getComputedStyle(c,null);g=_?_[h]:null}return g==="auto"?null:g}function It(c,h,g){var _=document.createElement(c);return _.className=h||"",g&&g.appendChild(_),_}function Jt(c){var h=c.parentNode;h&&h.removeChild(c)}function Il(c){for(;c.firstChild;)c.removeChild(c.firstChild)}function gs(c){var h=c.parentNode;h&&h.lastChild!==c&&h.appendChild(c)}function ys(c){var h=c.parentNode;h&&h.firstChild!==c&&h.insertBefore(c,h.firstChild)}function Jc(c,h){if(c.classList!==void 0)return c.classList.contains(h);var g=Sl(c);return g.length>0&&new RegExp("(^|\\s)"+h+"(\\s|$)").test(g)}function Xe(c,h){if(c.classList!==void 0)for(var g=m(h),_=0,b=g.length;_<b;_++)c.classList.add(g[_]);else if(!Jc(c,h)){var k=Sl(c);gh(c,(k?k+" ":"")+h)}}function un(c,h){c.classList!==void 0?c.classList.remove(h):gh(c,f((" "+Sl(c)+" ").replace(" "+h+" "," ")))}function gh(c,h){c.className.baseVal===void 0?c.className=h:c.className.baseVal=h}function Sl(c){return c.correspondingElement&&(c=c.correspondingElement),c.className.baseVal===void 0?c.className:c.className.baseVal}function yi(c,h){"opacity"in c.style?c.style.opacity=h:"filter"in c.style&&lE(c,h)}function lE(c,h){var g=!1,_="DXImageTransform.Microsoft.Alpha";try{g=c.filters.item(_)}catch{if(h===1)return}h=Math.round(h*100),g?(g.Enabled=h!==100,g.Opacity=h):c.style.filter+=" progid:"+_+"(opacity="+h+")"}function wr(c){for(var h=document.documentElement.style,g=0;g<c.length;g++)if(c[g]in h)return c[g];return!1}function ei(c,h,g){var _=h||new q(0,0);c.style[wl]=(ke.ie3d?"translate("+_.x+"px,"+_.y+"px)":"translate3d("+_.x+"px,"+_.y+"px,0)")+(g?" scale("+g+")":"")}function rn(c,h){c._leaflet_pos=h,ke.any3d?ei(c,h):(c.style.left=h.x+"px",c.style.top=h.y+"px")}function br(c){return c._leaflet_pos||new q(0,0)}var la,Nt,ca;if("onselectstart"in document)la=function(){Ye(window,"selectstart",dn)},Nt=function(){$t(window,"selectstart",dn)};else{var jr=wr(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);la=function(){if(jr){var c=document.documentElement.style;ca=c[jr],c[jr]="none"}},Nt=function(){jr&&(document.documentElement.style[jr]=ca,ca=void 0)}}function lo(){Ye(window,"dragstart",dn)}function yh(){$t(window,"dragstart",dn)}var Cl,vh;function _h(c){for(;c.tabIndex===-1;)c=c.parentNode;c.style&&(eu(),Cl=c,vh=c.style.outlineStyle,c.style.outlineStyle="none",Ye(window,"keydown",eu))}function eu(){Cl&&(Cl.style.outlineStyle=vh,Cl=void 0,vh=void 0,$t(window,"keydown",eu))}function mm(c){do c=c.parentNode;while((!c.offsetWidth||!c.offsetHeight)&&c!==document.body);return c}function co(c){var h=c.getBoundingClientRect();return{x:h.width/c.offsetWidth||1,y:h.height/c.offsetHeight||1,boundingClientRect:h}}var vs={__proto__:null,TRANSFORM:wl,TRANSITION:$r,TRANSITION_END:ms,get:Xc,getStyle:bl,create:It,remove:Jt,empty:Il,toFront:gs,toBack:ys,hasClass:Jc,addClass:Xe,removeClass:un,setClass:gh,getClass:Sl,setOpacity:yi,testProp:wr,setTransform:ei,setPosition:rn,getPosition:br,get disableTextSelection(){return la},get enableTextSelection(){return Nt},disableImageDrag:lo,enableImageDrag:yh,preventOutline:_h,restoreOutline:eu,getSizedParentNode:mm,getScale:co};function Ye(c,h,g,_){if(h&&typeof h=="object")for(var b in h)Th(c,b,h[b],g);else{h=m(h);for(var k=0,z=h.length;k<z;k++)Th(c,h[k],g,_)}return this}var Qi="_leaflet_events";function $t(c,h,g,_){if(arguments.length===1)uo(c),delete c[Qi];else if(h&&typeof h=="object")for(var b in h)wh(c,b,h[b],g);else if(h=m(h),arguments.length===2)uo(c,function(Z){return D(h,Z)!==-1});else for(var k=0,z=h.length;k<z;k++)wh(c,h[k],g,_);return this}function uo(c,h){for(var g in c[Qi]){var _=g.split(/\d/)[0];(!h||h(_))&&wh(c,_,null,null,g)}}var Eh={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Th(c,h,g,_){var b=h+o(g)+(_?"_"+o(_):"");if(c[Qi]&&c[Qi][b])return this;var k=function(Z){return g.call(_||c,Z||window.event)},z=k;!ke.touchNative&&ke.pointer&&h.indexOf("touch")===0?k=fh(c,h,k):ke.touch&&h==="dblclick"?k=Zc(c,k):"addEventListener"in c?h==="touchstart"||h==="touchmove"||h==="wheel"||h==="mousewheel"?c.addEventListener(Eh[h]||h,k,ke.passiveEvents?{passive:!1}:!1):h==="mouseenter"||h==="mouseleave"?(k=function(Z){Z=Z||window.event,Dl(c,Z)&&z(Z)},c.addEventListener(Eh[h],k,!1)):c.addEventListener(h,z,!1):c.attachEvent("on"+h,k),c[Qi]=c[Qi]||{},c[Qi][b]=k}function wh(c,h,g,_,b){b=b||h+o(g)+(_?"_"+o(_):"");var k=c[Qi]&&c[Qi][b];if(!k)return this;!ke.touchNative&&ke.pointer&&h.indexOf("touch")===0?Qc(c,h,k):ke.touch&&h==="dblclick"?pm(c,k):"removeEventListener"in c?c.removeEventListener(Eh[h]||h,k,!1):c.detachEvent("on"+h,k),c[Qi][b]=null}function oi(c){return c.stopPropagation?c.stopPropagation():c.originalEvent?c.originalEvent._stopped=!0:c.cancelBubble=!0,this}function bh(c){return Th(c,"wheel",oi),this}function xl(c){return Ye(c,"mousedown touchstart dblclick contextmenu",oi),c._leaflet_disable_click=!0,this}function dn(c){return c.preventDefault?c.preventDefault():c.returnValue=!1,this}function Ir(c){return dn(c),oi(c),this}function Ih(c){if(c.composedPath)return c.composedPath();for(var h=[],g=c.target;g;)h.push(g),g=g.parentNode;return h}function ua(c,h){if(!h)return new q(c.clientX,c.clientY);var g=co(h),_=g.boundingClientRect;return new q((c.clientX-_.left)/g.x-h.clientLeft,(c.clientY-_.top)/g.y-h.clientTop)}var Al=ke.linux&&ke.chrome?window.devicePixelRatio:ke.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Sh(c){return ke.edge?c.wheelDeltaY/2:c.deltaY&&c.deltaMode===0?-c.deltaY/Al:c.deltaY&&c.deltaMode===1?-c.deltaY*20:c.deltaY&&c.deltaMode===2?-c.deltaY*60:c.deltaX||c.deltaZ?0:c.wheelDelta?(c.wheelDeltaY||c.wheelDelta)/2:c.detail&&Math.abs(c.detail)<32765?-c.detail*20:c.detail?c.detail/-32765*60:0}function Dl(c,h){var g=h.relatedTarget;if(!g)return!0;try{for(;g&&g!==c;)g=g.parentNode}catch{return!1}return g!==c}var on={__proto__:null,on:Ye,off:$t,stopPropagation:oi,disableScrollPropagation:bh,disableClickPropagation:xl,preventDefault:dn,stop:Ir,getPropagationPath:Ih,getMousePosition:ua,getWheelDelta:Sh,isExternalTarget:Dl,addListener:Ye,removeListener:$t},gm=we.extend({run:function(c,h,g,_){this.stop(),this._el=c,this._inProgress=!0,this._duration=g||.25,this._easeOutPower=1/Math.max(_||.5,.2),this._startPos=br(c),this._offset=h.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=R(this._animate,this),this._step()},_step:function(c){var h=+new Date-this._startTime,g=this._duration*1e3;h<g?this._runFrame(this._easeOut(h/g),c):(this._runFrame(1),this._complete())},_runFrame:function(c,h){var g=this._startPos.add(this._offset.multiplyBy(c));h&&g._round(),rn(this._el,g),this.fire("step")},_complete:function(){M(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(c){return 1-Math.pow(1-c,this._easeOutPower)}}),yt=we.extend({options:{crs:Sn,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(c,h){h=y(this,h),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(c),this._initLayout(),this._onResize=r(this._onResize,this),this._initEvents(),h.maxBounds&&this.setMaxBounds(h.maxBounds),h.zoom!==void 0&&(this._zoom=this._limitZoom(h.zoom)),h.center&&h.zoom!==void 0&&this.setView(me(h.center),h.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=$r&&ke.any3d&&!ke.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Ye(this._proxy,ms,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(c,h,g){if(h=h===void 0?this._zoom:this._limitZoom(h),c=this._limitCenter(me(c),h,this.options.maxBounds),g=g||{},this._stop(),this._loaded&&!g.reset&&g!==!0){g.animate!==void 0&&(g.zoom=t({animate:g.animate},g.zoom),g.pan=t({animate:g.animate,duration:g.duration},g.pan));var _=this._zoom!==h?this._tryAnimatedZoom&&this._tryAnimatedZoom(c,h,g.zoom):this._tryAnimatedPan(c,g.pan);if(_)return clearTimeout(this._sizeTimer),this}return this._resetView(c,h,g.pan&&g.pan.noMoveStart),this},setZoom:function(c,h){return this._loaded?this.setView(this.getCenter(),c,{zoom:h}):(this._zoom=c,this)},zoomIn:function(c,h){return c=c||(ke.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+c,h)},zoomOut:function(c,h){return c=c||(ke.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-c,h)},setZoomAround:function(c,h,g){var _=this.getZoomScale(h),b=this.getSize().divideBy(2),k=c instanceof q?c:this.latLngToContainerPoint(c),z=k.subtract(b).multiplyBy(1-1/_),Z=this.containerPointToLatLng(b.add(z));return this.setView(Z,h,{zoom:g})},_getBoundsCenterZoom:function(c,h){h=h||{},c=c.getBounds?c.getBounds():ie(c);var g=K(h.paddingTopLeft||h.padding||[0,0]),_=K(h.paddingBottomRight||h.padding||[0,0]),b=this.getBoundsZoom(c,!1,g.add(_));if(b=typeof h.maxZoom=="number"?Math.min(h.maxZoom,b):b,b===1/0)return{center:c.getCenter(),zoom:b};var k=_.subtract(g).divideBy(2),z=this.project(c.getSouthWest(),b),Z=this.project(c.getNorthEast(),b),X=this.unproject(z.add(Z).divideBy(2).add(k),b);return{center:X,zoom:b}},fitBounds:function(c,h){if(c=ie(c),!c.isValid())throw new Error("Bounds are not valid.");var g=this._getBoundsCenterZoom(c,h);return this.setView(g.center,g.zoom,h)},fitWorld:function(c){return this.fitBounds([[-90,-180],[90,180]],c)},panTo:function(c,h){return this.setView(c,this._zoom,{pan:h})},panBy:function(c,h){if(c=K(c).round(),h=h||{},!c.x&&!c.y)return this.fire("moveend");if(h.animate!==!0&&!this.getSize().contains(c))return this._resetView(this.unproject(this.project(this.getCenter()).add(c)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new gm,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),h.noMoveStart||this.fire("movestart"),h.animate!==!1){Xe(this._mapPane,"leaflet-pan-anim");var g=this._getMapPanePos().subtract(c).round();this._panAnim.run(this._mapPane,g,h.duration||.25,h.easeLinearity)}else this._rawPanBy(c),this.fire("move").fire("moveend");return this},flyTo:function(c,h,g){if(g=g||{},g.animate===!1||!ke.any3d)return this.setView(c,h,g);this._stop();var _=this.project(this.getCenter()),b=this.project(c),k=this.getSize(),z=this._zoom;c=me(c),h=h===void 0?z:h;var Z=Math.max(k.x,k.y),X=Z*this.getZoomScale(z,h),le=b.distanceTo(_)||1,Ce=1.42,je=Ce*Ce;function pt(xn){var Lm=xn?-1:1,n3=xn?X:Z,i3=X*X-Z*Z+Lm*je*je*le*le,r3=2*n3*je*le,fE=i3/r3,N1=Math.sqrt(fE*fE+1)-fE,s3=N1<1e-9?-18:Math.log(N1);return s3}function _i(xn){return(Math.exp(xn)-Math.exp(-xn))/2}function Gn(xn){return(Math.exp(xn)+Math.exp(-xn))/2}function Sr(xn){return _i(xn)/Gn(xn)}var Li=pt(0);function hu(xn){return Z*(Gn(Li)/Gn(Li+Ce*xn))}function X$(xn){return Z*(Gn(Li)*Sr(Li+Ce*xn)-_i(Li))/je}function J$(xn){return 1-Math.pow(1-xn,1.5)}var e3=Date.now(),L1=(pt(1)-Li)/Ce,t3=g.duration?1e3*g.duration:1e3*L1*.8;function O1(){var xn=(Date.now()-e3)/t3,Lm=J$(xn)*L1;xn<=1?(this._flyToFrame=R(O1,this),this._move(this.unproject(_.add(b.subtract(_).multiplyBy(X$(Lm)/le)),z),this.getScaleZoom(Z/hu(Lm),z),{flyTo:!0})):this._move(c,h)._moveEnd(!0)}return this._moveStart(!0,g.noMoveStart),O1.call(this),this},flyToBounds:function(c,h){var g=this._getBoundsCenterZoom(c,h);return this.flyTo(g.center,g.zoom,h)},setMaxBounds:function(c){return c=ie(c),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),c.isValid()?(this.options.maxBounds=c,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(c){var h=this.options.minZoom;return this.options.minZoom=c,this._loaded&&h!==c&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(c):this},setMaxZoom:function(c){var h=this.options.maxZoom;return this.options.maxZoom=c,this._loaded&&h!==c&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(c):this},panInsideBounds:function(c,h){this._enforcingBounds=!0;var g=this.getCenter(),_=this._limitCenter(g,this._zoom,ie(c));return g.equals(_)||this.panTo(_,h),this._enforcingBounds=!1,this},panInside:function(c,h){h=h||{};var g=K(h.paddingTopLeft||h.padding||[0,0]),_=K(h.paddingBottomRight||h.padding||[0,0]),b=this.project(this.getCenter()),k=this.project(c),z=this.getPixelBounds(),Z=Ee([z.min.add(g),z.max.subtract(_)]),X=Z.getSize();if(!Z.contains(k)){this._enforcingBounds=!0;var le=k.subtract(Z.getCenter()),Ce=Z.extend(k).getSize().subtract(X);b.x+=le.x<0?-Ce.x:Ce.x,b.y+=le.y<0?-Ce.y:Ce.y,this.panTo(this.unproject(b),h),this._enforcingBounds=!1}return this},invalidateSize:function(c){if(!this._loaded)return this;c=t({animate:!1,pan:!0},c===!0?{animate:!0}:c);var h=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var g=this.getSize(),_=h.divideBy(2).round(),b=g.divideBy(2).round(),k=_.subtract(b);return!k.x&&!k.y?this:(c.animate&&c.pan?this.panBy(k):(c.pan&&this._rawPanBy(k),this.fire("move"),c.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(r(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:h,newSize:g}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(c){if(c=this._locateOptions=t({timeout:1e4,watch:!1},c),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var h=r(this._handleGeolocationResponse,this),g=r(this._handleGeolocationError,this);return c.watch?this._locationWatchId=navigator.geolocation.watchPosition(h,g,c):navigator.geolocation.getCurrentPosition(h,g,c),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(c){if(this._container._leaflet_id){var h=c.code,g=c.message||(h===1?"permission denied":h===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:h,message:"Geolocation error: "+g+"."})}},_handleGeolocationResponse:function(c){if(this._container._leaflet_id){var h=c.coords.latitude,g=c.coords.longitude,_=new fe(h,g),b=_.toBounds(c.coords.accuracy*2),k=this._locateOptions;if(k.setView){var z=this.getBoundsZoom(b);this.setView(_,k.maxZoom?Math.min(z,k.maxZoom):z)}var Z={latlng:_,bounds:b,timestamp:c.timestamp};for(var X in c.coords)typeof c.coords[X]=="number"&&(Z[X]=c.coords[X]);this.fire("locationfound",Z)}},addHandler:function(c,h){if(!h)return this;var g=this[c]=new h(this);return this._handlers.push(g),this.options[c]&&g.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Jt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(M(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var c;for(c in this._layers)this._layers[c].remove();for(c in this._panes)Jt(this._panes[c]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(c,h){var g="leaflet-pane"+(c?" leaflet-"+c.replace("Pane","")+"-pane":""),_=It("div",g,h||this._mapPane);return c&&(this._panes[c]=_),_},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var c=this.getPixelBounds(),h=this.unproject(c.getBottomLeft()),g=this.unproject(c.getTopRight());return new oe(h,g)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(c,h,g){c=ie(c),g=K(g||[0,0]);var _=this.getZoom()||0,b=this.getMinZoom(),k=this.getMaxZoom(),z=c.getNorthWest(),Z=c.getSouthEast(),X=this.getSize().subtract(g),le=Ee(this.project(Z,_),this.project(z,_)).getSize(),Ce=ke.any3d?this.options.zoomSnap:1,je=X.x/le.x,pt=X.y/le.y,_i=h?Math.max(je,pt):Math.min(je,pt);return _=this.getScaleZoom(_i,_),Ce&&(_=Math.round(_/(Ce/100))*(Ce/100),_=h?Math.ceil(_/Ce)*Ce:Math.floor(_/Ce)*Ce),Math.max(b,Math.min(k,_))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new q(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(c,h){var g=this._getTopLeftPoint(c,h);return new ne(g,g.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(c){return this.options.crs.getProjectedBounds(c===void 0?this.getZoom():c)},getPane:function(c){return typeof c=="string"?this._panes[c]:c},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(c,h){var g=this.options.crs;return h=h===void 0?this._zoom:h,g.scale(c)/g.scale(h)},getScaleZoom:function(c,h){var g=this.options.crs;h=h===void 0?this._zoom:h;var _=g.zoom(c*g.scale(h));return isNaN(_)?1/0:_},project:function(c,h){return h=h===void 0?this._zoom:h,this.options.crs.latLngToPoint(me(c),h)},unproject:function(c,h){return h=h===void 0?this._zoom:h,this.options.crs.pointToLatLng(K(c),h)},layerPointToLatLng:function(c){var h=K(c).add(this.getPixelOrigin());return this.unproject(h)},latLngToLayerPoint:function(c){var h=this.project(me(c))._round();return h._subtract(this.getPixelOrigin())},wrapLatLng:function(c){return this.options.crs.wrapLatLng(me(c))},wrapLatLngBounds:function(c){return this.options.crs.wrapLatLngBounds(ie(c))},distance:function(c,h){return this.options.crs.distance(me(c),me(h))},containerPointToLayerPoint:function(c){return K(c).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(c){return K(c).add(this._getMapPanePos())},containerPointToLatLng:function(c){var h=this.containerPointToLayerPoint(K(c));return this.layerPointToLatLng(h)},latLngToContainerPoint:function(c){return this.layerPointToContainerPoint(this.latLngToLayerPoint(me(c)))},mouseEventToContainerPoint:function(c){return ua(c,this._container)},mouseEventToLayerPoint:function(c){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(c))},mouseEventToLatLng:function(c){return this.layerPointToLatLng(this.mouseEventToLayerPoint(c))},_initContainer:function(c){var h=this._container=Xc(c);if(h){if(h._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Ye(h,"scroll",this._onScroll,this),this._containerId=o(h)},_initLayout:function(){var c=this._container;this._fadeAnimated=this.options.fadeAnimation&&ke.any3d,Xe(c,"leaflet-container"+(ke.touch?" leaflet-touch":"")+(ke.retina?" leaflet-retina":"")+(ke.ielt9?" leaflet-oldie":"")+(ke.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var h=bl(c,"position");h!=="absolute"&&h!=="relative"&&h!=="fixed"&&h!=="sticky"&&(c.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var c=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),rn(this._mapPane,new q(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Xe(c.markerPane,"leaflet-zoom-hide"),Xe(c.shadowPane,"leaflet-zoom-hide"))},_resetView:function(c,h,g){rn(this._mapPane,new q(0,0));var _=!this._loaded;this._loaded=!0,h=this._limitZoom(h),this.fire("viewprereset");var b=this._zoom!==h;this._moveStart(b,g)._move(c,h)._moveEnd(b),this.fire("viewreset"),_&&this.fire("load")},_moveStart:function(c,h){return c&&this.fire("zoomstart"),h||this.fire("movestart"),this},_move:function(c,h,g,_){h===void 0&&(h=this._zoom);var b=this._zoom!==h;return this._zoom=h,this._lastCenter=c,this._pixelOrigin=this._getNewPixelOrigin(c),_?g&&g.pinch&&this.fire("zoom",g):((b||g&&g.pinch)&&this.fire("zoom",g),this.fire("move",g)),this},_moveEnd:function(c){return c&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return M(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(c){rn(this._mapPane,this._getMapPanePos().subtract(c))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(c){this._targets={},this._targets[o(this._container)]=this;var h=c?$t:Ye;h(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&h(window,"resize",this._onResize,this),ke.any3d&&this.options.transform3DLimit&&(c?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){M(this._resizeRequest),this._resizeRequest=R(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var c=this._getMapPanePos();Math.max(Math.abs(c.x),Math.abs(c.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(c,h){for(var g=[],_,b=h==="mouseout"||h==="mouseover",k=c.target||c.srcElement,z=!1;k;){if(_=this._targets[o(k)],_&&(h==="click"||h==="preclick")&&this._draggableMoved(_)){z=!0;break}if(_&&_.listens(h,!0)&&(b&&!Dl(k,c)||(g.push(_),b))||k===this._container)break;k=k.parentNode}return!g.length&&!z&&!b&&this.listens(h,!0)&&(g=[this]),g},_isClickDisabled:function(c){for(;c&&c!==this._container;){if(c._leaflet_disable_click)return!0;c=c.parentNode}},_handleDOMEvent:function(c){var h=c.target||c.srcElement;if(!(!this._loaded||h._leaflet_disable_events||c.type==="click"&&this._isClickDisabled(h))){var g=c.type;g==="mousedown"&&_h(h),this._fireDOMEvent(c,g)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(c,h,g){if(c.type==="click"){var _=t({},c);_.type="preclick",this._fireDOMEvent(_,_.type,g)}var b=this._findEventTargets(c,h);if(g){for(var k=[],z=0;z<g.length;z++)g[z].listens(h,!0)&&k.push(g[z]);b=k.concat(b)}if(b.length){h==="contextmenu"&&dn(c);var Z=b[0],X={originalEvent:c};if(c.type!=="keypress"&&c.type!=="keydown"&&c.type!=="keyup"){var le=Z.getLatLng&&(!Z._radius||Z._radius<=10);X.containerPoint=le?this.latLngToContainerPoint(Z.getLatLng()):this.mouseEventToContainerPoint(c),X.layerPoint=this.containerPointToLayerPoint(X.containerPoint),X.latlng=le?Z.getLatLng():this.layerPointToLatLng(X.layerPoint)}for(z=0;z<b.length;z++)if(b[z].fire(h,X,!0),X.originalEvent._stopped||b[z].options.bubblingMouseEvents===!1&&D(this._mouseEvents,h)!==-1)return}},_draggableMoved:function(c){return c=c.dragging&&c.dragging.enabled()?c:this,c.dragging&&c.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var c=0,h=this._handlers.length;c<h;c++)this._handlers[c].disable()},whenReady:function(c,h){return this._loaded?c.call(h||this,{target:this}):this.on("load",c,h),this},_getMapPanePos:function(){return br(this._mapPane)||new q(0,0)},_moved:function(){var c=this._getMapPanePos();return c&&!c.equals([0,0])},_getTopLeftPoint:function(c,h){var g=c&&h!==void 0?this._getNewPixelOrigin(c,h):this.getPixelOrigin();return g.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(c,h){var g=this.getSize()._divideBy(2);return this.project(c,h)._subtract(g)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(c,h,g){var _=this._getNewPixelOrigin(g,h);return this.project(c,h)._subtract(_)},_latLngBoundsToNewLayerBounds:function(c,h,g){var _=this._getNewPixelOrigin(g,h);return Ee([this.project(c.getSouthWest(),h)._subtract(_),this.project(c.getNorthWest(),h)._subtract(_),this.project(c.getSouthEast(),h)._subtract(_),this.project(c.getNorthEast(),h)._subtract(_)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(c){return this.latLngToLayerPoint(c).subtract(this._getCenterLayerPoint())},_limitCenter:function(c,h,g){if(!g)return c;var _=this.project(c,h),b=this.getSize().divideBy(2),k=new ne(_.subtract(b),_.add(b)),z=this._getBoundsOffset(k,g,h);return Math.abs(z.x)<=1&&Math.abs(z.y)<=1?c:this.unproject(_.add(z),h)},_limitOffset:function(c,h){if(!h)return c;var g=this.getPixelBounds(),_=new ne(g.min.add(c),g.max.add(c));return c.add(this._getBoundsOffset(_,h))},_getBoundsOffset:function(c,h,g){var _=Ee(this.project(h.getNorthEast(),g),this.project(h.getSouthWest(),g)),b=_.min.subtract(c.min),k=_.max.subtract(c.max),z=this._rebound(b.x,-k.x),Z=this._rebound(b.y,-k.y);return new q(z,Z)},_rebound:function(c,h){return c+h>0?Math.round(c-h)/2:Math.max(0,Math.ceil(c))-Math.max(0,Math.floor(h))},_limitZoom:function(c){var h=this.getMinZoom(),g=this.getMaxZoom(),_=ke.any3d?this.options.zoomSnap:1;return _&&(c=Math.round(c/_)*_),Math.max(h,Math.min(g,c))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){un(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(c,h){var g=this._getCenterOffset(c)._trunc();return(h&&h.animate)!==!0&&!this.getSize().contains(g)?!1:(this.panBy(g,h),!0)},_createAnimProxy:function(){var c=this._proxy=It("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(c),this.on("zoomanim",function(h){var g=wl,_=this._proxy.style[g];ei(this._proxy,this.project(h.center,h.zoom),this.getZoomScale(h.zoom,1)),_===this._proxy.style[g]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Jt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var c=this.getCenter(),h=this.getZoom();ei(this._proxy,this.project(c,h),this.getZoomScale(h,1))},_catchTransitionEnd:function(c){this._animatingZoom&&c.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(c,h,g){if(this._animatingZoom)return!0;if(g=g||{},!this._zoomAnimated||g.animate===!1||this._nothingToAnimate()||Math.abs(h-this._zoom)>this.options.zoomAnimationThreshold)return!1;var _=this.getZoomScale(h),b=this._getCenterOffset(c)._divideBy(1-1/_);return g.animate!==!0&&!this.getSize().contains(b)?!1:(R(function(){this._moveStart(!0,g.noMoveStart||!1)._animateZoom(c,h,!0)},this),!0)},_animateZoom:function(c,h,g,_){this._mapPane&&(g&&(this._animatingZoom=!0,this._animateToCenter=c,this._animateToZoom=h,Xe(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:c,zoom:h,noUpdate:_}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(r(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&un(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function ym(c,h){return new yt(c,h)}var ki=j.extend({options:{position:"topright"},initialize:function(c){y(this,c)},getPosition:function(){return this.options.position},setPosition:function(c){var h=this._map;return h&&h.removeControl(this),this.options.position=c,h&&h.addControl(this),this},getContainer:function(){return this._container},addTo:function(c){this.remove(),this._map=c;var h=this._container=this.onAdd(c),g=this.getPosition(),_=c._controlCorners[g];return Xe(h,"leaflet-control"),g.indexOf("bottom")!==-1?_.insertBefore(h,_.firstChild):_.appendChild(h),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Jt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(c){this._map&&c&&c.screenX>0&&c.screenY>0&&this._map.getContainer().focus()}}),da=function(c){return new ki(c)};yt.include({addControl:function(c){return c.addTo(this),this},removeControl:function(c){return c.remove(),this},_initControlPos:function(){var c=this._controlCorners={},h="leaflet-",g=this._controlContainer=It("div",h+"control-container",this._container);function _(b,k){var z=h+b+" "+h+k;c[b+k]=It("div",z,g)}_("top","left"),_("top","right"),_("bottom","left"),_("bottom","right")},_clearControlPos:function(){for(var c in this._controlCorners)Jt(this._controlCorners[c]);Jt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Pl=ki.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(c,h,g,_){return g<_?-1:_<g?1:0}},initialize:function(c,h,g){y(this,g),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var _ in c)this._addLayer(c[_],_);for(_ in h)this._addLayer(h[_],_,!0)},onAdd:function(c){this._initLayout(),this._update(),this._map=c,c.on("zoomend",this._checkDisabledLayers,this);for(var h=0;h<this._layers.length;h++)this._layers[h].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(c){return ki.prototype.addTo.call(this,c),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var c=0;c<this._layers.length;c++)this._layers[c].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(c,h){return this._addLayer(c,h),this._map?this._update():this},addOverlay:function(c,h){return this._addLayer(c,h,!0),this._map?this._update():this},removeLayer:function(c){c.off("add remove",this._onLayerChange,this);var h=this._getLayer(o(c));return h&&this._layers.splice(this._layers.indexOf(h),1),this._map?this._update():this},expand:function(){Xe(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var c=this._map.getSize().y-(this._container.offsetTop+50);return c<this._section.clientHeight?(Xe(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=c+"px"):un(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return un(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var c="leaflet-control-layers",h=this._container=It("div",c),g=this.options.collapsed;h.setAttribute("aria-haspopup",!0),xl(h),bh(h);var _=this._section=It("section",c+"-list");g&&(this._map.on("click",this.collapse,this),Ye(h,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var b=this._layersLink=It("a",c+"-toggle",h);b.href="#",b.title="Layers",b.setAttribute("role","button"),Ye(b,{keydown:function(k){k.keyCode===13&&this._expandSafely()},click:function(k){dn(k),this._expandSafely()}},this),g||this.expand(),this._baseLayersList=It("div",c+"-base",_),this._separator=It("div",c+"-separator",_),this._overlaysList=It("div",c+"-overlays",_),h.appendChild(_)},_getLayer:function(c){for(var h=0;h<this._layers.length;h++)if(this._layers[h]&&o(this._layers[h].layer)===c)return this._layers[h]},_addLayer:function(c,h,g){this._map&&c.on("add remove",this._onLayerChange,this),this._layers.push({layer:c,name:h,overlay:g}),this.options.sortLayers&&this._layers.sort(r(function(_,b){return this.options.sortFunction(_.layer,b.layer,_.name,b.name)},this)),this.options.autoZIndex&&c.setZIndex&&(this._lastZIndex++,c.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Il(this._baseLayersList),Il(this._overlaysList),this._layerControlInputs=[];var c,h,g,_,b=0;for(g=0;g<this._layers.length;g++)_=this._layers[g],this._addItem(_),h=h||_.overlay,c=c||!_.overlay,b+=_.overlay?0:1;return this.options.hideSingleBase&&(c=c&&b>1,this._baseLayersList.style.display=c?"":"none"),this._separator.style.display=h&&c?"":"none",this},_onLayerChange:function(c){this._handlingClick||this._update();var h=this._getLayer(o(c.target)),g=h.overlay?c.type==="add"?"overlayadd":"overlayremove":c.type==="add"?"baselayerchange":null;g&&this._map.fire(g,h)},_createRadioElement:function(c,h){var g='<input type="radio" class="leaflet-control-layers-selector" name="'+c+'"'+(h?' checked="checked"':"")+"/>",_=document.createElement("div");return _.innerHTML=g,_.firstChild},_addItem:function(c){var h=document.createElement("label"),g=this._map.hasLayer(c.layer),_;c.overlay?(_=document.createElement("input"),_.type="checkbox",_.className="leaflet-control-layers-selector",_.defaultChecked=g):_=this._createRadioElement("leaflet-base-layers_"+o(this),g),this._layerControlInputs.push(_),_.layerId=o(c.layer),Ye(_,"click",this._onInputClick,this);var b=document.createElement("span");b.innerHTML=" "+c.name;var k=document.createElement("span");h.appendChild(k),k.appendChild(_),k.appendChild(b);var z=c.overlay?this._overlaysList:this._baseLayersList;return z.appendChild(h),this._checkDisabledLayers(),h},_onInputClick:function(){if(!this._preventClick){var c=this._layerControlInputs,h,g,_=[],b=[];this._handlingClick=!0;for(var k=c.length-1;k>=0;k--)h=c[k],g=this._getLayer(h.layerId).layer,h.checked?_.push(g):h.checked||b.push(g);for(k=0;k<b.length;k++)this._map.hasLayer(b[k])&&this._map.removeLayer(b[k]);for(k=0;k<_.length;k++)this._map.hasLayer(_[k])||this._map.addLayer(_[k]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var c=this._layerControlInputs,h,g,_=this._map.getZoom(),b=c.length-1;b>=0;b--)h=c[b],g=this._getLayer(h.layerId).layer,h.disabled=g.options.minZoom!==void 0&&_<g.options.minZoom||g.options.maxZoom!==void 0&&_>g.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var c=this._section;this._preventClick=!0,Ye(c,"click",dn),this.expand();var h=this;setTimeout(function(){$t(c,"click",dn),h._preventClick=!1})}}),vm=function(c,h,g){return new Pl(c,h,g)},Zi=ki.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(c){var h="leaflet-control-zoom",g=It("div",h+" leaflet-bar"),_=this.options;return this._zoomInButton=this._createButton(_.zoomInText,_.zoomInTitle,h+"-in",g,this._zoomIn),this._zoomOutButton=this._createButton(_.zoomOutText,_.zoomOutTitle,h+"-out",g,this._zoomOut),this._updateDisabled(),c.on("zoomend zoomlevelschange",this._updateDisabled,this),g},onRemove:function(c){c.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(c){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(c.shiftKey?3:1))},_zoomOut:function(c){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(c.shiftKey?3:1))},_createButton:function(c,h,g,_,b){var k=It("a",g,_);return k.innerHTML=c,k.href="#",k.title=h,k.setAttribute("role","button"),k.setAttribute("aria-label",h),xl(k),Ye(k,"click",Ir),Ye(k,"click",b,this),Ye(k,"click",this._refocusOnMap,this),k},_updateDisabled:function(){var c=this._map,h="leaflet-disabled";un(this._zoomInButton,h),un(this._zoomOutButton,h),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||c._zoom===c.getMinZoom())&&(Xe(this._zoomOutButton,h),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||c._zoom===c.getMaxZoom())&&(Xe(this._zoomInButton,h),this._zoomInButton.setAttribute("aria-disabled","true"))}});yt.mergeOptions({zoomControl:!0}),yt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Zi,this.addControl(this.zoomControl))});var _m=function(c){return new Zi(c)},Em=ki.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(c){var h="leaflet-control-scale",g=It("div",h),_=this.options;return this._addScales(_,h+"-line",g),c.on(_.updateWhenIdle?"moveend":"move",this._update,this),c.whenReady(this._update,this),g},onRemove:function(c){c.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(c,h,g){c.metric&&(this._mScale=It("div",h,g)),c.imperial&&(this._iScale=It("div",h,g))},_update:function(){var c=this._map,h=c.getSize().y/2,g=c.distance(c.containerPointToLatLng([0,h]),c.containerPointToLatLng([this.options.maxWidth,h]));this._updateScales(g)},_updateScales:function(c){this.options.metric&&c&&this._updateMetric(c),this.options.imperial&&c&&this._updateImperial(c)},_updateMetric:function(c){var h=this._getRoundNum(c),g=h<1e3?h+" m":h/1e3+" km";this._updateScale(this._mScale,g,h/c)},_updateImperial:function(c){var h=c*3.2808399,g,_,b;h>5280?(g=h/5280,_=this._getRoundNum(g),this._updateScale(this._iScale,_+" mi",_/g)):(b=this._getRoundNum(h),this._updateScale(this._iScale,b+" ft",b/h))},_updateScale:function(c,h,g){c.style.width=Math.round(this.options.maxWidth*g)+"px",c.innerHTML=h},_getRoundNum:function(c){var h=Math.pow(10,(Math.floor(c)+"").length-1),g=c/h;return g=g>=10?10:g>=5?5:g>=3?3:g>=2?2:1,h*g}}),Rl=function(c){return new Em(c)},Tm='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Ml=ki.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(ke.inlineSvg?Tm+" ":"")+"Leaflet</a>"},initialize:function(c){y(this,c),this._attributions={}},onAdd:function(c){c.attributionControl=this,this._container=It("div","leaflet-control-attribution"),xl(this._container);for(var h in c._layers)c._layers[h].getAttribution&&this.addAttribution(c._layers[h].getAttribution());return this._update(),c.on("layeradd",this._addAttribution,this),this._container},onRemove:function(c){c.off("layeradd",this._addAttribution,this)},_addAttribution:function(c){c.layer.getAttribution&&(this.addAttribution(c.layer.getAttribution()),c.layer.once("remove",function(){this.removeAttribution(c.layer.getAttribution())},this))},setPrefix:function(c){return this.options.prefix=c,this._update(),this},addAttribution:function(c){return c?(this._attributions[c]||(this._attributions[c]=0),this._attributions[c]++,this._update(),this):this},removeAttribution:function(c){return c?(this._attributions[c]&&(this._attributions[c]--,this._update()),this):this},_update:function(){if(this._map){var c=[];for(var h in this._attributions)this._attributions[h]&&c.push(h);var g=[];this.options.prefix&&g.push(this.options.prefix),c.length&&g.push(c.join(", ")),this._container.innerHTML=g.join(' <span aria-hidden="true">|</span> ')}}});yt.mergeOptions({attributionControl:!0}),yt.addInitHook(function(){this.options.attributionControl&&new Ml().addTo(this)});var tu=function(c){return new Ml(c)};ki.Layers=Pl,ki.Zoom=Zi,ki.Scale=Em,ki.Attribution=Ml,da.layers=vm,da.zoom=_m,da.scale=Rl,da.attribution=tu;var Xi=j.extend({initialize:function(c){this._map=c},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Xi.addTo=function(c,h){return c.addHandler(h,this),this};var nu={Events:ge},wm=ke.touch?"touchstart mousedown":"mousedown",Gr=we.extend({options:{clickTolerance:3},initialize:function(c,h,g,_){y(this,_),this._element=c,this._dragStartTarget=h||c,this._preventOutline=g},enable:function(){this._enabled||(Ye(this._dragStartTarget,wm,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Gr._dragging===this&&this.finishDrag(!0),$t(this._dragStartTarget,wm,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(c){if(this._enabled&&(this._moved=!1,!Jc(this._element,"leaflet-zoom-anim"))){if(c.touches&&c.touches.length!==1){Gr._dragging===this&&this.finishDrag();return}if(!(Gr._dragging||c.shiftKey||c.which!==1&&c.button!==1&&!c.touches)&&(Gr._dragging=this,this._preventOutline&&_h(this._element),lo(),la(),!this._moving)){this.fire("down");var h=c.touches?c.touches[0]:c,g=mm(this._element);this._startPoint=new q(h.clientX,h.clientY),this._startPos=br(this._element),this._parentScale=co(g);var _=c.type==="mousedown";Ye(document,_?"mousemove":"touchmove",this._onMove,this),Ye(document,_?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(c){if(this._enabled){if(c.touches&&c.touches.length>1){this._moved=!0;return}var h=c.touches&&c.touches.length===1?c.touches[0]:c,g=new q(h.clientX,h.clientY)._subtract(this._startPoint);!g.x&&!g.y||Math.abs(g.x)+Math.abs(g.y)<this.options.clickTolerance||(g.x/=this._parentScale.x,g.y/=this._parentScale.y,dn(c),this._moved||(this.fire("dragstart"),this._moved=!0,Xe(document.body,"leaflet-dragging"),this._lastTarget=c.target||c.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Xe(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(g),this._moving=!0,this._lastEvent=c,this._updatePosition())}},_updatePosition:function(){var c={originalEvent:this._lastEvent};this.fire("predrag",c),rn(this._element,this._newPos),this.fire("drag",c)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(c){un(document.body,"leaflet-dragging"),this._lastTarget&&(un(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),$t(document,"mousemove touchmove",this._onMove,this),$t(document,"mouseup touchend touchcancel",this._onUp,this),yh(),Nt();var h=this._moved&&this._moving;this._moving=!1,Gr._dragging=!1,h&&this.fire("dragend",{noInertia:c,distance:this._newPos.distanceTo(this._startPos)})}});function ha(c,h,g){var _,b=[1,4,2,8],k,z,Z,X,le,Ce,je,pt;for(k=0,Ce=c.length;k<Ce;k++)c[k]._code=_s(c[k],h);for(Z=0;Z<4;Z++){for(je=b[Z],_=[],k=0,Ce=c.length,z=Ce-1;k<Ce;z=k++)X=c[k],le=c[z],X._code&je?le._code&je||(pt=kl(le,X,je,h,g),pt._code=_s(pt,h),_.push(pt)):(le._code&je&&(pt=kl(le,X,je,h,g),pt._code=_s(pt,h),_.push(pt)),_.push(X));c=_}return c}function Ch(c,h){var g,_,b,k,z,Z,X,le,Ce;if(!c||c.length===0)throw new Error("latlngs not passed");vi(c)||(console.warn("latlngs are not flat! Only the first ring will be used"),c=c[0]);var je=me([0,0]),pt=ie(c),_i=pt.getNorthWest().distanceTo(pt.getSouthWest())*pt.getNorthEast().distanceTo(pt.getNorthWest());_i<1700&&(je=iu(c));var Gn=c.length,Sr=[];for(g=0;g<Gn;g++){var Li=me(c[g]);Sr.push(h.project(me([Li.lat-je.lat,Li.lng-je.lng])))}for(Z=X=le=0,g=0,_=Gn-1;g<Gn;_=g++)b=Sr[g],k=Sr[_],z=b.y*k.x-k.y*b.x,X+=(b.x+k.x)*z,le+=(b.y+k.y)*z,Z+=z*3;Z===0?Ce=Sr[0]:Ce=[X/Z,le/Z];var hu=h.unproject(K(Ce));return me([hu.lat+je.lat,hu.lng+je.lng])}function iu(c){for(var h=0,g=0,_=0,b=0;b<c.length;b++){var k=me(c[b]);h+=k.lat,g+=k.lng,_++}return me([h/_,g/_])}var xh={__proto__:null,clipPolygon:ha,polygonCenter:Ch,centroid:iu};function ru(c,h){if(!h||!c.length)return c.slice();var g=h*h;return c=ho(c,g),c=bm(c,g),c}function Ah(c,h,g){return Math.sqrt(Nn(c,h,g,!0))}function su(c,h,g){return Nn(c,h,g)}function bm(c,h){var g=c.length,_=typeof Uint8Array<"u"?Uint8Array:Array,b=new _(g);b[0]=b[g-1]=1,ou(c,b,h,0,g-1);var k,z=[];for(k=0;k<g;k++)b[k]&&z.push(c[k]);return z}function ou(c,h,g,_,b){var k=0,z,Z,X;for(Z=_+1;Z<=b-1;Z++)X=Nn(c[Z],c[_],c[b],!0),X>k&&(z=Z,k=X);k>g&&(h[z]=1,ou(c,h,g,_,z),ou(c,h,g,z,b))}function ho(c,h){for(var g=[c[0]],_=1,b=0,k=c.length;_<k;_++)au(c[_],c[b])>h&&(g.push(c[_]),b=_);return b<k-1&&g.push(c[k-1]),g}var Dh;function Ph(c,h,g,_,b){var k=_?Dh:_s(c,g),z=_s(h,g),Z,X,le;for(Dh=z;;){if(!(k|z))return[c,h];if(k&z)return!1;Z=k||z,X=kl(c,h,Z,g,b),le=_s(X,g),Z===k?(c=X,k=le):(h=X,z=le)}}function kl(c,h,g,_,b){var k=h.x-c.x,z=h.y-c.y,Z=_.min,X=_.max,le,Ce;return g&8?(le=c.x+k*(X.y-c.y)/z,Ce=X.y):g&4?(le=c.x+k*(Z.y-c.y)/z,Ce=Z.y):g&2?(le=X.x,Ce=c.y+z*(X.x-c.x)/k):g&1&&(le=Z.x,Ce=c.y+z*(Z.x-c.x)/k),new q(le,Ce,b)}function _s(c,h){var g=0;return c.x<h.min.x?g|=1:c.x>h.max.x&&(g|=2),c.y<h.min.y?g|=4:c.y>h.max.y&&(g|=8),g}function au(c,h){var g=h.x-c.x,_=h.y-c.y;return g*g+_*_}function Nn(c,h,g,_){var b=h.x,k=h.y,z=g.x-b,Z=g.y-k,X=z*z+Z*Z,le;return X>0&&(le=((c.x-b)*z+(c.y-k)*Z)/X,le>1?(b=g.x,k=g.y):le>0&&(b+=z*le,k+=Z*le)),z=c.x-b,Z=c.y-k,_?z*z+Z*Z:new q(b,k)}function vi(c){return!C(c[0])||typeof c[0][0]!="object"&&typeof c[0][0]<"u"}function Rh(c){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),vi(c)}function fo(c,h){var g,_,b,k,z,Z,X,le;if(!c||c.length===0)throw new Error("latlngs not passed");vi(c)||(console.warn("latlngs are not flat! Only the first ring will be used"),c=c[0]);var Ce=me([0,0]),je=ie(c),pt=je.getNorthWest().distanceTo(je.getSouthWest())*je.getNorthEast().distanceTo(je.getNorthWest());pt<1700&&(Ce=iu(c));var _i=c.length,Gn=[];for(g=0;g<_i;g++){var Sr=me(c[g]);Gn.push(h.project(me([Sr.lat-Ce.lat,Sr.lng-Ce.lng])))}for(g=0,_=0;g<_i-1;g++)_+=Gn[g].distanceTo(Gn[g+1])/2;if(_===0)le=Gn[0];else for(g=0,k=0;g<_i-1;g++)if(z=Gn[g],Z=Gn[g+1],b=z.distanceTo(Z),k+=b,k>_){X=(k-_)/b,le=[Z.x-X*(Z.x-z.x),Z.y-X*(Z.y-z.y)];break}var Li=h.unproject(K(le));return me([Li.lat+Ce.lat,Li.lng+Ce.lng])}var p={__proto__:null,simplify:ru,pointToSegmentDistance:Ah,closestPointOnSegment:su,clipSegment:Ph,_getEdgeIntersection:kl,_getBitCode:_s,_sqClosestPointOnSegment:Nn,isFlat:vi,_flat:Rh,polylineCenter:fo},w={project:function(c){return new q(c.lng,c.lat)},unproject:function(c){return new fe(c.y,c.x)},bounds:new ne([-180,-90],[180,90])},S={R:6378137,R_MINOR:6356752314245179e-9,bounds:new ne([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(c){var h=Math.PI/180,g=this.R,_=c.lat*h,b=this.R_MINOR/g,k=Math.sqrt(1-b*b),z=k*Math.sin(_),Z=Math.tan(Math.PI/4-_/2)/Math.pow((1-z)/(1+z),k/2);return _=-g*Math.log(Math.max(Z,1e-10)),new q(c.lng*h*g,_)},unproject:function(c){for(var h=180/Math.PI,g=this.R,_=this.R_MINOR/g,b=Math.sqrt(1-_*_),k=Math.exp(-c.y/g),z=Math.PI/2-2*Math.atan(k),Z=0,X=.1,le;Z<15&&Math.abs(X)>1e-7;Z++)le=b*Math.sin(z),le=Math.pow((1-le)/(1+le),b/2),X=Math.PI/2-2*Math.atan(k*le)-z,z+=X;return new fe(z*h,c.x*h/g)}},O={__proto__:null,LonLat:w,Mercator:S,SphericalMercator:Lt},Y=t({},Ge,{code:"EPSG:3395",projection:S,transformation:function(){var c=.5/(Math.PI*S.R);return Xt(c,.5,-c,.5)}()}),J=t({},Ge,{code:"EPSG:4326",projection:w,transformation:Xt(1/180,1,-1/180,.5)}),Te=t({},Fe,{projection:w,transformation:Xt(1,0,-1,0),scale:function(c){return Math.pow(2,c)},zoom:function(c){return Math.log(c)/Math.LN2},distance:function(c,h){var g=h.lng-c.lng,_=h.lat-c.lat;return Math.sqrt(g*g+_*_)},infinite:!0});Fe.Earth=Ge,Fe.EPSG3395=Y,Fe.EPSG3857=Sn,Fe.EPSG900913=vl,Fe.EPSG4326=J,Fe.Simple=Te;var dt=we.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(c){return c.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(c){return c&&c.removeLayer(this),this},getPane:function(c){return this._map.getPane(c?this.options[c]||c:this.options.pane)},addInteractiveTarget:function(c){return this._map._targets[o(c)]=this,this},removeInteractiveTarget:function(c){return delete this._map._targets[o(c)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(c){var h=c.target;if(h.hasLayer(this)){if(this._map=h,this._zoomAnimated=h._zoomAnimated,this.getEvents){var g=this.getEvents();h.on(g,this),this.once("remove",function(){h.off(g,this)},this)}this.onAdd(h),this.fire("add"),h.fire("layeradd",{layer:this})}}});yt.include({addLayer:function(c){if(!c._layerAdd)throw new Error("The provided object is not a Layer.");var h=o(c);return this._layers[h]?this:(this._layers[h]=c,c._mapToAdd=this,c.beforeAdd&&c.beforeAdd(this),this.whenReady(c._layerAdd,c),this)},removeLayer:function(c){var h=o(c);return this._layers[h]?(this._loaded&&c.onRemove(this),delete this._layers[h],this._loaded&&(this.fire("layerremove",{layer:c}),c.fire("remove")),c._map=c._mapToAdd=null,this):this},hasLayer:function(c){return o(c)in this._layers},eachLayer:function(c,h){for(var g in this._layers)c.call(h,this._layers[g]);return this},_addLayers:function(c){c=c?C(c)?c:[c]:[];for(var h=0,g=c.length;h<g;h++)this.addLayer(c[h])},_addZoomLimit:function(c){(!isNaN(c.options.maxZoom)||!isNaN(c.options.minZoom))&&(this._zoomBoundLayers[o(c)]=c,this._updateZoomLevels())},_removeZoomLimit:function(c){var h=o(c);this._zoomBoundLayers[h]&&(delete this._zoomBoundLayers[h],this._updateZoomLevels())},_updateZoomLevels:function(){var c=1/0,h=-1/0,g=this._getZoomSpan();for(var _ in this._zoomBoundLayers){var b=this._zoomBoundLayers[_].options;c=b.minZoom===void 0?c:Math.min(c,b.minZoom),h=b.maxZoom===void 0?h:Math.max(h,b.maxZoom)}this._layersMaxZoom=h===-1/0?void 0:h,this._layersMinZoom=c===1/0?void 0:c,g!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var an=dt.extend({initialize:function(c,h){y(this,h),this._layers={};var g,_;if(c)for(g=0,_=c.length;g<_;g++)this.addLayer(c[g])},addLayer:function(c){var h=this.getLayerId(c);return this._layers[h]=c,this._map&&this._map.addLayer(c),this},removeLayer:function(c){var h=c in this._layers?c:this.getLayerId(c);return this._map&&this._layers[h]&&this._map.removeLayer(this._layers[h]),delete this._layers[h],this},hasLayer:function(c){var h=typeof c=="number"?c:this.getLayerId(c);return h in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(c){var h=Array.prototype.slice.call(arguments,1),g,_;for(g in this._layers)_=this._layers[g],_[c]&&_[c].apply(_,h);return this},onAdd:function(c){this.eachLayer(c.addLayer,c)},onRemove:function(c){this.eachLayer(c.removeLayer,c)},eachLayer:function(c,h){for(var g in this._layers)c.call(h,this._layers[g]);return this},getLayer:function(c){return this._layers[c]},getLayers:function(){var c=[];return this.eachLayer(c.push,c),c},setZIndex:function(c){return this.invoke("setZIndex",c)},getLayerId:function(c){return o(c)}}),St=function(c,h){return new an(c,h)},en=an.extend({addLayer:function(c){return this.hasLayer(c)?this:(c.addEventParent(this),an.prototype.addLayer.call(this,c),this.fire("layeradd",{layer:c}))},removeLayer:function(c){return this.hasLayer(c)?(c in this._layers&&(c=this._layers[c]),c.removeEventParent(this),an.prototype.removeLayer.call(this,c),this.fire("layerremove",{layer:c})):this},setStyle:function(c){return this.invoke("setStyle",c)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var c=new oe;for(var h in this._layers){var g=this._layers[h];c.extend(g.getBounds?g.getBounds():g.getLatLng())}return c}}),jn=function(c,h){return new en(c,h)},Ji=j.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(c){y(this,c)},createIcon:function(c){return this._createIcon("icon",c)},createShadow:function(c){return this._createIcon("shadow",c)},_createIcon:function(c,h){var g=this._getIconUrl(c);if(!g){if(c==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var _=this._createImg(g,h&&h.tagName==="IMG"?h:null);return this._setIconStyles(_,c),(this.options.crossOrigin||this.options.crossOrigin==="")&&(_.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),_},_setIconStyles:function(c,h){var g=this.options,_=g[h+"Size"];typeof _=="number"&&(_=[_,_]);var b=K(_),k=K(h==="shadow"&&g.shadowAnchor||g.iconAnchor||b&&b.divideBy(2,!0));c.className="leaflet-marker-"+h+" "+(g.className||""),k&&(c.style.marginLeft=-k.x+"px",c.style.marginTop=-k.y+"px"),b&&(c.style.width=b.x+"px",c.style.height=b.y+"px")},_createImg:function(c,h){return h=h||document.createElement("img"),h.src=c,h},_getIconUrl:function(c){return ke.retina&&this.options[c+"RetinaUrl"]||this.options[c+"Url"]}});function er(c){return new Ji(c)}var Es=Ji.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(c){return typeof Es.imagePath!="string"&&(Es.imagePath=this._detectIconPath()),(this.options.imagePath||Es.imagePath)+Ji.prototype._getIconUrl.call(this,c)},_stripUrl:function(c){var h=function(g,_,b){var k=_.exec(g);return k&&k[b]};return c=h(c,/^url\((['"])?(.+)\1\)$/,2),c&&h(c,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var c=It("div","leaflet-default-icon-path",document.body),h=bl(c,"background-image")||bl(c,"backgroundImage");if(document.body.removeChild(c),h=this._stripUrl(h),h)return h;var g=document.querySelector('link[href$="leaflet.css"]');return g?g.href.substring(0,g.href.length-11-1):""}}),lu=Xi.extend({initialize:function(c){this._marker=c},addHooks:function(){var c=this._marker._icon;this._draggable||(this._draggable=new Gr(c,c,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Xe(c,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&un(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(c){var h=this._marker,g=h._map,_=this._marker.options.autoPanSpeed,b=this._marker.options.autoPanPadding,k=br(h._icon),z=g.getPixelBounds(),Z=g.getPixelOrigin(),X=Ee(z.min._subtract(Z).add(b),z.max._subtract(Z).subtract(b));if(!X.contains(k)){var le=K((Math.max(X.max.x,k.x)-X.max.x)/(z.max.x-X.max.x)-(Math.min(X.min.x,k.x)-X.min.x)/(z.min.x-X.min.x),(Math.max(X.max.y,k.y)-X.max.y)/(z.max.y-X.max.y)-(Math.min(X.min.y,k.y)-X.min.y)/(z.min.y-X.min.y)).multiplyBy(_);g.panBy(le,{animate:!1}),this._draggable._newPos._add(le),this._draggable._startPos._add(le),rn(h._icon,this._draggable._newPos),this._onDrag(c),this._panRequest=R(this._adjustPan.bind(this,c))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(c){this._marker.options.autoPan&&(M(this._panRequest),this._panRequest=R(this._adjustPan.bind(this,c)))},_onDrag:function(c){var h=this._marker,g=h._shadow,_=br(h._icon),b=h._map.layerPointToLatLng(_);g&&rn(g,_),h._latlng=b,c.latlng=b,c.oldLatLng=this._oldLatLng,h.fire("move",c).fire("drag",c)},_onDragEnd:function(c){M(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",c)}}),Im=dt.extend({options:{icon:new Es,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(c,h){y(this,h),this._latlng=me(c)},onAdd:function(c){this._zoomAnimated=this._zoomAnimated&&c.options.markerZoomAnimation,this._zoomAnimated&&c.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(c){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&c.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(c){var h=this._latlng;return this._latlng=me(c),this.update(),this.fire("move",{oldLatLng:h,latlng:this._latlng})},setZIndexOffset:function(c){return this.options.zIndexOffset=c,this.update()},getIcon:function(){return this.options.icon},setIcon:function(c){return this.options.icon=c,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var c=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(c)}return this},_initIcon:function(){var c=this.options,h="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),g=c.icon.createIcon(this._icon),_=!1;g!==this._icon&&(this._icon&&this._removeIcon(),_=!0,c.title&&(g.title=c.title),g.tagName==="IMG"&&(g.alt=c.alt||"")),Xe(g,h),c.keyboard&&(g.tabIndex="0",g.setAttribute("role","button")),this._icon=g,c.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ye(g,"focus",this._panOnFocus,this);var b=c.icon.createShadow(this._shadow),k=!1;b!==this._shadow&&(this._removeShadow(),k=!0),b&&(Xe(b,h),b.alt=""),this._shadow=b,c.opacity<1&&this._updateOpacity(),_&&this.getPane().appendChild(this._icon),this._initInteraction(),b&&k&&this.getPane(c.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&$t(this._icon,"focus",this._panOnFocus,this),Jt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Jt(this._shadow),this._shadow=null},_setPos:function(c){this._icon&&rn(this._icon,c),this._shadow&&rn(this._shadow,c),this._zIndex=c.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(c){this._icon&&(this._icon.style.zIndex=this._zIndex+c)},_animateZoom:function(c){var h=this._map._latLngToNewLayerPoint(this._latlng,c.zoom,c.center).round();this._setPos(h)},_initInteraction:function(){if(this.options.interactive&&(Xe(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),lu)){var c=this.options.draggable;this.dragging&&(c=this.dragging.enabled(),this.dragging.disable()),this.dragging=new lu(this),c&&this.dragging.enable()}},setOpacity:function(c){return this.options.opacity=c,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var c=this.options.opacity;this._icon&&yi(this._icon,c),this._shadow&&yi(this._shadow,c)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var c=this._map;if(c){var h=this.options.icon.options,g=h.iconSize?K(h.iconSize):K(0,0),_=h.iconAnchor?K(h.iconAnchor):K(0,0);c.panInside(this._latlng,{paddingTopLeft:_,paddingBottomRight:g.subtract(_)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function L$(c,h){return new Im(c,h)}var fa=dt.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(c){this._renderer=c.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(c){return y(this,c),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&c&&Object.prototype.hasOwnProperty.call(c,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Sm=fa.extend({options:{fill:!0,radius:10},initialize:function(c,h){y(this,h),this._latlng=me(c),this._radius=this.options.radius},setLatLng:function(c){var h=this._latlng;return this._latlng=me(c),this.redraw(),this.fire("move",{oldLatLng:h,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(c){return this.options.radius=this._radius=c,this.redraw()},getRadius:function(){return this._radius},setStyle:function(c){var h=c&&c.radius||this._radius;return fa.prototype.setStyle.call(this,c),this.setRadius(h),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var c=this._radius,h=this._radiusY||c,g=this._clickTolerance(),_=[c+g,h+g];this._pxBounds=new ne(this._point.subtract(_),this._point.add(_))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(c){return c.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function O$(c,h){return new Sm(c,h)}var cE=Sm.extend({initialize:function(c,h,g){if(typeof h=="number"&&(h=t({},g,{radius:h})),y(this,h),this._latlng=me(c),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(c){return this._mRadius=c,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var c=[this._radius,this._radiusY||this._radius];return new oe(this._map.layerPointToLatLng(this._point.subtract(c)),this._map.layerPointToLatLng(this._point.add(c)))},setStyle:fa.prototype.setStyle,_project:function(){var c=this._latlng.lng,h=this._latlng.lat,g=this._map,_=g.options.crs;if(_.distance===Ge.distance){var b=Math.PI/180,k=this._mRadius/Ge.R/b,z=g.project([h+k,c]),Z=g.project([h-k,c]),X=z.add(Z).divideBy(2),le=g.unproject(X).lat,Ce=Math.acos((Math.cos(k*b)-Math.sin(h*b)*Math.sin(le*b))/(Math.cos(h*b)*Math.cos(le*b)))/b;(isNaN(Ce)||Ce===0)&&(Ce=k/Math.cos(Math.PI/180*h)),this._point=X.subtract(g.getPixelOrigin()),this._radius=isNaN(Ce)?0:X.x-g.project([le,c-Ce]).x,this._radiusY=X.y-z.y}else{var je=_.unproject(_.project(this._latlng).subtract([this._mRadius,0]));this._point=g.latLngToLayerPoint(this._latlng),this._radius=this._point.x-g.latLngToLayerPoint(je).x}this._updateBounds()}});function N$(c,h,g){return new cE(c,h,g)}var po=fa.extend({options:{smoothFactor:1,noClip:!1},initialize:function(c,h){y(this,h),this._setLatLngs(c)},getLatLngs:function(){return this._latlngs},setLatLngs:function(c){return this._setLatLngs(c),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(c){for(var h=1/0,g=null,_=Nn,b,k,z=0,Z=this._parts.length;z<Z;z++)for(var X=this._parts[z],le=1,Ce=X.length;le<Ce;le++){b=X[le-1],k=X[le];var je=_(c,b,k,!0);je<h&&(h=je,g=_(c,b,k))}return g&&(g.distance=Math.sqrt(h)),g},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return fo(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(c,h){return h=h||this._defaultShape(),c=me(c),h.push(c),this._bounds.extend(c),this.redraw()},_setLatLngs:function(c){this._bounds=new oe,this._latlngs=this._convertLatLngs(c)},_defaultShape:function(){return vi(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(c){for(var h=[],g=vi(c),_=0,b=c.length;_<b;_++)g?(h[_]=me(c[_]),this._bounds.extend(h[_])):h[_]=this._convertLatLngs(c[_]);return h},_project:function(){var c=new ne;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,c),this._bounds.isValid()&&c.isValid()&&(this._rawPxBounds=c,this._updateBounds())},_updateBounds:function(){var c=this._clickTolerance(),h=new q(c,c);this._rawPxBounds&&(this._pxBounds=new ne([this._rawPxBounds.min.subtract(h),this._rawPxBounds.max.add(h)]))},_projectLatlngs:function(c,h,g){var _=c[0]instanceof fe,b=c.length,k,z;if(_){for(z=[],k=0;k<b;k++)z[k]=this._map.latLngToLayerPoint(c[k]),g.extend(z[k]);h.push(z)}else for(k=0;k<b;k++)this._projectLatlngs(c[k],h,g)},_clipPoints:function(){var c=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(c))){if(this.options.noClip){this._parts=this._rings;return}var h=this._parts,g,_,b,k,z,Z,X;for(g=0,b=0,k=this._rings.length;g<k;g++)for(X=this._rings[g],_=0,z=X.length;_<z-1;_++)Z=Ph(X[_],X[_+1],c,_,!0),Z&&(h[b]=h[b]||[],h[b].push(Z[0]),(Z[1]!==X[_+1]||_===z-2)&&(h[b].push(Z[1]),b++))}},_simplifyPoints:function(){for(var c=this._parts,h=this.options.smoothFactor,g=0,_=c.length;g<_;g++)c[g]=ru(c[g],h)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(c,h){var g,_,b,k,z,Z,X=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(c))return!1;for(g=0,k=this._parts.length;g<k;g++)for(Z=this._parts[g],_=0,z=Z.length,b=z-1;_<z;b=_++)if(!(!h&&_===0)&&Ah(c,Z[b],Z[_])<=X)return!0;return!1}});function F$(c,h){return new po(c,h)}po._flat=Rh;var cu=po.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ch(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(c){var h=po.prototype._convertLatLngs.call(this,c),g=h.length;return g>=2&&h[0]instanceof fe&&h[0].equals(h[g-1])&&h.pop(),h},_setLatLngs:function(c){po.prototype._setLatLngs.call(this,c),vi(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return vi(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var c=this._renderer._bounds,h=this.options.weight,g=new q(h,h);if(c=new ne(c.min.subtract(g),c.max.add(g)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(c))){if(this.options.noClip){this._parts=this._rings;return}for(var _=0,b=this._rings.length,k;_<b;_++)k=ha(this._rings[_],c,!0),k.length&&this._parts.push(k)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(c){var h=!1,g,_,b,k,z,Z,X,le;if(!this._pxBounds||!this._pxBounds.contains(c))return!1;for(k=0,X=this._parts.length;k<X;k++)for(g=this._parts[k],z=0,le=g.length,Z=le-1;z<le;Z=z++)_=g[z],b=g[Z],_.y>c.y!=b.y>c.y&&c.x<(b.x-_.x)*(c.y-_.y)/(b.y-_.y)+_.x&&(h=!h);return h||po.prototype._containsPoint.call(this,c,!0)}});function V$(c,h){return new cu(c,h)}var mo=en.extend({initialize:function(c,h){y(this,h),this._layers={},c&&this.addData(c)},addData:function(c){var h=C(c)?c:c.features,g,_,b;if(h){for(g=0,_=h.length;g<_;g++)b=h[g],(b.geometries||b.geometry||b.features||b.coordinates)&&this.addData(b);return this}var k=this.options;if(k.filter&&!k.filter(c))return this;var z=Cm(c,k);return z?(z.feature=Dm(c),z.defaultOptions=z.options,this.resetStyle(z),k.onEachFeature&&k.onEachFeature(c,z),this.addLayer(z)):this},resetStyle:function(c){return c===void 0?this.eachLayer(this.resetStyle,this):(c.options=t({},c.defaultOptions),this._setLayerStyle(c,this.options.style),this)},setStyle:function(c){return this.eachLayer(function(h){this._setLayerStyle(h,c)},this)},_setLayerStyle:function(c,h){c.setStyle&&(typeof h=="function"&&(h=h(c.feature)),c.setStyle(h))}});function Cm(c,h){var g=c.type==="Feature"?c.geometry:c,_=g?g.coordinates:null,b=[],k=h&&h.pointToLayer,z=h&&h.coordsToLatLng||uE,Z,X,le,Ce;if(!_&&!g)return null;switch(g.type){case"Point":return Z=z(_),g1(k,c,Z,h);case"MultiPoint":for(le=0,Ce=_.length;le<Ce;le++)Z=z(_[le]),b.push(g1(k,c,Z,h));return new en(b);case"LineString":case"MultiLineString":return X=xm(_,g.type==="LineString"?0:1,z),new po(X,h);case"Polygon":case"MultiPolygon":return X=xm(_,g.type==="Polygon"?1:2,z),new cu(X,h);case"GeometryCollection":for(le=0,Ce=g.geometries.length;le<Ce;le++){var je=Cm({geometry:g.geometries[le],type:"Feature",properties:c.properties},h);je&&b.push(je)}return new en(b);case"FeatureCollection":for(le=0,Ce=g.features.length;le<Ce;le++){var pt=Cm(g.features[le],h);pt&&b.push(pt)}return new en(b);default:throw new Error("Invalid GeoJSON object.")}}function g1(c,h,g,_){return c?c(h,g):new Im(g,_&&_.markersInheritOptions&&_)}function uE(c){return new fe(c[1],c[0],c[2])}function xm(c,h,g){for(var _=[],b=0,k=c.length,z;b<k;b++)z=h?xm(c[b],h-1,g):(g||uE)(c[b]),_.push(z);return _}function dE(c,h){return c=me(c),c.alt!==void 0?[d(c.lng,h),d(c.lat,h),d(c.alt,h)]:[d(c.lng,h),d(c.lat,h)]}function Am(c,h,g,_){for(var b=[],k=0,z=c.length;k<z;k++)b.push(h?Am(c[k],vi(c[k])?0:h-1,g,_):dE(c[k],_));return!h&&g&&b.length>0&&b.push(b[0].slice()),b}function uu(c,h){return c.feature?t({},c.feature,{geometry:h}):Dm(h)}function Dm(c){return c.type==="Feature"||c.type==="FeatureCollection"?c:{type:"Feature",properties:{},geometry:c}}var hE={toGeoJSON:function(c){return uu(this,{type:"Point",coordinates:dE(this.getLatLng(),c)})}};Im.include(hE),cE.include(hE),Sm.include(hE),po.include({toGeoJSON:function(c){var h=!vi(this._latlngs),g=Am(this._latlngs,h?1:0,!1,c);return uu(this,{type:(h?"Multi":"")+"LineString",coordinates:g})}}),cu.include({toGeoJSON:function(c){var h=!vi(this._latlngs),g=h&&!vi(this._latlngs[0]),_=Am(this._latlngs,g?2:h?1:0,!0,c);return h||(_=[_]),uu(this,{type:(g?"Multi":"")+"Polygon",coordinates:_})}}),an.include({toMultiPoint:function(c){var h=[];return this.eachLayer(function(g){h.push(g.toGeoJSON(c).geometry.coordinates)}),uu(this,{type:"MultiPoint",coordinates:h})},toGeoJSON:function(c){var h=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(h==="MultiPoint")return this.toMultiPoint(c);var g=h==="GeometryCollection",_=[];return this.eachLayer(function(b){if(b.toGeoJSON){var k=b.toGeoJSON(c);if(g)_.push(k.geometry);else{var z=Dm(k);z.type==="FeatureCollection"?_.push.apply(_,z.features):_.push(z)}}}),g?uu(this,{geometries:_,type:"GeometryCollection"}):{type:"FeatureCollection",features:_}}});function y1(c,h){return new mo(c,h)}var B$=y1,Pm=dt.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(c,h,g){this._url=c,this._bounds=ie(h),y(this,g)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Xe(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Jt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(c){return this.options.opacity=c,this._image&&this._updateOpacity(),this},setStyle:function(c){return c.opacity&&this.setOpacity(c.opacity),this},bringToFront:function(){return this._map&&gs(this._image),this},bringToBack:function(){return this._map&&ys(this._image),this},setUrl:function(c){return this._url=c,this._image&&(this._image.src=c),this},setBounds:function(c){return this._bounds=ie(c),this._map&&this._reset(),this},getEvents:function(){var c={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(c.zoomanim=this._animateZoom),c},setZIndex:function(c){return this.options.zIndex=c,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var c=this._url.tagName==="IMG",h=this._image=c?this._url:It("img");if(Xe(h,"leaflet-image-layer"),this._zoomAnimated&&Xe(h,"leaflet-zoom-animated"),this.options.className&&Xe(h,this.options.className),h.onselectstart=u,h.onmousemove=u,h.onload=r(this.fire,this,"load"),h.onerror=r(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(h.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),c){this._url=h.src;return}h.src=this._url,h.alt=this.options.alt},_animateZoom:function(c){var h=this._map.getZoomScale(c.zoom),g=this._map._latLngBoundsToNewLayerBounds(this._bounds,c.zoom,c.center).min;ei(this._image,g,h)},_reset:function(){var c=this._image,h=new ne(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),g=h.getSize();rn(c,h.min),c.style.width=g.x+"px",c.style.height=g.y+"px"},_updateOpacity:function(){yi(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var c=this.options.errorOverlayUrl;c&&this._url!==c&&(this._url=c,this._image.src=c)},getCenter:function(){return this._bounds.getCenter()}}),U$=function(c,h,g){return new Pm(c,h,g)},v1=Pm.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var c=this._url.tagName==="VIDEO",h=this._image=c?this._url:It("video");if(Xe(h,"leaflet-image-layer"),this._zoomAnimated&&Xe(h,"leaflet-zoom-animated"),this.options.className&&Xe(h,this.options.className),h.onselectstart=u,h.onmousemove=u,h.onloadeddata=r(this.fire,this,"load"),c){for(var g=h.getElementsByTagName("source"),_=[],b=0;b<g.length;b++)_.push(g[b].src);this._url=g.length>0?_:[h.src];return}C(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(h.style,"objectFit")&&(h.style.objectFit="fill"),h.autoplay=!!this.options.autoplay,h.loop=!!this.options.loop,h.muted=!!this.options.muted,h.playsInline=!!this.options.playsInline;for(var k=0;k<this._url.length;k++){var z=It("source");z.src=this._url[k],h.appendChild(z)}}});function $$(c,h,g){return new v1(c,h,g)}var _1=Pm.extend({_initImage:function(){var c=this._image=this._url;Xe(c,"leaflet-image-layer"),this._zoomAnimated&&Xe(c,"leaflet-zoom-animated"),this.options.className&&Xe(c,this.options.className),c.onselectstart=u,c.onmousemove=u}});function j$(c,h,g){return new _1(c,h,g)}var Ts=dt.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(c,h){c&&(c instanceof fe||C(c))?(this._latlng=me(c),y(this,h)):(y(this,c),this._source=h),this.options.content&&(this._content=this.options.content)},openOn:function(c){return c=arguments.length?c:this._source._map,c.hasLayer(this)||c.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(c){return this._map?this.close():(arguments.length?this._source=c:c=this._source,this._prepareOpen(),this.openOn(c._map)),this},onAdd:function(c){this._zoomAnimated=c._zoomAnimated,this._container||this._initLayout(),c._fadeAnimated&&yi(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),c._fadeAnimated&&yi(this._container,1),this.bringToFront(),this.options.interactive&&(Xe(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(c){c._fadeAnimated?(yi(this._container,0),this._removeTimeout=setTimeout(r(Jt,void 0,this._container),200)):Jt(this._container),this.options.interactive&&(un(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(c){return this._latlng=me(c),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(c){return this._content=c,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var c={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(c.zoomanim=this._animateZoom),c},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&gs(this._container),this},bringToBack:function(){return this._map&&ys(this._container),this},_prepareOpen:function(c){var h=this._source;if(!h._map)return!1;if(h instanceof en){h=null;var g=this._source._layers;for(var _ in g)if(g[_]._map){h=g[_];break}if(!h)return!1;this._source=h}if(!c)if(h.getCenter)c=h.getCenter();else if(h.getLatLng)c=h.getLatLng();else if(h.getBounds)c=h.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(c),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var c=this._contentNode,h=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof h=="string")c.innerHTML=h;else{for(;c.hasChildNodes();)c.removeChild(c.firstChild);c.appendChild(h)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var c=this._map.latLngToLayerPoint(this._latlng),h=K(this.options.offset),g=this._getAnchor();this._zoomAnimated?rn(this._container,c.add(g)):h=h.add(c).add(g);var _=this._containerBottom=-h.y,b=this._containerLeft=-Math.round(this._containerWidth/2)+h.x;this._container.style.bottom=_+"px",this._container.style.left=b+"px"}},_getAnchor:function(){return[0,0]}});yt.include({_initOverlay:function(c,h,g,_){var b=h;return b instanceof c||(b=new c(_).setContent(h)),g&&b.setLatLng(g),b}}),dt.include({_initOverlay:function(c,h,g,_){var b=g;return b instanceof c?(y(b,_),b._source=this):(b=h&&!_?h:new c(_,this),b.setContent(g)),b}});var Rm=Ts.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(c){return c=arguments.length?c:this._source._map,!c.hasLayer(this)&&c._popup&&c._popup.options.autoClose&&c.removeLayer(c._popup),c._popup=this,Ts.prototype.openOn.call(this,c)},onAdd:function(c){Ts.prototype.onAdd.call(this,c),c.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof fa||this._source.on("preclick",oi))},onRemove:function(c){Ts.prototype.onRemove.call(this,c),c.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof fa||this._source.off("preclick",oi))},getEvents:function(){var c=Ts.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(c.preclick=this.close),this.options.keepInView&&(c.moveend=this._adjustPan),c},_initLayout:function(){var c="leaflet-popup",h=this._container=It("div",c+" "+(this.options.className||"")+" leaflet-zoom-animated"),g=this._wrapper=It("div",c+"-content-wrapper",h);if(this._contentNode=It("div",c+"-content",g),xl(h),bh(this._contentNode),Ye(h,"contextmenu",oi),this._tipContainer=It("div",c+"-tip-container",h),this._tip=It("div",c+"-tip",this._tipContainer),this.options.closeButton){var _=this._closeButton=It("a",c+"-close-button",h);_.setAttribute("role","button"),_.setAttribute("aria-label","Close popup"),_.href="#close",_.innerHTML='<span aria-hidden="true">&#215;</span>',Ye(_,"click",function(b){dn(b),this.close()},this)}},_updateLayout:function(){var c=this._contentNode,h=c.style;h.width="",h.whiteSpace="nowrap";var g=c.offsetWidth;g=Math.min(g,this.options.maxWidth),g=Math.max(g,this.options.minWidth),h.width=g+1+"px",h.whiteSpace="",h.height="";var _=c.offsetHeight,b=this.options.maxHeight,k="leaflet-popup-scrolled";b&&_>b?(h.height=b+"px",Xe(c,k)):un(c,k),this._containerWidth=this._container.offsetWidth},_animateZoom:function(c){var h=this._map._latLngToNewLayerPoint(this._latlng,c.zoom,c.center),g=this._getAnchor();rn(this._container,h.add(g))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var c=this._map,h=parseInt(bl(this._container,"marginBottom"),10)||0,g=this._container.offsetHeight+h,_=this._containerWidth,b=new q(this._containerLeft,-g-this._containerBottom);b._add(br(this._container));var k=c.layerPointToContainerPoint(b),z=K(this.options.autoPanPadding),Z=K(this.options.autoPanPaddingTopLeft||z),X=K(this.options.autoPanPaddingBottomRight||z),le=c.getSize(),Ce=0,je=0;k.x+_+X.x>le.x&&(Ce=k.x+_-le.x+X.x),k.x-Ce-Z.x<0&&(Ce=k.x-Z.x),k.y+g+X.y>le.y&&(je=k.y+g-le.y+X.y),k.y-je-Z.y<0&&(je=k.y-Z.y),(Ce||je)&&(this.options.keepInView&&(this._autopanning=!0),c.fire("autopanstart").panBy([Ce,je]))}},_getAnchor:function(){return K(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),G$=function(c,h){return new Rm(c,h)};yt.mergeOptions({closePopupOnClick:!0}),yt.include({openPopup:function(c,h,g){return this._initOverlay(Rm,c,h,g).openOn(this),this},closePopup:function(c){return c=arguments.length?c:this._popup,c&&c.close(),this}}),dt.include({bindPopup:function(c,h){return this._popup=this._initOverlay(Rm,this._popup,c,h),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(c){return this._popup&&(this instanceof en||(this._popup._source=this),this._popup._prepareOpen(c||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(c){return this._popup&&this._popup.setContent(c),this},getPopup:function(){return this._popup},_openPopup:function(c){if(!(!this._popup||!this._map)){Ir(c);var h=c.layer||c.target;if(this._popup._source===h&&!(h instanceof fa)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(c.latlng);return}this._popup._source=h,this.openPopup(c.latlng)}},_movePopup:function(c){this._popup.setLatLng(c.latlng)},_onKeyPress:function(c){c.originalEvent.keyCode===13&&this._openPopup(c)}});var Mm=Ts.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(c){Ts.prototype.onAdd.call(this,c),this.setOpacity(this.options.opacity),c.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(c){Ts.prototype.onRemove.call(this,c),c.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var c=Ts.prototype.getEvents.call(this);return this.options.permanent||(c.preclick=this.close),c},_initLayout:function(){var c="leaflet-tooltip",h=c+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=It("div",h),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+o(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(c){var h,g,_=this._map,b=this._container,k=_.latLngToContainerPoint(_.getCenter()),z=_.layerPointToContainerPoint(c),Z=this.options.direction,X=b.offsetWidth,le=b.offsetHeight,Ce=K(this.options.offset),je=this._getAnchor();Z==="top"?(h=X/2,g=le):Z==="bottom"?(h=X/2,g=0):Z==="center"?(h=X/2,g=le/2):Z==="right"?(h=0,g=le/2):Z==="left"?(h=X,g=le/2):z.x<k.x?(Z="right",h=0,g=le/2):(Z="left",h=X+(Ce.x+je.x)*2,g=le/2),c=c.subtract(K(h,g,!0)).add(Ce).add(je),un(b,"leaflet-tooltip-right"),un(b,"leaflet-tooltip-left"),un(b,"leaflet-tooltip-top"),un(b,"leaflet-tooltip-bottom"),Xe(b,"leaflet-tooltip-"+Z),rn(b,c)},_updatePosition:function(){var c=this._map.latLngToLayerPoint(this._latlng);this._setPosition(c)},setOpacity:function(c){this.options.opacity=c,this._container&&yi(this._container,c)},_animateZoom:function(c){var h=this._map._latLngToNewLayerPoint(this._latlng,c.zoom,c.center);this._setPosition(h)},_getAnchor:function(){return K(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),z$=function(c,h){return new Mm(c,h)};yt.include({openTooltip:function(c,h,g){return this._initOverlay(Mm,c,h,g).openOn(this),this},closeTooltip:function(c){return c.close(),this}}),dt.include({bindTooltip:function(c,h){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Mm,this._tooltip,c,h),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(c){if(!(!c&&this._tooltipHandlersAdded)){var h=c?"off":"on",g={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?g.add=this._openTooltip:(g.mouseover=this._openTooltip,g.mouseout=this.closeTooltip,g.click=this._openTooltip,this._map?this._addFocusListeners():g.add=this._addFocusListeners),this._tooltip.options.sticky&&(g.mousemove=this._moveTooltip),this[h](g),this._tooltipHandlersAdded=!c}},openTooltip:function(c){return this._tooltip&&(this instanceof en||(this._tooltip._source=this),this._tooltip._prepareOpen(c)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(c){return this._tooltip&&this._tooltip.setContent(c),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(c){var h=typeof c.getElement=="function"&&c.getElement();h&&(Ye(h,"focus",function(){this._tooltip._source=c,this.openTooltip()},this),Ye(h,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(c){var h=typeof c.getElement=="function"&&c.getElement();h&&h.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(c){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var h=this;this._map.once("moveend",function(){h._openOnceFlag=!1,h._openTooltip(c)});return}this._tooltip._source=c.layer||c.target,this.openTooltip(this._tooltip.options.sticky?c.latlng:void 0)}},_moveTooltip:function(c){var h=c.latlng,g,_;this._tooltip.options.sticky&&c.originalEvent&&(g=this._map.mouseEventToContainerPoint(c.originalEvent),_=this._map.containerPointToLayerPoint(g),h=this._map.layerPointToLatLng(_)),this._tooltip.setLatLng(h)}});var E1=Ji.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(c){var h=c&&c.tagName==="DIV"?c:document.createElement("div"),g=this.options;if(g.html instanceof Element?(Il(h),h.appendChild(g.html)):h.innerHTML=g.html!==!1?g.html:"",g.bgPos){var _=K(g.bgPos);h.style.backgroundPosition=-_.x+"px "+-_.y+"px"}return this._setIconStyles(h,"icon"),h},createShadow:function(){return null}});function H$(c){return new E1(c)}Ji.Default=Es;var Mh=dt.extend({options:{tileSize:256,opacity:1,updateWhenIdle:ke.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(c){y(this,c)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(c){c._addZoomLimit(this)},onRemove:function(c){this._removeAllTiles(),Jt(this._container),c._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(gs(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(ys(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(c){return this.options.opacity=c,this._updateOpacity(),this},setZIndex:function(c){return this.options.zIndex=c,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var c=this._clampZoom(this._map.getZoom());c!==this._tileZoom&&(this._tileZoom=c,this._updateLevels()),this._update()}return this},getEvents:function(){var c={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=a(this._onMoveEnd,this.options.updateInterval,this)),c.move=this._onMove),this._zoomAnimated&&(c.zoomanim=this._animateZoom),c},createTile:function(){return document.createElement("div")},getTileSize:function(){var c=this.options.tileSize;return c instanceof q?c:new q(c,c)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(c){for(var h=this.getPane().children,g=-c(-1/0,1/0),_=0,b=h.length,k;_<b;_++)k=h[_].style.zIndex,h[_]!==this._container&&k&&(g=c(g,+k));isFinite(g)&&(this.options.zIndex=g+c(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!ke.ielt9){yi(this._container,this.options.opacity);var c=+new Date,h=!1,g=!1;for(var _ in this._tiles){var b=this._tiles[_];if(!(!b.current||!b.loaded)){var k=Math.min(1,(c-b.loaded)/200);yi(b.el,k),k<1?h=!0:(b.active?g=!0:this._onOpaqueTile(b),b.active=!0)}}g&&!this._noPrune&&this._pruneTiles(),h&&(M(this._fadeFrame),this._fadeFrame=R(this._updateOpacity,this))}},_onOpaqueTile:u,_initContainer:function(){this._container||(this._container=It("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var c=this._tileZoom,h=this.options.maxZoom;if(c!==void 0){for(var g in this._levels)g=Number(g),this._levels[g].el.children.length||g===c?(this._levels[g].el.style.zIndex=h-Math.abs(c-g),this._onUpdateLevel(g)):(Jt(this._levels[g].el),this._removeTilesAtZoom(g),this._onRemoveLevel(g),delete this._levels[g]);var _=this._levels[c],b=this._map;return _||(_=this._levels[c]={},_.el=It("div","leaflet-tile-container leaflet-zoom-animated",this._container),_.el.style.zIndex=h,_.origin=b.project(b.unproject(b.getPixelOrigin()),c).round(),_.zoom=c,this._setZoomTransform(_,b.getCenter(),b.getZoom()),u(_.el.offsetWidth),this._onCreateLevel(_)),this._level=_,_}},_onUpdateLevel:u,_onRemoveLevel:u,_onCreateLevel:u,_pruneTiles:function(){if(this._map){var c,h,g=this._map.getZoom();if(g>this.options.maxZoom||g<this.options.minZoom){this._removeAllTiles();return}for(c in this._tiles)h=this._tiles[c],h.retain=h.current;for(c in this._tiles)if(h=this._tiles[c],h.current&&!h.active){var _=h.coords;this._retainParent(_.x,_.y,_.z,_.z-5)||this._retainChildren(_.x,_.y,_.z,_.z+2)}for(c in this._tiles)this._tiles[c].retain||this._removeTile(c)}},_removeTilesAtZoom:function(c){for(var h in this._tiles)this._tiles[h].coords.z===c&&this._removeTile(h)},_removeAllTiles:function(){for(var c in this._tiles)this._removeTile(c)},_invalidateAll:function(){for(var c in this._levels)Jt(this._levels[c].el),this._onRemoveLevel(Number(c)),delete this._levels[c];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(c,h,g,_){var b=Math.floor(c/2),k=Math.floor(h/2),z=g-1,Z=new q(+b,+k);Z.z=+z;var X=this._tileCoordsToKey(Z),le=this._tiles[X];return le&&le.active?(le.retain=!0,!0):(le&&le.loaded&&(le.retain=!0),z>_?this._retainParent(b,k,z,_):!1)},_retainChildren:function(c,h,g,_){for(var b=2*c;b<2*c+2;b++)for(var k=2*h;k<2*h+2;k++){var z=new q(b,k);z.z=g+1;var Z=this._tileCoordsToKey(z),X=this._tiles[Z];if(X&&X.active){X.retain=!0;continue}else X&&X.loaded&&(X.retain=!0);g+1<_&&this._retainChildren(b,k,g+1,_)}},_resetView:function(c){var h=c&&(c.pinch||c.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),h,h)},_animateZoom:function(c){this._setView(c.center,c.zoom,!0,c.noUpdate)},_clampZoom:function(c){var h=this.options;return h.minNativeZoom!==void 0&&c<h.minNativeZoom?h.minNativeZoom:h.maxNativeZoom!==void 0&&h.maxNativeZoom<c?h.maxNativeZoom:c},_setView:function(c,h,g,_){var b=Math.round(h);this.options.maxZoom!==void 0&&b>this.options.maxZoom||this.options.minZoom!==void 0&&b<this.options.minZoom?b=void 0:b=this._clampZoom(b);var k=this.options.updateWhenZooming&&b!==this._tileZoom;(!_||k)&&(this._tileZoom=b,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),b!==void 0&&this._update(c),g||this._pruneTiles(),this._noPrune=!!g),this._setZoomTransforms(c,h)},_setZoomTransforms:function(c,h){for(var g in this._levels)this._setZoomTransform(this._levels[g],c,h)},_setZoomTransform:function(c,h,g){var _=this._map.getZoomScale(g,c.zoom),b=c.origin.multiplyBy(_).subtract(this._map._getNewPixelOrigin(h,g)).round();ke.any3d?ei(c.el,b,_):rn(c.el,b)},_resetGrid:function(){var c=this._map,h=c.options.crs,g=this._tileSize=this.getTileSize(),_=this._tileZoom,b=this._map.getPixelWorldBounds(this._tileZoom);b&&(this._globalTileRange=this._pxBoundsToTileRange(b)),this._wrapX=h.wrapLng&&!this.options.noWrap&&[Math.floor(c.project([0,h.wrapLng[0]],_).x/g.x),Math.ceil(c.project([0,h.wrapLng[1]],_).x/g.y)],this._wrapY=h.wrapLat&&!this.options.noWrap&&[Math.floor(c.project([h.wrapLat[0],0],_).y/g.x),Math.ceil(c.project([h.wrapLat[1],0],_).y/g.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(c){var h=this._map,g=h._animatingZoom?Math.max(h._animateToZoom,h.getZoom()):h.getZoom(),_=h.getZoomScale(g,this._tileZoom),b=h.project(c,this._tileZoom).floor(),k=h.getSize().divideBy(_*2);return new ne(b.subtract(k),b.add(k))},_update:function(c){var h=this._map;if(h){var g=this._clampZoom(h.getZoom());if(c===void 0&&(c=h.getCenter()),this._tileZoom!==void 0){var _=this._getTiledPixelBounds(c),b=this._pxBoundsToTileRange(_),k=b.getCenter(),z=[],Z=this.options.keepBuffer,X=new ne(b.getBottomLeft().subtract([Z,-Z]),b.getTopRight().add([Z,-Z]));if(!(isFinite(b.min.x)&&isFinite(b.min.y)&&isFinite(b.max.x)&&isFinite(b.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var le in this._tiles){var Ce=this._tiles[le].coords;(Ce.z!==this._tileZoom||!X.contains(new q(Ce.x,Ce.y)))&&(this._tiles[le].current=!1)}if(Math.abs(g-this._tileZoom)>1){this._setView(c,g);return}for(var je=b.min.y;je<=b.max.y;je++)for(var pt=b.min.x;pt<=b.max.x;pt++){var _i=new q(pt,je);if(_i.z=this._tileZoom,!!this._isValidTile(_i)){var Gn=this._tiles[this._tileCoordsToKey(_i)];Gn?Gn.current=!0:z.push(_i)}}if(z.sort(function(Li,hu){return Li.distanceTo(k)-hu.distanceTo(k)}),z.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Sr=document.createDocumentFragment();for(pt=0;pt<z.length;pt++)this._addTile(z[pt],Sr);this._level.el.appendChild(Sr)}}}},_isValidTile:function(c){var h=this._map.options.crs;if(!h.infinite){var g=this._globalTileRange;if(!h.wrapLng&&(c.x<g.min.x||c.x>g.max.x)||!h.wrapLat&&(c.y<g.min.y||c.y>g.max.y))return!1}if(!this.options.bounds)return!0;var _=this._tileCoordsToBounds(c);return ie(this.options.bounds).overlaps(_)},_keyToBounds:function(c){return this._tileCoordsToBounds(this._keyToTileCoords(c))},_tileCoordsToNwSe:function(c){var h=this._map,g=this.getTileSize(),_=c.scaleBy(g),b=_.add(g),k=h.unproject(_,c.z),z=h.unproject(b,c.z);return[k,z]},_tileCoordsToBounds:function(c){var h=this._tileCoordsToNwSe(c),g=new oe(h[0],h[1]);return this.options.noWrap||(g=this._map.wrapLatLngBounds(g)),g},_tileCoordsToKey:function(c){return c.x+":"+c.y+":"+c.z},_keyToTileCoords:function(c){var h=c.split(":"),g=new q(+h[0],+h[1]);return g.z=+h[2],g},_removeTile:function(c){var h=this._tiles[c];h&&(Jt(h.el),delete this._tiles[c],this.fire("tileunload",{tile:h.el,coords:this._keyToTileCoords(c)}))},_initTile:function(c){Xe(c,"leaflet-tile");var h=this.getTileSize();c.style.width=h.x+"px",c.style.height=h.y+"px",c.onselectstart=u,c.onmousemove=u,ke.ielt9&&this.options.opacity<1&&yi(c,this.options.opacity)},_addTile:function(c,h){var g=this._getTilePos(c),_=this._tileCoordsToKey(c),b=this.createTile(this._wrapCoords(c),r(this._tileReady,this,c));this._initTile(b),this.createTile.length<2&&R(r(this._tileReady,this,c,null,b)),rn(b,g),this._tiles[_]={el:b,coords:c,current:!0},h.appendChild(b),this.fire("tileloadstart",{tile:b,coords:c})},_tileReady:function(c,h,g){h&&this.fire("tileerror",{error:h,tile:g,coords:c});var _=this._tileCoordsToKey(c);g=this._tiles[_],g&&(g.loaded=+new Date,this._map._fadeAnimated?(yi(g.el,0),M(this._fadeFrame),this._fadeFrame=R(this._updateOpacity,this)):(g.active=!0,this._pruneTiles()),h||(Xe(g.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:g.el,coords:c})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),ke.ielt9||!this._map._fadeAnimated?R(this._pruneTiles,this):setTimeout(r(this._pruneTiles,this),250)))},_getTilePos:function(c){return c.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(c){var h=new q(this._wrapX?l(c.x,this._wrapX):c.x,this._wrapY?l(c.y,this._wrapY):c.y);return h.z=c.z,h},_pxBoundsToTileRange:function(c){var h=this.getTileSize();return new ne(c.min.unscaleBy(h).floor(),c.max.unscaleBy(h).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var c in this._tiles)if(!this._tiles[c].loaded)return!1;return!0}});function q$(c){return new Mh(c)}var du=Mh.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(c,h){this._url=c,h=y(this,h),h.detectRetina&&ke.retina&&h.maxZoom>0?(h.tileSize=Math.floor(h.tileSize/2),h.zoomReverse?(h.zoomOffset--,h.minZoom=Math.min(h.maxZoom,h.minZoom+1)):(h.zoomOffset++,h.maxZoom=Math.max(h.minZoom,h.maxZoom-1)),h.minZoom=Math.max(0,h.minZoom)):h.zoomReverse?h.minZoom=Math.min(h.maxZoom,h.minZoom):h.maxZoom=Math.max(h.minZoom,h.maxZoom),typeof h.subdomains=="string"&&(h.subdomains=h.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(c,h){return this._url===c&&h===void 0&&(h=!0),this._url=c,h||this.redraw(),this},createTile:function(c,h){var g=document.createElement("img");return Ye(g,"load",r(this._tileOnLoad,this,h,g)),Ye(g,"error",r(this._tileOnError,this,h,g)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(g.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(g.referrerPolicy=this.options.referrerPolicy),g.alt="",g.src=this.getTileUrl(c),g},getTileUrl:function(c){var h={r:ke.retina?"@2x":"",s:this._getSubdomain(c),x:c.x,y:c.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var g=this._globalTileRange.max.y-c.y;this.options.tms&&(h.y=g),h["-y"]=g}return T(this._url,t(h,this.options))},_tileOnLoad:function(c,h){ke.ielt9?setTimeout(r(c,this,null,h),0):c(null,h)},_tileOnError:function(c,h,g){var _=this.options.errorTileUrl;_&&h.getAttribute("src")!==_&&(h.src=_),c(g,h)},_onTileRemove:function(c){c.tile.onload=null},_getZoomForUrl:function(){var c=this._tileZoom,h=this.options.maxZoom,g=this.options.zoomReverse,_=this.options.zoomOffset;return g&&(c=h-c),c+_},_getSubdomain:function(c){var h=Math.abs(c.x+c.y)%this.options.subdomains.length;return this.options.subdomains[h]},_abortLoading:function(){var c,h;for(c in this._tiles)if(this._tiles[c].coords.z!==this._tileZoom&&(h=this._tiles[c].el,h.onload=u,h.onerror=u,!h.complete)){h.src=P;var g=this._tiles[c].coords;Jt(h),delete this._tiles[c],this.fire("tileabort",{tile:h,coords:g})}},_removeTile:function(c){var h=this._tiles[c];if(h)return h.el.setAttribute("src",P),Mh.prototype._removeTile.call(this,c)},_tileReady:function(c,h,g){if(!(!this._map||g&&g.getAttribute("src")===P))return Mh.prototype._tileReady.call(this,c,h,g)}});function T1(c,h){return new du(c,h)}var w1=du.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(c,h){this._url=c;var g=t({},this.defaultWmsParams);for(var _ in h)_ in this.options||(g[_]=h[_]);h=y(this,h);var b=h.detectRetina&&ke.retina?2:1,k=this.getTileSize();g.width=k.x*b,g.height=k.y*b,this.wmsParams=g},onAdd:function(c){this._crs=this.options.crs||c.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var h=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[h]=this._crs.code,du.prototype.onAdd.call(this,c)},getTileUrl:function(c){var h=this._tileCoordsToNwSe(c),g=this._crs,_=Ee(g.project(h[0]),g.project(h[1])),b=_.min,k=_.max,z=(this._wmsVersion>=1.3&&this._crs===J?[b.y,b.x,k.y,k.x]:[b.x,b.y,k.x,k.y]).join(","),Z=du.prototype.getTileUrl.call(this,c);return Z+v(this.wmsParams,Z,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+z},setParams:function(c,h){return t(this.wmsParams,c),h||this.redraw(),this}});function W$(c,h){return new w1(c,h)}du.WMS=w1,T1.wms=W$;var go=dt.extend({options:{padding:.1},initialize:function(c){y(this,c),o(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Xe(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var c={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(c.zoomanim=this._onAnimZoom),c},_onAnimZoom:function(c){this._updateTransform(c.center,c.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(c,h){var g=this._map.getZoomScale(h,this._zoom),_=this._map.getSize().multiplyBy(.5+this.options.padding),b=this._map.project(this._center,h),k=_.multiplyBy(-g).add(b).subtract(this._map._getNewPixelOrigin(c,h));ke.any3d?ei(this._container,k,g):rn(this._container,k)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var c in this._layers)this._layers[c]._reset()},_onZoomEnd:function(){for(var c in this._layers)this._layers[c]._project()},_updatePaths:function(){for(var c in this._layers)this._layers[c]._update()},_update:function(){var c=this.options.padding,h=this._map.getSize(),g=this._map.containerPointToLayerPoint(h.multiplyBy(-c)).round();this._bounds=new ne(g,g.add(h.multiplyBy(1+c*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),b1=go.extend({options:{tolerance:0},getEvents:function(){var c=go.prototype.getEvents.call(this);return c.viewprereset=this._onViewPreReset,c},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){go.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var c=this._container=document.createElement("canvas");Ye(c,"mousemove",this._onMouseMove,this),Ye(c,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Ye(c,"mouseout",this._handleMouseOut,this),c._leaflet_disable_events=!0,this._ctx=c.getContext("2d")},_destroyContainer:function(){M(this._redrawRequest),delete this._ctx,Jt(this._container),$t(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var c;this._redrawBounds=null;for(var h in this._layers)c=this._layers[h],c._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){go.prototype._update.call(this);var c=this._bounds,h=this._container,g=c.getSize(),_=ke.retina?2:1;rn(h,c.min),h.width=_*g.x,h.height=_*g.y,h.style.width=g.x+"px",h.style.height=g.y+"px",ke.retina&&this._ctx.scale(2,2),this._ctx.translate(-c.min.x,-c.min.y),this.fire("update")}},_reset:function(){go.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(c){this._updateDashArray(c),this._layers[o(c)]=c;var h=c._order={layer:c,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=h),this._drawLast=h,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(c){this._requestRedraw(c)},_removePath:function(c){var h=c._order,g=h.next,_=h.prev;g?g.prev=_:this._drawLast=_,_?_.next=g:this._drawFirst=g,delete c._order,delete this._layers[o(c)],this._requestRedraw(c)},_updatePath:function(c){this._extendRedrawBounds(c),c._project(),c._update(),this._requestRedraw(c)},_updateStyle:function(c){this._updateDashArray(c),this._requestRedraw(c)},_updateDashArray:function(c){if(typeof c.options.dashArray=="string"){var h=c.options.dashArray.split(/[, ]+/),g=[],_,b;for(b=0;b<h.length;b++){if(_=Number(h[b]),isNaN(_))return;g.push(_)}c.options._dashArray=g}else c.options._dashArray=c.options.dashArray},_requestRedraw:function(c){this._map&&(this._extendRedrawBounds(c),this._redrawRequest=this._redrawRequest||R(this._redraw,this))},_extendRedrawBounds:function(c){if(c._pxBounds){var h=(c.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ne,this._redrawBounds.extend(c._pxBounds.min.subtract([h,h])),this._redrawBounds.extend(c._pxBounds.max.add([h,h]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var c=this._redrawBounds;if(c){var h=c.getSize();this._ctx.clearRect(c.min.x,c.min.y,h.x,h.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var c,h=this._redrawBounds;if(this._ctx.save(),h){var g=h.getSize();this._ctx.beginPath(),this._ctx.rect(h.min.x,h.min.y,g.x,g.y),this._ctx.clip()}this._drawing=!0;for(var _=this._drawFirst;_;_=_.next)c=_.layer,(!h||c._pxBounds&&c._pxBounds.intersects(h))&&c._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(c,h){if(this._drawing){var g,_,b,k,z=c._parts,Z=z.length,X=this._ctx;if(Z){for(X.beginPath(),g=0;g<Z;g++){for(_=0,b=z[g].length;_<b;_++)k=z[g][_],X[_?"lineTo":"moveTo"](k.x,k.y);h&&X.closePath()}this._fillStroke(X,c)}}},_updateCircle:function(c){if(!(!this._drawing||c._empty())){var h=c._point,g=this._ctx,_=Math.max(Math.round(c._radius),1),b=(Math.max(Math.round(c._radiusY),1)||_)/_;b!==1&&(g.save(),g.scale(1,b)),g.beginPath(),g.arc(h.x,h.y/b,_,0,Math.PI*2,!1),b!==1&&g.restore(),this._fillStroke(g,c)}},_fillStroke:function(c,h){var g=h.options;g.fill&&(c.globalAlpha=g.fillOpacity,c.fillStyle=g.fillColor||g.color,c.fill(g.fillRule||"evenodd")),g.stroke&&g.weight!==0&&(c.setLineDash&&c.setLineDash(h.options&&h.options._dashArray||[]),c.globalAlpha=g.opacity,c.lineWidth=g.weight,c.strokeStyle=g.color,c.lineCap=g.lineCap,c.lineJoin=g.lineJoin,c.stroke())},_onClick:function(c){for(var h=this._map.mouseEventToLayerPoint(c),g,_,b=this._drawFirst;b;b=b.next)g=b.layer,g.options.interactive&&g._containsPoint(h)&&(!(c.type==="click"||c.type==="preclick")||!this._map._draggableMoved(g))&&(_=g);this._fireEvent(_?[_]:!1,c)},_onMouseMove:function(c){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var h=this._map.mouseEventToLayerPoint(c);this._handleMouseHover(c,h)}},_handleMouseOut:function(c){var h=this._hoveredLayer;h&&(un(this._container,"leaflet-interactive"),this._fireEvent([h],c,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(c,h){if(!this._mouseHoverThrottled){for(var g,_,b=this._drawFirst;b;b=b.next)g=b.layer,g.options.interactive&&g._containsPoint(h)&&(_=g);_!==this._hoveredLayer&&(this._handleMouseOut(c),_&&(Xe(this._container,"leaflet-interactive"),this._fireEvent([_],c,"mouseover"),this._hoveredLayer=_)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,c),this._mouseHoverThrottled=!0,setTimeout(r(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(c,h,g){this._map._fireDOMEvent(h,g||h.type,c)},_bringToFront:function(c){var h=c._order;if(h){var g=h.next,_=h.prev;if(g)g.prev=_;else return;_?_.next=g:g&&(this._drawFirst=g),h.prev=this._drawLast,this._drawLast.next=h,h.next=null,this._drawLast=h,this._requestRedraw(c)}},_bringToBack:function(c){var h=c._order;if(h){var g=h.next,_=h.prev;if(_)_.next=g;else return;g?g.prev=_:_&&(this._drawLast=_),h.prev=null,h.next=this._drawFirst,this._drawFirst.prev=h,this._drawFirst=h,this._requestRedraw(c)}}});function I1(c){return ke.canvas?new b1(c):null}var kh=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(c){return document.createElement("<lvml:"+c+' class="lvml">')}}catch{}return function(c){return document.createElement("<"+c+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),K$={_initContainer:function(){this._container=It("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(go.prototype._update.call(this),this.fire("update"))},_initPath:function(c){var h=c._container=kh("shape");Xe(h,"leaflet-vml-shape "+(this.options.className||"")),h.coordsize="1 1",c._path=kh("path"),h.appendChild(c._path),this._updateStyle(c),this._layers[o(c)]=c},_addPath:function(c){var h=c._container;this._container.appendChild(h),c.options.interactive&&c.addInteractiveTarget(h)},_removePath:function(c){var h=c._container;Jt(h),c.removeInteractiveTarget(h),delete this._layers[o(c)]},_updateStyle:function(c){var h=c._stroke,g=c._fill,_=c.options,b=c._container;b.stroked=!!_.stroke,b.filled=!!_.fill,_.stroke?(h||(h=c._stroke=kh("stroke")),b.appendChild(h),h.weight=_.weight+"px",h.color=_.color,h.opacity=_.opacity,_.dashArray?h.dashStyle=C(_.dashArray)?_.dashArray.join(" "):_.dashArray.replace(/( *, *)/g," "):h.dashStyle="",h.endcap=_.lineCap.replace("butt","flat"),h.joinstyle=_.lineJoin):h&&(b.removeChild(h),c._stroke=null),_.fill?(g||(g=c._fill=kh("fill")),b.appendChild(g),g.color=_.fillColor||_.color,g.opacity=_.fillOpacity):g&&(b.removeChild(g),c._fill=null)},_updateCircle:function(c){var h=c._point.round(),g=Math.round(c._radius),_=Math.round(c._radiusY||g);this._setPath(c,c._empty()?"M0 0":"AL "+h.x+","+h.y+" "+g+","+_+" 0,"+65535*360)},_setPath:function(c,h){c._path.v=h},_bringToFront:function(c){gs(c._container)},_bringToBack:function(c){ys(c._container)}},km=ke.vml?kh:ds,Lh=go.extend({_initContainer:function(){this._container=km("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=km("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Jt(this._container),$t(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){go.prototype._update.call(this);var c=this._bounds,h=c.getSize(),g=this._container;(!this._svgSize||!this._svgSize.equals(h))&&(this._svgSize=h,g.setAttribute("width",h.x),g.setAttribute("height",h.y)),rn(g,c.min),g.setAttribute("viewBox",[c.min.x,c.min.y,h.x,h.y].join(" ")),this.fire("update")}},_initPath:function(c){var h=c._path=km("path");c.options.className&&Xe(h,c.options.className),c.options.interactive&&Xe(h,"leaflet-interactive"),this._updateStyle(c),this._layers[o(c)]=c},_addPath:function(c){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(c._path),c.addInteractiveTarget(c._path)},_removePath:function(c){Jt(c._path),c.removeInteractiveTarget(c._path),delete this._layers[o(c)]},_updatePath:function(c){c._project(),c._update()},_updateStyle:function(c){var h=c._path,g=c.options;h&&(g.stroke?(h.setAttribute("stroke",g.color),h.setAttribute("stroke-opacity",g.opacity),h.setAttribute("stroke-width",g.weight),h.setAttribute("stroke-linecap",g.lineCap),h.setAttribute("stroke-linejoin",g.lineJoin),g.dashArray?h.setAttribute("stroke-dasharray",g.dashArray):h.removeAttribute("stroke-dasharray"),g.dashOffset?h.setAttribute("stroke-dashoffset",g.dashOffset):h.removeAttribute("stroke-dashoffset")):h.setAttribute("stroke","none"),g.fill?(h.setAttribute("fill",g.fillColor||g.color),h.setAttribute("fill-opacity",g.fillOpacity),h.setAttribute("fill-rule",g.fillRule||"evenodd")):h.setAttribute("fill","none"))},_updatePoly:function(c,h){this._setPath(c,hs(c._parts,h))},_updateCircle:function(c){var h=c._point,g=Math.max(Math.round(c._radius),1),_=Math.max(Math.round(c._radiusY),1)||g,b="a"+g+","+_+" 0 1,0 ",k=c._empty()?"M0 0":"M"+(h.x-g)+","+h.y+b+g*2+",0 "+b+-g*2+",0 ";this._setPath(c,k)},_setPath:function(c,h){c._path.setAttribute("d",h)},_bringToFront:function(c){gs(c._path)},_bringToBack:function(c){ys(c._path)}});ke.vml&&Lh.include(K$);function S1(c){return ke.svg||ke.vml?new Lh(c):null}yt.include({getRenderer:function(c){var h=c.options.renderer||this._getPaneRenderer(c.options.pane)||this.options.renderer||this._renderer;return h||(h=this._renderer=this._createRenderer()),this.hasLayer(h)||this.addLayer(h),h},_getPaneRenderer:function(c){if(c==="overlayPane"||c===void 0)return!1;var h=this._paneRenderers[c];return h===void 0&&(h=this._createRenderer({pane:c}),this._paneRenderers[c]=h),h},_createRenderer:function(c){return this.options.preferCanvas&&I1(c)||S1(c)}});var C1=cu.extend({initialize:function(c,h){cu.prototype.initialize.call(this,this._boundsToLatLngs(c),h)},setBounds:function(c){return this.setLatLngs(this._boundsToLatLngs(c))},_boundsToLatLngs:function(c){return c=ie(c),[c.getSouthWest(),c.getNorthWest(),c.getNorthEast(),c.getSouthEast()]}});function Y$(c,h){return new C1(c,h)}Lh.create=km,Lh.pointsToPath=hs,mo.geometryToLayer=Cm,mo.coordsToLatLng=uE,mo.coordsToLatLngs=xm,mo.latLngToCoords=dE,mo.latLngsToCoords=Am,mo.getFeature=uu,mo.asFeature=Dm,yt.mergeOptions({boxZoom:!0});var x1=Xi.extend({initialize:function(c){this._map=c,this._container=c._container,this._pane=c._panes.overlayPane,this._resetStateTimeout=0,c.on("unload",this._destroy,this)},addHooks:function(){Ye(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){$t(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Jt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(c){if(!c.shiftKey||c.which!==1&&c.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),la(),lo(),this._startPoint=this._map.mouseEventToContainerPoint(c),Ye(document,{contextmenu:Ir,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(c){this._moved||(this._moved=!0,this._box=It("div","leaflet-zoom-box",this._container),Xe(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(c);var h=new ne(this._point,this._startPoint),g=h.getSize();rn(this._box,h.min),this._box.style.width=g.x+"px",this._box.style.height=g.y+"px"},_finish:function(){this._moved&&(Jt(this._box),un(this._container,"leaflet-crosshair")),Nt(),yh(),$t(document,{contextmenu:Ir,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(c){if(!(c.which!==1&&c.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(r(this._resetState,this),0);var h=new oe(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(h).fire("boxzoomend",{boxZoomBounds:h})}},_onKeyDown:function(c){c.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});yt.addInitHook("addHandler","boxZoom",x1),yt.mergeOptions({doubleClickZoom:!0});var A1=Xi.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(c){var h=this._map,g=h.getZoom(),_=h.options.zoomDelta,b=c.originalEvent.shiftKey?g-_:g+_;h.options.doubleClickZoom==="center"?h.setZoom(b):h.setZoomAround(c.containerPoint,b)}});yt.addInitHook("addHandler","doubleClickZoom",A1),yt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var D1=Xi.extend({addHooks:function(){if(!this._draggable){var c=this._map;this._draggable=new Gr(c._mapPane,c._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),c.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),c.on("zoomend",this._onZoomEnd,this),c.whenReady(this._onZoomEnd,this))}Xe(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){un(this._map._container,"leaflet-grab"),un(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var c=this._map;if(c._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var h=ie(this._map.options.maxBounds);this._offsetLimit=Ee(this._map.latLngToContainerPoint(h.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(h.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;c.fire("movestart").fire("dragstart"),c.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(c){if(this._map.options.inertia){var h=this._lastTime=+new Date,g=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(g),this._times.push(h),this._prunePositions(h)}this._map.fire("move",c).fire("drag",c)},_prunePositions:function(c){for(;this._positions.length>1&&c-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var c=this._map.getSize().divideBy(2),h=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=h.subtract(c).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(c,h){return c-(c-h)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var c=this._draggable._newPos.subtract(this._draggable._startPos),h=this._offsetLimit;c.x<h.min.x&&(c.x=this._viscousLimit(c.x,h.min.x)),c.y<h.min.y&&(c.y=this._viscousLimit(c.y,h.min.y)),c.x>h.max.x&&(c.x=this._viscousLimit(c.x,h.max.x)),c.y>h.max.y&&(c.y=this._viscousLimit(c.y,h.max.y)),this._draggable._newPos=this._draggable._startPos.add(c)}},_onPreDragWrap:function(){var c=this._worldWidth,h=Math.round(c/2),g=this._initialWorldOffset,_=this._draggable._newPos.x,b=(_-h+g)%c+h-g,k=(_+h+g)%c-h-g,z=Math.abs(b+g)<Math.abs(k+g)?b:k;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=z},_onDragEnd:function(c){var h=this._map,g=h.options,_=!g.inertia||c.noInertia||this._times.length<2;if(h.fire("dragend",c),_)h.fire("moveend");else{this._prunePositions(+new Date);var b=this._lastPos.subtract(this._positions[0]),k=(this._lastTime-this._times[0])/1e3,z=g.easeLinearity,Z=b.multiplyBy(z/k),X=Z.distanceTo([0,0]),le=Math.min(g.inertiaMaxSpeed,X),Ce=Z.multiplyBy(le/X),je=le/(g.inertiaDeceleration*z),pt=Ce.multiplyBy(-je/2).round();!pt.x&&!pt.y?h.fire("moveend"):(pt=h._limitOffset(pt,h.options.maxBounds),R(function(){h.panBy(pt,{duration:je,easeLinearity:z,noMoveStart:!0,animate:!0})}))}}});yt.addInitHook("addHandler","dragging",D1),yt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var P1=Xi.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(c){this._map=c,this._setPanDelta(c.options.keyboardPanDelta),this._setZoomDelta(c.options.zoomDelta)},addHooks:function(){var c=this._map._container;c.tabIndex<=0&&(c.tabIndex="0"),Ye(c,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),$t(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var c=document.body,h=document.documentElement,g=c.scrollTop||h.scrollTop,_=c.scrollLeft||h.scrollLeft;this._map._container.focus(),window.scrollTo(_,g)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(c){var h=this._panKeys={},g=this.keyCodes,_,b;for(_=0,b=g.left.length;_<b;_++)h[g.left[_]]=[-1*c,0];for(_=0,b=g.right.length;_<b;_++)h[g.right[_]]=[c,0];for(_=0,b=g.down.length;_<b;_++)h[g.down[_]]=[0,c];for(_=0,b=g.up.length;_<b;_++)h[g.up[_]]=[0,-1*c]},_setZoomDelta:function(c){var h=this._zoomKeys={},g=this.keyCodes,_,b;for(_=0,b=g.zoomIn.length;_<b;_++)h[g.zoomIn[_]]=c;for(_=0,b=g.zoomOut.length;_<b;_++)h[g.zoomOut[_]]=-c},_addHooks:function(){Ye(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){$t(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(c){if(!(c.altKey||c.ctrlKey||c.metaKey)){var h=c.keyCode,g=this._map,_;if(h in this._panKeys){if(!g._panAnim||!g._panAnim._inProgress)if(_=this._panKeys[h],c.shiftKey&&(_=K(_).multiplyBy(3)),g.options.maxBounds&&(_=g._limitOffset(K(_),g.options.maxBounds)),g.options.worldCopyJump){var b=g.wrapLatLng(g.unproject(g.project(g.getCenter()).add(_)));g.panTo(b)}else g.panBy(_)}else if(h in this._zoomKeys)g.setZoom(g.getZoom()+(c.shiftKey?3:1)*this._zoomKeys[h]);else if(h===27&&g._popup&&g._popup.options.closeOnEscapeKey)g.closePopup();else return;Ir(c)}}});yt.addInitHook("addHandler","keyboard",P1),yt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var R1=Xi.extend({addHooks:function(){Ye(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){$t(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(c){var h=Sh(c),g=this._map.options.wheelDebounceTime;this._delta+=h,this._lastMousePos=this._map.mouseEventToContainerPoint(c),this._startTime||(this._startTime=+new Date);var _=Math.max(g-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(r(this._performZoom,this),_),Ir(c)},_performZoom:function(){var c=this._map,h=c.getZoom(),g=this._map.options.zoomSnap||0;c._stop();var _=this._delta/(this._map.options.wheelPxPerZoomLevel*4),b=4*Math.log(2/(1+Math.exp(-Math.abs(_))))/Math.LN2,k=g?Math.ceil(b/g)*g:b,z=c._limitZoom(h+(this._delta>0?k:-k))-h;this._delta=0,this._startTime=null,z&&(c.options.scrollWheelZoom==="center"?c.setZoom(h+z):c.setZoomAround(this._lastMousePos,h+z))}});yt.addInitHook("addHandler","scrollWheelZoom",R1);var Q$=600;yt.mergeOptions({tapHold:ke.touchNative&&ke.safari&&ke.mobile,tapTolerance:15});var M1=Xi.extend({addHooks:function(){Ye(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){$t(this._map._container,"touchstart",this._onDown,this)},_onDown:function(c){if(clearTimeout(this._holdTimeout),c.touches.length===1){var h=c.touches[0];this._startPos=this._newPos=new q(h.clientX,h.clientY),this._holdTimeout=setTimeout(r(function(){this._cancel(),this._isTapValid()&&(Ye(document,"touchend",dn),Ye(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",h))},this),Q$),Ye(document,"touchend touchcancel contextmenu",this._cancel,this),Ye(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function c(){$t(document,"touchend",dn),$t(document,"touchend touchcancel",c)},_cancel:function(){clearTimeout(this._holdTimeout),$t(document,"touchend touchcancel contextmenu",this._cancel,this),$t(document,"touchmove",this._onMove,this)},_onMove:function(c){var h=c.touches[0];this._newPos=new q(h.clientX,h.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(c,h){var g=new MouseEvent(c,{bubbles:!0,cancelable:!0,view:window,screenX:h.screenX,screenY:h.screenY,clientX:h.clientX,clientY:h.clientY});g._simulated=!0,h.target.dispatchEvent(g)}});yt.addInitHook("addHandler","tapHold",M1),yt.mergeOptions({touchZoom:ke.touch,bounceAtZoomLimits:!0});var k1=Xi.extend({addHooks:function(){Xe(this._map._container,"leaflet-touch-zoom"),Ye(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){un(this._map._container,"leaflet-touch-zoom"),$t(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(c){var h=this._map;if(!(!c.touches||c.touches.length!==2||h._animatingZoom||this._zooming)){var g=h.mouseEventToContainerPoint(c.touches[0]),_=h.mouseEventToContainerPoint(c.touches[1]);this._centerPoint=h.getSize()._divideBy(2),this._startLatLng=h.containerPointToLatLng(this._centerPoint),h.options.touchZoom!=="center"&&(this._pinchStartLatLng=h.containerPointToLatLng(g.add(_)._divideBy(2))),this._startDist=g.distanceTo(_),this._startZoom=h.getZoom(),this._moved=!1,this._zooming=!0,h._stop(),Ye(document,"touchmove",this._onTouchMove,this),Ye(document,"touchend touchcancel",this._onTouchEnd,this),dn(c)}},_onTouchMove:function(c){if(!(!c.touches||c.touches.length!==2||!this._zooming)){var h=this._map,g=h.mouseEventToContainerPoint(c.touches[0]),_=h.mouseEventToContainerPoint(c.touches[1]),b=g.distanceTo(_)/this._startDist;if(this._zoom=h.getScaleZoom(b,this._startZoom),!h.options.bounceAtZoomLimits&&(this._zoom<h.getMinZoom()&&b<1||this._zoom>h.getMaxZoom()&&b>1)&&(this._zoom=h._limitZoom(this._zoom)),h.options.touchZoom==="center"){if(this._center=this._startLatLng,b===1)return}else{var k=g._add(_)._divideBy(2)._subtract(this._centerPoint);if(b===1&&k.x===0&&k.y===0)return;this._center=h.unproject(h.project(this._pinchStartLatLng,this._zoom).subtract(k),this._zoom)}this._moved||(h._moveStart(!0,!1),this._moved=!0),M(this._animRequest);var z=r(h._move,h,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=R(z,this,!0),dn(c)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,M(this._animRequest),$t(document,"touchmove",this._onTouchMove,this),$t(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});yt.addInitHook("addHandler","touchZoom",k1),yt.BoxZoom=x1,yt.DoubleClickZoom=A1,yt.Drag=D1,yt.Keyboard=P1,yt.ScrollWheelZoom=R1,yt.TapHold=M1,yt.TouchZoom=k1,n.Bounds=ne,n.Browser=ke,n.CRS=Fe,n.Canvas=b1,n.Circle=cE,n.CircleMarker=Sm,n.Class=j,n.Control=ki,n.DivIcon=E1,n.DivOverlay=Ts,n.DomEvent=on,n.DomUtil=vs,n.Draggable=Gr,n.Evented=we,n.FeatureGroup=en,n.GeoJSON=mo,n.GridLayer=Mh,n.Handler=Xi,n.Icon=Ji,n.ImageOverlay=Pm,n.LatLng=fe,n.LatLngBounds=oe,n.Layer=dt,n.LayerGroup=an,n.LineUtil=p,n.Map=yt,n.Marker=Im,n.Mixin=nu,n.Path=fa,n.Point=q,n.PolyUtil=xh,n.Polygon=cu,n.Polyline=po,n.Popup=Rm,n.PosAnimation=gm,n.Projection=O,n.Rectangle=C1,n.Renderer=go,n.SVG=Lh,n.SVGOverlay=_1,n.TileLayer=du,n.Tooltip=Mm,n.Transformation=Ot,n.Util=F,n.VideoOverlay=v1,n.bind=r,n.bounds=Ee,n.canvas=I1,n.circle=N$,n.circleMarker=O$,n.control=da,n.divIcon=H$,n.extend=t,n.featureGroup=jn,n.geoJSON=y1,n.geoJson=B$,n.gridLayer=q$,n.icon=er,n.imageOverlay=U$,n.latLng=me,n.latLngBounds=ie,n.layerGroup=St,n.map=ym,n.marker=L$,n.point=K,n.polygon=V$,n.polyline=F$,n.popup=G$,n.rectangle=Y$,n.setOptions=y,n.stamp=o,n.svg=S1,n.svgOverlay=j$,n.tileLayer=T1,n.tooltip=z$,n.transformation=Xt,n.version=e,n.videoOverlay=$$;var Z$=window.L;n.noConflict=function(){return window.L=Z$,this},window.L=n})});function V1(n,e){return Object.is(n,e)}var Fn=null,Om=!1,Nm=1,yo=Symbol("SIGNAL");function At(n){let e=Fn;return Fn=n,e}function B1(){return Fn}var Nh={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function yE(n){if(Om)throw new Error("");if(Fn===null)return;Fn.consumerOnSignalRead(n);let e=Fn.nextProducerIndex++;if(Um(Fn),e<Fn.producerNode.length&&Fn.producerNode[e]!==n&&Oh(Fn)){let t=Fn.producerNode[e];Bm(t,Fn.producerIndexOfThis[e])}Fn.producerNode[e]!==n&&(Fn.producerNode[e]=n,Fn.producerIndexOfThis[e]=Oh(Fn)?G1(n,Fn,e):0),Fn.producerLastReadVersion[e]=n.version}function l3(){Nm++}function U1(n){if(!(Oh(n)&&!n.dirty)&&!(!n.dirty&&n.lastCleanEpoch===Nm)){if(!n.producerMustRecompute(n)&&!_E(n)){n.dirty=!1,n.lastCleanEpoch=Nm;return}n.producerRecomputeValue(n),n.dirty=!1,n.lastCleanEpoch=Nm}}function $1(n){if(n.liveConsumerNode===void 0)return;let e=Om;Om=!0;try{for(let t of n.liveConsumerNode)t.dirty||c3(t)}finally{Om=e}}function j1(){return Fn?.consumerAllowSignalWrites!==!1}function c3(n){n.dirty=!0,$1(n),n.consumerMarkedDirty?.(n)}function Vm(n){return n&&(n.nextProducerIndex=0),At(n)}function vE(n,e){if(At(e),!(!n||n.producerNode===void 0||n.producerIndexOfThis===void 0||n.producerLastReadVersion===void 0)){if(Oh(n))for(let t=n.nextProducerIndex;t<n.producerNode.length;t++)Bm(n.producerNode[t],n.producerIndexOfThis[t]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function _E(n){Um(n);for(let e=0;e<n.producerNode.length;e++){let t=n.producerNode[e],i=n.producerLastReadVersion[e];if(i!==t.version||(U1(t),i!==t.version))return!0}return!1}function EE(n){if(Um(n),Oh(n))for(let e=0;e<n.producerNode.length;e++)Bm(n.producerNode[e],n.producerIndexOfThis[e]);n.producerNode.length=n.producerLastReadVersion.length=n.producerIndexOfThis.length=0,n.liveConsumerNode&&(n.liveConsumerNode.length=n.liveConsumerIndexOfThis.length=0)}function G1(n,e,t){if(z1(n),n.liveConsumerNode.length===0&&H1(n))for(let i=0;i<n.producerNode.length;i++)n.producerIndexOfThis[i]=G1(n.producerNode[i],n,i);return n.liveConsumerIndexOfThis.push(t),n.liveConsumerNode.push(e)-1}function Bm(n,e){if(z1(n),n.liveConsumerNode.length===1&&H1(n))for(let i=0;i<n.producerNode.length;i++)Bm(n.producerNode[i],n.producerIndexOfThis[i]);let t=n.liveConsumerNode.length-1;if(n.liveConsumerNode[e]=n.liveConsumerNode[t],n.liveConsumerIndexOfThis[e]=n.liveConsumerIndexOfThis[t],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,e<n.liveConsumerNode.length){let i=n.liveConsumerIndexOfThis[e],r=n.liveConsumerNode[e];Um(r),r.producerIndexOfThis[i]=e}}function Oh(n){return n.consumerIsAlwaysLive||(n?.liveConsumerNode?.length??0)>0}function Um(n){n.producerNode??=[],n.producerIndexOfThis??=[],n.producerLastReadVersion??=[]}function z1(n){n.liveConsumerNode??=[],n.liveConsumerIndexOfThis??=[]}function H1(n){return n.producerNode!==void 0}function q1(n){let e=Object.create(u3);e.computation=n;let t=()=>{if(U1(e),yE(e),e.value===Fm)throw e.error;return e.value};return t[yo]=e,t}var mE=Symbol("UNSET"),gE=Symbol("COMPUTING"),Fm=Symbol("ERRORED"),u3=qe(de({},Nh),{value:mE,dirty:!0,error:null,equal:V1,producerMustRecompute(n){return n.value===mE||n.value===gE},producerRecomputeValue(n){if(n.value===gE)throw new Error("Detected cycle in computations.");let e=n.value;n.value=gE;let t=Vm(n),i;try{i=n.computation()}catch(r){i=Fm,n.error=r}finally{vE(n,t)}if(e!==mE&&e!==Fm&&i!==Fm&&n.equal(e,i)){n.value=e;return}n.value=i,n.version++}});function d3(){throw new Error}var W1=d3;function K1(){W1()}function Y1(n){W1=n}var h3=null;function Q1(n){let e=Object.create(X1);e.value=n;let t=()=>(yE(e),e.value);return t[yo]=e,t}function TE(n,e){j1()||K1(),n.equal(n.value,e)||(n.value=e,f3(n))}function Z1(n,e){j1()||K1(),TE(n,e(n.value))}var X1=qe(de({},Nh),{equal:V1,value:void 0});function f3(n){n.version++,l3(),$1(n),h3?.()}function Je(n){return typeof n=="function"}function fu(n){let t=n(i=>{Error.call(i),i.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var $m=fu(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:
${t.map((i,r)=>`${r+1}) ${i.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=t});function Ll(n,e){if(n){let t=n.indexOf(e);0<=t&&n.splice(t,1)}}var pn=class n{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(let s of t)s.remove(this);else t.remove(this);let{initialTeardown:i}=this;if(Je(i))try{i()}catch(s){e=s instanceof $m?s.errors:[s]}let{_finalizers:r}=this;if(r){this._finalizers=null;for(let s of r)try{J1(s)}catch(o){e=e??[],o instanceof $m?e=[...e,...o.errors]:e.push(o)}}if(e)throw new $m(e)}}add(e){var t;if(e&&e!==this)if(this.closed)J1(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}}_hasParent(e){let{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){let{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){let{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&Ll(t,e)}remove(e){let{_finalizers:t}=this;t&&Ll(t,e),e instanceof n&&e._removeParent(this)}};pn.EMPTY=(()=>{let n=new pn;return n.closed=!0,n})();var wE=pn.EMPTY;function jm(n){return n instanceof pn||n&&"closed"in n&&Je(n.remove)&&Je(n.add)&&Je(n.unsubscribe)}function J1(n){Je(n)?n():n.unsubscribe()}var zr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var pu={setTimeout(n,e,...t){let{delegate:i}=pu;return i?.setTimeout?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){let{delegate:e}=pu;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function Gm(n){pu.setTimeout(()=>{let{onUnhandledError:e}=zr;if(e)e(n);else throw n})}function Fh(){}var eP=bE("C",void 0,void 0);function tP(n){return bE("E",void 0,n)}function nP(n){return bE("N",n,void 0)}function bE(n,e,t){return{kind:n,value:e,error:t}}var Ol=null;function mu(n){if(zr.useDeprecatedSynchronousErrorHandling){let e=!Ol;if(e&&(Ol={errorThrown:!1,error:null}),n(),e){let{errorThrown:t,error:i}=Ol;if(Ol=null,t)throw i}}else n()}function iP(n){zr.useDeprecatedSynchronousErrorHandling&&Ol&&(Ol.errorThrown=!0,Ol.error=n)}var Nl=class extends pn{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,jm(e)&&e.add(this)):this.destination=g3}static create(e,t,i){return new gu(e,t,i)}next(e){this.isStopped?SE(nP(e),this):this._next(e)}error(e){this.isStopped?SE(tP(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?SE(eP,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},p3=Function.prototype.bind;function IE(n,e){return p3.call(n,e)}var CE=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){zm(i)}}error(e){let{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){zm(i)}else zm(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){zm(t)}}},gu=class extends Nl{constructor(e,t,i){super();let r;if(Je(e)||!e)r={next:e??void 0,error:t??void 0,complete:i??void 0};else{let s;this&&zr.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&IE(e.next,s),error:e.error&&IE(e.error,s),complete:e.complete&&IE(e.complete,s)}):r=e}this.destination=new CE(r)}};function zm(n){zr.useDeprecatedSynchronousErrorHandling?iP(n):Gm(n)}function m3(n){throw n}function SE(n,e){let{onStoppedNotification:t}=zr;t&&pu.setTimeout(()=>t(n,e))}var g3={closed:!0,next:Fh,error:m3,complete:Fh};var yu=typeof Symbol=="function"&&Symbol.observable||"@@observable";function tr(n){return n}function xE(...n){return AE(n)}function AE(n){return n.length===0?tr:n.length===1?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}}var rt=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){let i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,r){let s=v3(t)?t:new gu(t,i,r);return mu(()=>{let{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return i=rP(i),new i((r,s)=>{let o=new gu({next:a=>{try{t(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:r});this.subscribe(o)})}_subscribe(t){var i;return(i=this.source)===null||i===void 0?void 0:i.subscribe(t)}[yu](){return this}pipe(...t){return AE(t)(this)}toPromise(t){return t=rP(t),new t((i,r)=>{let s;this.subscribe(o=>s=o,o=>r(o),()=>i(s))})}}return n.create=e=>new n(e),n})();function rP(n){var e;return(e=n??zr.Promise)!==null&&e!==void 0?e:Promise}function y3(n){return n&&Je(n.next)&&Je(n.error)&&Je(n.complete)}function v3(n){return n&&n instanceof Nl||y3(n)&&jm(n)}function DE(n){return Je(n?.lift)}function Ct(n){return e=>{if(DE(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function vt(n,e,t,i,r){return new PE(n,e,t,i,r)}var PE=class extends Nl{constructor(e,t,i,r,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(l){e.error(l)}}:super._next,this._error=r?function(a){try{r(a)}catch(l){e.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:t}=this;super.unsubscribe(),!t&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};function vu(){return Ct((n,e)=>{let t=null;n._refCount++;let i=vt(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount){t=null;return}let r=n._connection,s=t;t=null,r&&(!s||r===s)&&r.unsubscribe(),e.unsubscribe()});n.subscribe(i),i.closed||(t=n.connect())})}var _u=class extends rt{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,DE(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){let e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new pn;let t=this.getSubject();e.add(this.source.subscribe(vt(t,void 0,()=>{this._teardown(),t.complete()},i=>{this._teardown(),t.error(i)},()=>this._teardown()))),e.closed&&(this._connection=null,e=pn.EMPTY)}return e}refCount(){return vu()(this)}};var sP=fu(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var zn=(()=>{class n extends rt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){let i=new Hm(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new sP}next(t){mu(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let i of this.currentObservers)i.next(t)}})}error(t){mu(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;let{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){mu(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){let{hasError:i,isStopped:r,observers:s}=this;return i||r?wE:(this.currentObservers=null,s.push(t),new pn(()=>{this.currentObservers=null,Ll(s,t)}))}_checkFinalizedStatuses(t){let{hasError:i,thrownError:r,isStopped:s}=this;i?t.error(r):s&&t.complete()}asObservable(){let t=new rt;return t.source=this,t}}return n.create=(e,t)=>new Hm(e,t),n})(),Hm=class extends zn{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.next)===null||i===void 0||i.call(t,e)}error(e){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.error)===null||i===void 0||i.call(t,e)}complete(){var e,t;(t=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||t===void 0||t.call(e)}_subscribe(e){var t,i;return(i=(t=this.source)===null||t===void 0?void 0:t.subscribe(e))!==null&&i!==void 0?i:wE}};var mn=class extends zn{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){let{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}};var RE={now(){return(RE.delegate||Date).now()},delegate:void 0};var qm=class extends pn{constructor(e,t){super()}schedule(e,t=0){return this}};var Vh={setInterval(n,e,...t){let{delegate:i}=Vh;return i?.setInterval?i.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){let{delegate:e}=Vh;return(e?.clearInterval||clearInterval)(n)},delegate:void 0};var Eu=class extends qm{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var i;if(this.closed)return this;this.state=e;let r=this.id,s=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(s,r,t)),this.pending=!0,this.delay=t,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(s,this.id,t),this}requestAsyncId(e,t,i=0){return Vh.setInterval(e.flush.bind(e,this),i)}recycleAsyncId(e,t,i=0){if(i!=null&&this.delay===i&&this.pending===!1)return t;t!=null&&Vh.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let i=this._execute(e,t);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let i=!1,r;try{this.work(e)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){let{id:e,scheduler:t}=this,{actions:i}=t;this.work=this.state=this.scheduler=null,this.pending=!1,Ll(i,this),e!=null&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}};var Tu=class n{constructor(e,t=n.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,i){return new this.schedulerActionCtor(this,e).schedule(i,t)}};Tu.now=RE.now;var wu=class extends Tu{constructor(e,t=Tu.now){super(e,t),this.actions=[],this._active=!1}flush(e){let{actions:t}=this;if(this._active){t.push(e);return}let i;this._active=!0;do if(i=e.execute(e.state,e.delay))break;while(e=t.shift());if(this._active=!1,i){for(;e=t.shift();)e.unsubscribe();throw i}}};var ME=new wu(Eu);var Wm=class extends Eu{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,i=0){return i!=null&&i>0||i==null&&this.delay>0?super.requestAsyncId(e,t,i):(e.flush(this),0)}};var Km=class extends wu{};var kE=new Km(Wm);var nr=new rt(n=>n.complete());function oP(n){return n&&Je(n.schedule)}function aP(n){return n[n.length-1]}function Ym(n){return Je(aP(n))?n.pop():void 0}function ma(n){return oP(aP(n))?n.pop():void 0}function LE(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t}function cP(n,e,t,i){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(d){try{u(i.next(d))}catch(f){o(f)}}function l(d){try{u(i.throw(d))}catch(f){o(f)}}function u(d){d.done?s(d.value):r(d.value).then(a,l)}u((i=i.apply(n,e||[])).next())})}function lP(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Fl(n){return this instanceof Fl?(this.v=n,this):new Fl(n)}function uP(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),r,s=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),r[Symbol.asyncIterator]=function(){return this},r;function o(y){return function(v){return Promise.resolve(v).then(y,f)}}function a(y,v){i[y]&&(r[y]=function(E){return new Promise(function(T,C){s.push([y,E,T,C])>1||l(y,E)})},v&&(r[y]=v(r[y])))}function l(y,v){try{u(i[y](v))}catch(E){m(s[0][3],E)}}function u(y){y.value instanceof Fl?Promise.resolve(y.value.v).then(d,f):m(s[0][2],y)}function d(y){l("next",y)}function f(y){l("throw",y)}function m(y,v){y(v),s.shift(),s.length&&l(s[0][0],s[0][1])}}function dP(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof lP=="function"?lP(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(o){return new Promise(function(a,l){o=n[s](o),r(a,l,o.done,o.value)})}}function r(s,o,a,l){Promise.resolve(l).then(function(u){s({value:u,done:a})},o)}}var Qm=n=>n&&typeof n.length=="number"&&typeof n!="function";function Zm(n){return Je(n?.then)}function Xm(n){return Je(n[yu])}function Jm(n){return Symbol.asyncIterator&&Je(n?.[Symbol.asyncIterator])}function eg(n){return new TypeError(`You provided ${n!==null&&typeof n=="object"?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function _3(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var tg=_3();function ng(n){return Je(n?.[tg])}function ig(n){return uP(this,arguments,function*(){let t=n.getReader();try{for(;;){let{value:i,done:r}=yield Fl(t.read());if(r)return yield Fl(void 0);yield yield Fl(i)}}finally{t.releaseLock()}})}function rg(n){return Je(n?.getReader)}function An(n){if(n instanceof rt)return n;if(n!=null){if(Xm(n))return E3(n);if(Qm(n))return T3(n);if(Zm(n))return w3(n);if(Jm(n))return hP(n);if(ng(n))return b3(n);if(rg(n))return I3(n)}throw eg(n)}function E3(n){return new rt(e=>{let t=n[yu]();if(Je(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function T3(n){return new rt(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function w3(n){return new rt(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,Gm)})}function b3(n){return new rt(e=>{for(let t of n)if(e.next(t),e.closed)return;e.complete()})}function hP(n){return new rt(e=>{S3(n,e).catch(t=>e.error(t))})}function I3(n){return hP(ig(n))}function S3(n,e){var t,i,r,s;return cP(this,void 0,void 0,function*(){try{for(t=dP(n);i=yield t.next(),!i.done;){let o=i.value;if(e.next(o),e.closed)return}}catch(o){r={error:o}}finally{try{i&&!i.done&&(s=t.return)&&(yield s.call(t))}finally{if(r)throw r.error}}e.complete()})}function Oi(n,e,t,i=0,r=!1){let s=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function ga(n,e=0){return Ct((t,i)=>{t.subscribe(vt(i,r=>Oi(i,n,()=>i.next(r),e),()=>Oi(i,n,()=>i.complete(),e),r=>Oi(i,n,()=>i.error(r),e)))})}function ya(n,e=0){return Ct((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function fP(n,e){return An(n).pipe(ya(e),ga(e))}function pP(n,e){return An(n).pipe(ya(e),ga(e))}function mP(n,e){return new rt(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}function gP(n,e){return new rt(t=>{let i;return Oi(t,e,()=>{i=n[tg](),Oi(t,e,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(o){t.error(o);return}s?t.complete():t.next(r)},0,!0)}),()=>Je(i?.return)&&i.return()})}function sg(n,e){if(!n)throw new Error("Iterable cannot be null");return new rt(t=>{Oi(t,e,()=>{let i=n[Symbol.asyncIterator]();Oi(t,e,()=>{i.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function yP(n,e){return sg(ig(n),e)}function vP(n,e){if(n!=null){if(Xm(n))return fP(n,e);if(Qm(n))return mP(n,e);if(Zm(n))return pP(n,e);if(Jm(n))return sg(n,e);if(ng(n))return gP(n,e);if(rg(n))return yP(n,e)}throw eg(n)}function tn(n,e){return e?vP(n,e):An(n)}function $e(...n){let e=ma(n);return tn(n,e)}function bu(n,e){let t=Je(n)?n:()=>n,i=r=>r.error(t());return new rt(e?r=>e.schedule(i,0,r):i)}function OE(n){return!!n&&(n instanceof rt||Je(n.lift)&&Je(n.subscribe))}var Hr=fu(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function va(n,e){let t=typeof e=="object";return new Promise((i,r)=>{let s=!1,o;n.subscribe({next:a=>{o=a,s=!0},error:r,complete:()=>{s?i(o):t?i(e.defaultValue):r(new Hr)}})})}function We(n,e){return Ct((t,i)=>{let r=0;t.subscribe(vt(i,s=>{i.next(n.call(e,s,r++))}))})}var{isArray:C3}=Array;function x3(n,e){return C3(e)?n(...e):n(e)}function og(n){return We(e=>x3(n,e))}var{isArray:A3}=Array,{getPrototypeOf:D3,prototype:P3,keys:R3}=Object;function ag(n){if(n.length===1){let e=n[0];if(A3(e))return{args:e,keys:null};if(M3(e)){let t=R3(e);return{args:t.map(i=>e[i]),keys:t}}}return{args:n,keys:null}}function M3(n){return n&&typeof n=="object"&&D3(n)===P3}function lg(n,e){return n.reduce((t,i,r)=>(t[i]=e[r],t),{})}function Bh(...n){let e=ma(n),t=Ym(n),{args:i,keys:r}=ag(n);if(i.length===0)return tn([],e);let s=new rt(k3(i,e,r?o=>lg(r,o):tr));return t?s.pipe(og(t)):s}function k3(n,e,t=tr){return i=>{_P(e,()=>{let{length:r}=n,s=new Array(r),o=r,a=r;for(let l=0;l<r;l++)_P(e,()=>{let u=tn(n[l],e),d=!1;u.subscribe(vt(i,f=>{s[l]=f,d||(d=!0,a--),a||i.next(t(s.slice()))},()=>{--o||i.complete()}))},i)},i)}}function _P(n,e,t){n?Oi(t,n,e):e()}function EP(n,e,t,i,r,s,o,a){let l=[],u=0,d=0,f=!1,m=()=>{f&&!l.length&&!u&&e.complete()},y=E=>u<i?v(E):l.push(E),v=E=>{s&&e.next(E),u++;let T=!1;An(t(E,d++)).subscribe(vt(e,C=>{r?.(C),s?y(C):e.next(C)},()=>{T=!0},void 0,()=>{if(T)try{for(u--;l.length&&u<i;){let C=l.shift();o?Oi(e,o,()=>v(C)):v(C)}m()}catch(C){e.error(C)}}))};return n.subscribe(vt(e,y,()=>{f=!0,m()})),()=>{a?.()}}function Dn(n,e,t=1/0){return Je(e)?Dn((i,r)=>We((s,o)=>e(i,s,r,o))(An(n(i,r))),t):(typeof e=="number"&&(t=e),Ct((i,r)=>EP(i,r,n,t)))}function Iu(n=1/0){return Dn(tr,n)}function TP(){return Iu(1)}function Su(...n){return TP()(tn(n,ma(n)))}function cg(n){return new rt(e=>{An(n()).subscribe(e)})}function NE(...n){let e=Ym(n),{args:t,keys:i}=ag(n),r=new rt(s=>{let{length:o}=t;if(!o){s.complete();return}let a=new Array(o),l=o,u=o;for(let d=0;d<o;d++){let f=!1;An(t[d]).subscribe(vt(s,m=>{f||(f=!0,u--),a[d]=m},()=>l--,void 0,()=>{(!l||!f)&&(u||s.next(i?lg(i,a):a),s.complete())}))}});return e?r.pipe(og(e)):r}function Ni(n,e){return Ct((t,i)=>{let r=0;t.subscribe(vt(i,s=>n.call(e,s,r++)&&i.next(s)))})}function _a(n){return Ct((e,t)=>{let i=null,r=!1,s;i=e.subscribe(vt(t,void 0,void 0,o=>{s=An(n(o,_a(n)(e))),i?(i.unsubscribe(),i=null,s.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(t))})}function wP(n,e,t,i,r){return(s,o)=>{let a=t,l=e,u=0;s.subscribe(vt(o,d=>{let f=u++;l=a?n(l,d,f):(a=!0,d),i&&o.next(l)},r&&(()=>{a&&o.next(l),o.complete()})))}}function vo(n,e){return Je(e)?Dn(n,e,1):Dn(n,1)}function Ea(n){return Ct((e,t)=>{let i=!1;e.subscribe(vt(t,r=>{i=!0,t.next(r)},()=>{i||t.next(n),t.complete()}))})}function _o(n){return n<=0?()=>nr:Ct((e,t)=>{let i=0;e.subscribe(vt(t,r=>{++i<=n&&(t.next(r),n<=i&&t.complete())}))})}function FE(n){return We(()=>n)}function ug(n=L3){return Ct((e,t)=>{let i=!1;e.subscribe(vt(t,r=>{i=!0,t.next(r)},()=>i?t.complete():t.error(n())))})}function L3(){return new Hr}function Vl(n){return Ct((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}function ws(n,e){let t=arguments.length>=2;return i=>i.pipe(n?Ni((r,s)=>n(r,s,i)):tr,_o(1),t?Ea(e):ug(()=>new Hr))}function Cu(n){return n<=0?()=>nr:Ct((e,t)=>{let i=[];e.subscribe(vt(t,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(let r of i)t.next(r);t.complete()},void 0,()=>{i=null}))})}function VE(n,e){let t=arguments.length>=2;return i=>i.pipe(n?Ni((r,s)=>n(r,s,i)):tr,Cu(1),t?Ea(e):ug(()=>new Hr))}function BE(n,e){return Ct(wP(n,e,arguments.length>=2,!0))}function UE(...n){let e=ma(n);return Ct((t,i)=>{(e?Su(n,t,e):Su(n,t)).subscribe(i)})}function Fi(n,e){return Ct((t,i)=>{let r=null,s=0,o=!1,a=()=>o&&!r&&i.complete();t.subscribe(vt(i,l=>{r?.unsubscribe();let u=0,d=s++;An(n(l,d)).subscribe(r=vt(i,f=>i.next(e?e(l,f,d,u++):f),()=>{r=null,a()}))},()=>{o=!0,a()}))})}function $E(n){return Ct((e,t)=>{An(n).subscribe(vt(t,()=>t.complete(),Fh)),!t.closed&&e.subscribe(t)})}function Pn(n,e,t){let i=Je(n)||e||t?{next:n,error:e,complete:t}:n;return i?Ct((r,s)=>{var o;(o=i.subscribe)===null||o===void 0||o.call(i);let a=!0;r.subscribe(vt(s,l=>{var u;(u=i.next)===null||u===void 0||u.call(i,l),s.next(l)},()=>{var l;a=!1,(l=i.complete)===null||l===void 0||l.call(i),s.complete()},l=>{var u;a=!1,(u=i.error)===null||u===void 0||u.call(i,l),s.error(l)},()=>{var l,u;a&&((l=i.unsubscribe)===null||l===void 0||l.call(i)),(u=i.finalize)===null||u===void 0||u.call(i)}))}):tr}var lR="https://g.co/ng/security#xss",ye=class extends Error{constructor(e,t){super(qg(e,t)),this.code=e}};function qg(n,e){return`${`NG0${Math.abs(n)}`}${e?": "+e:""}`}function Kh(n){return{toString:n}.toString()}var dg="__parameters__";function O3(n){return function(...t){if(n){let i=n(...t);for(let r in i)this[r]=i[r]}}}function cR(n,e,t){return Kh(()=>{let i=O3(e);function r(...s){if(this instanceof r)return i.apply(this,s),this;let o=new r(...s);return a.annotation=o,a;function a(l,u,d){let f=l.hasOwnProperty(dg)?l[dg]:Object.defineProperty(l,dg,{value:[]})[dg];for(;f.length<=d;)f.push(null);return(f[d]=f[d]||[]).push(o),l}}return t&&(r.prototype=Object.create(t.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}var Ul=globalThis;function Kt(n){for(let e in n)if(n[e]===Kt)return e;throw Error("Could not find renamed property on target object.")}function N3(n,e){for(let t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function Ti(n){if(typeof n=="string")return n;if(Array.isArray(n))return"["+n.map(Ti).join(", ")+"]";if(n==null)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;let e=n.toString();if(e==null)return""+e;let t=e.indexOf(`
`);return t===-1?e:e.substring(0,t)}function bP(n,e){return n==null||n===""?e===null?"":e:e==null||e===""?n:n+" "+e}var F3=Kt({__forward_ref__:Kt});function Da(n){return n.__forward_ref__=Da,n.toString=function(){return Ti(this())},n}function Ei(n){return uR(n)?n():n}function uR(n){return typeof n=="function"&&n.hasOwnProperty(F3)&&n.__forward_ref__===Da}function Se(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Ds(n){return{providers:n.providers||[],imports:n.imports||[]}}function Wg(n){return IP(n,hR)||IP(n,fR)}function dR(n){return Wg(n)!==null}function IP(n,e){return n.hasOwnProperty(e)?n[e]:null}function V3(n){let e=n&&(n[hR]||n[fR]);return e||null}function SP(n){return n&&(n.hasOwnProperty(CP)||n.hasOwnProperty(B3))?n[CP]:null}var hR=Kt({\u0275prov:Kt}),CP=Kt({\u0275inj:Kt}),fR=Kt({ngInjectableDef:Kt}),B3=Kt({ngInjectorDef:Kt}),Pe=class{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof t=="number"?this.__NG_ELEMENT_ID__=t:t!==void 0&&(this.\u0275prov=Se({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function pR(n){return n&&!!n.\u0275providers}var U3=Kt({\u0275cmp:Kt}),$3=Kt({\u0275dir:Kt}),j3=Kt({\u0275pipe:Kt}),G3=Kt({\u0275mod:Kt}),wg=Kt({\u0275fac:Kt}),$h=Kt({__NG_ELEMENT_ID__:Kt}),xP=Kt({__NG_ENV_ID__:Kt});function ku(n){return typeof n=="string"?n:n==null?"":String(n)}function z3(n){return typeof n=="function"?n.name||n.toString():typeof n=="object"&&n!=null&&typeof n.type=="function"?n.type.name||n.type.toString():ku(n)}function H3(n,e){let t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new ye(-200,n)}function JT(n,e){throw new ye(-201,!1)}var ht=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(ht||{}),nT;function mR(){return nT}function Vi(n){let e=nT;return nT=n,e}function gR(n,e,t){let i=Wg(n);if(i&&i.providedIn=="root")return i.value===void 0?i.value=i.factory():i.value;if(t&ht.Optional)return null;if(e!==void 0)return e;JT(n,"Injector")}var q3={},jh=q3,iT="__NG_DI_FLAG__",bg="ngTempTokenPath",W3="ngTokenPath",K3=/\n/gm,Y3="\u0275",AP="__source",Ru;function Q3(){return Ru}function Ta(n){let e=Ru;return Ru=n,e}function Z3(n,e=ht.Default){if(Ru===void 0)throw new ye(-203,!1);return Ru===null?gR(n,void 0,e):Ru.get(n,e&ht.Optional?null:void 0,e)}function Me(n,e=ht.Default){return(mR()||Z3)(Ei(n),e)}function ue(n,e=ht.Default){return Me(n,Kg(e))}function Kg(n){return typeof n>"u"||typeof n=="number"?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function rT(n){let e=[];for(let t=0;t<n.length;t++){let i=Ei(n[t]);if(Array.isArray(i)){if(i.length===0)throw new ye(900,!1);let r,s=ht.Default;for(let o=0;o<i.length;o++){let a=i[o],l=X3(a);typeof l=="number"?l===-1?r=a.token:s|=l:r=a}e.push(Me(r,s))}else e.push(Me(i))}return e}function yR(n,e){return n[iT]=e,n.prototype[iT]=e,n}function X3(n){return n[iT]}function J3(n,e,t,i){let r=n[bg];throw e[AP]&&r.unshift(e[AP]),n.message=e5(`
`+n.message,r,t,i),n[W3]=r,n[bg]=null,n}function e5(n,e,t,i=null){n=n&&n.charAt(0)===`
`&&n.charAt(1)==Y3?n.slice(2):n;let r=Ti(e);if(Array.isArray(e))r=e.map(Ti).join(" -> ");else if(typeof e=="object"){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+(typeof a=="string"?JSON.stringify(a):Ti(a)))}r=`{${s.join(", ")}}`}return`${t}${i?"("+i+")":""}[${r}]: ${n.replace(K3,`
  `)}`}var li=yR(cR("Optional"),8);var ew=yR(cR("SkipSelf"),4);function jl(n,e){let t=n.hasOwnProperty(wg);return t?n[wg]:null}function t5(n,e,t){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=e[i];if(t&&(r=t(r),s=t(s)),s!==r)return!1}return!0}function n5(n){return n.flat(Number.POSITIVE_INFINITY)}function tw(n,e){n.forEach(t=>Array.isArray(t)?tw(t,e):e(t))}function vR(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Ig(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function i5(n,e,t,i){let r=n.length;if(r==e)n.push(t,i);else if(r===1)n.push(i,n[0]),n[0]=t;else{for(r--,n.push(n[r-1],n[r]);r>e;){let s=r-2;n[r]=n[s],r--}n[e]=t,n[e+1]=i}}function r5(n,e,t){let i=Yh(n,e);return i>=0?n[i|1]=t:(i=~i,i5(n,i,e,t)),i}function jE(n,e){let t=Yh(n,e);if(t>=0)return n[t|1]}function Yh(n,e){return s5(n,e,1)}function s5(n,e,t){let i=0,r=n.length>>t;for(;r!==i;){let s=i+(r-i>>1),o=n[s<<t];if(e===o)return s<<t;o>e?r=s:i=s+1}return~(r<<t)}var Lu={},Cr=[],Ou=new Pe(""),_R=new Pe("",-1),ER=new Pe(""),Sg=class{get(e,t=jh){if(t===jh){let i=new Error(`NullInjectorError: No provider for ${Ti(e)}!`);throw i.name="NullInjectorError",i}return t}},TR=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(TR||{}),Ss=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(Ss||{}),Ia=function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n}(Ia||{});function o5(n,e,t){let i=n.length;for(;;){let r=n.indexOf(e,t);if(r===-1)return r;if(r===0||n.charCodeAt(r-1)<=32){let s=e.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}t=r+1}}function sT(n,e,t){let i=0;for(;i<t.length;){let r=t[i];if(typeof r=="number"){if(r!==0)break;i++;let s=t[i++],o=t[i++],a=t[i++];n.setAttribute(e,o,a,s)}else{let s=r,o=t[++i];a5(s)?n.setProperty(e,s,o):n.setAttribute(e,s,o),i++}}return i}function wR(n){return n===3||n===4||n===6}function a5(n){return n.charCodeAt(0)===64}function Gh(n,e){if(!(e===null||e.length===0))if(n===null||n.length===0)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){let r=e[i];typeof r=="number"?t=r:t===0||(t===-1||t===2?DP(n,t,r,null,e[++i]):DP(n,t,r,null,null))}}return n}function DP(n,e,t,i,r){let s=0,o=n.length;if(e===-1)o=-1;else for(;s<n.length;){let a=n[s++];if(typeof a=="number"){if(a===e){o=-1;break}else if(a>e){o=s-1;break}}}for(;s<n.length;){let a=n[s];if(typeof a=="number")break;if(a===t){if(i===null){r!==null&&(n[s+1]=r);return}else if(i===n[s+1]){n[s+2]=r;return}}s++,i!==null&&s++,r!==null&&s++}o!==-1&&(n.splice(o,0,e),s=o+1),n.splice(s++,0,t),i!==null&&n.splice(s++,0,i),r!==null&&n.splice(s++,0,r)}var bR="ng-template";function l5(n,e,t,i){let r=0;if(i){for(;r<e.length&&typeof e[r]=="string";r+=2)if(e[r]==="class"&&o5(e[r+1].toLowerCase(),t,0)!==-1)return!0}else if(nw(n))return!1;if(r=e.indexOf(1,r),r>-1){let s;for(;++r<e.length&&typeof(s=e[r])=="string";)if(s.toLowerCase()===t)return!0}return!1}function nw(n){return n.type===4&&n.value!==bR}function c5(n,e,t){let i=n.type===4&&!t?bR:n.value;return e===i}function u5(n,e,t){let i=4,r=n.attrs,s=r!==null?f5(r):0,o=!1;for(let a=0;a<e.length;a++){let l=e[a];if(typeof l=="number"){if(!o&&!qr(i)&&!qr(l))return!1;if(o&&qr(l))continue;o=!1,i=l|i&1;continue}if(!o)if(i&4){if(i=2|i&1,l!==""&&!c5(n,l,t)||l===""&&e.length===1){if(qr(i))return!1;o=!0}}else if(i&8){if(r===null||!l5(n,r,l,t)){if(qr(i))return!1;o=!0}}else{let u=e[++a],d=d5(l,r,nw(n),t);if(d===-1){if(qr(i))return!1;o=!0;continue}if(u!==""){let f;if(d>s?f="":f=r[d+1].toLowerCase(),i&2&&u!==f){if(qr(i))return!1;o=!0}}}}return qr(i)||o}function qr(n){return(n&1)===0}function d5(n,e,t,i){if(e===null)return-1;let r=0;if(i||!t){let s=!1;for(;r<e.length;){let o=e[r];if(o===n)return r;if(o===3||o===6)s=!0;else if(o===1||o===2){let a=e[++r];for(;typeof a=="string";)a=e[++r];continue}else{if(o===4)break;if(o===0){r+=4;continue}}r+=s?1:2}return-1}else return p5(e,n)}function h5(n,e,t=!1){for(let i=0;i<e.length;i++)if(u5(n,e[i],t))return!0;return!1}function f5(n){for(let e=0;e<n.length;e++){let t=n[e];if(wR(t))return e}return n.length}function p5(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){let i=n[t];if(typeof i=="number")return-1;if(i===e)return t;t++}return-1}function PP(n,e){return n?":not("+e.trim()+")":e}function m5(n){let e=n[0],t=1,i=2,r="",s=!1;for(;t<n.length;){let o=n[t];if(typeof o=="string")if(i&2){let a=n[++t];r+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else i&8?r+="."+o:i&4&&(r+=" "+o);else r!==""&&!qr(o)&&(e+=PP(s,r),r=""),i=o,s=s||!qr(i);t++}return r!==""&&(e+=PP(s,r)),e}function g5(n){return n.map(m5).join(",")}function y5(n){let e=[],t=[],i=1,r=2;for(;i<n.length;){let s=n[i];if(typeof s=="string")r===2?s!==""&&e.push(s,n[++i]):r===8&&t.push(s);else{if(!qr(r))break;r=s}i++}return{attrs:e,classes:t}}function _t(n){return Kh(()=>{let e=AR(n),t=qe(de({},e),{decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===TR.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Ss.Emulated,styles:n.styles||Cr,_:null,schemas:n.schemas||null,tView:null,id:""});DR(t);let i=n.dependencies;return t.directiveDefs=MP(i,!1),t.pipeDefs=MP(i,!0),t.id=E5(t),t})}function v5(n){return Sa(n)||IR(n)}function _5(n){return n!==null}function Ps(n){return Kh(()=>({type:n.type,bootstrap:n.bootstrap||Cr,declarations:n.declarations||Cr,imports:n.imports||Cr,exports:n.exports||Cr,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function RP(n,e){if(n==null)return Lu;let t={};for(let i in n)if(n.hasOwnProperty(i)){let r=n[i],s,o,a=Ia.None;Array.isArray(r)?(a=r[0],s=r[1],o=r[2]??s):(s=r,o=r),e?(t[s]=a!==Ia.None?[i,a]:i,e[s]=o):t[s]=i}return t}function ci(n){return Kh(()=>{let e=AR(n);return DR(e),e})}function iw(n){return{type:n.type,name:n.name,factory:null,pure:n.pure!==!1,standalone:n.standalone===!0,onDestroy:n.type.prototype.ngOnDestroy||null}}function Sa(n){return n[U3]||null}function IR(n){return n[$3]||null}function SR(n){return n[j3]||null}function CR(n){let e=Sa(n)||IR(n)||SR(n);return e!==null?e.standalone:!1}function xR(n,e){let t=n[G3]||null;if(!t&&e===!0)throw new Error(`Type ${Ti(n)} does not have '\u0275mod' property.`);return t}function AR(n){let e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputTransforms:null,inputConfig:n.inputs||Lu,exportAs:n.exportAs||null,standalone:n.standalone===!0,signals:n.signals===!0,selectors:n.selectors||Cr,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:RP(n.inputs,e),outputs:RP(n.outputs),debugInfo:null}}function DR(n){n.features?.forEach(e=>e(n))}function MP(n,e){if(!n)return null;let t=e?SR:v5;return()=>(typeof n=="function"?n():n).map(i=>t(i)).filter(_5)}function E5(n){let e=0,t=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery].join("|");for(let r of t)e=Math.imul(31,e)+r.charCodeAt(0)<<0;return e+=2147483648,"c"+e}function Qr(n){return{\u0275providers:n}}function T5(...n){return{\u0275providers:PR(!0,n),\u0275fromNgModule:!0}}function PR(n,...e){let t=[],i=new Set,r,s=o=>{t.push(o)};return tw(e,o=>{let a=o;oT(a,s,[],i)&&(r||=[],r.push(a))}),r!==void 0&&RR(r,s),t}function RR(n,e){for(let t=0;t<n.length;t++){let{ngModule:i,providers:r}=n[t];rw(r,s=>{e(s,i)})}}function oT(n,e,t,i){if(n=Ei(n),!n)return!1;let r=null,s=SP(n),o=!s&&Sa(n);if(!s&&!o){let l=n.ngModule;if(s=SP(l),s)r=l;else return!1}else{if(o&&!o.standalone)return!1;r=n}let a=i.has(r);if(o){if(a)return!1;if(i.add(r),o.dependencies){let l=typeof o.dependencies=="function"?o.dependencies():o.dependencies;for(let u of l)oT(u,e,t,i)}}else if(s){if(s.imports!=null&&!a){i.add(r);let u;try{tw(s.imports,d=>{oT(d,e,t,i)&&(u||=[],u.push(d))})}finally{}u!==void 0&&RR(u,e)}if(!a){let u=jl(r)||(()=>new r);e({provide:r,useFactory:u,deps:Cr},r),e({provide:ER,useValue:r,multi:!0},r),e({provide:Ou,useValue:()=>Me(r),multi:!0},r)}let l=s.providers;if(l!=null&&!a){let u=n;rw(l,d=>{e(d,u)})}}else return!1;return r!==n&&n.providers!==void 0}function rw(n,e){for(let t of n)pR(t)&&(t=t.\u0275providers),Array.isArray(t)?rw(t,e):e(t)}var w5=Kt({provide:String,useValue:Kt});function MR(n){return n!==null&&typeof n=="object"&&w5 in n}function b5(n){return!!(n&&n.useExisting)}function I5(n){return!!(n&&n.useFactory)}function Nu(n){return typeof n=="function"}function S5(n){return!!n.useClass}var Yg=new Pe(""),gg={},C5={},GE;function sw(){return GE===void 0&&(GE=new Sg),GE}var wi=class{},zh=class extends wi{get destroyed(){return this._destroyed}constructor(e,t,i,r){super(),this.parent=t,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,lT(e,o=>this.processProvider(o)),this.records.set(_R,xu(void 0,this)),r.has("environment")&&this.records.set(wi,xu(void 0,this));let s=this.records.get(Yg);s!=null&&typeof s.value=="string"&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(ER,Cr,ht.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let e=At(null);try{for(let i of this._ngOnDestroyHooks)i.ngOnDestroy();let t=this._onDestroyHooks;this._onDestroyHooks=[];for(let i of t)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),At(e)}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();let t=Ta(this),i=Vi(void 0),r;try{return e()}finally{Ta(t),Vi(i)}}get(e,t=jh,i=ht.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(xP))return e[xP](this);i=Kg(i);let r,s=Ta(this),o=Vi(void 0);try{if(!(i&ht.SkipSelf)){let l=this.records.get(e);if(l===void 0){let u=R5(e)&&Wg(e);u&&this.injectableDefInScope(u)?l=xu(aT(e),gg):l=null,this.records.set(e,l)}if(l!=null)return this.hydrate(e,l)}let a=i&ht.Self?sw():this.parent;return t=i&ht.Optional&&t===jh?null:t,a.get(e,t)}catch(a){if(a.name==="NullInjectorError"){if((a[bg]=a[bg]||[]).unshift(Ti(e)),s)throw a;return J3(a,e,"R3InjectorError",this.source)}else throw a}finally{Vi(o),Ta(s)}}resolveInjectorInitializers(){let e=At(null),t=Ta(this),i=Vi(void 0),r;try{let s=this.get(Ou,Cr,ht.Self);for(let o of s)o()}finally{Ta(t),Vi(i),At(e)}}toString(){let e=[],t=this.records;for(let i of t.keys())e.push(Ti(i));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ye(205,!1)}processProvider(e){e=Ei(e);let t=Nu(e)?e:Ei(e&&e.provide),i=A5(e);if(!Nu(e)&&e.multi===!0){let r=this.records.get(t);r||(r=xu(void 0,gg,!0),r.factory=()=>rT(r.multi),this.records.set(t,r)),t=e,r.multi.push(e)}this.records.set(t,i)}hydrate(e,t){let i=At(null);try{return t.value===gg&&(t.value=C5,t.value=t.factory()),typeof t.value=="object"&&t.value&&P5(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{At(i)}}injectableDefInScope(e){if(!e.providedIn)return!1;let t=Ei(e.providedIn);return typeof t=="string"?t==="any"||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){let t=this._onDestroyHooks.indexOf(e);t!==-1&&this._onDestroyHooks.splice(t,1)}};function aT(n){let e=Wg(n),t=e!==null?e.factory:jl(n);if(t!==null)return t;if(n instanceof Pe)throw new ye(204,!1);if(n instanceof Function)return x5(n);throw new ye(204,!1)}function x5(n){if(n.length>0)throw new ye(204,!1);let t=V3(n);return t!==null?()=>t.factory(n):()=>new n}function A5(n){if(MR(n))return xu(void 0,n.useValue);{let e=kR(n);return xu(e,gg)}}function kR(n,e,t){let i;if(Nu(n)){let r=Ei(n);return jl(r)||aT(r)}else if(MR(n))i=()=>Ei(n.useValue);else if(I5(n))i=()=>n.useFactory(...rT(n.deps||[]));else if(b5(n))i=()=>Me(Ei(n.useExisting));else{let r=Ei(n&&(n.useClass||n.provide));if(D5(n))i=()=>new r(...rT(n.deps));else return jl(r)||aT(r)}return i}function xu(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function D5(n){return!!n.deps}function P5(n){return n!==null&&typeof n=="object"&&typeof n.ngOnDestroy=="function"}function R5(n){return typeof n=="function"||typeof n=="object"&&n instanceof Pe}function lT(n,e){for(let t of n)Array.isArray(t)?lT(t,e):t&&pR(t)?lT(t.\u0275providers,e):e(t)}function Ar(n,e){n instanceof zh&&n.assertNotDestroyed();let t,i=Ta(n),r=Vi(void 0);try{return e()}finally{Ta(i),Vi(r)}}function LR(){return mR()!==void 0||Q3()!=null}function M5(n){if(!LR())throw new ye(-203,!1)}function k5(n){return typeof n=="function"}var Io=0,st=1,Ke=2,ai=3,Wr=4,Zr=5,Cg=6,xg=7,Kr=8,Fu=9,Cs=10,Vn=11,Hh=12,kP=13,Gu=14,xs=15,Gl=16,Au=17,Eo=18,Qg=19,OR=20,wa=21,zE=22,xr=23,Yr=25,NR=1;var zl=7,Ag=8,Vu=9,ir=10,Dg=function(n){return n[n.None=0]="None",n[n.HasTransplantedViews=2]="HasTransplantedViews",n}(Dg||{});function ba(n){return Array.isArray(n)&&typeof n[NR]=="object"}function So(n){return Array.isArray(n)&&n[NR]===!0}function FR(n){return(n.flags&4)!==0}function Zg(n){return n.componentOffset>-1}function ow(n){return(n.flags&1)===1}function Ca(n){return!!n.template}function cT(n){return(n[Ke]&512)!==0}var uT=class{constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}};function VR(n,e,t,i){e!==null?e.applyValueToInputSignal(e,i):n[t]=i}function Dr(){return BR}function BR(n){return n.type.prototype.ngOnChanges&&(n.setInput=O5),L5}Dr.ngInherit=!0;function L5(){let n=$R(this),e=n?.current;if(e){let t=n.previous;if(t===Lu)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function O5(n,e,t,i,r){let s=this.declaredInputs[i],o=$R(n)||N5(n,{previous:Lu,current:null}),a=o.current||(o.current={}),l=o.previous,u=l[s];a[s]=new uT(u&&u.currentValue,t,l===Lu),VR(n,e,r,t)}var UR="__ngSimpleChanges__";function $R(n){return n[UR]||null}function N5(n,e){return n[UR]=e}var LP=null;var bs=function(n,e,t){LP?.(n,e,t)},jR="svg",F5="math";function As(n){for(;Array.isArray(n);)n=n[Io];return n}function GR(n,e){return As(e[n])}function Pr(n,e){return As(e[n.index])}function zR(n,e){return n.data[e]}function HR(n,e){return n[e]}function Pa(n,e){let t=e[n];return ba(t)?t:t[Io]}function V5(n){return(n[Ke]&4)===4}function aw(n){return(n[Ke]&128)===128}function B5(n){return So(n[ai])}function Pg(n,e){return e==null?null:n[e]}function qR(n){n[Au]=0}function WR(n){n[Ke]&1024||(n[Ke]|=1024,aw(n)&&Jg(n))}function U5(n,e){for(;n>0;)e=e[Gu],n--;return e}function Xg(n){return!!(n[Ke]&9216||n[xr]?.dirty)}function dT(n){n[Cs].changeDetectionScheduler?.notify(8),n[Ke]&64&&(n[Ke]|=1024),Xg(n)&&Jg(n)}function Jg(n){n[Cs].changeDetectionScheduler?.notify(0);let e=Hl(n);for(;e!==null&&!(e[Ke]&8192||(e[Ke]|=8192,!aw(e)));)e=Hl(e)}function KR(n,e){if((n[Ke]&256)===256)throw new ye(911,!1);n[wa]===null&&(n[wa]=[]),n[wa].push(e)}function $5(n,e){if(n[wa]===null)return;let t=n[wa].indexOf(e);t!==-1&&n[wa].splice(t,1)}function Hl(n){let e=n[ai];return So(e)?e[ai]:e}var nt={lFrame:sM(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var YR=!1;function j5(){return nt.lFrame.elementDepthCount}function G5(){nt.lFrame.elementDepthCount++}function z5(){nt.lFrame.elementDepthCount--}function QR(){return nt.bindingsEnabled}function H5(){return nt.skipHydrationRootTNode!==null}function q5(n){return nt.skipHydrationRootTNode===n}function W5(){nt.skipHydrationRootTNode=null}function Rt(){return nt.lFrame.lView}function ui(){return nt.lFrame.tView}function xe(n){return nt.lFrame.contextLView=n,n[Kr]}function Ae(n){return nt.lFrame.contextLView=null,n}function bi(){let n=ZR();for(;n!==null&&n.type===64;)n=n.parent;return n}function ZR(){return nt.lFrame.currentTNode}function K5(){let n=nt.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}function Qh(n,e){let t=nt.lFrame;t.currentTNode=n,t.isParent=e}function XR(){return nt.lFrame.isParent}function Y5(){nt.lFrame.isParent=!1}function Q5(){return nt.lFrame.contextLView}function JR(){return YR}function OP(n){YR=n}function eM(){let n=nt.lFrame,e=n.bindingRootIndex;return e===-1&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function Z5(){return nt.lFrame.bindingIndex}function X5(n){return nt.lFrame.bindingIndex=n}function e0(){return nt.lFrame.bindingIndex++}function tM(n){let e=nt.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}function J5(){return nt.lFrame.inI18n}function e4(n,e){let t=nt.lFrame;t.bindingIndex=t.bindingRootIndex=n,hT(e)}function t4(){return nt.lFrame.currentDirectiveIndex}function hT(n){nt.lFrame.currentDirectiveIndex=n}function n4(n){let e=nt.lFrame.currentDirectiveIndex;return e===-1?null:n[e]}function nM(){return nt.lFrame.currentQueryIndex}function lw(n){nt.lFrame.currentQueryIndex=n}function i4(n){let e=n[st];return e.type===2?e.declTNode:e.type===1?n[Zr]:null}function iM(n,e,t){if(t&ht.SkipSelf){let r=e,s=n;for(;r=r.parent,r===null&&!(t&ht.Host);)if(r=i4(s),r===null||(s=s[Gu],r.type&10))break;if(r===null)return!1;e=r,n=s}let i=nt.lFrame=rM();return i.currentTNode=e,i.lView=n,!0}function cw(n){let e=rM(),t=n[st];nt.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function rM(){let n=nt.lFrame,e=n===null?null:n.child;return e===null?sM(n):e}function sM(n){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return n!==null&&(n.child=e),e}function oM(){let n=nt.lFrame;return nt.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}var aM=oM;function uw(){let n=oM();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function r4(n){return(nt.lFrame.contextLView=U5(n,nt.lFrame.contextLView))[Kr]}function ec(){return nt.lFrame.selectedIndex}function ql(n){nt.lFrame.selectedIndex=n}function dw(){let n=nt.lFrame;return zR(n.tView,n.selectedIndex)}function Re(){nt.lFrame.currentNamespace=jR}function Be(){s4()}function s4(){nt.lFrame.currentNamespace=null}function o4(){return nt.lFrame.currentNamespace}var lM=!0;function hw(){return lM}function fw(n){lM=n}function a4(n,e,t){let{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=e.type.prototype;if(i){let o=BR(e);(t.preOrderHooks??=[]).push(n,o),(t.preOrderCheckHooks??=[]).push(n,o)}r&&(t.preOrderHooks??=[]).push(0-n,r),s&&((t.preOrderHooks??=[]).push(n,s),(t.preOrderCheckHooks??=[]).push(n,s))}function pw(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){let s=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:u,ngOnDestroy:d}=s;o&&(n.contentHooks??=[]).push(-t,o),a&&((n.contentHooks??=[]).push(t,a),(n.contentCheckHooks??=[]).push(t,a)),l&&(n.viewHooks??=[]).push(-t,l),u&&((n.viewHooks??=[]).push(t,u),(n.viewCheckHooks??=[]).push(t,u)),d!=null&&(n.destroyHooks??=[]).push(t,d)}}function yg(n,e,t){cM(n,e,3,t)}function vg(n,e,t,i){(n[Ke]&3)===t&&cM(n,e,t,i)}function HE(n,e){let t=n[Ke];(t&3)===e&&(t&=16383,t+=1,n[Ke]=t)}function cM(n,e,t,i){let r=i!==void 0?n[Au]&65535:0,s=i??-1,o=e.length-1,a=0;for(let l=r;l<o;l++)if(typeof e[l+1]=="number"){if(a=e[l],i!=null&&a>=i)break}else e[l]<0&&(n[Au]+=65536),(a<s||s==-1)&&(l4(n,t,e,l),n[Au]=(n[Au]&4294901760)+l+2),l++}function NP(n,e){bs(4,n,e);let t=At(null);try{e.call(n)}finally{At(t),bs(5,n,e)}}function l4(n,e,t,i){let r=t[i]<0,s=t[i+1],o=r?-t[i]:t[i],a=n[o];r?n[Ke]>>14<n[Au]>>16&&(n[Ke]&3)===e&&(n[Ke]+=16384,NP(a,s)):NP(a,s)}var Mu=-1,Wl=class{constructor(e,t,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=i}};function c4(n){return n instanceof Wl}function u4(n){return(n.flags&8)!==0}function d4(n){return(n.flags&16)!==0}var qE={},fT=class{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,i){i=Kg(i);let r=this.injector.get(e,qE,i);return r!==qE||t===qE?r:this.parentInjector.get(e,t,i)}};function uM(n){return n!==Mu}function Rg(n){return n&32767}function h4(n){return n>>16}function Mg(n,e){let t=h4(n),i=e;for(;t>0;)i=i[Gu],t--;return i}var pT=!0;function kg(n){let e=pT;return pT=n,e}var f4=256,dM=f4-1,hM=5,p4=0,Is={};function m4(n,e,t){let i;typeof t=="string"?i=t.charCodeAt(0)||0:t.hasOwnProperty($h)&&(i=t[$h]),i==null&&(i=t[$h]=p4++);let r=i&dM,s=1<<r;e.data[n+(r>>hM)]|=s}function Lg(n,e){let t=fM(n,e);if(t!==-1)return t;let i=e[st];i.firstCreatePass&&(n.injectorIndex=e.length,WE(i.data,n),WE(e,null),WE(i.blueprint,null));let r=mw(n,e),s=n.injectorIndex;if(uM(r)){let o=Rg(r),a=Mg(r,e),l=a[st].data;for(let u=0;u<8;u++)e[s+u]=a[o+u]|l[o+u]}return e[s+8]=r,s}function WE(n,e){n.push(0,0,0,0,0,0,0,0,e)}function fM(n,e){return n.injectorIndex===-1||n.parent&&n.parent.injectorIndex===n.injectorIndex||e[n.injectorIndex+8]===null?-1:n.injectorIndex}function mw(n,e){if(n.parent&&n.parent.injectorIndex!==-1)return n.parent.injectorIndex;let t=0,i=null,r=e;for(;r!==null;){if(i=vM(r),i===null)return Mu;if(t++,r=r[Gu],i.injectorIndex!==-1)return i.injectorIndex|t<<16}return Mu}function mT(n,e,t){m4(n,e,t)}function g4(n,e){if(e==="class")return n.classes;if(e==="style")return n.styles;let t=n.attrs;if(t){let i=t.length,r=0;for(;r<i;){let s=t[r];if(wR(s))break;if(s===0)r=r+2;else if(typeof s=="number")for(r++;r<i&&typeof t[r]=="string";)r++;else{if(s===e)return t[r+1];r=r+2}}}return null}function pM(n,e,t){if(t&ht.Optional||n!==void 0)return n;JT(e,"NodeInjector")}function mM(n,e,t,i){if(t&ht.Optional&&i===void 0&&(i=null),!(t&(ht.Self|ht.Host))){let r=n[Fu],s=Vi(void 0);try{return r?r.get(e,i,t&ht.Optional):gR(e,i,t&ht.Optional)}finally{Vi(s)}}return pM(i,e,t)}function gM(n,e,t,i=ht.Default,r){if(n!==null){if(e[Ke]&2048&&!(i&ht.Self)){let o=E4(n,e,t,i,Is);if(o!==Is)return o}let s=yM(n,e,t,i,Is);if(s!==Is)return s}return mM(e,t,i,r)}function yM(n,e,t,i,r){let s=v4(t);if(typeof s=="function"){if(!iM(e,n,i))return i&ht.Host?pM(r,t,i):mM(e,t,i,r);try{let o;if(o=s(i),o==null&&!(i&ht.Optional))JT(t);else return o}finally{aM()}}else if(typeof s=="number"){let o=null,a=fM(n,e),l=Mu,u=i&ht.Host?e[xs][Zr]:null;for((a===-1||i&ht.SkipSelf)&&(l=a===-1?mw(n,e):e[a+8],l===Mu||!VP(i,!1)?a=-1:(o=e[st],a=Rg(l),e=Mg(l,e)));a!==-1;){let d=e[st];if(FP(s,a,d.data)){let f=y4(a,e,t,o,i,u);if(f!==Is)return f}l=e[a+8],l!==Mu&&VP(i,e[st].data[a+8]===u)&&FP(s,a,e)?(o=d,a=Rg(l),e=Mg(l,e)):a=-1}}return r}function y4(n,e,t,i,r,s){let o=e[st],a=o.data[n+8],l=i==null?Zg(a)&&pT:i!=o&&(a.type&3)!==0,u=r&ht.Host&&s===a,d=_g(a,o,t,l,u);return d!==null?Kl(e,o,d,a):Is}function _g(n,e,t,i,r){let s=n.providerIndexes,o=e.data,a=s&1048575,l=n.directiveStart,u=n.directiveEnd,d=s>>20,f=i?a:a+d,m=r?a+d:u;for(let y=f;y<m;y++){let v=o[y];if(y<l&&t===v||y>=l&&v.type===t)return y}if(r){let y=o[l];if(y&&Ca(y)&&y.type===t)return l}return null}function Kl(n,e,t,i){let r=n[t],s=e.data;if(c4(r)){let o=r;o.resolving&&H3(z3(s[t]));let a=kg(o.canSeeViewProviders);o.resolving=!0;let l,u=o.injectImpl?Vi(o.injectImpl):null,d=iM(n,i,ht.Default);try{r=n[t]=o.factory(void 0,s,n,i),e.firstCreatePass&&t>=i.directiveStart&&a4(t,s[t],e)}finally{u!==null&&Vi(u),kg(a),o.resolving=!1,aM()}}return r}function v4(n){if(typeof n=="string")return n.charCodeAt(0)||0;let e=n.hasOwnProperty($h)?n[$h]:void 0;return typeof e=="number"?e>=0?e&dM:_4:e}function FP(n,e,t){let i=1<<n;return!!(t[e+(n>>hM)]&i)}function VP(n,e){return!(n&ht.Self)&&!(n&ht.Host&&e)}var $l=class{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return gM(this._tNode,this._lView,e,Kg(i),t)}};function _4(){return new $l(bi(),Rt())}function Ra(n){return Kh(()=>{let e=n.prototype.constructor,t=e[wg]||gT(e),i=Object.prototype,r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){let s=r[wg]||gT(r);if(s&&s!==t)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function gT(n){return uR(n)?()=>{let e=gT(Ei(n));return e&&e()}:jl(n)}function E4(n,e,t,i,r){let s=n,o=e;for(;s!==null&&o!==null&&o[Ke]&2048&&!(o[Ke]&512);){let a=yM(s,o,t,i|ht.Self,Is);if(a!==Is)return a;let l=s.parent;if(!l){let u=o[OR];if(u){let d=u.get(t,Is,i);if(d!==Is)return d}l=vM(o),o=o[Gu]}s=l}return r}function vM(n){let e=n[st],t=e.type;return t===2?e.declTNode:t===1?n[Zr]:null}function gw(n){return g4(bi(),n)}function BP(n,e=null,t=null,i){let r=_M(n,e,t,i);return r.resolveInjectorInitializers(),r}function _M(n,e=null,t=null,i,r=new Set){let s=[t||Cr,T5(n)];return i=i||(typeof n=="object"?void 0:Ti(n)),new zh(s,e||sw(),i||null,r)}var ti=class n{static{this.THROW_IF_NOT_FOUND=jh}static{this.NULL=new Sg}static create(e,t){if(Array.isArray(e))return BP({name:""},t,e,"");{let i=e.name??"";return BP({name:i},e.parent,e.providers,i)}}static{this.\u0275prov=Se({token:n,providedIn:"any",factory:()=>Me(_R)})}static{this.__NG_ELEMENT_ID__=-1}};var T4=new Pe("");T4.__NG_ELEMENT_ID__=n=>{let e=bi();if(e===null)throw new ye(204,!1);if(e.type&2)return e.value;if(n&ht.Optional)return null;throw new ye(204,!1)};var w4="ngOriginalError";function KE(n){return n[w4]}var EM=!0,yw=(()=>{class n{static{this.__NG_ELEMENT_ID__=b4}static{this.__NG_ENV_ID__=t=>t}}return n})(),yT=class extends yw{constructor(e){super(),this._lView=e}onDestroy(e){return KR(this._lView,e),()=>$5(this._lView,e)}};function b4(){return new yT(Rt())}var Ma=(()=>{class n{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new mn(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static{this.\u0275prov=Se({token:n,providedIn:"root",factory:()=>new n})}}return n})();var vT=class extends zn{constructor(e=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=e,LR()&&(this.destroyRef=ue(yw,{optional:!0})??void 0,this.pendingTasks=ue(Ma,{optional:!0})??void 0)}emit(e){let t=At(null);try{super.next(e)}finally{At(t)}}subscribe(e,t,i){let r=e,s=t||(()=>null),o=i;if(e&&typeof e=="object"){let l=e;r=l.next?.bind(l),s=l.error?.bind(l),o=l.complete?.bind(l)}this.__isAsync&&(s=this.wrapInTimeout(s),r&&(r=this.wrapInTimeout(r)),o&&(o=this.wrapInTimeout(o)));let a=super.subscribe({next:r,error:s,complete:o});return e instanceof pn&&e.add(a),a}wrapInTimeout(e){return t=>{let i=this.pendingTasks?.add();setTimeout(()=>{e(t),i!==void 0&&this.pendingTasks?.remove(i)})}}},tt=vT;function Og(...n){}function TM(n){let e,t;function i(){n=Og;try{t!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(t),e!==void 0&&clearTimeout(e)}catch{}}return e=setTimeout(()=>{n(),i()}),typeof requestAnimationFrame=="function"&&(t=requestAnimationFrame(()=>{n(),i()})),()=>i()}function UP(n){return queueMicrotask(()=>n()),()=>{n=Og}}var vw="isAngularZone",Ng=vw+"_ID",I4=0,Dt=class n{constructor(e){this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new tt(!1),this.onMicrotaskEmpty=new tt(!1),this.onStable=new tt(!1),this.onError=new tt(!1);let{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:r=!1,scheduleInRootZone:s=EM}=e;if(typeof Zone>"u")throw new ye(908,!1);Zone.assertZonePatched();let o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&i,o.shouldCoalesceRunChangeDetection=r,o.callbackScheduled=!1,o.scheduleInRootZone=s,x4(o)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(vw)===!0}static assertInAngularZone(){if(!n.isInAngularZone())throw new ye(909,!1)}static assertNotInAngularZone(){if(n.isInAngularZone())throw new ye(909,!1)}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,r){let s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+r,e,S4,Og,Og);try{return s.runTask(o,t,i)}finally{s.cancelTask(o)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}},S4={};function _w(n){if(n._nesting==0&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function C4(n){if(n.isCheckStableRunning||n.callbackScheduled)return;n.callbackScheduled=!0;function e(){TM(()=>{n.callbackScheduled=!1,_T(n),n.isCheckStableRunning=!0,_w(n),n.isCheckStableRunning=!1})}n.scheduleInRootZone?Zone.root.run(()=>{e()}):n._outer.run(()=>{e()}),_T(n)}function x4(n){let e=()=>{C4(n)},t=I4++;n._inner=n._inner.fork({name:"angular",properties:{[vw]:!0,[Ng]:t,[Ng+t]:!0},onInvokeTask:(i,r,s,o,a,l)=>{if(A4(l))return i.invokeTask(s,o,a,l);try{return $P(n),i.invokeTask(s,o,a,l)}finally{(n.shouldCoalesceEventChangeDetection&&o.type==="eventTask"||n.shouldCoalesceRunChangeDetection)&&e(),jP(n)}},onInvoke:(i,r,s,o,a,l,u)=>{try{return $P(n),i.invoke(s,o,a,l,u)}finally{n.shouldCoalesceRunChangeDetection&&!n.callbackScheduled&&!D4(l)&&e(),jP(n)}},onHasTask:(i,r,s,o)=>{i.hasTask(s,o),r===s&&(o.change=="microTask"?(n._hasPendingMicrotasks=o.microTask,_T(n),_w(n)):o.change=="macroTask"&&(n.hasPendingMacrotasks=o.macroTask))},onHandleError:(i,r,s,o)=>(i.handleError(s,o),n.runOutsideAngular(()=>n.onError.emit(o)),!1)})}function _T(n){n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&n.callbackScheduled===!0?n.hasPendingMicrotasks=!0:n.hasPendingMicrotasks=!1}function $P(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function jP(n){n._nesting--,_w(n)}var ET=class{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new tt,this.onMicrotaskEmpty=new tt,this.onStable=new tt,this.onError=new tt}run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,r){return e.apply(t,i)}};function A4(n){return wM(n,"__ignore_ng_zone__")}function D4(n){return wM(n,"__scheduler_tick__")}function wM(n,e){return!Array.isArray(n)||n.length!==1?!1:n[0]?.data?.[e]===!0}var To=class{constructor(){this._console=console}handleError(e){let t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&KE(e);for(;t&&KE(t);)t=KE(t);return t||null}},P4=new Pe("",{providedIn:"root",factory:()=>{let n=ue(Dt),e=ue(To);return t=>n.runOutsideAngular(()=>e.handleError(t))}});function R4(){return zu(bi(),Rt())}function zu(n,e){return new Xr(Pr(n,e))}var Xr=(()=>{class n{constructor(t){this.nativeElement=t}static{this.__NG_ELEMENT_ID__=R4}}return n})();function M4(n){return n instanceof Xr?n.nativeElement:n}function k4(){return this._results[Symbol.iterator]()}var TT=class n{get changes(){return this._changes??=new tt}constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let t=n.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=k4)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){this.dirty=!1;let i=n5(e);(this._changesDetected=!t5(this._results,i,t))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(e){this._onDirty=e}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function bM(n){return(n.flags&128)===128}var IM=new Map,L4=0;function O4(){return L4++}function N4(n){IM.set(n[Qg],n)}function wT(n){IM.delete(n[Qg])}var GP="__ngContext__";function Yl(n,e){ba(e)?(n[GP]=e[Qg],N4(e)):n[GP]=e}function SM(n){return xM(n[Hh])}function CM(n){return xM(n[Wr])}function xM(n){for(;n!==null&&!So(n);)n=n[Wr];return n}var bT;function AM(n){bT=n}function F4(){if(bT!==void 0)return bT;if(typeof document<"u")return document;throw new ye(210,!1)}var Ew=new Pe("",{providedIn:"root",factory:()=>V4}),V4="ng",Tw=new Pe(""),Bi=new Pe("",{providedIn:"platform",factory:()=>"unknown"});var ww=new Pe(""),bw=new Pe("",{providedIn:"root",factory:()=>F4().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var B4="h",U4="b";var $4=()=>null;function Iw(n,e,t=!1){return $4(n,e,t)}var DM=!1,j4=new Pe("",{providedIn:"root",factory:()=>DM});var hg;function G4(){if(hg===void 0&&(hg=null,Ul.trustedTypes))try{hg=Ul.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return hg}function zP(n){return G4()?.createScriptURL(n)||n}var Fg=class{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${lR})`}};function Zh(n){return n instanceof Fg?n.changingThisBreaksApplicationSecurity:n}function Sw(n,e){let t=z4(n);if(t!=null&&t!==e){if(t==="ResourceURL"&&e==="URL")return!0;throw new Error(`Required a safe ${e}, got a ${t} (see ${lR})`)}return t===e}function z4(n){return n instanceof Fg&&n.getTypeName()||null}var H4=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function PM(n){return n=String(n),n.match(H4)?n:"unsafe:"+n}var t0=function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n}(t0||{});function Jr(n){let e=MM();return e?e.sanitize(t0.URL,n)||"":Sw(n,"URL")?Zh(n):PM(ku(n))}function q4(n){let e=MM();if(e)return zP(e.sanitize(t0.RESOURCE_URL,n)||"");if(Sw(n,"ResourceURL"))return zP(Zh(n));throw new ye(904,!1)}function W4(n,e){return e==="src"&&(n==="embed"||n==="frame"||n==="iframe"||n==="media"||n==="script")||e==="href"&&(n==="base"||n==="link")?q4:Jr}function RM(n,e,t){return W4(e,t)(n)}function MM(){let n=Rt();return n&&n[Cs].sanitizer}function kM(n){return n instanceof Function?n():n}function K4(n){return(n??ue(ti)).get(Bi)==="browser"}var wo=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(wo||{}),Y4;function Cw(n,e){return Y4(n,e)}function Du(n,e,t,i,r){if(i!=null){let s,o=!1;So(i)?s=i:ba(i)&&(o=!0,i=i[Io]);let a=As(i);n===0&&t!==null?r==null?VM(e,t,a):Vg(e,t,a,r||null,!0):n===1&&t!==null?Vg(e,t,a,r||null,!0):n===2?uj(e,a,o):n===3&&e.destroyNode(a),s!=null&&hj(e,n,s,t,r)}}function Q4(n,e){return n.createText(e)}function Z4(n,e,t){n.setValue(e,t)}function LM(n,e,t){return n.createElement(e,t)}function X4(n,e){OM(n,e),e[Io]=null,e[Zr]=null}function J4(n,e,t,i,r,s){i[Io]=r,i[Zr]=e,n0(n,i,t,1,r,s)}function OM(n,e){e[Cs].changeDetectionScheduler?.notify(9),n0(n,e,e[Vn],2,null,null)}function ej(n){let e=n[Hh];if(!e)return YE(n[st],n);for(;e;){let t=null;if(ba(e))t=e[Hh];else{let i=e[ir];i&&(t=i)}if(!t){for(;e&&!e[Wr]&&e!==n;)ba(e)&&YE(e[st],e),e=e[ai];e===null&&(e=n),ba(e)&&YE(e[st],e),t=e&&e[Wr]}e=t}}function tj(n,e,t,i){let r=ir+i,s=t.length;i>0&&(t[r-1][Wr]=e),i<s-ir?(e[Wr]=t[r],vR(t,ir+i,e)):(t.push(e),e[Wr]=null),e[ai]=t;let o=e[Gl];o!==null&&t!==o&&NM(o,e);let a=e[Eo];a!==null&&a.insertView(n),dT(e),e[Ke]|=128}function NM(n,e){let t=n[Vu],i=e[ai];if(ba(i))n[Ke]|=Dg.HasTransplantedViews;else{let r=i[ai][xs];e[xs]!==r&&(n[Ke]|=Dg.HasTransplantedViews)}t===null?n[Vu]=[e]:t.push(e)}function xw(n,e){let t=n[Vu],i=t.indexOf(e);t.splice(i,1)}function IT(n,e){if(n.length<=ir)return;let t=ir+e,i=n[t];if(i){let r=i[Gl];r!==null&&r!==n&&xw(r,i),e>0&&(n[t-1][Wr]=i[Wr]);let s=Ig(n,ir+e);X4(i[st],i);let o=s[Eo];o!==null&&o.detachView(s[st]),i[ai]=null,i[Wr]=null,i[Ke]&=-129}return i}function FM(n,e){if(!(e[Ke]&256)){let t=e[Vn];t.destroyNode&&n0(n,e,t,3,null,null),ej(e)}}function YE(n,e){if(e[Ke]&256)return;let t=At(null);try{e[Ke]&=-129,e[Ke]|=256,e[xr]&&EE(e[xr]),ij(n,e),nj(n,e),e[st].type===1&&e[Vn].destroy();let i=e[Gl];if(i!==null&&So(e[ai])){i!==e[ai]&&xw(i,e);let r=e[Eo];r!==null&&r.detachView(n)}wT(e)}finally{At(t)}}function nj(n,e){let t=n.cleanup,i=e[xg];if(t!==null)for(let s=0;s<t.length-1;s+=2)if(typeof t[s]=="string"){let o=t[s+3];o>=0?i[o]():i[-o].unsubscribe(),s+=2}else{let o=i[t[s+1]];t[s].call(o)}i!==null&&(e[xg]=null);let r=e[wa];if(r!==null){e[wa]=null;for(let s=0;s<r.length;s++){let o=r[s];o()}}}function ij(n,e){let t;if(n!=null&&(t=n.destroyHooks)!=null)for(let i=0;i<t.length;i+=2){let r=e[t[i]];if(!(r instanceof Wl)){let s=t[i+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){let a=r[s[o]],l=s[o+1];bs(4,a,l);try{l.call(a)}finally{bs(5,a,l)}}else{bs(4,r,s);try{s.call(r)}finally{bs(5,r,s)}}}}}function rj(n,e,t){return sj(n,e.parent,t)}function sj(n,e,t){let i=e;for(;i!==null&&i.type&168;)e=i,i=e.parent;if(i===null)return t[Io];{let{componentOffset:r}=i;if(r>-1){let{encapsulation:s}=n.data[i.directiveStart+r];if(s===Ss.None||s===Ss.Emulated)return null}return Pr(i,t)}}function Vg(n,e,t,i,r){n.insertBefore(e,t,i,r)}function VM(n,e,t){n.appendChild(e,t)}function HP(n,e,t,i,r){i!==null?Vg(n,e,t,i,r):VM(n,e,t)}function BM(n,e){return n.parentNode(e)}function oj(n,e){return n.nextSibling(e)}function aj(n,e,t){return cj(n,e,t)}function lj(n,e,t){return n.type&40?Pr(n,t):null}var cj=lj,qP;function Aw(n,e,t,i){let r=rj(n,i,e),s=e[Vn],o=i.parent||e[Zr],a=aj(o,i,e);if(r!=null)if(Array.isArray(t))for(let l=0;l<t.length;l++)HP(s,r,t[l],a,!1);else HP(s,r,t,a,!1);qP!==void 0&&qP(s,i,e,t,r)}function Uh(n,e){if(e!==null){let t=e.type;if(t&3)return Pr(e,n);if(t&4)return ST(-1,n[e.index]);if(t&8){let i=e.child;if(i!==null)return Uh(n,i);{let r=n[e.index];return So(r)?ST(-1,r):As(r)}}else{if(t&128)return Uh(n,e.next);if(t&32)return Cw(e,n)()||As(n[e.index]);{let i=UM(n,e);if(i!==null){if(Array.isArray(i))return i[0];let r=Hl(n[xs]);return Uh(r,i)}else return Uh(n,e.next)}}}return null}function UM(n,e){if(e!==null){let i=n[xs][Zr],r=e.projection;return i.projection[r]}return null}function ST(n,e){let t=ir+n+1;if(t<e.length){let i=e[t],r=i[st].firstChild;if(r!==null)return Uh(i,r)}return e[zl]}function uj(n,e,t){n.removeChild(null,e,t)}function Dw(n,e,t,i,r,s,o){for(;t!=null;){if(t.type===128){t=t.next;continue}let a=i[t.index],l=t.type;if(o&&e===0&&(a&&Yl(As(a),i),t.flags|=2),(t.flags&32)!==32)if(l&8)Dw(n,e,t.child,i,r,s,!1),Du(e,n,r,a,s);else if(l&32){let u=Cw(t,i),d;for(;d=u();)Du(e,n,r,d,s);Du(e,n,r,a,s)}else l&16?dj(n,e,i,t,r,s):Du(e,n,r,a,s);t=o?t.projectionNext:t.next}}function n0(n,e,t,i,r,s){Dw(t,i,n.firstChild,e,r,s,!1)}function dj(n,e,t,i,r,s){let o=t[xs],l=o[Zr].projection[i.projection];if(Array.isArray(l))for(let u=0;u<l.length;u++){let d=l[u];Du(e,n,r,d,s)}else{let u=l,d=o[ai];bM(i)&&(u.flags|=128),Dw(n,e,u,d,r,s,!0)}}function hj(n,e,t,i,r){let s=t[zl],o=As(t);s!==o&&Du(e,n,i,s,r);for(let a=ir;a<t.length;a++){let l=t[a];n0(l[st],l,n,e,i,s)}}function fj(n,e,t,i,r){if(e)r?n.addClass(t,i):n.removeClass(t,i);else{let s=i.indexOf("-")===-1?void 0:wo.DashCase;r==null?n.removeStyle(t,i,s):(typeof r=="string"&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=wo.Important),n.setStyle(t,i,r,s))}}function pj(n,e,t){n.setAttribute(e,"style",t)}function $M(n,e,t){t===""?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function jM(n,e,t){let{mergedAttrs:i,classes:r,styles:s}=t;i!==null&&sT(n,e,i),r!==null&&$M(n,e,r),s!==null&&pj(n,e,s)}var Rs={};function W(n=1){GM(ui(),Rt(),ec()+n,!1)}function GM(n,e,t,i){if(!i)if((e[Ke]&3)===3){let s=n.preOrderCheckHooks;s!==null&&yg(e,s,t)}else{let s=n.preOrderHooks;s!==null&&vg(e,s,0,t)}ql(t)}function pe(n,e=ht.Default){let t=Rt();if(t===null)return Me(n,e);let i=bi();return gM(i,t,Ei(n),e)}function zM(){let n="invalid";throw new Error(n)}function HM(n,e,t,i,r,s){let o=At(null);try{let a=null;r&Ia.SignalBased&&(a=e[i][yo]),a!==null&&a.transformFn!==void 0&&(s=a.transformFn(s)),r&Ia.HasDecoratorInputTransform&&(s=n.inputTransforms[i].call(e,s)),n.setInput!==null?n.setInput(e,a,s,t,i):VR(e,a,i,s)}finally{At(o)}}function mj(n,e){let t=n.hostBindingOpCodes;if(t!==null)try{for(let i=0;i<t.length;i++){let r=t[i];if(r<0)ql(~r);else{let s=r,o=t[++i],a=t[++i];e4(o,s);let l=e[s];a(2,l)}}}finally{ql(-1)}}function i0(n,e,t,i,r,s,o,a,l,u,d){let f=e.blueprint.slice();return f[Io]=r,f[Ke]=i|4|128|8|64,(u!==null||n&&n[Ke]&2048)&&(f[Ke]|=2048),qR(f),f[ai]=f[Gu]=n,f[Kr]=t,f[Cs]=o||n&&n[Cs],f[Vn]=a||n&&n[Vn],f[Fu]=l||n&&n[Fu]||null,f[Zr]=s,f[Qg]=O4(),f[Cg]=d,f[OR]=u,f[xs]=e.type==2?n[xs]:f,f}function r0(n,e,t,i,r){let s=n.data[e];if(s===null)s=gj(n,e,t,i,r),J5()&&(s.flags|=32);else if(s.type&64){s.type=t,s.value=i,s.attrs=r;let o=K5();s.injectorIndex=o===null?-1:o.injectorIndex}return Qh(s,!0),s}function gj(n,e,t,i,r){let s=ZR(),o=XR(),a=o?s:s&&s.parent,l=n.data[e]=wj(n,a,t,e,i,r);return n.firstChild===null&&(n.firstChild=l),s!==null&&(o?s.child==null&&l.parent!==null&&(s.child=l):s.next===null&&(s.next=l,l.prev=s)),l}function qM(n,e,t,i){if(t===0)return-1;let r=e.length;for(let s=0;s<t;s++)e.push(i),n.blueprint.push(i),n.data.push(null);return r}function WM(n,e,t,i,r){let s=ec(),o=i&2;try{ql(-1),o&&e.length>Yr&&GM(n,e,Yr,!1),bs(o?2:0,r),t(i,r)}finally{ql(s),bs(o?3:1,r)}}function KM(n,e,t){if(FR(e)){let i=At(null);try{let r=e.directiveStart,s=e.directiveEnd;for(let o=r;o<s;o++){let a=n.data[o];if(a.contentQueries){let l=t[o];a.contentQueries(1,l,o)}}}finally{At(i)}}}function YM(n,e,t){QR()&&(Aj(n,e,t,Pr(t,e)),(t.flags&64)===64&&tk(n,e,t))}function QM(n,e,t=Pr){let i=e.localNames;if(i!==null){let r=e.index+1;for(let s=0;s<i.length;s+=2){let o=i[s+1],a=o===-1?t(e,n):n[o];n[r++]=a}}}function ZM(n){let e=n.tView;return e===null||e.incompleteFirstPass?n.tView=Pw(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):e}function Pw(n,e,t,i,r,s,o,a,l,u,d){let f=Yr+i,m=f+r,y=yj(f,m),v=typeof u=="function"?u():u;return y[st]={type:n,blueprint:y,template:t,queries:null,viewQuery:a,declTNode:e,data:y.slice().fill(null,f),bindingStartIndex:f,expandoStartIndex:m,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof s=="function"?s():s,pipeRegistry:typeof o=="function"?o():o,firstChild:null,schemas:l,consts:v,incompleteFirstPass:!1,ssrId:d}}function yj(n,e){let t=[];for(let i=0;i<e;i++)t.push(i<n?null:Rs);return t}function vj(n,e,t,i){let s=i.get(j4,DM)||t===Ss.ShadowDom,o=n.selectRootElement(e,s);return _j(o),o}function _j(n){Ej(n)}var Ej=()=>null;function Tj(n,e,t,i){let r=rk(e);r.push(t),n.firstCreatePass&&sk(n).push(i,r.length-1)}function wj(n,e,t,i,r,s){let o=e?e.injectorIndex:-1,a=0;return H5()&&(a|=128),{type:t,index:i,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function WP(n,e,t,i,r){for(let s in e){if(!e.hasOwnProperty(s))continue;let o=e[s];if(o===void 0)continue;i??={};let a,l=Ia.None;Array.isArray(o)?(a=o[0],l=o[1]):a=o;let u=s;if(r!==null){if(!r.hasOwnProperty(s))continue;u=r[s]}n===0?KP(i,t,u,a,l):KP(i,t,u,a)}return i}function KP(n,e,t,i,r){let s;n.hasOwnProperty(t)?(s=n[t]).push(e,i):s=n[t]=[e,i],r!==void 0&&s.push(r)}function bj(n,e,t){let i=e.directiveStart,r=e.directiveEnd,s=n.data,o=e.attrs,a=[],l=null,u=null;for(let d=i;d<r;d++){let f=s[d],m=t?t.get(f):null,y=m?m.inputs:null,v=m?m.outputs:null;l=WP(0,f.inputs,d,l,y),u=WP(1,f.outputs,d,u,v);let E=l!==null&&o!==null&&!nw(e)?Bj(l,d,o):null;a.push(E)}l!==null&&(l.hasOwnProperty("class")&&(e.flags|=8),l.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=l,e.outputs=u}function Ij(n){return n==="class"?"className":n==="for"?"htmlFor":n==="formaction"?"formAction":n==="innerHtml"?"innerHTML":n==="readonly"?"readOnly":n==="tabindex"?"tabIndex":n}function XM(n,e,t,i,r,s,o,a){let l=Pr(e,t),u=e.inputs,d;!a&&u!=null&&(d=u[i])?(Rw(n,t,d,i,r),Zg(e)&&Sj(t,e.index)):e.type&3?(i=Ij(i),r=o!=null?o(r,e.value||"",i):r,s.setProperty(l,i,r)):e.type&12}function Sj(n,e){let t=Pa(e,n);t[Ke]&16||(t[Ke]|=64)}function JM(n,e,t,i){if(QR()){let r=i===null?null:{"":-1},s=Pj(n,t),o,a;s===null?o=a=null:[o,a]=s,o!==null&&ek(n,e,t,o,r,a),r&&Rj(t,i,r)}t.mergedAttrs=Gh(t.mergedAttrs,t.attrs)}function ek(n,e,t,i,r,s){for(let u=0;u<i.length;u++)mT(Lg(t,e),n,i[u].type);kj(t,n.data.length,i.length);for(let u=0;u<i.length;u++){let d=i[u];d.providersResolver&&d.providersResolver(d)}let o=!1,a=!1,l=qM(n,e,i.length,null);for(let u=0;u<i.length;u++){let d=i[u];t.mergedAttrs=Gh(t.mergedAttrs,d.hostAttrs),Lj(n,t,e,l,d),Mj(l,d,r),d.contentQueries!==null&&(t.flags|=4),(d.hostBindings!==null||d.hostAttrs!==null||d.hostVars!==0)&&(t.flags|=64);let f=d.type.prototype;!o&&(f.ngOnChanges||f.ngOnInit||f.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),o=!0),!a&&(f.ngOnChanges||f.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),a=!0),l++}bj(n,t,s)}function Cj(n,e,t,i,r){let s=r.hostBindings;if(s){let o=n.hostBindingOpCodes;o===null&&(o=n.hostBindingOpCodes=[]);let a=~e.index;xj(o)!=a&&o.push(a),o.push(t,i,s)}}function xj(n){let e=n.length;for(;e>0;){let t=n[--e];if(typeof t=="number"&&t<0)return t}return 0}function Aj(n,e,t,i){let r=t.directiveStart,s=t.directiveEnd;Zg(t)&&Oj(e,t,n.data[r+t.componentOffset]),n.firstCreatePass||Lg(t,e),Yl(i,e);let o=t.initialInputs;for(let a=r;a<s;a++){let l=n.data[a],u=Kl(e,n,a,t);if(Yl(u,e),o!==null&&Vj(e,a-r,u,l,t,o),Ca(l)){let d=Pa(t.index,e);d[Kr]=Kl(e,n,a,t)}}}function tk(n,e,t){let i=t.directiveStart,r=t.directiveEnd,s=t.index,o=t4();try{ql(s);for(let a=i;a<r;a++){let l=n.data[a],u=e[a];hT(a),(l.hostBindings!==null||l.hostVars!==0||l.hostAttrs!==null)&&Dj(l,u)}}finally{ql(-1),hT(o)}}function Dj(n,e){n.hostBindings!==null&&n.hostBindings(1,e)}function Pj(n,e){let t=n.directiveRegistry,i=null,r=null;if(t)for(let s=0;s<t.length;s++){let o=t[s];if(h5(e,o.selectors,!1))if(i||(i=[]),Ca(o))if(o.findHostDirectiveDefs!==null){let a=[];r=r||new Map,o.findHostDirectiveDefs(o,a,r),i.unshift(...a,o);let l=a.length;CT(n,e,l)}else i.unshift(o),CT(n,e,0);else r=r||new Map,o.findHostDirectiveDefs?.(o,i,r),i.push(o)}return i===null?null:[i,r]}function CT(n,e,t){e.componentOffset=t,(n.components??=[]).push(e.index)}function Rj(n,e,t){if(e){let i=n.localNames=[];for(let r=0;r<e.length;r+=2){let s=t[e[r+1]];if(s==null)throw new ye(-301,!1);i.push(e[r],s)}}}function Mj(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;Ca(e)&&(t[""]=n)}}function kj(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function Lj(n,e,t,i,r){n.data[i]=r;let s=r.factory||(r.factory=jl(r.type,!0)),o=new Wl(s,Ca(r),pe);n.blueprint[i]=o,t[i]=o,Cj(n,e,i,qM(n,t,r.hostVars,Rs),r)}function Oj(n,e,t){let i=Pr(e,n),r=ZM(t),s=n[Cs].rendererFactory,o=16;t.signals?o=4096:t.onPush&&(o=64);let a=s0(n,i0(n,r,null,o,i,e,null,s.createRenderer(i,t),null,null,null));n[e.index]=a}function Nj(n,e,t,i,r,s){let o=Pr(n,e);Fj(e[Vn],o,s,n.value,t,i,r)}function Fj(n,e,t,i,r,s,o){if(s==null)n.removeAttribute(e,r,t);else{let a=o==null?ku(s):o(s,i||"",r);n.setAttribute(e,r,a,t)}}function Vj(n,e,t,i,r,s){let o=s[e];if(o!==null)for(let a=0;a<o.length;){let l=o[a++],u=o[a++],d=o[a++],f=o[a++];HM(i,t,l,u,d,f)}}function Bj(n,e,t){let i=null,r=0;for(;r<t.length;){let s=t[r];if(s===0){r+=4;continue}else if(s===5){r+=2;continue}if(typeof s=="number")break;if(n.hasOwnProperty(s)){i===null&&(i=[]);let o=n[s];for(let a=0;a<o.length;a+=3)if(o[a]===e){i.push(s,o[a+1],o[a+2],t[r+1]);break}}r+=2}return i}function nk(n,e,t,i){return[n,!0,0,e,null,i,null,t,null,null]}function ik(n,e){let t=n.contentQueries;if(t!==null){let i=At(null);try{for(let r=0;r<t.length;r+=2){let s=t[r],o=t[r+1];if(o!==-1){let a=n.data[o];lw(s),a.contentQueries(2,e[o],o)}}}finally{At(i)}}}function s0(n,e){return n[Hh]?n[kP][Wr]=e:n[Hh]=e,n[kP]=e,e}function xT(n,e,t){lw(0);let i=At(null);try{e(n,t)}finally{At(i)}}function rk(n){return n[xg]??=[]}function sk(n){return n.cleanup??=[]}function ok(n,e){let t=n[Fu],i=t?t.get(To,null):null;i&&i.handleError(e)}function Rw(n,e,t,i,r){for(let s=0;s<t.length;){let o=t[s++],a=t[s++],l=t[s++],u=e[o],d=n.data[o];HM(d,u,i,a,l,r)}}function ak(n,e,t){let i=GR(e,n);Z4(n[Vn],i,t)}function Uj(n,e){let t=Pa(e,n),i=t[st];$j(i,t);let r=t[Io];r!==null&&t[Cg]===null&&(t[Cg]=Iw(r,t[Fu])),Mw(i,t,t[Kr])}function $j(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])}function Mw(n,e,t){cw(e);try{let i=n.viewQuery;i!==null&&xT(1,i,t);let r=n.template;r!==null&&WM(n,e,r,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),e[Eo]?.finishViewCreation(n),n.staticContentQueries&&ik(n,e),n.staticViewQueries&&xT(2,n.viewQuery,t);let s=n.components;s!==null&&jj(e,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[Ke]&=-5,uw()}}function jj(n,e){for(let t=0;t<e.length;t++)Uj(n,e[t])}function Gj(n,e,t,i){let r=At(null);try{let s=e.tView,a=n[Ke]&4096?4096:16,l=i0(n,s,t,a,null,e,null,null,i?.injector??null,i?.embeddedViewInjector??null,i?.dehydratedView??null),u=n[e.index];l[Gl]=u;let d=n[Eo];return d!==null&&(l[Eo]=d.createEmbeddedView(s)),Mw(s,l,t),l}finally{At(r)}}function YP(n,e){return!e||e.firstChild===null||bM(n)}function zj(n,e,t,i=!0){let r=e[st];if(tj(r,e,n,t),i){let o=ST(t,n),a=e[Vn],l=BM(a,n[zl]);l!==null&&J4(r,n[Zr],a,e,l,o)}let s=e[Cg];s!==null&&s.firstChild!==null&&(s.firstChild=null)}function Bg(n,e,t,i,r=!1){for(;t!==null;){if(t.type===128){t=r?t.projectionNext:t.next;continue}let s=e[t.index];s!==null&&i.push(As(s)),So(s)&&Hj(s,i);let o=t.type;if(o&8)Bg(n,e,t.child,i);else if(o&32){let a=Cw(t,e),l;for(;l=a();)i.push(l)}else if(o&16){let a=UM(e,t);if(Array.isArray(a))i.push(...a);else{let l=Hl(e[xs]);Bg(l[st],l,a,i,!0)}}t=r?t.projectionNext:t.next}return i}function Hj(n,e){for(let t=ir;t<n.length;t++){let i=n[t],r=i[st].firstChild;r!==null&&Bg(i[st],i,r,e)}n[zl]!==n[Io]&&e.push(n[zl])}var lk=[];function qj(n){return n[xr]??Wj(n)}function Wj(n){let e=lk.pop()??Object.create(Yj);return e.lView=n,e}function Kj(n){n.lView[xr]!==n&&(n.lView=null,lk.push(n))}var Yj=qe(de({},Nh),{consumerIsAlwaysLive:!0,consumerMarkedDirty:n=>{Jg(n.lView)},consumerOnSignalRead(){this.lView[xr]=this}});function Qj(n){let e=n[xr]??Object.create(Zj);return e.lView=n,e}var Zj=qe(de({},Nh),{consumerIsAlwaysLive:!0,consumerMarkedDirty:n=>{let e=Hl(n.lView);for(;e&&!ck(e[st]);)e=Hl(e);e&&WR(e)},consumerOnSignalRead(){this.lView[xr]=this}});function ck(n){return n.type!==2}var Xj=100;function uk(n,e=!0,t=0){let i=n[Cs],r=i.rendererFactory,s=!1;s||r.begin?.();try{Jj(n,t)}catch(o){throw e&&ok(n,o),o}finally{s||(r.end?.(),i.inlineEffectRunner?.flush())}}function Jj(n,e){let t=JR();try{OP(!0),AT(n,e);let i=0;for(;Xg(n);){if(i===Xj)throw new ye(103,!1);i++,AT(n,1)}}finally{OP(t)}}function e6(n,e,t,i){let r=e[Ke];if((r&256)===256)return;let s=!1,o=!1;!s&&e[Cs].inlineEffectRunner?.flush(),cw(e);let a=!0,l=null,u=null;s||(ck(n)?(u=qj(e),l=Vm(u)):B1()===null?(a=!1,u=Qj(e),l=Vm(u)):e[xr]&&(EE(e[xr]),e[xr]=null));try{qR(e),X5(n.bindingStartIndex),t!==null&&WM(n,e,t,2,i);let d=(r&3)===3;if(!s)if(d){let y=n.preOrderCheckHooks;y!==null&&yg(e,y,null)}else{let y=n.preOrderHooks;y!==null&&vg(e,y,0,null),HE(e,0)}if(o||t6(e),dk(e,0),n.contentQueries!==null&&ik(n,e),!s)if(d){let y=n.contentCheckHooks;y!==null&&yg(e,y)}else{let y=n.contentHooks;y!==null&&vg(e,y,1),HE(e,1)}mj(n,e);let f=n.components;f!==null&&fk(e,f,0);let m=n.viewQuery;if(m!==null&&xT(2,m,i),!s)if(d){let y=n.viewCheckHooks;y!==null&&yg(e,y)}else{let y=n.viewHooks;y!==null&&vg(e,y,2),HE(e,2)}if(n.firstUpdatePass===!0&&(n.firstUpdatePass=!1),e[zE]){for(let y of e[zE])y();e[zE]=null}s||(e[Ke]&=-73)}catch(d){throw s||Jg(e),d}finally{u!==null&&(vE(u,l),a&&Kj(u)),uw()}}function dk(n,e){for(let t=SM(n);t!==null;t=CM(t))for(let i=ir;i<t.length;i++){let r=t[i];hk(r,e)}}function t6(n){for(let e=SM(n);e!==null;e=CM(e)){if(!(e[Ke]&Dg.HasTransplantedViews))continue;let t=e[Vu];for(let i=0;i<t.length;i++){let r=t[i];WR(r)}}}function n6(n,e,t){let i=Pa(e,n);hk(i,t)}function hk(n,e){aw(n)&&AT(n,e)}function AT(n,e){let i=n[st],r=n[Ke],s=n[xr],o=!!(e===0&&r&16);if(o||=!!(r&64&&e===0),o||=!!(r&1024),o||=!!(s?.dirty&&_E(s)),o||=!1,s&&(s.dirty=!1),n[Ke]&=-9217,o)e6(i,n,i.template,n[Kr]);else if(r&8192){dk(n,1);let a=i.components;a!==null&&fk(n,a,1)}}function fk(n,e,t){for(let i=0;i<e.length;i++)n6(n,e[i],t)}function kw(n,e){let t=JR()?64:1088;for(n[Cs].changeDetectionScheduler?.notify(e);n;){n[Ke]|=t;let i=Hl(n);if(cT(n)&&!i)return n;n=i}return null}var Ql=class{get rootNodes(){let e=this._lView,t=e[st];return Bg(t,e,t.firstChild,[])}constructor(e,t,i=!0){this._lView=e,this._cdRefInjectingView=t,this.notifyErrorHandler=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Kr]}set context(e){this._lView[Kr]=e}get destroyed(){return(this._lView[Ke]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[ai];if(So(e)){let t=e[Ag],i=t?t.indexOf(this):-1;i>-1&&(IT(e,i),Ig(t,i))}this._attachedToViewContainer=!1}FM(this._lView[st],this._lView)}onDestroy(e){KR(this._lView,e)}markForCheck(){kw(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Ke]&=-129}reattach(){dT(this._lView),this._lView[Ke]|=128}detectChanges(){this._lView[Ke]|=1024,uk(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ye(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let e=cT(this._lView),t=this._lView[Gl];t!==null&&!e&&xw(t,this._lView),OM(this._lView[st],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new ye(902,!1);this._appRef=e;let t=cT(this._lView),i=this._lView[Gl];i!==null&&!t&&NM(i,this._lView),dT(this._lView)}},Zl=(()=>{class n{static{this.__NG_ELEMENT_ID__=s6}}return n})(),i6=Zl,r6=class extends i6{constructor(e,t,i){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,t){return this.createEmbeddedViewImpl(e,t)}createEmbeddedViewImpl(e,t,i){let r=Gj(this._declarationLView,this._declarationTContainer,e,{embeddedViewInjector:t,dehydratedView:i});return new Ql(r)}};function s6(){return o0(bi(),Rt())}function o0(n,e){return n.type&4?new r6(e,n,zu(n,e)):null}var Oue=new RegExp(`^(\\d+)*(${U4}|${B4})*(.*)`);var o6=()=>null;function QP(n,e){return o6(n,e)}var Bu=class{},Lw=new Pe("",{providedIn:"root",factory:()=>!1});var pk=new Pe(""),mk=new Pe(""),DT=class{},Ug=class{};function a6(n){let e=Error(`No component factory found for ${Ti(n)}.`);return e[l6]=n,e}var l6="ngComponent";var PT=class{resolveComponentFactory(e){throw a6(e)}},Uu=class{static{this.NULL=new PT}},xa=class{},tc=(()=>{class n{constructor(){this.destroyNode=null}static{this.__NG_ELEMENT_ID__=()=>c6()}}return n})();function c6(){let n=Rt(),e=bi(),t=Pa(e.index,n);return(ba(t)?t:n)[Vn]}var u6=(()=>{class n{static{this.\u0275prov=Se({token:n,providedIn:"root",factory:()=>null})}}return n})();function RT(n,e,t){let i=t?n.styles:null,r=t?n.classes:null,s=0;if(e!==null)for(let o=0;o<e.length;o++){let a=e[o];if(typeof a=="number")s=a;else if(s==1)r=bP(r,a);else if(s==2){let l=a,u=e[++o];i=bP(i,l+": "+u+";")}}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=r:n.classesWithoutHost=r}var $g=class extends Uu{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let t=Sa(e);return new $u(t,this.ngModule)}};function ZP(n,e){let t=[];for(let i in n){if(!n.hasOwnProperty(i))continue;let r=n[i];if(r===void 0)continue;let s=Array.isArray(r),o=s?r[0]:r,a=s?r[1]:Ia.None;e?t.push({propName:o,templateName:i,isSignal:(a&Ia.SignalBased)!==0}):t.push({propName:o,templateName:i})}return t}function d6(n){let e=n.toLowerCase();return e==="svg"?jR:e==="math"?F5:null}var $u=class extends Ug{get inputs(){let e=this.componentDef,t=e.inputTransforms,i=ZP(e.inputs,!0);if(t!==null)for(let r of i)t.hasOwnProperty(r.propName)&&(r.transform=t[r.propName]);return i}get outputs(){return ZP(this.componentDef.outputs,!1)}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=g5(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}create(e,t,i,r){let s=At(null);try{r=r||this.ngModule;let o=r instanceof wi?r:r?.injector;o&&this.componentDef.getStandaloneInjector!==null&&(o=this.componentDef.getStandaloneInjector(o)||o);let a=o?new fT(e,o):e,l=a.get(xa,null);if(l===null)throw new ye(407,!1);let u=a.get(u6,null),d=a.get(Bu,null),f={rendererFactory:l,sanitizer:u,inlineEffectRunner:null,changeDetectionScheduler:d},m=l.createRenderer(null,this.componentDef),y=this.componentDef.selectors[0][0]||"div",v=i?vj(m,i,this.componentDef.encapsulation,a):LM(m,y,d6(y)),E=512;this.componentDef.signals?E|=4096:this.componentDef.onPush||(E|=16);let T=null;v!==null&&(T=Iw(v,a,!0));let C=Pw(0,null,null,1,0,null,null,null,null,null,null),D=i0(null,C,null,E,null,null,f,m,a,null,T);cw(D);let P,V,G=null;try{let H=this.componentDef,A,x=null;H.findHostDirectiveDefs?(A=[],x=new Map,H.findHostDirectiveDefs(H,A,x),A.push(H)):A=[H];let R=h6(D,v);G=f6(R,v,H,A,D,f,m),V=zR(C,Yr),v&&g6(m,H,v,i),t!==void 0&&y6(V,this.ngContentSelectors,t),P=m6(G,H,A,x,D,[v6]),Mw(C,D,null)}catch(H){throw G!==null&&wT(G),wT(D),H}finally{uw()}return new MT(this.componentType,P,zu(V,D),D,V)}finally{At(s)}}},MT=class extends DT{constructor(e,t,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new Ql(r,void 0,!1),this.componentType=e}setInput(e,t){let i=this._tNode.inputs,r;if(i!==null&&(r=i[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;let s=this._rootLView;Rw(s[st],s,r,e,t),this.previousInputValues.set(e,t);let o=Pa(this._tNode.index,s);kw(o,1)}}get injector(){return new $l(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function h6(n,e){let t=n[st],i=Yr;return n[i]=e,r0(t,i,2,"#host",null)}function f6(n,e,t,i,r,s,o){let a=r[st];p6(i,n,e,o);let l=null;e!==null&&(l=Iw(e,r[Fu]));let u=s.rendererFactory.createRenderer(e,t),d=16;t.signals?d=4096:t.onPush&&(d=64);let f=i0(r,ZM(t),null,d,r[n.index],n,s,u,null,null,l);return a.firstCreatePass&&CT(a,n,i.length-1),s0(r,f),r[n.index]=f}function p6(n,e,t,i){for(let r of n)e.mergedAttrs=Gh(e.mergedAttrs,r.hostAttrs);e.mergedAttrs!==null&&(RT(e,e.mergedAttrs,!0),t!==null&&jM(i,t,e))}function m6(n,e,t,i,r,s){let o=bi(),a=r[st],l=Pr(o,r);ek(a,r,o,t,null,i);for(let d=0;d<t.length;d++){let f=o.directiveStart+d,m=Kl(r,a,f,o);Yl(m,r)}tk(a,r,o),l&&Yl(l,r);let u=Kl(r,a,o.directiveStart+o.componentOffset,o);if(n[Kr]=r[Kr]=u,s!==null)for(let d of s)d(u,e);return KM(a,o,r),u}function g6(n,e,t,i){if(i)sT(n,t,["ng-version","18.2.14"]);else{let{attrs:r,classes:s}=y5(e.selectors[0]);r&&sT(n,t,r),s&&s.length>0&&$M(n,t,s.join(" "))}}function y6(n,e,t){let i=n.projection=[];for(let r=0;r<e.length;r++){let s=t[r];i.push(s!=null?Array.from(s):null)}}function v6(){let n=bi();pw(Rt()[st],n)}var ka=(()=>{class n{static{this.__NG_ELEMENT_ID__=_6}}return n})();function _6(){let n=bi();return yk(n,Rt())}var E6=ka,gk=class extends E6{constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return zu(this._hostTNode,this._hostLView)}get injector(){return new $l(this._hostTNode,this._hostLView)}get parentInjector(){let e=mw(this._hostTNode,this._hostLView);if(uM(e)){let t=Mg(e,this._hostLView),i=Rg(e),r=t[st].data[i+8];return new $l(r,t)}else return new $l(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let t=XP(this._lContainer);return t!==null&&t[e]||null}get length(){return this._lContainer.length-ir}createEmbeddedView(e,t,i){let r,s;typeof i=="number"?r=i:i!=null&&(r=i.index,s=i.injector);let o=QP(this._lContainer,e.ssrId),a=e.createEmbeddedViewImpl(t||{},s,o);return this.insertImpl(a,r,YP(this._hostTNode,o)),a}createComponent(e,t,i,r,s){let o=e&&!k5(e),a;if(o)a=t;else{let v=t||{};a=v.index,i=v.injector,r=v.projectableNodes,s=v.environmentInjector||v.ngModuleRef}let l=o?e:new $u(Sa(e)),u=i||this.parentInjector;if(!s&&l.ngModule==null){let E=(o?u:this.parentInjector).get(wi,null);E&&(s=E)}let d=Sa(l.componentType??{}),f=QP(this._lContainer,d?.id??null),m=f?.firstChild??null,y=l.create(u,r,m,s);return this.insertImpl(y.hostView,a,YP(this._hostTNode,f)),y}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,i){let r=e._lView;if(B5(r)){let a=this.indexOf(e);if(a!==-1)this.detach(a);else{let l=r[ai],u=new gk(l,l[Zr],l[ai]);u.detach(u.indexOf(e))}}let s=this._adjustIndex(t),o=this._lContainer;return zj(o,r,s,i),e.attachToViewContainerRef(),vR(QE(o),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){let t=XP(this._lContainer);return t!==null?t.indexOf(e):-1}remove(e){let t=this._adjustIndex(e,-1),i=IT(this._lContainer,t);i&&(Ig(QE(this._lContainer),t),FM(i[st],i))}detach(e){let t=this._adjustIndex(e,-1),i=IT(this._lContainer,t);return i&&Ig(QE(this._lContainer),t)!=null?new Ql(i):null}_adjustIndex(e,t=0){return e??this.length+t}};function XP(n){return n[Ag]}function QE(n){return n[Ag]||(n[Ag]=[])}function yk(n,e){let t,i=e[n.index];return So(i)?t=i:(t=nk(i,e,null,n),e[n.index]=t,s0(e,t)),w6(t,e,n,i),new gk(t,n,e)}function T6(n,e){let t=n[Vn],i=t.createComment(""),r=Pr(e,n),s=BM(t,r);return Vg(t,s,i,oj(t,r),!1),i}var w6=S6,b6=()=>!1;function I6(n,e,t){return b6(n,e,t)}function S6(n,e,t,i){if(n[zl])return;let r;t.type&8?r=As(i):r=T6(e,t),n[zl]=r}var kT=class n{constructor(e){this.queryList=e,this.matches=null}clone(){return new n(this.queryList)}setDirty(){this.queryList.setDirty()}},LT=class n{constructor(e=[]){this.queries=e}createEmbeddedView(e){let t=e.queries;if(t!==null){let i=e.contentQueries!==null?e.contentQueries[0]:t.length,r=[];for(let s=0;s<i;s++){let o=t.getByIndex(s),a=this.queries[o.indexInDeclarationView];r.push(a.clone())}return new n(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}finishViewCreation(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)Ow(e,t).matches!==null&&this.queries[t].setDirty()}},OT=class{constructor(e,t,i=null){this.flags=t,this.read=i,typeof e=="string"?this.predicate=k6(e):this.predicate=e}},NT=class n{constructor(e=[]){this.queries=e}elementStart(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let i=0;i<this.length;i++){let r=t!==null?t.length:0,s=this.getByIndex(i).embeddedTView(e,r);s&&(s.indexInDeclarationView=i,t!==null?t.push(s):t=[s])}return t!==null?new n(t):null}template(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}},FT=class n{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new n(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let t=this._declarationNodeIndex,i=e.parent;for(;i!==null&&i.type&8&&i.index!==t;)i=i.parent;return t===(i!==null?i.index:-1)}return this._appliesToNextNode}matchTNode(e,t){let i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){let s=i[r];this.matchTNodeWithReadOption(e,t,C6(t,s)),this.matchTNodeWithReadOption(e,t,_g(t,e,s,!1,!1))}else i===Zl?t.type&4&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,_g(t,e,i,!1,!1))}matchTNodeWithReadOption(e,t,i){if(i!==null){let r=this.metadata.read;if(r!==null)if(r===Xr||r===ka||r===Zl&&t.type&4)this.addMatch(t.index,-2);else{let s=_g(t,e,r,!1,!1);s!==null&&this.addMatch(t.index,s)}else this.addMatch(t.index,i)}}addMatch(e,t){this.matches===null?this.matches=[e,t]:this.matches.push(e,t)}};function C6(n,e){let t=n.localNames;if(t!==null){for(let i=0;i<t.length;i+=2)if(t[i]===e)return t[i+1]}return null}function x6(n,e){return n.type&11?zu(n,e):n.type&4?o0(n,e):null}function A6(n,e,t,i){return t===-1?x6(e,n):t===-2?D6(n,e,i):Kl(n,n[st],t,e)}function D6(n,e,t){if(t===Xr)return zu(e,n);if(t===Zl)return o0(e,n);if(t===ka)return yk(e,n)}function vk(n,e,t,i){let r=e[Eo].queries[i];if(r.matches===null){let s=n.data,o=t.matches,a=[];for(let l=0;o!==null&&l<o.length;l+=2){let u=o[l];if(u<0)a.push(null);else{let d=s[u];a.push(A6(e,d,o[l+1],t.metadata.read))}}r.matches=a}return r.matches}function VT(n,e,t,i){let r=n.queries.getByIndex(t),s=r.matches;if(s!==null){let o=vk(n,e,r,t);for(let a=0;a<s.length;a+=2){let l=s[a];if(l>0)i.push(o[a/2]);else{let u=s[a+1],d=e[-l];for(let f=ir;f<d.length;f++){let m=d[f];m[Gl]===m[ai]&&VT(m[st],m,u,i)}if(d[Vu]!==null){let f=d[Vu];for(let m=0;m<f.length;m++){let y=f[m];VT(y[st],y,u,i)}}}}}return i}function P6(n,e){return n[Eo].queries[e].queryList}function R6(n,e,t){let i=new TT((t&4)===4);return Tj(n,e,i,i.destroy),(e[Eo]??=new LT).queries.push(new kT(i))-1}function M6(n,e,t){let i=ui();return i.firstCreatePass&&(L6(i,new OT(n,e,t),-1),(e&2)===2&&(i.staticViewQueries=!0)),R6(i,Rt(),e)}function k6(n){return n.split(",").map(e=>e.trim())}function L6(n,e,t){n.queries===null&&(n.queries=new NT),n.queries.track(new FT(e,t))}function Ow(n,e){return n.queries.getByIndex(e)}function O6(n,e){let t=n[st],i=Ow(t,e);return i.crossesNgTemplate?VT(t,n,e,[]):vk(t,n,i,e)}var JP=new Set;function La(n){JP.has(n)||(JP.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}function N6(n){return typeof n=="function"&&n[yo]!==void 0}function a0(n,e){La("NgSignals");let t=Q1(n),i=t[yo];return e?.equal&&(i.equal=e.equal),t.set=r=>TE(i,r),t.update=r=>Z1(i,r),t.asReadonly=F6.bind(t),t}function F6(){let n=this[yo];if(n.readonlyFn===void 0){let e=()=>this();e[yo]=n,n.readonlyFn=e}return n.readonlyFn}function _k(n){return N6(n)&&typeof n.set=="function"}function V6(n){return Object.getPrototypeOf(n.prototype).constructor}function Co(n){let e=V6(n.type),t=!0,i=[n];for(;e;){let r;if(Ca(n))r=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new ye(903,!1);r=e.\u0275dir}if(r){if(t){i.push(r);let o=n;o.inputs=fg(n.inputs),o.inputTransforms=fg(n.inputTransforms),o.declaredInputs=fg(n.declaredInputs),o.outputs=fg(n.outputs);let a=r.hostBindings;a&&G6(n,a);let l=r.viewQuery,u=r.contentQueries;if(l&&$6(n,l),u&&j6(n,u),B6(n,r),N3(n.outputs,r.outputs),Ca(r)&&r.data.animation){let d=n.data;d.animation=(d.animation||[]).concat(r.data.animation)}}let s=r.features;if(s)for(let o=0;o<s.length;o++){let a=s[o];a&&a.ngInherit&&a(n),a===Co&&(t=!1)}}e=Object.getPrototypeOf(e)}U6(i)}function B6(n,e){for(let t in e.inputs){if(!e.inputs.hasOwnProperty(t)||n.inputs.hasOwnProperty(t))continue;let i=e.inputs[t];if(i!==void 0&&(n.inputs[t]=i,n.declaredInputs[t]=e.declaredInputs[t],e.inputTransforms!==null)){let r=Array.isArray(i)?i[0]:i;if(!e.inputTransforms.hasOwnProperty(r))continue;n.inputTransforms??={},n.inputTransforms[r]=e.inputTransforms[r]}}}function U6(n){let e=0,t=null;for(let i=n.length-1;i>=0;i--){let r=n[i];r.hostVars=e+=r.hostVars,r.hostAttrs=Gh(r.hostAttrs,t=Gh(t,r.hostAttrs))}}function fg(n){return n===Lu?{}:n===Cr?[]:n}function $6(n,e){let t=n.viewQuery;t?n.viewQuery=(i,r)=>{e(i,r),t(i,r)}:n.viewQuery=e}function j6(n,e){let t=n.contentQueries;t?n.contentQueries=(i,r,s)=>{e(i,r,s),t(i,r,s)}:n.contentQueries=e}function G6(n,e){let t=n.hostBindings;t?n.hostBindings=(i,r)=>{e(i,r),t(i,r)}:n.hostBindings=e}function Nw(n){let e=n.inputConfig,t={};for(let i in e)if(e.hasOwnProperty(i)){let r=e[i];Array.isArray(r)&&r[3]&&(t[i]=r[3])}n.inputTransforms=t}var Aa=class{},qh=class{};var BT=class extends Aa{constructor(e,t,i,r=!0){super(),this.ngModuleType=e,this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new $g(this);let s=xR(e);this._bootstrapComponents=kM(s.bootstrap),this._r3Injector=_M(e,t,[{provide:Aa,useValue:this},{provide:Uu,useValue:this.componentFactoryResolver},...i],Ti(e),new Set(["environment"])),r&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},UT=class extends qh{constructor(e){super(),this.moduleType=e}create(e){return new BT(this.moduleType,e,[])}};var jg=class extends Aa{constructor(e){super(),this.componentFactoryResolver=new $g(this),this.instance=null;let t=new zh([...e.providers,{provide:Aa,useValue:this},{provide:Uu,useValue:this.componentFactoryResolver}],e.parent||sw(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function l0(n,e,t=null){return new jg({providers:n,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}function Ek(n){return H6(n)?Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n:!1}function z6(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{let t=n[Symbol.iterator](),i;for(;!(i=t.next()).done;)e(i.value)}}function H6(n){return n!==null&&(typeof n=="function"||typeof n=="object")}function Tk(n,e,t){return n[e]=t}function q6(n,e){return n[e]}function Xl(n,e,t){let i=n[e];return Object.is(i,t)?!1:(n[e]=t,!0)}function wk(n,e,t,i){let r=Xl(n,e,t);return Xl(n,e+1,i)||r}function W6(n){return(n.flags&32)===32}function K6(n,e,t,i,r,s,o,a,l){let u=e.consts,d=r0(e,n,4,o||null,a||null);JM(e,t,d,Pg(u,l)),pw(e,d);let f=d.tView=Pw(2,d,i,r,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,u,null);return e.queries!==null&&(e.queries.template(e,d),f.queries=e.queries.embeddedTView(d)),d}function Y6(n,e,t,i,r,s,o,a,l,u){let d=t+Yr,f=e.firstCreatePass?K6(d,e,n,i,r,s,o,a,l):e.data[d];Qh(f,!1);let m=Q6(e,n,f,t);hw()&&Aw(e,n,m,f),Yl(m,n);let y=nk(m,n,m,f);return n[d]=y,s0(n,y),I6(y,f,n),ow(f)&&YM(e,n,f),l!=null&&QM(n,f,u),f}function Ve(n,e,t,i,r,s,o,a){let l=Rt(),u=ui(),d=Pg(u.consts,s);return Y6(l,u,n,e,t,i,r,d,o,a),Ve}var Q6=Z6;function Z6(n,e,t,i){return fw(!0),e[Vn].createComment("")}var Pu=function(n){return n[n.EarlyRead=0]="EarlyRead",n[n.Write=1]="Write",n[n.MixedReadWrite=2]="MixedReadWrite",n[n.Read=3]="Read",n}(Pu||{}),bk=(()=>{class n{constructor(){this.impl=null}execute(){this.impl?.execute()}static{this.\u0275prov=Se({token:n,providedIn:"root",factory:()=>new n})}}return n})(),$T=class n{constructor(){this.ngZone=ue(Dt),this.scheduler=ue(Bu),this.errorHandler=ue(To,{optional:!0}),this.sequences=new Set,this.deferredRegistrations=new Set,this.executing=!1}static{this.PHASES=[Pu.EarlyRead,Pu.Write,Pu.MixedReadWrite,Pu.Read]}execute(){this.executing=!0;for(let e of n.PHASES)for(let t of this.sequences)if(!(t.erroredOrDestroyed||!t.hooks[e]))try{t.pipelinedValue=this.ngZone.runOutsideAngular(()=>t.hooks[e](t.pipelinedValue))}catch(i){t.erroredOrDestroyed=!0,this.errorHandler?.handleError(i)}this.executing=!1;for(let e of this.sequences)e.afterRun(),e.once&&(this.sequences.delete(e),e.destroy());for(let e of this.deferredRegistrations)this.sequences.add(e);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear()}register(e){this.executing?this.deferredRegistrations.add(e):(this.sequences.add(e),this.scheduler.notify(6))}unregister(e){this.executing&&this.sequences.has(e)?(e.erroredOrDestroyed=!0,e.pipelinedValue=void 0,e.once=!0):(this.sequences.delete(e),this.deferredRegistrations.delete(e))}static{this.\u0275prov=Se({token:n,providedIn:"root",factory:()=>new n})}},jT=class{constructor(e,t,i,r){this.impl=e,this.hooks=t,this.once=i,this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.unregisterOnDestroy=r?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.()}};function Fw(n,e){!e?.injector&&M5(Fw);let t=e?.injector??ue(ti);return K4(t)?(La("NgAfterNextRender"),J6(n,t,e,!0)):e8}function X6(n,e){if(n instanceof Function){let t=[void 0,void 0,void 0,void 0];return t[e]=n,t}else return[n.earlyRead,n.write,n.mixedReadWrite,n.read]}function J6(n,e,t,i){let r=e.get(bk);r.impl??=e.get($T);let s=t?.phase??Pu.MixedReadWrite,o=t?.manualCleanup!==!0?e.get(yw):null,a=new jT(r.impl,X6(n,s),i,o);return r.impl.register(a),a}var e8={destroy(){}};function xo(n,e,t,i){let r=Rt(),s=e0();if(Xl(r,s,e)){let o=ui(),a=dw();Nj(a,r,n,e,t,i)}return xo}function t8(n,e,t,i){return Xl(n,e0(),t)?e+ku(t)+i:Rs}function n8(n,e,t,i,r,s){let o=Z5(),a=wk(n,o,t,r);return tM(2),a?e+ku(t)+i+ku(r)+s:Rs}function pg(n,e){return n<<17|e<<2}function Jl(n){return n>>17&32767}function i8(n){return(n&2)==2}function r8(n,e){return n&131071|e<<17}function GT(n){return n|2}function ju(n){return(n&131068)>>2}function ZE(n,e){return n&-131069|e<<2}function s8(n){return(n&1)===1}function zT(n){return n|1}function o8(n,e,t,i,r,s){let o=s?e.classBindings:e.styleBindings,a=Jl(o),l=ju(o);n[i]=t;let u=!1,d;if(Array.isArray(t)){let f=t;d=f[1],(d===null||Yh(f,d)>0)&&(u=!0)}else d=t;if(r)if(l!==0){let m=Jl(n[a+1]);n[i+1]=pg(m,a),m!==0&&(n[m+1]=ZE(n[m+1],i)),n[a+1]=r8(n[a+1],i)}else n[i+1]=pg(a,0),a!==0&&(n[a+1]=ZE(n[a+1],i)),a=i;else n[i+1]=pg(l,0),a===0?a=i:n[l+1]=ZE(n[l+1],i),l=i;u&&(n[i+1]=GT(n[i+1])),eR(n,d,i,!0),eR(n,d,i,!1),a8(e,d,n,i,s),o=pg(a,l),s?e.classBindings=o:e.styleBindings=o}function a8(n,e,t,i,r){let s=r?n.residualClasses:n.residualStyles;s!=null&&typeof e=="string"&&Yh(s,e)>=0&&(t[i+1]=zT(t[i+1]))}function eR(n,e,t,i){let r=n[t+1],s=e===null,o=i?Jl(r):ju(r),a=!1;for(;o!==0&&(a===!1||s);){let l=n[o],u=n[o+1];l8(l,e)&&(a=!0,n[o+1]=i?zT(u):GT(u)),o=i?Jl(u):ju(u)}a&&(n[t+1]=i?GT(r):zT(r))}function l8(n,e){return n===null||e==null||(Array.isArray(n)?n[1]:n)===e?!0:Array.isArray(n)&&typeof e=="string"?Yh(n,e)>=0:!1}function ce(n,e,t){let i=Rt(),r=e0();if(Xl(i,r,e)){let s=ui(),o=dw();XM(s,o,i,n,e,i[Vn],t,!1)}return ce}function tR(n,e,t,i,r){let s=e.inputs,o=r?"class":"style";Rw(n,t,s[o],o,i)}function Ii(n,e,t){return Ik(n,e,t,!1),Ii}function Qe(n,e){return Ik(n,e,null,!0),Qe}function Ik(n,e,t,i){let r=Rt(),s=ui(),o=tM(2);if(s.firstUpdatePass&&u8(s,n,o,i),e!==Rs&&Xl(r,o,e)){let a=s.data[ec()];m8(s,a,r,r[Vn],n,r[o+1]=g8(e,t),i,o)}}function c8(n,e){return e>=n.expandoStartIndex}function u8(n,e,t,i){let r=n.data;if(r[t+1]===null){let s=r[ec()],o=c8(n,t);y8(s,i)&&e===null&&!o&&(e=!1),e=d8(r,s,e,i),o8(r,s,e,t,o,i)}}function d8(n,e,t,i){let r=n4(n),s=i?e.residualClasses:e.residualStyles;if(r===null)(i?e.classBindings:e.styleBindings)===0&&(t=XE(null,n,e,t,i),t=Wh(t,e.attrs,i),s=null);else{let o=e.directiveStylingLast;if(o===-1||n[o]!==r)if(t=XE(r,n,e,t,i),s===null){let l=h8(n,e,i);l!==void 0&&Array.isArray(l)&&(l=XE(null,n,e,l[1],i),l=Wh(l,e.attrs,i),f8(n,e,i,l))}else s=p8(n,e,i)}return s!==void 0&&(i?e.residualClasses=s:e.residualStyles=s),t}function h8(n,e,t){let i=t?e.classBindings:e.styleBindings;if(ju(i)!==0)return n[Jl(i)]}function f8(n,e,t,i){let r=t?e.classBindings:e.styleBindings;n[Jl(r)]=i}function p8(n,e,t){let i,r=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<r;s++){let o=n[s].hostAttrs;i=Wh(i,o,t)}return Wh(i,e.attrs,t)}function XE(n,e,t,i,r){let s=null,o=t.directiveEnd,a=t.directiveStylingLast;for(a===-1?a=t.directiveStart:a++;a<o&&(s=e[a],i=Wh(i,s.hostAttrs,r),s!==n);)a++;return n!==null&&(t.directiveStylingLast=a),i}function Wh(n,e,t){let i=t?1:2,r=-1;if(e!==null)for(let s=0;s<e.length;s++){let o=e[s];typeof o=="number"?r=o:r===i&&(Array.isArray(n)||(n=n===void 0?[]:["",n]),r5(n,o,t?!0:e[++s]))}return n===void 0?null:n}function m8(n,e,t,i,r,s,o,a){if(!(e.type&3))return;let l=n.data,u=l[a+1],d=s8(u)?nR(l,e,t,r,ju(u),o):void 0;if(!Gg(d)){Gg(s)||i8(u)&&(s=nR(l,null,t,r,a,o));let f=GR(ec(),t);fj(i,o,f,r,s)}}function nR(n,e,t,i,r,s){let o=e===null,a;for(;r>0;){let l=n[r],u=Array.isArray(l),d=u?l[1]:l,f=d===null,m=t[r+1];m===Rs&&(m=f?Cr:void 0);let y=f?jE(m,i):d===i?m:void 0;if(u&&!Gg(y)&&(y=jE(l,i)),Gg(y)&&(a=y,o))return a;let v=n[r+1];r=o?Jl(v):ju(v)}if(e!==null){let l=s?e.residualClasses:e.residualStyles;l!=null&&(a=jE(l,i))}return a}function Gg(n){return n!==void 0}function g8(n,e){return n==null||n===""||(typeof e=="string"?n=n+e:typeof n=="object"&&(n=Ti(Zh(n)))),n}function y8(n,e){return(n.flags&(e?8:16))!==0}function v8(n,e,t,i,r,s){let o=e.consts,a=Pg(o,r),l=r0(e,n,2,i,a);return JM(e,t,l,Pg(o,s)),l.attrs!==null&&RT(l,l.attrs,!1),l.mergedAttrs!==null&&RT(l,l.mergedAttrs,!0),e.queries!==null&&e.queries.elementStart(e,l),l}function N(n,e,t,i){let r=Rt(),s=ui(),o=Yr+n,a=r[Vn],l=s.firstCreatePass?v8(o,s,r,e,t,i):s.data[o],u=_8(s,r,l,a,e,n);r[o]=u;let d=ow(l);return Qh(l,!0),jM(a,u,l),!W6(l)&&hw()&&Aw(s,r,u,l),j5()===0&&Yl(u,r),G5(),d&&(YM(s,r,l),KM(s,l,r)),i!==null&&QM(r,l),N}function $(){let n=bi();XR()?Y5():(n=n.parent,Qh(n,!1));let e=n;q5(e)&&W5(),z5();let t=ui();return t.firstCreatePass&&(pw(t,n),FR(n)&&t.queries.elementEnd(n)),e.classesWithoutHost!=null&&u4(e)&&tR(t,e,Rt(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&d4(e)&&tR(t,e,Rt(),e.stylesWithoutHost,!1),$}function ae(n,e,t,i){return N(n,e,t,i),$(),ae}var _8=(n,e,t,i,r,s)=>(fw(!0),LM(i,r,o4()));function Et(){return Rt()}var Bl=void 0;function E8(n){let e=n,t=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return t===1&&i===0?1:5}var T8=["en",[["a","p"],["AM","PM"],Bl],[["AM","PM"],Bl,Bl],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Bl,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Bl,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Bl,"{1} 'at' {0}",Bl],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",E8],JE={};function rr(n){let e=w8(n),t=iR(e);if(t)return t;let i=e.split("-")[0];if(t=iR(i),t)return t;if(i==="en")return T8;throw new ye(701,!1)}function iR(n){return n in JE||(JE[n]=Ul.ng&&Ul.ng.common&&Ul.ng.common.locales&&Ul.ng.common.locales[n]),JE[n]}var gn=function(n){return n[n.LocaleId=0]="LocaleId",n[n.DayPeriodsFormat=1]="DayPeriodsFormat",n[n.DayPeriodsStandalone=2]="DayPeriodsStandalone",n[n.DaysFormat=3]="DaysFormat",n[n.DaysStandalone=4]="DaysStandalone",n[n.MonthsFormat=5]="MonthsFormat",n[n.MonthsStandalone=6]="MonthsStandalone",n[n.Eras=7]="Eras",n[n.FirstDayOfWeek=8]="FirstDayOfWeek",n[n.WeekendRange=9]="WeekendRange",n[n.DateFormat=10]="DateFormat",n[n.TimeFormat=11]="TimeFormat",n[n.DateTimeFormat=12]="DateTimeFormat",n[n.NumberSymbols=13]="NumberSymbols",n[n.NumberFormats=14]="NumberFormats",n[n.CurrencyCode=15]="CurrencyCode",n[n.CurrencySymbol=16]="CurrencySymbol",n[n.CurrencyName=17]="CurrencyName",n[n.Currencies=18]="Currencies",n[n.Directionality=19]="Directionality",n[n.PluralCase=20]="PluralCase",n[n.ExtraData=21]="ExtraData",n}(gn||{});function w8(n){return n.toLowerCase().replace(/_/g,"-")}var zg="en-US";var b8=zg;function I8(n){typeof n=="string"&&(b8=n.toLowerCase().replace(/_/g,"-"))}var S8=(n,e,t)=>{};function he(n,e,t,i){let r=Rt(),s=ui(),o=bi();return Sk(s,r,r[Vn],o,n,e,i),he}function C8(n,e,t,i){let r=n.cleanup;if(r!=null)for(let s=0;s<r.length-1;s+=2){let o=r[s];if(o===t&&r[s+1]===i){let a=e[xg],l=r[s+2];return a.length>l?a[l]:null}typeof o=="string"&&(s+=2)}return null}function Sk(n,e,t,i,r,s,o){let a=ow(i),u=n.firstCreatePass&&sk(n),d=e[Kr],f=rk(e),m=!0;if(i.type&3||o){let E=Pr(i,e),T=o?o(E):E,C=f.length,D=o?V=>o(As(V[i.index])):i.index,P=null;if(!o&&a&&(P=C8(n,e,r,i.index)),P!==null){let V=P.__ngLastListenerFn__||P;V.__ngNextListenerFn__=s,P.__ngLastListenerFn__=s,m=!1}else{s=sR(i,e,d,s),S8(E,r,s);let V=t.listen(T,r,s);f.push(s,V),u&&u.push(r,D,C,C+1)}}else s=sR(i,e,d,s);let y=i.outputs,v;if(m&&y!==null&&(v=y[r])){let E=v.length;if(E)for(let T=0;T<E;T+=2){let C=v[T],D=v[T+1],G=e[C][D].subscribe(s),H=f.length;f.push(s,G),u&&u.push(r,i.index,H,-(H+1))}}}function rR(n,e,t,i){let r=At(null);try{return bs(6,e,t),t(i)!==!1}catch(s){return ok(n,s),!1}finally{bs(7,e,t),At(r)}}function sR(n,e,t,i){return function r(s){if(s===Function)return i;let o=n.componentOffset>-1?Pa(n.index,e):e;kw(o,5);let a=rR(e,t,i,s),l=r.__ngNextListenerFn__;for(;l;)a=rR(e,t,l,s)&&a,l=l.__ngNextListenerFn__;return a}}function ve(n=1){return r4(n)}function Ui(n,e,t){M6(n,e,t)}function Si(n){let e=Rt(),t=ui(),i=nM();lw(i+1);let r=Ow(t,i);if(n.dirty&&V5(e)===((r.metadata.flags&2)===2)){if(r.matches===null)n.reset([]);else{let s=O6(e,i);n.reset(s,M4),n.notifyOnChanges()}return!0}return!1}function Ci(){return P6(Rt(),nM())}function x8(n,e,t,i){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=i}function nc(n){let e=Q5();return HR(e,Yr+n)}function ee(n,e=""){let t=Rt(),i=ui(),r=n+Yr,s=i.firstCreatePass?r0(i,r,1,e,null):i.data[r],o=A8(i,t,s,e,n);t[r]=o,hw()&&Aw(i,t,o,s),Qh(s,!1)}var A8=(n,e,t,i,r)=>(fw(!0),Q4(e[Vn],i));function ut(n){return Mt("",n,""),ut}function Mt(n,e,t){let i=Rt(),r=t8(i,n,e,t);return r!==Rs&&ak(i,ec(),r),Mt}function Vw(n,e,t,i,r){let s=Rt(),o=n8(s,n,e,t,i,r);return o!==Rs&&ak(s,ec(),o),Vw}function ni(n,e,t){_k(e)&&(e=e());let i=Rt(),r=e0();if(Xl(i,r,e)){let s=ui(),o=dw();XM(s,o,i,n,e,i[Vn],t,!1)}return ni}function di(n,e){let t=_k(n);return t&&n.set(e),t}function ii(n,e){let t=Rt(),i=ui(),r=bi();return Sk(i,t,t[Vn],r,n,e),ii}function D8(n,e,t){let i=ui();if(i.firstCreatePass){let r=Ca(n);HT(t,i.data,i.blueprint,r,!0),HT(e,i.data,i.blueprint,r,!1)}}function HT(n,e,t,i,r){if(n=Ei(n),Array.isArray(n))for(let s=0;s<n.length;s++)HT(n[s],e,t,i,r);else{let s=ui(),o=Rt(),a=bi(),l=Nu(n)?n:Ei(n.provide),u=kR(n),d=a.providerIndexes&1048575,f=a.directiveStart,m=a.providerIndexes>>20;if(Nu(n)||!n.multi){let y=new Wl(u,r,pe),v=tT(l,e,r?d:d+m,f);v===-1?(mT(Lg(a,o),s,l),eT(s,n,e.length),e.push(l),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),t.push(y),o.push(y)):(t[v]=y,o[v]=y)}else{let y=tT(l,e,d+m,f),v=tT(l,e,d,d+m),E=y>=0&&t[y],T=v>=0&&t[v];if(r&&!T||!r&&!E){mT(Lg(a,o),s,l);let C=M8(r?R8:P8,t.length,r,i,u);!r&&T&&(t[v].providerFactory=C),eT(s,n,e.length,0),e.push(l),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),t.push(C),o.push(C)}else{let C=Ck(t[r?v:y],u,!r&&i);eT(s,n,y>-1?y:v,C)}!r&&i&&T&&t[v].componentProviders++}}}function eT(n,e,t,i){let r=Nu(e),s=S5(e);if(r||s){let l=(s?Ei(e.useClass):e).prototype.ngOnDestroy;if(l){let u=n.destroyHooks||(n.destroyHooks=[]);if(!r&&e.multi){let d=u.indexOf(t);d===-1?u.push(t,[i,l]):u[d+1].push(i,l)}else u.push(t,l)}}}function Ck(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function tT(n,e,t,i){for(let r=t;r<i;r++)if(e[r]===n)return r;return-1}function P8(n,e,t,i){return qT(this.multi,[])}function R8(n,e,t,i){let r=this.multi,s;if(this.providerFactory){let o=this.providerFactory.componentProviders,a=Kl(t,t[st],this.providerFactory.index,i);s=a.slice(0,o),qT(r,s);for(let l=o;l<a.length;l++)s.push(a[l])}else s=[],qT(r,s);return s}function qT(n,e){for(let t=0;t<n.length;t++){let i=n[t];e.push(i())}return e}function M8(n,e,t,i,r){let s=new Wl(n,t,pe);return s.multi=[],s.index=e,s.componentProviders=0,Ck(s,r,i&&!t),s}function Hu(n,e=[]){return t=>{t.providersResolver=(i,r)=>D8(i,r?r(n):n,e)}}var k8=(()=>{class n{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){let i=PR(!1,t.type),r=i.length>0?l0([i],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,r)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(let t of this.cachedInjectors.values())t!==null&&t.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=Se({token:n,providedIn:"environment",factory:()=>new n(Me(wi))})}}return n})();function Tt(n){La("NgStandalone"),n.getStandaloneInjector=e=>e.get(k8).getOrCreateStandaloneInjector(n)}function xk(n,e,t){let i=eM()+n,r=Rt();return r[i]===Rs?Tk(r,i,t?e.call(t):e()):q6(r,i)}function L8(n,e){let t=n[e];return t===Rs?void 0:t}function O8(n,e,t,i,r,s,o){let a=e+t;return wk(n,a,r,s)?Tk(n,a+2,o?i.call(o,r,s):i(r,s)):L8(n,a+2)}function Xh(n,e){let t=ui(),i,r=n+Yr;t.firstCreatePass?(i=N8(e,t.pipeRegistry),t.data[r]=i,i.onDestroy&&(t.destroyHooks??=[]).push(r,i.onDestroy)):i=t.data[r];let s=i.factory||(i.factory=jl(i.type,!0)),o,a=Vi(pe);try{let l=kg(!1),u=s();return kg(l),x8(t,Rt(),r,u),u}finally{Vi(a)}}function N8(n,e){if(e)for(let t=e.length-1;t>=0;t--){let i=e[t];if(n===i.name)return i}}function Jh(n,e,t,i){let r=n+Yr,s=Rt(),o=HR(s,r);return F8(s,r)?O8(s,eM(),e,o.transform,t,i,o):o.transform(t,i)}function F8(n,e){return n[st].data[e].pure}function c0(n,e){return o0(n,e)}var bo=class{constructor(e){this.full=e;let t=e.split(".");this.major=t[0],this.minor=t[1],this.patch=t.slice(2).join(".")}},Ak=new bo("18.2.14");var u0=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"platform"})}}return n})();var Dk=new Pe("");function ic(n){return!!n&&typeof n.then=="function"}function Pk(n){return!!n&&typeof n.subscribe=="function"}var d0=new Pe(""),Rk=(()=>{class n{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,i)=>{this.resolve=t,this.reject=i}),this.appInits=ue(d0,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let t=[];for(let r of this.appInits){let s=r();if(ic(s))t.push(s);else if(Pk(s)){let o=new Promise((a,l)=>{s.subscribe({complete:a,error:l})});t.push(o)}}let i=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{i()}).catch(r=>{this.reject(r)}),t.length===0&&i(),this.initialized=!0}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),ef=new Pe("");function V8(){Y1(()=>{throw new ye(600,!1)})}function B8(n){return n.isBoundToModule}var U8=10;function $8(n,e,t){try{let i=t();return ic(i)?i.catch(r=>{throw e.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>n.handleError(i)),i}}var Oa=(()=>{class n{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=ue(P4),this.afterRenderManager=ue(bk),this.zonelessEnabled=ue(Lw),this.dirtyFlags=0,this.deferredDirtyFlags=0,this.externalTestViews=new Set,this.beforeRender=new zn,this.afterTick=new zn,this.componentTypes=[],this.components=[],this.isStable=ue(Ma).hasPendingTasks.pipe(We(t=>!t)),this._injector=ue(wi)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}whenStable(){let t;return new Promise(i=>{t=this.isStable.subscribe({next:r=>{r&&i()}})}).finally(()=>{t.unsubscribe()})}get injector(){return this._injector}bootstrap(t,i){let r=t instanceof Ug;if(!this._injector.get(Rk).done){let m=!r&&CR(t),y=!1;throw new ye(405,y)}let o;r?o=t:o=this._injector.get(Uu).resolveComponentFactory(t),this.componentTypes.push(o.componentType);let a=B8(o)?void 0:this._injector.get(Aa),l=i||o.selector,u=o.create(ti.NULL,[],l,a),d=u.location.nativeElement,f=u.injector.get(Dk,null);return f?.registerApplication(d),u.onDestroy(()=>{this.detachView(u.hostView),Eg(this.components,u),f?.unregisterApplication(d)}),this._loadComponent(u),u}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){if(this._runningTick)throw new ye(101,!1);let t=At(null);try{this._runningTick=!0,this.synchronize()}catch(i){this.internalErrorHandler(i)}finally{this._runningTick=!1,At(t),this.afterTick.next()}}synchronize(){let t=null;this._injector.destroyed||(t=this._injector.get(xa,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let i=0;for(;this.dirtyFlags!==0&&i++<U8;)this.synchronizeOnce(t)}synchronizeOnce(t){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,this.dirtyFlags&7){let i=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8,this.beforeRender.next(i);for(let{_lView:r,notifyErrorHandler:s}of this._views)j8(r,s,i,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&7)return}else t?.begin?.(),t?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:t})=>Xg(t))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(t){let i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){let i=t;Eg(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);let i=this._injector.get(ef,[]);[...this._bootstrapListeners,...i].forEach(r=>r(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>Eg(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new ye(406,!1);let t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Eg(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function j8(n,e,t,i){if(!t&&!Xg(n))return;uk(n,e,t&&!i?0:1)}var WT=class{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}},h0=(()=>{class n{compileModuleSync(t){return new UT(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){let i=this.compileModuleSync(t),r=xR(t),s=kM(r.declarations).reduce((o,a)=>{let l=Sa(a);return l&&o.push(new $u(l)),o},[]);return new WT(i,s)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var G8=(()=>{class n{constructor(){this.zone=ue(Dt),this.changeDetectionScheduler=ue(Bu),this.applicationRef=ue(Oa)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function z8({ngZoneFactory:n,ignoreChangesOutsideZone:e,scheduleInRootZone:t}){return n??=()=>new Dt(qe(de({},H8()),{scheduleInRootZone:t})),[{provide:Dt,useFactory:n},{provide:Ou,multi:!0,useFactory:()=>{let i=ue(G8,{optional:!0});return()=>i.initialize()}},{provide:Ou,multi:!0,useFactory:()=>{let i=ue(q8);return()=>{i.initialize()}}},e===!0?{provide:pk,useValue:!0}:[],{provide:mk,useValue:t??EM}]}function H8(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}var q8=(()=>{class n{constructor(){this.subscription=new pn,this.initialized=!1,this.zone=ue(Dt),this.pendingTasks=ue(Ma)}initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Dt.assertNotInAngularZone(),queueMicrotask(()=>{t!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Dt.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var W8=(()=>{class n{constructor(){this.appRef=ue(Oa),this.taskService=ue(Ma),this.ngZone=ue(Dt),this.zonelessEnabled=ue(Lw),this.disableScheduling=ue(pk,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new pn,this.angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Ng):null,this.scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(ue(mk,{optional:!0})??!1),this.cancelScheduledCallback=null,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof ET||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&t===5)return;switch(t){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 7:{this.appRef.deferredDirtyFlags|=8;break}case 9:case 8:case 6:case 10:default:this.appRef.dirtyFlags|=8}if(!this.shouldScheduleTick())return;let i=this.useMicrotaskScheduler?UP:TM;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>i(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>i(()=>this.tick()))}shouldScheduleTick(){return!(this.disableScheduling||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Ng+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(i){throw this.taskService.remove(t),i}finally{this.cleanup()}this.useMicrotaskScheduler=!0,UP(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function K8(){return typeof $localize<"u"&&$localize.locale||zg}var tf=new Pe("",{providedIn:"root",factory:()=>ue(tf,ht.Optional|ht.SkipSelf)||K8()});var KT=new Pe("");function mg(n){return!n.moduleRef}function Y8(n){let e=mg(n)?n.r3Injector:n.moduleRef.injector,t=e.get(Dt);return t.run(()=>{mg(n)?n.r3Injector.resolveInjectorInitializers():n.moduleRef.resolveInjectorInitializers();let i=e.get(To,null),r;if(t.runOutsideAngular(()=>{r=t.onError.subscribe({next:s=>{i.handleError(s)}})}),mg(n)){let s=()=>e.destroy(),o=n.platformInjector.get(KT);o.add(s),e.onDestroy(()=>{r.unsubscribe(),o.delete(s)})}else{let s=()=>n.moduleRef.destroy(),o=n.platformInjector.get(KT);o.add(s),n.moduleRef.onDestroy(()=>{Eg(n.allPlatformModules,n.moduleRef),r.unsubscribe(),o.delete(s)})}return $8(i,t,()=>{let s=e.get(Rk);return s.runInitializers(),s.donePromise.then(()=>{let o=e.get(tf,zg);if(I8(o||zg),mg(n)){let a=e.get(Oa);return n.rootComponent!==void 0&&a.bootstrap(n.rootComponent),a}else return Q8(n.moduleRef,n.allPlatformModules),n.moduleRef})})})}function Q8(n,e){let t=n.injector.get(Oa);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(i=>t.bootstrap(i));else if(n.instance.ngDoBootstrap)n.instance.ngDoBootstrap(t);else throw new ye(-403,!1);e.push(n)}var Tg=null,Mk=new Pe("");function Z8(n=[],e){return ti.create({name:e,providers:[{provide:Yg,useValue:"platform"},{provide:KT,useValue:new Set([()=>Tg=null])},...n]})}function X8(n=[]){if(Tg)return Tg;let e=Z8(n);return e.get(Mk,!1)||(Tg=e),V8(),J8(e),e}function J8(n){n.get(Tw,null)?.forEach(t=>t())}var xi=(()=>{class n{static{this.__NG_ELEMENT_ID__=eG}}return n})();function eG(n){return tG(bi(),Rt(),(n&16)===16)}function tG(n,e,t){if(Zg(n)&&!t){let i=Pa(n.index,e);return new Ql(i,i)}else if(n.type&175){let i=e[xs];return new Ql(i,e)}return null}var YT=class{constructor(){}supports(e){return Ek(e)}create(e){return new QT(e)}},nG=(n,e)=>e,QT=class{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||nG}forEachItem(e){let t;for(t=this._itHead;t!==null;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,i=this._removalsHead,r=0,s=null;for(;t||i;){let o=!i||t&&t.currentIndex<oR(i,r,s)?t:i,a=oR(o,r,s),l=o.currentIndex;if(o===i)r--,i=i._nextRemoved;else if(t=t._next,o.previousIndex==null)r++;else{s||(s=[]);let u=a-r,d=l-r;if(u!=d){for(let m=0;m<u;m++){let y=m<s.length?s[m]:s[m]=0,v=y+m;d<=v&&v<u&&(s[m]=y+1)}let f=o.previousIndex;s[f]=d-u}}a!==l&&e(o,a,l)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;t!==null;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;t!==null;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;t!==null;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;t!==null;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;t!==null;t=t._nextIdentityChange)e(t)}diff(e){if(e==null&&(e=[]),!Ek(e))throw new ye(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._itHead,i=!1,r,s,o;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)s=e[a],o=this._trackByFn(a,s),t===null||!Object.is(t.trackById,o)?(t=this._mismatch(t,s,o,a),i=!0):(i&&(t=this._verifyReinsertion(t,s,o,a)),Object.is(t.item,s)||this._addIdentityChange(t,s)),t=t._next}else r=0,z6(e,a=>{o=this._trackByFn(r,a),t===null||!Object.is(t.trackById,o)?(t=this._mismatch(t,a,o,r),i=!0):(i&&(t=this._verifyReinsertion(t,a,o,r)),Object.is(t.item,a)||this._addIdentityChange(t,a)),t=t._next,r++}),this.length=r;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;e!==null;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;e!==null;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;e!==null;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,i,r){let s;return e===null?s=this._itTail:(s=e._prev,this._remove(e)),e=this._unlinkedRecords===null?null:this._unlinkedRecords.get(i,null),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,s,r)):(e=this._linkedRecords===null?null:this._linkedRecords.get(i,r),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,s,r)):e=this._addAfter(new ZT(t,i),s,r)),e}_verifyReinsertion(e,t,i,r){let s=this._unlinkedRecords===null?null:this._unlinkedRecords.get(i,null);return s!==null?e=this._reinsertAfter(s,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;e!==null;){let t=e._next;this._addToRemovals(this._unlink(e)),e=t}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,i){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(e);let r=e._prevRemoved,s=e._nextRemoved;return r===null?this._removalsHead=s:r._nextRemoved=s,s===null?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(e,t,i),this._addToMoves(e,i),e}_moveAfter(e,t,i){return this._unlink(e),this._insertAfter(e,t,i),this._addToMoves(e,i),e}_addAfter(e,t,i){return this._insertAfter(e,t,i),this._additionsTail===null?this._additionsTail=this._additionsHead=e:this._additionsTail=this._additionsTail._nextAdded=e,e}_insertAfter(e,t,i){let r=t===null?this._itHead:t._next;return e._next=r,e._prev=t,r===null?this._itTail=e:r._prev=e,t===null?this._itHead=e:t._next=e,this._linkedRecords===null&&(this._linkedRecords=new Hg),this._linkedRecords.put(e),e.currentIndex=i,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){this._linkedRecords!==null&&this._linkedRecords.remove(e);let t=e._prev,i=e._next;return t===null?this._itHead=i:t._next=i,i===null?this._itTail=t:i._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail===null?this._movesTail=this._movesHead=e:this._movesTail=this._movesTail._nextMoved=e),e}_addToRemovals(e){return this._unlinkedRecords===null&&(this._unlinkedRecords=new Hg),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=e:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=e,e}},ZT=class{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},XT=class{constructor(){this._head=null,this._tail=null}add(e){this._head===null?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let i;for(i=this._head;i!==null;i=i._nextDup)if((t===null||t<=i.currentIndex)&&Object.is(i.trackById,e))return i;return null}remove(e){let t=e._prevDup,i=e._nextDup;return t===null?this._head=i:t._nextDup=i,i===null?this._tail=t:i._prevDup=t,this._head===null}},Hg=class{constructor(){this.map=new Map}put(e){let t=e.trackById,i=this.map.get(t);i||(i=new XT,this.map.set(t,i)),i.add(e)}get(e,t){let i=e,r=this.map.get(i);return r?r.get(e,t):null}remove(e){let t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function oR(n,e,t){let i=n.previousIndex;if(i===null)return i;let r=0;return t&&i<t.length&&(r=t[i]),i+e+r}function aR(){return new Bw([new YT])}var Bw=(()=>{class n{static{this.\u0275prov=Se({token:n,providedIn:"root",factory:aR})}constructor(t){this.factories=t}static create(t,i){if(i!=null){let r=i.factories.slice();t=t.concat(r)}return new n(t)}static extend(t){return{provide:n,useFactory:i=>n.create(t,i||aR()),deps:[[n,new ew,new li]]}}find(t){let i=this.factories.find(r=>r.supports(t));if(i!=null)return i;throw new ye(901,!1)}}return n})();function kk(n){let{rootComponent:e,appProviders:t,platformProviders:i,platformRef:r}=n;try{let s=r?.injector??X8(i);if(s.get(Mk,!1)===!0&&!n.platformRef)throw new ye(401,!1);let o=[z8({}),{provide:Bu,useExisting:W8},...t||[]],a=new jg({providers:o,parent:s,debugName:"",runEnvironmentInitializers:!1});return Y8({r3Injector:a.injector,platformInjector:s,rootComponent:e})}catch(s){return Promise.reject(s)}}function rc(n){return typeof n=="boolean"?n:n!=null&&n!=="false"}function f0(n,e){La("NgSignals");let t=q1(n);return e?.equal&&(t[yo].equal=e.equal),t}function Na(n){let e=At(null);try{return n()}finally{At(e)}}function Lk(n){let e=Sa(n);if(!e)return null;let t=new $u(e);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return e.standalone},get isSignal(){return e.signals}}}var $k=null;function Mo(){return $k}function jk(n){$k??=n}var w0=class{};var yn=new Pe(""),Yw=(()=>{class n{historyGo(t){throw new Error("")}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>ue(rG),providedIn:"platform"})}}return n})(),Gk=new Pe(""),rG=(()=>{class n extends Yw{constructor(){super(),this._doc=ue(yn),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Mo().getBaseHref(this._doc)}onPopState(t){let i=Mo().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",t,!1),()=>i.removeEventListener("popstate",t)}onHashChange(t){let i=Mo().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",t,!1),()=>i.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,i,r){this._history.pushState(t,i,r)}replaceState(t,i,r){this._history.replaceState(t,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>new n,providedIn:"platform"})}}return n})();function Qw(n,e){if(n.length==0)return e;if(e.length==0)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,t==2?n+e.substring(1):t==1?n+e:n+"/"+e}function Ok(n){let e=n.match(/#|\?|$/),t=e&&e.index||n.length,i=t-(n[t-1]==="/"?1:0);return n.slice(0,i)+n.slice(t)}function Do(n){return n&&n[0]!=="?"?"?"+n:n}var ko=(()=>{class n{historyGo(t){throw new Error("")}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>ue(Zw),providedIn:"root"})}}return n})(),zk=new Pe(""),Zw=(()=>{class n extends ko{constructor(t,i){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??ue(yn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Qw(this._baseHref,t)}path(t=!1){let i=this._platformLocation.pathname+Do(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${i}${r}`:i}pushState(t,i,r,s){let o=this.prepareExternalUrl(r+Do(s));this._platformLocation.pushState(t,i,o)}replaceState(t,i,r,s){let o=this.prepareExternalUrl(r+Do(s));this._platformLocation.replaceState(t,i,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static{this.\u0275fac=function(i){return new(i||n)(Me(Yw),Me(zk,8))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Hk=(()=>{class n extends ko{constructor(t,i){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],i!=null&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let i=this._platformLocation.hash??"#";return i.length>0?i.substring(1):i}prepareExternalUrl(t){let i=Qw(this._baseHref,t);return i.length>0?"#"+i:i}pushState(t,i,r,s){let o=this.prepareExternalUrl(r+Do(s));o.length==0&&(o=this._platformLocation.pathname),this._platformLocation.pushState(t,i,o)}replaceState(t,i,r,s){let o=this.prepareExternalUrl(r+Do(s));o.length==0&&(o=this._platformLocation.pathname),this._platformLocation.replaceState(t,i,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static{this.\u0275fac=function(i){return new(i||n)(Me(Yw),Me(zk,8))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),Fa=(()=>{class n{constructor(t){this._subject=new tt,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;let i=this._locationStrategy.getBaseHref();this._basePath=aG(Ok(Nk(i))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,i=""){return this.path()==this.normalize(t+Do(i))}normalize(t){return n.stripTrailingSlash(oG(this._basePath,Nk(t)))}prepareExternalUrl(t){return t&&t[0]!=="/"&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,i="",r=null){this._locationStrategy.pushState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Do(i)),r)}replaceState(t,i="",r=null){this._locationStrategy.replaceState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Do(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{let i=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(i,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",i){this._urlChangeListeners.forEach(r=>r(t,i))}subscribe(t,i,r){return this._subject.subscribe({next:t,error:i,complete:r})}static{this.normalizeQueryParams=Do}static{this.joinWithSlash=Qw}static{this.stripTrailingSlash=Ok}static{this.\u0275fac=function(i){return new(i||n)(Me(ko))}}static{this.\u0275prov=Se({token:n,factory:()=>sG(),providedIn:"root"})}}return n})();function sG(){return new Fa(Me(ko))}function oG(n,e){if(!n||!e.startsWith(n))return e;let t=e.substring(n.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function Nk(n){return n.replace(/\/index.html$/,"")}function aG(n){if(new RegExp("^(https?:)?//").test(n)){let[,t]=n.split(/\/\/[^\/]+/);return t}return n}var qk=function(n){return n[n.Decimal=0]="Decimal",n[n.Percent=1]="Percent",n[n.Currency=2]="Currency",n[n.Scientific=3]="Scientific",n}(qk||{});var Ai=function(n){return n[n.Format=0]="Format",n[n.Standalone=1]="Standalone",n}(Ai||{}),Yt=function(n){return n[n.Narrow=0]="Narrow",n[n.Abbreviated=1]="Abbreviated",n[n.Wide=2]="Wide",n[n.Short=3]="Short",n}(Yt||{}),sr=function(n){return n[n.Short=0]="Short",n[n.Medium=1]="Medium",n[n.Long=2]="Long",n[n.Full=3]="Full",n}(sr||{}),or={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function lG(n){return rr(n)[gn.LocaleId]}function cG(n,e,t){let i=rr(n),r=[i[gn.DayPeriodsFormat],i[gn.DayPeriodsStandalone]],s=Rr(r,e);return Rr(s,t)}function uG(n,e,t){let i=rr(n),r=[i[gn.DaysFormat],i[gn.DaysStandalone]],s=Rr(r,e);return Rr(s,t)}function dG(n,e,t){let i=rr(n),r=[i[gn.MonthsFormat],i[gn.MonthsStandalone]],s=Rr(r,e);return Rr(s,t)}function hG(n,e){let i=rr(n)[gn.Eras];return Rr(i,e)}function p0(n,e){let t=rr(n);return Rr(t[gn.DateFormat],e)}function m0(n,e){let t=rr(n);return Rr(t[gn.TimeFormat],e)}function g0(n,e){let i=rr(n)[gn.DateTimeFormat];return Rr(i,e)}function Po(n,e){let t=rr(n),i=t[gn.NumberSymbols][e];if(typeof i>"u"){if(e===or.CurrencyDecimal)return t[gn.NumberSymbols][or.Decimal];if(e===or.CurrencyGroup)return t[gn.NumberSymbols][or.Group]}return i}function fG(n,e){return rr(n)[gn.NumberFormats][e]}function Wk(n){if(!n[gn.ExtraData])throw new Error(`Missing extra locale data for the locale "${n[gn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function pG(n){let e=rr(n);return Wk(e),(e[gn.ExtraData][2]||[]).map(i=>typeof i=="string"?Uw(i):[Uw(i[0]),Uw(i[1])])}function mG(n,e,t){let i=rr(n);Wk(i);let r=[i[gn.ExtraData][0],i[gn.ExtraData][1]],s=Rr(r,e)||[];return Rr(s,t)||[]}function Rr(n,e){for(let t=e;t>-1;t--)if(typeof n[t]<"u")return n[t];throw new Error("Locale data API: locale data undefined")}function Uw(n){let[e,t]=n.split(":");return{hours:+e,minutes:+t}}var gG=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,y0={},yG=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/,Ro=function(n){return n[n.Short=0]="Short",n[n.ShortGMT=1]="ShortGMT",n[n.Long=2]="Long",n[n.Extended=3]="Extended",n}(Ro||{}),Vt=function(n){return n[n.FullYear=0]="FullYear",n[n.Month=1]="Month",n[n.Date=2]="Date",n[n.Hours=3]="Hours",n[n.Minutes=4]="Minutes",n[n.Seconds=5]="Seconds",n[n.FractionalSeconds=6]="FractionalSeconds",n[n.Day=7]="Day",n}(Vt||{}),Ft=function(n){return n[n.DayPeriods=0]="DayPeriods",n[n.Days=1]="Days",n[n.Months=2]="Months",n[n.Eras=3]="Eras",n}(Ft||{});function vG(n,e,t,i){let r=xG(n);e=Ao(t,e)||e;let o=[],a;for(;e;)if(a=yG.exec(e),a){o=o.concat(a.slice(1));let d=o.pop();if(!d)break;e=d}else{o.push(e);break}let l=r.getTimezoneOffset();i&&(l=Yk(i,l),r=CG(r,i,!0));let u="";return o.forEach(d=>{let f=IG(d);u+=f?f(r,t,l):d==="''"?"'":d.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),u}function b0(n,e,t){let i=new Date(0);return i.setFullYear(n,e,t),i.setHours(0,0,0),i}function Ao(n,e){let t=lG(n);if(y0[t]??={},y0[t][e])return y0[t][e];let i="";switch(e){case"shortDate":i=p0(n,sr.Short);break;case"mediumDate":i=p0(n,sr.Medium);break;case"longDate":i=p0(n,sr.Long);break;case"fullDate":i=p0(n,sr.Full);break;case"shortTime":i=m0(n,sr.Short);break;case"mediumTime":i=m0(n,sr.Medium);break;case"longTime":i=m0(n,sr.Long);break;case"fullTime":i=m0(n,sr.Full);break;case"short":let r=Ao(n,"shortTime"),s=Ao(n,"shortDate");i=v0(g0(n,sr.Short),[r,s]);break;case"medium":let o=Ao(n,"mediumTime"),a=Ao(n,"mediumDate");i=v0(g0(n,sr.Medium),[o,a]);break;case"long":let l=Ao(n,"longTime"),u=Ao(n,"longDate");i=v0(g0(n,sr.Long),[l,u]);break;case"full":let d=Ao(n,"fullTime"),f=Ao(n,"fullDate");i=v0(g0(n,sr.Full),[d,f]);break}return i&&(y0[t][e]=i),i}function v0(n,e){return e&&(n=n.replace(/\{([^}]+)}/g,function(t,i){return e!=null&&i in e?e[i]:t})),n}function es(n,e,t="-",i,r){let s="";(n<0||r&&n<=0)&&(r?n=-n+1:(n=-n,s=t));let o=String(n);for(;o.length<e;)o="0"+o;return i&&(o=o.slice(o.length-e)),s+o}function _G(n,e){return es(n,3).substring(0,e)}function Rn(n,e,t=0,i=!1,r=!1){return function(s,o){let a=EG(n,s);if((t>0||a>-t)&&(a+=t),n===Vt.Hours)a===0&&t===-12&&(a=12);else if(n===Vt.FractionalSeconds)return _G(a,e);let l=Po(o,or.MinusSign);return es(a,e,l,i,r)}}function EG(n,e){switch(n){case Vt.FullYear:return e.getFullYear();case Vt.Month:return e.getMonth();case Vt.Date:return e.getDate();case Vt.Hours:return e.getHours();case Vt.Minutes:return e.getMinutes();case Vt.Seconds:return e.getSeconds();case Vt.FractionalSeconds:return e.getMilliseconds();case Vt.Day:return e.getDay();default:throw new Error(`Unknown DateType value "${n}".`)}}function nn(n,e,t=Ai.Format,i=!1){return function(r,s){return TG(r,s,n,e,t,i)}}function TG(n,e,t,i,r,s){switch(t){case Ft.Months:return dG(e,r,i)[n.getMonth()];case Ft.Days:return uG(e,r,i)[n.getDay()];case Ft.DayPeriods:let o=n.getHours(),a=n.getMinutes();if(s){let u=pG(e),d=mG(e,r,i),f=u.findIndex(m=>{if(Array.isArray(m)){let[y,v]=m,E=o>=y.hours&&a>=y.minutes,T=o<v.hours||o===v.hours&&a<v.minutes;if(y.hours<v.hours){if(E&&T)return!0}else if(E||T)return!0}else if(m.hours===o&&m.minutes===a)return!0;return!1});if(f!==-1)return d[f]}return cG(e,r,i)[o<12?0:1];case Ft.Eras:return hG(e,i)[n.getFullYear()<=0?0:1];default:let l=t;throw new Error(`unexpected translation type ${l}`)}}function _0(n){return function(e,t,i){let r=-1*i,s=Po(t,or.MinusSign),o=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case Ro.Short:return(r>=0?"+":"")+es(o,2,s)+es(Math.abs(r%60),2,s);case Ro.ShortGMT:return"GMT"+(r>=0?"+":"")+es(o,1,s);case Ro.Long:return"GMT"+(r>=0?"+":"")+es(o,2,s)+":"+es(Math.abs(r%60),2,s);case Ro.Extended:return i===0?"Z":(r>=0?"+":"")+es(o,2,s)+":"+es(Math.abs(r%60),2,s);default:throw new Error(`Unknown zone width "${n}"`)}}}var wG=0,T0=4;function bG(n){let e=b0(n,wG,1).getDay();return b0(n,0,1+(e<=T0?T0:T0+7)-e)}function Kk(n){let e=n.getDay(),t=e===0?-3:T0-e;return b0(n.getFullYear(),n.getMonth(),n.getDate()+t)}function $w(n,e=!1){return function(t,i){let r;if(e){let s=new Date(t.getFullYear(),t.getMonth(),1).getDay()-1,o=t.getDate();r=1+Math.floor((o+s)/7)}else{let s=Kk(t),o=bG(s.getFullYear()),a=s.getTime()-o.getTime();r=1+Math.round(a/6048e5)}return es(r,n,Po(i,or.MinusSign))}}function E0(n,e=!1){return function(t,i){let s=Kk(t).getFullYear();return es(s,n,Po(i,or.MinusSign),e)}}var jw={};function IG(n){if(jw[n])return jw[n];let e;switch(n){case"G":case"GG":case"GGG":e=nn(Ft.Eras,Yt.Abbreviated);break;case"GGGG":e=nn(Ft.Eras,Yt.Wide);break;case"GGGGG":e=nn(Ft.Eras,Yt.Narrow);break;case"y":e=Rn(Vt.FullYear,1,0,!1,!0);break;case"yy":e=Rn(Vt.FullYear,2,0,!0,!0);break;case"yyy":e=Rn(Vt.FullYear,3,0,!1,!0);break;case"yyyy":e=Rn(Vt.FullYear,4,0,!1,!0);break;case"Y":e=E0(1);break;case"YY":e=E0(2,!0);break;case"YYY":e=E0(3);break;case"YYYY":e=E0(4);break;case"M":case"L":e=Rn(Vt.Month,1,1);break;case"MM":case"LL":e=Rn(Vt.Month,2,1);break;case"MMM":e=nn(Ft.Months,Yt.Abbreviated);break;case"MMMM":e=nn(Ft.Months,Yt.Wide);break;case"MMMMM":e=nn(Ft.Months,Yt.Narrow);break;case"LLL":e=nn(Ft.Months,Yt.Abbreviated,Ai.Standalone);break;case"LLLL":e=nn(Ft.Months,Yt.Wide,Ai.Standalone);break;case"LLLLL":e=nn(Ft.Months,Yt.Narrow,Ai.Standalone);break;case"w":e=$w(1);break;case"ww":e=$w(2);break;case"W":e=$w(1,!0);break;case"d":e=Rn(Vt.Date,1);break;case"dd":e=Rn(Vt.Date,2);break;case"c":case"cc":e=Rn(Vt.Day,1);break;case"ccc":e=nn(Ft.Days,Yt.Abbreviated,Ai.Standalone);break;case"cccc":e=nn(Ft.Days,Yt.Wide,Ai.Standalone);break;case"ccccc":e=nn(Ft.Days,Yt.Narrow,Ai.Standalone);break;case"cccccc":e=nn(Ft.Days,Yt.Short,Ai.Standalone);break;case"E":case"EE":case"EEE":e=nn(Ft.Days,Yt.Abbreviated);break;case"EEEE":e=nn(Ft.Days,Yt.Wide);break;case"EEEEE":e=nn(Ft.Days,Yt.Narrow);break;case"EEEEEE":e=nn(Ft.Days,Yt.Short);break;case"a":case"aa":case"aaa":e=nn(Ft.DayPeriods,Yt.Abbreviated);break;case"aaaa":e=nn(Ft.DayPeriods,Yt.Wide);break;case"aaaaa":e=nn(Ft.DayPeriods,Yt.Narrow);break;case"b":case"bb":case"bbb":e=nn(Ft.DayPeriods,Yt.Abbreviated,Ai.Standalone,!0);break;case"bbbb":e=nn(Ft.DayPeriods,Yt.Wide,Ai.Standalone,!0);break;case"bbbbb":e=nn(Ft.DayPeriods,Yt.Narrow,Ai.Standalone,!0);break;case"B":case"BB":case"BBB":e=nn(Ft.DayPeriods,Yt.Abbreviated,Ai.Format,!0);break;case"BBBB":e=nn(Ft.DayPeriods,Yt.Wide,Ai.Format,!0);break;case"BBBBB":e=nn(Ft.DayPeriods,Yt.Narrow,Ai.Format,!0);break;case"h":e=Rn(Vt.Hours,1,-12);break;case"hh":e=Rn(Vt.Hours,2,-12);break;case"H":e=Rn(Vt.Hours,1);break;case"HH":e=Rn(Vt.Hours,2);break;case"m":e=Rn(Vt.Minutes,1);break;case"mm":e=Rn(Vt.Minutes,2);break;case"s":e=Rn(Vt.Seconds,1);break;case"ss":e=Rn(Vt.Seconds,2);break;case"S":e=Rn(Vt.FractionalSeconds,1);break;case"SS":e=Rn(Vt.FractionalSeconds,2);break;case"SSS":e=Rn(Vt.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":e=_0(Ro.Short);break;case"ZZZZZ":e=_0(Ro.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":e=_0(Ro.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":e=_0(Ro.Long);break;default:return null}return jw[n]=e,e}function Yk(n,e){n=n.replace(/:/g,"");let t=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(t)?e:t}function SG(n,e){return n=new Date(n.getTime()),n.setMinutes(n.getMinutes()+e),n}function CG(n,e,t){let i=t?-1:1,r=n.getTimezoneOffset(),s=Yk(e,r);return SG(n,i*(s-r))}function xG(n){if(Fk(n))return n;if(typeof n=="number"&&!isNaN(n))return new Date(n);if(typeof n=="string"){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){let[r,s=1,o=1]=n.split("-").map(a=>+a);return b0(r,s-1,o)}let t=parseFloat(n);if(!isNaN(n-t))return new Date(t);let i;if(i=n.match(gG))return AG(i)}let e=new Date(n);if(!Fk(e))throw new Error(`Unable to convert "${n}" into a date`);return e}function AG(n){let e=new Date(0),t=0,i=0,r=n[8]?e.setUTCFullYear:e.setFullYear,s=n[8]?e.setUTCHours:e.setHours;n[9]&&(t=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(e,Number(n[1]),Number(n[2])-1,Number(n[3]));let o=Number(n[4]||0)-t,a=Number(n[5]||0)-i,l=Number(n[6]||0),u=Math.floor(parseFloat("0."+(n[7]||0))*1e3);return s.call(e,o,a,l,u),e}function Fk(n){return n instanceof Date&&!isNaN(n.valueOf())}var DG=/^(\d+)?\.((\d+)(-(\d+))?)?$/,Vk=22,I0=".",nf="0",PG=";",RG=",",Gw="#";function MG(n,e,t,i,r,s,o=!1){let a="",l=!1;if(!isFinite(n))a=Po(t,or.Infinity);else{let u=NG(n);o&&(u=OG(u));let d=e.minInt,f=e.minFrac,m=e.maxFrac;if(s){let D=s.match(DG);if(D===null)throw new Error(`${s} is not a valid digit info`);let P=D[1],V=D[3],G=D[5];P!=null&&(d=zw(P)),V!=null&&(f=zw(V)),G!=null?m=zw(G):V!=null&&f>m&&(m=f)}FG(u,f,m);let y=u.digits,v=u.integerLen,E=u.exponent,T=[];for(l=y.every(D=>!D);v<d;v++)y.unshift(0);for(;v<0;v++)y.unshift(0);v>0?T=y.splice(v,y.length):(T=y,y=[0]);let C=[];for(y.length>=e.lgSize&&C.unshift(y.splice(-e.lgSize,y.length).join(""));y.length>e.gSize;)C.unshift(y.splice(-e.gSize,y.length).join(""));y.length&&C.unshift(y.join("")),a=C.join(Po(t,i)),T.length&&(a+=Po(t,r)+T.join("")),E&&(a+=Po(t,or.Exponential)+"+"+E)}return n<0&&!l?a=e.negPre+a+e.negSuf:a=e.posPre+a+e.posSuf,a}function kG(n,e,t){let i=fG(e,qk.Decimal),r=LG(i,Po(e,or.MinusSign));return MG(n,r,e,or.Group,or.Decimal,t)}function LG(n,e="-"){let t={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},i=n.split(PG),r=i[0],s=i[1],o=r.indexOf(I0)!==-1?r.split(I0):[r.substring(0,r.lastIndexOf(nf)+1),r.substring(r.lastIndexOf(nf)+1)],a=o[0],l=o[1]||"";t.posPre=a.substring(0,a.indexOf(Gw));for(let d=0;d<l.length;d++){let f=l.charAt(d);f===nf?t.minFrac=t.maxFrac=d+1:f===Gw?t.maxFrac=d+1:t.posSuf+=f}let u=a.split(RG);if(t.gSize=u[1]?u[1].length:0,t.lgSize=u[2]||u[1]?(u[2]||u[1]).length:0,s){let d=r.length-t.posPre.length-t.posSuf.length,f=s.indexOf(Gw);t.negPre=s.substring(0,f).replace(/'/g,""),t.negSuf=s.slice(f+d).replace(/'/g,"")}else t.negPre=e+t.posPre,t.negSuf=t.posSuf;return t}function OG(n){if(n.digits[0]===0)return n;let e=n.digits.length-n.integerLen;return n.exponent?n.exponent+=2:(e===0?n.digits.push(0,0):e===1&&n.digits.push(0),n.integerLen+=2),n}function NG(n){let e=Math.abs(n)+"",t=0,i,r,s,o,a;for((r=e.indexOf(I0))>-1&&(e=e.replace(I0,"")),(s=e.search(/e/i))>0?(r<0&&(r=s),r+=+e.slice(s+1),e=e.substring(0,s)):r<0&&(r=e.length),s=0;e.charAt(s)===nf;s++);if(s===(a=e.length))i=[0],r=1;else{for(a--;e.charAt(a)===nf;)a--;for(r-=s,i=[],o=0;s<=a;s++,o++)i[o]=Number(e.charAt(s))}return r>Vk&&(i=i.splice(0,Vk-1),t=r-1,r=1),{digits:i,exponent:t,integerLen:r}}function FG(n,e,t){if(e>t)throw new Error(`The minimum number of digits after fraction (${e}) is higher than the maximum (${t}).`);let i=n.digits,r=i.length-n.integerLen,s=Math.min(Math.max(e,r),t),o=s+n.integerLen,a=i[o];if(o>0){i.splice(Math.max(n.integerLen,o));for(let f=o;f<i.length;f++)i[f]=0}else{r=Math.max(0,r),n.integerLen=1,i.length=Math.max(1,o=s+1),i[0]=0;for(let f=1;f<o;f++)i[f]=0}if(a>=5)if(o-1<0){for(let f=0;f>o;f--)i.unshift(0),n.integerLen++;i.unshift(1),n.integerLen++}else i[o-1]++;for(;r<Math.max(0,s);r++)i.push(0);let l=s!==0,u=e+n.integerLen,d=i.reduceRight(function(f,m,y,v){return m=m+f,v[y]=m<10?m:m-10,l&&(v[y]===0&&y>=u?v.pop():l=!1),m>=10?1:0},0);d&&(i.unshift(d),n.integerLen++)}function zw(n){let e=parseInt(n);if(isNaN(e))throw new Error("Invalid integer literal when parsing "+n);return e}function S0(n,e){e=encodeURIComponent(e);for(let t of n.split(";")){let i=t.indexOf("="),[r,s]=i==-1?[t,""]:[t.slice(0,i),t.slice(i+1)];if(r.trim()===e)return decodeURIComponent(s)}return null}var Hw=class{constructor(e,t,i,r){this.$implicit=e,this.ngForOf=t,this.index=i,this.count=r}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},Hn=(()=>{class n{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,i,r){this._viewContainer=t,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let t=this._ngForOf;if(!this._differ&&t)if(0)try{}catch{}else this._differ=this._differs.find(t).create(this.ngForTrackBy)}if(this._differ){let t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){let i=this._viewContainer;t.forEachOperation((r,s,o)=>{if(r.previousIndex==null)i.createEmbeddedView(this._template,new Hw(r.item,this._ngForOf,-1,-1),o===null?void 0:o);else if(o==null)i.remove(s===null?void 0:s);else if(s!==null){let a=i.get(s);i.move(a,o),Bk(a,r)}});for(let r=0,s=i.length;r<s;r++){let a=i.get(r).context;a.index=r,a.count=s,a.ngForOf=this._ngForOf}t.forEachIdentityChange(r=>{let s=i.get(r.currentIndex);Bk(s,r)})}static ngTemplateContextGuard(t,i){return!0}static{this.\u0275fac=function(i){return new(i||n)(pe(ka),pe(Zl),pe(Bw))}}static{this.\u0275dir=ci({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}}return n})();function Bk(n,e){n.context.$implicit=e.item}var qt=(()=>{class n{constructor(t,i){this._viewContainer=t,this._context=new qw,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){Uk("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){Uk("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,i){return!0}static{this.\u0275fac=function(i){return new(i||n)(pe(ka),pe(Zl))}}static{this.\u0275dir=ci({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}}return n})(),qw=class{constructor(){this.$implicit=null,this.ngIf=null}};function Uk(n,e){if(!!!(!e||e.createEmbeddedView))throw new Error(`${n} must be a TemplateRef, but received '${Ti(e)}'.`)}function Qk(n,e){return new ye(2100,!1)}var VG="mediumDate",BG=new Pe(""),UG=new Pe(""),Zk=(()=>{class n{constructor(t,i,r){this.locale=t,this.defaultTimezone=i,this.defaultOptions=r}transform(t,i,r,s){if(t==null||t===""||t!==t)return null;try{let o=i??this.defaultOptions?.dateFormat??VG,a=r??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return vG(t,o,s||this.locale,a)}catch(o){throw Qk(n,o.message)}}static{this.\u0275fac=function(i){return new(i||n)(pe(tf,16),pe(BG,24),pe(UG,24))}}static{this.\u0275pipe=iw({name:"date",type:n,pure:!0,standalone:!0})}}return n})();var Xk=(()=>{class n{constructor(t){this._locale=t}transform(t,i,r){if(!$G(t))return null;r||=this._locale;try{let s=jG(t);return kG(s,r,i)}catch(s){throw Qk(n,s.message)}}static{this.\u0275fac=function(i){return new(i||n)(pe(tf,16))}}static{this.\u0275pipe=iw({name:"number",type:n,pure:!0,standalone:!0})}}return n})();function $G(n){return!(n==null||n===""||n!==n)}function jG(n){if(typeof n=="string"&&!isNaN(Number(n)-parseFloat(n)))return Number(n);if(typeof n!="number")throw new Error(`${n} is not a number`);return n}var Pt=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=Ps({type:n})}static{this.\u0275inj=Ds({})}}return n})(),Xw="browser",GG="server";function Jw(n){return n===Xw}function C0(n){return n===GG}var Jk=(()=>{class n{static{this.\u0275prov=Se({token:n,providedIn:"root",factory:()=>Jw(ue(Bi))?new Ww(ue(yn),window):new Kw})}}return n})(),Ww=class{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){Array.isArray(e)?this.offset=()=>e:this.offset=e}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(e){this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){let t=zG(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){this.window.history.scrollRestoration=e}scrollToElement(e){let t=e.getBoundingClientRect(),i=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}};function zG(n,e){let t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if(typeof n.createTreeWalker=="function"&&n.body&&typeof n.body.attachShadow=="function"){let i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT),r=i.currentNode;for(;r;){let s=r.shadowRoot;if(s){let o=s.getElementById(e)||s.querySelector(`[name="${e}"]`);if(o)return o}r=i.nextNode()}}return null}var Kw=class{setOffset(e){}getScrollPosition(){return[0,0]}scrollToPosition(e){}scrollToAnchor(e){}setHistoryScrollRestoration(e){}},qu=class{};var sf=class{},A0=class{},Lo=class n{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let i=t.indexOf(":");if(i>0){let r=t.slice(0,i),s=r.toLowerCase(),o=t.slice(i+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(o):this.headers.set(s,[o])}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,i)=>{this.setHeaderEntries(i,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,i])=>{this.setHeaderEntries(t,i)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new n;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let i=e.value;if(typeof i=="string"&&(i=[i]),i.length===0)return;this.maybeSetNormalizedName(e.name,t);let r=(e.op==="a"?this.headers.get(t):void 0)||[];r.push(...i),this.headers.set(t,r);break;case"d":let s=e.value;if(!s)this.headers.delete(t),this.normalizedNames.delete(t);else{let o=this.headers.get(t);if(!o)return;o=o.filter(a=>s.indexOf(a)===-1),o.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,o)}break}}setHeaderEntries(e,t){let i=(Array.isArray(t)?t:[t]).map(s=>s.toString()),r=e.toLowerCase();this.headers.set(r,i),this.maybeSetNormalizedName(e,r)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var tb=class{encodeKey(e){return eL(e)}encodeValue(e){return eL(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}};function HG(n,e){let t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{let s=r.indexOf("="),[o,a]=s==-1?[e.decodeKey(r),""]:[e.decodeKey(r.slice(0,s)),e.decodeValue(r.slice(s+1))],l=t.get(o)||[];l.push(a),t.set(o,l)}),t}var qG=/%(\d[a-f0-9])/gi,WG={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function eL(n){return encodeURIComponent(n).replace(qG,(e,t)=>WG[t]??e)}function x0(n){return`${n}`}var Ba=class n{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new tb,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=HG(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{let i=e.fromObject[t],r=Array.isArray(i)?i.map(x0):[x0(i)];this.map.set(t,r)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){let t=[];return Object.keys(e).forEach(i=>{let r=e[i];Array.isArray(r)?r.forEach(s=>{t.push({param:i,value:s,op:"a"})}):t.push({param:i,value:r,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let t=this.encoder.encodeKey(e);return this.map.get(e).map(i=>t+"="+this.encoder.encodeValue(i)).join("&")}).filter(e=>e!=="").join("&")}clone(e){let t=new n({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let t=(e.op==="a"?this.map.get(e.param):void 0)||[];t.push(x0(e.value)),this.map.set(e.param,t);break;case"d":if(e.value!==void 0){let i=this.map.get(e.param)||[],r=i.indexOf(x0(e.value));r!==-1&&i.splice(r,1),i.length>0?this.map.set(e.param,i):this.map.delete(e.param)}else{this.map.delete(e.param);break}}}),this.cloneFrom=this.updates=null)}};var nb=class{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}};function KG(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function tL(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function nL(n){return typeof Blob<"u"&&n instanceof Blob}function iL(n){return typeof FormData<"u"&&n instanceof FormData}function YG(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var rf=class n{constructor(e,t,i,r){this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase();let s;if(KG(this.method)||r?(this.body=i!==void 0?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params),this.transferCache=s.transferCache),this.headers??=new Lo,this.context??=new nb,!this.params)this.params=new Ba,this.urlWithParams=t;else{let o=this.params.toString();if(o.length===0)this.urlWithParams=t;else{let a=t.indexOf("?"),l=a===-1?"?":a<t.length-1?"&":"";this.urlWithParams=t+l+o}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||tL(this.body)||nL(this.body)||iL(this.body)||YG(this.body)?this.body:this.body instanceof Ba?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||iL(this.body)?null:nL(this.body)?this.body.type||null:tL(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Ba?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(e={}){let t=e.method||this.method,i=e.url||this.url,r=e.responseType||this.responseType,s=e.transferCache??this.transferCache,o=e.body!==void 0?e.body:this.body,a=e.withCredentials??this.withCredentials,l=e.reportProgress??this.reportProgress,u=e.headers||this.headers,d=e.params||this.params,f=e.context??this.context;return e.setHeaders!==void 0&&(u=Object.keys(e.setHeaders).reduce((m,y)=>m.set(y,e.setHeaders[y]),u)),e.setParams&&(d=Object.keys(e.setParams).reduce((m,y)=>m.set(y,e.setParams[y]),d)),new n(t,i,o,{params:d,headers:u,context:f,reportProgress:l,responseType:r,withCredentials:a,transferCache:s})}},Ua=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(Ua||{}),of=class{constructor(e,t=200,i="OK"){this.headers=e.headers||new Lo,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||i,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}},D0=class n extends of{constructor(e={}){super(e),this.type=Ua.ResponseHeader}clone(e={}){return new n({headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},af=class n extends of{constructor(e={}){super(e),this.type=Ua.Response,this.body=e.body!==void 0?e.body:null}clone(e={}){return new n({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},Va=class extends of{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}},aL=200,QG=204;function eb(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,transferCache:n.transferCache}}var sb=(()=>{class n{constructor(t){this.handler=t}request(t,i,r={}){let s;if(t instanceof rf)s=t;else{let l;r.headers instanceof Lo?l=r.headers:l=new Lo(r.headers);let u;r.params&&(r.params instanceof Ba?u=r.params:u=new Ba({fromObject:r.params})),s=new rf(t,i,r.body!==void 0?r.body:null,{headers:l,context:r.context,params:u,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache})}let o=$e(s).pipe(vo(l=>this.handler.handle(l)));if(t instanceof rf||r.observe==="events")return o;let a=o.pipe(Ni(l=>l instanceof af));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return a.pipe(We(l=>{if(l.body!==null&&!(l.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return l.body}));case"blob":return a.pipe(We(l=>{if(l.body!==null&&!(l.body instanceof Blob))throw new Error("Response is not a Blob.");return l.body}));case"text":return a.pipe(We(l=>{if(l.body!==null&&typeof l.body!="string")throw new Error("Response is not a string.");return l.body}));case"json":default:return a.pipe(We(l=>l.body))}case"response":return a;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(t,i={}){return this.request("DELETE",t,i)}get(t,i={}){return this.request("GET",t,i)}head(t,i={}){return this.request("HEAD",t,i)}jsonp(t,i){return this.request("JSONP",t,{params:new Ba().append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,i={}){return this.request("OPTIONS",t,i)}patch(t,i,r={}){return this.request("PATCH",t,eb(r,i))}post(t,i,r={}){return this.request("POST",t,eb(r,i))}put(t,i,r={}){return this.request("PUT",t,eb(r,i))}static{this.\u0275fac=function(i){return new(i||n)(Me(sf))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),ZG=/^\)\]\}',?\n/,XG="X-Request-URL";function rL(n){if(n.url)return n.url;let e=XG.toLocaleLowerCase();return n.headers.get(e)}var JG=(()=>{class n{constructor(){this.fetchImpl=ue(ib,{optional:!0})?.fetch??((...t)=>globalThis.fetch(...t)),this.ngZone=ue(Dt)}handle(t){return new rt(i=>{let r=new AbortController;return this.doRequest(t,r.signal,i).then(rb,s=>i.error(new Va({error:s}))),()=>r.abort()})}doRequest(t,i,r){return U(this,null,function*(){let s=this.createRequestInit(t),o;try{let y=this.ngZone.runOutsideAngular(()=>this.fetchImpl(t.urlWithParams,de({signal:i},s)));ez(y),r.next({type:Ua.Sent}),o=yield y}catch(y){r.error(new Va({error:y,status:y.status??0,statusText:y.statusText,url:t.urlWithParams,headers:y.headers}));return}let a=new Lo(o.headers),l=o.statusText,u=rL(o)??t.urlWithParams,d=o.status,f=null;if(t.reportProgress&&r.next(new D0({headers:a,status:d,statusText:l,url:u})),o.body){let y=o.headers.get("content-length"),v=[],E=o.body.getReader(),T=0,C,D,P=typeof Zone<"u"&&Zone.current;yield this.ngZone.runOutsideAngular(()=>U(this,null,function*(){for(;;){let{done:G,value:H}=yield E.read();if(G)break;if(v.push(H),T+=H.length,t.reportProgress){D=t.responseType==="text"?(D??"")+(C??=new TextDecoder).decode(H,{stream:!0}):void 0;let A=()=>r.next({type:Ua.DownloadProgress,total:y?+y:void 0,loaded:T,partialText:D});P?P.run(A):A()}}}));let V=this.concatChunks(v,T);try{let G=o.headers.get("Content-Type")??"";f=this.parseBody(t,V,G)}catch(G){r.error(new Va({error:G,headers:new Lo(o.headers),status:o.status,statusText:o.statusText,url:rL(o)??t.urlWithParams}));return}}d===0&&(d=f?aL:0),d>=200&&d<300?(r.next(new af({body:f,headers:a,status:d,statusText:l,url:u})),r.complete()):r.error(new Va({error:f,headers:a,status:d,statusText:l,url:u}))})}parseBody(t,i,r){switch(t.responseType){case"json":let s=new TextDecoder().decode(i).replace(ZG,"");return s===""?null:JSON.parse(s);case"text":return new TextDecoder().decode(i);case"blob":return new Blob([i],{type:r});case"arraybuffer":return i.buffer}}createRequestInit(t){let i={},r=t.withCredentials?"include":void 0;if(t.headers.forEach((s,o)=>i[s]=o.join(",")),t.headers.has("Accept")||(i.Accept="application/json, text/plain, */*"),!t.headers.has("Content-Type")){let s=t.detectContentTypeHeader();s!==null&&(i["Content-Type"]=s)}return{body:t.serializeBody(),method:t.method,headers:i,credentials:r}}concatChunks(t,i){let r=new Uint8Array(i),s=0;for(let o of t)r.set(o,s),s+=o.length;return r}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),ib=class{};function rb(){}function ez(n){n.then(rb,rb)}function tz(n,e){return e(n)}function nz(n,e,t){return(i,r)=>Ar(t,()=>e(i,s=>n(s,r)))}var lL=new Pe(""),iz=new Pe(""),rz=new Pe("",{providedIn:"root",factory:()=>!0});var sL=(()=>{class n extends sf{constructor(t,i){super(),this.backend=t,this.injector=i,this.chain=null,this.pendingTasks=ue(Ma),this.contributeToStability=ue(rz)}handle(t){if(this.chain===null){let i=Array.from(new Set([...this.injector.get(lL),...this.injector.get(iz,[])]));this.chain=i.reduceRight((r,s)=>nz(r,s,this.injector),tz)}if(this.contributeToStability){let i=this.pendingTasks.add();return this.chain(t,r=>this.backend.handle(r)).pipe(Vl(()=>this.pendingTasks.remove(i)))}else return this.chain(t,i=>this.backend.handle(i))}static{this.\u0275fac=function(i){return new(i||n)(Me(A0),Me(wi))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})();var sz=/^\)\]\}',?\n/;function oz(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}var oL=(()=>{class n{constructor(t){this.xhrFactory=t}handle(t){if(t.method==="JSONP")throw new ye(-2800,!1);let i=this.xhrFactory;return(i.\u0275loadImpl?tn(i.\u0275loadImpl()):$e(null)).pipe(Fi(()=>new rt(s=>{let o=i.build();if(o.open(t.method,t.urlWithParams),t.withCredentials&&(o.withCredentials=!0),t.headers.forEach((E,T)=>o.setRequestHeader(E,T.join(","))),t.headers.has("Accept")||o.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){let E=t.detectContentTypeHeader();E!==null&&o.setRequestHeader("Content-Type",E)}if(t.responseType){let E=t.responseType.toLowerCase();o.responseType=E!=="json"?E:"text"}let a=t.serializeBody(),l=null,u=()=>{if(l!==null)return l;let E=o.statusText||"OK",T=new Lo(o.getAllResponseHeaders()),C=oz(o)||t.url;return l=new D0({headers:T,status:o.status,statusText:E,url:C}),l},d=()=>{let{headers:E,status:T,statusText:C,url:D}=u(),P=null;T!==QG&&(P=typeof o.response>"u"?o.responseText:o.response),T===0&&(T=P?aL:0);let V=T>=200&&T<300;if(t.responseType==="json"&&typeof P=="string"){let G=P;P=P.replace(sz,"");try{P=P!==""?JSON.parse(P):null}catch(H){P=G,V&&(V=!1,P={error:H,text:P})}}V?(s.next(new af({body:P,headers:E,status:T,statusText:C,url:D||void 0})),s.complete()):s.error(new Va({error:P,headers:E,status:T,statusText:C,url:D||void 0}))},f=E=>{let{url:T}=u(),C=new Va({error:E,status:o.status||0,statusText:o.statusText||"Unknown Error",url:T||void 0});s.error(C)},m=!1,y=E=>{m||(s.next(u()),m=!0);let T={type:Ua.DownloadProgress,loaded:E.loaded};E.lengthComputable&&(T.total=E.total),t.responseType==="text"&&o.responseText&&(T.partialText=o.responseText),s.next(T)},v=E=>{let T={type:Ua.UploadProgress,loaded:E.loaded};E.lengthComputable&&(T.total=E.total),s.next(T)};return o.addEventListener("load",d),o.addEventListener("error",f),o.addEventListener("timeout",f),o.addEventListener("abort",f),t.reportProgress&&(o.addEventListener("progress",y),a!==null&&o.upload&&o.upload.addEventListener("progress",v)),o.send(a),s.next({type:Ua.Sent}),()=>{o.removeEventListener("error",f),o.removeEventListener("abort",f),o.removeEventListener("load",d),o.removeEventListener("timeout",f),t.reportProgress&&(o.removeEventListener("progress",y),a!==null&&o.upload&&o.upload.removeEventListener("progress",v)),o.readyState!==o.DONE&&o.abort()}})))}static{this.\u0275fac=function(i){return new(i||n)(Me(qu))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),cL=new Pe(""),az="XSRF-TOKEN",lz=new Pe("",{providedIn:"root",factory:()=>az}),cz="X-XSRF-TOKEN",uz=new Pe("",{providedIn:"root",factory:()=>cz}),P0=class{},dz=(()=>{class n{constructor(t,i,r){this.doc=t,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=S0(t,this.cookieName),this.lastCookieString=t),this.lastToken}static{this.\u0275fac=function(i){return new(i||n)(Me(yn),Me(Bi),Me(lz))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})();function hz(n,e){let t=n.url.toLowerCase();if(!ue(cL)||n.method==="GET"||n.method==="HEAD"||t.startsWith("http://")||t.startsWith("https://"))return e(n);let i=ue(P0).getToken(),r=ue(uz);return i!=null&&!n.headers.has(r)&&(n=n.clone({headers:n.headers.set(r,i)})),e(n)}function uL(...n){let e=[sb,oL,sL,{provide:sf,useExisting:sL},{provide:A0,useFactory:()=>ue(JG,{optional:!0})??ue(oL)},{provide:lL,useValue:hz,multi:!0},{provide:cL,useValue:!0},{provide:P0,useClass:dz}];for(let t of n)e.push(...t.\u0275providers);return Qr(e)}var lb=class extends w0{constructor(){super(...arguments),this.supportsDOMEvents=!0}},cb=class n extends lb{static makeCurrent(){jk(new n)}onAndCancel(e,t,i){return e.addEventListener(t,i),()=>{e.removeEventListener(t,i)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.remove()}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=pz();return t==null?null:mz(t)}resetBaseElement(){lf=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return S0(document.cookie,e)}},lf=null;function pz(){return lf=lf||document.querySelector("base"),lf?lf.getAttribute("href"):null}function mz(n){return new URL(n,document.baseURI).pathname}var gz=(()=>{class n{build(){return new XMLHttpRequest}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),ub=new Pe(""),fL=(()=>{class n{constructor(t,i){this._zone=i,this._eventNameToPlugin=new Map,t.forEach(r=>{r.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,i,r){return this._findPluginFor(i).addEventListener(t,i,r)}getZone(){return this._zone}_findPluginFor(t){let i=this._eventNameToPlugin.get(t);if(i)return i;if(i=this._plugins.find(s=>s.supports(t)),!i)throw new ye(5101,!1);return this._eventNameToPlugin.set(t,i),i}static{this.\u0275fac=function(i){return new(i||n)(Me(ub),Me(Dt))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),R0=class{constructor(e){this._doc=e}},ob="ng-app-id",pL=(()=>{class n{constructor(t,i,r,s={}){this.doc=t,this.appId=i,this.nonce=r,this.platformId=s,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=C0(s),this.resetHostNodes()}addStyles(t){for(let i of t)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(t){for(let i of t)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let t=this.styleNodesInDOM;t&&(t.forEach(i=>i.remove()),t.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(let i of this.getAllStyles())this.addStyleToHost(t,i)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(let i of this.hostNodes)this.addStyleToHost(i,t)}onStyleRemoved(t){let i=this.styleRef;i.get(t)?.elements?.forEach(r=>r.remove()),i.delete(t)}collectServerRenderedStyles(){let t=this.doc.head?.querySelectorAll(`style[${ob}="${this.appId}"]`);if(t?.length){let i=new Map;return t.forEach(r=>{r.textContent!=null&&i.set(r.textContent,r)}),i}return null}changeUsageCount(t,i){let r=this.styleRef;if(r.has(t)){let s=r.get(t);return s.usage+=i,s.usage}return r.set(t,{usage:i,elements:[]}),i}getStyleElement(t,i){let r=this.styleNodesInDOM,s=r?.get(i);if(s?.parentNode===t)return r.delete(i),s.removeAttribute(ob),s;{let o=this.doc.createElement("style");return this.nonce&&o.setAttribute("nonce",this.nonce),o.textContent=i,this.platformIsServer&&o.setAttribute(ob,this.appId),t.appendChild(o),o}}addStyleToHost(t,i){let r=this.getStyleElement(t,i),s=this.styleRef,o=s.get(i)?.elements;o?o.push(r):s.set(i,{elements:[r],usage:1})}resetHostNodes(){let t=this.hostNodes;t.clear(),t.add(this.doc.head)}static{this.\u0275fac=function(i){return new(i||n)(Me(yn),Me(Ew),Me(bw,8),Me(Bi))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),ab={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},hb=/%COMP%/g,mL="%COMP%",yz=`_nghost-${mL}`,vz=`_ngcontent-${mL}`,_z=!0,Ez=new Pe("",{providedIn:"root",factory:()=>_z});function Tz(n){return vz.replace(hb,n)}function wz(n){return yz.replace(hb,n)}function gL(n,e){return e.map(t=>t.replace(hb,n))}var M0=(()=>{class n{constructor(t,i,r,s,o,a,l,u=null){this.eventManager=t,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=s,this.doc=o,this.platformId=a,this.ngZone=l,this.nonce=u,this.rendererByCompId=new Map,this.platformIsServer=C0(a),this.defaultRenderer=new cf(t,o,l,this.platformIsServer)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===Ss.ShadowDom&&(i=qe(de({},i),{encapsulation:Ss.Emulated}));let r=this.getOrCreateRenderer(t,i);return r instanceof k0?r.applyToHost(t):r instanceof uf&&r.applyStyles(),r}getOrCreateRenderer(t,i){let r=this.rendererByCompId,s=r.get(i.id);if(!s){let o=this.doc,a=this.ngZone,l=this.eventManager,u=this.sharedStylesHost,d=this.removeStylesOnCompDestroy,f=this.platformIsServer;switch(i.encapsulation){case Ss.Emulated:s=new k0(l,u,i,this.appId,d,o,a,f);break;case Ss.ShadowDom:return new db(l,u,t,i,o,a,this.nonce,f);default:s=new uf(l,u,i,d,o,a,f);break}r.set(i.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(i){return new(i||n)(Me(fL),Me(pL),Me(Ew),Me(Ez),Me(yn),Me(Bi),Me(Dt),Me(bw))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),cf=class{constructor(e,t,i,r){this.eventManager=e,this.doc=t,this.ngZone=i,this.platformIsServer=r,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(ab[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(dL(e)?e.content:e).appendChild(t)}insertBefore(e,t,i){e&&(dL(e)?e.content:e).insertBefore(t,i)}removeChild(e,t){t.remove()}selectRootElement(e,t){let i=typeof e=="string"?this.doc.querySelector(e):e;if(!i)throw new ye(-5104,!1);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,r){if(r){t=r+":"+t;let s=ab[r];s?e.setAttributeNS(s,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){let r=ab[i];r?e.removeAttributeNS(r,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,r){r&(wo.DashCase|wo.Important)?e.style.setProperty(t,i,r&wo.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&wo.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){e!=null&&(e[t]=i)}setValue(e,t){e.nodeValue=t}listen(e,t,i){if(typeof e=="string"&&(e=Mo().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(i))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function dL(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var db=class extends cf{constructor(e,t,i,r,s,o,a,l){super(e,s,o,l),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=gL(r.id,r.styles);for(let d of u){let f=document.createElement("style");a&&f.setAttribute("nonce",a),f.textContent=d,this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(null,t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},uf=class extends cf{constructor(e,t,i,r,s,o,a,l){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=r,this.styles=l?gL(l,i.styles):i.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},k0=class extends uf{constructor(e,t,i,r,s,o,a,l){let u=r+"-"+i.id;super(e,t,i,s,o,a,l,u),this.contentAttr=Tz(u),this.hostAttr=wz(u)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}},bz=(()=>{class n extends R0{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,r){return t.addEventListener(i,r,!1),()=>this.removeEventListener(t,i,r)}removeEventListener(t,i,r){return t.removeEventListener(i,r)}static{this.\u0275fac=function(i){return new(i||n)(Me(yn))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),hL=["alt","control","meta","shift"],Iz={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Sz={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},Cz=(()=>{class n extends R0{constructor(t){super(t)}supports(t){return n.parseEventName(t)!=null}addEventListener(t,i,r){let s=n.parseEventName(i),o=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Mo().onAndCancel(t,s.domEventName,o))}static parseEventName(t){let i=t.toLowerCase().split("."),r=i.shift();if(i.length===0||!(r==="keydown"||r==="keyup"))return null;let s=n._normalizeKey(i.pop()),o="",a=i.indexOf("code");if(a>-1&&(i.splice(a,1),o="code."),hL.forEach(u=>{let d=i.indexOf(u);d>-1&&(i.splice(d,1),o+=u+".")}),o+=s,i.length!=0||s.length===0)return null;let l={};return l.domEventName=r,l.fullKey=o,l}static matchEventFullKeyCode(t,i){let r=Iz[t.key]||t.key,s="";return i.indexOf("code.")>-1&&(r=t.code,s="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),hL.forEach(o=>{if(o!==r){let a=Sz[o];a(t)&&(s+=o+".")}}),s+=r,s===i)}static eventCallback(t,i,r){return s=>{n.matchEventFullKeyCode(s,t)&&r.runGuarded(()=>i(s))}}static _normalizeKey(t){return t==="esc"?"escape":t}static{this.\u0275fac=function(i){return new(i||n)(Me(yn))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})();function yL(n,e,t){return kk(de({rootComponent:n,platformRef:t?.platformRef},xz(e)))}function xz(n){return{appProviders:[...Mz,...n?.providers??[]],platformProviders:Rz}}function Az(){cb.makeCurrent()}function Dz(){return new To}function Pz(){return AM(document),document}var Rz=[{provide:Bi,useValue:Xw},{provide:Tw,useValue:Az,multi:!0},{provide:yn,useFactory:Pz,deps:[]}];var Mz=[{provide:Yg,useValue:"root"},{provide:To,useFactory:Dz,deps:[]},{provide:ub,useClass:bz,multi:!0,deps:[yn,Dt,Bi]},{provide:ub,useClass:Cz,multi:!0,deps:[yn]},M0,pL,fL,{provide:xa,useExisting:M0},{provide:qu,useClass:gz,deps:[]},[]];var vL=(()=>{class n{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static{this.\u0275fac=function(i){return new(i||n)(Me(yn))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var ot="primary",Sf=Symbol("RouteTitle"),yb=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function Xu(n){return new yb(n)}function Lz(n,e,t){let i=t.path.split("/");if(i.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||i.length<n.length))return null;let r={};for(let s=0;s<i.length;s++){let o=i[s],a=n[s];if(o[0]===":")r[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function Oz(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!Ms(n[t],e[t]))return!1;return!0}function Ms(n,e){let t=n?vb(n):void 0,i=e?vb(e):void 0;if(!t||!i||t.length!=i.length)return!1;let r;for(let s=0;s<t.length;s++)if(r=t[s],!DL(n[r],e[r]))return!1;return!0}function vb(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function DL(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),i=[...e].sort();return t.every((r,s)=>i[s]===r)}else return n===e}function PL(n){return n.length>0?n[n.length-1]:null}function Ga(n){return OE(n)?n:ic(n)?tn(Promise.resolve(n)):$e(n)}var Nz={exact:ML,subset:kL},RL={exact:Fz,subset:Vz,ignored:()=>!0};function _L(n,e,t){return Nz[t.paths](n.root,e.root,t.matrixParams)&&RL[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function Fz(n,e){return Ms(n,e)}function ML(n,e,t){if(!oc(n.segments,e.segments)||!N0(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let i in e.children)if(!n.children[i]||!ML(n.children[i],e.children[i],t))return!1;return!0}function Vz(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>DL(n[t],e[t]))}function kL(n,e,t){return LL(n,e,e.segments,t)}function LL(n,e,t,i){if(n.segments.length>t.length){let r=n.segments.slice(0,t.length);return!(!oc(r,t)||e.hasChildren()||!N0(r,t,i))}else if(n.segments.length===t.length){if(!oc(n.segments,t)||!N0(n.segments,t,i))return!1;for(let r in e.children)if(!n.children[r]||!kL(n.children[r],e.children[r],i))return!1;return!0}else{let r=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!oc(n.segments,r)||!N0(n.segments,r,i)||!n.children[ot]?!1:LL(n.children[ot],e,s,i)}}function N0(n,e,t){return e.every((i,r)=>RL[t](n[r].parameters,i.parameters))}var No=class{constructor(e=new Ut([],{}),t={},i=null){this.root=e,this.queryParams=t,this.fragment=i}get queryParamMap(){return this._queryParamMap??=Xu(this.queryParams),this._queryParamMap}toString(){return $z.serialize(this)}},Ut=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return F0(this)}},sc=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=Xu(this.parameters),this._parameterMap}toString(){return NL(this)}};function Bz(n,e){return oc(n,e)&&n.every((t,i)=>Ms(t.parameters,e[i].parameters))}function oc(n,e){return n.length!==e.length?!1:n.every((t,i)=>t.path===e[i].path)}function Uz(n,e){let t=[];return Object.entries(n.children).forEach(([i,r])=>{i===ot&&(t=t.concat(e(r,i)))}),Object.entries(n.children).forEach(([i,r])=>{i!==ot&&(t=t.concat(e(r,i)))}),t}var Cf=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>new Ju,providedIn:"root"})}}return n})(),Ju=class{parse(e){let t=new Eb(e);return new No(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${df(e.root,!0)}`,i=zz(e.queryParams),r=typeof e.fragment=="string"?`#${jz(e.fragment)}`:"";return`${t}${i}${r}`}},$z=new Ju;function F0(n){return n.segments.map(e=>NL(e)).join("/")}function df(n,e){if(!n.hasChildren())return F0(n);if(e){let t=n.children[ot]?df(n.children[ot],!1):"",i=[];return Object.entries(n.children).forEach(([r,s])=>{r!==ot&&i.push(`${r}:${df(s,!1)}`)}),i.length>0?`${t}(${i.join("//")})`:t}else{let t=Uz(n,(i,r)=>r===ot?[df(n.children[ot],!1)]:[`${r}:${df(i,!1)}`]);return Object.keys(n.children).length===1&&n.children[ot]!=null?`${F0(n)}/${t[0]}`:`${F0(n)}/(${t.join("//")})`}}function OL(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function L0(n){return OL(n).replace(/%3B/gi,";")}function jz(n){return encodeURI(n)}function _b(n){return OL(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function V0(n){return decodeURIComponent(n)}function EL(n){return V0(n.replace(/\+/g,"%20"))}function NL(n){return`${_b(n.path)}${Gz(n.parameters)}`}function Gz(n){return Object.entries(n).map(([e,t])=>`;${_b(e)}=${_b(t)}`).join("")}function zz(n){let e=Object.entries(n).map(([t,i])=>Array.isArray(i)?i.map(r=>`${L0(t)}=${L0(r)}`).join("&"):`${L0(t)}=${L0(i)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var Hz=/^[^\/()?;#]+/;function fb(n){let e=n.match(Hz);return e?e[0]:""}var qz=/^[^\/()?;=#]+/;function Wz(n){let e=n.match(qz);return e?e[0]:""}var Kz=/^[^=?&#]+/;function Yz(n){let e=n.match(Kz);return e?e[0]:""}var Qz=/^[^&#]+/;function Zz(n){let e=n.match(Qz);return e?e[0]:""}var Eb=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Ut([],{}):new Ut([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(i[ot]=new Ut(e,t)),i}parseSegment(){let e=fb(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new ye(4009,!1);return this.capture(e),new sc(V0(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=Wz(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){let r=fb(this.remaining);r&&(i=r,this.capture(i))}e[V0(t)]=V0(i)}parseQueryParam(e){let t=Yz(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){let o=Zz(this.remaining);o&&(i=o,this.capture(i))}let r=EL(t),s=EL(i);if(e.hasOwnProperty(r)){let o=e[r];Array.isArray(o)||(o=[o],e[r]=o),o.push(s)}else e[r]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let i=fb(this.remaining),r=this.remaining[i.length];if(r!=="/"&&r!==")"&&r!==";")throw new ye(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=ot);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[ot]:new Ut([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new ye(4011,!1)}};function FL(n){return n.segments.length>0?new Ut([],{[ot]:n}):n}function VL(n){let e={};for(let[i,r]of Object.entries(n.children)){let s=VL(r);if(i===ot&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[i]=s)}let t=new Ut(n.segments,e);return Xz(t)}function Xz(n){if(n.numberOfChildren===1&&n.children[ot]){let e=n.children[ot];return new Ut(n.segments.concat(e.segments),e.children)}return n}function ac(n){return n instanceof No}function Jz(n,e,t=null,i=null){let r=BL(n);return UL(r,e,t,i)}function BL(n){let e;function t(s){let o={};for(let l of s.children){let u=t(l);o[l.outlet]=u}let a=new Ut(s.url,o);return s===n&&(e=a),a}let i=t(n.root),r=FL(i);return e??r}function UL(n,e,t,i){let r=n;for(;r.parent;)r=r.parent;if(e.length===0)return pb(r,r,r,t,i);let s=eH(e);if(s.toRoot())return pb(r,r,new Ut([],{}),t,i);let o=tH(s,r,n),a=o.processChildren?pf(o.segmentGroup,o.index,s.commands):jL(o.segmentGroup,o.index,s.commands);return pb(r,o.segmentGroup,a,t,i)}function B0(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function yf(n){return typeof n=="object"&&n!=null&&n.outlets}function pb(n,e,t,i,r){let s={};i&&Object.entries(i).forEach(([l,u])=>{s[l]=Array.isArray(u)?u.map(d=>`${d}`):`${u}`});let o;n===e?o=t:o=$L(n,e,t);let a=FL(VL(o));return new No(a,s,r)}function $L(n,e,t){let i={};return Object.entries(n.children).forEach(([r,s])=>{s===e?i[r]=t:i[r]=$L(s,e,t)}),new Ut(n.segments,i)}var U0=class{constructor(e,t,i){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=i,e&&i.length>0&&B0(i[0]))throw new ye(4003,!1);let r=i.find(yf);if(r&&r!==PL(i))throw new ye(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function eH(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new U0(!0,0,n);let e=0,t=!1,i=n.reduce((r,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([l,u])=>{a[l]=typeof u=="string"?u.split("/"):u}),[...r,{outlets:a}]}if(s.segmentPath)return[...r,s.segmentPath]}return typeof s!="string"?[...r,s]:o===0?(s.split("/").forEach((a,l)=>{l==0&&a==="."||(l==0&&a===""?t=!0:a===".."?e++:a!=""&&r.push(a))}),r):[...r,s]},[]);return new U0(t,e,i)}var Yu=class{constructor(e,t,i){this.segmentGroup=e,this.processChildren=t,this.index=i}};function tH(n,e,t){if(n.isAbsolute)return new Yu(e,!0,0);if(!t)return new Yu(e,!1,NaN);if(t.parent===null)return new Yu(t,!0,0);let i=B0(n.commands[0])?0:1,r=t.segments.length-1+i;return nH(t,r,n.numberOfDoubleDots)}function nH(n,e,t){let i=n,r=e,s=t;for(;s>r;){if(s-=r,i=i.parent,!i)throw new ye(4005,!1);r=i.segments.length}return new Yu(i,!1,r-s)}function iH(n){return yf(n[0])?n[0].outlets:{[ot]:n}}function jL(n,e,t){if(n??=new Ut([],{}),n.segments.length===0&&n.hasChildren())return pf(n,e,t);let i=rH(n,e,t),r=t.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){let s=new Ut(n.segments.slice(0,i.pathIndex),{});return s.children[ot]=new Ut(n.segments.slice(i.pathIndex),n.children),pf(s,0,r)}else return i.match&&r.length===0?new Ut(n.segments,{}):i.match&&!n.hasChildren()?Tb(n,e,t):i.match?pf(n,0,r):Tb(n,e,t)}function pf(n,e,t){if(t.length===0)return new Ut(n.segments,{});{let i=iH(t),r={};if(Object.keys(i).some(s=>s!==ot)&&n.children[ot]&&n.numberOfChildren===1&&n.children[ot].segments.length===0){let s=pf(n.children[ot],e,t);return new Ut(n.segments,s.children)}return Object.entries(i).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(r[s]=jL(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{i[s]===void 0&&(r[s]=o)}),new Ut(n.segments,r)}}function rH(n,e,t){let i=0,r=e,s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=t.length)return s;let o=n.segments[r],a=t[i];if(yf(a))break;let l=`${a}`,u=i<t.length-1?t[i+1]:null;if(r>0&&l===void 0)break;if(l&&u&&typeof u=="object"&&u.outlets===void 0){if(!wL(l,u,o))return s;i+=2}else{if(!wL(l,{},o))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}function Tb(n,e,t){let i=n.segments.slice(0,e),r=0;for(;r<t.length;){let s=t[r];if(yf(s)){let l=sH(s.outlets);return new Ut(i,l)}if(r===0&&B0(t[0])){let l=n.segments[e];i.push(new sc(l.path,TL(t[0]))),r++;continue}let o=yf(s)?s.outlets[ot]:`${s}`,a=r<t.length-1?t[r+1]:null;o&&a&&B0(a)?(i.push(new sc(o,TL(a))),r+=2):(i.push(new sc(o,{})),r++)}return new Ut(i,{})}function sH(n){let e={};return Object.entries(n).forEach(([t,i])=>{typeof i=="string"&&(i=[i]),i!==null&&(e[t]=Tb(new Ut([],{}),0,i))}),e}function TL(n){let e={};return Object.entries(n).forEach(([t,i])=>e[t]=`${i}`),e}function wL(n,e,t){return n==t.path&&Ms(e,t.parameters)}var mf="imperative",qn=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(qn||{}),Mr=class{constructor(e,t){this.id=e,this.url=t}},ed=class extends Mr{constructor(e,t,i="imperative",r=null){super(e,t),this.type=qn.NavigationStart,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},ks=class extends Mr{constructor(e,t,i){super(e,t),this.urlAfterRedirects=i,this.type=qn.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},lr=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(lr||{}),$0=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}($0||{}),Oo=class extends Mr{constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r,this.type=qn.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},$a=class extends Mr{constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r,this.type=qn.NavigationSkipped}},vf=class extends Mr{constructor(e,t,i,r){super(e,t),this.error=i,this.target=r,this.type=qn.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},j0=class extends Mr{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=qn.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},wb=class extends Mr{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=qn.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},bb=class extends Mr{constructor(e,t,i,r,s){super(e,t),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=qn.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Ib=class extends Mr{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=qn.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Sb=class extends Mr{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=qn.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Cb=class{constructor(e){this.route=e,this.type=qn.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},xb=class{constructor(e){this.route=e,this.type=qn.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Ab=class{constructor(e){this.snapshot=e,this.type=qn.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Db=class{constructor(e){this.snapshot=e,this.type=qn.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Pb=class{constructor(e){this.snapshot=e,this.type=qn.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Rb=class{constructor(e){this.snapshot=e,this.type=qn.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},G0=class{constructor(e,t,i){this.routerEvent=e,this.position=t,this.anchor=i,this.type=qn.Scroll}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},_f=class{},td=class{constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}};function oH(n,e){return n.providers&&!n._injector&&(n._injector=l0(n.providers,e,`Route: ${n.path}`)),n._injector??e}function ts(n){return n.outlet||ot}function aH(n,e){let t=n.filter(i=>ts(i)===e);return t.push(...n.filter(i=>ts(i)!==e)),t}function xf(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var Mb=class{get injector(){return xf(this.route?.snapshot)??this.rootInjector}set injector(e){}constructor(e){this.rootInjector=e,this.outlet=null,this.route=null,this.children=new Af(this.rootInjector),this.attachRef=null}},Af=(()=>{class n{constructor(t){this.rootInjector=t,this.contexts=new Map}onChildOutletCreated(t,i){let r=this.getOrCreateContext(t);r.outlet=i,this.contexts.set(t,r)}onChildOutletDestroyed(t){let i=this.getContext(t);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let i=this.getContext(t);return i||(i=new Mb(this.rootInjector),this.contexts.set(t,i)),i}getContext(t){return this.contexts.get(t)||null}static{this.\u0275fac=function(i){return new(i||n)(Me(wi))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),z0=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=kb(e,this._root);return t?t.children.map(i=>i.value):[]}firstChild(e){let t=kb(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=Lb(e,this._root);return t.length<2?[]:t[t.length-2].children.map(r=>r.value).filter(r=>r!==e)}pathFromRoot(e){return Lb(e,this._root).map(t=>t.value)}};function kb(n,e){if(n===e.value)return e;for(let t of e.children){let i=kb(n,t);if(i)return i}return null}function Lb(n,e){if(n===e.value)return[e];for(let t of e.children){let i=Lb(n,t);if(i.length)return i.unshift(e),i}return[]}var ar=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function Ku(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var H0=class extends z0{constructor(e,t){super(e),this.snapshot=t,Gb(this,e)}toString(){return this.snapshot.toString()}};function GL(n){let e=lH(n),t=new mn([new sc("",{})]),i=new mn({}),r=new mn({}),s=new mn({}),o=new mn(""),a=new ja(t,i,s,o,r,ot,n,e.root);return a.snapshot=e.root,new H0(new ar(a,[]),e)}function lH(n){let e={},t={},i={},r="",s=new Qu([],e,i,r,t,ot,n,null,{});return new W0("",new ar(s,[]))}var ja=class{constructor(e,t,i,r,s,o,a,l){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(We(u=>u[Sf]))??$e(void 0),this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(We(e=>Xu(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(We(e=>Xu(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function q0(n,e,t="emptyOnly"){let i,{routeConfig:r}=n;return e!==null&&(t==="always"||r?.path===""||!e.component&&!e.routeConfig?.loadComponent)?i={params:de(de({},e.params),n.params),data:de(de({},e.data),n.data),resolve:de(de(de(de({},n.data),e.data),r?.data),n._resolvedData)}:i={params:de({},n.params),data:de({},n.data),resolve:de(de({},n.data),n._resolvedData??{})},r&&HL(r)&&(i.resolve[Sf]=r.title),i}var Qu=class{get title(){return this.data?.[Sf]}constructor(e,t,i,r,s,o,a,l,u){this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=o,this.component=a,this.routeConfig=l,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Xu(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Xu(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(i=>i.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},W0=class extends z0{constructor(e,t){super(t),this.url=e,Gb(this,t)}toString(){return zL(this._root)}};function Gb(n,e){e.value._routerState=n,e.children.forEach(t=>Gb(n,t))}function zL(n){let e=n.children.length>0?` { ${n.children.map(zL).join(", ")} } `:"";return`${n.value}${e}`}function mb(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,Ms(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),Ms(e.params,t.params)||n.paramsSubject.next(t.params),Oz(e.url,t.url)||n.urlSubject.next(t.url),Ms(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function Ob(n,e){let t=Ms(n.params,e.params)&&Bz(n.url,e.url),i=!n.parent!=!e.parent;return t&&!i&&(!n.parent||Ob(n.parent,e.parent))}function HL(n){return typeof n.title=="string"||n.title===null}var zb=(()=>{class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=ot,this.activateEvents=new tt,this.deactivateEvents=new tt,this.attachEvents=new tt,this.detachEvents=new tt,this.parentContexts=ue(Af),this.location=ue(ka),this.changeDetector=ue(xi),this.inputBinder=ue(Z0,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){let{firstChange:i,previousValue:r}=t.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ye(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ye(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ye(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,i){this.activated=t,this._activatedRoute=i,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,i){if(this.isActivated)throw new ye(4013,!1);this._activatedRoute=t;let r=this.location,o=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new Nb(t,a,r.injector);this.activated=r.createComponent(o,{index:r.length,injector:l,environmentInjector:i}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275dir=ci({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Dr]})}}return n})(),Nb=class n{__ngOutletInjector(e){return new n(this.route,this.childContexts,e)}constructor(e,t,i){this.route=e,this.childContexts=t,this.parent=i}get(e,t){return e===ja?this.route:e===Af?this.childContexts:this.parent.get(e,t)}},Z0=new Pe(""),bL=(()=>{class n{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){let{activatedRoute:i}=t,r=Bh([i.queryParams,i.params,i.data]).pipe(Fi(([s,o,a],l)=>(a=de(de(de({},s),o),a),l===0?$e(a):Promise.resolve(a)))).subscribe(s=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(t);return}let o=Lk(i.component);if(!o){this.unsubscribeFromRouteData(t);return}for(let{templateName:a}of o.inputs)t.activatedComponentRef.setInput(a,s[a])});this.outletDataSubscriptions.set(t,r)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})();function cH(n,e,t){let i=Ef(n,e._root,t?t._root:void 0);return new H0(i,e)}function Ef(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let i=t.value;i._futureSnapshot=e.value;let r=uH(n,e,t);return new ar(i,r)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>Ef(n,a)),o}}let i=dH(e.value),r=e.children.map(s=>Ef(n,s));return new ar(i,r)}}function uH(n,e,t){return e.children.map(i=>{for(let r of t.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return Ef(n,i,r);return Ef(n,i)})}function dH(n){return new ja(new mn(n.url),new mn(n.params),new mn(n.queryParams),new mn(n.fragment),new mn(n.data),n.outlet,n.component,n)}var Tf=class{constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}},qL="ngNavigationCancelingError";function K0(n,e){let{redirectTo:t,navigationBehaviorOptions:i}=ac(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,r=WL(!1,lr.Redirect);return r.url=t,r.navigationBehaviorOptions=i,r}function WL(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[qL]=!0,t.cancellationCode=e,t}function hH(n){return KL(n)&&ac(n.url)}function KL(n){return!!n&&n[qL]}var fH=(n,e,t,i)=>We(r=>(new Fb(e,r.targetRouterState,r.currentRouterState,t,i).activate(n),r)),Fb=class{constructor(e,t,i,r,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,i,e),mb(this.futureState.root),this.activateChildRoutes(t,i,e)}deactivateChildRoutes(e,t,i){let r=Ku(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,r[o],i),delete r[o]}),Object.values(r).forEach(s=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(e,t,i){let r=e.value,s=t?t.value:null;if(r===s)if(r.component){let o=i.getContext(r.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,i);else s&&this.deactivateRouteAndItsChildren(t,i)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,s=Ku(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,r);if(i&&i.outlet){let o=i.outlet.detach(),a=i.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,s=Ku(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(e,t,i){let r=Ku(t);e.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new Rb(s.value.snapshot))}),e.children.length&&this.forwardEvent(new Db(e.value.snapshot))}activateRoutes(e,t,i){let r=e.value,s=t?t.value:null;if(mb(r),r===s)if(r.component){let o=i.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,i);else if(r.component){let o=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){let a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),mb(a.route.value),this.activateChildRoutes(e,null,o.children)}else o.attachRef=null,o.route=r,o.outlet&&o.outlet.activateWith(r,o.injector),this.activateChildRoutes(e,null,o.children)}else this.activateChildRoutes(e,null,i)}},Y0=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},Zu=class{constructor(e,t){this.component=e,this.route=t}};function pH(n,e,t){let i=n._root,r=e?e._root:null;return hf(i,r,t,[i.value])}function mH(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function id(n,e){let t=Symbol(),i=e.get(n,t);return i===t?typeof n=="function"&&!dR(n)?n:e.get(n):i}function hf(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let s=Ku(e);return n.children.forEach(o=>{gH(o,s[o.value.outlet],t,i.concat([o.value]),r),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>gf(a,t.getContext(o),r)),r}function gH(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let l=yH(o,s,s.routeConfig.runGuardsAndResolvers);l?r.canActivateChecks.push(new Y0(i)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?hf(n,e,a?a.children:null,i,r):hf(n,e,t,i,r),l&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new Zu(a.outlet.component,o))}else o&&gf(e,a,r),r.canActivateChecks.push(new Y0(i)),s.component?hf(n,null,a?a.children:null,i,r):hf(n,null,t,i,r);return r}function yH(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!oc(n.url,e.url);case"pathParamsOrQueryParamsChange":return!oc(n.url,e.url)||!Ms(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Ob(n,e)||!Ms(n.queryParams,e.queryParams);case"paramsChange":default:return!Ob(n,e)}}function gf(n,e,t){let i=Ku(n),r=n.value;Object.entries(i).forEach(([s,o])=>{r.component?e?gf(o,e.children.getContext(s),t):gf(o,null,t):gf(o,e,t)}),r.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new Zu(e.outlet.component,r)):t.canDeactivateChecks.push(new Zu(null,r)):t.canDeactivateChecks.push(new Zu(null,r))}function Df(n){return typeof n=="function"}function vH(n){return typeof n=="boolean"}function _H(n){return n&&Df(n.canLoad)}function EH(n){return n&&Df(n.canActivate)}function TH(n){return n&&Df(n.canActivateChild)}function wH(n){return n&&Df(n.canDeactivate)}function bH(n){return n&&Df(n.canMatch)}function YL(n){return n instanceof Hr||n?.name==="EmptyError"}var O0=Symbol("INITIAL_VALUE");function nd(){return Fi(n=>Bh(n.map(e=>e.pipe(_o(1),UE(O0)))).pipe(We(e=>{for(let t of e)if(t!==!0){if(t===O0)return O0;if(t===!1||IH(t))return t}return!0}),Ni(e=>e!==O0),_o(1)))}function IH(n){return ac(n)||n instanceof Tf}function SH(n,e){return Dn(t=>{let{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?$e(qe(de({},t),{guardsResult:!0})):CH(o,i,r,n).pipe(Dn(a=>a&&vH(a)?xH(i,s,n,e):$e(a)),We(a=>qe(de({},t),{guardsResult:a})))})}function CH(n,e,t,i){return tn(n).pipe(Dn(r=>MH(r.component,r.route,t,e,i)),ws(r=>r!==!0,!0))}function xH(n,e,t,i){return tn(e).pipe(vo(r=>Su(DH(r.route.parent,i),AH(r.route,i),RH(n,r.path,t),PH(n,r.route,t))),ws(r=>r!==!0,!0))}function AH(n,e){return n!==null&&e&&e(new Pb(n)),$e(!0)}function DH(n,e){return n!==null&&e&&e(new Ab(n)),$e(!0)}function PH(n,e,t){let i=e.routeConfig?e.routeConfig.canActivate:null;if(!i||i.length===0)return $e(!0);let r=i.map(s=>cg(()=>{let o=xf(e)??t,a=id(s,o),l=EH(a)?a.canActivate(e,n):Ar(o,()=>a(e,n));return Ga(l).pipe(ws())}));return $e(r).pipe(nd())}function RH(n,e,t){let i=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>mH(o)).filter(o=>o!==null).map(o=>cg(()=>{let a=o.guards.map(l=>{let u=xf(o.node)??t,d=id(l,u),f=TH(d)?d.canActivateChild(i,n):Ar(u,()=>d(i,n));return Ga(f).pipe(ws())});return $e(a).pipe(nd())}));return $e(s).pipe(nd())}function MH(n,e,t,i,r){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return $e(!0);let o=s.map(a=>{let l=xf(e)??r,u=id(a,l),d=wH(u)?u.canDeactivate(n,e,t,i):Ar(l,()=>u(n,e,t,i));return Ga(d).pipe(ws())});return $e(o).pipe(nd())}function kH(n,e,t,i){let r=e.canLoad;if(r===void 0||r.length===0)return $e(!0);let s=r.map(o=>{let a=id(o,n),l=_H(a)?a.canLoad(e,t):Ar(n,()=>a(e,t));return Ga(l)});return $e(s).pipe(nd(),QL(i))}function QL(n){return xE(Pn(e=>{if(typeof e!="boolean")throw K0(n,e)}),We(e=>e===!0))}function LH(n,e,t,i){let r=e.canMatch;if(!r||r.length===0)return $e(!0);let s=r.map(o=>{let a=id(o,n),l=bH(a)?a.canMatch(e,t):Ar(n,()=>a(e,t));return Ga(l)});return $e(s).pipe(nd(),QL(i))}var wf=class{constructor(e){this.segmentGroup=e||null}},bf=class extends Error{constructor(e){super(),this.urlTree=e}};function Wu(n){return bu(new wf(n))}function OH(n){return bu(new ye(4e3,!1))}function NH(n){return bu(WL(!1,lr.GuardRejected))}var Vb=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let i=[],r=t.root;for(;;){if(i=i.concat(r.segments),r.numberOfChildren===0)return $e(i);if(r.numberOfChildren>1||!r.children[ot])return OH(`${e.redirectTo}`);r=r.children[ot]}}applyRedirectCommands(e,t,i,r,s){if(typeof t!="string"){let a=t,{queryParams:l,fragment:u,routeConfig:d,url:f,outlet:m,params:y,data:v,title:E}=r,T=Ar(s,()=>a({params:y,data:v,queryParams:l,fragment:u,routeConfig:d,url:f,outlet:m,title:E}));if(T instanceof No)throw new bf(T);t=T}let o=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,i);if(t[0]==="/")throw new bf(o);return o}applyRedirectCreateUrlTree(e,t,i,r){let s=this.createSegmentGroup(e,t.root,i,r);return new No(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let i={};return Object.entries(e).forEach(([r,s])=>{if(typeof s=="string"&&s[0]===":"){let a=s.substring(1);i[r]=t[a]}else i[r]=s}),i}createSegmentGroup(e,t,i,r){let s=this.createSegments(e,t.segments,i,r),o={};return Object.entries(t.children).forEach(([a,l])=>{o[a]=this.createSegmentGroup(e,l,i,r)}),new Ut(s,o)}createSegments(e,t,i,r){return t.map(s=>s.path[0]===":"?this.findPosParam(e,s,r):this.findOrReturn(s,i))}findPosParam(e,t,i){let r=i[t.path.substring(1)];if(!r)throw new ye(4001,!1);return r}findOrReturn(e,t){let i=0;for(let r of t){if(r.path===e.path)return t.splice(i),r;i++}return e}},Bb={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function FH(n,e,t,i,r){let s=ZL(n,e,t);return s.matched?(i=oH(e,i),LH(i,e,t,r).pipe(We(o=>o===!0?s:de({},Bb)))):$e(s)}function ZL(n,e,t){if(e.path==="**")return VH(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?de({},Bb):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let r=(e.matcher||Lz)(t,n,e);if(!r)return de({},Bb);let s={};Object.entries(r.posParams??{}).forEach(([a,l])=>{s[a]=l.path});let o=r.consumed.length>0?de(de({},s),r.consumed[r.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:r.consumed,remainingSegments:t.slice(r.consumed.length),parameters:o,positionalParamSegments:r.posParams??{}}}function VH(n){return{matched:!0,parameters:n.length>0?PL(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function IL(n,e,t,i){return t.length>0&&$H(n,t,i)?{segmentGroup:new Ut(e,UH(i,new Ut(t,n.children))),slicedSegments:[]}:t.length===0&&jH(n,t,i)?{segmentGroup:new Ut(n.segments,BH(n,t,i,n.children)),slicedSegments:t}:{segmentGroup:new Ut(n.segments,n.children),slicedSegments:t}}function BH(n,e,t,i){let r={};for(let s of t)if(X0(n,e,s)&&!i[ts(s)]){let o=new Ut([],{});r[ts(s)]=o}return de(de({},i),r)}function UH(n,e){let t={};t[ot]=e;for(let i of n)if(i.path===""&&ts(i)!==ot){let r=new Ut([],{});t[ts(i)]=r}return t}function $H(n,e,t){return t.some(i=>X0(n,e,i)&&ts(i)!==ot)}function jH(n,e,t){return t.some(i=>X0(n,e,i))}function X0(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function GH(n,e,t){return e.length===0&&!n.children[t]}var Ub=class{};function zH(n,e,t,i,r,s,o="emptyOnly"){return new $b(n,e,t,i,r,o,s).recognize()}var HH=31,$b=class{constructor(e,t,i,r,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=i,this.config=r,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new Vb(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new ye(4002,`'${e.segmentGroup}'`)}recognize(){let e=IL(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(We(({children:t,rootSnapshot:i})=>{let r=new ar(i,t),s=new W0("",r),o=Jz(i,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),{state:s,tree:o}}))}match(e){let t=new Qu([],Object.freeze({}),Object.freeze(de({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),ot,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,ot,t).pipe(We(i=>({children:i,rootSnapshot:t})),_a(i=>{if(i instanceof bf)return this.urlTree=i.urlTree,this.match(i.urlTree.root);throw i instanceof wf?this.noMatchError(i):i}))}processSegmentGroup(e,t,i,r,s){return i.segments.length===0&&i.hasChildren()?this.processChildren(e,t,i,s):this.processSegment(e,t,i,i.segments,r,!0,s).pipe(We(o=>o instanceof ar?[o]:[]))}processChildren(e,t,i,r){let s=[];for(let o of Object.keys(i.children))o==="primary"?s.unshift(o):s.push(o);return tn(s).pipe(vo(o=>{let a=i.children[o],l=aH(t,o);return this.processSegmentGroup(e,l,a,o,r)}),BE((o,a)=>(o.push(...a),o)),Ea(null),VE(),Dn(o=>{if(o===null)return Wu(i);let a=XL(o);return qH(a),$e(a)}))}processSegment(e,t,i,r,s,o,a){return tn(t).pipe(vo(l=>this.processSegmentAgainstRoute(l._injector??e,t,l,i,r,s,o,a).pipe(_a(u=>{if(u instanceof wf)return $e(null);throw u}))),ws(l=>!!l),_a(l=>{if(YL(l))return GH(i,r,s)?$e(new Ub):Wu(i);throw l}))}processSegmentAgainstRoute(e,t,i,r,s,o,a,l){return ts(i)!==o&&(o===ot||!X0(r,s,i))?Wu(r):i.redirectTo===void 0?this.matchSegmentAgainstRoute(e,r,i,s,o,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,r,t,i,s,o,l):Wu(r)}expandSegmentAgainstRouteUsingRedirect(e,t,i,r,s,o,a){let{matched:l,parameters:u,consumedSegments:d,positionalParamSegments:f,remainingSegments:m}=ZL(t,r,s);if(!l)return Wu(t);typeof r.redirectTo=="string"&&r.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>HH&&(this.allowRedirects=!1));let y=new Qu(s,u,Object.freeze(de({},this.urlTree.queryParams)),this.urlTree.fragment,SL(r),ts(r),r.component??r._loadedComponent??null,r,CL(r)),v=q0(y,a,this.paramsInheritanceStrategy);y.params=Object.freeze(v.params),y.data=Object.freeze(v.data);let E=this.applyRedirects.applyRedirectCommands(d,r.redirectTo,f,y,e);return this.applyRedirects.lineralizeSegments(r,E).pipe(Dn(T=>this.processSegment(e,i,t,T.concat(m),o,!1,a)))}matchSegmentAgainstRoute(e,t,i,r,s,o){let a=FH(t,i,r,e,this.urlSerializer);return i.path==="**"&&(t.children={}),a.pipe(Fi(l=>l.matched?(e=i._injector??e,this.getChildConfig(e,i,r).pipe(Fi(({routes:u})=>{let d=i._loadedInjector??e,{parameters:f,consumedSegments:m,remainingSegments:y}=l,v=new Qu(m,f,Object.freeze(de({},this.urlTree.queryParams)),this.urlTree.fragment,SL(i),ts(i),i.component??i._loadedComponent??null,i,CL(i)),E=q0(v,o,this.paramsInheritanceStrategy);v.params=Object.freeze(E.params),v.data=Object.freeze(E.data);let{segmentGroup:T,slicedSegments:C}=IL(t,m,y,u);if(C.length===0&&T.hasChildren())return this.processChildren(d,u,T,v).pipe(We(P=>new ar(v,P)));if(u.length===0&&C.length===0)return $e(new ar(v,[]));let D=ts(i)===s;return this.processSegment(d,u,T,C,D?ot:s,!0,v).pipe(We(P=>new ar(v,P instanceof ar?[P]:[])))}))):Wu(t)))}getChildConfig(e,t,i){return t.children?$e({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?$e({routes:t._loadedRoutes,injector:t._loadedInjector}):kH(e,t,i,this.urlSerializer).pipe(Dn(r=>r?this.configLoader.loadChildren(e,t).pipe(Pn(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):NH(t))):$e({routes:[],injector:e})}};function qH(n){n.sort((e,t)=>e.value.outlet===ot?-1:t.value.outlet===ot?1:e.value.outlet.localeCompare(t.value.outlet))}function WH(n){let e=n.value.routeConfig;return e&&e.path===""}function XL(n){let e=[],t=new Set;for(let i of n){if(!WH(i)){e.push(i);continue}let r=e.find(s=>i.value.routeConfig===s.value.routeConfig);r!==void 0?(r.children.push(...i.children),t.add(r)):e.push(i)}for(let i of t){let r=XL(i.children);e.push(new ar(i.value,r))}return e.filter(i=>!t.has(i))}function SL(n){return n.data||{}}function CL(n){return n.resolve||{}}function KH(n,e,t,i,r,s){return Dn(o=>zH(n,e,t,i,o.extractedUrl,r,s).pipe(We(({state:a,tree:l})=>qe(de({},o),{targetSnapshot:a,urlAfterRedirects:l}))))}function YH(n,e){return Dn(t=>{let{targetSnapshot:i,guards:{canActivateChecks:r}}=t;if(!r.length)return $e(t);let s=new Set(r.map(l=>l.route)),o=new Set;for(let l of s)if(!o.has(l))for(let u of JL(l))o.add(u);let a=0;return tn(o).pipe(vo(l=>s.has(l)?QH(l,i,n,e):(l.data=q0(l,l.parent,n).resolve,$e(void 0))),Pn(()=>a++),Cu(1),Dn(l=>a===o.size?$e(t):nr))})}function JL(n){let e=n.children.map(t=>JL(t)).flat();return[n,...e]}function QH(n,e,t,i){let r=n.routeConfig,s=n._resolve;return r?.title!==void 0&&!HL(r)&&(s[Sf]=r.title),ZH(s,n,e,i).pipe(We(o=>(n._resolvedData=o,n.data=q0(n,n.parent,t).resolve,null)))}function ZH(n,e,t,i){let r=vb(n);if(r.length===0)return $e({});let s={};return tn(r).pipe(Dn(o=>XH(n[o],e,t,i).pipe(ws(),Pn(a=>{if(a instanceof Tf)throw K0(new Ju,a);s[o]=a}))),Cu(1),FE(s),_a(o=>YL(o)?nr:bu(o)))}function XH(n,e,t,i){let r=xf(e)??i,s=id(n,r),o=s.resolve?s.resolve(e,t):Ar(r,()=>s(e,t));return Ga(o)}function gb(n){return Fi(e=>{let t=n(e);return t?tn(t).pipe(We(()=>e)):$e(e)})}var eO=(()=>{class n{buildTitle(t){let i,r=t.root;for(;r!==void 0;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(s=>s.outlet===ot);return i}getResolvedTitleForRoute(t){return t.data[Sf]}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>ue(JH),providedIn:"root"})}}return n})(),JH=(()=>{class n extends eO{constructor(t){super(),this.title=t}updateTitle(t){let i=this.buildTitle(t);i!==void 0&&this.title.setTitle(i)}static{this.\u0275fac=function(i){return new(i||n)(Me(vL))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Pf=new Pe("",{providedIn:"root",factory:()=>({})}),e9=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=_t({type:n,selectors:[["ng-component"]],standalone:!0,features:[Tt],decls:1,vars:0,template:function(i,r){i&1&&ae(0,"router-outlet")},dependencies:[zb],encapsulation:2})}}return n})();function Hb(n){let e=n.children&&n.children.map(Hb),t=e?qe(de({},n),{children:e}):de({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==ot&&(t.component=e9),t}var If=new Pe(""),qb=(()=>{class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=ue(h0)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return $e(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);let i=Ga(t.loadComponent()).pipe(We(tO),Pn(s=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=s}),Vl(()=>{this.componentLoaders.delete(t)})),r=new _u(i,()=>new zn).pipe(vu());return this.componentLoaders.set(t,r),r}loadChildren(t,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return $e({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let s=t9(i,this.compiler,t,this.onLoadEndListener).pipe(Vl(()=>{this.childrenLoaders.delete(i)})),o=new _u(s,()=>new zn).pipe(vu());return this.childrenLoaders.set(i,o),o}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function t9(n,e,t,i){return Ga(n.loadChildren()).pipe(We(tO),Dn(r=>r instanceof qh||Array.isArray(r)?$e(r):tn(e.compileModuleAsync(r))),We(r=>{i&&i(n);let s,o,a=!1;return Array.isArray(r)?(o=r,a=!0):(s=r.create(t).injector,o=s.get(If,[],{optional:!0,self:!0}).flat()),{routes:o.map(Hb),injector:s}}))}function n9(n){return n&&typeof n=="object"&&"default"in n}function tO(n){return n9(n)?n.default:n}var Wb=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>ue(i9),providedIn:"root"})}}return n})(),i9=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,i){return t}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),nO=new Pe(""),iO=new Pe("");function r9(n,e,t){let i=n.get(iO),r=n.get(yn);return n.get(Dt).runOutsideAngular(()=>{if(!r.startViewTransition||i.skipNextTransition)return i.skipNextTransition=!1,new Promise(u=>setTimeout(u));let s,o=new Promise(u=>{s=u}),a=r.startViewTransition(()=>(s(),s9(n))),{onViewTransitionCreated:l}=i;return l&&Ar(n,()=>l({transition:a,from:e,to:t})),o})}function s9(n){return new Promise(e=>{Fw({read:()=>setTimeout(e)},{injector:n})})}var o9=new Pe(""),Kb=(()=>{class n{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new zn,this.transitionAbortSubject=new zn,this.configLoader=ue(qb),this.environmentInjector=ue(wi),this.urlSerializer=ue(Cf),this.rootContexts=ue(Af),this.location=ue(Fa),this.inputBindingEnabled=ue(Z0,{optional:!0})!==null,this.titleStrategy=ue(eO),this.options=ue(Pf,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=ue(Wb),this.createViewTransition=ue(nO,{optional:!0}),this.navigationErrorHandler=ue(o9,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>$e(void 0),this.rootComponentType=null;let t=r=>this.events.next(new Cb(r)),i=r=>this.events.next(new xb(r));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=t}complete(){this.transitions?.complete()}handleNavigationRequest(t){let i=++this.navigationId;this.transitions?.next(qe(de(de({},this.transitions.value),t),{id:i}))}setupNavigations(t,i,r){return this.transitions=new mn({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:mf,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ni(s=>s.id!==0),We(s=>qe(de({},s),{extractedUrl:this.urlHandlingStrategy.extract(s.rawUrl)})),Fi(s=>{let o=!1,a=!1;return $e(s).pipe(Fi(l=>{if(this.navigationId>s.id)return this.cancelNavigationTransition(s,"",lr.SupersededByNewNavigation),nr;this.currentTransition=s,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,targetBrowserUrl:typeof l.extras.browserUrl=="string"?this.urlSerializer.parse(l.extras.browserUrl):l.extras.browserUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?qe(de({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let u=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),d=l.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!u&&d!=="reload"){let f="";return this.events.next(new $a(l.id,this.urlSerializer.serialize(l.rawUrl),f,$0.IgnoredSameUrlNavigation)),l.resolve(!1),nr}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return $e(l).pipe(Fi(f=>{let m=this.transitions?.getValue();return this.events.next(new ed(f.id,this.urlSerializer.serialize(f.extractedUrl),f.source,f.restoredState)),m!==this.transitions?.getValue()?nr:Promise.resolve(f)}),KH(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),Pn(f=>{s.targetSnapshot=f.targetSnapshot,s.urlAfterRedirects=f.urlAfterRedirects,this.currentNavigation=qe(de({},this.currentNavigation),{finalUrl:f.urlAfterRedirects});let m=new j0(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(m)}));if(u&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:f,extractedUrl:m,source:y,restoredState:v,extras:E}=l,T=new ed(f,this.urlSerializer.serialize(m),y,v);this.events.next(T);let C=GL(this.rootComponentType).snapshot;return this.currentTransition=s=qe(de({},l),{targetSnapshot:C,urlAfterRedirects:m,extras:qe(de({},E),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=m,$e(s)}else{let f="";return this.events.next(new $a(l.id,this.urlSerializer.serialize(l.extractedUrl),f,$0.IgnoredByUrlHandlingStrategy)),l.resolve(!1),nr}}),Pn(l=>{let u=new wb(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(u)}),We(l=>(this.currentTransition=s=qe(de({},l),{guards:pH(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),s)),SH(this.environmentInjector,l=>this.events.next(l)),Pn(l=>{if(s.guardsResult=l.guardsResult,l.guardsResult&&typeof l.guardsResult!="boolean")throw K0(this.urlSerializer,l.guardsResult);let u=new bb(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(u)}),Ni(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",lr.GuardRejected),!1)),gb(l=>{if(l.guards.canActivateChecks.length)return $e(l).pipe(Pn(u=>{let d=new Ib(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(d)}),Fi(u=>{let d=!1;return $e(u).pipe(YH(this.paramsInheritanceStrategy,this.environmentInjector),Pn({next:()=>d=!0,complete:()=>{d||this.cancelNavigationTransition(u,"",lr.NoDataFromResolver)}}))}),Pn(u=>{let d=new Sb(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(d)}))}),gb(l=>{let u=d=>{let f=[];d.routeConfig?.loadComponent&&!d.routeConfig._loadedComponent&&f.push(this.configLoader.loadComponent(d.routeConfig).pipe(Pn(m=>{d.component=m}),We(()=>{})));for(let m of d.children)f.push(...u(m));return f};return Bh(u(l.targetSnapshot.root)).pipe(Ea(null),_o(1))}),gb(()=>this.afterPreactivation()),Fi(()=>{let{currentSnapshot:l,targetSnapshot:u}=s,d=this.createViewTransition?.(this.environmentInjector,l.root,u.root);return d?tn(d).pipe(We(()=>s)):$e(s)}),We(l=>{let u=cH(t.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=s=qe(de({},l),{targetRouterState:u}),this.currentNavigation.targetRouterState=u,s}),Pn(()=>{this.events.next(new _f)}),fH(this.rootContexts,t.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),_o(1),Pn({next:l=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new ks(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{o=!0}}),$E(this.transitionAbortSubject.pipe(Pn(l=>{throw l}))),Vl(()=>{!o&&!a&&this.cancelNavigationTransition(s,"",lr.SupersededByNewNavigation),this.currentTransition?.id===s.id&&(this.currentNavigation=null,this.currentTransition=null)}),_a(l=>{if(a=!0,KL(l))this.events.next(new Oo(s.id,this.urlSerializer.serialize(s.extractedUrl),l.message,l.cancellationCode)),hH(l)?this.events.next(new td(l.url,l.navigationBehaviorOptions)):s.resolve(!1);else{let u=new vf(s.id,this.urlSerializer.serialize(s.extractedUrl),l,s.targetSnapshot??void 0);try{let d=Ar(this.environmentInjector,()=>this.navigationErrorHandler?.(u));if(d instanceof Tf){let{message:f,cancellationCode:m}=K0(this.urlSerializer,d);this.events.next(new Oo(s.id,this.urlSerializer.serialize(s.extractedUrl),f,m)),this.events.next(new td(d.redirectTo,d.navigationBehaviorOptions))}else{this.events.next(u);let f=t.errorHandler(l);s.resolve(!!f)}}catch(d){this.options.resolveNavigationPromiseOnError?s.resolve(!1):s.reject(d)}}return nr}))}))}cancelNavigationTransition(t,i,r){let s=new Oo(t.id,this.urlSerializer.serialize(t.extractedUrl),i,r);this.events.next(s),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),i=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return t.toString()!==i?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function a9(n){return n!==mf}var l9=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>ue(c9),providedIn:"root"})}}return n})(),jb=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},c9=(()=>{class n extends jb{static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=Ra(n)))(r||n)}})()}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),rO=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>ue(u9),providedIn:"root"})}}return n})(),u9=(()=>{class n extends rO{constructor(){super(...arguments),this.location=ue(Fa),this.urlSerializer=ue(Cf),this.options=ue(Pf,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=ue(Wb),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new No,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=GL(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(i=>{i.type==="popstate"&&t(i.url,i.state)})}handleRouterEvent(t,i){if(t instanceof ed)this.stateMemento=this.createStateMemento();else if(t instanceof $a)this.rawUrlTree=i.initialUrl;else if(t instanceof j0){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let r=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(i.targetBrowserUrl??r,i)}}else t instanceof _f?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&!i.extras.skipLocationChange&&this.setBrowserUrl(i.targetBrowserUrl??this.rawUrlTree,i)):t instanceof Oo&&(t.code===lr.GuardRejected||t.code===lr.NoDataFromResolver)?this.restoreHistory(i):t instanceof vf?this.restoreHistory(i,!0):t instanceof ks&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,i){let r=t instanceof No?this.urlSerializer.serialize(t):t;if(this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl){let s=this.browserPageId,o=de(de({},i.extras.state),this.generateNgRouterState(i.id,s));this.location.replaceState(r,"",o)}else{let s=de(de({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(r,"",s)}}restoreHistory(t,i=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,s=this.currentPageId-r;s!==0?this.location.historyGo(s):this.currentUrlTree===t.finalUrl&&s===0&&(this.resetState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,i){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:i}:{navigationId:t}}static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=Ra(n)))(r||n)}})()}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),ff=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(ff||{});function sO(n,e){n.events.pipe(Ni(t=>t instanceof ks||t instanceof Oo||t instanceof vf||t instanceof $a),We(t=>t instanceof ks||t instanceof $a?ff.COMPLETE:(t instanceof Oo?t.code===lr.Redirect||t.code===lr.SupersededByNewNavigation:!1)?ff.REDIRECTING:ff.FAILED),Ni(t=>t!==ff.REDIRECTING),_o(1)).subscribe(()=>{e()})}function d9(n){throw n}var h9={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},f9={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},gt=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=ue(u0),this.stateManager=ue(rO),this.options=ue(Pf,{optional:!0})||{},this.pendingTasks=ue(Ma),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=ue(Kb),this.urlSerializer=ue(Cf),this.location=ue(Fa),this.urlHandlingStrategy=ue(Wb),this._events=new zn,this.errorHandler=this.options.errorHandler||d9,this.navigated=!1,this.routeReuseStrategy=ue(l9),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=ue(If,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!ue(Z0,{optional:!0}),this.eventsSubscription=new pn,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(i=>{try{let r=this.navigationTransitions.currentTransition,s=this.navigationTransitions.currentNavigation;if(r!==null&&s!==null){if(this.stateManager.handleRouterEvent(i,s),i instanceof Oo&&i.code!==lr.Redirect&&i.code!==lr.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof ks)this.navigated=!0;else if(i instanceof td){let o=i.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),l=de({browserUrl:r.extras.browserUrl,info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:r.extras.replaceUrl||this.urlUpdateStrategy==="eager"||a9(r.source)},o);this.scheduleNavigation(a,mf,null,l,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}m9(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),mf,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(t,"popstate",i)},0)})}navigateToSyncWithBrowser(t,i,r){let s={replaceUrl:!0},o=r?.navigationId?r:null;if(r){let l=de({},r);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(s.state=l)}let a=this.parseUrl(t);this.scheduleNavigation(a,i,o,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(Hb),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,i={}){let{relativeTo:r,queryParams:s,fragment:o,queryParamsHandling:a,preserveFragment:l}=i,u=l?this.currentUrlTree.fragment:o,d=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":d=de(de({},this.currentUrlTree.queryParams),s);break;case"preserve":d=this.currentUrlTree.queryParams;break;default:d=s||null}d!==null&&(d=this.removeEmptyProps(d));let f;try{let m=r?r.snapshot:this.routerState.snapshot.root;f=BL(m)}catch{(typeof t[0]!="string"||t[0][0]!=="/")&&(t=[]),f=this.currentUrlTree.root}return UL(f,t,d,u??null)}navigateByUrl(t,i={skipLocationChange:!1}){let r=ac(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,mf,null,i)}navigate(t,i={skipLocationChange:!1}){return p9(t),this.navigateByUrl(this.createUrlTree(t,i),i)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,i){let r;if(i===!0?r=de({},h9):i===!1?r=de({},f9):r=i,ac(t))return _L(this.currentUrlTree,t,r);let s=this.parseUrl(t);return _L(this.currentUrlTree,s,r)}removeEmptyProps(t){return Object.entries(t).reduce((i,[r,s])=>(s!=null&&(i[r]=s),i),{})}scheduleNavigation(t,i,r,s,o){if(this.disposed)return Promise.resolve(!1);let a,l,u;o?(a=o.resolve,l=o.reject,u=o.promise):u=new Promise((f,m)=>{a=f,l=m});let d=this.pendingTasks.add();return sO(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(d))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:s,resolve:a,reject:l,promise:u,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),u.catch(f=>Promise.reject(f))}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function p9(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new ye(4008,!1)}function m9(n){return!(n instanceof _f)&&!(n instanceof td)}var oO=(()=>{class n{constructor(t,i,r,s,o,a){this.router=t,this.route=i,this.tabIndexAttribute=r,this.renderer=s,this.el=o,this.locationStrategy=a,this.href=null,this.onChanges=new zn,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1,this.routerLinkInput=null;let l=o.nativeElement.tagName?.toLowerCase();this.isAnchorElement=l==="a"||l==="area",this.isAnchorElement?this.subscription=t.events.subscribe(u=>{u instanceof ks&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(t){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(t){t==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(ac(t)?this.routerLinkInput=t:this.routerLinkInput=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0"))}onClick(t,i,r,s,o){let a=this.urlTree;if(a===null||this.isAnchorElement&&(t!==0||i||r||s||o||typeof this.target=="string"&&this.target!="_self"))return!0;let l={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(a,l),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let t=this.urlTree;this.href=t!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(t)):null;let i=this.href===null?null:RM(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(t,i){let r=this.renderer,s=this.el.nativeElement;i!==null?r.setAttribute(s,t,i):r.removeAttribute(s,t)}get urlTree(){return this.routerLinkInput===null?null:ac(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static{this.\u0275fac=function(i){return new(i||n)(pe(gt),pe(ja),gw("tabindex"),pe(tc),pe(Xr),pe(ko))}}static{this.\u0275dir=ci({type:n,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,r){i&1&&he("click",function(o){return r.onClick(o.button,o.ctrlKey,o.shiftKey,o.altKey,o.metaKey)}),i&2&&xo("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",rc],skipLocationChange:[2,"skipLocationChange","skipLocationChange",rc],replaceUrl:[2,"replaceUrl","replaceUrl",rc],routerLink:"routerLink"},standalone:!0,features:[Nw,Dr]})}}return n})();var Q0=class{};var g9=(()=>{class n{constructor(t,i,r,s,o){this.router=t,this.injector=r,this.preloadingStrategy=s,this.loader=o}setUpPreloading(){this.subscription=this.router.events.pipe(Ni(t=>t instanceof ks),vo(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,i){let r=[];for(let s of i){s.providers&&!s._injector&&(s._injector=l0(s.providers,t,`Route: ${s.path}`));let o=s._injector??t,a=s._loadedInjector??o;(s.loadChildren&&!s._loadedRoutes&&s.canLoad===void 0||s.loadComponent&&!s._loadedComponent)&&r.push(this.preloadConfig(o,s)),(s.children||s._loadedRoutes)&&r.push(this.processRoutes(a,s.children??s._loadedRoutes))}return tn(r).pipe(Iu())}preloadConfig(t,i){return this.preloadingStrategy.preload(i,()=>{let r;i.loadChildren&&i.canLoad===void 0?r=this.loader.loadChildren(t,i):r=$e(null);let s=r.pipe(Dn(o=>o===null?$e(void 0):(i._loadedRoutes=o.routes,i._loadedInjector=o.injector,this.processRoutes(o.injector??t,o.routes))));if(i.loadComponent&&!i._loadedComponent){let o=this.loader.loadComponent(i);return tn([s,o]).pipe(Iu())}else return s})}static{this.\u0275fac=function(i){return new(i||n)(Me(gt),Me(h0),Me(wi),Me(Q0),Me(qb))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),aO=new Pe(""),y9=(()=>{class n{constructor(t,i,r,s,o={}){this.urlSerializer=t,this.transitions=i,this.viewportScroller=r,this.zone=s,this.options=o,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},o.scrollPositionRestoration||="disabled",o.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof ed?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof ks?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof $a&&t.code===$0.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof G0&&(t.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(t.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new G0(t,this.lastSource==="popstate"?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static{this.\u0275fac=function(i){zM()}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})();function lO(n,...e){return Qr([{provide:If,multi:!0,useValue:n},[],{provide:ja,useFactory:cO,deps:[gt]},{provide:ef,multi:!0,useFactory:uO},e.map(t=>t.\u0275providers)])}function cO(n){return n.routerState.root}function Rf(n,e){return{\u0275kind:n,\u0275providers:e}}function uO(){let n=ue(ti);return e=>{let t=n.get(Oa);if(e!==t.components[0])return;let i=n.get(gt),r=n.get(dO);n.get(Yb)===1&&i.initialNavigation(),n.get(hO,null,ht.Optional)?.setUpPreloading(),n.get(aO,null,ht.Optional)?.init(),i.resetRootComponentType(t.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}var dO=new Pe("",{factory:()=>new zn}),Yb=new Pe("",{providedIn:"root",factory:()=>1});function v9(){return Rf(2,[{provide:Yb,useValue:0},{provide:d0,multi:!0,deps:[ti],useFactory:e=>{let t=e.get(Gk,Promise.resolve());return()=>t.then(()=>new Promise(i=>{let r=e.get(gt),s=e.get(dO);sO(r,()=>{i(!0)}),e.get(Kb).afterPreactivation=()=>(i(!0),s.closed?$e(void 0):s),r.initialNavigation()}))}}])}function _9(){return Rf(3,[{provide:d0,multi:!0,useFactory:()=>{let e=ue(gt);return()=>{e.setUpLocationChangeListener()}}},{provide:Yb,useValue:2}])}var hO=new Pe("");function E9(n){return Rf(0,[{provide:hO,useExisting:g9},{provide:Q0,useExisting:n}])}function T9(){return Rf(8,[bL,{provide:Z0,useExisting:bL}])}function w9(n){let e=[{provide:nO,useValue:r9},{provide:iO,useValue:de({skipNextTransition:!!n?.skipInitialTransition},n)}];return Rf(9,e)}var xL=new Pe("ROUTER_FORROOT_GUARD"),b9=[Fa,{provide:Cf,useClass:Ju},gt,Af,{provide:ja,useFactory:cO,deps:[gt]},qb,[]],J0=(()=>{class n{constructor(t){}static forRoot(t,i){return{ngModule:n,providers:[b9,[],{provide:If,multi:!0,useValue:t},{provide:xL,useFactory:x9,deps:[[gt,new li,new ew]]},{provide:Pf,useValue:i||{}},i?.useHash?S9():C9(),I9(),i?.preloadingStrategy?E9(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?A9(i):[],i?.bindToComponentInputs?T9().\u0275providers:[],i?.enableViewTransitions?w9().\u0275providers:[],D9()]}}static forChild(t){return{ngModule:n,providers:[{provide:If,multi:!0,useValue:t}]}}static{this.\u0275fac=function(i){return new(i||n)(Me(xL,8))}}static{this.\u0275mod=Ps({type:n})}static{this.\u0275inj=Ds({})}}return n})();function I9(){return{provide:aO,useFactory:()=>{let n=ue(Jk),e=ue(Dt),t=ue(Pf),i=ue(Kb),r=ue(Cf);return t.scrollOffset&&n.setOffset(t.scrollOffset),new y9(r,i,n,e,t)}}}function S9(){return{provide:ko,useClass:Hk}}function C9(){return{provide:ko,useClass:Zw}}function x9(n){return"guarded"}function A9(n){return[n.initialNavigation==="disabled"?_9().\u0275providers:[],n.initialNavigation==="enabledBlocking"?v9().\u0275providers:[]]}var AL=new Pe("");function D9(){return[{provide:AL,useFactory:uO},{provide:ef,multi:!0,useExisting:AL}]}var at=function(n){return n[n.State=0]="State",n[n.Transition=1]="Transition",n[n.Sequence=2]="Sequence",n[n.Group=3]="Group",n[n.Animate=4]="Animate",n[n.Keyframes=5]="Keyframes",n[n.Style=6]="Style",n[n.Trigger=7]="Trigger",n[n.Reference=8]="Reference",n[n.AnimateChild=9]="AnimateChild",n[n.AnimateRef=10]="AnimateRef",n[n.Query=11]="Query",n[n.Stagger=12]="Stagger",n}(at||{}),Ls="*";function Qb(n,e){return{type:at.Trigger,name:n,definitions:e,options:{}}}function kf(n,e=null){return{type:at.Animate,styles:e,timings:n}}function fO(n,e=null){return{type:at.Sequence,steps:n,options:e}}function Os(n){return{type:at.Style,styles:n,offset:null}}function Lf(n,e,t=null){return{type:at.Transition,expr:n,animation:e,options:t}}var za=class{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}},Mf=class{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,i=0,r=0,s=this.players.length;s==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++t==s&&this._onFinish()}),o.onDestroy(()=>{++i==s&&this._onDestroy()}),o.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((o,a)=>Math.max(o,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){let t=e*this.totalTime;this.players.forEach(i=>{let r=i.totalTime?Math.min(1,t/i.totalTime):1;i.setPosition(r)})}getPosition(){let e=this.players.reduce((t,i)=>t===null||i.totalTime>t.totalTime?i:t,null);return e!=null?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}},ey="!";function pO(n){return new ye(3e3,!1)}function P9(){return new ye(3100,!1)}function R9(){return new ye(3101,!1)}function M9(n){return new ye(3001,!1)}function k9(n){return new ye(3003,!1)}function L9(n){return new ye(3004,!1)}function O9(n,e){return new ye(3005,!1)}function N9(){return new ye(3006,!1)}function F9(){return new ye(3007,!1)}function V9(n,e){return new ye(3008,!1)}function B9(n){return new ye(3002,!1)}function U9(n,e,t,i,r){return new ye(3010,!1)}function $9(){return new ye(3011,!1)}function j9(){return new ye(3012,!1)}function G9(){return new ye(3200,!1)}function z9(){return new ye(3202,!1)}function H9(){return new ye(3013,!1)}function q9(n){return new ye(3014,!1)}function W9(n){return new ye(3015,!1)}function K9(n){return new ye(3016,!1)}function Y9(n,e){return new ye(3404,!1)}function Q9(n){return new ye(3502,!1)}function Z9(n){return new ye(3503,!1)}function X9(){return new ye(3300,!1)}function J9(n){return new ye(3504,!1)}function e7(n){return new ye(3301,!1)}function t7(n,e){return new ye(3302,!1)}function n7(n){return new ye(3303,!1)}function i7(n,e){return new ye(3400,!1)}function r7(n){return new ye(3401,!1)}function s7(n){return new ye(3402,!1)}function o7(n,e){return new ye(3505,!1)}function Ha(n){switch(n.length){case 0:return new za;case 1:return n[0];default:return new Mf(n)}}function AO(n,e,t=new Map,i=new Map){let r=[],s=[],o=-1,a=null;if(e.forEach(l=>{let u=l.get("offset"),d=u==o,f=d&&a||new Map;l.forEach((m,y)=>{let v=y,E=m;if(y!=="offset")switch(v=n.normalizePropertyName(v,r),E){case ey:E=t.get(y);break;case Ls:E=i.get(y);break;default:E=n.normalizeStyleValue(y,v,E,r);break}f.set(v,E)}),d||s.push(f),a=f,o=u}),r.length)throw Q9(r);return s}function _I(n,e,t,i){switch(e){case"start":n.onStart(()=>i(t&&Zb(t,"start",n)));break;case"done":n.onDone(()=>i(t&&Zb(t,"done",n)));break;case"destroy":n.onDestroy(()=>i(t&&Zb(t,"destroy",n)));break}}function Zb(n,e,t){let i=t.totalTime,r=!!t.disabled,s=EI(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,i??n.totalTime,r),o=n._data;return o!=null&&(s._data=o),s}function EI(n,e,t,i,r="",s=0,o){return{element:n,triggerName:e,fromState:t,toState:i,phaseName:r,totalTime:s,disabled:!!o}}function ur(n,e,t){let i=n.get(e);return i||n.set(e,i=t),i}function mO(n){let e=n.indexOf(":"),t=n.substring(1,e),i=n.slice(e+1);return[t,i]}var a7=typeof document>"u"?null:document.documentElement;function TI(n){let e=n.parentNode||n.host||null;return e===a7?null:e}function l7(n){return n.substring(1,6)=="ebkit"}var lc=null,gO=!1;function c7(n){lc||(lc=u7()||{},gO=lc.style?"WebkitAppearance"in lc.style:!1);let e=!0;return lc.style&&!l7(n)&&(e=n in lc.style,!e&&gO&&(e="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in lc.style)),e}function u7(){return typeof document<"u"?document.body:null}function DO(n,e){for(;e;){if(e===n)return!0;e=TI(e)}return!1}function PO(n,e,t){if(t)return Array.from(n.querySelectorAll(e));let i=n.querySelector(e);return i?[i]:[]}var wI=(()=>{class n{validateStyleProperty(t){return c7(t)}containsElement(t,i){return DO(t,i)}getParentElement(t){return TI(t)}query(t,i,r){return PO(t,i,r)}computeStyle(t,i,r){return r||""}animate(t,i,r,s,o,a=[],l){return new za(r,s)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),dc=class{static{this.NOOP=new wI}},hc=class{};var d7=1e3,RO="{{",h7="}}",MO="ng-enter",iI="ng-leave",ty="ng-trigger",oy=".ng-trigger",yO="ng-animating",rI=".ng-animating";function Fo(n){if(typeof n=="number")return n;let e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:sI(parseFloat(e[1]),e[2])}function sI(n,e){switch(e){case"s":return n*d7;default:return n}}function ay(n,e,t){return n.hasOwnProperty("duration")?n:f7(n,e,t)}function f7(n,e,t){let i=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,r,s=0,o="";if(typeof n=="string"){let a=n.match(i);if(a===null)return e.push(pO(n)),{duration:0,delay:0,easing:""};r=sI(parseFloat(a[1]),a[2]);let l=a[3];l!=null&&(s=sI(parseFloat(l),a[4]));let u=a[5];u&&(o=u)}else r=n;if(!t){let a=!1,l=e.length;r<0&&(e.push(P9()),a=!0),s<0&&(e.push(R9()),a=!0),a&&e.splice(l,0,pO(n))}return{duration:r,delay:s,easing:o}}function p7(n){return n.length?n[0]instanceof Map?n:n.map(e=>new Map(Object.entries(e))):[]}function Ns(n,e,t){e.forEach((i,r)=>{let s=bI(r);t&&!t.has(r)&&t.set(r,n.style[s]),n.style[s]=i})}function uc(n,e){e.forEach((t,i)=>{let r=bI(i);n.style[r]=""})}function Of(n){return Array.isArray(n)?n.length==1?n[0]:fO(n):n}function m7(n,e,t){let i=e.params||{},r=kO(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||t.push(M9(s))})}var oI=new RegExp(`${RO}\\s*(.+?)\\s*${h7}`,"g");function kO(n){let e=[];if(typeof n=="string"){let t;for(;t=oI.exec(n);)e.push(t[1]);oI.lastIndex=0}return e}function Ff(n,e,t){let i=`${n}`,r=i.replace(oI,(s,o)=>{let a=e[o];return a==null&&(t.push(k9(o)),a=""),a.toString()});return r==i?n:r}var g7=/-+([a-z0-9])/g;function bI(n){return n.replace(g7,(...e)=>e[1].toUpperCase())}function y7(n,e){return n===0||e===0}function v7(n,e,t){if(t.size&&e.length){let i=e[0],r=[];if(t.forEach((s,o)=>{i.has(o)||r.push(o),i.set(o,s)}),r.length)for(let s=1;s<e.length;s++){let o=e[s];r.forEach(a=>o.set(a,II(n,a)))}}return e}function cr(n,e,t){switch(e.type){case at.Trigger:return n.visitTrigger(e,t);case at.State:return n.visitState(e,t);case at.Transition:return n.visitTransition(e,t);case at.Sequence:return n.visitSequence(e,t);case at.Group:return n.visitGroup(e,t);case at.Animate:return n.visitAnimate(e,t);case at.Keyframes:return n.visitKeyframes(e,t);case at.Style:return n.visitStyle(e,t);case at.Reference:return n.visitReference(e,t);case at.AnimateChild:return n.visitAnimateChild(e,t);case at.AnimateRef:return n.visitAnimateRef(e,t);case at.Query:return n.visitQuery(e,t);case at.Stagger:return n.visitStagger(e,t);default:throw L9(e.type)}}function II(n,e){return window.getComputedStyle(n)[e]}var _7=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),ly=class extends hc{normalizePropertyName(e,t){return bI(e)}normalizeStyleValue(e,t,i,r){let s="",o=i.toString().trim();if(_7.has(t)&&i!==0&&i!=="0")if(typeof i=="number")s="px";else{let a=i.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&a[1].length==0&&r.push(O9(e,i))}return o+s}};var cy="*";function E7(n,e){let t=[];return typeof n=="string"?n.split(/\s*,\s*/).forEach(i=>T7(i,t,e)):t.push(n),t}function T7(n,e,t){if(n[0]==":"){let l=w7(n,t);if(typeof l=="function"){e.push(l);return}n=l}let i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(i==null||i.length<4)return t.push(W9(n)),e;let r=i[1],s=i[2],o=i[3];e.push(vO(r,o));let a=r==cy&&o==cy;s[0]=="<"&&!a&&e.push(vO(o,r))}function w7(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,i)=>parseFloat(i)>parseFloat(t);case":decrement":return(t,i)=>parseFloat(i)<parseFloat(t);default:return e.push(K9(n)),"* => *"}}var ny=new Set(["true","1"]),iy=new Set(["false","0"]);function vO(n,e){let t=ny.has(n)||iy.has(n),i=ny.has(e)||iy.has(e);return(r,s)=>{let o=n==cy||n==r,a=e==cy||e==s;return!o&&t&&typeof r=="boolean"&&(o=r?ny.has(n):iy.has(n)),!a&&i&&typeof s=="boolean"&&(a=s?ny.has(e):iy.has(e)),o&&a}}var LO=":self",b7=new RegExp(`s*${LO}s*,?`,"g");function OO(n,e,t,i){return new aI(n).build(e,t,i)}var _O="",aI=class{constructor(e){this._driver=e}build(e,t,i){let r=new lI(t);return this._resetContextStyleTimingState(r),cr(this,Of(e),r)}_resetContextStyleTimingState(e){e.currentQuerySelector=_O,e.collectedStyles=new Map,e.collectedStyles.set(_O,new Map),e.currentTime=0}visitTrigger(e,t){let i=t.queryCount=0,r=t.depCount=0,s=[],o=[];return e.name.charAt(0)=="@"&&t.errors.push(N9()),e.definitions.forEach(a=>{if(this._resetContextStyleTimingState(t),a.type==at.State){let l=a,u=l.name;u.toString().split(/\s*,\s*/).forEach(d=>{l.name=d,s.push(this.visitState(l,t))}),l.name=u}else if(a.type==at.Transition){let l=this.visitTransition(a,t);i+=l.queryCount,r+=l.depCount,o.push(l)}else t.errors.push(F9())}),{type:at.Trigger,name:e.name,states:s,transitions:o,queryCount:i,depCount:r,options:null}}visitState(e,t){let i=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(i.containsDynamicStyles){let s=new Set,o=r||{};i.styles.forEach(a=>{a instanceof Map&&a.forEach(l=>{kO(l).forEach(u=>{o.hasOwnProperty(u)||s.add(u)})})}),s.size&&t.errors.push(V9(e.name,[...s.values()]))}return{type:at.State,name:e.name,style:i,options:r?{params:r}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;let i=cr(this,Of(e.animation),t),r=E7(e.expr,t.errors);return{type:at.Transition,matchers:r,animation:i,queryCount:t.queryCount,depCount:t.depCount,options:cc(e.options)}}visitSequence(e,t){return{type:at.Sequence,steps:e.steps.map(i=>cr(this,i,t)),options:cc(e.options)}}visitGroup(e,t){let i=t.currentTime,r=0,s=e.steps.map(o=>{t.currentTime=i;let a=cr(this,o,t);return r=Math.max(r,t.currentTime),a});return t.currentTime=r,{type:at.Group,steps:s,options:cc(e.options)}}visitAnimate(e,t){let i=x7(e.timings,t.errors);t.currentAnimateTimings=i;let r,s=e.styles?e.styles:Os({});if(s.type==at.Keyframes)r=this.visitKeyframes(s,t);else{let o=e.styles,a=!1;if(!o){a=!0;let u={};i.easing&&(u.easing=i.easing),o=Os(u)}t.currentTime+=i.duration+i.delay;let l=this.visitStyle(o,t);l.isEmptyStep=a,r=l}return t.currentAnimateTimings=null,{type:at.Animate,timings:i,style:r,options:null}}visitStyle(e,t){let i=this._makeStyleAst(e,t);return this._validateStyleAst(i,t),i}_makeStyleAst(e,t){let i=[],r=Array.isArray(e.styles)?e.styles:[e.styles];for(let a of r)typeof a=="string"?a===Ls?i.push(a):t.errors.push(B9(a)):i.push(new Map(Object.entries(a)));let s=!1,o=null;return i.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(o=a.get("easing"),a.delete("easing")),!s)){for(let l of a.values())if(l.toString().indexOf(RO)>=0){s=!0;break}}}),{type:at.Style,styles:i,easing:o,offset:e.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(e,t){let i=t.currentAnimateTimings,r=t.currentTime,s=t.currentTime;i&&s>0&&(s-=i.duration+i.delay),e.styles.forEach(o=>{typeof o!="string"&&o.forEach((a,l)=>{let u=t.collectedStyles.get(t.currentQuerySelector),d=u.get(l),f=!0;d&&(s!=r&&s>=d.startTime&&r<=d.endTime&&(t.errors.push(U9(l,d.startTime,d.endTime,s,r)),f=!1),s=d.startTime),f&&u.set(l,{startTime:s,endTime:r}),t.options&&m7(a,t.options,t.errors)})})}visitKeyframes(e,t){let i={type:at.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push($9()),i;let r=1,s=0,o=[],a=!1,l=!1,u=0,d=e.steps.map(C=>{let D=this._makeStyleAst(C,t),P=D.offset!=null?D.offset:C7(D.styles),V=0;return P!=null&&(s++,V=D.offset=P),l=l||V<0||V>1,a=a||V<u,u=V,o.push(V),D});l&&t.errors.push(j9()),a&&t.errors.push(G9());let f=e.steps.length,m=0;s>0&&s<f?t.errors.push(z9()):s==0&&(m=r/(f-1));let y=f-1,v=t.currentTime,E=t.currentAnimateTimings,T=E.duration;return d.forEach((C,D)=>{let P=m>0?D==y?1:m*D:o[D],V=P*T;t.currentTime=v+E.delay+V,E.duration=V,this._validateStyleAst(C,t),C.offset=P,i.styles.push(C)}),i}visitReference(e,t){return{type:at.Reference,animation:cr(this,Of(e.animation),t),options:cc(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:at.AnimateChild,options:cc(e.options)}}visitAnimateRef(e,t){return{type:at.AnimateRef,animation:this.visitReference(e.animation,t),options:cc(e.options)}}visitQuery(e,t){let i=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;let[s,o]=I7(e.selector);t.currentQuerySelector=i.length?i+" "+s:s,ur(t.collectedStyles,t.currentQuerySelector,new Map);let a=cr(this,Of(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=i,{type:at.Query,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:o,animation:a,originalSelector:e.selector,options:cc(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(H9());let i=e.timings==="full"?{duration:0,delay:0,easing:"full"}:ay(e.timings,t.errors,!0);return{type:at.Stagger,animation:cr(this,Of(e.animation),t),timings:i,options:null}}};function I7(n){let e=!!n.split(/\s*,\s*/).find(t=>t==LO);return e&&(n=n.replace(b7,"")),n=n.replace(/@\*/g,oy).replace(/@\w+/g,t=>oy+"-"+t.slice(1)).replace(/:animating/g,rI),[n,e]}function S7(n){return n?de({},n):null}var lI=class{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function C7(n){if(typeof n=="string")return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(t instanceof Map&&t.has("offset")){let i=t;e=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){let t=n;e=parseFloat(t.get("offset")),t.delete("offset")}return e}function x7(n,e){if(n.hasOwnProperty("duration"))return n;if(typeof n=="number"){let s=ay(n,e).duration;return Xb(s,0,"")}let t=n;if(t.split(/\s+/).some(s=>s.charAt(0)=="{"&&s.charAt(1)=="{")){let s=Xb(0,0,"");return s.dynamic=!0,s.strValue=t,s}let r=ay(t,e);return Xb(r.duration,r.delay,r.easing)}function cc(n){return n?(n=de({},n),n.params&&(n.params=S7(n.params))):n={},n}function Xb(n,e,t){return{duration:n,delay:e,easing:t}}function SI(n,e,t,i,r,s,o=null,a=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:o,subTimeline:a}}var Vf=class{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let i=this._map.get(e);i||this._map.set(e,i=[]),i.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}},A7=1,D7=":enter",P7=new RegExp(D7,"g"),R7=":leave",M7=new RegExp(R7,"g");function NO(n,e,t,i,r,s=new Map,o=new Map,a,l,u=[]){return new cI().buildKeyframes(n,e,t,i,r,s,o,a,l,u)}var cI=class{buildKeyframes(e,t,i,r,s,o,a,l,u,d=[]){u=u||new Vf;let f=new uI(e,t,u,r,s,d,[]);f.options=l;let m=l.delay?Fo(l.delay):0;f.currentTimeline.delayNextStep(m),f.currentTimeline.setStyles([o],null,f.errors,l),cr(this,i,f);let y=f.timelines.filter(v=>v.containsAnimation());if(y.length&&a.size){let v;for(let E=y.length-1;E>=0;E--){let T=y[E];if(T.element===t){v=T;break}}v&&!v.allowOnlyTimelineStyles()&&v.setStyles([a],null,f.errors,l)}return y.length?y.map(v=>v.buildKeyframes()):[SI(t,[],[],[],0,m,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){let i=t.subInstructions.get(t.element);if(i){let r=t.createSubContext(e.options),s=t.currentTimeline.currentTime,o=this._visitSubInstructions(i,r,r.options);s!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){let i=t.createSubContext(e.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,i),this.visitReference(e.animation,i),t.transformIntoNewTimeline(i.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,i){for(let r of e){let s=r?.delay;if(s){let o=typeof s=="number"?s:Fo(Ff(s,r?.params??{},t.errors));i.delayNextStep(o)}}}_visitSubInstructions(e,t,i){let s=t.currentTimeline.currentTime,o=i.duration!=null?Fo(i.duration):null,a=i.delay!=null?Fo(i.delay):null;return o!==0&&e.forEach(l=>{let u=t.appendInstructionToTimeline(l,o,a);s=Math.max(s,u.duration+u.delay)}),s}visitReference(e,t){t.updateOptions(e.options,!0),cr(this,e.animation,t),t.previousNode=e}visitSequence(e,t){let i=t.subContextCount,r=t,s=e.options;if(s&&(s.params||s.delay)&&(r=t.createSubContext(s),r.transformIntoNewTimeline(),s.delay!=null)){r.previousNode.type==at.Style&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=uy);let o=Fo(s.delay);r.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>cr(this,o,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){let i=[],r=t.currentTimeline.currentTime,s=e.options&&e.options.delay?Fo(e.options.delay):0;e.steps.forEach(o=>{let a=t.createSubContext(e.options);s&&a.delayNextStep(s),cr(this,o,a),r=Math.max(r,a.currentTimeline.currentTime),i.push(a.currentTimeline)}),i.forEach(o=>t.currentTimeline.mergeTimelineCollectedStyles(o)),t.transformIntoNewTimeline(r),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){let i=e.strValue,r=t.params?Ff(i,t.params,t.errors):i;return ay(r,t.errors)}else return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){let i=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;i.delay&&(t.incrementTime(i.delay),r.snapshotCurrentStyles());let s=e.style;s.type==at.Keyframes?this.visitKeyframes(s,t):(t.incrementTime(i.duration),this.visitStyle(s,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){let i=t.currentTimeline,r=t.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();let s=r&&r.easing||e.easing;e.isEmptyStep?i.applyEmptyStep(s):i.setStyles(e.styles,s,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){let i=t.currentAnimateTimings,r=t.currentTimeline.duration,s=i.duration,a=t.createSubContext().currentTimeline;a.easing=i.easing,e.styles.forEach(l=>{let u=l.offset||0;a.forwardTime(u*s),a.setStyles(l.styles,l.easing,t.errors,t.options),a.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(a),t.transformIntoNewTimeline(r+s),t.previousNode=e}visitQuery(e,t){let i=t.currentTimeline.currentTime,r=e.options||{},s=r.delay?Fo(r.delay):0;s&&(t.previousNode.type===at.Style||i==0&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=uy);let o=i,a=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,t.errors);t.currentQueryTotal=a.length;let l=null;a.forEach((u,d)=>{t.currentQueryIndex=d;let f=t.createSubContext(e.options,u);s&&f.delayNextStep(s),u===t.element&&(l=f.currentTimeline),cr(this,e.animation,f),f.currentTimeline.applyStylesToKeyframe();let m=f.currentTimeline.currentTime;o=Math.max(o,m)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),l&&(t.currentTimeline.mergeTimelineCollectedStyles(l),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){let i=t.parentContext,r=t.currentTimeline,s=e.timings,o=Math.abs(s.duration),a=o*(t.currentQueryTotal-1),l=o*t.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":l=a-l;break;case"full":l=i.currentStaggerTime;break}let d=t.currentTimeline;l&&d.delayNextStep(l);let f=d.currentTime;cr(this,e.animation,t),t.previousNode=e,i.currentStaggerTime=r.currentTime-f+(r.startTime-i.currentTimeline.startTime)}},uy={},uI=class n{constructor(e,t,i,r,s,o,a,l){this._driver=e,this.element=t,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=o,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=uy,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=l||new dy(this._driver,t,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;let i=e,r=this.options;i.duration!=null&&(r.duration=Fo(i.duration)),i.delay!=null&&(r.delay=Fo(i.delay));let s=i.params;if(s){let o=r.params;o||(o=this.options.params={}),Object.keys(s).forEach(a=>{(!t||!o.hasOwnProperty(a))&&(o[a]=Ff(s[a],o,this.errors))})}}_copyOptions(){let e={};if(this.options){let t=this.options.params;if(t){let i=e.params={};Object.keys(t).forEach(r=>{i[r]=t[r]})}}return e}createSubContext(e=null,t,i){let r=t||this.element,s=new n(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(e),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(e){return this.previousNode=uy,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,i){let r={duration:t??e.duration,delay:this.currentTimeline.currentTime+(i??0)+e.delay,easing:""},s=new dI(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,i,r,s,o){let a=[];if(r&&a.push(this.element),e.length>0){e=e.replace(P7,"."+this._enterClassName),e=e.replace(M7,"."+this._leaveClassName);let l=i!=1,u=this._driver.query(this.element,e,l);i!==0&&(u=i<0?u.slice(u.length+i,u.length):u.slice(0,i)),a.push(...u)}return!s&&a.length==0&&o.push(q9(t)),a}},dy=class n{constructor(e,t,i,r){this._driver=e,this.element=t,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let t=this._keyframes.size===1&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new n(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=A7,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,i]of this._globalTimelineStyles)this._backFill.set(t,i||Ls),this._currentKeyframe.set(t,Ls);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,i,r){t&&this._previousKeyframe.set("easing",t);let s=r&&r.params||{},o=k7(e,this._globalTimelineStyles);for(let[a,l]of o){let u=Ff(l,s,i);this._pendingStyles.set(a,u),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??Ls),this._updateStyle(a,u)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,i)=>{let r=this._styleSummary.get(i);(!r||t.time>r.time)&&this._updateStyle(i,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,t=new Set,i=this._keyframes.size===1&&this.duration===0,r=[];this._keyframes.forEach((a,l)=>{let u=new Map([...this._backFill,...a]);u.forEach((d,f)=>{d===ey?e.add(f):d===Ls&&t.add(f)}),i||u.set("offset",l/this.duration),r.push(u)});let s=[...e.values()],o=[...t.values()];if(i){let a=r[0],l=new Map(a);a.set("offset",0),l.set("offset",1),r=[a,l]}return SI(this.element,r,s,o,this.duration,this.startTime,this.easing,!1)}},dI=class extends dy{constructor(e,t,i,r,s,o,a=!1){super(e,t,o.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&t){let s=[],o=i+t,a=t/o,l=new Map(e[0]);l.set("offset",0),s.push(l);let u=new Map(e[0]);u.set("offset",EO(a)),s.push(u);let d=e.length-1;for(let f=1;f<=d;f++){let m=new Map(e[f]),y=m.get("offset"),v=t+y*i;m.set("offset",EO(v/o)),s.push(m)}i=o,t=0,r="",e=s}return SI(this.element,e,this.preStyleProps,this.postStyleProps,i,t,r,!0)}};function EO(n,e=3){let t=Math.pow(10,e-1);return Math.round(n*t)/t}function k7(n,e){let t=new Map,i;return n.forEach(r=>{if(r==="*"){i??=e.keys();for(let s of i)t.set(s,Ls)}else for(let[s,o]of r)t.set(s,o)}),t}function TO(n,e,t,i,r,s,o,a,l,u,d,f,m){return{type:0,element:n,triggerName:e,isRemovalTransition:r,fromState:t,fromStyles:s,toState:i,toStyles:o,timelines:a,queriedElements:l,preStyleProps:u,postStyleProps:d,totalTime:f,errors:m}}var Jb={},hy=class{constructor(e,t,i){this._triggerName=e,this.ast=t,this._stateStyles=i}match(e,t,i,r){return L7(this.ast.matchers,e,t,i,r)}buildStyles(e,t,i){let r=this._stateStyles.get("*");return e!==void 0&&(r=this._stateStyles.get(e?.toString())||r),r?r.buildStyles(t,i):new Map}build(e,t,i,r,s,o,a,l,u,d){let f=[],m=this.ast.options&&this.ast.options.params||Jb,y=a&&a.params||Jb,v=this.buildStyles(i,y,f),E=l&&l.params||Jb,T=this.buildStyles(r,E,f),C=new Set,D=new Map,P=new Map,V=r==="void",G={params:FO(E,m),delay:this.ast.options?.delay},H=d?[]:NO(e,t,this.ast.animation,s,o,v,T,G,u,f),A=0;return H.forEach(x=>{A=Math.max(x.duration+x.delay,A)}),f.length?TO(t,this._triggerName,i,r,V,v,T,[],[],D,P,A,f):(H.forEach(x=>{let R=x.element,M=ur(D,R,new Set);x.preStyleProps.forEach(j=>M.add(j));let F=ur(P,R,new Set);x.postStyleProps.forEach(j=>F.add(j)),R!==t&&C.add(R)}),TO(t,this._triggerName,i,r,V,v,T,H,[...C.values()],D,P,A))}};function L7(n,e,t,i,r){return n.some(s=>s(e,t,i,r))}function FO(n,e){let t=de({},e);return Object.entries(n).forEach(([i,r])=>{r!=null&&(t[i]=r)}),t}var hI=class{constructor(e,t,i){this.styles=e,this.defaultParams=t,this.normalizer=i}buildStyles(e,t){let i=new Map,r=FO(e,this.defaultParams);return this.styles.styles.forEach(s=>{typeof s!="string"&&s.forEach((o,a)=>{o&&(o=Ff(o,r,t));let l=this.normalizer.normalizePropertyName(a,t);o=this.normalizer.normalizeStyleValue(a,l,o,t),i.set(a,o)})}),i}};function O7(n,e,t){return new fI(n,e,t)}var fI=class{constructor(e,t,i){this.name=e,this.ast=t,this._normalizer=i,this.transitionFactories=[],this.states=new Map,t.states.forEach(r=>{let s=r.options&&r.options.params||{};this.states.set(r.name,new hI(r.style,s,i))}),wO(this.states,"true","1"),wO(this.states,"false","0"),t.transitions.forEach(r=>{this.transitionFactories.push(new hy(e,r,this.states))}),this.fallbackTransition=N7(e,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,i,r){return this.transitionFactories.find(o=>o.match(e,t,i,r))||null}matchStyles(e,t,i){return this.fallbackTransition.buildStyles(e,t,i)}};function N7(n,e,t){let i=[(o,a)=>!0],r={type:at.Sequence,steps:[],options:null},s={type:at.Transition,animation:r,matchers:i,options:null,queryCount:0,depCount:0};return new hy(n,s,e)}function wO(n,e,t){n.has(e)?n.has(t)||n.set(t,n.get(e)):n.has(t)&&n.set(e,n.get(t))}var F7=new Vf,pI=class{constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){let i=[],r=[],s=OO(this._driver,t,i,r);if(i.length)throw Z9(i);r.length&&void 0,this._animations.set(e,s)}_buildPlayer(e,t,i){let r=e.element,s=AO(this._normalizer,e.keyframes,t,i);return this._driver.animate(r,s,e.duration,e.delay,e.easing,[],!0)}create(e,t,i={}){let r=[],s=this._animations.get(e),o,a=new Map;if(s?(o=NO(this._driver,t,s,MO,iI,new Map,new Map,i,F7,r),o.forEach(d=>{let f=ur(a,d.element,new Map);d.postStyleProps.forEach(m=>f.set(m,null))})):(r.push(X9()),o=[]),r.length)throw J9(r);a.forEach((d,f)=>{d.forEach((m,y)=>{d.set(y,this._driver.computeStyle(f,y,Ls))})});let l=o.map(d=>{let f=a.get(d.element);return this._buildPlayer(d,new Map,f)}),u=Ha(l);return this._playersById.set(e,u),u.onDestroy(()=>this.destroy(e)),this.players.push(u),u}destroy(e){let t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);let i=this.players.indexOf(t);i>=0&&this.players.splice(i,1)}_getPlayer(e){let t=this._playersById.get(e);if(!t)throw e7(e);return t}listen(e,t,i,r){let s=EI(t,"","","");return _I(this._getPlayer(e),i,s,r),()=>{}}command(e,t,i,r){if(i=="register"){this.register(e,r[0]);return}if(i=="create"){let o=r[0]||{};this.create(e,t,o);return}let s=this._getPlayer(e);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e);break}}},bO="ng-animate-queued",V7=".ng-animate-queued",eI="ng-animate-disabled",B7=".ng-animate-disabled",U7="ng-star-inserted",$7=".ng-star-inserted",j7=[],VO={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},G7={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},is="__ng_removed",Bf=class{get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;let i=e&&e.hasOwnProperty("value"),r=i?e.value:e;if(this.value=H7(r),i){let s=e,{value:o}=s,a=pE(s,["value"]);this.options=a}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let t=e.params;if(t){let i=this.options.params;Object.keys(t).forEach(r=>{i[r]==null&&(i[r]=t[r])})}}},Nf="void",tI=new Bf(Nf),mI=class{constructor(e,t,i){this.id=e,this.hostElement=t,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,kr(t,this._hostClassName)}listen(e,t,i,r){if(!this._triggers.has(t))throw t7(i,t);if(i==null||i.length==0)throw n7(t);if(!q7(i))throw i7(i,t);let s=ur(this._elementListeners,e,[]),o={name:t,phase:i,callback:r};s.push(o);let a=ur(this._engine.statesByElement,e,new Map);return a.has(t)||(kr(e,ty),kr(e,ty+"-"+t),a.set(t,tI)),()=>{this._engine.afterFlush(()=>{let l=s.indexOf(o);l>=0&&s.splice(l,1),this._triggers.has(t)||a.delete(t)})}}register(e,t){return this._triggers.has(e)?!1:(this._triggers.set(e,t),!0)}_getTrigger(e){let t=this._triggers.get(e);if(!t)throw r7(e);return t}trigger(e,t,i,r=!0){let s=this._getTrigger(t),o=new Uf(this.id,t,e),a=this._engine.statesByElement.get(e);a||(kr(e,ty),kr(e,ty+"-"+t),this._engine.statesByElement.set(e,a=new Map));let l=a.get(t),u=new Bf(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&l&&u.absorbOptions(l.options),a.set(t,u),l||(l=tI),!(u.value===Nf)&&l.value===u.value){if(!Y7(l.params,u.params)){let E=[],T=s.matchStyles(l.value,l.params,E),C=s.matchStyles(u.value,u.params,E);E.length?this._engine.reportError(E):this._engine.afterFlush(()=>{uc(e,T),Ns(e,C)})}return}let m=ur(this._engine.playersByElement,e,[]);m.forEach(E=>{E.namespaceId==this.id&&E.triggerName==t&&E.queued&&E.destroy()});let y=s.matchTransition(l.value,u.value,e,u.params),v=!1;if(!y){if(!r)return;y=s.fallbackTransition,v=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:y,fromState:l,toState:u,player:o,isFallbackTransition:v}),v||(kr(e,bO),o.onStart(()=>{rd(e,bO)})),o.onDone(()=>{let E=this.players.indexOf(o);E>=0&&this.players.splice(E,1);let T=this._engine.playersByElement.get(e);if(T){let C=T.indexOf(o);C>=0&&T.splice(C,1)}}),this.players.push(o),m.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,i)=>{this._elementListeners.set(i,t.filter(r=>r.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let t=this._engine.playersByElement.get(e);t&&(t.forEach(i=>i.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){let i=this._engine.driver.query(e,oy,!0);i.forEach(r=>{if(r[is])return;let s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(o=>o.triggerLeaveAnimation(r,t,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(e,t,i,r){let s=this._engine.statesByElement.get(e),o=new Map;if(s){let a=[];if(s.forEach((l,u)=>{if(o.set(u,l.value),this._triggers.has(u)){let d=this.trigger(e,u,Nf,r);d&&a.push(d)}}),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,o),i&&Ha(a).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let t=this._elementListeners.get(e),i=this._engine.statesByElement.get(e);if(t&&i){let r=new Set;t.forEach(s=>{let o=s.name;if(r.has(o))return;r.add(o);let l=this._triggers.get(o).fallbackTransition,u=i.get(o)||tI,d=new Bf(Nf),f=new Uf(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:l,fromState:u,toState:d,player:f,isFallbackTransition:!0})})}}removeNode(e,t){let i=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let r=!1;if(i.totalAnimations){let s=i.players.length?i.playersByQueriedElement.get(e):[];if(s&&s.length)r=!0;else{let o=e;for(;o=o.parentNode;)if(i.statesByElement.get(o)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)i.markElementAsRemoved(this.id,e,!1,t);else{let s=e[is];(!s||s===VO)&&(i.afterFlush(()=>this.clearElementCache(e)),i.destroyInnerAnimations(e),i._onRemovalComplete(e,t))}}insertNode(e,t){kr(e,this._hostClassName)}drainQueuedTransitions(e){let t=[];return this._queue.forEach(i=>{let r=i.player;if(r.destroyed)return;let s=i.element,o=this._elementListeners.get(s);o&&o.forEach(a=>{if(a.name==i.triggerName){let l=EI(s,i.triggerName,i.fromState.value,i.toState.value);l._data=e,_I(i.player,a.phase,l,a.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):t.push(i)}),this._queue=[],t.sort((i,r)=>{let s=i.transition.ast.depCount,o=r.transition.ast.depCount;return s==0||o==0?s-o:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},gI=class{_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,i){this.bodyNode=e,this.driver=t,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}get queuedPlayers(){let e=[];return this._namespaceList.forEach(t=>{t.players.forEach(i=>{i.queued&&e.push(i)})}),e}createNamespace(e,t){let i=new mI(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(i,t):(this.newHostElements.set(t,i),this.collectEnterElement(t)),this._namespaceLookup[e]=i}_balanceNamespaceList(e,t){let i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let o=!1,a=this.driver.getParentElement(t);for(;a;){let l=r.get(a);if(l){let u=i.indexOf(l);i.splice(u+1,0,e),o=!0;break}a=this.driver.getParentElement(a)}o||i.unshift(e)}else i.push(e);return r.set(t,e),e}register(e,t){let i=this._namespaceLookup[e];return i||(i=this.createNamespace(e,t)),i}registerTrigger(e,t,i){let r=this._namespaceLookup[e];r&&r.register(t,i)&&this.totalAnimations++}destroy(e,t){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let i=this._fetchNamespace(e);this.namespacesByHostElement.delete(i.hostElement);let r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1),i.destroy(t),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let t=new Set,i=this.statesByElement.get(e);if(i){for(let r of i.values())if(r.namespaceId){let s=this._fetchNamespace(r.namespaceId);s&&t.add(s)}}return t}trigger(e,t,i,r){if(ry(t)){let s=this._fetchNamespace(e);if(s)return s.trigger(t,i,r),!0}return!1}insertNode(e,t,i,r){if(!ry(t))return;let s=t[is];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;let o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){let o=this._fetchNamespace(e);o&&o.insertNode(t,i)}r&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),kr(e,eI)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),rd(e,eI))}removeNode(e,t,i){if(ry(t)){let r=e?this._fetchNamespace(e):null;r?r.removeNode(t,i):this.markElementAsRemoved(e,t,!1,i);let s=this.namespacesByHostElement.get(t);s&&s.id!==e&&s.removeNode(t,i)}else this._onRemovalComplete(t,i)}markElementAsRemoved(e,t,i,r,s){this.collectedLeaveElements.push(t),t[is]={namespaceId:e,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(e,t,i,r,s){return ry(t)?this._fetchNamespace(e).listen(t,i,r,s):()=>{}}_buildInstruction(e,t,i,r,s){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,i,r,e.fromState.options,e.toState.options,t,s)}destroyInnerAnimations(e){let t=this.driver.query(e,oy,!0);t.forEach(i=>this.destroyActiveAnimationsForElement(i)),this.playersByQueriedElement.size!=0&&(t=this.driver.query(e,rI,!0),t.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(e){let t=this.playersByElement.get(e);t&&t.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(e){let t=this.playersByQueriedElement.get(e);t&&t.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Ha(this.players).onDone(()=>e());e()})}processLeaveNode(e){let t=e[is];if(t&&t.setForRemoval){if(e[is]=VO,t.namespaceId){this.destroyInnerAnimations(e);let i=this._fetchNamespace(t.namespaceId);i&&i.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(eI)&&this.markElementAsDisabled(e,!1),this.driver.query(e,B7,!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++){let r=this.collectedEnterElements[i];kr(r,U7)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let i=[];try{t=this._flushAnimations(i,e)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++){let r=this.collectedLeaveElements[i];this.processLeaveNode(r)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){let i=this._whenQuietFns;this._whenQuietFns=[],t.length?Ha(t).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(e){throw s7(e)}_flushAnimations(e,t){let i=new Vf,r=[],s=new Map,o=[],a=new Map,l=new Map,u=new Map,d=new Set;this.disabledNodes.forEach(q=>{d.add(q);let te=this.driver.query(q,V7,!0);for(let K=0;K<te.length;K++)d.add(te[K])});let f=this.bodyNode,m=Array.from(this.statesByElement.keys()),y=CO(m,this.collectedEnterElements),v=new Map,E=0;y.forEach((q,te)=>{let K=MO+E++;v.set(te,K),q.forEach(ne=>kr(ne,K))});let T=[],C=new Set,D=new Set;for(let q=0;q<this.collectedLeaveElements.length;q++){let te=this.collectedLeaveElements[q],K=te[is];K&&K.setForRemoval&&(T.push(te),C.add(te),K.hasAnimation?this.driver.query(te,$7,!0).forEach(ne=>C.add(ne)):D.add(te))}let P=new Map,V=CO(m,Array.from(C));V.forEach((q,te)=>{let K=iI+E++;P.set(te,K),q.forEach(ne=>kr(ne,K))}),e.push(()=>{y.forEach((q,te)=>{let K=v.get(te);q.forEach(ne=>rd(ne,K))}),V.forEach((q,te)=>{let K=P.get(te);q.forEach(ne=>rd(ne,K))}),T.forEach(q=>{this.processLeaveNode(q)})});let G=[],H=[];for(let q=this._namespaceList.length-1;q>=0;q--)this._namespaceList[q].drainQueuedTransitions(t).forEach(K=>{let ne=K.player,Ee=K.element;if(G.push(ne),this.collectedEnterElements.length){let et=Ee[is];if(et&&et.setForMove){if(et.previousTriggersValues&&et.previousTriggersValues.has(K.triggerName)){let Lt=et.previousTriggersValues.get(K.triggerName),Ot=this.statesByElement.get(K.element);if(Ot&&Ot.has(K.triggerName)){let Xt=Ot.get(K.triggerName);Xt.value=Lt,Ot.set(K.triggerName,Xt)}}ne.destroy();return}}let oe=!f||!this.driver.containsElement(f,Ee),ie=P.get(Ee),fe=v.get(Ee),me=this._buildInstruction(K,i,fe,ie,oe);if(me.errors&&me.errors.length){H.push(me);return}if(oe){ne.onStart(()=>uc(Ee,me.fromStyles)),ne.onDestroy(()=>Ns(Ee,me.toStyles)),r.push(ne);return}if(K.isFallbackTransition){ne.onStart(()=>uc(Ee,me.fromStyles)),ne.onDestroy(()=>Ns(Ee,me.toStyles)),r.push(ne);return}let Fe=[];me.timelines.forEach(et=>{et.stretchStartingKeyframe=!0,this.disabledNodes.has(et.element)||Fe.push(et)}),me.timelines=Fe,i.append(Ee,me.timelines);let Ge={instruction:me,player:ne,element:Ee};o.push(Ge),me.queriedElements.forEach(et=>ur(a,et,[]).push(ne)),me.preStyleProps.forEach((et,Lt)=>{if(et.size){let Ot=l.get(Lt);Ot||l.set(Lt,Ot=new Set),et.forEach((Xt,Sn)=>Ot.add(Sn))}}),me.postStyleProps.forEach((et,Lt)=>{let Ot=u.get(Lt);Ot||u.set(Lt,Ot=new Set),et.forEach((Xt,Sn)=>Ot.add(Sn))})});if(H.length){let q=[];H.forEach(te=>{q.push(o7(te.triggerName,te.errors))}),G.forEach(te=>te.destroy()),this.reportError(q)}let A=new Map,x=new Map;o.forEach(q=>{let te=q.element;i.has(te)&&(x.set(te,te),this._beforeAnimationBuild(q.player.namespaceId,q.instruction,A))}),r.forEach(q=>{let te=q.element;this._getPreviousPlayers(te,!1,q.namespaceId,q.triggerName,null).forEach(ne=>{ur(A,te,[]).push(ne),ne.destroy()})});let R=T.filter(q=>xO(q,l,u)),M=new Map;SO(M,this.driver,D,u,Ls).forEach(q=>{xO(q,l,u)&&R.push(q)});let j=new Map;y.forEach((q,te)=>{SO(j,this.driver,new Set(q),l,ey)}),R.forEach(q=>{let te=M.get(q),K=j.get(q);M.set(q,new Map([...te?.entries()??[],...K?.entries()??[]]))});let B=[],ge=[],we={};o.forEach(q=>{let{element:te,player:K,instruction:ne}=q;if(i.has(te)){if(d.has(te)){K.onDestroy(()=>Ns(te,ne.toStyles)),K.disabled=!0,K.overrideTotalTime(ne.totalTime),r.push(K);return}let Ee=we;if(x.size>1){let ie=te,fe=[];for(;ie=ie.parentNode;){let me=x.get(ie);if(me){Ee=me;break}fe.push(ie)}fe.forEach(me=>x.set(me,Ee))}let oe=this._buildAnimation(K.namespaceId,ne,A,s,j,M);if(K.setRealPlayer(oe),Ee===we)B.push(K);else{let ie=this.playersByElement.get(Ee);ie&&ie.length&&(K.parentPlayer=Ha(ie)),r.push(K)}}else uc(te,ne.fromStyles),K.onDestroy(()=>Ns(te,ne.toStyles)),ge.push(K),d.has(te)&&r.push(K)}),ge.forEach(q=>{let te=s.get(q.element);if(te&&te.length){let K=Ha(te);q.setRealPlayer(K)}}),r.forEach(q=>{q.parentPlayer?q.syncPlayerEvents(q.parentPlayer):q.destroy()});for(let q=0;q<T.length;q++){let te=T[q],K=te[is];if(rd(te,iI),K&&K.hasAnimation)continue;let ne=[];if(a.size){let oe=a.get(te);oe&&oe.length&&ne.push(...oe);let ie=this.driver.query(te,rI,!0);for(let fe=0;fe<ie.length;fe++){let me=a.get(ie[fe]);me&&me.length&&ne.push(...me)}}let Ee=ne.filter(oe=>!oe.destroyed);Ee.length?W7(this,te,Ee):this.processLeaveNode(te)}return T.length=0,B.forEach(q=>{this.players.push(q),q.onDone(()=>{q.destroy();let te=this.players.indexOf(q);this.players.splice(te,1)}),q.play()}),B}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,i,r,s){let o=[];if(t){let a=this.playersByQueriedElement.get(e);a&&(o=a)}else{let a=this.playersByElement.get(e);if(a){let l=!s||s==Nf;a.forEach(u=>{u.queued||!l&&u.triggerName!=r||o.push(u)})}}return(i||r)&&(o=o.filter(a=>!(i&&i!=a.namespaceId||r&&r!=a.triggerName))),o}_beforeAnimationBuild(e,t,i){let r=t.triggerName,s=t.element,o=t.isRemovalTransition?void 0:e,a=t.isRemovalTransition?void 0:r;for(let l of t.timelines){let u=l.element,d=u!==s,f=ur(i,u,[]);this._getPreviousPlayers(u,d,o,a,t.toState).forEach(y=>{let v=y.getRealPlayer();v.beforeDestroy&&v.beforeDestroy(),y.destroy(),f.push(y)})}uc(s,t.fromStyles)}_buildAnimation(e,t,i,r,s,o){let a=t.triggerName,l=t.element,u=[],d=new Set,f=new Set,m=t.timelines.map(v=>{let E=v.element;d.add(E);let T=E[is];if(T&&T.removedBeforeQueried)return new za(v.duration,v.delay);let C=E!==l,D=K7((i.get(E)||j7).map(A=>A.getRealPlayer())).filter(A=>{let x=A;return x.element?x.element===E:!1}),P=s.get(E),V=o.get(E),G=AO(this._normalizer,v.keyframes,P,V),H=this._buildPlayer(v,G,D);if(v.subTimeline&&r&&f.add(E),C){let A=new Uf(e,a,E);A.setRealPlayer(H),u.push(A)}return H});u.forEach(v=>{ur(this.playersByQueriedElement,v.element,[]).push(v),v.onDone(()=>z7(this.playersByQueriedElement,v.element,v))}),d.forEach(v=>kr(v,yO));let y=Ha(m);return y.onDestroy(()=>{d.forEach(v=>rd(v,yO)),Ns(l,t.toStyles)}),f.forEach(v=>{ur(r,v,[]).push(y)}),y}_buildPlayer(e,t,i){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,i):new za(e.duration,e.delay)}},Uf=class{constructor(e,t,i){this.namespaceId=e,this.triggerName=t,this.element=i,this._player=new za,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,i)=>{t.forEach(r=>_I(e,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){ur(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let t=this._player;t.triggerCallback&&t.triggerCallback(e)}};function z7(n,e,t){let i=n.get(e);if(i){if(i.length){let r=i.indexOf(t);i.splice(r,1)}i.length==0&&n.delete(e)}return i}function H7(n){return n??null}function ry(n){return n&&n.nodeType===1}function q7(n){return n=="start"||n=="done"}function IO(n,e){let t=n.style.display;return n.style.display=e??"none",t}function SO(n,e,t,i,r){let s=[];t.forEach(l=>s.push(IO(l)));let o=[];i.forEach((l,u)=>{let d=new Map;l.forEach(f=>{let m=e.computeStyle(u,f,r);d.set(f,m),(!m||m.length==0)&&(u[is]=G7,o.push(u))}),n.set(u,d)});let a=0;return t.forEach(l=>IO(l,s[a++])),o}function CO(n,e){let t=new Map;if(n.forEach(a=>t.set(a,[])),e.length==0)return t;let i=1,r=new Set(e),s=new Map;function o(a){if(!a)return i;let l=s.get(a);if(l)return l;let u=a.parentNode;return t.has(u)?l=u:r.has(u)?l=i:l=o(u),s.set(a,l),l}return e.forEach(a=>{let l=o(a);l!==i&&t.get(l).push(a)}),t}function kr(n,e){n.classList?.add(e)}function rd(n,e){n.classList?.remove(e)}function W7(n,e,t){Ha(t).onDone(()=>n.processLeaveNode(e))}function K7(n){let e=[];return BO(n,e),e}function BO(n,e){for(let t=0;t<n.length;t++){let i=n[t];i instanceof Mf?BO(i.players,e):e.push(i)}}function Y7(n,e){let t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let r=0;r<t.length;r++){let s=t[r];if(!e.hasOwnProperty(s)||n[s]!==e[s])return!1}return!0}function xO(n,e,t){let i=t.get(n);if(!i)return!1;let r=e.get(n);return r?i.forEach(s=>r.add(s)):e.set(n,i),t.delete(n),!0}var sd=class{constructor(e,t,i){this._driver=t,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new gI(e.body,t,i),this._timelineEngine=new pI(e.body,t,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(e,t,i,r,s){let o=e+"-"+r,a=this._triggerCache[o];if(!a){let l=[],u=[],d=OO(this._driver,s,l,u);if(l.length)throw Y9(r,l);u.length&&void 0,a=O7(r,d,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(t,r,a)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,i,r){this._transitionEngine.insertNode(e,t,i,r)}onRemove(e,t,i){this._transitionEngine.removeNode(e,t,i)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,i,r){if(i.charAt(0)=="@"){let[s,o]=mO(i),a=r;this._timelineEngine.command(s,t,o,a)}else this._transitionEngine.trigger(e,t,i,r)}listen(e,t,i,r,s){if(i.charAt(0)=="@"){let[o,a]=mO(i);return this._timelineEngine.listen(o,t,a,s)}return this._transitionEngine.listen(e,t,i,r,s)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}};function Q7(n,e){let t=null,i=null;return Array.isArray(e)&&e.length?(t=nI(e[0]),e.length>1&&(i=nI(e[e.length-1]))):e instanceof Map&&(t=nI(e)),t||i?new yI(n,t,i):null}var yI=class n{static{this.initialStylesByElement=new WeakMap}constructor(e,t,i){this._element=e,this._startStyles=t,this._endStyles=i,this._state=0;let r=n.initialStylesByElement.get(e);r||n.initialStylesByElement.set(e,r=new Map),this._initialStyles=r}start(){this._state<1&&(this._startStyles&&Ns(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Ns(this._element,this._initialStyles),this._endStyles&&(Ns(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(uc(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(uc(this._element,this._endStyles),this._endStyles=null),Ns(this._element,this._initialStyles),this._state=3)}};function nI(n){let e=null;return n.forEach((t,i)=>{Z7(i)&&(e=e||new Map,e.set(i,t))}),e}function Z7(n){return n==="display"||n==="position"}var fy=class{constructor(e,t,i,r){this.element=e,this.keyframes=t,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map;let t=()=>this._onFinish();this.domPlayer.addEventListener("finish",t),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",t)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){let t=[];return e.forEach(i=>{t.push(Object.fromEntries(i))}),t}_triggerWebAnimation(e,t,i){return e.animate(this._convertKeyframesToObject(t),i)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{r!=="offset"&&e.set(r,this._finished?i:II(this.element,r))}),this.currentSnapshot=e}triggerCallback(e){let t=e==="start"?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}},py=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}containsElement(e,t){return DO(e,t)}getParentElement(e){return TI(e)}query(e,t,i){return PO(e,t,i)}computeStyle(e,t,i){return II(e,t)}animate(e,t,i,r,s,o=[]){let a=r==0?"both":"forwards",l={duration:i,delay:r,fill:a};s&&(l.easing=s);let u=new Map,d=o.filter(y=>y instanceof fy);y7(i,r)&&d.forEach(y=>{y.currentSnapshot.forEach((v,E)=>u.set(E,v))});let f=p7(t).map(y=>new Map(y));f=v7(e,f,u);let m=Q7(e,f);return new fy(e,f,l,m)}};var sy="@",UO="@.disabled",my=class{constructor(e,t,i,r){this.namespaceId=e,this.delegate=t,this.engine=i,this._onDestroy=r,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,i,r=!0){this.delegate.insertBefore(e,t,i),this.engine.onInsert(this.namespaceId,t,e,r)}removeChild(e,t,i){this.parentNode(t)&&this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,i,r){this.delegate.setAttribute(e,t,i,r)}removeAttribute(e,t,i){this.delegate.removeAttribute(e,t,i)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,i,r){this.delegate.setStyle(e,t,i,r)}removeStyle(e,t,i){this.delegate.removeStyle(e,t,i)}setProperty(e,t,i){t.charAt(0)==sy&&t==UO?this.disableAnimations(e,!!i):this.delegate.setProperty(e,t,i)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,i){return this.delegate.listen(e,t,i)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}},vI=class extends my{constructor(e,t,i,r,s){super(t,i,r,s),this.factory=e,this.namespaceId=t}setProperty(e,t,i){t.charAt(0)==sy?t.charAt(1)=="."&&t==UO?(i=i===void 0?!0:!!i,this.disableAnimations(e,i)):this.engine.process(this.namespaceId,e,t.slice(1),i):this.delegate.setProperty(e,t,i)}listen(e,t,i){if(t.charAt(0)==sy){let r=X7(e),s=t.slice(1),o="";return s.charAt(0)!=sy&&([s,o]=J7(s)),this.engine.listen(this.namespaceId,r,s,o,a=>{let l=a._data||-1;this.factory.scheduleListenerCallback(l,i,a)})}return this.delegate.listen(e,t,i)}};function X7(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}function J7(n){let e=n.indexOf("."),t=n.substring(0,e),i=n.slice(e+1);return[t,i]}var gy=class{constructor(e,t,i){this.delegate=e,this.engine=t,this._zone=i,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,t.onRemovalComplete=(r,s)=>{s?.removeChild(null,r)}}createRenderer(e,t){let i="",r=this.delegate.createRenderer(e,t);if(!e||!t?.data?.animation){let u=this._rendererCache,d=u.get(r);if(!d){let f=()=>u.delete(r);d=new my(i,r,this.engine,f),u.set(r,d)}return d}let s=t.id,o=t.id+"-"+this._currentId;this._currentId++,this.engine.register(o,e);let a=u=>{Array.isArray(u)?u.forEach(a):this.engine.registerTrigger(s,o,e,u.name,u)};return t.data.animation.forEach(a),new vI(this,o,r,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,i){if(e>=0&&e<this._microtaskId){this._zone.run(()=>t(i));return}let r=this._animationCallbacksBuffer;r.length==0&&queueMicrotask(()=>{this._zone.run(()=>{r.forEach(s=>{let[o,a]=s;o(a)}),this._animationCallbacksBuffer=[]})}),r.push([t,i])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var tq=(()=>{class n extends sd{constructor(t,i,r){super(t,i,r)}ngOnDestroy(){this.flush()}static{this.\u0275fac=function(i){return new(i||n)(Me(yn),Me(dc),Me(hc))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})();function nq(){return new ly}function iq(n,e,t){return new gy(n,e,t)}var $O=[{provide:hc,useFactory:nq},{provide:sd,useClass:tq},{provide:xa,useFactory:iq,deps:[M0,sd,Dt]}],rq=[{provide:dc,useFactory:()=>new py},{provide:ww,useValue:"BrowserAnimations"},...$O],vhe=[{provide:dc,useClass:wI},{provide:ww,useValue:"NoopAnimations"},...$O];function jO(){return La("NgEagerAnimations"),[...rq]}var zO=function(n){let e=[],t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},sq=function(n){let e=[],t=0,i=0;for(;t<n.length;){let r=n[t++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=n[t++];e[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){let s=n[t++],o=n[t++],a=n[t++],l=((r&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{let s=n[t++],o=n[t++];e[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|o&63)}}return e.join("")},HO={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){let s=n[r],o=r+1<n.length,a=o?n[r+1]:0,l=r+2<n.length,u=l?n[r+2]:0,d=s>>2,f=(s&3)<<4|a>>4,m=(a&15)<<2|u>>6,y=u&63;l||(y=64,o||(m=64)),i.push(t[d],t[f],t[m],t[y])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(zO(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):sq(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){let s=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;let u=r<n.length?t[n.charAt(r)]:64;++r;let f=r<n.length?t[n.charAt(r)]:64;if(++r,s==null||a==null||u==null||f==null)throw new xI;let m=s<<2|a>>4;if(i.push(m),u!==64){let y=a<<4&240|u>>2;if(i.push(y),f!==64){let v=u<<6&192|f;i.push(v)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},xI=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},oq=function(n){let e=zO(n);return HO.encodeByteArray(e,!0)},$f=function(n){return oq(n).replace(/\./g,"")},DI=function(n){try{return HO.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function aq(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var lq=()=>aq().__FIREBASE_DEFAULTS__,cq=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},uq=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&DI(n[1]);return e&&JSON.parse(e)},vy=()=>{try{return lq()||cq()||uq()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},PI=n=>{var e,t;return(t=(e=vy())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},qO=n=>{let e=PI(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},RI=()=>{var n;return(n=vy())===null||n===void 0?void 0:n.config},MI=n=>{var e;return(e=vy())===null||e===void 0?void 0:e[`_${n}`]};var yy=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}};function WO(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},i=e||"demo-project",r=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[$f(JSON.stringify(t)),$f(JSON.stringify(o)),""].join(".")}function Wn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function KO(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Wn())}function dq(){var n;let e=(n=vy())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function YO(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function QO(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function ZO(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function XO(){let n=Wn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function JO(){return!dq()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function kI(){try{return typeof indexedDB=="object"}catch{return!1}}function eN(){return new Promise((n,e)=>{try{let t=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var s;e(((s=r.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var hq="FirebaseError",dr=class n extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=hq,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Vo.prototype.create)}},Vo=class{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){let i=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],o=s?fq(s,i):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new dr(r,a,i)}};function fq(n,e){return n.replace(pq,(t,i)=>{let r=e[i];return r!=null?String(r):`<${i}?>`})}var pq=/\{\$([^}]+)}/g;function tN(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Bo(n,e){if(n===e)return!0;let t=Object.keys(n),i=Object.keys(e);for(let r of t){if(!i.includes(r))return!1;let s=n[r],o=e[r];if(GO(s)&&GO(o)){if(!Bo(s,o))return!1}else if(s!==o)return!1}for(let r of i)if(!t.includes(r))return!1;return!0}function GO(n){return n!==null&&typeof n=="object"}function od(n){let e=[];for(let[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function nN(n,e){let t=new AI(n,e);return t.subscribe.bind(t)}var AI=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let r;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");mq(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:i},r.next===void 0&&(r.next=CI),r.error===void 0&&(r.error=CI),r.complete===void 0&&(r.complete=CI);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function mq(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function CI(){}var Ehe=4*60*60*1e3;function bn(n){return n&&n._delegate?n._delegate:n}var Lr=class{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var fc="[DEFAULT]";var LI=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let i=new yy;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let i=this.normalizeInstanceIdentifier(e?.identifier),r=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(yq(e))try{this.getOrInitializeService({instanceIdentifier:fc})}catch{}for(let[t,i]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=fc){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return U(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=fc){return this.instances.has(e)}getOptions(e=fc){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:i,options:t});for(let[s,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(s);i===a&&o.resolve(r)}return r}onInit(e,t){var i;let r=this.normalizeInstanceIdentifier(t),s=(i=this.onInitCallbacks.get(r))!==null&&i!==void 0?i:new Set;s.add(e),this.onInitCallbacks.set(r,s);let o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let i=this.onInitCallbacks.get(t);if(i)for(let r of i)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:gq(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=fc){return this.component?this.component.multipleInstances?e:fc:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function gq(n){return n===fc?void 0:n}function yq(n){return n.instantiationMode==="EAGER"}var _y=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new LI(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var vq=[],wt=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(wt||{}),_q={debug:wt.DEBUG,verbose:wt.VERBOSE,info:wt.INFO,warn:wt.WARN,error:wt.ERROR,silent:wt.SILENT},Eq=wt.INFO,Tq={[wt.DEBUG]:"log",[wt.VERBOSE]:"log",[wt.INFO]:"info",[wt.WARN]:"warn",[wt.ERROR]:"error"},wq=(n,e,...t)=>{if(e<n.logLevel)return;let i=new Date().toISOString(),r=Tq[e];if(r)console[r](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},qa=class{constructor(e){this.name=e,this._logLevel=Eq,this._logHandler=wq,this._userLogHandler=null,vq.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in wt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?_q[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,wt.DEBUG,...e),this._logHandler(this,wt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,wt.VERBOSE,...e),this._logHandler(this,wt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,wt.INFO,...e),this._logHandler(this,wt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,wt.WARN,...e),this._logHandler(this,wt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,wt.ERROR,...e),this._logHandler(this,wt.ERROR,...e)}};var bq=(n,e)=>e.some(t=>n instanceof t),iN,rN;function Iq(){return iN||(iN=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Sq(){return rN||(rN=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var sN=new WeakMap,NI=new WeakMap,oN=new WeakMap,OI=new WeakMap,VI=new WeakMap;function Cq(n){let e=new Promise((t,i)=>{let r=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(Fs(n.result)),r()},o=()=>{i(n.error),r()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&sN.set(t,n)}).catch(()=>{}),VI.set(e,n),e}function xq(n){if(NI.has(n))return;let e=new Promise((t,i)=>{let r=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),r()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});NI.set(n,e)}var FI={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return NI.get(n);if(e==="objectStoreNames")return n.objectStoreNames||oN.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Fs(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function aN(n){FI=n(FI)}function Aq(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let i=n.call(Ey(this),e,...t);return oN.set(i,e.sort?e.sort():[e]),Fs(i)}:Sq().includes(n)?function(...e){return n.apply(Ey(this),e),Fs(sN.get(this))}:function(...e){return Fs(n.apply(Ey(this),e))}}function Dq(n){return typeof n=="function"?Aq(n):(n instanceof IDBTransaction&&xq(n),bq(n,Iq())?new Proxy(n,FI):n)}function Fs(n){if(n instanceof IDBRequest)return Cq(n);if(OI.has(n))return OI.get(n);let e=Dq(n);return e!==n&&(OI.set(n,e),VI.set(e,n)),e}var Ey=n=>VI.get(n);function cN(n,e,{blocked:t,upgrade:i,blocking:r,terminated:s}={}){let o=indexedDB.open(n,e),a=Fs(o);return i&&o.addEventListener("upgradeneeded",l=>{i(Fs(o.result),l.oldVersion,l.newVersion,Fs(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),r&&l.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}var Pq=["get","getKey","getAll","getAllKeys","count"],Rq=["put","add","delete","clear"],BI=new Map;function lN(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(BI.get(e))return BI.get(e);let t=e.replace(/FromIndex$/,""),i=e!==t,r=Rq.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(r||Pq.includes(t)))return;let s=function(o,...a){return U(this,null,function*(){let l=this.transaction(o,r?"readwrite":"readonly"),u=l.store;return i&&(u=u.index(a.shift())),(yield Promise.all([u[t](...a),r&&l.done]))[0]})};return BI.set(e,s),s}aN(n=>qe(de({},n),{get:(e,t,i)=>lN(e,t)||n.get(e,t,i),has:(e,t)=>!!lN(e,t)||n.has(e,t)}));var $I=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Mq(t)){let i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}};function Mq(n){let e=n.getComponent();return e?.type==="VERSION"}var jI="@firebase/app",uN="0.10.13";var Uo=new qa("@firebase/app"),kq="@firebase/app-compat",Lq="@firebase/analytics-compat",Oq="@firebase/analytics",Nq="@firebase/app-check-compat",Fq="@firebase/app-check",Vq="@firebase/auth",Bq="@firebase/auth-compat",Uq="@firebase/database",$q="@firebase/data-connect",jq="@firebase/database-compat",Gq="@firebase/functions",zq="@firebase/functions-compat",Hq="@firebase/installations",qq="@firebase/installations-compat",Wq="@firebase/messaging",Kq="@firebase/messaging-compat",Yq="@firebase/performance",Qq="@firebase/performance-compat",Zq="@firebase/remote-config",Xq="@firebase/remote-config-compat",Jq="@firebase/storage",eW="@firebase/storage-compat",tW="@firebase/firestore",nW="@firebase/vertexai-preview",iW="@firebase/firestore-compat",rW="firebase",sW="10.14.1";var GI="[DEFAULT]",oW={[jI]:"fire-core",[kq]:"fire-core-compat",[Oq]:"fire-analytics",[Lq]:"fire-analytics-compat",[Fq]:"fire-app-check",[Nq]:"fire-app-check-compat",[Vq]:"fire-auth",[Bq]:"fire-auth-compat",[Uq]:"fire-rtdb",[$q]:"fire-data-connect",[jq]:"fire-rtdb-compat",[Gq]:"fire-fn",[zq]:"fire-fn-compat",[Hq]:"fire-iid",[qq]:"fire-iid-compat",[Wq]:"fire-fcm",[Kq]:"fire-fcm-compat",[Yq]:"fire-perf",[Qq]:"fire-perf-compat",[Zq]:"fire-rc",[Xq]:"fire-rc-compat",[Jq]:"fire-gcs",[eW]:"fire-gcs-compat",[tW]:"fire-fst",[iW]:"fire-fst-compat",[nW]:"fire-vertex","fire-js":"fire-js",[rW]:"fire-js-all"};var jf=new Map,aW=new Map,zI=new Map;function dN(n,e){try{n.container.addComponent(e)}catch(t){Uo.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ka(n){let e=n.name;if(zI.has(e))return Uo.debug(`There were multiple attempts to register component ${e}.`),!1;zI.set(e,n);for(let t of jf.values())dN(t,n);for(let t of aW.values())dN(t,n);return!0}function zf(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Vs(n){return n.settings!==void 0}var lW={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Wa=new Vo("app","Firebase",lW);var HI=class{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Lr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Wa.create("app-deleted",{appName:this._name})}};var Ya=sW;function KI(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let i=Object.assign({name:GI,automaticDataCollectionEnabled:!1},e),r=i.name;if(typeof r!="string"||!r)throw Wa.create("bad-app-name",{appName:String(r)});if(t||(t=RI()),!t)throw Wa.create("no-options");let s=jf.get(r);if(s){if(Bo(t,s.options)&&Bo(i,s.config))return s;throw Wa.create("duplicate-app",{appName:r})}let o=new _y(r);for(let l of zI.values())o.addComponent(l);let a=new HI(t,i,o);return jf.set(r,a),a}function ad(n=GI){let e=jf.get(n);if(!e&&n===GI&&RI())return KI();if(!e)throw Wa.create("no-app",{appName:n});return e}function Ty(){return Array.from(jf.values())}function Bn(n,e,t){var i;let r=(i=oW[n])!==null&&i!==void 0?i:n;t&&(r+=`-${t}`);let s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Uo.warn(a.join(" "));return}Ka(new Lr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}var cW="firebase-heartbeat-database",uW=1,Gf="firebase-heartbeat-store",UI=null;function mN(){return UI||(UI=cN(cW,uW,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Gf)}catch(t){console.warn(t)}}}}).catch(n=>{throw Wa.create("idb-open",{originalErrorMessage:n.message})})),UI}function dW(n){return U(this,null,function*(){try{let t=(yield mN()).transaction(Gf),i=yield t.objectStore(Gf).get(gN(n));return yield t.done,i}catch(e){if(e instanceof dr)Uo.warn(e.message);else{let t=Wa.create("idb-get",{originalErrorMessage:e?.message});Uo.warn(t.message)}}})}function hN(n,e){return U(this,null,function*(){try{let i=(yield mN()).transaction(Gf,"readwrite");yield i.objectStore(Gf).put(e,gN(n)),yield i.done}catch(t){if(t instanceof dr)Uo.warn(t.message);else{let i=Wa.create("idb-set",{originalErrorMessage:t?.message});Uo.warn(i.message)}}})}function gN(n){return`${n.name}!${n.options.appId}`}var hW=1024,fW=30*24*60*60*1e3,qI=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new WI(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}triggerHeartbeat(){return U(this,null,function*(){var e,t;try{let r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=fN();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{let a=new Date(o.date).valueOf();return Date.now()-a<=fW}),this._storage.overwrite(this._heartbeatsCache))}catch(i){Uo.warn(i)}})}getHeartbeatsHeader(){return U(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=fN(),{heartbeatsToSend:i,unsentEntries:r}=pW(this._heartbeatsCache.heartbeats),s=$f(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Uo.warn(t),""}})}};function fN(){return new Date().toISOString().substring(0,10)}function pW(n,e=hW){let t=[],i=n.slice();for(let r of n){let s=t.find(o=>o.agent===r.agent);if(s){if(s.dates.push(r.date),pN(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),pN(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}var WI=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return U(this,null,function*(){return kI()?eN().then(()=>!0).catch(()=>!1):!1})}read(){return U(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield dW(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return U(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let r=yield this.read();return hN(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return U(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let r=yield this.read();return hN(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return})}};function pN(n){return $f(JSON.stringify({version:2,heartbeats:n})).length}function mW(n){Ka(new Lr("platform-logger",e=>new $I(e),"PRIVATE")),Ka(new Lr("heartbeat",e=>new qI(e),"PRIVATE")),Bn(jI,uN,n),Bn(jI,uN,"esm2017"),Bn("fire-js","")}mW("");var gW="firebase",yW="10.14.1";Bn(gW,yW,"app");var mc=new bo("ANGULARFIRE2_VERSION");function by(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Hf=(n,e)=>{let t=e?[e]:Ty(),i=[];return t.forEach(r=>{r.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},cd=class{constructor(){return Hf(vW)}},vW="app-check";function ld(){}var wy=class{zone;delegate;constructor(e,t=kE){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,i){let r=this.zone,s=function(o){r.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,i)}},YI=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let i=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ld,{},ld,ld)),t.pipe(Pn({next:i,complete:i,error:i})).subscribe(e).add(i)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},ud=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new wy(Zone.current)),this.insideAngular=t.run(()=>new wy(Zone.current,ME)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(i){return new(i||n)(Me(Dt))};static \u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Iy(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function _W(n){return Iy().ngZone.runOutsideAngular(()=>n())}function pc(n){return Iy().ngZone.run(()=>n())}function EW(n){return TW(Iy())(n)}function TW(n){return function(t){return t=t.lift(new YI(n.ngZone)),t.pipe(ya(n.outsideAngular),ga(n.insideAngular))}}var wW=(n,e)=>function(){let i=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),pc(()=>n.apply(void 0,i))},sn=(n,e)=>function(){let t,i=arguments;for(let s=0;s<arguments.length;s++)typeof i[s]=="function"&&(e&&(t||=pc(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ld,{},ld,ld))),i[s]=wW(i[s],t));let r=_W(()=>n.apply(this,i));if(!e)if(r instanceof rt){let s=Iy();return r.pipe(ya(s.outsideAngular),ga(s.insideAngular))}else return pc(()=>r);return r instanceof rt?r.pipe(EW):r instanceof Promise?pc(()=>new Promise((s,o)=>r.then(a=>pc(()=>s(a)),a=>pc(()=>o(a))))):typeof r=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),r.apply(this,arguments)}:pc(()=>r)};var $o=class{constructor(e){return e}},gc=class{constructor(){return Ty()}};function bW(n){return n&&n.length===1?n[0]:new $o(ad())}var QI=new Pe("angularfire2._apps"),IW={provide:$o,useFactory:bW,deps:[[new li,QI]]},SW={provide:gc,deps:[[new li,QI]]};function CW(n){return(e,t)=>{let i=t.get(Bi);Bn("angularfire",mc.full,"core"),Bn("angularfire",mc.full,"app"),Bn("angular",Ak.full,i.toString());let r=e.runOutsideAngular(()=>n(t));return new $o(r)}}function yN(n,...e){return Qr([IW,SW,{provide:QI,useFactory:CW(n),multi:!0,deps:[Dt,ti,ud,...e]}])}var vN=sn(KI,!0);function LN(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var ON=LN,NN=new Vo("auth","Firebase",LN());var Py=new qa("@firebase/auth");function xW(n,...e){Py.logLevel<=wt.WARN&&Py.warn(`Auth (${Ya}): ${n}`,...e)}function Cy(n,...e){Py.logLevel<=wt.ERROR&&Py.error(`Auth (${Ya}): ${n}`,...e)}function Xa(n,...e){throw wS(n,...e)}function Bs(n,...e){return wS(n,...e)}function FN(n,e,t){let i=Object.assign(Object.assign({},ON()),{[e]:t});return new Vo("auth","Firebase",i).create(e,{appName:n.name})}function Za(n){return FN(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function wS(n,...e){if(typeof n!="string"){let t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return NN.create(n,...e)}function Oe(n,e,...t){if(!n)throw wS(e,...t)}function jo(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Cy(e),new Error(e)}function Ja(n,e){n||jo(e)}function tS(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function VN(){return _N()==="http:"||_N()==="https:"}function _N(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function AW(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(VN()||QO()||"connection"in navigator)?navigator.onLine:!0}function DW(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var yc=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ja(t>e,"Short delay should be less than long delay!"),this.isMobile=KO()||ZO()}get(){return AW()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function bS(n,e){Ja(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Ry=class{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;jo("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;jo("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;jo("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var PW={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var RW=new yc(3e4,6e4);function zo(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function Us(s,o,a,l){return U(this,arguments,function*(n,e,t,i,r={}){return BN(n,r,()=>U(this,null,function*(){let u={},d={};i&&(e==="GET"?d=i:u={body:JSON.stringify(i)});let f=od(Object.assign({key:n.config.apiKey},d)).slice(1),m=yield n._getAdditionalHeaders();m["Content-Type"]="application/json",n.languageCode&&(m["X-Firebase-Locale"]=n.languageCode);let y=Object.assign({method:e,headers:m},u);return YO()||(y.referrerPolicy="no-referrer"),Ry.fetch()(UN(n,n.config.apiHost,t,f),y)}))})}function BN(n,e,t){return U(this,null,function*(){n._canInitEmulator=!1;let i=Object.assign(Object.assign({},PW),e);try{let r=new nS(n),s=yield Promise.race([t(),r.promise]);r.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw qf(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let a=s.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw qf(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw qf(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw qf(n,"user-disabled",o);let d=i[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw FN(n,d,u);Xa(n,d)}}catch(r){if(r instanceof dr)throw r;Xa(n,"network-request-failed",{message:String(r)})}})}function $y(s,o,a,l){return U(this,arguments,function*(n,e,t,i,r={}){let u=yield Us(n,e,t,i,r);return"mfaPendingCredential"in u&&Xa(n,"multi-factor-auth-required",{_serverResponse:u}),u})}function UN(n,e,t,i){let r=`${e}${t}?${i}`;return n.config.emulator?bS(n.config,r):`${n.config.apiScheme}://${r}`}var nS=class{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Bs(this.auth,"network-request-failed")),RW.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}};function qf(n,e,t){let i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);let r=Bs(n,e,i);return r.customData._tokenResponse=t,r}function EN(n){return n!==void 0&&n.getResponse!==void 0}function MW(n){return U(this,null,function*(){return(yield Us(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})}function kW(n,e){return U(this,null,function*(){return Us(n,"POST","/v1/accounts:delete",e)})}function $N(n,e){return U(this,null,function*(){return Us(n,"POST","/v1/accounts:lookup",e)})}function Wf(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function IS(n,e=!1){return U(this,null,function*(){let t=bn(n),i=yield t.getIdToken(e),r=SS(i);Oe(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");let s=typeof r.firebase=="object"?r.firebase:void 0,o=s?.sign_in_provider;return{claims:r,token:i,authTime:Wf(ZI(r.auth_time)),issuedAtTime:Wf(ZI(r.iat)),expirationTime:Wf(ZI(r.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function ZI(n){return Number(n)*1e3}function SS(n){let[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return Cy("JWT malformed, contained fewer than 3 sections"),null;try{let r=DI(t);return r?JSON.parse(r):(Cy("Failed to decode base64 JWT payload"),null)}catch(r){return Cy("Caught error parsing JWT payload as JSON",r?.toString()),null}}function TN(n){let e=SS(n);return Oe(e,"internal-error"),Oe(typeof e.exp<"u","internal-error"),Oe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Yf(n,e,t=!1){return U(this,null,function*(){if(t)return e;try{return yield e}catch(i){throw i instanceof dr&&LW(i)&&n.auth.currentUser===n&&(yield n.auth.signOut()),i}})}function LW({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var iS=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;let r=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>U(this,null,function*(){yield this.iteration()}),t)}iteration(){return U(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var Qf=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Wf(this.lastLoginAt),this.creationTime=Wf(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function My(n){return U(this,null,function*(){var e;let t=n.auth,i=yield n.getIdToken(),r=yield Yf(n,$N(t,{idToken:i}));Oe(r?.users.length,t,"internal-error");let s=r.users[0];n._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?jN(s.providerUserInfo):[],a=OW(n.providerData,o),l=n.isAnonymous,u=!(n.email&&s.passwordHash)&&!a?.length,d=l?u:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Qf(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,f)})}function CS(n){return U(this,null,function*(){let e=bn(n);yield My(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function OW(n,e){return[...n.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}function jN(n){return n.map(e=>{var{providerId:t}=e,i=LE(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}function NW(n,e){return U(this,null,function*(){let t=yield BN(n,{},()=>U(this,null,function*(){let i=od({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,o=UN(n,r,"/v1/token",`key=${s}`),a=yield n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Ry.fetch()(o,{method:"POST",headers:a,body:i})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function FW(n,e){return U(this,null,function*(){return Us(n,"POST","/v2/accounts:revokeToken",zo(n,e))})}var Kf=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Oe(e.idToken,"internal-error"),Oe(typeof e.idToken<"u","internal-error"),Oe(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):TN(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Oe(e.length!==0,"internal-error");let t=TN(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return U(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Oe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return U(this,null,function*(){let{accessToken:i,refreshToken:r,expiresIn:s}=yield NW(e,t);this.updateTokensAndExpiration(i,r,Number(s))})}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){let{refreshToken:i,accessToken:r,expirationTime:s}=t,o=new n;return i&&(Oe(typeof i=="string","internal-error",{appName:e}),o.refreshToken=i),r&&(Oe(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),s&&(Oe(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return jo("not implemented")}};function Qa(n,e){Oe(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var dd=class n{constructor(e){var{uid:t,auth:i,stsTokenManager:r}=e,s=LE(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new iS(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Qf(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return U(this,null,function*(){let t=yield Yf(this,this.stsTokenManager.getToken(this.auth,e));return Oe(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return IS(this,e)}reload(){return CS(this)}_assign(e){this!==e&&(Oe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Oe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return U(this,null,function*(){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&(yield My(this)),yield this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)})}delete(){return U(this,null,function*(){if(Vs(this.auth.app))return Promise.reject(Za(this.auth));let e=yield this.getIdToken();return yield Yf(this,kW(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,r,s,o,a,l,u,d;let f=(i=t.displayName)!==null&&i!==void 0?i:void 0,m=(r=t.email)!==null&&r!==void 0?r:void 0,y=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,v=(o=t.photoURL)!==null&&o!==void 0?o:void 0,E=(a=t.tenantId)!==null&&a!==void 0?a:void 0,T=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,C=(u=t.createdAt)!==null&&u!==void 0?u:void 0,D=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:P,emailVerified:V,isAnonymous:G,providerData:H,stsTokenManager:A}=t;Oe(P&&A,e,"internal-error");let x=Kf.fromJSON(this.name,A);Oe(typeof P=="string",e,"internal-error"),Qa(f,e.name),Qa(m,e.name),Oe(typeof V=="boolean",e,"internal-error"),Oe(typeof G=="boolean",e,"internal-error"),Qa(y,e.name),Qa(v,e.name),Qa(E,e.name),Qa(T,e.name),Qa(C,e.name),Qa(D,e.name);let R=new n({uid:P,auth:e,email:m,emailVerified:V,displayName:f,isAnonymous:G,photoURL:v,phoneNumber:y,tenantId:E,stsTokenManager:x,createdAt:C,lastLoginAt:D});return H&&Array.isArray(H)&&(R.providerData=H.map(M=>Object.assign({},M))),T&&(R._redirectEventId=T),R}static _fromIdTokenResponse(e,t,i=!1){return U(this,null,function*(){let r=new Kf;r.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:i});return yield My(s),s})}static _fromGetAccountInfoResponse(e,t,i){return U(this,null,function*(){let r=t.users[0];Oe(r.localId!==void 0,"internal-error");let s=r.providerUserInfo!==void 0?jN(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!s?.length,a=new Kf;a.updateFromIdToken(i);let l=new n({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new Qf(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!s?.length};return Object.assign(l,u),l})}};var wN=new Map;function Go(n){Ja(n instanceof Function,"Expected a class definition");let e=wN.get(n);return e?(Ja(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,wN.set(n,e),e)}var VW=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return U(this,null,function*(){return!0})}_set(t,i){return U(this,null,function*(){this.storage[t]=i})}_get(t){return U(this,null,function*(){let i=this.storage[t];return i===void 0?null:i})}_remove(t){return U(this,null,function*(){delete this.storage[t]})}_addListener(t,i){}_removeListener(t,i){}}return n.type="NONE",n})(),rS=VW;function xy(n,e,t){return`firebase:${n}:${e}:${t}`}var ky=class n{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;let{config:r,name:s}=this.auth;this.fullUserKey=xy(this.userKey,r.apiKey,s),this.fullPersistenceKey=xy("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return U(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);return e?dd._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return U(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,i="authUser"){return U(this,null,function*(){if(!t.length)return new n(Go(rS),e,i);let r=(yield Promise.all(t.map(u=>U(this,null,function*(){if(yield u._isAvailable())return u})))).filter(u=>u),s=r[0]||Go(rS),o=xy(i,e.config.apiKey,e.name),a=null;for(let u of t)try{let d=yield u._get(o);if(d){let f=dd._fromJSON(e,d);u!==s&&(a=f),s=u;break}}catch{}let l=r.filter(u=>u._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new n(s,e,i):(s=l[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(t.map(u=>U(this,null,function*(){if(u!==s)try{yield u._remove(o)}catch{}}))),new n(s,e,i))})}};function bN(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(qN(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(GN(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(KN(e))return"Blackberry";if(YN(e))return"Webos";if(zN(e))return"Safari";if((e.includes("chrome/")||HN(e))&&!e.includes("edge/"))return"Chrome";if(WN(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if(i?.length===2)return i[1]}return"Other"}function GN(n=Wn()){return/firefox\//i.test(n)}function zN(n=Wn()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function HN(n=Wn()){return/crios\//i.test(n)}function qN(n=Wn()){return/iemobile/i.test(n)}function WN(n=Wn()){return/android/i.test(n)}function KN(n=Wn()){return/blackberry/i.test(n)}function YN(n=Wn()){return/webos/i.test(n)}function xS(n=Wn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function BW(n=Wn()){var e;return xS(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function UW(){return XO()&&document.documentMode===10}function QN(n=Wn()){return xS(n)||WN(n)||YN(n)||KN(n)||/windows phone/i.test(n)||qN(n)}function ZN(n,e=[]){let t;switch(n){case"Browser":t=bN(Wn());break;case"Worker":t=`${bN(Wn())}-${n}`;break;default:t=n}let i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ya}/${i}`}var sS=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let i=s=>new Promise((o,a)=>{try{let l=e(s);o(l)}catch(l){a(l)}});i.onAbort=t,this.queue.push(i);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}runMiddleware(e){return U(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let i of this.queue)yield i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(let r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}})}};function $W(t){return U(this,arguments,function*(n,e={}){return Us(n,"GET","/v2/passwordPolicy",zo(n,e))})}var jW=6,oS=class{constructor(e){var t,i,r,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:jW,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(r=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&r!==void 0?r:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,r,s,o,a;let l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(i=l.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(r=l.containsLowercaseLetter)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsUppercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){let i=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let r=0;r<e.length;r++)i=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var aS=class{constructor(e,t,i,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ly(this),this.idTokenSubscription=new Ly(this),this.beforeStateQueue=new sS(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=NN,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Go(t)),this._initializationPromise=this.queue(()=>U(this,null,function*(){var i,r;if(!this._deleted&&(this.persistenceManager=yield ky.create(this,e),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return U(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return U(this,null,function*(){try{let t=yield $N(this,{idToken:e}),i=yield dd._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return U(this,null,function*(){var t;if(Vs(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let i=yield this.assertedPersistence.getCurrentUser(),r=i,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=r?._redirectEventId,l=yield this.tryRedirectSignIn(e);(!o||o===a)&&l?.user&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(r)}catch(o){r=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Oe(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(e){return U(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return U(this,null,function*(){try{yield My(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=DW()}_delete(){return U(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return U(this,null,function*(){if(Vs(this.app))return Promise.reject(Za(this));let t=e?bn(e):null;return t&&Oe(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return U(this,null,function*(){if(!this._deleted)return e&&Oe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>U(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return U(this,null,function*(){return Vs(this.app)?Promise.reject(Za(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Vs(this.app)?Promise.reject(Za(this)):this.queue(()=>U(this,null,function*(){yield this.assertedPersistence.setPersistence(Go(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return U(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return U(this,null,function*(){let e=yield $W(this),t=new oS(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Vo("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let i=this.onAuthStateChanged(()=>{i(),e()},t)}})}revokeAccessToken(e){return U(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),yield FW(this,i)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return U(this,null,function*(){let i=yield this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return U(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&Go(e)||this._popupRedirectResolver;Oe(t,this,"argument-error"),this.redirectPersistenceManager=yield ky.create(this,[Go(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return U(this,null,function*(){var t,i;return this._isInitialized&&(yield this.queue(()=>U(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return U(this,null,function*(){if(e===this.currentUser)return this.queue(()=>U(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,r){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Oe(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let l=e.addObserver(t,i,r);return()=>{o=!0,l()}}else{let l=e.addObserver(t);return()=>{o=!0,l()}}}directlySetCurrentUser(e){return U(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Oe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ZN(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return U(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let i=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();i&&(t["X-Firebase-Client"]=i);let r=yield this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t})}_getAppCheckToken(){return U(this,null,function*(){var e;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&xW(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function hd(n){return bn(n)}var Ly=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=nN(t=>this.observer=t)}get next(){return Oe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var jy={loadJS(){return U(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function GW(n){jy=n}function XN(n){return jy.loadJS(n)}function zW(){return jy.recaptchaV2Script}function HW(){return jy.gapiScript}function JN(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function AS(n,e){let t=zf(n,"auth");if(t.isInitialized()){let r=t.getImmediate(),s=t.getOptions();if(Bo(s,e??{}))return r;Xa(r,"already-initialized")}return t.initialize({options:e})}function qW(n,e){let t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(Go);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}function DS(n,e,t){let i=hd(n);Oe(i._canInitEmulator,i,"emulator-config-failed"),Oe(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");let r=!!t?.disableWarnings,s=eF(e),{host:o,port:a}=WW(e),l=a===null?"":`:${a}`;i.config.emulator={url:`${s}//${o}${l}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||KW()}function eF(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function WW(n){let e=eF(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let i=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let s=r[1];return{host:s,port:IN(i.substr(s.length+1))}}else{let[s,o]=i.split(":");return{host:s,port:IN(o)}}}function IN(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function KW(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var Zf=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return jo("not implemented")}_getIdTokenResponse(e){return jo("not implemented")}_linkToIdToken(e,t){return jo("not implemented")}_getReauthenticationResolver(e){return jo("not implemented")}};function XI(n,e){return U(this,null,function*(){return $y(n,"POST","/v1/accounts:signInWithIdp",zo(n,e))})}function YW(n,e){return U(this,null,function*(){return Us(n,"POST","/v1/accounts:sendVerificationCode",zo(n,e))})}function QW(n,e){return U(this,null,function*(){return $y(n,"POST","/v1/accounts:signInWithPhoneNumber",zo(n,e))})}function ZW(n,e){return U(this,null,function*(){let t=yield $y(n,"POST","/v1/accounts:signInWithPhoneNumber",zo(n,e));if(t.temporaryProof)throw qf(n,"account-exists-with-different-credential",t);return t})}var XW={USER_NOT_FOUND:"user-not-found"};function JW(n,e){return U(this,null,function*(){let t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return $y(n,"POST","/v1/accounts:signInWithPhoneNumber",zo(n,t),XW)})}var Oy=class n extends Zf{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new n({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new n({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return QW(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return ZW(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return JW(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:i,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:i,code:r}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));let{verificationId:t,verificationCode:i,phoneNumber:r,temporaryProof:s}=e;return!i&&!t&&!r&&!s?null:new n({verificationId:t,verificationCode:i,phoneNumber:r,temporaryProof:s})}};var Ny=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var lS=class extends Ny{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};var Xf=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,i,r=!1){return U(this,null,function*(){let s=yield dd._fromIdTokenResponse(e,i,r),o=SN(i);return new n({user:s,providerId:o,_tokenResponse:i,operationType:t})})}static _forOperation(e,t,i){return U(this,null,function*(){yield e._updateTokensIfNecessary(i,!0);let r=SN(i);return new n({user:e,providerId:r,_tokenResponse:i,operationType:t})})}};function SN(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var cS=class n extends dr{constructor(e,t,i,r){var s;super(t.code,t.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,r){return new n(e,t,i,r)}};function tF(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?cS._fromErrorAndOperation(n,s,e,i):s})}function eK(n,e,t=!1){return U(this,null,function*(){let i=yield Yf(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return Xf._forOperation(n,"link",i)})}function tK(n,e,t=!1){return U(this,null,function*(){let{auth:i}=n;if(Vs(i.app))return Promise.reject(Za(i));let r="reauthenticate";try{let s=yield Yf(n,tF(i,r,e,n),t);Oe(s.idToken,i,"internal-error");let o=SS(s.idToken);Oe(o,i,"internal-error");let{sub:a}=o;return Oe(n.uid===a,i,"user-mismatch"),Xf._forOperation(n,r,s)}catch(s){throw s?.code==="auth/user-not-found"&&Xa(i,"user-mismatch"),s}})}function nF(n,e,t=!1){return U(this,null,function*(){if(Vs(n.app))return Promise.reject(Za(n));let i="signIn",r=yield tF(n,i,e),s=yield Xf._fromIdTokenResponse(n,i,r);return t||(yield n._updateCurrentUser(s.user)),s})}function PS(n,e){return U(this,null,function*(){return nF(hd(n),e)})}function Gy(n,e,t,i){return bn(n).onIdTokenChanged(e,t,i)}function RS(n,e,t){return bn(n).beforeAuthStateChanged(e,t)}function ep(n,e,t,i){return bn(n).onAuthStateChanged(e,t,i)}function nK(n,e){return Us(n,"POST","/v2/accounts/mfaEnrollment:start",zo(n,e))}var Fy="__sak";var Vy=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Fy,"1"),this.storage.removeItem(Fy),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var iK=1e3,rK=10,sK=(()=>{class n extends Vy{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,i)=>this.onStorageEvent(t,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=QN(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let i of Object.keys(this.listeners)){let r=this.storage.getItem(i),s=this.localCache[i];r!==s&&t(i,s,r)}}onStorageEvent(t,i=!1){if(!t.key){this.forAllChangedKeys((a,l,u)=>{this.notifyListeners(a,u)});return}let r=t.key;i?this.detachListener():this.stopPolling();let s=()=>{let a=this.storage.getItem(r);!i&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);UW()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,rK):s()}notifyListeners(t,i){this.localCache[t]=i;let r=this.listeners[t];if(r)for(let s of Array.from(r))s(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,i,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:i,newValue:r}),!0)})},iK)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,i){return U(this,null,function*(){yield pa(n.prototype,this,"_set").call(this,t,i),this.localCache[t]=JSON.stringify(i)})}_get(t){return U(this,null,function*(){let i=yield pa(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(i),i})}_remove(t){return U(this,null,function*(){yield pa(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),iF=sK;var oK=(()=>{class n extends Vy{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,i){}_removeListener(t,i){}}return n.type="SESSION",n})(),MS=oK;function aK(n){return Promise.all(n.map(e=>U(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var lK=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let i=this.receivers.find(s=>s.isListeningto(t));if(i)return i;let r=new n(t);return this.receivers.push(r),r}isListeningto(t){return this.eventTarget===t}handleEvent(t){return U(this,null,function*(){let i=t,{eventId:r,eventType:s,data:o}=i.data,a=this.handlersMap[s];if(!a?.size)return;i.ports[0].postMessage({status:"ack",eventId:r,eventType:s});let l=Array.from(a).map(d=>U(this,null,function*(){return d(i.origin,o)})),u=yield aK(l);i.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})})}_subscribe(t,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(i)}_unsubscribe(t,i){this.handlersMap[t]&&i&&this.handlersMap[t].delete(i),(!i||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function rF(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}var uS=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,i=50){return U(this,null,function*(){let r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,o;return new Promise((a,l)=>{let u=rF("",20);r.port1.start();let d=setTimeout(()=>{l(new Error("unsupported_event"))},i);o={messageChannel:r,onMessage(f){let m=f;if(m.data.eventId===u)switch(m.data.status){case"ack":clearTimeout(d),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(m.data.response);break;default:clearTimeout(d),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};function Mn(){return window}function cK(n){Mn().location.href=n}function kS(){return typeof Mn().WorkerGlobalScope<"u"&&typeof Mn().importScripts=="function"}function uK(){return U(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function dK(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function hK(){return kS()?self:null}var sF="firebaseLocalStorageDb",fK=1,By="firebaseLocalStorage",oF="fbase_key",vc=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function zy(n,e){return n.transaction([By],e?"readwrite":"readonly").objectStore(By)}function pK(){let n=indexedDB.deleteDatabase(sF);return new vc(n).toPromise()}function dS(){let n=indexedDB.open(sF,fK);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let i=n.result;try{i.createObjectStore(By,{keyPath:oF})}catch(r){t(r)}}),n.addEventListener("success",()=>U(this,null,function*(){let i=n.result;i.objectStoreNames.contains(By)?e(i):(i.close(),yield pK(),e(yield dS()))}))})}function CN(n,e,t){return U(this,null,function*(){let i=zy(n,!0).put({[oF]:e,value:t});return new vc(i).toPromise()})}function mK(n,e){return U(this,null,function*(){let t=zy(n,!1).get(e),i=yield new vc(t).toPromise();return i===void 0?null:i.value})}function xN(n,e){let t=zy(n,!0).delete(e);return new vc(t).toPromise()}var gK=800,yK=3,vK=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return U(this,null,function*(){return this.db?this.db:(this.db=yield dS(),this.db)})}_withRetries(t){return U(this,null,function*(){let i=0;for(;;)try{let r=yield this._openDb();return yield t(r)}catch(r){if(i++>yK)throw r;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return U(this,null,function*(){return kS()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return U(this,null,function*(){this.receiver=lK._getInstance(hK()),this.receiver._subscribe("keyChanged",(t,i)=>U(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(i.key)}})),this.receiver._subscribe("ping",(t,i)=>U(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return U(this,null,function*(){var t,i;if(this.activeServiceWorker=yield uK(),!this.activeServiceWorker)return;this.sender=new uS(this.activeServiceWorker);let r=yield this.sender._send("ping",{},800);r&&!((t=r[0])===null||t===void 0)&&t.fulfilled&&!((i=r[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return U(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||dK()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return U(this,null,function*(){try{if(!indexedDB)return!1;let t=yield dS();return yield CN(t,Fy,"1"),yield xN(t,Fy),!0}catch{}return!1})}_withPendingWrite(t){return U(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,i){return U(this,null,function*(){return this._withPendingWrite(()=>U(this,null,function*(){return yield this._withRetries(r=>CN(r,t,i)),this.localCache[t]=i,this.notifyServiceWorker(t)}))})}_get(t){return U(this,null,function*(){let i=yield this._withRetries(r=>mK(r,t));return this.localCache[t]=i,i})}_remove(t){return U(this,null,function*(){return this._withPendingWrite(()=>U(this,null,function*(){return yield this._withRetries(i=>xN(i,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return U(this,null,function*(){let t=yield this._withRetries(s=>{let o=zy(s,!1).getAll();return new vc(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let i=[],r=new Set;if(t.length!==0)for(let{fbase_key:s,value:o}of t)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),i.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),i.push(s));return i})}notifyListeners(t,i){this.localCache[t]=i;let r=this.listeners[t];if(r)for(let s of Array.from(r))s(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>U(this,null,function*(){return this._poll()}),gK)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),aF=vK;function _K(n,e){return Us(n,"POST","/v2/accounts/mfaSignIn:start",zo(n,e))}var EK=500,TK=6e4,Sy=1e12,hS=class{constructor(e){this.auth=e,this.counter=Sy,this._widgets=new Map}render(e,t){let i=this.counter;return this._widgets.set(i,new fS(e,this.auth.name,t||{})),this.counter++,i}reset(e){var t;let i=e||Sy;(t=this._widgets.get(i))===null||t===void 0||t.delete(),this._widgets.delete(i)}getResponse(e){var t;let i=e||Sy;return((t=this._widgets.get(i))===null||t===void 0?void 0:t.getResponse())||""}execute(e){return U(this,null,function*(){var t;let i=e||Sy;return(t=this._widgets.get(i))===null||t===void 0||t.execute(),""})}},fS=class{constructor(e,t,i){this.params=i,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};let r=typeof e=="string"?document.getElementById(e):e;Oe(r,"argument-error",{appName:t}),this.container=r,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=wK(50);let{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},TK)},EK))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}};function wK(n){let e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let i=0;i<n;i++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}var JI=JN("rcb"),bK=new yc(3e4,6e4),pS=class{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Mn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return Oe(IK(t),e,"argument-error"),this.shouldResolveImmediately(t)&&EN(Mn().grecaptcha)?Promise.resolve(Mn().grecaptcha):new Promise((i,r)=>{let s=Mn().setTimeout(()=>{r(Bs(e,"network-request-failed"))},bK.get());Mn()[JI]=()=>{Mn().clearTimeout(s),delete Mn()[JI];let a=Mn().grecaptcha;if(!a||!EN(a)){r(Bs(e,"internal-error"));return}let l=a.render;a.render=(u,d)=>{let f=l(u,d);return this.counter++,f},this.hostLanguage=t,i(a)};let o=`${zW()}?${od({onload:JI,render:"explicit",hl:t})}`;XN(o).catch(()=>{clearTimeout(s),r(Bs(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Mn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}};function IK(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}var mS=class{load(e){return U(this,null,function*(){return new hS(e)})}clearedOneInstance(){}};var lF="recaptcha",SK={theme:"light",type:"image"},_c=class{constructor(e,t,i=Object.assign({},SK)){this.parameters=i,this.type=lF,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=hd(e),this.isInvisible=this.parameters.size==="invisible",Oe(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");let r=typeof t=="string"?document.getElementById(t):t;Oe(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new mS:new pS,this.validateStartingState()}verify(){return U(this,null,function*(){this.assertNotDestroyed();let e=yield this.render(),t=this.getAssertedRecaptcha(),i=t.getResponse(e);return i||new Promise(r=>{let s=o=>{o&&(this.tokenChangeListeners.delete(s),r(o))};this.tokenChangeListeners.add(s),this.isInvisible&&t.execute(e)})})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Oe(!this.parameters.sitekey,this.auth,"argument-error"),Oe(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Oe(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(i=>i(t)),typeof e=="function")e(t);else if(typeof e=="string"){let i=Mn()[e];typeof i=="function"&&i(t)}}}assertNotDestroyed(){Oe(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){return U(this,null,function*(){if(yield this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){let t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId})}init(){return U(this,null,function*(){Oe(VN()&&!kS(),this.auth,"internal-error"),yield CK(),this.recaptcha=yield this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);let e=yield MW(this.auth);Oe(e,this.auth,"internal-error"),this.parameters.sitekey=e})}getAssertedRecaptcha(){return Oe(this.recaptcha,this.auth,"internal-error"),this.recaptcha}};function CK(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}var gS=class{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){let t=Oy._fromVerification(this.verificationId,e);return this.onConfirmation(t)}};function LS(n,e,t){return U(this,null,function*(){if(Vs(n.app))return Promise.reject(Za(n));let i=hd(n),r=yield xK(i,e,bn(t));return new gS(r,s=>PS(i,s))})}function xK(n,e,t){return U(this,null,function*(){var i;let r=yield t.verify();try{Oe(typeof r=="string",n,"argument-error"),Oe(t.type===lF,n,"argument-error");let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){let o=s.session;if("phoneNumber"in s)return Oe(o.type==="enroll",n,"internal-error"),(yield nK(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:r}})).phoneSessionInfo.sessionInfo;{Oe(o.type==="signin",n,"internal-error");let a=((i=s.multiFactorHint)===null||i===void 0?void 0:i.uid)||s.multiFactorUid;return Oe(a,n,"missing-multi-factor-info"),(yield _K(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:r}})).phoneResponseInfo.sessionInfo}}else{let{sessionInfo:o}=yield YW(n,{phoneNumber:s.phoneNumber,recaptchaToken:r});return o}}finally{t._reset()}})}function AK(n,e){return e?Go(e):(Oe(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var Jf=class extends Zf{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return XI(e,this._buildIdpRequest())}_linkToIdToken(e,t){return XI(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return XI(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function DK(n){return nF(n.auth,new Jf(n),n.bypassAuthState)}function PK(n){let{auth:e,user:t}=n;return Oe(t,e,"internal-error"),tK(t,new Jf(n),n.bypassAuthState)}function RK(n){return U(this,null,function*(){let{auth:e,user:t}=n;return Oe(t,e,"internal-error"),eK(t,new Jf(n),n.bypassAuthState)})}var yS=class{constructor(e,t,i,r,s=!1){this.auth=e,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>U(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}}))}onAuthEvent(e){return U(this,null,function*(){let{urlResponse:t,sessionId:i,postBody:r,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}let l={auth:this.auth,requestUri:t,sessionId:i,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(a)(l))}catch(u){this.reject(u)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return DK;case"linkViaPopup":case"linkViaRedirect":return RK;case"reauthViaPopup":case"reauthViaRedirect":return PK;default:Xa(this.auth,"internal-error")}}resolve(e){Ja(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ja(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var mfe=new yc(2e3,1e4);var MK="pendingRedirect",Ay=new Map,vS=class n extends yS{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}execute(){return U(this,null,function*(){let e=Ay.get(this.auth._key());if(!e){try{let i=(yield kK(this.resolver,this.auth))?yield pa(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Ay.set(this.auth._key(),e)}return this.bypassAuthState||Ay.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return U(this,null,function*(){if(e.type==="signInViaRedirect")return pa(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,pa(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return U(this,null,function*(){})}cleanUp(){}};function kK(n,e){return U(this,null,function*(){let t=NK(e),i=OK(n);if(!(yield i._isAvailable()))return!1;let r=(yield i._get(t))==="true";return yield i._remove(t),r})}function LK(n,e){Ay.set(n._key(),e)}function OK(n){return Go(n._redirectPersistence)}function NK(n){return xy(MK,n.config.apiKey,n.name)}function FK(n,e,t=!1){return U(this,null,function*(){if(Vs(n.app))return Promise.reject(Za(n));let i=hd(n),r=AK(i,e),o=yield new vS(i,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield i._persistUserIfCurrent(o.user),yield i._setRedirectUser(null,e)),o})}var VK=10*60*1e3,_S=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!BK(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!cF(e)){let r=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(Bs(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=VK&&this.cachedEventUids.clear(),this.cachedEventUids.has(AN(e))}saveEventToCache(e){this.cachedEventUids.add(AN(e)),this.lastProcessedEventTime=Date.now()}};function AN(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function cF({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function BK(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return cF(n);default:return!1}}function UK(t){return U(this,arguments,function*(n,e={}){return Us(n,"GET","/v1/projects",e)})}var $K=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,jK=/^https?/;function GK(n){return U(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield UK(n);for(let t of e)try{if(zK(t))return}catch{}Xa(n,"unauthorized-domain")})}function zK(n){let e=tS(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){let o=new URL(n);return o.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===i}if(!jK.test(t))return!1;if($K.test(n))return i===n;let r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}var HK=new yc(3e4,6e4);function DN(){let n=Mn().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function qK(n){return new Promise((e,t)=>{var i,r,s;function o(){DN(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{DN(),t(Bs(n,"network-request-failed"))},timeout:HK.get()})}if(!((r=(i=Mn().gapi)===null||i===void 0?void 0:i.iframes)===null||r===void 0)&&r.Iframe)e(gapi.iframes.getContext());else if(!((s=Mn().gapi)===null||s===void 0)&&s.load)o();else{let a=JN("iframefcb");return Mn()[a]=()=>{gapi.load?o():t(Bs(n,"network-request-failed"))},XN(`${HW()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Dy=null,e})}var Dy=null;function WK(n){return Dy=Dy||qK(n),Dy}var KK=new yc(5e3,15e3),YK="__/auth/iframe",QK="emulator/auth/iframe",ZK={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},XK=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function JK(n){let e=n.config;Oe(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?bS(e,QK):`https://${n.config.authDomain}/${YK}`,i={apiKey:e.apiKey,appName:n.name,v:Ya},r=XK.get(n.config.apiHost);r&&(i.eid=r);let s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${t}?${od(i).slice(1)}`}function eY(n){return U(this,null,function*(){let e=yield WK(n),t=Mn().gapi;return Oe(t,n,"internal-error"),e.open({where:document.body,url:JK(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ZK,dontclear:!0},i=>new Promise((r,s)=>U(this,null,function*(){yield i.restyle({setHideOnLeave:!1});let o=Bs(n,"network-request-failed"),a=Mn().setTimeout(()=>{s(o)},KK.get());function l(){Mn().clearTimeout(a),r(i)}i.ping(l).then(l,()=>{s(o)})})))})}var tY={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},nY=500,iY=600,rY="_blank",sY="http://localhost",Uy=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function oY(n,e,t,i=nY,r=iY){let s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString(),a="",l=Object.assign(Object.assign({},tY),{width:i.toString(),height:r.toString(),top:s,left:o}),u=Wn().toLowerCase();t&&(a=HN(u)?rY:t),GN(u)&&(e=e||sY,l.scrollbars="yes");let d=Object.entries(l).reduce((m,[y,v])=>`${m}${y}=${v},`,"");if(BW(u)&&a!=="_self")return aY(e||"",a),new Uy(null);let f=window.open(e||"",a,d);Oe(f,n,"popup-blocked");try{f.focus()}catch{}return new Uy(f)}function aY(n,e){let t=document.createElement("a");t.href=n,t.target=e;let i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}var lY="__/auth/handler",cY="emulator/auth/handler",uY=encodeURIComponent("fac");function PN(n,e,t,i,r,s){return U(this,null,function*(){Oe(n.config.authDomain,n,"auth-domain-config-required"),Oe(n.config.apiKey,n,"invalid-api-key");let o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:Ya,eventId:r};if(e instanceof Ny){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",tN(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[d,f]of Object.entries(s||{}))o[d]=f}if(e instanceof lS){let d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);let a=o;for(let d of Object.keys(a))a[d]===void 0&&delete a[d];let l=yield n._getAppCheckToken(),u=l?`#${uY}=${encodeURIComponent(l)}`:"";return`${dY(n)}?${od(a).slice(1)}${u}`})}function dY({config:n}){return n.emulator?bS(n,cY):`https://${n.authDomain}/${lY}`}var eS="webStorageSupport",ES=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=MS,this._completeRedirectFn=FK,this._overrideRedirectResult=LK}_openPopup(e,t,i,r){return U(this,null,function*(){var s;Ja((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let o=yield PN(e,t,i,tS(),r);return oY(e,o,rF())})}_openRedirect(e,t,i,r){return U(this,null,function*(){yield this._originValidation(e);let s=yield PN(e,t,i,tS(),r);return cK(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:r,promise:s}=this.eventManagers[t];return r?Promise.resolve(r):(Ja(s,"If manager is not set, promise should be"),s)}let i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}initAndGetManager(e){return U(this,null,function*(){let t=yield eY(e),i=new _S(e);return t.register("authEvent",r=>(Oe(r?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(eS,{type:eS},r=>{var s;let o=(s=r?.[0])===null||s===void 0?void 0:s[eS];o!==void 0&&t(!!o),Xa(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=GK(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return QN()||zN()||xS()}},uF=ES;var RN="@firebase/auth",MN="1.7.9";var TS=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return U(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Oe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function hY(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function fY(n){Ka(new Lr("auth",(e,{options:t})=>{let i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;Oe(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});let l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ZN(n)},u=new aS(i,r,s,l);return qW(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),Ka(new Lr("auth-internal",e=>{let t=hd(e.getProvider("auth").getImmediate());return(i=>new TS(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Bn(RN,MN,hY(n)),Bn(RN,MN,"esm2017")}var pY=5*60,mY=MI("authIdTokenMaxAge")||pY,kN=null,gY=n=>e=>U(void 0,null,function*(){let t=e&&(yield e.getIdTokenResult()),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>mY)return;let r=t?.token;kN!==r&&(kN=r,yield fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});function OS(n=ad()){let e=zf(n,"auth");if(e.isInitialized())return e.getImmediate();let t=AS(n,{popupRedirectResolver:uF,persistence:[aF,iF,MS]}),i=MI("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(i,location.origin);if(location.origin===s.origin){let o=gY(s.toString());RS(t,o,()=>o(t.currentUser)),Gy(t,a=>o(a))}}let r=PI("auth");return r&&DS(t,`http://${r}`),t}function yY(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}GW({loadJS(n){return new Promise((e,t)=>{let i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=r=>{let s=Bs("internal-error");s.customData=r,t(s)},i.type="text/javascript",i.charset="UTF-8",yY().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});fY("Browser");function hF(n){return new rt(function(e){var t=ep(n,e.next.bind(e),e.error.bind(e),e.complete.bind(e));return{unsubscribe:t}})}var fF="auth",jt=class{constructor(e){return e}},tp=class{constructor(){return Hf(fF)}};var NS=new Pe("angularfire2.auth-instances");function aQ(n,e){let t=by(fF,n,e);return t&&new jt(t)}function lQ(n){return(e,t)=>{let i=e.runOutsideAngular(()=>n(t));return new jt(i)}}var cQ={provide:tp,deps:[[new li,NS]]},uQ={provide:jt,useFactory:aQ,deps:[[new li,NS],$o]};function pF(n,...e){return Bn("angularfire",mc.full,"auth"),Qr([uQ,cQ,{provide:NS,useFactory:lQ(n),multi:!0,deps:[Dt,ti,ud,gc,[new li,cd],...e]}])}var Hy=sn(hF,!0);var mF=sn(OS,!0);var gF=sn(ep,!0);var yF=sn(LS,!0);var vF=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_F={};var el,FS;(function(){var n;function e(A,x){function R(){}R.prototype=x.prototype,A.D=x.prototype,A.prototype=new R,A.prototype.constructor=A,A.C=function(M,F,j){for(var B=Array(arguments.length-2),ge=2;ge<arguments.length;ge++)B[ge-2]=arguments[ge];return x.prototype[F].apply(M,B)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(A,x,R){R||(R=0);var M=Array(16);if(typeof x=="string")for(var F=0;16>F;++F)M[F]=x.charCodeAt(R++)|x.charCodeAt(R++)<<8|x.charCodeAt(R++)<<16|x.charCodeAt(R++)<<24;else for(F=0;16>F;++F)M[F]=x[R++]|x[R++]<<8|x[R++]<<16|x[R++]<<24;x=A.g[0],R=A.g[1],F=A.g[2];var j=A.g[3],B=x+(j^R&(F^j))+M[0]+3614090360&4294967295;x=R+(B<<7&4294967295|B>>>25),B=j+(F^x&(R^F))+M[1]+3905402710&4294967295,j=x+(B<<12&4294967295|B>>>20),B=F+(R^j&(x^R))+M[2]+606105819&4294967295,F=j+(B<<17&4294967295|B>>>15),B=R+(x^F&(j^x))+M[3]+3250441966&4294967295,R=F+(B<<22&4294967295|B>>>10),B=x+(j^R&(F^j))+M[4]+4118548399&4294967295,x=R+(B<<7&4294967295|B>>>25),B=j+(F^x&(R^F))+M[5]+1200080426&4294967295,j=x+(B<<12&4294967295|B>>>20),B=F+(R^j&(x^R))+M[6]+2821735955&4294967295,F=j+(B<<17&4294967295|B>>>15),B=R+(x^F&(j^x))+M[7]+4249261313&4294967295,R=F+(B<<22&4294967295|B>>>10),B=x+(j^R&(F^j))+M[8]+1770035416&4294967295,x=R+(B<<7&4294967295|B>>>25),B=j+(F^x&(R^F))+M[9]+2336552879&4294967295,j=x+(B<<12&4294967295|B>>>20),B=F+(R^j&(x^R))+M[10]+4294925233&4294967295,F=j+(B<<17&4294967295|B>>>15),B=R+(x^F&(j^x))+M[11]+2304563134&4294967295,R=F+(B<<22&4294967295|B>>>10),B=x+(j^R&(F^j))+M[12]+1804603682&4294967295,x=R+(B<<7&4294967295|B>>>25),B=j+(F^x&(R^F))+M[13]+4254626195&4294967295,j=x+(B<<12&4294967295|B>>>20),B=F+(R^j&(x^R))+M[14]+2792965006&4294967295,F=j+(B<<17&4294967295|B>>>15),B=R+(x^F&(j^x))+M[15]+1236535329&4294967295,R=F+(B<<22&4294967295|B>>>10),B=x+(F^j&(R^F))+M[1]+4129170786&4294967295,x=R+(B<<5&4294967295|B>>>27),B=j+(R^F&(x^R))+M[6]+3225465664&4294967295,j=x+(B<<9&4294967295|B>>>23),B=F+(x^R&(j^x))+M[11]+643717713&4294967295,F=j+(B<<14&4294967295|B>>>18),B=R+(j^x&(F^j))+M[0]+3921069994&4294967295,R=F+(B<<20&4294967295|B>>>12),B=x+(F^j&(R^F))+M[5]+3593408605&4294967295,x=R+(B<<5&4294967295|B>>>27),B=j+(R^F&(x^R))+M[10]+38016083&4294967295,j=x+(B<<9&4294967295|B>>>23),B=F+(x^R&(j^x))+M[15]+3634488961&4294967295,F=j+(B<<14&4294967295|B>>>18),B=R+(j^x&(F^j))+M[4]+3889429448&4294967295,R=F+(B<<20&4294967295|B>>>12),B=x+(F^j&(R^F))+M[9]+568446438&4294967295,x=R+(B<<5&4294967295|B>>>27),B=j+(R^F&(x^R))+M[14]+3275163606&4294967295,j=x+(B<<9&4294967295|B>>>23),B=F+(x^R&(j^x))+M[3]+4107603335&4294967295,F=j+(B<<14&4294967295|B>>>18),B=R+(j^x&(F^j))+M[8]+1163531501&4294967295,R=F+(B<<20&4294967295|B>>>12),B=x+(F^j&(R^F))+M[13]+2850285829&4294967295,x=R+(B<<5&4294967295|B>>>27),B=j+(R^F&(x^R))+M[2]+4243563512&4294967295,j=x+(B<<9&4294967295|B>>>23),B=F+(x^R&(j^x))+M[7]+1735328473&4294967295,F=j+(B<<14&4294967295|B>>>18),B=R+(j^x&(F^j))+M[12]+2368359562&4294967295,R=F+(B<<20&4294967295|B>>>12),B=x+(R^F^j)+M[5]+4294588738&4294967295,x=R+(B<<4&4294967295|B>>>28),B=j+(x^R^F)+M[8]+2272392833&4294967295,j=x+(B<<11&4294967295|B>>>21),B=F+(j^x^R)+M[11]+1839030562&4294967295,F=j+(B<<16&4294967295|B>>>16),B=R+(F^j^x)+M[14]+4259657740&4294967295,R=F+(B<<23&4294967295|B>>>9),B=x+(R^F^j)+M[1]+2763975236&4294967295,x=R+(B<<4&4294967295|B>>>28),B=j+(x^R^F)+M[4]+1272893353&4294967295,j=x+(B<<11&4294967295|B>>>21),B=F+(j^x^R)+M[7]+4139469664&4294967295,F=j+(B<<16&4294967295|B>>>16),B=R+(F^j^x)+M[10]+3200236656&4294967295,R=F+(B<<23&4294967295|B>>>9),B=x+(R^F^j)+M[13]+681279174&4294967295,x=R+(B<<4&4294967295|B>>>28),B=j+(x^R^F)+M[0]+3936430074&4294967295,j=x+(B<<11&4294967295|B>>>21),B=F+(j^x^R)+M[3]+3572445317&4294967295,F=j+(B<<16&4294967295|B>>>16),B=R+(F^j^x)+M[6]+76029189&4294967295,R=F+(B<<23&4294967295|B>>>9),B=x+(R^F^j)+M[9]+3654602809&4294967295,x=R+(B<<4&4294967295|B>>>28),B=j+(x^R^F)+M[12]+3873151461&4294967295,j=x+(B<<11&4294967295|B>>>21),B=F+(j^x^R)+M[15]+530742520&4294967295,F=j+(B<<16&4294967295|B>>>16),B=R+(F^j^x)+M[2]+3299628645&4294967295,R=F+(B<<23&4294967295|B>>>9),B=x+(F^(R|~j))+M[0]+4096336452&4294967295,x=R+(B<<6&4294967295|B>>>26),B=j+(R^(x|~F))+M[7]+1126891415&4294967295,j=x+(B<<10&4294967295|B>>>22),B=F+(x^(j|~R))+M[14]+2878612391&4294967295,F=j+(B<<15&4294967295|B>>>17),B=R+(j^(F|~x))+M[5]+4237533241&4294967295,R=F+(B<<21&4294967295|B>>>11),B=x+(F^(R|~j))+M[12]+1700485571&4294967295,x=R+(B<<6&4294967295|B>>>26),B=j+(R^(x|~F))+M[3]+2399980690&4294967295,j=x+(B<<10&4294967295|B>>>22),B=F+(x^(j|~R))+M[10]+4293915773&4294967295,F=j+(B<<15&4294967295|B>>>17),B=R+(j^(F|~x))+M[1]+2240044497&4294967295,R=F+(B<<21&4294967295|B>>>11),B=x+(F^(R|~j))+M[8]+1873313359&4294967295,x=R+(B<<6&4294967295|B>>>26),B=j+(R^(x|~F))+M[15]+4264355552&4294967295,j=x+(B<<10&4294967295|B>>>22),B=F+(x^(j|~R))+M[6]+2734768916&4294967295,F=j+(B<<15&4294967295|B>>>17),B=R+(j^(F|~x))+M[13]+1309151649&4294967295,R=F+(B<<21&4294967295|B>>>11),B=x+(F^(R|~j))+M[4]+4149444226&4294967295,x=R+(B<<6&4294967295|B>>>26),B=j+(R^(x|~F))+M[11]+3174756917&4294967295,j=x+(B<<10&4294967295|B>>>22),B=F+(x^(j|~R))+M[2]+718787259&4294967295,F=j+(B<<15&4294967295|B>>>17),B=R+(j^(F|~x))+M[9]+3951481745&4294967295,A.g[0]=A.g[0]+x&4294967295,A.g[1]=A.g[1]+(F+(B<<21&4294967295|B>>>11))&4294967295,A.g[2]=A.g[2]+F&4294967295,A.g[3]=A.g[3]+j&4294967295}i.prototype.u=function(A,x){x===void 0&&(x=A.length);for(var R=x-this.blockSize,M=this.B,F=this.h,j=0;j<x;){if(F==0)for(;j<=R;)r(this,A,j),j+=this.blockSize;if(typeof A=="string"){for(;j<x;)if(M[F++]=A.charCodeAt(j++),F==this.blockSize){r(this,M),F=0;break}}else for(;j<x;)if(M[F++]=A[j++],F==this.blockSize){r(this,M),F=0;break}}this.h=F,this.o+=x},i.prototype.v=function(){var A=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);A[0]=128;for(var x=1;x<A.length-8;++x)A[x]=0;var R=8*this.o;for(x=A.length-8;x<A.length;++x)A[x]=R&255,R/=256;for(this.u(A),A=Array(16),x=R=0;4>x;++x)for(var M=0;32>M;M+=8)A[R++]=this.g[x]>>>M&255;return A};function s(A,x){var R=a;return Object.prototype.hasOwnProperty.call(R,A)?R[A]:R[A]=x(A)}function o(A,x){this.h=x;for(var R=[],M=!0,F=A.length-1;0<=F;F--){var j=A[F]|0;M&&j==x||(R[F]=j,M=!1)}this.g=R}var a={};function l(A){return-128<=A&&128>A?s(A,function(x){return new o([x|0],0>x?-1:0)}):new o([A|0],0>A?-1:0)}function u(A){if(isNaN(A)||!isFinite(A))return f;if(0>A)return T(u(-A));for(var x=[],R=1,M=0;A>=R;M++)x[M]=A/R|0,R*=4294967296;return new o(x,0)}function d(A,x){if(A.length==0)throw Error("number format error: empty string");if(x=x||10,2>x||36<x)throw Error("radix out of range: "+x);if(A.charAt(0)=="-")return T(d(A.substring(1),x));if(0<=A.indexOf("-"))throw Error('number format error: interior "-" character');for(var R=u(Math.pow(x,8)),M=f,F=0;F<A.length;F+=8){var j=Math.min(8,A.length-F),B=parseInt(A.substring(F,F+j),x);8>j?(j=u(Math.pow(x,j)),M=M.j(j).add(u(B))):(M=M.j(R),M=M.add(u(B)))}return M}var f=l(0),m=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(E(this))return-T(this).m();for(var A=0,x=1,R=0;R<this.g.length;R++){var M=this.i(R);A+=(0<=M?M:4294967296+M)*x,x*=4294967296}return A},n.toString=function(A){if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(v(this))return"0";if(E(this))return"-"+T(this).toString(A);for(var x=u(Math.pow(A,6)),R=this,M="";;){var F=V(R,x).g;R=C(R,F.j(x));var j=((0<R.g.length?R.g[0]:R.h)>>>0).toString(A);if(R=F,v(R))return j+M;for(;6>j.length;)j="0"+j;M=j+M}},n.i=function(A){return 0>A?0:A<this.g.length?this.g[A]:this.h};function v(A){if(A.h!=0)return!1;for(var x=0;x<A.g.length;x++)if(A.g[x]!=0)return!1;return!0}function E(A){return A.h==-1}n.l=function(A){return A=C(this,A),E(A)?-1:v(A)?0:1};function T(A){for(var x=A.g.length,R=[],M=0;M<x;M++)R[M]=~A.g[M];return new o(R,~A.h).add(m)}n.abs=function(){return E(this)?T(this):this},n.add=function(A){for(var x=Math.max(this.g.length,A.g.length),R=[],M=0,F=0;F<=x;F++){var j=M+(this.i(F)&65535)+(A.i(F)&65535),B=(j>>>16)+(this.i(F)>>>16)+(A.i(F)>>>16);M=B>>>16,j&=65535,B&=65535,R[F]=B<<16|j}return new o(R,R[R.length-1]&-2147483648?-1:0)};function C(A,x){return A.add(T(x))}n.j=function(A){if(v(this)||v(A))return f;if(E(this))return E(A)?T(this).j(T(A)):T(T(this).j(A));if(E(A))return T(this.j(T(A)));if(0>this.l(y)&&0>A.l(y))return u(this.m()*A.m());for(var x=this.g.length+A.g.length,R=[],M=0;M<2*x;M++)R[M]=0;for(M=0;M<this.g.length;M++)for(var F=0;F<A.g.length;F++){var j=this.i(M)>>>16,B=this.i(M)&65535,ge=A.i(F)>>>16,we=A.i(F)&65535;R[2*M+2*F]+=B*we,D(R,2*M+2*F),R[2*M+2*F+1]+=j*we,D(R,2*M+2*F+1),R[2*M+2*F+1]+=B*ge,D(R,2*M+2*F+1),R[2*M+2*F+2]+=j*ge,D(R,2*M+2*F+2)}for(M=0;M<x;M++)R[M]=R[2*M+1]<<16|R[2*M];for(M=x;M<2*x;M++)R[M]=0;return new o(R,0)};function D(A,x){for(;(A[x]&65535)!=A[x];)A[x+1]+=A[x]>>>16,A[x]&=65535,x++}function P(A,x){this.g=A,this.h=x}function V(A,x){if(v(x))throw Error("division by zero");if(v(A))return new P(f,f);if(E(A))return x=V(T(A),x),new P(T(x.g),T(x.h));if(E(x))return x=V(A,T(x)),new P(T(x.g),x.h);if(30<A.g.length){if(E(A)||E(x))throw Error("slowDivide_ only works with positive integers.");for(var R=m,M=x;0>=M.l(A);)R=G(R),M=G(M);var F=H(R,1),j=H(M,1);for(M=H(M,2),R=H(R,2);!v(M);){var B=j.add(M);0>=B.l(A)&&(F=F.add(R),j=B),M=H(M,1),R=H(R,1)}return x=C(A,F.j(x)),new P(F,x)}for(F=f;0<=A.l(x);){for(R=Math.max(1,Math.floor(A.m()/x.m())),M=Math.ceil(Math.log(R)/Math.LN2),M=48>=M?1:Math.pow(2,M-48),j=u(R),B=j.j(x);E(B)||0<B.l(A);)R-=M,j=u(R),B=j.j(x);v(j)&&(j=m),F=F.add(j),A=C(A,B)}return new P(F,A)}n.A=function(A){return V(this,A).h},n.and=function(A){for(var x=Math.max(this.g.length,A.g.length),R=[],M=0;M<x;M++)R[M]=this.i(M)&A.i(M);return new o(R,this.h&A.h)},n.or=function(A){for(var x=Math.max(this.g.length,A.g.length),R=[],M=0;M<x;M++)R[M]=this.i(M)|A.i(M);return new o(R,this.h|A.h)},n.xor=function(A){for(var x=Math.max(this.g.length,A.g.length),R=[],M=0;M<x;M++)R[M]=this.i(M)^A.i(M);return new o(R,this.h^A.h)};function G(A){for(var x=A.g.length+1,R=[],M=0;M<x;M++)R[M]=A.i(M)<<1|A.i(M-1)>>>31;return new o(R,A.h)}function H(A,x){var R=x>>5;x%=32;for(var M=A.g.length-R,F=[],j=0;j<M;j++)F[j]=0<x?A.i(j+R)>>>x|A.i(j+R+1)<<32-x:A.i(j+R);return new o(F,A.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,FS=_F.Md5=i,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,el=_F.Integer=o}).apply(typeof vF<"u"?vF:typeof self<"u"?self:typeof window<"u"?window:{});var qy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ho={};var VS,dQ,fd,BS,np,Wy,US,$S,jS;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(p,w,S){return p==Array.prototype||p==Object.prototype||(p[w]=S.value),p};function t(p){p=[typeof globalThis=="object"&&globalThis,p,typeof window=="object"&&window,typeof self=="object"&&self,typeof qy=="object"&&qy];for(var w=0;w<p.length;++w){var S=p[w];if(S&&S.Math==Math)return S}throw Error("Cannot find global object")}var i=t(this);function r(p,w){if(w)e:{var S=i;p=p.split(".");for(var O=0;O<p.length-1;O++){var Y=p[O];if(!(Y in S))break e;S=S[Y]}p=p[p.length-1],O=S[p],w=w(O),w!=O&&w!=null&&e(S,p,{configurable:!0,writable:!0,value:w})}}function s(p,w){p instanceof String&&(p+="");var S=0,O=!1,Y={next:function(){if(!O&&S<p.length){var J=S++;return{value:w(J,p[J]),done:!1}}return O=!0,{done:!0,value:void 0}}};return Y[Symbol.iterator]=function(){return Y},Y}r("Array.prototype.values",function(p){return p||function(){return s(this,function(w,S){return S})}});var o=o||{},a=this||self;function l(p){var w=typeof p;return w=w!="object"?w:p?Array.isArray(p)?"array":w:"null",w=="array"||w=="object"&&typeof p.length=="number"}function u(p){var w=typeof p;return w=="object"&&p!=null||w=="function"}function d(p,w,S){return p.call.apply(p.bind,arguments)}function f(p,w,S){if(!p)throw Error();if(2<arguments.length){var O=Array.prototype.slice.call(arguments,2);return function(){var Y=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Y,O),p.apply(w,Y)}}return function(){return p.apply(w,arguments)}}function m(p,w,S){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,m.apply(null,arguments)}function y(p,w){var S=Array.prototype.slice.call(arguments,1);return function(){var O=S.slice();return O.push.apply(O,arguments),p.apply(this,O)}}function v(p,w){function S(){}S.prototype=w.prototype,p.aa=w.prototype,p.prototype=new S,p.prototype.constructor=p,p.Qb=function(O,Y,J){for(var Te=Array(arguments.length-2),dt=2;dt<arguments.length;dt++)Te[dt-2]=arguments[dt];return w.prototype[Y].apply(O,Te)}}function E(p){let w=p.length;if(0<w){let S=Array(w);for(let O=0;O<w;O++)S[O]=p[O];return S}return[]}function T(p,w){for(let S=1;S<arguments.length;S++){let O=arguments[S];if(l(O)){let Y=p.length||0,J=O.length||0;p.length=Y+J;for(let Te=0;Te<J;Te++)p[Y+Te]=O[Te]}else p.push(O)}}class C{constructor(w,S){this.i=w,this.j=S,this.h=0,this.g=null}get(){let w;return 0<this.h?(this.h--,w=this.g,this.g=w.next,w.next=null):w=this.i(),w}}function D(p){return/^[\s\xa0]*$/.test(p)}function P(){var p=a.navigator;return p&&(p=p.userAgent)?p:""}function V(p){return V[" "](p),p}V[" "]=function(){};var G=P().indexOf("Gecko")!=-1&&!(P().toLowerCase().indexOf("webkit")!=-1&&P().indexOf("Edge")==-1)&&!(P().indexOf("Trident")!=-1||P().indexOf("MSIE")!=-1)&&P().indexOf("Edge")==-1;function H(p,w,S){for(let O in p)w.call(S,p[O],O,p)}function A(p,w){for(let S in p)w.call(void 0,p[S],S,p)}function x(p){let w={};for(let S in p)w[S]=p[S];return w}let R="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function M(p,w){let S,O;for(let Y=1;Y<arguments.length;Y++){O=arguments[Y];for(S in O)p[S]=O[S];for(let J=0;J<R.length;J++)S=R[J],Object.prototype.hasOwnProperty.call(O,S)&&(p[S]=O[S])}}function F(p){var w=1;p=p.split(":");let S=[];for(;0<w&&p.length;)S.push(p.shift()),w--;return p.length&&S.push(p.join(":")),S}function j(p){a.setTimeout(()=>{throw p},0)}function B(){var p=ne;let w=null;return p.g&&(w=p.g,p.g=p.g.next,p.g||(p.h=null),w.next=null),w}class ge{constructor(){this.h=this.g=null}add(w,S){let O=we.get();O.set(w,S),this.h?this.h.next=O:this.g=O,this.h=O}}var we=new C(()=>new q,p=>p.reset());class q{constructor(){this.next=this.g=this.h=null}set(w,S){this.h=w,this.g=S,this.next=null}reset(){this.next=this.g=this.h=null}}let te,K=!1,ne=new ge,Ee=()=>{let p=a.Promise.resolve(void 0);te=()=>{p.then(oe)}};var oe=()=>{for(var p;p=B();){try{p.h.call(p.g)}catch(S){j(S)}var w=we;w.j(p),100>w.h&&(w.h++,p.next=w.g,w.g=p)}K=!1};function ie(){this.s=this.s,this.C=this.C}ie.prototype.s=!1,ie.prototype.ma=function(){this.s||(this.s=!0,this.N())},ie.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function fe(p,w){this.type=p,this.g=this.target=w,this.defaultPrevented=!1}fe.prototype.h=function(){this.defaultPrevented=!0};var me=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var p=!1,w=Object.defineProperty({},"passive",{get:function(){p=!0}});try{let S=()=>{};a.addEventListener("test",S,w),a.removeEventListener("test",S,w)}catch{}return p}();function Fe(p,w){if(fe.call(this,p?p.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,p){var S=this.type=p.type,O=p.changedTouches&&p.changedTouches.length?p.changedTouches[0]:null;if(this.target=p.target||p.srcElement,this.g=w,w=p.relatedTarget){if(G){e:{try{V(w.nodeName);var Y=!0;break e}catch{}Y=!1}Y||(w=null)}}else S=="mouseover"?w=p.fromElement:S=="mouseout"&&(w=p.toElement);this.relatedTarget=w,O?(this.clientX=O.clientX!==void 0?O.clientX:O.pageX,this.clientY=O.clientY!==void 0?O.clientY:O.pageY,this.screenX=O.screenX||0,this.screenY=O.screenY||0):(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0),this.button=p.button,this.key=p.key||"",this.ctrlKey=p.ctrlKey,this.altKey=p.altKey,this.shiftKey=p.shiftKey,this.metaKey=p.metaKey,this.pointerId=p.pointerId||0,this.pointerType=typeof p.pointerType=="string"?p.pointerType:Ge[p.pointerType]||"",this.state=p.state,this.i=p,p.defaultPrevented&&Fe.aa.h.call(this)}}v(Fe,fe);var Ge={2:"touch",3:"pen",4:"mouse"};Fe.prototype.h=function(){Fe.aa.h.call(this);var p=this.i;p.preventDefault?p.preventDefault():p.returnValue=!1};var et="closure_listenable_"+(1e6*Math.random()|0),Lt=0;function Ot(p,w,S,O,Y){this.listener=p,this.proxy=null,this.src=w,this.type=S,this.capture=!!O,this.ha=Y,this.key=++Lt,this.da=this.fa=!1}function Xt(p){p.da=!0,p.listener=null,p.proxy=null,p.src=null,p.ha=null}function Sn(p){this.src=p,this.g={},this.h=0}Sn.prototype.add=function(p,w,S,O,Y){var J=p.toString();p=this.g[J],p||(p=this.g[J]=[],this.h++);var Te=ds(p,w,O,Y);return-1<Te?(w=p[Te],S||(w.fa=!1)):(w=new Ot(w,this.src,J,!!O,Y),w.fa=S,p.push(w)),w};function vl(p,w){var S=w.type;if(S in p.g){var O=p.g[S],Y=Array.prototype.indexOf.call(O,w,void 0),J;(J=0<=Y)&&Array.prototype.splice.call(O,Y,1),J&&(Xt(w),p.g[S].length==0&&(delete p.g[S],p.h--))}}function ds(p,w,S,O){for(var Y=0;Y<p.length;++Y){var J=p[Y];if(!J.da&&J.listener==w&&J.capture==!!S&&J.ha==O)return Y}return-1}var hs="closure_lm_"+(1e6*Math.random()|0),na={};function ct(p,w,S,O,Y){if(O&&O.once)return Mi(p,w,S,O,Y);if(Array.isArray(w)){for(var J=0;J<w.length;J++)ct(p,w[J],S,O,Y);return null}return S=Tr(S),p&&p[et]?p.K(w,S,u(O)?!!O.capture:!!O,Y):Tn(p,w,S,!1,O,Y)}function Tn(p,w,S,O,Y,J){if(!w)throw Error("Invalid event type");var Te=u(Y)?!!Y.capture:!!Y,dt=Er(p);if(dt||(p[hs]=dt=new Sn(p)),S=dt.add(w,S,O,Te,J),S.proxy)return S;if(O=Zn(),S.proxy=O,O.src=p,O.listener=S,p.addEventListener)me||(Y=Te),Y===void 0&&(Y=!1),p.addEventListener(w.toString(),O,Y);else if(p.attachEvent)p.attachEvent(_r(w.toString()),O);else if(p.addListener&&p.removeListener)p.addListener(O);else throw Error("addEventListener and attachEvent are unavailable.");return S}function Zn(){function p(S){return w.call(p.src,p.listener,S)}let w=Kc;return p}function Mi(p,w,S,O,Y){if(Array.isArray(w)){for(var J=0;J<w.length;J++)Mi(p,w[J],S,O,Y);return null}return S=Tr(S),p&&p[et]?p.L(w,S,u(O)?!!O.capture:!!O,Y):Tn(p,w,S,!0,O,Y)}function Xn(p,w,S,O,Y){if(Array.isArray(w))for(var J=0;J<w.length;J++)Xn(p,w[J],S,O,Y);else O=u(O)?!!O.capture:!!O,S=Tr(S),p&&p[et]?(p=p.i,w=String(w).toString(),w in p.g&&(J=p.g[w],S=ds(J,S,O,Y),-1<S&&(Xt(J[S]),Array.prototype.splice.call(J,S,1),J.length==0&&(delete p.g[w],p.h--)))):p&&(p=Er(p))&&(w=p.g[w.toString()],p=-1,w&&(p=ds(w,S,O,Y)),(S=-1<p?w[p]:null)&&Ki(S))}function Ki(p){if(typeof p!="number"&&p&&!p.da){var w=p.src;if(w&&w[et])vl(w.i,p);else{var S=p.type,O=p.proxy;w.removeEventListener?w.removeEventListener(S,O,p.capture):w.detachEvent?w.detachEvent(_r(S),O):w.addListener&&w.removeListener&&w.removeListener(O),(S=Er(w))?(vl(S,p),S.h==0&&(S.src=null,w[hs]=null)):Xt(p)}}}function _r(p){return p in na?na[p]:na[p]="on"+p}function Kc(p,w){if(p.da)p=!0;else{w=new Fe(w,this);var S=p.listener,O=p.ha||p.src;p.fa&&Ki(p),p=S.call(O,w)}return p}function Er(p){return p=p[hs],p instanceof Sn?p:null}var so="__closure_events_fn_"+(1e9*Math.random()>>>0);function Tr(p){return typeof p=="function"?p:(p[so]||(p[so]=function(w){return p.handleEvent(w)}),p[so])}function wn(){ie.call(this),this.i=new Sn(this),this.M=this,this.F=null}v(wn,ie),wn.prototype[et]=!0,wn.prototype.removeEventListener=function(p,w,S,O){Xn(this,p,w,S,O)};function Cn(p,w){var S,O=p.F;if(O)for(S=[];O;O=O.F)S.push(O);if(p=p.M,O=w.type||w,typeof w=="string")w=new fe(w,p);else if(w instanceof fe)w.target=w.target||p;else{var Y=w;w=new fe(O,p),M(w,Y)}if(Y=!0,S)for(var J=S.length-1;0<=J;J--){var Te=w.g=S[J];Y=fs(Te,O,!0,w)&&Y}if(Te=w.g=p,Y=fs(Te,O,!0,w)&&Y,Y=fs(Te,O,!1,w)&&Y,S)for(J=0;J<S.length;J++)Te=w.g=S[J],Y=fs(Te,O,!1,w)&&Y}wn.prototype.N=function(){if(wn.aa.N.call(this),this.i){var p=this.i,w;for(w in p.g){for(var S=p.g[w],O=0;O<S.length;O++)Xt(S[O]);delete p.g[w],p.h--}}this.F=null},wn.prototype.K=function(p,w,S,O){return this.i.add(String(p),w,!1,S,O)},wn.prototype.L=function(p,w,S,O){return this.i.add(String(p),w,!0,S,O)};function fs(p,w,S,O){if(w=p.i.g[String(w)],!w)return!0;w=w.concat();for(var Y=!0,J=0;J<w.length;++J){var Te=w[J];if(Te&&!Te.da&&Te.capture==S){var dt=Te.listener,an=Te.ha||Te.src;Te.fa&&vl(p.i,Te),Y=dt.call(an,O)!==!1&&Y}}return Y&&!O.defaultPrevented}function _l(p,w,S){if(typeof p=="function")S&&(p=m(p,S));else if(p&&typeof p.handleEvent=="function")p=m(p.handleEvent,p);else throw Error("Invalid listener argument");return 2147483647<Number(w)?-1:a.setTimeout(p,w||0)}function Br(p){p.g=_l(()=>{p.g=null,p.i&&(p.i=!1,Br(p))},p.l);let w=p.h;p.h=null,p.m.apply(null,w)}class oh extends ie{constructor(w,S){super(),this.m=w,this.l=S,this.h=null,this.i=!1,this.g=null}j(w){this.h=arguments,this.g?this.i=!0:Br(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ia(p){ie.call(this),this.h=p,this.g={}}v(ia,ie);var nm=[];function ra(p){H(p.g,function(w,S){this.g.hasOwnProperty(S)&&Ki(w)},p),p.g={}}ia.prototype.N=function(){ia.aa.N.call(this),ra(this)},ia.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ah=a.JSON.stringify,oE=a.JSON.parse,im=class{stringify(p){return a.JSON.stringify(p,void 0)}parse(p){return a.JSON.parse(p,void 0)}};function Yc(){}Yc.prototype.h=null;function lh(p){return p.h||(p.h=p.i())}function rm(){}var El={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ch(){fe.call(this,"d")}v(ch,fe);function uh(){fe.call(this,"c")}v(uh,fe);var oo={},sm=null;function sa(){return sm=sm||new wn}oo.La="serverreachability";function om(p){fe.call(this,oo.La,p)}v(om,fe);function Tl(p){let w=sa();Cn(w,new om(w))}oo.STAT_EVENT="statevent";function am(p,w){fe.call(this,oo.STAT_EVENT,p),this.stat=w}v(am,fe);function Jn(p){let w=sa();Cn(w,new am(w,p))}oo.Ma="timingevent";function Yi(p,w){fe.call(this,oo.Ma,p),this.size=w}v(Yi,fe);function ke(p,w){if(typeof p!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){p()},w)}function oa(){this.g=!0}oa.prototype.xa=function(){this.g=!1};function lm(p,w,S,O,Y,J){p.info(function(){if(p.g)if(J)for(var Te="",dt=J.split("&"),an=0;an<dt.length;an++){var St=dt[an].split("=");if(1<St.length){var en=St[0];St=St[1];var jn=en.split("_");Te=2<=jn.length&&jn[1]=="type"?Te+(en+"="+St+"&"):Te+(en+"=redacted&")}}else Te=null;else Te=J;return"XMLHTTP REQ ("+O+") [attempt "+Y+"]: "+w+`
`+S+`
`+Te})}function cm(p,w,S,O,Y,J,Te){p.info(function(){return"XMLHTTP RESP ("+O+") [ attempt "+Y+"]: "+w+`
`+S+`
`+J+" "+Te})}function ao(p,w,S,O){p.info(function(){return"XMLHTTP TEXT ("+w+"): "+um(p,S)+(O?" "+O:"")})}function dh(p,w){p.info(function(){return"TIMEOUT: "+w})}oa.prototype.info=function(){};function um(p,w){if(!p.g)return w;if(!w)return null;try{var S=JSON.parse(w);if(S){for(p=0;p<S.length;p++)if(Array.isArray(S[p])){var O=S[p];if(!(2>O.length)){var Y=O[1];if(Array.isArray(Y)&&!(1>Y.length)){var J=Y[0];if(J!="noop"&&J!="stop"&&J!="close")for(var Te=1;Te<Y.length;Te++)Y[Te]=""}}}}return ah(S)}catch{return w}}var Ur={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},hh={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},fh;function Qc(){}v(Qc,Yc),Qc.prototype.g=function(){return new XMLHttpRequest},Qc.prototype.i=function(){return{}},fh=new Qc;function ps(p,w,S,O){this.j=p,this.i=w,this.l=S,this.R=O||1,this.U=new ia(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new dm}function dm(){this.i=null,this.g="",this.h=!1}var ph={},mh={};function aa(p,w,S){p.L=1,p.v=ca(ei(w)),p.m=S,p.P=!0,hm(p,null)}function hm(p,w){p.F=Date.now(),Zc(p),p.A=ei(p.v);var S=p.A,O=p.R;Array.isArray(O)||(O=[String(O)]),$t(S.i,"t",O),p.C=0,S=p.j.J,p.h=new dm,p.g=kl(p.j,S?w:null,!p.m),0<p.O&&(p.M=new oh(m(p.Y,p,p.g),p.O)),w=p.U,S=p.g,O=p.ca;var Y="readystatechange";Array.isArray(Y)||(Y&&(nm[0]=Y.toString()),Y=nm);for(var J=0;J<Y.length;J++){var Te=ct(S,Y[J],O||w.handleEvent,!1,w.h||w);if(!Te)break;w.g[Te.key]=Te}w=p.H?x(p.H):{},p.m?(p.u||(p.u="POST"),w["Content-Type"]="application/x-www-form-urlencoded",p.g.ea(p.A,p.u,p.m,w)):(p.u="GET",p.g.ea(p.A,p.u,null,w)),Tl(),lm(p.i,p.u,p.A,p.l,p.R,p.m)}ps.prototype.ca=function(p){p=p.target;let w=this.M;w&&Zi(p)==3?w.j():this.Y(p)},ps.prototype.Y=function(p){try{if(p==this.g)e:{let jn=Zi(this.g);var w=this.g.Ba();let Ji=this.g.Z();if(!(3>jn)&&(jn!=3||this.g&&(this.h.h||this.g.oa()||_m(this.g)))){this.J||jn!=4||w==7||(w==8||0>=Ji?Tl(3):Tl(2)),wl(this);var S=this.g.Z();this.X=S;t:if(fm(this)){var O=_m(this.g);p="";var Y=O.length,J=Zi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ms(this),$r(this);var Te="";break t}this.h.i=new a.TextDecoder}for(w=0;w<Y;w++)this.h.h=!0,p+=this.h.i.decode(O[w],{stream:!(J&&w==Y-1)});O.length=0,this.h.g+=p,this.C=0,Te=this.h.g}else Te=this.g.oa();if(this.o=S==200,cm(this.i,this.u,this.A,this.l,this.R,jn,S),this.o){if(this.T&&!this.K){t:{if(this.g){var dt,an=this.g;if((dt=an.g?an.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(dt)){var St=dt;break t}}St=null}if(S=St)ao(this.i,this.l,S,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Xc(this,S);else{this.o=!1,this.s=3,Jn(12),ms(this),$r(this);break e}}if(this.P){S=!0;let er;for(;!this.J&&this.C<Te.length;)if(er=aE(this,Te),er==mh){jn==4&&(this.s=4,Jn(14),S=!1),ao(this.i,this.l,null,"[Incomplete Response]");break}else if(er==ph){this.s=4,Jn(15),ao(this.i,this.l,Te,"[Invalid Chunk]"),S=!1;break}else ao(this.i,this.l,er,null),Xc(this,er);if(fm(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),jn!=4||Te.length!=0||this.h.h||(this.s=1,Jn(16),S=!1),this.o=this.o&&S,!S)ao(this.i,this.l,Te,"[Invalid Chunked Response]"),ms(this),$r(this);else if(0<Te.length&&!this.W){this.W=!0;var en=this.j;en.g==this&&en.ba&&!en.M&&(en.j.info("Great, no buffering proxy detected. Bytes received: "+Te.length),ru(en),en.M=!0,Jn(11))}}else ao(this.i,this.l,Te,null),Xc(this,Te);jn==4&&ms(this),this.o&&!this.J&&(jn==4?bm(this.j,this):(this.o=!1,Zc(this)))}else Em(this.g),S==400&&0<Te.indexOf("Unknown SID")?(this.s=3,Jn(12)):(this.s=0,Jn(13)),ms(this),$r(this)}}}catch{}finally{}};function fm(p){return p.g?p.u=="GET"&&p.L!=2&&p.j.Ca:!1}function aE(p,w){var S=p.C,O=w.indexOf(`
`,S);return O==-1?mh:(S=Number(w.substring(S,O)),isNaN(S)?ph:(O+=1,O+S>w.length?mh:(w=w.slice(O,O+S),p.C=O+S,w)))}ps.prototype.cancel=function(){this.J=!0,ms(this)};function Zc(p){p.S=Date.now()+p.I,pm(p,p.I)}function pm(p,w){if(p.B!=null)throw Error("WatchDog timer not null");p.B=ke(m(p.ba,p),w)}function wl(p){p.B&&(a.clearTimeout(p.B),p.B=null)}ps.prototype.ba=function(){this.B=null;let p=Date.now();0<=p-this.S?(dh(this.i,this.A),this.L!=2&&(Tl(),Jn(17)),ms(this),this.s=2,$r(this)):pm(this,this.S-p)};function $r(p){p.j.G==0||p.J||bm(p.j,p)}function ms(p){wl(p);var w=p.M;w&&typeof w.ma=="function"&&w.ma(),p.M=null,ra(p.U),p.g&&(w=p.g,p.g=null,w.abort(),w.ma())}function Xc(p,w){try{var S=p.j;if(S.G!=0&&(S.g==p||gs(S.h,p))){if(!p.K&&gs(S.h,p)&&S.G==3){try{var O=S.Da.g.parse(w)}catch{O=null}if(Array.isArray(O)&&O.length==3){var Y=O;if(Y[0]==0){e:if(!S.u){if(S.g)if(S.g.F+3e3<p.F)su(S),tu(S);else break e;xh(S),Jn(18)}}else S.za=Y[1],0<S.za-S.T&&37500>Y[2]&&S.F&&S.v==0&&!S.C&&(S.C=ke(m(S.Za,S),6e3));if(1>=Il(S.h)&&S.ca){try{S.ca()}catch{}S.ca=void 0}}else ho(S,11)}else if((p.K||S.g==p)&&su(S),!D(w))for(Y=S.Da.g.parse(w),w=0;w<Y.length;w++){let St=Y[w];if(S.T=St[0],St=St[1],S.G==2)if(St[0]=="c"){S.K=St[1],S.ia=St[2];let en=St[3];en!=null&&(S.la=en,S.j.info("VER="+S.la));let jn=St[4];jn!=null&&(S.Aa=jn,S.j.info("SVER="+S.Aa));let Ji=St[5];Ji!=null&&typeof Ji=="number"&&0<Ji&&(O=1.5*Ji,S.L=O,S.j.info("backChannelRequestTimeoutMs_="+O)),O=S;let er=p.g;if(er){let Es=er.g?er.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Es){var J=O.h;J.g||Es.indexOf("spdy")==-1&&Es.indexOf("quic")==-1&&Es.indexOf("h2")==-1||(J.j=J.l,J.g=new Set,J.h&&(ys(J,J.h),J.h=null))}if(O.D){let lu=er.g?er.g.getResponseHeader("X-HTTP-Session-Id"):null;lu&&(O.ya=lu,Nt(O.I,O.D,lu))}}S.G=3,S.l&&S.l.ua(),S.ba&&(S.R=Date.now()-p.F,S.j.info("Handshake RTT: "+S.R+"ms")),O=S;var Te=p;if(O.qa=Ph(O,O.J?O.ia:null,O.W),Te.K){Jc(O.h,Te);var dt=Te,an=O.L;an&&(dt.I=an),dt.B&&(wl(dt),Zc(dt)),O.g=Te}else iu(O);0<S.i.length&&nu(S)}else St[0]!="stop"&&St[0]!="close"||ho(S,7);else S.G==3&&(St[0]=="stop"||St[0]=="close"?St[0]=="stop"?ho(S,7):Ml(S):St[0]!="noop"&&S.l&&S.l.ta(St),S.v=0)}}Tl(4)}catch{}}var bl=class{constructor(p,w){this.g=p,this.map=w}};function It(p){this.l=p||10,a.PerformanceNavigationTiming?(p=a.performance.getEntriesByType("navigation"),p=0<p.length&&(p[0].nextHopProtocol=="hq"||p[0].nextHopProtocol=="h2")):p=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=p?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Jt(p){return p.h?!0:p.g?p.g.size>=p.j:!1}function Il(p){return p.h?1:p.g?p.g.size:0}function gs(p,w){return p.h?p.h==w:p.g?p.g.has(w):!1}function ys(p,w){p.g?p.g.add(w):p.h=w}function Jc(p,w){p.h&&p.h==w?p.h=null:p.g&&p.g.has(w)&&p.g.delete(w)}It.prototype.cancel=function(){if(this.i=Xe(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let p of this.g.values())p.cancel();this.g.clear()}};function Xe(p){if(p.h!=null)return p.i.concat(p.h.D);if(p.g!=null&&p.g.size!==0){let w=p.i;for(let S of p.g.values())w=w.concat(S.D);return w}return E(p.i)}function un(p){if(p.V&&typeof p.V=="function")return p.V();if(typeof Map<"u"&&p instanceof Map||typeof Set<"u"&&p instanceof Set)return Array.from(p.values());if(typeof p=="string")return p.split("");if(l(p)){for(var w=[],S=p.length,O=0;O<S;O++)w.push(p[O]);return w}w=[],S=0;for(O in p)w[S++]=p[O];return w}function gh(p){if(p.na&&typeof p.na=="function")return p.na();if(!p.V||typeof p.V!="function"){if(typeof Map<"u"&&p instanceof Map)return Array.from(p.keys());if(!(typeof Set<"u"&&p instanceof Set)){if(l(p)||typeof p=="string"){var w=[];p=p.length;for(var S=0;S<p;S++)w.push(S);return w}w=[],S=0;for(let O in p)w[S++]=O;return w}}}function Sl(p,w){if(p.forEach&&typeof p.forEach=="function")p.forEach(w,void 0);else if(l(p)||typeof p=="string")Array.prototype.forEach.call(p,w,void 0);else for(var S=gh(p),O=un(p),Y=O.length,J=0;J<Y;J++)w.call(void 0,O[J],S&&S[J],p)}var yi=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function lE(p,w){if(p){p=p.split("&");for(var S=0;S<p.length;S++){var O=p[S].indexOf("="),Y=null;if(0<=O){var J=p[S].substring(0,O);Y=p[S].substring(O+1)}else J=p[S];w(J,Y?decodeURIComponent(Y.replace(/\+/g," ")):"")}}}function wr(p){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,p instanceof wr){this.h=p.h,rn(this,p.j),this.o=p.o,this.g=p.g,br(this,p.s),this.l=p.l;var w=p.i,S=new co;S.i=w.i,w.g&&(S.g=new Map(w.g),S.h=w.h),la(this,S),this.m=p.m}else p&&(w=String(p).match(yi))?(this.h=!1,rn(this,w[1]||"",!0),this.o=jr(w[2]||""),this.g=jr(w[3]||"",!0),br(this,w[4]),this.l=jr(w[5]||"",!0),la(this,w[6]||"",!0),this.m=jr(w[7]||"")):(this.h=!1,this.i=new co(null,this.h))}wr.prototype.toString=function(){var p=[],w=this.j;w&&p.push(lo(w,Cl,!0),":");var S=this.g;return(S||w=="file")&&(p.push("//"),(w=this.o)&&p.push(lo(w,Cl,!0),"@"),p.push(encodeURIComponent(String(S)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),S=this.s,S!=null&&p.push(":",String(S))),(S=this.l)&&(this.g&&S.charAt(0)!="/"&&p.push("/"),p.push(lo(S,S.charAt(0)=="/"?_h:vh,!0))),(S=this.i.toString())&&p.push("?",S),(S=this.m)&&p.push("#",lo(S,mm)),p.join("")};function ei(p){return new wr(p)}function rn(p,w,S){p.j=S?jr(w,!0):w,p.j&&(p.j=p.j.replace(/:$/,""))}function br(p,w){if(w){if(w=Number(w),isNaN(w)||0>w)throw Error("Bad port number "+w);p.s=w}else p.s=null}function la(p,w,S){w instanceof co?(p.i=w,Eh(p.i,p.h)):(S||(w=lo(w,eu)),p.i=new co(w,p.h))}function Nt(p,w,S){p.i.set(w,S)}function ca(p){return Nt(p,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),p}function jr(p,w){return p?w?decodeURI(p.replace(/%25/g,"%2525")):decodeURIComponent(p):""}function lo(p,w,S){return typeof p=="string"?(p=encodeURI(p).replace(w,yh),S&&(p=p.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p):null}function yh(p){return p=p.charCodeAt(0),"%"+(p>>4&15).toString(16)+(p&15).toString(16)}var Cl=/[#\/\?@]/g,vh=/[#\?:]/g,_h=/[#\?]/g,eu=/[#\?@]/g,mm=/#/g;function co(p,w){this.h=this.g=null,this.i=p||null,this.j=!!w}function vs(p){p.g||(p.g=new Map,p.h=0,p.i&&lE(p.i,function(w,S){p.add(decodeURIComponent(w.replace(/\+/g," ")),S)}))}n=co.prototype,n.add=function(p,w){vs(this),this.i=null,p=uo(this,p);var S=this.g.get(p);return S||this.g.set(p,S=[]),S.push(w),this.h+=1,this};function Ye(p,w){vs(p),w=uo(p,w),p.g.has(w)&&(p.i=null,p.h-=p.g.get(w).length,p.g.delete(w))}function Qi(p,w){return vs(p),w=uo(p,w),p.g.has(w)}n.forEach=function(p,w){vs(this),this.g.forEach(function(S,O){S.forEach(function(Y){p.call(w,Y,O,this)},this)},this)},n.na=function(){vs(this);let p=Array.from(this.g.values()),w=Array.from(this.g.keys()),S=[];for(let O=0;O<w.length;O++){let Y=p[O];for(let J=0;J<Y.length;J++)S.push(w[O])}return S},n.V=function(p){vs(this);let w=[];if(typeof p=="string")Qi(this,p)&&(w=w.concat(this.g.get(uo(this,p))));else{p=Array.from(this.g.values());for(let S=0;S<p.length;S++)w=w.concat(p[S])}return w},n.set=function(p,w){return vs(this),this.i=null,p=uo(this,p),Qi(this,p)&&(this.h-=this.g.get(p).length),this.g.set(p,[w]),this.h+=1,this},n.get=function(p,w){return p?(p=this.V(p),0<p.length?String(p[0]):w):w};function $t(p,w,S){Ye(p,w),0<S.length&&(p.i=null,p.g.set(uo(p,w),E(S)),p.h+=S.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let p=[],w=Array.from(this.g.keys());for(var S=0;S<w.length;S++){var O=w[S];let J=encodeURIComponent(String(O)),Te=this.V(O);for(O=0;O<Te.length;O++){var Y=J;Te[O]!==""&&(Y+="="+encodeURIComponent(String(Te[O]))),p.push(Y)}}return this.i=p.join("&")};function uo(p,w){return w=String(w),p.j&&(w=w.toLowerCase()),w}function Eh(p,w){w&&!p.j&&(vs(p),p.i=null,p.g.forEach(function(S,O){var Y=O.toLowerCase();O!=Y&&(Ye(this,O),$t(this,Y,S))},p)),p.j=w}function Th(p,w){let S=new oa;if(a.Image){let O=new Image;O.onload=y(oi,S,"TestLoadImage: loaded",!0,w,O),O.onerror=y(oi,S,"TestLoadImage: error",!1,w,O),O.onabort=y(oi,S,"TestLoadImage: abort",!1,w,O),O.ontimeout=y(oi,S,"TestLoadImage: timeout",!1,w,O),a.setTimeout(function(){O.ontimeout&&O.ontimeout()},1e4),O.src=p}else w(!1)}function wh(p,w){let S=new oa,O=new AbortController,Y=setTimeout(()=>{O.abort(),oi(S,"TestPingServer: timeout",!1,w)},1e4);fetch(p,{signal:O.signal}).then(J=>{clearTimeout(Y),J.ok?oi(S,"TestPingServer: ok",!0,w):oi(S,"TestPingServer: server error",!1,w)}).catch(()=>{clearTimeout(Y),oi(S,"TestPingServer: error",!1,w)})}function oi(p,w,S,O,Y){try{Y&&(Y.onload=null,Y.onerror=null,Y.onabort=null,Y.ontimeout=null),O(S)}catch{}}function bh(){this.g=new im}function xl(p,w,S){let O=S||"";try{Sl(p,function(Y,J){let Te=Y;u(Y)&&(Te=ah(Y)),w.push(O+J+"="+encodeURIComponent(Te))})}catch(Y){throw w.push(O+"type="+encodeURIComponent("_badmap")),Y}}function dn(p){this.l=p.Ub||null,this.j=p.eb||!1}v(dn,Yc),dn.prototype.g=function(){return new Ir(this.l,this.j)},dn.prototype.i=function(p){return function(){return p}}({});function Ir(p,w){wn.call(this),this.D=p,this.o=w,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}v(Ir,wn),n=Ir.prototype,n.open=function(p,w){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=p,this.A=w,this.readyState=1,Al(this)},n.send=function(p){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let w={headers:this.u,method:this.B,credentials:this.m,cache:void 0};p&&(w.body=p),(this.D||a).fetch(new Request(this.A,w)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ua(this)),this.readyState=0},n.Sa=function(p){if(this.g&&(this.l=p,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=p.headers,this.readyState=2,Al(this)),this.g&&(this.readyState=3,Al(this),this.g)))if(this.responseType==="arraybuffer")p.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in p){if(this.j=p.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ih(this)}else p.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ih(p){p.j.read().then(p.Pa.bind(p)).catch(p.ga.bind(p))}n.Pa=function(p){if(this.g){if(this.o&&p.value)this.response.push(p.value);else if(!this.o){var w=p.value?p.value:new Uint8Array(0);(w=this.v.decode(w,{stream:!p.done}))&&(this.response=this.responseText+=w)}p.done?ua(this):Al(this),this.readyState==3&&Ih(this)}},n.Ra=function(p){this.g&&(this.response=this.responseText=p,ua(this))},n.Qa=function(p){this.g&&(this.response=p,ua(this))},n.ga=function(){this.g&&ua(this)};function ua(p){p.readyState=4,p.l=null,p.j=null,p.v=null,Al(p)}n.setRequestHeader=function(p,w){this.u.append(p,w)},n.getResponseHeader=function(p){return this.h&&this.h.get(p.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let p=[],w=this.h.entries();for(var S=w.next();!S.done;)S=S.value,p.push(S[0]+": "+S[1]),S=w.next();return p.join(`\r
`)};function Al(p){p.onreadystatechange&&p.onreadystatechange.call(p)}Object.defineProperty(Ir.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(p){this.m=p?"include":"same-origin"}});function Sh(p){let w="";return H(p,function(S,O){w+=O,w+=":",w+=S,w+=`\r
`}),w}function Dl(p,w,S){e:{for(O in S){var O=!1;break e}O=!0}O||(S=Sh(S),typeof p=="string"?S!=null&&encodeURIComponent(String(S)):Nt(p,w,S))}function on(p){wn.call(this),this.headers=new Map,this.o=p||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}v(on,wn);var gm=/^https?$/i,yt=["POST","PUT"];n=on.prototype,n.Ha=function(p){this.J=p},n.ea=function(p,w,S,O){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+p);w=w?w.toUpperCase():"GET",this.D=p,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():fh.g(),this.v=this.o?lh(this.o):lh(fh),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(w,String(p),!0),this.B=!1}catch(J){ym(this,J);return}if(p=S||"",S=new Map(this.headers),O)if(Object.getPrototypeOf(O)===Object.prototype)for(var Y in O)S.set(Y,O[Y]);else if(typeof O.keys=="function"&&typeof O.get=="function")for(let J of O.keys())S.set(J,O.get(J));else throw Error("Unknown input type for opt_headers: "+String(O));O=Array.from(S.keys()).find(J=>J.toLowerCase()=="content-type"),Y=a.FormData&&p instanceof a.FormData,!(0<=Array.prototype.indexOf.call(yt,w,void 0))||O||Y||S.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[J,Te]of S)this.g.setRequestHeader(J,Te);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{vm(this),this.u=!0,this.g.send(p),this.u=!1}catch(J){ym(this,J)}};function ym(p,w){p.h=!1,p.g&&(p.j=!0,p.g.abort(),p.j=!1),p.l=w,p.m=5,ki(p),Pl(p)}function ki(p){p.A||(p.A=!0,Cn(p,"complete"),Cn(p,"error"))}n.abort=function(p){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=p||7,Cn(this,"complete"),Cn(this,"abort"),Pl(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Pl(this,!0)),on.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?da(this):this.bb())},n.bb=function(){da(this)};function da(p){if(p.h&&typeof o<"u"&&(!p.v[1]||Zi(p)!=4||p.Z()!=2)){if(p.u&&Zi(p)==4)_l(p.Ea,0,p);else if(Cn(p,"readystatechange"),Zi(p)==4){p.h=!1;try{let Te=p.Z();e:switch(Te){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var w=!0;break e;default:w=!1}var S;if(!(S=w)){var O;if(O=Te===0){var Y=String(p.D).match(yi)[1]||null;!Y&&a.self&&a.self.location&&(Y=a.self.location.protocol.slice(0,-1)),O=!gm.test(Y?Y.toLowerCase():"")}S=O}if(S)Cn(p,"complete"),Cn(p,"success");else{p.m=6;try{var J=2<Zi(p)?p.g.statusText:""}catch{J=""}p.l=J+" ["+p.Z()+"]",ki(p)}}finally{Pl(p)}}}}function Pl(p,w){if(p.g){vm(p);let S=p.g,O=p.v[0]?()=>{}:null;p.g=null,p.v=null,w||Cn(p,"ready");try{S.onreadystatechange=O}catch{}}}function vm(p){p.I&&(a.clearTimeout(p.I),p.I=null)}n.isActive=function(){return!!this.g};function Zi(p){return p.g?p.g.readyState:0}n.Z=function(){try{return 2<Zi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(p){if(this.g){var w=this.g.responseText;return p&&w.indexOf(p)==0&&(w=w.substring(p.length)),oE(w)}};function _m(p){try{if(!p.g)return null;if("response"in p.g)return p.g.response;switch(p.H){case"":case"text":return p.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in p.g)return p.g.mozResponseArrayBuffer}return null}catch{return null}}function Em(p){let w={};p=(p.g&&2<=Zi(p)&&p.g.getAllResponseHeaders()||"").split(`\r
`);for(let O=0;O<p.length;O++){if(D(p[O]))continue;var S=F(p[O]);let Y=S[0];if(S=S[1],typeof S!="string")continue;S=S.trim();let J=w[Y]||[];w[Y]=J,J.push(S)}A(w,function(O){return O.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Rl(p,w,S){return S&&S.internalChannelParams&&S.internalChannelParams[p]||w}function Tm(p){this.Aa=0,this.i=[],this.j=new oa,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Rl("failFast",!1,p),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Rl("baseRetryDelayMs",5e3,p),this.cb=Rl("retryDelaySeedMs",1e4,p),this.Wa=Rl("forwardChannelMaxRetries",2,p),this.wa=Rl("forwardChannelRequestTimeoutMs",2e4,p),this.pa=p&&p.xmlHttpFactory||void 0,this.Xa=p&&p.Tb||void 0,this.Ca=p&&p.useFetchStreams||!1,this.L=void 0,this.J=p&&p.supportsCrossDomainXhr||!1,this.K="",this.h=new It(p&&p.concurrentRequestLimit),this.Da=new bh,this.P=p&&p.fastHandshake||!1,this.O=p&&p.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=p&&p.Rb||!1,p&&p.xa&&this.j.xa(),p&&p.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&p&&p.detectBufferingProxy||!1,this.ja=void 0,p&&p.longPollingTimeout&&0<p.longPollingTimeout&&(this.ja=p.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Tm.prototype,n.la=8,n.G=1,n.connect=function(p,w,S,O){Jn(0),this.W=p,this.H=w||{},S&&O!==void 0&&(this.H.OSID=S,this.H.OAID=O),this.F=this.X,this.I=Ph(this,null,this.W),nu(this)};function Ml(p){if(Xi(p),p.G==3){var w=p.U++,S=ei(p.I);if(Nt(S,"SID",p.K),Nt(S,"RID",w),Nt(S,"TYPE","terminate"),ha(p,S),w=new ps(p,p.j,w),w.L=2,w.v=ca(ei(S)),S=!1,a.navigator&&a.navigator.sendBeacon)try{S=a.navigator.sendBeacon(w.v.toString(),"")}catch{}!S&&a.Image&&(new Image().src=w.v,S=!0),S||(w.g=kl(w.j,null),w.g.ea(w.v)),w.F=Date.now(),Zc(w)}Dh(p)}function tu(p){p.g&&(ru(p),p.g.cancel(),p.g=null)}function Xi(p){tu(p),p.u&&(a.clearTimeout(p.u),p.u=null),su(p),p.h.cancel(),p.s&&(typeof p.s=="number"&&a.clearTimeout(p.s),p.s=null)}function nu(p){if(!Jt(p.h)&&!p.s){p.s=!0;var w=p.Ga;te||Ee(),K||(te(),K=!0),ne.add(w,p),p.B=0}}function wm(p,w){return Il(p.h)>=p.h.j-(p.s?1:0)?!1:p.s?(p.i=w.D.concat(p.i),!0):p.G==1||p.G==2||p.B>=(p.Va?0:p.Wa)?!1:(p.s=ke(m(p.Ga,p,w),ou(p,p.B)),p.B++,!0)}n.Ga=function(p){if(this.s)if(this.s=null,this.G==1){if(!p){this.U=Math.floor(1e5*Math.random()),p=this.U++;let Y=new ps(this,this.j,p),J=this.o;if(this.S&&(J?(J=x(J),M(J,this.S)):J=this.S),this.m!==null||this.O||(Y.H=J,J=null),this.P)e:{for(var w=0,S=0;S<this.i.length;S++){t:{var O=this.i[S];if("__data__"in O.map&&(O=O.map.__data__,typeof O=="string")){O=O.length;break t}O=void 0}if(O===void 0)break;if(w+=O,4096<w){w=S;break e}if(w===4096||S===this.i.length-1){w=S+1;break e}}w=1e3}else w=1e3;w=Ch(this,Y,w),S=ei(this.I),Nt(S,"RID",p),Nt(S,"CVER",22),this.D&&Nt(S,"X-HTTP-Session-Id",this.D),ha(this,S),J&&(this.O?w="headers="+encodeURIComponent(String(Sh(J)))+"&"+w:this.m&&Dl(S,this.m,J)),ys(this.h,Y),this.Ua&&Nt(S,"TYPE","init"),this.P?(Nt(S,"$req",w),Nt(S,"SID","null"),Y.T=!0,aa(Y,S,null)):aa(Y,S,w),this.G=2}}else this.G==3&&(p?Gr(this,p):this.i.length==0||Jt(this.h)||Gr(this))};function Gr(p,w){var S;w?S=w.l:S=p.U++;let O=ei(p.I);Nt(O,"SID",p.K),Nt(O,"RID",S),Nt(O,"AID",p.T),ha(p,O),p.m&&p.o&&Dl(O,p.m,p.o),S=new ps(p,p.j,S,p.B+1),p.m===null&&(S.H=p.o),w&&(p.i=w.D.concat(p.i)),w=Ch(p,S,1e3),S.I=Math.round(.5*p.wa)+Math.round(.5*p.wa*Math.random()),ys(p.h,S),aa(S,O,w)}function ha(p,w){p.H&&H(p.H,function(S,O){Nt(w,O,S)}),p.l&&Sl({},function(S,O){Nt(w,O,S)})}function Ch(p,w,S){S=Math.min(p.i.length,S);var O=p.l?m(p.l.Na,p.l,p):null;e:{var Y=p.i;let J=-1;for(;;){let Te=["count="+S];J==-1?0<S?(J=Y[0].g,Te.push("ofs="+J)):J=0:Te.push("ofs="+J);let dt=!0;for(let an=0;an<S;an++){let St=Y[an].g,en=Y[an].map;if(St-=J,0>St)J=Math.max(0,Y[an].g-100),dt=!1;else try{xl(en,Te,"req"+St+"_")}catch{O&&O(en)}}if(dt){O=Te.join("&");break e}}}return p=p.i.splice(0,S),w.D=p,O}function iu(p){if(!p.g&&!p.u){p.Y=1;var w=p.Fa;te||Ee(),K||(te(),K=!0),ne.add(w,p),p.v=0}}function xh(p){return p.g||p.u||3<=p.v?!1:(p.Y++,p.u=ke(m(p.Fa,p),ou(p,p.v)),p.v++,!0)}n.Fa=function(){if(this.u=null,Ah(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var p=2*this.R;this.j.info("BP detection timer enabled: "+p),this.A=ke(m(this.ab,this),p)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Jn(10),tu(this),Ah(this))};function ru(p){p.A!=null&&(a.clearTimeout(p.A),p.A=null)}function Ah(p){p.g=new ps(p,p.j,"rpc",p.Y),p.m===null&&(p.g.H=p.o),p.g.O=0;var w=ei(p.qa);Nt(w,"RID","rpc"),Nt(w,"SID",p.K),Nt(w,"AID",p.T),Nt(w,"CI",p.F?"0":"1"),!p.F&&p.ja&&Nt(w,"TO",p.ja),Nt(w,"TYPE","xmlhttp"),ha(p,w),p.m&&p.o&&Dl(w,p.m,p.o),p.L&&(p.g.I=p.L);var S=p.g;p=p.ia,S.L=1,S.v=ca(ei(w)),S.m=null,S.P=!0,hm(S,p)}n.Za=function(){this.C!=null&&(this.C=null,tu(this),xh(this),Jn(19))};function su(p){p.C!=null&&(a.clearTimeout(p.C),p.C=null)}function bm(p,w){var S=null;if(p.g==w){su(p),ru(p),p.g=null;var O=2}else if(gs(p.h,w))S=w.D,Jc(p.h,w),O=1;else return;if(p.G!=0){if(w.o)if(O==1){S=w.m?w.m.length:0,w=Date.now()-w.F;var Y=p.B;O=sa(),Cn(O,new Yi(O,S)),nu(p)}else iu(p);else if(Y=w.s,Y==3||Y==0&&0<w.X||!(O==1&&wm(p,w)||O==2&&xh(p)))switch(S&&0<S.length&&(w=p.h,w.i=w.i.concat(S)),Y){case 1:ho(p,5);break;case 4:ho(p,10);break;case 3:ho(p,6);break;default:ho(p,2)}}}function ou(p,w){let S=p.Ta+Math.floor(Math.random()*p.cb);return p.isActive()||(S*=2),S*w}function ho(p,w){if(p.j.info("Error code "+w),w==2){var S=m(p.fb,p),O=p.Xa;let Y=!O;O=new wr(O||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||rn(O,"https"),ca(O),Y?Th(O.toString(),S):wh(O.toString(),S)}else Jn(2);p.G=0,p.l&&p.l.sa(w),Dh(p),Xi(p)}n.fb=function(p){p?(this.j.info("Successfully pinged google.com"),Jn(2)):(this.j.info("Failed to ping google.com"),Jn(1))};function Dh(p){if(p.G=0,p.ka=[],p.l){let w=Xe(p.h);(w.length!=0||p.i.length!=0)&&(T(p.ka,w),T(p.ka,p.i),p.h.i.length=0,E(p.i),p.i.length=0),p.l.ra()}}function Ph(p,w,S){var O=S instanceof wr?ei(S):new wr(S);if(O.g!="")w&&(O.g=w+"."+O.g),br(O,O.s);else{var Y=a.location;O=Y.protocol,w=w?w+"."+Y.hostname:Y.hostname,Y=+Y.port;var J=new wr(null);O&&rn(J,O),w&&(J.g=w),Y&&br(J,Y),S&&(J.l=S),O=J}return S=p.D,w=p.ya,S&&w&&Nt(O,S,w),Nt(O,"VER",p.la),ha(p,O),O}function kl(p,w,S){if(w&&!p.J)throw Error("Can't create secondary domain capable XhrIo object.");return w=p.Ca&&!p.pa?new on(new dn({eb:S})):new on(p.pa),w.Ha(p.J),w}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function _s(){}n=_s.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function au(){}au.prototype.g=function(p,w){return new Nn(p,w)};function Nn(p,w){wn.call(this),this.g=new Tm(w),this.l=p,this.h=w&&w.messageUrlParams||null,p=w&&w.messageHeaders||null,w&&w.clientProtocolHeaderRequired&&(p?p["X-Client-Protocol"]="webchannel":p={"X-Client-Protocol":"webchannel"}),this.g.o=p,p=w&&w.initMessageHeaders||null,w&&w.messageContentType&&(p?p["X-WebChannel-Content-Type"]=w.messageContentType:p={"X-WebChannel-Content-Type":w.messageContentType}),w&&w.va&&(p?p["X-WebChannel-Client-Profile"]=w.va:p={"X-WebChannel-Client-Profile":w.va}),this.g.S=p,(p=w&&w.Sb)&&!D(p)&&(this.g.m=p),this.v=w&&w.supportsCrossDomainXhr||!1,this.u=w&&w.sendRawJson||!1,(w=w&&w.httpSessionIdParam)&&!D(w)&&(this.g.D=w,p=this.h,p!==null&&w in p&&(p=this.h,w in p&&delete p[w])),this.j=new fo(this)}v(Nn,wn),Nn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Nn.prototype.close=function(){Ml(this.g)},Nn.prototype.o=function(p){var w=this.g;if(typeof p=="string"){var S={};S.__data__=p,p=S}else this.u&&(S={},S.__data__=ah(p),p=S);w.i.push(new bl(w.Ya++,p)),w.G==3&&nu(w)},Nn.prototype.N=function(){this.g.l=null,delete this.j,Ml(this.g),delete this.g,Nn.aa.N.call(this)};function vi(p){ch.call(this),p.__headers__&&(this.headers=p.__headers__,this.statusCode=p.__status__,delete p.__headers__,delete p.__status__);var w=p.__sm__;if(w){e:{for(let S in w){p=S;break e}p=void 0}(this.i=p)&&(p=this.i,w=w!==null&&p in w?w[p]:void 0),this.data=w}else this.data=p}v(vi,ch);function Rh(){uh.call(this),this.status=1}v(Rh,uh);function fo(p){this.g=p}v(fo,_s),fo.prototype.ua=function(){Cn(this.g,"a")},fo.prototype.ta=function(p){Cn(this.g,new vi(p))},fo.prototype.sa=function(p){Cn(this.g,new Rh)},fo.prototype.ra=function(){Cn(this.g,"b")},au.prototype.createWebChannel=au.prototype.g,Nn.prototype.send=Nn.prototype.o,Nn.prototype.open=Nn.prototype.m,Nn.prototype.close=Nn.prototype.close,jS=Ho.createWebChannelTransport=function(){return new au},$S=Ho.getStatEventTarget=function(){return sa()},US=Ho.Event=oo,Wy=Ho.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ur.NO_ERROR=0,Ur.TIMEOUT=8,Ur.HTTP_ERROR=6,np=Ho.ErrorCode=Ur,hh.COMPLETE="complete",BS=Ho.EventType=hh,rm.EventType=El,El.OPEN="a",El.CLOSE="b",El.ERROR="c",El.MESSAGE="d",wn.prototype.listen=wn.prototype.K,fd=Ho.WebChannel=rm,dQ=Ho.FetchXmlHttpFactory=dn,on.prototype.listenOnce=on.prototype.L,on.prototype.getLastError=on.prototype.Ka,on.prototype.getLastErrorCode=on.prototype.Ba,on.prototype.getStatus=on.prototype.Z,on.prototype.getResponseJson=on.prototype.Oa,on.prototype.getResponseText=on.prototype.oa,on.prototype.send=on.prototype.ea,on.prototype.setWithCredentials=on.prototype.Ha,VS=Ho.XhrIo=on}).apply(typeof qy<"u"?qy:typeof self<"u"?self:typeof window<"u"?window:{});var EF="@firebase/firestore";var Kn=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Kn.UNAUTHENTICATED=new Kn(null),Kn.GOOGLE_CREDENTIALS=new Kn("google-credentials-uid"),Kn.FIRST_PARTY=new Kn("first-party-uid"),Kn.MOCK_USER=new Kn("mock-user");var Md="10.14.0";var bc=new qa("@firebase/firestore");function ip(){return bc.logLevel}function Le(n,...e){if(bc.logLevel<=wt.DEBUG){let t=e.map(xx);bc.debug(`Firestore (${Md}): ${n}`,...t)}}function Wo(n,...e){if(bc.logLevel<=wt.ERROR){let t=e.map(xx);bc.error(`Firestore (${Md}): ${n}`,...t)}}function Td(n,...e){if(bc.logLevel<=wt.WARN){let t=e.map(xx);bc.warn(`Firestore (${Md}): ${n}`,...t)}}function xx(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function ze(n="Unexpected state"){let e=`FIRESTORE (${Md}) INTERNAL ASSERTION FAILED: `+n;throw Wo(e),new Error(e)}function Gt(n,e){n||ze()}function Ze(n,e){return n}var se={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},be=class extends dr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var rs=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Xy=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},WS=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Kn.UNAUTHENTICATED))}shutdown(){}},KS=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},YS=class{constructor(e){this.t=e,this.currentUser=Kn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Gt(this.o===void 0);let i=this.i,r=l=>this.i!==i?(i=this.i,t(l)):Promise.resolve(),s=new rs;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new rs,e.enqueueRetryable(()=>r(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>U(this,null,function*(){yield l.promise,yield r(this.currentUser)}))},a=l=>{Le("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?a(l):(Le("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new rs)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(Le("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(Gt(typeof i.accessToken=="string"),new Xy(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Gt(e===null||typeof e=="string"),new Kn(e)}},QS=class{constructor(e,t,i){this.l=e,this.h=t,this.P=i,this.type="FirstParty",this.user=Kn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},ZS=class{constructor(e,t,i){this.l=e,this.h=t,this.P=i}getToken(){return Promise.resolve(new QS(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Kn.FIRST_PARTY))}shutdown(){}invalidateToken(){}},XS=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},JS=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Gt(this.o===void 0);let i=s=>{s.error!=null&&Le("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,Le("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};let r=s=>{Le("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?r(s):Le("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Gt(typeof t.token=="string"),this.R=t.token,new XS(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function hQ(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}var Jy=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,i="";for(;i.length<20;){let r=hQ(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%e.length))}return i}};function kt(n,e){return n<e?-1:n>e?1:0}function wd(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}var vn=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new be(se.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new be(se.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new be(se.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new be(se.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new n(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?kt(this.nanoseconds,e.nanoseconds):kt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var it=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new vn(0,0))}static max(){return new n(new vn(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var ev=class n{constructor(e,t,i){t===void 0?t=0:t>e.length&&ze(),i===void 0?i=e.length-t:i>e.length-t&&ze(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let i=Math.min(e.length,t.length);for(let r=0;r<i;r++){let s=e.get(r),o=t.get(r);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},cn=class n extends ev{construct(e,t,i){return new n(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let i of e){if(i.indexOf("//")>=0)throw new be(se.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new n(t)}static emptyPath(){return new n([])}},fQ=/^[_a-zA-Z][_a-zA-Z0-9]*$/,fr=class n extends ev{construct(e,t,i){return new n(e,t,i)}static isValidIdentifier(e){return fQ.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],i="",r=0,s=()=>{if(i.length===0)throw new be(se.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""},o=!1;for(;r<e.length;){let a=e[r];if(a==="\\"){if(r+1===e.length)throw new be(se.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new be(se.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=l,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(i+=a,r++):(s(),r++)}if(s(),o)throw new be(se.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var Ue=class n{constructor(e){this.path=e}static fromPath(e){return new n(cn.fromString(e))}static fromName(e){return new n(cn.fromString(e).popFirst(5))}static empty(){return new n(cn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&cn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return cn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new cn(e.slice()))}};var eC=class{constructor(e,t,i,r){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=r}};eC.UNKNOWN_ID=-1;function pQ(n,e){let t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=it.fromTimestamp(i===1e9?new vn(t+1,0):new vn(t,i));return new Ic(r,Ue.empty(),e)}function mQ(n){return new Ic(n.readTime,n.key,-1)}var Ic=class n{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new n(it.min(),Ue.empty(),-1)}static max(){return new n(it.max(),Ue.empty(),-1)}};function gQ(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ue.comparator(n.documentKey,e.documentKey),t!==0?t:kt(n.largestBatchId,e.largestBatchId))}var yQ="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",tC=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Sp(n){return U(this,null,function*(){if(n.code!==se.FAILED_PRECONDITION||n.message!==yQ)throw n;Le("LocalStore","Unexpectedly lost primary lease")})}var _e=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ze(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,i)=>{t(e)})}static reject(e){return new n((t,i)=>{i(e)})}static waitFor(e){return new n((t,i)=>{let r=0,s=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&t()},l=>i(l))}),o=!0,s===r&&t()})}static or(e){let t=n.resolve(!1);for(let i of e)t=t.next(r=>r?n.resolve(r):i());return t}static forEach(e,t){let i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new n((i,r)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let u=l;t(e[u]).next(d=>{o[u]=d,++a,a===s&&i(o)},d=>r(d))}})}static doWhile(e,t){return new n((i,r)=>{let s=()=>{e()===!0?t().next(()=>{s()},r):i()};s()})}};function vQ(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Cp(n){return n.name==="IndexedDbTransactionError"}var e2=(()=>{class n{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=r=>this.ie(r),this.se=r=>i.writeSequenceNumber(r))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function Mv(n){return n==null}function lp(n){return n===0&&1/n==-1/0}function _Q(n){return typeof n=="number"&&Number.isInteger(n)&&!lp(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var EQ=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ype=[...EQ,"documentOverlays"],TQ=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],wQ=TQ,bQ=[...wQ,"indexConfiguration","indexState","indexEntries"];var vpe=[...bQ,"globals"];function TF(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Dc(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function t2(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var _n=class n{constructor(e,t){this.comparator=e,this.root=t||Gs.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Gs.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Gs.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){let r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){let e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new yd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new yd(this.root,e,this.comparator,!1)}getReverseIterator(){return new yd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new yd(this.root,e,this.comparator,!0)}},yd=class{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Gs=class n{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=i??n.RED,this.left=r??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new n(e??this.key,t??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this,s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return n.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ze();let e=this.left.check();if(e!==this.right.check())throw ze();return e+(this.isRed()?0:1)}};Gs.EMPTY=null,Gs.RED=!0,Gs.BLACK=!1;Gs.EMPTY=new class{constructor(){this.size=0}get key(){throw ze()}get value(){throw ze()}get color(){throw ze()}get left(){throw ze()}get right(){throw ze()}copy(e,t,i,r,s){return this}insert(e,t,i){return new Gs(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var pi=class n{constructor(e){this.comparator=e,this.data=new _n(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){let i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){let r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new tv(this.data.getIterator())}getIteratorFrom(e){return new tv(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},tv=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Or=class n{constructor(e){this.fields=e,e.sort(fr.comparator)}static empty(){return new n([])}unionWith(e){let t=new pi(fr.comparator);for(let i of this.fields)t=t.add(i);for(let i of e)t=t.add(i);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return wd(this.fields,e.fields,(t,i)=>t.isEqual(i))}};var nv=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var mi=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new nv("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(r){let s="";for(let o=0;o<r.length;++o)s+=String.fromCharCode(r[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return kt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};mi.EMPTY_BYTE_STRING=new mi("");var IQ=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ko(n){if(Gt(!!n),typeof n=="string"){let e=0,t=IQ.exec(n);if(Gt(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}let i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ln(n.seconds),nanos:ln(n.nanos)}}function ln(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function nl(n){return typeof n=="string"?mi.fromBase64String(n):mi.fromUint8Array(n)}function kv(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Ax(n){let e=n.mapValue.fields.__previous_value__;return kv(e)?Ax(e):e}function cp(n){let e=Ko(n.mapValue.fields.__local_write_time__.timestampValue);return new vn(e.seconds,e.nanos)}var nC=class{constructor(e,t,i,r,s,o,a,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u}},iv=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Ky={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Sc(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?kv(n)?4:i2(n)?9007199254740991:n2(n)?10:11:ze()}function qs(n,e){if(n===e)return!0;let t=Sc(n);if(t!==Sc(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return cp(n).isEqual(cp(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;let o=Ko(r.timestampValue),a=Ko(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,s){return nl(r.bytesValue).isEqual(nl(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return ln(r.geoPointValue.latitude)===ln(s.geoPointValue.latitude)&&ln(r.geoPointValue.longitude)===ln(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return ln(r.integerValue)===ln(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){let o=ln(r.doubleValue),a=ln(s.doubleValue);return o===a?lp(o)===lp(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return wd(n.arrayValue.values||[],e.arrayValue.values||[],qs);case 10:case 11:return function(r,s){let o=r.mapValue.fields||{},a=s.mapValue.fields||{};if(TF(o)!==TF(a))return!1;for(let l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!qs(o[l],a[l])))return!1;return!0}(n,e);default:return ze()}}function up(n,e){return(n.values||[]).find(t=>qs(t,e))!==void 0}function bd(n,e){if(n===e)return 0;let t=Sc(n),i=Sc(e);if(t!==i)return kt(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return kt(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=ln(s.integerValue||s.doubleValue),l=ln(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return wF(n.timestampValue,e.timestampValue);case 4:return wF(cp(n),cp(e));case 5:return kt(n.stringValue,e.stringValue);case 6:return function(s,o){let a=nl(s),l=nl(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){let d=kt(a[u],l[u]);if(d!==0)return d}return kt(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=kt(ln(s.latitude),ln(o.latitude));return a!==0?a:kt(ln(s.longitude),ln(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return bF(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,l,u,d;let f=s.fields||{},m=o.fields||{},y=(a=f.value)===null||a===void 0?void 0:a.arrayValue,v=(l=m.value)===null||l===void 0?void 0:l.arrayValue,E=kt(((u=y?.values)===null||u===void 0?void 0:u.length)||0,((d=v?.values)===null||d===void 0?void 0:d.length)||0);return E!==0?E:bF(y,v)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===Ky.mapValue&&o===Ky.mapValue)return 0;if(s===Ky.mapValue)return 1;if(o===Ky.mapValue)return-1;let a=s.fields||{},l=Object.keys(a),u=o.fields||{},d=Object.keys(u);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){let m=kt(l[f],d[f]);if(m!==0)return m;let y=bd(a[l[f]],u[d[f]]);if(y!==0)return y}return kt(l.length,d.length)}(n.mapValue,e.mapValue);default:throw ze()}}function wF(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return kt(n,e);let t=Ko(n),i=Ko(e),r=kt(t.seconds,i.seconds);return r!==0?r:kt(t.nanos,i.nanos)}function bF(n,e){let t=n.values||[],i=e.values||[];for(let r=0;r<t.length&&r<i.length;++r){let s=bd(t[r],i[r]);if(s)return s}return kt(t.length,i.length)}function Id(n){return iC(n)}function iC(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let i=Ko(t);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return nl(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Ue.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let i="[",r=!0;for(let s of t.values||[])r?r=!1:i+=",",i+=iC(s);return i+"]"}(n.arrayValue):"mapValue"in n?function(t){let i=Object.keys(t.fields||{}).sort(),r="{",s=!0;for(let o of i)s?s=!1:r+=",",r+=`${o}:${iC(t.fields[o])}`;return r+"}"}(n.mapValue):ze()}function rv(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function rC(n){return!!n&&"integerValue"in n}function Dx(n){return!!n&&"arrayValue"in n}function IF(n){return!!n&&"nullValue"in n}function SF(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Qy(n){return!!n&&"mapValue"in n}function n2(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function sp(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Dc(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=sp(i)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=sp(n.arrayValue.values[t]);return e}return Object.assign({},n)}function i2(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var hr=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!Qy(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=sp(t)}setAll(e){let t=fr.emptyPath(),i={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,i,r),i={},r=[],t=a.popLast()}o?i[a.lastSegment()]=sp(o):r.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){let t=this.field(e.popLast());Qy(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return qs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];Qy(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){Dc(t,(r,s)=>e[r]=s);for(let r of i)delete e[r]}clone(){return new n(sp(this.value))}};function r2(n){let e=[];return Dc(n.fields,(t,i)=>{let r=new fr([t]);if(Qy(i)){let s=r2(i.mapValue).fields;if(s.length===0)e.push(r);else for(let o of s)e.push(r.child(o))}else e.push(r)}),new Or(e)}var ss=class n{constructor(e,t,i,r,s,o,a){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,it.min(),it.min(),it.min(),hr.empty(),0)}static newFoundDocument(e,t,i,r){return new n(e,1,t,it.min(),i,r,0)}static newNoDocument(e,t){return new n(e,2,t,it.min(),it.min(),hr.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,it.min(),it.min(),hr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(it.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=hr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=hr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=it.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var il=class{constructor(e,t){this.position=e,this.inclusive=t}};function CF(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){let s=e[r],o=n.position[r];if(s.field.isKeyField()?i=Ue.comparator(Ue.fromName(o.referenceValue),t.key):i=bd(o,t.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function xF(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!qs(n.position[t],e.position[t]))return!1;return!0}var Cc=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function SQ(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var sv=class{},On=class n extends sv{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new oC(e,t,i):t==="array-contains"?new cC(e,i):t==="in"?new uC(e,i):t==="not-in"?new dC(e,i):t==="array-contains-any"?new hC(e,i):new n(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new aC(e,i):new lC(e,i)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(bd(t,this.value)):t!==null&&Sc(this.value)===Sc(t)&&this.matchesComparison(bd(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ze()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},os=class n extends sv{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return s2(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function s2(n){return n.op==="and"}function o2(n){return CQ(n)&&s2(n)}function CQ(n){for(let e of n.filters)if(e instanceof os)return!1;return!0}function sC(n){if(n instanceof On)return n.field.canonicalString()+n.op.toString()+Id(n.value);if(o2(n))return n.filters.map(e=>sC(e)).join(",");{let e=n.filters.map(t=>sC(t)).join(",");return`${n.op}(${e})`}}function a2(n,e){return n instanceof On?function(i,r){return r instanceof On&&i.op===r.op&&i.field.isEqual(r.field)&&qs(i.value,r.value)}(n,e):n instanceof os?function(i,r){return r instanceof os&&i.op===r.op&&i.filters.length===r.filters.length?i.filters.reduce((s,o,a)=>s&&a2(o,r.filters[a]),!0):!1}(n,e):void ze()}function l2(n){return n instanceof On?function(t){return`${t.field.canonicalString()} ${t.op} ${Id(t.value)}`}(n):n instanceof os?function(t){return t.op.toString()+" {"+t.getFilters().map(l2).join(" ,")+"}"}(n):"Filter"}var oC=class extends On{constructor(e,t,i){super(e,t,i),this.key=Ue.fromName(i.referenceValue)}matches(e){let t=Ue.comparator(e.key,this.key);return this.matchesComparison(t)}},aC=class extends On{constructor(e,t){super(e,"in",t),this.keys=c2("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},lC=class extends On{constructor(e,t){super(e,"not-in",t),this.keys=c2("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function c2(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>Ue.fromName(i.referenceValue))}var cC=class extends On{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Dx(t)&&up(t.arrayValue,this.value)}},uC=class extends On{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&up(this.value.arrayValue,t)}},dC=class extends On{constructor(e,t){super(e,"not-in",t)}matches(e){if(up(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!up(this.value.arrayValue,t)}},hC=class extends On{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Dx(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>up(this.value.arrayValue,i))}};var fC=class{constructor(e,t=null,i=[],r=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function AF(n,e=null,t=[],i=[],r=null,s=null,o=null){return new fC(n,e,t,i,r,s,o)}function Px(n){let e=Ze(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>sC(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),Mv(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>Id(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>Id(i)).join(",")),e.ue=t}return e.ue}function Rx(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!SQ(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!a2(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!xF(n.startAt,e.startAt)&&xF(n.endAt,e.endAt)}function pC(n){return Ue.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var Yo=class{constructor(e,t=null,i=[],r=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function xQ(n,e,t,i,r,s,o,a){return new Yo(n,e,t,i,r,s,o,a)}function Lv(n){return new Yo(n)}function DF(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Mx(n){return n.collectionGroup!==null}function vd(n){let e=Ze(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new pi(fr.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Cc(s,i))}),t.has(fr.keyField().canonicalString())||e.ce.push(new Cc(fr.keyField(),i))}return e.ce}function zs(n){let e=Ze(n);return e.le||(e.le=AQ(e,vd(n))),e.le}function AQ(n,e){if(n.limitType==="F")return AF(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{let s=r.dir==="desc"?"asc":"desc";return new Cc(r.field,s)});let t=n.endAt?new il(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new il(n.startAt.position,n.startAt.inclusive):null;return AF(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function mC(n,e){let t=n.filters.concat([e]);return new Yo(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function ov(n,e,t){return new Yo(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ov(n,e){return Rx(zs(n),zs(e))&&n.limitType===e.limitType}function u2(n){return`${Px(zs(n))}|lt:${n.limitType}`}function pd(n){return`Query(target=${function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map(r=>l2(r)).join(", ")}]`),Mv(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(r=>Id(r)).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(r=>Id(r)).join(",")),`Target(${i})`}(zs(n))}; limitType=${n.limitType})`}function Nv(n,e){return e.isFoundDocument()&&function(i,r){let s=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):Ue.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)}(n,e)&&function(i,r){for(let s of vd(i))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(n,e)&&function(i,r){for(let s of i.filters)if(!s.matches(r))return!1;return!0}(n,e)&&function(i,r){return!(i.startAt&&!function(o,a,l){let u=CF(o,a,l);return o.inclusive?u<=0:u<0}(i.startAt,vd(i),r)||i.endAt&&!function(o,a,l){let u=CF(o,a,l);return o.inclusive?u>=0:u>0}(i.endAt,vd(i),r))}(n,e)}function DQ(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function d2(n){return(e,t)=>{let i=!1;for(let r of vd(n)){let s=PQ(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function PQ(n,e,t){let i=n.field.isKeyField()?Ue.comparator(e.key,t.key):function(s,o,a){let l=o.data.field(s),u=a.data.field(s);return l!==null&&u!==null?bd(l,u):ze()}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return ze()}}var rl=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(let[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Dc(this.inner,(t,i)=>{for(let[r,s]of i)e(r,s)})}isEmpty(){return t2(this.inner)}size(){return this.innerSize}};var RQ=new _n(Ue.comparator);function Qo(){return RQ}var h2=new _n(Ue.comparator);function rp(...n){let e=h2;for(let t of n)e=e.insert(t.key,t);return e}function f2(n){let e=h2;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function Ec(){return op()}function p2(){return op()}function op(){return new rl(n=>n.toString(),(n,e)=>n.isEqual(e))}var MQ=new _n(Ue.comparator),kQ=new pi(Ue.comparator);function bt(...n){let e=kQ;for(let t of n)e=e.add(t);return e}var LQ=new pi(kt);function OQ(){return LQ}function kx(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:lp(e)?"-0":e}}function m2(n){return{integerValue:""+n}}function g2(n,e){return _Q(e)?m2(e):kx(n,e)}var Sd=class{constructor(){this._=void 0}};function NQ(n,e,t){return n instanceof Cd?function(r,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&kv(s)&&(s=Ax(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof sl?v2(n,e):n instanceof ol?_2(n,e):function(r,s){let o=y2(r,s),a=PF(o)+PF(r.Pe);return rC(o)&&rC(r.Pe)?m2(a):kx(r.serializer,a)}(n,e)}function FQ(n,e,t){return n instanceof sl?v2(n,e):n instanceof ol?_2(n,e):t}function y2(n,e){return n instanceof xc?function(i){return rC(i)||function(s){return!!s&&"doubleValue"in s}(i)}(e)?e:{integerValue:0}:null}var Cd=class extends Sd{},sl=class extends Sd{constructor(e){super(),this.elements=e}};function v2(n,e){let t=E2(e);for(let i of n.elements)t.some(r=>qs(r,i))||t.push(i);return{arrayValue:{values:t}}}var ol=class extends Sd{constructor(e){super(),this.elements=e}};function _2(n,e){let t=E2(e);for(let i of n.elements)t=t.filter(r=>!qs(r,i));return{arrayValue:{values:t}}}var xc=class extends Sd{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function PF(n){return ln(n.integerValue||n.doubleValue)}function E2(n){return Dx(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var dp=class{constructor(e,t){this.field=e,this.transform=t}};function VQ(n,e){return n.field.isEqual(e.field)&&function(i,r){return i instanceof sl&&r instanceof sl||i instanceof ol&&r instanceof ol?wd(i.elements,r.elements,qs):i instanceof xc&&r instanceof xc?qs(i.Pe,r.Pe):i instanceof Cd&&r instanceof Cd}(n.transform,e.transform)}var gC=class{constructor(e,t){this.version=e,this.transformResults=t}},qo=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Zy(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var xd=class{};function T2(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new hp(n.key,qo.none()):new Ac(n.key,n.data,qo.none());{let t=n.data,i=hr.empty(),r=new pi(fr.comparator);for(let s of e.fields)if(!r.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?i.delete(s):i.set(s,o),r=r.add(s)}return new Ws(n.key,i,new Or(r.toArray()),qo.none())}}function BQ(n,e,t){n instanceof Ac?function(r,s,o){let a=r.value.clone(),l=MF(r.fieldTransforms,s,o.transformResults);a.setAll(l),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Ws?function(r,s,o){if(!Zy(r.precondition,s))return void s.convertToUnknownDocument(o.version);let a=MF(r.fieldTransforms,s,o.transformResults),l=s.data;l.setAll(w2(r)),l.setAll(a),s.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(r,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function ap(n,e,t,i){return n instanceof Ac?function(s,o,a,l){if(!Zy(s.precondition,o))return a;let u=s.value.clone(),d=kF(s.fieldTransforms,l,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,i):n instanceof Ws?function(s,o,a,l){if(!Zy(s.precondition,o))return a;let u=kF(s.fieldTransforms,l,o),d=o.data;return d.setAll(w2(s)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(f=>f.field))}(n,e,t,i):function(s,o,a){return Zy(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function UQ(n,e){let t=null;for(let i of n.fieldTransforms){let r=e.data.field(i.field),s=y2(i.transform,r||null);s!=null&&(t===null&&(t=hr.empty()),t.set(i.field,s))}return t||null}function RF(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&wd(i,r,(s,o)=>VQ(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Ac=class extends xd{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}},Ws=class extends xd{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function w2(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let i=n.data.field(t);e.set(t,i)}}),e}function MF(n,e,t){let i=new Map;Gt(n.length===t.length);for(let r=0;r<t.length;r++){let s=n[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,FQ(o,a,t[r]))}return i}function kF(n,e,t){let i=new Map;for(let r of n){let s=r.transform,o=t.data.field(r.field);i.set(r.field,NQ(s,o,e))}return i}var hp=class extends xd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},yC=class extends xd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var vC=class{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){let i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){let s=this.mutations[r];s.key.isEqual(e.key)&&BQ(s,e,i[r])}}applyToLocalView(e,t){for(let i of this.baseMutations)i.key.isEqual(e.key)&&(t=ap(i,e,t,this.localWriteTime));for(let i of this.mutations)i.key.isEqual(e.key)&&(t=ap(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let i=p2();return this.mutations.forEach(r=>{let s=e.get(r.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(r.key)?null:a;let l=T2(o,a);l!==null&&i.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(it.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),bt())}isEqual(e){return this.batchId===e.batchId&&wd(this.mutations,e.mutations,(t,i)=>RF(t,i))&&wd(this.baseMutations,e.baseMutations,(t,i)=>RF(t,i))}},_C=class n{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){Gt(e.mutations.length===i.length);let r=function(){return MQ}(),s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new n(e,t,i,r)}};var EC=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var TC=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var kn,xt;function $Q(n){switch(n){default:return ze();case se.CANCELLED:case se.UNKNOWN:case se.DEADLINE_EXCEEDED:case se.RESOURCE_EXHAUSTED:case se.INTERNAL:case se.UNAVAILABLE:case se.UNAUTHENTICATED:return!1;case se.INVALID_ARGUMENT:case se.NOT_FOUND:case se.ALREADY_EXISTS:case se.PERMISSION_DENIED:case se.FAILED_PRECONDITION:case se.ABORTED:case se.OUT_OF_RANGE:case se.UNIMPLEMENTED:case se.DATA_LOSS:return!0}}function b2(n){if(n===void 0)return Wo("GRPC error has no .code"),se.UNKNOWN;switch(n){case kn.OK:return se.OK;case kn.CANCELLED:return se.CANCELLED;case kn.UNKNOWN:return se.UNKNOWN;case kn.DEADLINE_EXCEEDED:return se.DEADLINE_EXCEEDED;case kn.RESOURCE_EXHAUSTED:return se.RESOURCE_EXHAUSTED;case kn.INTERNAL:return se.INTERNAL;case kn.UNAVAILABLE:return se.UNAVAILABLE;case kn.UNAUTHENTICATED:return se.UNAUTHENTICATED;case kn.INVALID_ARGUMENT:return se.INVALID_ARGUMENT;case kn.NOT_FOUND:return se.NOT_FOUND;case kn.ALREADY_EXISTS:return se.ALREADY_EXISTS;case kn.PERMISSION_DENIED:return se.PERMISSION_DENIED;case kn.FAILED_PRECONDITION:return se.FAILED_PRECONDITION;case kn.ABORTED:return se.ABORTED;case kn.OUT_OF_RANGE:return se.OUT_OF_RANGE;case kn.UNIMPLEMENTED:return se.UNIMPLEMENTED;case kn.DATA_LOSS:return se.DATA_LOSS;default:return ze()}}(xt=kn||(kn={}))[xt.OK=0]="OK",xt[xt.CANCELLED=1]="CANCELLED",xt[xt.UNKNOWN=2]="UNKNOWN",xt[xt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",xt[xt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",xt[xt.NOT_FOUND=5]="NOT_FOUND",xt[xt.ALREADY_EXISTS=6]="ALREADY_EXISTS",xt[xt.PERMISSION_DENIED=7]="PERMISSION_DENIED",xt[xt.UNAUTHENTICATED=16]="UNAUTHENTICATED",xt[xt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",xt[xt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",xt[xt.ABORTED=10]="ABORTED",xt[xt.OUT_OF_RANGE=11]="OUT_OF_RANGE",xt[xt.UNIMPLEMENTED=12]="UNIMPLEMENTED",xt[xt.INTERNAL=13]="INTERNAL",xt[xt.UNAVAILABLE=14]="UNAVAILABLE",xt[xt.DATA_LOSS=15]="DATA_LOSS";var LF=null;function jQ(){return new TextEncoder}var GQ=new el([4294967295,4294967295],0);function OF(n){let e=jQ().encode(n),t=new FS;return t.update(e),new Uint8Array(t.digest())}function NF(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new el([t,i],0),new el([r,s],0)]}var wC=class n{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new Tc(`Invalid padding: ${t}`);if(i<0)throw new Tc(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new Tc(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new Tc(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=el.fromNumber(this.Ie)}Ee(e,t,i){let r=e.add(t.multiply(el.fromNumber(i)));return r.compare(GQ)===1&&(r=new el([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=OF(e),[i,r]=NF(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(i,r,s);if(!this.de(o))return!1}return!0}static create(e,t,i){let r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,r,t);return i.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=OF(e),[i,r]=NF(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(i,r,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}},Tc=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var av=class n{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){let r=new Map;return r.set(e,fp.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new n(it.min(),r,new _n(kt),Qo(),bt())}},fp=class n{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new n(i,t,bt(),bt(),bt())}};var _d=class{constructor(e,t,i,r){this.Re=e,this.removedTargetIds=t,this.key=i,this.Ve=r}},lv=class{constructor(e,t){this.targetId=e,this.me=t}},cv=class{constructor(e,t,i=mi.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}},uv=class{constructor(){this.fe=0,this.ge=VF(),this.pe=mi.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=bt(),t=bt(),i=bt();return this.ge.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:ze()}}),new fp(this.pe,this.ye,e,t,i)}Ce(){this.we=!1,this.ge=VF()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Gt(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},bC=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=Qo(),this.qe=FF(),this.Qe=new _n(kt)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let i=this.Ge(t);switch(e.state){case 0:this.ze(t)&&i.De(e.resumeToken);break;case 1:i.Oe(),i.Se||i.Ce(),i.De(e.resumeToken);break;case 2:i.Oe(),i.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(i.Ne(),i.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),i.De(e.resumeToken));break;default:ze()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((i,r)=>{this.ze(r)&&t(r)})}He(e){let t=e.targetId,i=e.me.count,r=this.Je(t);if(r){let s=r.target;if(pC(s))if(i===0){let o=new Ue(s.path);this.Ue(t,o,ss.newNoDocument(o,it.min()))}else Gt(i===1);else{let o=this.Ye(t);if(o!==i){let a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);let u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,u)}LF?.et(function(d,f,m,y,v){var E,T,C,D,P,V;let G={localCacheCount:d,existenceFilterCount:f.count,databaseId:m.database,projectId:m.projectId},H=f.unchangedNames;return H&&(G.bloomFilter={applied:v===0,hashCount:(E=H?.hashCount)!==null&&E!==void 0?E:0,bitmapLength:(D=(C=(T=H?.bits)===null||T===void 0?void 0:T.bitmap)===null||C===void 0?void 0:C.length)!==null&&D!==void 0?D:0,padding:(V=(P=H?.bits)===null||P===void 0?void 0:P.padding)!==null&&V!==void 0?V:0,mightContain:A=>{var x;return(x=y?.mightContain(A))!==null&&x!==void 0&&x}}),G}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=t,o,a;try{o=nl(i).toUint8Array()}catch(l){if(l instanceof nv)return Td("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new wC(o,r,s)}catch(l){return Td(l instanceof Tc?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,i){return t.me.count===i-this.nt(e,t.targetId)?0:2}nt(e,t){let i=this.Le.getRemoteKeysForTarget(t),r=0;return i.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),r++)}),r}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&pC(a.target)){let l=new Ue(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,ss.newNoDocument(l,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let i=bt();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let u=this.Je(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(i=i.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let r=new av(e,t,this.Qe,this.ke,i);return this.ke=Qo(),this.qe=FF(),this.Qe=new _n(kt),r}$e(e,t){if(!this.ze(e))return;let i=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,i),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,i){if(!this.ze(e))return;let r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),i&&(this.ke=this.ke.insert(t,i))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new uv,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new pi(kt),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||Le("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new uv),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function FF(){return new _n(Ue.comparator)}function VF(){return new _n(Ue.comparator)}var zQ={asc:"ASCENDING",desc:"DESCENDING"},HQ={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qQ={and:"AND",or:"OR"},IC=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function SC(n,e){return n.useProto3Json||Mv(e)?e:{value:e}}function dv(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function I2(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function WQ(n,e){return dv(n,e.toTimestamp())}function Hs(n){return Gt(!!n),it.fromTimestamp(function(t){let i=Ko(t);return new vn(i.seconds,i.nanos)}(n))}function Lx(n,e){return CC(n,e).canonicalString()}function CC(n,e){let t=function(r){return new cn(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function S2(n){let e=cn.fromString(n);return Gt(P2(e)),e}function xC(n,e){return Lx(n.databaseId,e.path)}function GS(n,e){let t=S2(e);if(t.get(1)!==n.databaseId.projectId)throw new be(se.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new be(se.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ue(x2(t))}function C2(n,e){return Lx(n.databaseId,e)}function KQ(n){let e=S2(n);return e.length===4?cn.emptyPath():x2(e)}function AC(n){return new cn(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function x2(n){return Gt(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function BF(n,e,t){return{name:xC(n,e),fields:t.value.mapValue.fields}}function YQ(n,e){let t;if("targetChange"in e){e.targetChange;let i=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:ze()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(u,d){return u.useProto3Json?(Gt(d===void 0||typeof d=="string"),mi.fromBase64String(d||"")):(Gt(d===void 0||d instanceof Buffer||d instanceof Uint8Array),mi.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){let d=u.code===void 0?se.UNKNOWN:b2(u.code);return new be(d,u.message||"")}(o);t=new cv(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;let i=e.documentChange;i.document,i.document.name,i.document.updateTime;let r=GS(n,i.document.name),s=Hs(i.document.updateTime),o=i.document.createTime?Hs(i.document.createTime):it.min(),a=new hr({mapValue:{fields:i.document.fields}}),l=ss.newFoundDocument(r,s,o,a),u=i.targetIds||[],d=i.removedTargetIds||[];t=new _d(u,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;let i=e.documentDelete;i.document;let r=GS(n,i.document),s=i.readTime?Hs(i.readTime):it.min(),o=ss.newNoDocument(r,s),a=i.removedTargetIds||[];t=new _d([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let i=e.documentRemove;i.document;let r=GS(n,i.document),s=i.removedTargetIds||[];t=new _d([],s,r,null)}else{if(!("filter"in e))return ze();{e.filter;let i=e.filter;i.targetId;let{count:r=0,unchangedNames:s}=i,o=new TC(r,s),a=i.targetId;t=new lv(a,o)}}return t}function QQ(n,e){let t;if(e instanceof Ac)t={update:BF(n,e.key,e.value)};else if(e instanceof hp)t={delete:xC(n,e.key)};else if(e instanceof Ws)t={update:BF(n,e.key,e.data),updateMask:sZ(e.fieldMask)};else{if(!(e instanceof yC))return ze();t={verify:xC(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(s,o){let a=o.transform;if(a instanceof Cd)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof sl)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ol)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof xc)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw ze()}(0,i))),e.precondition.isNone||(t.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:WQ(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:ze()}(n,e.precondition)),t}function ZQ(n,e){return n&&n.length>0?(Gt(e!==void 0),n.map(t=>function(r,s){let o=r.updateTime?Hs(r.updateTime):Hs(s);return o.isEqual(it.min())&&(o=Hs(s)),new gC(o,r.transformResults||[])}(t,e))):[]}function XQ(n,e){return{documents:[C2(n,e.path)]}}function JQ(n,e){let t={structuredQuery:{}},i=e.path,r;e.collectionGroup!==null?(r=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=C2(n,r);let s=function(u){if(u.length!==0)return D2(os.create(u,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(u){if(u.length!==0)return u.map(d=>function(m){return{field:md(m.field),direction:nZ(m.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=SC(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:t,parent:r}}function eZ(n){let e=KQ(n.parent),t=n.structuredQuery,i=t.from?t.from.length:0,r=null;if(i>0){Gt(i===1);let d=t.from[0];d.allDescendants?r=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(f){let m=A2(f);return m instanceof os&&o2(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(m=>function(v){return new Cc(gd(v.field),function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,Mv(m)?null:m}(t.limit));let l=null;t.startAt&&(l=function(f){let m=!!f.before,y=f.values||[];return new il(y,m)}(t.startAt));let u=null;return t.endAt&&(u=function(f){let m=!f.before,y=f.values||[];return new il(y,m)}(t.endAt)),xQ(e,r,o,s,a,"F",l,u)}function tZ(n,e){let t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ze()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function A2(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let i=gd(t.unaryFilter.field);return On.create(i,"==",{doubleValue:NaN});case"IS_NULL":let r=gd(t.unaryFilter.field);return On.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=gd(t.unaryFilter.field);return On.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=gd(t.unaryFilter.field);return On.create(o,"!=",{nullValue:"NULL_VALUE"});default:return ze()}}(n):n.fieldFilter!==void 0?function(t){return On.create(gd(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ze()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return os.create(t.compositeFilter.filters.map(i=>A2(i)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return ze()}}(t.compositeFilter.op))}(n):ze()}function nZ(n){return zQ[n]}function iZ(n){return HQ[n]}function rZ(n){return qQ[n]}function md(n){return{fieldPath:n.canonicalString()}}function gd(n){return fr.fromServerFormat(n.fieldPath)}function D2(n){return n instanceof On?function(t){if(t.op==="=="){if(SF(t.value))return{unaryFilter:{field:md(t.field),op:"IS_NAN"}};if(IF(t.value))return{unaryFilter:{field:md(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(SF(t.value))return{unaryFilter:{field:md(t.field),op:"IS_NOT_NAN"}};if(IF(t.value))return{unaryFilter:{field:md(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:md(t.field),op:iZ(t.op),value:t.value}}}(n):n instanceof os?function(t){let i=t.getFilters().map(r=>D2(r));return i.length===1?i[0]:{compositeFilter:{op:rZ(t.op),filters:i}}}(n):ze()}function sZ(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function P2(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var pp=class n{constructor(e,t,i,r,s=it.min(),o=it.min(),a=mi.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var DC=class{constructor(e){this.ct=e}};function oZ(n){let e=eZ({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ov(e,e.limit,"L"):e}var hv=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(ln(e.integerValue));else if("doubleValue"in e){let i=ln(e.doubleValue);isNaN(i)?this.dt(t,13):(this.dt(t,15),lp(i)?t.At(0):t.At(i))}else if("timestampValue"in e){let i=e.timestampValue;this.dt(t,20),typeof i=="string"&&(i=Ko(i)),t.Rt(`${i.seconds||""}`),t.At(i.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(nl(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let i=e.geoPointValue;this.dt(t,45),t.At(i.latitude||0),t.At(i.longitude||0)}else"mapValue"in e?i2(e)?this.dt(t,Number.MAX_SAFE_INTEGER):n2(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):ze()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let i=e.fields||{};this.dt(t,55);for(let r of Object.keys(i))this.Vt(r,t),this.Tt(i[r],t)}wt(e,t){var i,r;let s=e.fields||{};this.dt(t,53);let o="value",a=((r=(i=s[o].arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.length)||0;this.dt(t,15),t.At(ln(a)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let i=e.values||[];this.dt(t,50);for(let r of i)this.Tt(r,t)}yt(e,t){this.dt(t,37),Ue.fromName(e).path.forEach(i=>{this.dt(t,60),this.Dt(i,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};hv.vt=new hv;var PC=class{constructor(){this.un=new RC}addToCollectionParentIndex(e,t){return this.un.add(t),_e.resolve()}getCollectionParents(e,t){return _e.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return _e.resolve()}deleteFieldIndex(e,t){return _e.resolve()}deleteAllFieldIndexes(e){return _e.resolve()}createTargetIndexes(e,t){return _e.resolve()}getDocumentsMatchingTarget(e,t){return _e.resolve(null)}getIndexType(e,t){return _e.resolve(0)}getFieldIndexes(e,t){return _e.resolve([])}getNextCollectionGroupToUpdate(e){return _e.resolve(null)}getMinOffset(e,t){return _e.resolve(Ic.min())}getMinOffsetFromCollectionGroup(e,t){return _e.resolve(Ic.min())}updateCollectionGroup(e,t,i){return _e.resolve()}updateIndexEntries(e,t){return _e.resolve()}},RC=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new pi(cn.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new pi(cn.comparator)).toArray()}};var Epe=new Uint8Array(0);var js=class n{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};js.DEFAULT_COLLECTION_PERCENTILE=10,js.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,js.DEFAULT=new js(41943040,js.DEFAULT_COLLECTION_PERCENTILE,js.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),js.DISABLED=new js(-1,0,0);var mp=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var MC=class{constructor(){this.changes=new rl(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ss.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let i=this.changes.get(t);return i!==void 0?_e.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var kC=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var LC=class{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&ap(i.mutation,r,Or.empty(),vn.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,bt()).next(()=>i))}getLocalViewOfDocuments(e,t,i=bt()){let r=Ec();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let o=rp();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let i=Ec();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,bt()))}populateOverlays(e,t,i){let r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,i,r){let s=Qo(),o=op(),a=function(){return op()}();return t.forEach((l,u)=>{let d=i.get(u.key);r.has(u.key)&&(d===void 0||d.mutation instanceof Ws)?s=s.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),ap(d.mutation,u,d.mutation.getFieldMask(),vn.now())):o.set(u.key,Or.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((u,d)=>o.set(u,d)),t.forEach((u,d)=>{var f;return a.set(u,new kC(d,(f=o.get(u))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){let i=op(),r=new _n((o,a)=>o-a),s=bt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let u=t.get(l);if(u===null)return;let d=i.get(l)||Or.empty();d=a.applyToLocalView(u,d),i.set(l,d);let f=(r.get(a.batchId)||bt()).add(l);r=r.insert(a.batchId,f)})}).next(()=>{let o=[],a=r.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),u=l.key,d=l.value,f=p2();d.forEach(m=>{if(!s.has(m)){let y=T2(t.get(m),i.get(m));y!==null&&f.set(m,y),s=s.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return _e.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,r){return function(o){return Ue.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Mx(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,r):this.getDocumentsMatchingCollectionQuery(e,t,i,r)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{let o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):_e.resolve(Ec()),a=-1,l=s;return o.next(u=>_e.forEach(u,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),s.get(d)?_e.resolve():this.remoteDocumentCache.getEntry(e,d).next(m=>{l=l.insert(d,m)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,l,u,bt())).next(d=>({batchId:a,changes:f2(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ue(t)).next(i=>{let r=rp();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i,r){let s=t.collectionGroup,o=rp();return this.indexManager.getCollectionParents(e,s).next(a=>_e.forEach(a,l=>{let u=function(f,m){return new Yo(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,i,r).next(d=>{d.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,r))).next(o=>{s.forEach((l,u)=>{let d=u.getKey();o.get(d)===null&&(o=o.insert(d,ss.newInvalidDocument(d)))});let a=rp();return o.forEach((l,u)=>{let d=s.get(l);d!==void 0&&ap(d.mutation,u,Or.empty(),vn.now()),Nv(t,u)&&(a=a.insert(l,u))}),a})}};var OC=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return _e.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:Hs(r.createTime)}}(t)),_e.resolve()}getNamedQuery(e,t){return _e.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(r){return{name:r.name,query:oZ(r.bundledQuery),readTime:Hs(r.readTime)}}(t)),_e.resolve()}};var NC=class{constructor(){this.overlays=new _n(Ue.comparator),this.Ir=new Map}getOverlay(e,t){return _e.resolve(this.overlays.get(t))}getOverlays(e,t){let i=Ec();return _e.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.ht(e,t,s)}),_e.resolve()}removeOverlaysForBatchId(e,t,i){let r=this.Ir.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(i)),_e.resolve()}getOverlaysForCollection(e,t,i){let r=Ec(),s=t.length+1,o=new Ue(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&l.largestBatchId>i&&r.set(l.getKey(),l)}return _e.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new _n((u,d)=>u-d),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>i){let d=s.get(u.largestBatchId);d===null&&(d=Ec(),s=s.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}let a=Ec(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=r)););return _e.resolve(a)}ht(e,t,i){let r=this.overlays.get(i.key);if(r!==null){let o=this.Ir.get(r.largestBatchId).delete(i.key);this.Ir.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new EC(t,i));let s=this.Ir.get(t);s===void 0&&(s=bt(),this.Ir.set(t,s)),this.Ir.set(t,s.add(i.key))}};var FC=class{constructor(){this.sessionToken=mi.EMPTY_BYTE_STRING}getSessionToken(e){return _e.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,_e.resolve()}};var gp=class{constructor(){this.Tr=new pi(Ln.Er),this.dr=new pi(Ln.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let i=new Ln(e,t);this.Tr=this.Tr.add(i),this.dr=this.dr.add(i)}Rr(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.Vr(new Ln(e,t))}mr(e,t){e.forEach(i=>this.removeReference(i,t))}gr(e){let t=new Ue(new cn([])),i=new Ln(t,e),r=new Ln(t,e+1),s=[];return this.dr.forEachInRange([i,r],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new Ue(new cn([])),i=new Ln(t,e),r=new Ln(t,e+1),s=bt();return this.dr.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Ln(e,0),i=this.Tr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}},Ln=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Ue.comparator(e.key,t.key)||kt(e.wr,t.wr)}static Ar(e,t){return kt(e.wr,t.wr)||Ue.comparator(e.key,t.key)}};var VC=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new pi(Ln.Er)}checkEmpty(e){return _e.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new vC(s,t,i,r);this.mutationQueue.push(o);for(let a of r)this.br=this.br.add(new Ln(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return _e.resolve(o)}lookupMutationBatch(e,t){return _e.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=this.vr(i),s=r<0?0:r;return _e.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return _e.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return _e.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let i=new Ln(t,0),r=new Ln(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([i,r],o=>{let a=this.Dr(o.wr);s.push(a)}),_e.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new pi(kt);return t.forEach(r=>{let s=new Ln(r,0),o=new Ln(r,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],a=>{i=i.add(a.wr)})}),_e.resolve(this.Cr(i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=i;Ue.isDocumentKey(s)||(s=s.child(""));let o=new Ln(new Ue(s),0),a=new pi(kt);return this.br.forEachWhile(l=>{let u=l.key.path;return!!i.isPrefixOf(u)&&(u.length===r&&(a=a.add(l.wr)),!0)},o),_e.resolve(this.Cr(a))}Cr(e){let t=[];return e.forEach(i=>{let r=this.Dr(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){Gt(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let i=this.br;return _e.forEach(t.mutations,r=>{let s=new Ln(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.br=i})}On(e){}containsKey(e,t){let i=new Ln(t,0),r=this.br.firstAfterOrEqual(i);return _e.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,_e.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var BC=class{constructor(e){this.Mr=e,this.docs=function(){return new _n(Ue.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let i=t.key,r=this.docs.get(i),s=r?r.size:0,o=this.Mr(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let i=this.docs.get(t);return _e.resolve(i?i.document.mutableCopy():ss.newInvalidDocument(t))}getEntries(e,t){let i=Qo();return t.forEach(r=>{let s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():ss.newInvalidDocument(r))}),_e.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let s=Qo(),o=t.path,a=new Ue(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:u,value:{document:d}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||gQ(mQ(d),i)<=0||(r.has(d.key)||Nv(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return _e.resolve(s)}getAllFromCollectionGroup(e,t,i,r){ze()}Or(e,t){return _e.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new UC(this)}getSize(e){return _e.resolve(this.size)}},UC=class extends MC{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(i)}),_e.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var $C=class{constructor(e){this.persistence=e,this.Nr=new rl(t=>Px(t),Rx),this.lastRemoteSnapshotVersion=it.min(),this.highestTargetId=0,this.Lr=0,this.Br=new gp,this.targetCount=0,this.kr=mp.Bn()}forEachTarget(e,t){return this.Nr.forEach((i,r)=>t(r)),_e.resolve()}getLastRemoteSnapshotVersion(e){return _e.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return _e.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),_e.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.Lr&&(this.Lr=t),_e.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new mp(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,_e.resolve()}updateTargetData(e,t){return this.Kn(t),_e.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,_e.resolve()}removeTargets(e,t,i){let r=0,s=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),_e.waitFor(s).next(()=>r)}getTargetCount(e){return _e.resolve(this.targetCount)}getTargetData(e,t){let i=this.Nr.get(t)||null;return _e.resolve(i)}addMatchingKeys(e,t,i){return this.Br.Rr(t,i),_e.resolve()}removeMatchingKeys(e,t,i){this.Br.mr(t,i);let r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),_e.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),_e.resolve()}getMatchingKeysForTargetId(e,t){let i=this.Br.yr(t);return _e.resolve(i)}containsKey(e,t){return _e.resolve(this.Br.containsKey(t))}};var jC=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new e2(0),this.Kr=!1,this.Kr=!0,this.$r=new FC,this.referenceDelegate=e(this),this.Ur=new $C(this),this.indexManager=new PC,this.remoteDocumentCache=function(r){return new BC(r)}(i=>this.referenceDelegate.Wr(i)),this.serializer=new DC(t),this.Gr=new OC(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new NC,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.qr[e.toKey()];return i||(i=new VC(t,this.referenceDelegate),this.qr[e.toKey()]=i),i}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,i){Le("MemoryPersistence","Starting transaction:",e);let r=new GC(this.Qr.next());return this.referenceDelegate.zr(),i(r).next(s=>this.referenceDelegate.jr(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Hr(e,t){return _e.or(Object.values(this.qr).map(i=>()=>i.containsKey(e,t)))}},GC=class extends tC{constructor(e){super(),this.currentSequenceNumber=e}},zC=class n{constructor(e){this.persistence=e,this.Jr=new gp,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw ze()}addReference(e,t,i){return this.Jr.addReference(i,t),this.Xr.delete(i.toString()),_e.resolve()}removeReference(e,t,i){return this.Jr.removeReference(i,t),this.Xr.add(i.toString()),_e.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),_e.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(r=>this.Xr.add(r.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.Xr.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _e.forEach(this.Xr,i=>{let r=Ue.fromPath(i);return this.ei(e,r).next(s=>{s||t.removeEntry(r,it.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(i=>{i?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return _e.or([()=>_e.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var HC=class n{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.$i=i,this.Ui=r}static Wi(e,t){let i=bt(),r=bt();for(let s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new n(e,t.fromCache,i,r)}};var qC=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var WC=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return JO()?8:vQ(Wn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,i,r){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,r,i).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new qC;return this.Xi(e,t,o).next(a=>{if(s.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>s.result)}es(e,t,i,r){return i.documentReadCount<this.ji?(ip()<=wt.DEBUG&&Le("QueryEngine","SDK will not create cache indexes for query:",pd(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),_e.resolve()):(ip()<=wt.DEBUG&&Le("QueryEngine","Query:",pd(t),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.Hi*r?(ip()<=wt.DEBUG&&Le("QueryEngine","The SDK decides to create cache indexes for query:",pd(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,zs(t))):_e.resolve())}Yi(e,t){if(DF(t))return _e.resolve(null);let i=zs(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=ov(t,null,"F"),i=zs(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{let o=bt(...s);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(l=>{let u=this.ts(t,a);return this.ns(t,u,o,l.readTime)?this.Yi(e,ov(t,null,"F")):this.rs(e,u,t,l)}))})))}Zi(e,t,i,r){return DF(t)||r.isEqual(it.min())?_e.resolve(null):this.Ji.getDocuments(e,i).next(s=>{let o=this.ts(t,s);return this.ns(t,o,i,r)?_e.resolve(null):(ip()<=wt.DEBUG&&Le("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),pd(t)),this.rs(e,o,t,pQ(r,-1)).next(a=>a))})}ts(e,t){let i=new pi(d2(e));return t.forEach((r,s)=>{Nv(e,s)&&(i=i.add(s))}),i}ns(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Xi(e,t,i){return ip()<=wt.DEBUG&&Le("QueryEngine","Using full collection scan to execute query:",pd(t)),this.Ji.getDocumentsMatchingQuery(e,t,Ic.min(),i)}rs(e,t,i,r){return this.Ji.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var KC=class{constructor(e,t,i,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new _n(kt),this._s=new rl(s=>Px(s),Rx),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(i)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new LC(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function aZ(n,e,t,i){return new KC(n,e,t,i)}function R2(n,e){return U(this,null,function*(){let t=Ze(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,t.ls(e),t.mutationQueue.getAllMutationBatches(i))).next(s=>{let o=[],a=[],l=bt();for(let u of r){o.push(u.batchId);for(let d of u.mutations)l=l.add(d.key)}for(let u of s){a.push(u.batchId);for(let d of u.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(i,l).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:a}))})})})}function lZ(n,e){let t=Ze(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{let r=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,u,d){let f=u.batch,m=f.keys(),y=_e.resolve();return m.forEach(v=>{y=y.next(()=>d.getEntry(l,v)).next(E=>{let T=u.docVersions.get(v);Gt(T!==null),E.version.compareTo(T)<0&&(f.applyToRemoteDocument(E,u),E.isValidDocument()&&(E.setReadTime(u.commitVersion),d.addEntry(E)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(a){let l=bt();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function M2(n){let e=Ze(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function cZ(n,e){let t=Ze(n),i=e.snapshotVersion,r=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});r=t.os;let a=[];e.targetChanges.forEach((d,f)=>{let m=r.get(f);if(!m)return;a.push(t.Ur.removeMatchingKeys(s,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(s,d.addedDocuments,f)));let y=m.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(mi.EMPTY_BYTE_STRING,it.min()).withLastLimboFreeSnapshotVersion(it.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,i)),r=r.insert(f,y),function(E,T,C){return E.resumeToken.approximateByteSize()===0||T.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=3e8?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0}(m,y,d)&&a.push(t.Ur.updateTargetData(s,y))});let l=Qo(),u=bt();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(uZ(s,o,e.documentUpdates).next(d=>{l=d.Ps,u=d.Is})),!i.isEqual(it.min())){let d=t.Ur.getLastRemoteSnapshotVersion(s).next(f=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(d)}return _e.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,u)).next(()=>l)}).then(s=>(t.os=r,s))}function uZ(n,e,t){let i=bt(),r=bt();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let o=Qo();return t.forEach((a,l)=>{let u=s.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(it.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):Le("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{Ps:o,Is:r}})}function dZ(n,e){let t=Ze(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function hZ(n,e){let t=Ze(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.Ur.getTargetData(i,e).next(s=>s?(r=s,_e.resolve(r)):t.Ur.allocateTargetId(i).next(o=>(r=new pp(e,o,"TargetPurposeListen",i.currentSequenceNumber),t.Ur.addTargetData(i,r).next(()=>r))))}).then(i=>{let r=t.os.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.os=t.os.insert(i.targetId,i),t._s.set(e,i.targetId)),i})}function YC(n,e,t){return U(this,null,function*(){let i=Ze(n),r=i.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!Cp(o))throw o;Le("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}i.os=i.os.remove(e),i._s.delete(r.target)})}function UF(n,e,t){let i=Ze(n),r=it.min(),s=bt();return i.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,d){let f=Ze(l),m=f._s.get(d);return m!==void 0?_e.resolve(f.os.get(m)):f.Ur.getTargetData(u,d)}(i,o,zs(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>i.ss.getDocumentsMatchingQuery(o,e,t?r:it.min(),t?s:bt())).next(a=>(fZ(i,DQ(e),a),{documents:a,Ts:s})))}function fZ(n,e,t){let i=n.us.get(e)||it.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.us.set(e,i)}var fv=class{constructor(){this.activeTargetIds=OQ()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var QC=class{constructor(){this.so=new fv,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,i){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new fv,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var ZC=class{_o(e){}shutdown(){}};var pv=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Le("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){Le("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Yy=null;function zS(){return Yy===null?Yy=function(){return 268435456+Math.round(2147483648*Math.random())}():Yy++,"0x"+Yy.toString(16)}var pZ={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var XC=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var fi="WebChannelConnection",JC=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let i=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=i+"://"+t.host,this.vo=`projects/${r}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${s}`}get Fo(){return!1}Mo(t,i,r,s,o){let a=zS(),l=this.xo(t,i.toUriEncodedString());Le("RestConnection",`Sending RPC '${t}' ${a}:`,l,r);let u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,s,o),this.No(t,l,u,r).then(d=>(Le("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Td("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",r),d})}Lo(t,i,r,s,o,a){return this.Mo(t,i,r,s,o)}Oo(t,i,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Md}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((s,o)=>t[o]=s),r&&r.headers.forEach((s,o)=>t[o]=s)}xo(t,i){let r=pZ[t];return`${this.Do}/v1/${i}:${r}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,i,r){let s=zS();return new Promise((o,a)=>{let l=new VS;l.setWithCredentials(!0),l.listenOnce(BS.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case np.NO_ERROR:let d=l.getResponseJson();Le(fi,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(d)),o(d);break;case np.TIMEOUT:Le(fi,`RPC '${e}' ${s} timed out`),a(new be(se.DEADLINE_EXCEEDED,"Request time out"));break;case np.HTTP_ERROR:let f=l.getStatus();if(Le(fi,`RPC '${e}' ${s} failed with status:`,f,"response text:",l.getResponseText()),f>0){let m=l.getResponseJson();Array.isArray(m)&&(m=m[0]);let y=m?.error;if(y&&y.status&&y.message){let v=function(T){let C=T.toLowerCase().replace(/_/g,"-");return Object.values(se).indexOf(C)>=0?C:se.UNKNOWN}(y.status);a(new be(v,y.message))}else a(new be(se.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new be(se.UNAVAILABLE,"Connection failed."));break;default:ze()}}finally{Le(fi,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(r);Le(fi,`RPC '${e}' ${s} sending request:`,r),l.send(t,"POST",u,i,15)})}Bo(e,t,i){let r=zS(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=jS(),a=$S(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,i),l.encodeInitMessageHeaders=!0;let d=s.join("");Le(fi,`Creating RPC '${e}' stream ${r}: ${d}`,l);let f=o.createWebChannel(d,l),m=!1,y=!1,v=new XC({Io:T=>{y?Le(fi,`Not sending because RPC '${e}' stream ${r} is closed:`,T):(m||(Le(fi,`Opening RPC '${e}' stream ${r} transport.`),f.open(),m=!0),Le(fi,`RPC '${e}' stream ${r} sending:`,T),f.send(T))},To:()=>f.close()}),E=(T,C,D)=>{T.listen(C,P=>{try{D(P)}catch(V){setTimeout(()=>{throw V},0)}})};return E(f,fd.EventType.OPEN,()=>{y||(Le(fi,`RPC '${e}' stream ${r} transport opened.`),v.yo())}),E(f,fd.EventType.CLOSE,()=>{y||(y=!0,Le(fi,`RPC '${e}' stream ${r} transport closed`),v.So())}),E(f,fd.EventType.ERROR,T=>{y||(y=!0,Td(fi,`RPC '${e}' stream ${r} transport errored:`,T),v.So(new be(se.UNAVAILABLE,"The operation could not be completed")))}),E(f,fd.EventType.MESSAGE,T=>{var C;if(!y){let D=T.data[0];Gt(!!D);let P=D,V=P.error||((C=P[0])===null||C===void 0?void 0:C.error);if(V){Le(fi,`RPC '${e}' stream ${r} received error:`,V);let G=V.status,H=function(R){let M=kn[R];if(M!==void 0)return b2(M)}(G),A=V.message;H===void 0&&(H=se.INTERNAL,A="Unknown error status: "+G+" with message "+V.message),y=!0,v.So(new be(H,A)),f.close()}else Le(fi,`RPC '${e}' stream ${r} received:`,D),v.bo(D)}}),E(a,US.STAT_EVENT,T=>{T.stat===Wy.PROXY?Le(fi,`RPC '${e}' stream ${r} detected buffering proxy`):T.stat===Wy.NOPROXY&&Le(fi,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{v.wo()},0),v}};function HS(){return typeof document<"u"?document:null}function Fv(n){return new IC(n,!0)}var mv=class{constructor(e,t,i=1e3,r=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=i,this.qo=r,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),i=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-i);r>0&&Le("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var gv=class{constructor(e,t,i,r,s,o,a,l){this.ui=e,this.Ho=i,this.Jo=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new mv(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return U(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return U(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return U(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===se.RESOURCE_EXHAUSTED?(Wo(t.toString()),Wo("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===se.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.Yo===t&&this.P_(i,r)},i=>{e(()=>{let r=new be(se.UNKNOWN,"Fetching auth token failed: "+i.message);return this.I_(r)})})}P_(e,t){let i=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{i(()=>this.listener.Eo())}),this.stream.Ro(()=>{i(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(r=>{i(()=>this.I_(r))}),this.stream.onMessage(r=>{i(()=>++this.e_==1?this.E_(r):this.onNext(r))})}i_(){this.state=5,this.t_.Go(()=>U(this,null,function*(){this.state=0,this.start()}))}I_(e){return Le("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(Le("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},ex=class extends gv{constructor(e,t,i,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=YQ(this.serializer,e),i=function(s){if(!("targetChange"in s))return it.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?it.min():o.readTime?Hs(o.readTime):it.min()}(e);return this.listener.d_(t,i)}A_(e){let t={};t.database=AC(this.serializer),t.addTarget=function(s,o){let a,l=o.target;if(a=pC(l)?{documents:XQ(s,l)}:{query:JQ(s,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=I2(s,o.resumeToken);let u=SC(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(it.min())>0){a.readTime=dv(s,o.snapshotVersion.toTimestamp());let u=SC(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);let i=tZ(this.serializer,e);i&&(t.labels=i),this.a_(t)}R_(e){let t={};t.database=AC(this.serializer),t.removeTarget=e,this.a_(t)}},tx=class extends gv{constructor(e,t,i,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Gt(!!e.streamToken),this.lastStreamToken=e.streamToken,Gt(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Gt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=ZQ(e.writeResults,e.commitTime),i=Hs(e.commitTime);return this.listener.g_(i,t)}p_(){let e={};e.database=AC(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(i=>QQ(this.serializer,i))};this.a_(t)}};var nx=class extends class{}{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new be(se.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,i,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,CC(t,i),r,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===se.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new be(se.UNKNOWN,s.toString())})}Lo(e,t,i,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,CC(t,i),r,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===se.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new be(se.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},ix=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Wo(t),this.D_=!1):Le("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var rx=class{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{i.enqueueAndForget(()=>U(this,null,function*(){Pc(this)&&(Le("RemoteStore","Restarting streams for network reachability change."),yield function(l){return U(this,null,function*(){let u=Ze(l);u.L_.add(4),yield xp(u),u.q_.set("Unknown"),u.L_.delete(4),yield Vv(u)})}(this))}))}),this.q_=new ix(i,r)}};function Vv(n){return U(this,null,function*(){if(Pc(n))for(let e of n.B_)yield e(!0)})}function xp(n){return U(this,null,function*(){for(let e of n.B_)yield e(!1)})}function k2(n,e){let t=Ze(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Vx(t)?Fx(t):kd(t).r_()&&Nx(t,e))}function Ox(n,e){let t=Ze(n),i=kd(t);t.N_.delete(e),i.r_()&&L2(t,e),t.N_.size===0&&(i.r_()?i.o_():Pc(t)&&t.q_.set("Unknown"))}function Nx(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(it.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}kd(n).A_(e)}function L2(n,e){n.Q_.xe(e),kd(n).R_(e)}function Fx(n){n.Q_=new bC({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),kd(n).start(),n.q_.v_()}function Vx(n){return Pc(n)&&!kd(n).n_()&&n.N_.size>0}function Pc(n){return Ze(n).L_.size===0}function O2(n){n.Q_=void 0}function mZ(n){return U(this,null,function*(){n.q_.set("Online")})}function gZ(n){return U(this,null,function*(){n.N_.forEach((e,t)=>{Nx(n,e)})})}function yZ(n,e){return U(this,null,function*(){O2(n),Vx(n)?(n.q_.M_(e),Fx(n)):n.q_.set("Unknown")})}function vZ(n,e,t){return U(this,null,function*(){if(n.q_.set("Online"),e instanceof cv&&e.state===2&&e.cause)try{yield function(r,s){return U(this,null,function*(){let o=s.cause;for(let a of s.targetIds)r.N_.has(a)&&(yield r.remoteSyncer.rejectListen(a,o),r.N_.delete(a),r.Q_.removeTarget(a))})}(n,e)}catch(i){Le("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),yield yv(n,i)}else if(e instanceof _d?n.Q_.Ke(e):e instanceof lv?n.Q_.He(e):n.Q_.We(e),!t.isEqual(it.min()))try{let i=yield M2(n.localStore);t.compareTo(i)>=0&&(yield function(s,o){let a=s.Q_.rt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){let d=s.N_.get(u);d&&s.N_.set(u,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{let d=s.N_.get(l);if(!d)return;s.N_.set(l,d.withResumeToken(mi.EMPTY_BYTE_STRING,d.snapshotVersion)),L2(s,l);let f=new pp(d.target,l,u,d.sequenceNumber);Nx(s,f)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(i){Le("RemoteStore","Failed to raise snapshot:",i),yield yv(n,i)}})}function yv(n,e,t){return U(this,null,function*(){if(!Cp(e))throw e;n.L_.add(1),yield xp(n),n.q_.set("Offline"),t||(t=()=>M2(n.localStore)),n.asyncQueue.enqueueRetryable(()=>U(this,null,function*(){Le("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield Vv(n)}))})}function N2(n,e){return e().catch(t=>yv(n,t,e))}function Bv(n){return U(this,null,function*(){let e=Ze(n),t=al(e),i=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;_Z(e);)try{let r=yield dZ(e.localStore,i);if(r===null){e.O_.length===0&&t.o_();break}i=r.batchId,EZ(e,r)}catch(r){yield yv(e,r)}F2(e)&&V2(e)})}function _Z(n){return Pc(n)&&n.O_.length<10}function EZ(n,e){n.O_.push(e);let t=al(n);t.r_()&&t.V_&&t.m_(e.mutations)}function F2(n){return Pc(n)&&!al(n).n_()&&n.O_.length>0}function V2(n){al(n).start()}function TZ(n){return U(this,null,function*(){al(n).p_()})}function wZ(n){return U(this,null,function*(){let e=al(n);for(let t of n.O_)e.m_(t.mutations)})}function bZ(n,e,t){return U(this,null,function*(){let i=n.O_.shift(),r=_C.from(i,e,t);yield N2(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield Bv(n)})}function IZ(n,e){return U(this,null,function*(){e&&al(n).V_&&(yield function(i,r){return U(this,null,function*(){if(function(o){return $Q(o)&&o!==se.ABORTED}(r.code)){let s=i.O_.shift();al(i).s_(),yield N2(i,()=>i.remoteSyncer.rejectFailedWrite(s.batchId,r)),yield Bv(i)}})}(n,e)),F2(n)&&V2(n)})}function $F(n,e){return U(this,null,function*(){let t=Ze(n);t.asyncQueue.verifyOperationInProgress(),Le("RemoteStore","RemoteStore received new credentials");let i=Pc(t);t.L_.add(3),yield xp(t),i&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Vv(t)})}function SZ(n,e){return U(this,null,function*(){let t=Ze(n);e?(t.L_.delete(2),yield Vv(t)):e||(t.L_.add(2),yield xp(t),t.q_.set("Unknown"))})}function kd(n){return n.K_||(n.K_=function(t,i,r){let s=Ze(t);return s.w_(),new ex(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Eo:mZ.bind(null,n),Ro:gZ.bind(null,n),mo:yZ.bind(null,n),d_:vZ.bind(null,n)}),n.B_.push(e=>U(this,null,function*(){e?(n.K_.s_(),Vx(n)?Fx(n):n.q_.set("Unknown")):(yield n.K_.stop(),O2(n))}))),n.K_}function al(n){return n.U_||(n.U_=function(t,i,r){let s=Ze(t);return s.w_(),new tx(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:TZ.bind(null,n),mo:IZ.bind(null,n),f_:wZ.bind(null,n),g_:bZ.bind(null,n)}),n.B_.push(e=>U(this,null,function*(){e?(n.U_.s_(),yield Bv(n)):(yield n.U_.stop(),n.O_.length>0&&(Le("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var sx=class n{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new rs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,s){let o=Date.now()+i,a=new n(e,t,o,r,s);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new be(se.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Bx(n,e){if(Wo("AsyncQueue",`${e}: ${n}`),Cp(n))return new be(se.UNAVAILABLE,`${e}: ${n}`);throw n}var vv=class n{constructor(e){this.comparator=e?(t,i)=>e(t,i)||Ue.comparator(t.key,i.key):(t,i)=>Ue.comparator(t.key,i.key),this.keyedMap=rp(),this.sortedSet=new _n(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let i=new n;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}};var _v=class{constructor(){this.W_=new _n(Ue.comparator)}track(e){let t=e.doc.key,i=this.W_.get(t);i?e.type!==0&&i.type===3?this.W_=this.W_.insert(t,e):e.type===3&&i.type!==1?this.W_=this.W_.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.W_=this.W_.remove(t):e.type===1&&i.type===2?this.W_=this.W_.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):ze():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,i)=>{e.push(i)}),e}},Ad=class n{constructor(e,t,i,r,s,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,i,r,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,vv.emptySet(t),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ov(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}};var ox=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},ax=class{constructor(){this.queries=jF(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,i){let r=Ze(t),s=r.queries;r.queries=jF(),s.forEach((o,a)=>{for(let l of a.j_)l.onError(i)})})(this,new be(se.ABORTED,"Firestore shutting down"))}};function jF(){return new rl(n=>u2(n),Ov)}function Ux(n,e){return U(this,null,function*(){let t=Ze(n),i=3,r=e.query,s=t.queries.get(r);s?!s.H_()&&e.J_()&&(i=2):(s=new ox,i=e.J_()?0:1);try{switch(i){case 0:s.z_=yield t.onListen(r,!0);break;case 1:s.z_=yield t.onListen(r,!1);break;case 2:yield t.onFirstRemoteStoreListen(r)}}catch(o){let a=Bx(o,`Initialization of query '${pd(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&jx(t)})}function $x(n,e){return U(this,null,function*(){let t=Ze(n),i=e.query,r=3,s=t.queries.get(i);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?r=e.J_()?0:1:!s.H_()&&e.J_()&&(r=2))}switch(r){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}})}function CZ(n,e){let t=Ze(n),i=!1;for(let r of e){let s=r.query,o=t.queries.get(s);if(o){for(let a of o.j_)a.X_(r)&&(i=!0);o.z_=r}}i&&jx(t)}function xZ(n,e,t){let i=Ze(n),r=i.queries.get(e);if(r)for(let s of r.j_)s.onError(t);i.queries.delete(e)}function jx(n){n.Y_.forEach(e=>{e.next()})}var lx,GF;(GF=lx||(lx={})).ea="default",GF.Cache="cache";var yp=class{constructor(e,t,i){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=i||{}}X_(e){if(!this.options.includeMetadataChanges){let i=[];for(let r of e.docChanges)r.type!==3&&i.push(r);e=new Ad(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let i=t!=="Offline";return(!this.options._a||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Ad.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==lx.Cache}};var Ev=class{constructor(e){this.key=e}},Tv=class{constructor(e){this.key=e}},cx=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=bt(),this.mutatedKeys=bt(),this.Aa=d2(e),this.Ra=new vv(this.Aa)}get Va(){return this.Ta}ma(e,t){let i=t?t.fa:new _v,r=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1,l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((d,f)=>{let m=r.get(d),y=Nv(this.query,f)?f:null,v=!!m&&this.mutatedKeys.has(m.key),E=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations),T=!1;m&&y?m.data.isEqual(y.data)?v!==E&&(i.track({type:3,doc:y}),T=!0):this.ga(m,y)||(i.track({type:2,doc:y}),T=!0,(l&&this.Aa(y,l)>0||u&&this.Aa(y,u)<0)&&(a=!0)):!m&&y?(i.track({type:0,doc:y}),T=!0):m&&!y&&(i.track({type:1,doc:m}),T=!0,(l||u)&&(a=!0)),T&&(y?(o=o.add(y),s=E?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),i.track({type:1,doc:d})}return{Ra:o,fa:i,ns:a,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,r){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((d,f)=>function(y,v){let E=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ze()}};return E(y)-E(v)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(i),r=r!=null&&r;let a=t&&!r?this.ya():[],l=this.da.size===0&&this.current&&!r?1:0,u=l!==this.Ea;return this.Ea=l,o.length!==0||u?{snapshot:new Ad(this.query,e.Ra,s,o,e.mutatedKeys,l===0,u,!1,!!i&&i.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new _v,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=bt(),this.Ra.forEach(i=>{this.Sa(i.key)&&(this.da=this.da.add(i.key))});let t=[];return e.forEach(i=>{this.da.has(i)||t.push(new Tv(i))}),this.da.forEach(i=>{e.has(i)||t.push(new Ev(i))}),t}ba(e){this.Ta=e.Ts,this.da=bt();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Ad.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},ux=class{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}},dx=class{constructor(e){this.key=e,this.va=!1}},hx=class{constructor(e,t,i,r,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new rl(a=>u2(a),Ov),this.Ma=new Map,this.xa=new Set,this.Oa=new _n(Ue.comparator),this.Na=new Map,this.La=new gp,this.Ba={},this.ka=new Map,this.qa=mp.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function AZ(n,e,t=!0){return U(this,null,function*(){let i=z2(n),r,s=i.Fa.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.Da()):r=yield B2(i,e,t,!0),r})}function DZ(n,e){return U(this,null,function*(){let t=z2(n);yield B2(t,e,!0,!1)})}function B2(n,e,t,i){return U(this,null,function*(){let r=yield hZ(n.localStore,zs(e)),s=r.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return i&&(a=yield PZ(n,e,s,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&k2(n.remoteStore,r),a})}function PZ(n,e,t,i,r){return U(this,null,function*(){n.Ka=(f,m,y)=>function(E,T,C,D){return U(this,null,function*(){let P=T.view.ma(C);P.ns&&(P=yield UF(E.localStore,T.query,!1).then(({documents:A})=>T.view.ma(A,P)));let V=D&&D.targetChanges.get(T.targetId),G=D&&D.targetMismatches.get(T.targetId)!=null,H=T.view.applyChanges(P,E.isPrimaryClient,V,G);return HF(E,T.targetId,H.wa),H.snapshot})}(n,f,m,y);let s=yield UF(n.localStore,e,!0),o=new cx(e,s.Ts),a=o.ma(s.documents),l=fp.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",r),u=o.applyChanges(a,n.isPrimaryClient,l);HF(n,t,u.wa);let d=new ux(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),u.snapshot})}function RZ(n,e,t){return U(this,null,function*(){let i=Ze(n),r=i.Fa.get(e),s=i.Ma.get(r.targetId);if(s.length>1)return i.Ma.set(r.targetId,s.filter(o=>!Ov(o,e))),void i.Fa.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||(yield YC(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),t&&Ox(i.remoteStore,r.targetId),fx(i,r.targetId)}).catch(Sp))):(fx(i,r.targetId),yield YC(i.localStore,r.targetId,!0))})}function MZ(n,e){return U(this,null,function*(){let t=Ze(n),i=t.Fa.get(e),r=t.Ma.get(i.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),Ox(t.remoteStore,i.targetId))})}function kZ(n,e,t){return U(this,null,function*(){let i=UZ(n);try{let r=yield function(o,a){let l=Ze(o),u=vn.now(),d=a.reduce((y,v)=>y.add(v.key),bt()),f,m;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let v=Qo(),E=bt();return l.cs.getEntries(y,d).next(T=>{v=T,v.forEach((C,D)=>{D.isValidDocument()||(E=E.add(C))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,v)).next(T=>{f=T;let C=[];for(let D of a){let P=UQ(D,f.get(D.key).overlayedDocument);P!=null&&C.push(new Ws(D.key,P,r2(P.value.mapValue),qo.exists(!0)))}return l.mutationQueue.addMutationBatch(y,u,C,a)}).next(T=>{m=T;let C=T.applyToLocalDocumentSet(f,E);return l.documentOverlayCache.saveOverlays(y,T.batchId,C)})}).then(()=>({batchId:m.batchId,changes:f2(f)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(o,a,l){let u=o.Ba[o.currentUser.toKey()];u||(u=new _n(kt)),u=u.insert(a,l),o.Ba[o.currentUser.toKey()]=u}(i,r.batchId,t),yield Ap(i,r.changes),yield Bv(i.remoteStore)}catch(r){let s=Bx(r,"Failed to persist write");t.reject(s)}})}function U2(n,e){return U(this,null,function*(){let t=Ze(n);try{let i=yield cZ(t.localStore,e);e.targetChanges.forEach((r,s)=>{let o=t.Na.get(s);o&&(Gt(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.va=!0:r.modifiedDocuments.size>0?Gt(o.va):r.removedDocuments.size>0&&(Gt(o.va),o.va=!1))}),yield Ap(t,i,e)}catch(i){yield Sp(i)}})}function zF(n,e,t){let i=Ze(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){let r=[];i.Fa.forEach((s,o)=>{let a=o.view.Z_(e);a.snapshot&&r.push(a.snapshot)}),function(o,a){let l=Ze(o);l.onlineState=a;let u=!1;l.queries.forEach((d,f)=>{for(let m of f.j_)m.Z_(a)&&(u=!0)}),u&&jx(l)}(i.eventManager,e),r.length&&i.Ca.d_(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}function LZ(n,e,t){return U(this,null,function*(){let i=Ze(n);i.sharedClientState.updateQueryState(e,"rejected",t);let r=i.Na.get(e),s=r&&r.key;if(s){let o=new _n(Ue.comparator);o=o.insert(s,ss.newNoDocument(s,it.min()));let a=bt().add(s),l=new av(it.min(),new Map,new _n(kt),o,a);yield U2(i,l),i.Oa=i.Oa.remove(s),i.Na.delete(e),Gx(i)}else yield YC(i.localStore,e,!1).then(()=>fx(i,e,t)).catch(Sp)})}function OZ(n,e){return U(this,null,function*(){let t=Ze(n),i=e.batch.batchId;try{let r=yield lZ(t.localStore,e);j2(t,i,null),$2(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),yield Ap(t,r)}catch(r){yield Sp(r)}})}function NZ(n,e,t){return U(this,null,function*(){let i=Ze(n);try{let r=yield function(o,a){let l=Ze(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return l.mutationQueue.lookupMutationBatch(u,a).next(f=>(Gt(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>l.localDocuments.getDocuments(u,d))})}(i.localStore,e);j2(i,e,t),$2(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),yield Ap(i,r)}catch(r){yield Sp(r)}})}function $2(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function j2(n,e,t){let i=Ze(n),r=i.Ba[i.currentUser.toKey()];if(r){let s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.Ba[i.currentUser.toKey()]=r}}function fx(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let i of n.Ma.get(e))n.Fa.delete(i),t&&n.Ca.$a(i,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(i=>{n.La.containsKey(i)||G2(n,i)})}function G2(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(Ox(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Gx(n))}function HF(n,e,t){for(let i of t)i instanceof Ev?(n.La.addReference(i.key,e),FZ(n,i)):i instanceof Tv?(Le("SyncEngine","Document no longer in limbo: "+i.key),n.La.removeReference(i.key,e),n.La.containsKey(i.key)||G2(n,i.key)):ze()}function FZ(n,e){let t=e.key,i=t.path.canonicalString();n.Oa.get(t)||n.xa.has(i)||(Le("SyncEngine","New document in limbo: "+t),n.xa.add(i),Gx(n))}function Gx(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new Ue(cn.fromString(e)),i=n.qa.next();n.Na.set(i,new dx(t)),n.Oa=n.Oa.insert(t,i),k2(n.remoteStore,new pp(zs(Lv(t.path)),i,"TargetPurposeLimboResolution",e2.oe))}}function Ap(n,e,t){return U(this,null,function*(){let i=Ze(n),r=[],s=[],o=[];i.Fa.isEmpty()||(i.Fa.forEach((a,l)=>{o.push(i.Ka(l,e,t).then(u=>{var d;if((u||t)&&i.isPrimaryClient){let f=u?!u.fromCache:(d=t?.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;i.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){r.push(u);let f=HC.Wi(l.targetId,u);s.push(f)}}))}),yield Promise.all(o),i.Ca.d_(r),yield function(l,u){return U(this,null,function*(){let d=Ze(l);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>_e.forEach(u,m=>_e.forEach(m.$i,y=>d.persistence.referenceDelegate.addReference(f,m.targetId,y)).next(()=>_e.forEach(m.Ui,y=>d.persistence.referenceDelegate.removeReference(f,m.targetId,y)))))}catch(f){if(!Cp(f))throw f;Le("LocalStore","Failed to update sequence numbers: "+f)}for(let f of u){let m=f.targetId;if(!f.fromCache){let y=d.os.get(m),v=y.snapshotVersion,E=y.withLastLimboFreeSnapshotVersion(v);d.os=d.os.insert(m,E)}}})}(i.localStore,s))})}function VZ(n,e){return U(this,null,function*(){let t=Ze(n);if(!t.currentUser.isEqual(e)){Le("SyncEngine","User change. New user:",e.toKey());let i=yield R2(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(a=>{a.forEach(l=>{l.reject(new be(se.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield Ap(t,i.hs)}})}function BZ(n,e){let t=Ze(n),i=t.Na.get(e);if(i&&i.va)return bt().add(i.key);{let r=bt(),s=t.Ma.get(e);if(!s)return r;for(let o of s){let a=t.Fa.get(o);r=r.unionWith(a.view.Va)}return r}}function z2(n){let e=Ze(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=U2.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=BZ.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=LZ.bind(null,e),e.Ca.d_=CZ.bind(null,e.eventManager),e.Ca.$a=xZ.bind(null,e.eventManager),e}function UZ(n){let e=Ze(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=OZ.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=NZ.bind(null,e),e}var qF=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return U(this,null,function*(){this.serializer=Fv(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,i){return null}Ha(t,i){return null}za(t){return aZ(this.persistence,new WC,t.initialUser,this.serializer)}Ga(t){return new jC(zC.Zr,this.serializer)}Wa(t){return new QC}terminate(){return U(this,null,function*(){var t,i;(t=this.gcScheduler)===null||t===void 0||t.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var $Z=(()=>{class n{initialize(t,i){return U(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>zF(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=VZ.bind(null,this.syncEngine),yield SZ(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new ax}()}createDatastore(t){let i=Fv(t.databaseInfo.databaseId),r=function(o){return new JC(o)}(t.databaseInfo);return function(o,a,l,u){return new nx(o,a,l,u)}(t.authCredentials,t.appCheckCredentials,r,i)}createRemoteStore(t){return function(r,s,o,a,l){return new rx(r,s,o,a,l)}(this.localStore,this.datastore,t.asyncQueue,i=>zF(this.syncEngine,i,0),function(){return pv.D()?new pv:new ZC}())}createSyncEngine(t,i){return function(s,o,a,l,u,d,f){let m=new hx(s,o,a,l,u,d);return f&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,i)}terminate(){return U(this,null,function*(){var t,i;yield function(s){return U(this,null,function*(){let o=Ze(s);Le("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield xp(o),o.k_.shutdown(),o.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()})}}return n.provider={build:()=>new n},n})();var vp=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Wo("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var px=class{constructor(e,t,i,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=Kn.UNAUTHENTICATED,this.clientId=Jy.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(i,o=>U(this,null,function*(){Le("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(i,o=>(Le("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new rs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>U(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let i=Bx(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}};function qS(n,e){return U(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),Le("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(r=>U(this,null,function*(){i.isEqual(r)||(yield R2(e.localStore,r),i=r)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function WF(n,e){return U(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield jZ(n);Le("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>$F(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,r)=>$F(e.remoteStore,r)),n._onlineComponents=e})}function jZ(n){return U(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Le("FirestoreClient","Using user provided OfflineComponentProvider");try{yield qS(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(r){return r.name==="FirebaseError"?r.code===se.FAILED_PRECONDITION||r.code===se.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;Td("Error using user provided cache. Falling back to memory cache: "+t),yield qS(n,new qF)}}else Le("FirestoreClient","Using default OfflineComponentProvider"),yield qS(n,new qF);return n._offlineComponents})}function H2(n){return U(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(Le("FirestoreClient","Using user provided OnlineComponentProvider"),yield WF(n,n._uninitializedComponentsProvider._online)):(Le("FirestoreClient","Using default OnlineComponentProvider"),yield WF(n,new $Z))),n._onlineComponents})}function GZ(n){return H2(n).then(e=>e.syncEngine)}function wv(n){return U(this,null,function*(){let e=yield H2(n),t=e.eventManager;return t.onListen=AZ.bind(null,e.syncEngine),t.onUnlisten=RZ.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=DZ.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=MZ.bind(null,e.syncEngine),t})}function zZ(n,e,t={}){let i=new rs;return n.asyncQueue.enqueueAndForget(()=>U(this,null,function*(){return function(s,o,a,l,u){let d=new vp({next:m=>{d.Za(),o.enqueueAndForget(()=>$x(s,f));let y=m.docs.has(a);!y&&m.fromCache?u.reject(new be(se.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&m.fromCache&&l&&l.source==="server"?u.reject(new be(se.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new yp(Lv(a.path),d,{includeMetadataChanges:!0,_a:!0});return Ux(s,f)}(yield wv(n),n.asyncQueue,e,t,i)})),i.promise}function HZ(n,e,t={}){let i=new rs;return n.asyncQueue.enqueueAndForget(()=>U(this,null,function*(){return function(s,o,a,l,u){let d=new vp({next:m=>{d.Za(),o.enqueueAndForget(()=>$x(s,f)),m.fromCache&&l.source==="server"?u.reject(new be(se.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new yp(a,d,{includeMetadataChanges:!0,_a:!0});return Ux(s,f)}(yield wv(n),n.asyncQueue,e,t,i)})),i.promise}function q2(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var KF=new Map;function W2(n,e,t){if(!t)throw new be(se.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function qZ(n,e,t,i){if(e===!0&&i===!0)throw new be(se.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function YF(n){if(!Ue.isDocumentKey(n))throw new be(se.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function QF(n){if(Ue.isDocumentKey(n))throw new be(se.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Uv(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ze()}function Nr(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new be(se.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Uv(n);throw new be(se.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function WZ(n,e){if(e<=0)throw new be(se.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var bv=class{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new be(se.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new be(se.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}qZ("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=q2((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new be(se.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new be(se.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new be(se.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Dd=class{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bv({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new be(se.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new be(se.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bv(e),e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new WS;switch(i.type){case"firstParty":return new ZS(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new be(se.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return U(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let i=KF.get(t);i&&(Le("ComponentProvider","Removing Datastore"),KF.delete(t),i.terminate())}(this),Promise.resolve()}};function K2(n,e,t,i={}){var r;let s=(n=Nr(n,Dd))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Td("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),i.mockUserToken){let a,l;if(typeof i.mockUserToken=="string")a=i.mockUserToken,l=Kn.MOCK_USER;else{a=WO(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);let u=i.mockUserToken.sub||i.mockUserToken.user_id;if(!u)throw new be(se.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Kn(u)}n._authCredentials=new KS(new Xy(a,l))}}var Ks=class n{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Di=class n{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new tl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},tl=class n extends Ks{constructor(e,t,i){super(e,t,Lv(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Di(this.firestore,null,new Ue(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Y2(n,e,...t){if(n=bn(n),W2("collection","path",e),n instanceof Dd){let i=cn.fromString(e,...t);return QF(i),new tl(n,null,i)}{if(!(n instanceof Di||n instanceof tl))throw new be(se.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(cn.fromString(e,...t));return QF(i),new tl(n.firestore,null,i)}}function zx(n,e,...t){if(n=bn(n),arguments.length===1&&(e=Jy.newId()),W2("doc","path",e),n instanceof Dd){let i=cn.fromString(e,...t);return YF(i),new Di(n,null,new Ue(i))}{if(!(n instanceof Di||n instanceof tl))throw new be(se.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(cn.fromString(e,...t));return YF(i),new Di(n.firestore,n instanceof tl?n.converter:null,new Ue(i))}}var Iv=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new mv(this,"async_queue_retry"),this.Vu=()=>{let i=HS();i&&Le("AsyncQueue","Visibility state changed to "+i.visibilityState),this.t_.jo()},this.mu=e;let t=HS();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=HS();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new rs;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return U(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Cp(e))throw e;Le("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(i=>{this.Eu=i,this.du=!1;let r=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(i);throw Wo("INTERNAL UNHANDLED ERROR: ",r),i}).then(i=>(this.du=!1,i))));return this.mu=t,t}enqueueAfterDelay(e,t,i){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let r=sx.createAndSchedule(this,e,t,i,s=>this.yu(s));return this.Tu.push(r),r}fu(){this.Eu&&ze()}verifyOperationInProgress(){}wu(){return U(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function ZF(n){return function(t,i){if(typeof t!="object"||t===null)return!1;let r=t;for(let s of i)if(s in r&&typeof r[s]=="function")return!0;return!1}(n,["next","error","complete"])}var Ys=class extends Dd{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new Iv,this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return U(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Iv(e),this._firestoreClient=void 0,yield e}})}};function Q2(n,e){let t=typeof n=="object"?n:ad(),i=typeof n=="string"?n:e||"(default)",r=zf(t,"firestore").getImmediate({identifier:i});if(!r._initialized){let s=qO("firestore");s&&K2(r,...s)}return r}function $v(n){if(n._terminated)throw new be(se.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||KZ(n),n._firestoreClient}function KZ(n){var e,t,i;let r=n._freezeSettings(),s=function(a,l,u,d){return new nC(a,l,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,q2(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._componentsProvider||!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=r.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),n._firestoreClient=new px(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(a){let l=a?._online.build();return{_offline:a?._offline.build(l),_online:l}}(n._componentsProvider))}var _p=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(mi.fromBase64String(e))}catch(t){throw new be(se.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(mi.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Pd=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new be(se.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new fr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var ll=class{constructor(e){this._methodName=e}};var Ep=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new be(se.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new be(se.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return kt(this._lat,e._lat)||kt(this._long,e._long)}};var Tp=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(i,r){if(i.length!==r.length)return!1;for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(this._values,e._values)}};var YZ=/^__.*__$/,mx=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Ws(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ac(e,this.data,t,this.fieldTransforms)}},Sv=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new Ws(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Z2(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ze()}}var Cv=class n{constructor(e,t,i,r,s,o){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:i,xu:!1});return r.Ou(e),r}Nu(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:i,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Av(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Z2(this.Cu)&&YZ.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},gx=class{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||Fv(e)}Qu(e,t,i,r=!1){return new Cv({Cu:e,methodName:t,qu:i,path:fr.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function jv(n){let e=n._freezeSettings(),t=Fv(n._databaseId);return new gx(n._databaseId,!!e.ignoreUndefinedProperties,t)}function QZ(n,e,t,i,r,s={}){let o=n.Qu(s.merge||s.mergeFields?2:0,e,t,r);Hx("Data must be an object, but it was:",o,i);let a=eV(i,o),l,u;if(s.merge)l=new Or(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){let d=[];for(let f of s.mergeFields){let m=Ex(e,f,t);if(!o.contains(m))throw new be(se.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);nV(d,m)||d.push(m)}l=new Or(d),u=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=o.fieldTransforms;return new mx(new hr(a),l,u)}var xv=class n extends ll{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function X2(n,e,t){return new Cv({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var yx=class n extends ll{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=X2(this,e,!0),i=this.Ku.map(s=>Rc(s,t)),r=new sl(i);return new dp(e.path,r)}isEqual(e){return e instanceof n&&Bo(this.Ku,e.Ku)}},vx=class n extends ll{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=X2(this,e,!0),i=this.Ku.map(s=>Rc(s,t)),r=new ol(i);return new dp(e.path,r)}isEqual(e){return e instanceof n&&Bo(this.Ku,e.Ku)}},_x=class n extends ll{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){let t=new xc(e.serializer,g2(e.serializer,this.$u));return new dp(e.path,t)}isEqual(e){return e instanceof n&&this.$u===e.$u}};function ZZ(n,e,t,i){let r=n.Qu(1,e,t);Hx("Data must be an object, but it was:",r,i);let s=[],o=hr.empty();Dc(i,(l,u)=>{let d=qx(e,l,t);u=bn(u);let f=r.Nu(d);if(u instanceof xv)s.push(d);else{let m=Rc(u,f);m!=null&&(s.push(d),o.set(d,m))}});let a=new Or(s);return new Sv(o,a,r.fieldTransforms)}function XZ(n,e,t,i,r,s){let o=n.Qu(1,e,t),a=[Ex(e,i,t)],l=[r];if(s.length%2!=0)throw new be(se.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)a.push(Ex(e,s[m])),l.push(s[m+1]);let u=[],d=hr.empty();for(let m=a.length-1;m>=0;--m)if(!nV(u,a[m])){let y=a[m],v=l[m];v=bn(v);let E=o.Nu(y);if(v instanceof xv)u.push(y);else{let T=Rc(v,E);T!=null&&(u.push(y),d.set(y,T))}}let f=new Or(u);return new Sv(d,f,o.fieldTransforms)}function J2(n,e,t,i=!1){return Rc(t,n.Qu(i?4:3,e))}function Rc(n,e){if(tV(n=bn(n)))return Hx("Unsupported field value:",e,n),eV(n,e);if(n instanceof ll)return function(i,r){if(!Z2(r.Cu))throw r.Bu(`${i._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Bu(`${i._methodName}() is not currently supported inside arrays`);let s=i._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(i,r){let s=[],o=0;for(let a of i){let l=Rc(a,r.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),o++}return{arrayValue:{values:s}}}(n,e)}return function(i,r){if((i=bn(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return g2(r.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){let s=vn.fromDate(i);return{timestampValue:dv(r.serializer,s)}}if(i instanceof vn){let s=new vn(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:dv(r.serializer,s)}}if(i instanceof Ep)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof _p)return{bytesValue:I2(r.serializer,i._byteString)};if(i instanceof Di){let s=r.databaseId,o=i.firestore._databaseId;if(!o.isEqual(s))throw r.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Lx(i.firestore._databaseId||r.databaseId,i._key.path)}}if(i instanceof Tp)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return kx(a.serializer,l)})}}}}}}(i,r);throw r.Bu(`Unsupported field value: ${Uv(i)}`)}(n,e)}function eV(n,e){let t={};return t2(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Dc(n,(i,r)=>{let s=Rc(r,e.Mu(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function tV(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof vn||n instanceof Ep||n instanceof _p||n instanceof Di||n instanceof ll||n instanceof Tp)}function Hx(n,e,t){if(!tV(t)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(t)){let i=Uv(t);throw i==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+i)}}function Ex(n,e,t){if((e=bn(e))instanceof Pd)return e._internalPath;if(typeof e=="string")return qx(n,e);throw Av("Field path arguments must be of type string or ",n,!1,void 0,t)}var JZ=new RegExp("[~\\*/\\[\\]]");function qx(n,e,t){if(e.search(JZ)>=0)throw Av(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Pd(...e.split("."))._internalPath}catch{throw Av(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Av(n,e,t,i,r){let s=i&&!i.isEmpty(),o=r!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${i}`),o&&(l+=` in document ${r}`),l+=")"),new be(se.INVALID_ARGUMENT,a+n+l)}function nV(n,e){return n.some(t=>t.isEqual(e))}var wp=class{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Di(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Tx(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Gv("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Tx=class extends wp{data(){return super.data()}};function Gv(n,e){return typeof e=="string"?qx(n,e):e instanceof Pd?e._internalPath:e._delegate._internalPath}function iV(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new be(se.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var bp=class{},Rd=class extends bp{};function rV(n,e,...t){let i=[];e instanceof bp&&i.push(e),i=i.concat(t),function(s){let o=s.filter(l=>l instanceof wx).length,a=s.filter(l=>l instanceof Dv).length;if(o>1||o>0&&a>0)throw new be(se.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(let r of i)n=r._apply(n);return n}var Dv=class n extends Rd{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=this._parse(e);return cV(e._query,t),new Ks(e.firestore,e.converter,mC(e._query,t))}_parse(e){let t=jv(e.firestore);return function(s,o,a,l,u,d,f){let m;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new be(se.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){JF(f,d);let y=[];for(let v of f)y.push(XF(l,s,v));m={arrayValue:{values:y}}}else m=XF(l,s,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||JF(f,d),m=J2(a,o,f,d==="in"||d==="not-in");return On.create(u,d,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function sV(n,e,t){let i=e,r=Gv("where",n);return Dv._create(r,i,t)}var wx=class n extends bp{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:os.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(r,s){let o=r,a=s.getFlattenedFilters();for(let l of a)cV(o,l),o=mC(o,l)}(e._query,t),new Ks(e.firestore,e.converter,mC(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var bx=class n extends Rd{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(r,s,o){if(r.startAt!==null)throw new be(se.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new be(se.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Cc(s,o)}(e._query,this._field,this._direction);return new Ks(e.firestore,e.converter,function(r,s){let o=r.explicitOrderBy.concat([s]);return new Yo(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}};function oV(n,e="asc"){let t=e,i=Gv("orderBy",n);return bx._create(i,t)}var Ix=class n extends Rd{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){return new Ks(e.firestore,e.converter,ov(e._query,this._limit,this._limitType))}};function aV(n){return WZ("limit",n),Ix._create("limit",n,"F")}var Sx=class n extends Rd{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=eX(e,this.type,this._docOrFields,this._inclusive);return new Ks(e.firestore,e.converter,function(r,s){return new Yo(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)}(e._query,t))}};function lV(...n){return Sx._create("startAfter",n,!1)}function eX(n,e,t,i){if(t[0]=bn(t[0]),t[0]instanceof wp)return function(s,o,a,l,u){if(!l)throw new be(se.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let f of vd(s))if(f.field.isKeyField())d.push(rv(o,l.key));else{let m=l.data.field(f.field);if(kv(m))throw new be(se.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){let y=f.field.canonicalString();throw new be(se.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(m)}return new il(d,u)}(n._query,n.firestore._databaseId,e,t[0]._document,i);{let r=jv(n.firestore);return function(o,a,l,u,d,f){let m=o.explicitOrderBy;if(d.length>m.length)throw new be(se.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let y=[];for(let v=0;v<d.length;v++){let E=d[v];if(m[v].field.isKeyField()){if(typeof E!="string")throw new be(se.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof E}`);if(!Mx(o)&&E.indexOf("/")!==-1)throw new be(se.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${E}' contains a slash.`);let T=o.path.child(cn.fromString(E));if(!Ue.isDocumentKey(T))throw new be(se.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${T}' is not because it contains an odd number of segments.`);let C=new Ue(T);y.push(rv(a,C))}else{let T=J2(l,u,E);y.push(T)}}return new il(y,f)}(n._query,n.firestore._databaseId,r,e,t,i)}}function XF(n,e,t){if(typeof(t=bn(t))=="string"){if(t==="")throw new be(se.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Mx(e)&&t.indexOf("/")!==-1)throw new be(se.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let i=e.path.child(cn.fromString(t));if(!Ue.isDocumentKey(i))throw new be(se.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return rv(n,new Ue(i))}if(t instanceof Di)return rv(n,t._key);throw new be(se.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Uv(t)}.`)}function JF(n,e){if(!Array.isArray(n)||n.length===0)throw new be(se.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function cV(n,e){let t=function(r,s){for(let o of r)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new be(se.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new be(se.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Cx=class{convertValue(e,t="none"){switch(Sc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ln(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nl(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ze()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let i={};return Dc(e,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertVectorValue(e){var t,i,r;let s=(r=(i=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.map(o=>ln(o.doubleValue));return new Tp(s)}convertGeoPoint(e){return new Ep(ln(e.latitude),ln(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":let i=Ax(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(cp(e));default:return null}}convertTimestamp(e){let t=Ko(e);return new vn(t.seconds,t.nanos)}convertDocumentKey(e,t){let i=cn.fromString(e);Gt(P2(i));let r=new iv(i.get(1),i.get(3)),s=new Ue(i.popFirst(5));return r.isEqual(t)||Wo(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function tX(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}var wc=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Pv=class extends wp{constructor(e,t,i,r,s,o){super(e,t,i,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Ed(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let i=this._document.data.field(Gv("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}},Ed=class extends Pv{data(e={}){return super.data(e)}},Rv=class{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new wc(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new Ed(this._firestore,this._userDataWriter,i.key,i,new wc(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new be(se.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(a=>{let l=new Ed(r._firestore,r._userDataWriter,a.doc.key,a.doc,new wc(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let l=new Ed(r._firestore,r._userDataWriter,a.doc.key,a.doc,new wc(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter),u=-1,d=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:nX(a.type),doc:l,oldIndex:u,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function nX(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ze()}}function uV(n){n=Nr(n,Di);let e=Nr(n.firestore,Ys);return zZ($v(e),n._key).then(t=>gV(e,n,t))}var Ip=class extends Cx{constructor(e){super(),this.firestore=e}convertBytes(e){return new _p(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Di(this.firestore,null,t)}};function dV(n){n=Nr(n,Ks);let e=Nr(n.firestore,Ys),t=$v(e),i=new Ip(e);return iV(n._query),HZ(t,n._query).then(r=>new Rv(e,i,n,r))}function hV(n,e,t,...i){n=Nr(n,Di);let r=Nr(n.firestore,Ys),s=jv(r),o;return o=typeof(e=bn(e))=="string"||e instanceof Pd?XZ(s,"updateDoc",n._key,e,t,i):ZZ(s,"updateDoc",n._key,e),Wx(r,[o.toMutation(n._key,qo.exists(!0))])}function fV(n){return Wx(Nr(n.firestore,Ys),[new hp(n._key,qo.none())])}function pV(n,e){let t=Nr(n.firestore,Ys),i=zx(n),r=tX(n.converter,e);return Wx(t,[QZ(jv(n.firestore),"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,qo.exists(!1))]).then(()=>i)}function mV(n,...e){var t,i,r;n=bn(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||ZF(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(ZF(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(i=f.error)===null||i===void 0?void 0:i.bind(f),e[o+2]=(r=f.complete)===null||r===void 0?void 0:r.bind(f)}let l,u,d;if(n instanceof Di)u=Nr(n.firestore,Ys),d=Lv(n._key.path),l={next:f=>{e[o]&&e[o](gV(u,n,f))},error:e[o+1],complete:e[o+2]};else{let f=Nr(n,Ks);u=Nr(f.firestore,Ys),d=f._query;let m=new Ip(u);l={next:y=>{e[o]&&e[o](new Rv(u,m,f,y))},error:e[o+1],complete:e[o+2]},iV(n._query)}return function(m,y,v,E){let T=new vp(E),C=new yp(y,T,v);return m.asyncQueue.enqueueAndForget(()=>U(this,null,function*(){return Ux(yield wv(m),C)})),()=>{T.Za(),m.asyncQueue.enqueueAndForget(()=>U(this,null,function*(){return $x(yield wv(m),C)}))}}($v(u),d,a,l)}function Wx(n,e){return function(i,r){let s=new rs;return i.asyncQueue.enqueueAndForget(()=>U(this,null,function*(){return kZ(yield GZ(i),r,s)})),s.promise}($v(n),e)}function gV(n,e,t){let i=t.docs.get(e._key),r=new Ip(n);return new Pv(n,r,e._key,i,new wc(t.hasPendingWrites,t.fromCache),e.converter)}function yV(...n){return new yx("arrayUnion",n)}function vV(...n){return new vx("arrayRemove",n)}function _V(n){return new _x("increment",n)}(function(e,t=!0){(function(r){Md=r})(Ya),Ka(new Lr("firestore",(i,{instanceIdentifier:r,options:s})=>{let o=i.getProvider("app").getImmediate(),a=new Ys(new YS(i.getProvider("auth-internal")),new JS(i.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new be(se.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new iv(u.options.projectId,d)}(o,r),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Bn(EF,"4.7.3",e),Bn(EF,"4.7.3","esm2017")})();var Mc=class{constructor(e){return e}},EV="firestore",Kx=class{constructor(){return Hf(EV)}};var Yx=new Pe("angularfire2.firestore-instances");function iX(n,e){let t=by(EV,n,e);return t&&new Mc(t)}function rX(n){return(e,t)=>{let i=e.runOutsideAngular(()=>n(t));return new Mc(i)}}var sX={provide:Kx,deps:[[new li,Yx]]},oX={provide:Mc,useFactory:iX,deps:[[new li,Yx],$o]};function TV(n,...e){return Bn("angularfire",mc.full,"fst"),Qr([oX,sX,{provide:Yx,useFactory:rX(n),multi:!0,deps:[Dt,ti,ud,gc,[new li,tp],[new li,cd],...e]}])}var wV=sn(pV,!0);var Qx=sn(vV,!0),Zx=sn(yV,!0);var Ld=sn(Y2,!0);var bV=sn(fV,!0);var kc=sn(zx,!0);var IV=sn(uV,!0);var zv=sn(dV,!0);var SV=sn(Q2,!0);var Hv=sn(_V,!0);var qv=sn(aV,!0);var CV=sn(mV,!0);var Dp=sn(oV,!0);var Od=sn(rV,!0);var xV=sn(lV,!0);var Lc=sn(hV,!0);var Wv=sn(sV,!0);var Pp={production:!1,firebase:{apiKey:"AIzaSyA9H-CYGk2kEsfzKyFMA6cdPQRRQMf750M",authDomain:"bengaluru-swada-1ecca.firebaseapp.com",projectId:"bengaluru-swada-1ecca",storageBucket:"bengaluru-swada-1ecca.firebasestorage.app",messagingSenderId:"831575973864",appId:"1:831575973864:web:8ba5a2fa1e28b9e16bce5d",measurementId:"G-DEZTYKDN53"},cloudflare:{workerUrl:"https://r2-video-uploader.bengaluru-swada.workers.dev",cdnUrl:"https://r2-video-uploader.bengaluru-swada.workers.dev",bucketName:"bengaluru-swada-videos"}};var Oc=class{hasShownSplash=!1;markSplashShown(){this.hasShownSplash=!0}shouldShowSplash(){return!this.hasShownSplash}reset(){this.hasShownSplash=!1}},as=()=>{let n=ue(gt);return ue(Oc).shouldShowSplash()?(console.log("[SplashGuard] Redirecting to splash screen"),n.createUrlTree(["/"])):!0};var Kv=class n{constructor(e,t,i){this.router=e;this.auth=t;this.appInit=i}minSplashDuration=1500;splashStartTime=0;authUnsubscribe;ngOnInit(){this.splashStartTime=Date.now(),console.log("[Splash] Splash screen started at:",new Date().toISOString()),this.authUnsubscribe=gF(this.auth,e=>{let t=Date.now()-this.splashStartTime,i=Math.max(0,this.minSplashDuration-t);console.log(`[Splash] Auth checked. Elapsed: ${t}ms, Waiting additional: ${i}ms`),setTimeout(()=>{this.appInit.markSplashShown(),e?(console.log("[Splash] User is logged in:",e.uid),this.router.navigate(["/main-app"],{replaceUrl:!0})):(console.log("[Splash] User is not logged in, navigating to phone-input"),this.router.navigate(["/phone-input"],{replaceUrl:!0}))},i)})}ngOnDestroy(){this.authUnsubscribe&&this.authUnsubscribe()}static \u0275fac=function(t){return new(t||n)(pe(gt),pe(jt),pe(Oc))};static \u0275cmp=_t({type:n,selectors:[["app-splash"]],standalone:!0,features:[Tt],decls:2,vars:0,consts:[[1,"splash-container"],["src","assets/logo.jpg","alt","Bengaluru Swada Logo",1,"splash-logo"]],template:function(t,i){t&1&&(N(0,"div",0),ae(1,"img",1),$())},dependencies:[Pt],styles:[".splash-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background-color:#fff}.splash-logo[_ngcontent-%COMP%]{max-width:80%;max-height:50vh;object-fit:contain;animation:_ngcontent-%COMP%_fadeIn 1.5s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}"]})};var OV=(()=>{class n{constructor(t,i){this._renderer=t,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(t,i){this._renderer.setProperty(this._elementRef.nativeElement,t,i)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static{this.\u0275fac=function(i){return new(i||n)(pe(tc),pe(Xr))}}static{this.\u0275dir=ci({type:n})}}return n})(),NV=(()=>{class n extends OV{static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=Ra(n)))(r||n)}})()}static{this.\u0275dir=ci({type:n,features:[Co]})}}return n})(),iA=new Pe("");var cX={provide:iA,useExisting:Da(()=>$i),multi:!0};function uX(){let n=Mo()?Mo().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var dX=new Pe(""),$i=(()=>{class n extends OV{constructor(t,i,r){super(t,i),this._compositionMode=r,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!uX())}writeValue(t){let i=t??"";this.setProperty("value",i)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static{this.\u0275fac=function(i){return new(i||n)(pe(tc),pe(Xr),pe(dX,8))}}static{this.\u0275dir=ci({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,r){i&1&&he("input",function(o){return r._handleInput(o.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(o){return r._compositionEnd(o.target.value)})},features:[Hu([cX]),Co]})}}return n})();function hX(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function fX(n){return n!=null&&typeof n.length=="number"}var rA=new Pe(""),pX=new Pe("");function mX(n){return e=>fX(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function gX(n){if(!n)return Xx;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),i=>{if(hX(i.value))return null;let r=i.value;return e.test(r)?null:{pattern:{requiredPattern:t,actualValue:r}}}}function Xx(n){return null}function FV(n){return n!=null}function VV(n){return ic(n)?tn(n):n}function BV(n){let e={};return n.forEach(t=>{e=t!=null?de(de({},e),t):e}),Object.keys(e).length===0?null:e}function UV(n,e){return e.map(t=>t(n))}function yX(n){return!n.validate}function $V(n){return n.map(e=>yX(e)?e:t=>e.validate(t))}function vX(n){if(!n)return null;let e=n.filter(FV);return e.length==0?null:function(t){return BV(UV(t,e))}}function jV(n){return n!=null?vX($V(n)):null}function _X(n){if(!n)return null;let e=n.filter(FV);return e.length==0?null:function(t){let i=UV(t,e).map(VV);return NE(i).pipe(We(BV))}}function GV(n){return n!=null?_X($V(n)):null}function AV(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function EX(n){return n._rawValidators}function TX(n){return n._rawAsyncValidators}function Jx(n){return n?Array.isArray(n)?n:[n]:[]}function Qv(n,e){return Array.isArray(n)?n.includes(e):n===e}function DV(n,e){let t=Jx(e);return Jx(n).forEach(r=>{Qv(t,r)||t.push(r)}),t}function PV(n,e){return Jx(e).filter(t=>!Qv(n,t))}var Zv=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=jV(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=GV(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},eA=class extends Zv{get formDirective(){return null}get path(){return null}},Op=class extends Zv{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},tA=class{constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},wX={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},Jme=qe(de({},wX),{"[class.ng-submitted]":"isSubmitted"}),Fr=(()=>{class n extends tA{constructor(t){super(t)}static{this.\u0275fac=function(i){return new(i||n)(pe(Op,2))}}static{this.\u0275dir=ci({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,r){i&2&&Qe("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},features:[Co]})}}return n})();var Rp="VALID",Yv="INVALID",Nd="PENDING",Mp="DISABLED",Vd=class{},Xv=class extends Vd{constructor(e,t){super(),this.value=e,this.source=t}},kp=class extends Vd{constructor(e,t){super(),this.pristine=e,this.source=t}},Lp=class extends Vd{constructor(e,t){super(),this.touched=e,this.source=t}},Fd=class extends Vd{constructor(e,t){super(),this.status=e,this.source=t}};function bX(n){return(Jv(n)?n.validators:n)||null}function IX(n){return Array.isArray(n)?jV(n):n||null}function SX(n,e){return(Jv(e)?e.asyncValidators:n)||null}function CX(n){return Array.isArray(n)?GV(n):n||null}function Jv(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}var nA=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=f0(()=>this.statusReactive()),this.statusReactive=a0(void 0),this._pristine=f0(()=>this.pristineReactive()),this.pristineReactive=a0(!0),this._touched=f0(()=>this.touchedReactive()),this.touchedReactive=a0(!1),this._events=new zn,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return Na(this.statusReactive)}set status(e){Na(()=>this.statusReactive.set(e))}get valid(){return this.status===Rp}get invalid(){return this.status===Yv}get pending(){return this.status==Nd}get disabled(){return this.status===Mp}get enabled(){return this.status!==Mp}get pristine(){return Na(this.pristineReactive)}set pristine(e){Na(()=>this.pristineReactive.set(e))}get dirty(){return!this.pristine}get touched(){return Na(this.touchedReactive)}set touched(e){Na(()=>this.touchedReactive.set(e))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(DV(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(DV(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(PV(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(PV(e,this._rawAsyncValidators))}hasValidator(e){return Qv(this._rawValidators,e)}hasAsyncValidator(e){return Qv(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let i=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(qe(de({},e),{sourceControl:i})),t&&e.emitEvent!==!1&&this._events.next(new Lp(!0,i))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let i=e.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:i})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,i),t&&e.emitEvent!==!1&&this._events.next(new Lp(!1,i))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let i=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(qe(de({},e),{sourceControl:i})),t&&e.emitEvent!==!1&&this._events.next(new kp(!1,i))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let i=e.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,i),t&&e.emitEvent!==!1&&this._events.next(new kp(!0,i))}markAsPending(e={}){this.status=Nd;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Fd(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(qe(de({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Mp,this.errors=null,this._forEachChild(r=>{r.disable(qe(de({},e),{onlySelf:!0}))}),this._updateValue();let i=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Xv(this.value,i)),this._events.next(new Fd(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(qe(de({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Rp,this._forEachChild(i=>{i.enable(qe(de({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(qe(de({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let i=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Rp||this.status===Nd)&&this._runAsyncValidator(i,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Xv(this.value,t)),this._events.next(new Fd(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(qe(de({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Mp:Rp}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=Nd,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let i=VV(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((i,r)=>i&&i._find(r),this)}getError(e,t){let i=t?this.get(t):this;return i&&i.errors?i.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,i){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||i)&&this._events.next(new Fd(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,i)}_initObservables(){this.valueChanges=new tt,this.statusChanges=new tt}_calculateStatus(){return this._allControlsDisabled()?Mp:this.errors?Yv:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Nd)?Nd:this._anyControlsHaveStatus(Yv)?Yv:Rp}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let i=!this._anyControlsDirty(),r=this.pristine!==i;this.pristine=i,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),r&&this._events.next(new kp(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new Lp(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Jv(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=IX(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=CX(this._rawAsyncValidators)}};var zV=new Pe("CallSetDisabledState",{providedIn:"root",factory:()=>sA}),sA="always";function xX(n,e){return[...e.path,n]}function AX(n,e,t=sA){PX(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),RX(n,e),kX(n,e),MX(n,e),DX(n,e)}function RV(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function DX(n,e){if(e.valueAccessor.setDisabledState){let t=i=>{e.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function PX(n,e){let t=EX(n);e.validator!==null?n.setValidators(AV(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let i=TX(n);e.asyncValidator!==null?n.setAsyncValidators(AV(i,e.asyncValidator)):typeof i=="function"&&n.setAsyncValidators([i]);let r=()=>n.updateValueAndValidity();RV(e._rawValidators,r),RV(e._rawAsyncValidators,r)}function RX(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&HV(n,e)})}function MX(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&HV(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function HV(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function kX(n,e){let t=(i,r)=>{e.valueAccessor.writeValue(i),r&&e.viewToModelUpdate(i)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function LX(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function OX(n){return Object.getPrototypeOf(n.constructor)===NV}function NX(n,e){if(!e)return null;Array.isArray(e);let t,i,r;return e.forEach(s=>{s.constructor===$i?t=s:OX(s)?i=s:r=s}),r||i||t||null}function MV(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function kV(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var FX=class extends nA{constructor(e=null,t,i){super(bX(t),SX(i,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Jv(t)&&(t.nonNullable||t.initialValueIsDefault)&&(kV(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(i=>i(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){MV(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){MV(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){kV(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var VX={provide:Op,useExisting:Da(()=>pr)},LV=Promise.resolve(),pr=(()=>{class n extends Op{constructor(t,i,r,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this.control=new FX,this._registered=!1,this.name="",this.update=new tt,this._parent=t,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=NX(this,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let i=t.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),LX(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){AX(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){LV.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let i=t.isDisabled.currentValue,r=i!==0&&rc(i);LV.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?xX(t,this._parent):[t]}static{this.\u0275fac=function(i){return new(i||n)(pe(eA,9),pe(rA,10),pe(pX,10),pe(iA,10),pe(xi,8),pe(zV,8))}}static{this.\u0275dir=ci({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Hu([VX]),Co,Dr]})}}return n})();var BX={provide:iA,useExisting:Da(()=>oA),multi:!0},oA=(()=>{class n extends NV{writeValue(t){let i=t??"";this.setProperty("value",i)}registerOnChange(t){this.onChange=i=>{t(i==""?null:parseFloat(i))}}static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=Ra(n)))(r||n)}})()}static{this.\u0275dir=ci({type:n,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(i,r){i&1&&he("input",function(o){return r.onChange(o.target.value)})("blur",function(){return r.onTouched()})},features:[Hu([BX]),Co]})}}return n})();function UX(n){return typeof n=="number"?n:parseInt(n,10)}var qV=(()=>{class n{constructor(){this._validator=Xx}ngOnChanges(t){if(this.inputName in t){let i=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):Xx,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275dir=ci({type:n,features:[Dr]})}}return n})();var $X={provide:rA,useExisting:Da(()=>Np),multi:!0},Np=(()=>{class n extends qV{constructor(){super(...arguments),this.inputName="maxlength",this.normalizeInput=t=>UX(t),this.createValidator=t=>mX(t)}static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=Ra(n)))(r||n)}})()}static{this.\u0275dir=ci({type:n,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&xo("maxlength",r._enabled?r.maxlength:null)},inputs:{maxlength:"maxlength"},features:[Hu([$X]),Co]})}}return n})(),jX={provide:rA,useExisting:Da(()=>aA),multi:!0},aA=(()=>{class n extends qV{constructor(){super(...arguments),this.inputName="pattern",this.normalizeInput=t=>t,this.createValidator=t=>gX(t)}static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=Ra(n)))(r||n)}})()}static{this.\u0275dir=ci({type:n,selectors:[["","pattern","","formControlName",""],["","pattern","","formControl",""],["","pattern","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&xo("pattern",r._enabled?r.pattern:null)},inputs:{pattern:"pattern"},features:[Hu([jX]),Co]})}}return n})();var GX=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=Ps({type:n})}static{this.\u0275inj=Ds({})}}return n})();var ji=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:zV,useValue:t.callSetDisabledState??sA}]}}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=Ps({type:n})}static{this.\u0275inj=Ds({imports:[GX]})}}return n})();var Ud=class n{constructor(e){this.auth=e}confirmationResult=null;phoneNumber="";sendOtp(e,t){return U(this,null,function*(){try{let i=yield yF(this.auth,e,t);return this.setConfirmationResult(i),this.setPhoneNumber(e),i}catch(i){throw i}})}setConfirmationResult(e){this.confirmationResult=e}getConfirmationResult(){return this.confirmationResult}setPhoneNumber(e){this.phoneNumber=e}getPhoneNumber(){return this.phoneNumber}static \u0275fac=function(t){return new(t||n)(Me(jt))};static \u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})};function zX(n,e){if(n&1&&(N(0,"div",17),Re(),N(1,"svg",18),ae(2,"circle",19)(3,"line",20)(4,"line",21),$(),Be(),N(5,"span"),ee(6),$()()),n&2){let t=ve();W(6),ut(t.error)}}function HX(n,e){n&1&&(N(0,"span"),ee(1,"Continue"),$())}function qX(n,e){n&1&&(N(0,"div",22),ae(1,"div",23)(2,"div",23)(3,"div",23),$())}var e_=class n{constructor(e,t,i){this.router=e;this.auth=t;this.phoneAuthService=i}mobile="";valid=!1;loading=!1;error="";isFocused=!1;recaptchaVerifier;confirmationResult;ngOnInit(){setTimeout(()=>{this.recaptchaVerifier=new _c(this.auth,"recaptcha-container",{size:"invisible",callback:()=>console.log("reCAPTCHA success"),"expired-callback":()=>this.error="ReCAPTCHA expired. Try again."}),this.recaptchaVerifier.render()})}onInput(){this.valid=/^\d{10}$/.test(this.mobile),this.error=""}continue(){return U(this,null,function*(){if(!(!this.valid||this.loading)){this.loading=!0,this.error="";try{let e="+91"+this.mobile;this.confirmationResult=yield this.phoneAuthService.sendOtp(e,this.recaptchaVerifier),this.router.navigate(["/otp"])}catch(e){console.error(e),e.code==="auth/invalid-phone-number"?this.error="Invalid phone number.":e.code==="auth/too-many-requests"?this.error="Too many attempts. Try again later.":e.code==="auth/quota-exceeded"?this.error="SMS quota exceeded.":e.code==="auth/billing-not-enabled"?this.error="Firebase billing is not enabled. Please enable it in the Firebase Console.":this.error=`Failed to send OTP: ${e.message} (${e.code})`,this.loading=!1}}})}static \u0275fac=function(t){return new(t||n)(pe(gt),pe(jt),pe(Ud))};static \u0275cmp=_t({type:n,selectors:[["app-phone-input"]],standalone:!0,features:[Tt],decls:21,vars:10,consts:[[1,"ios-login-layout"],[1,"login-content"],[1,"header-section"],[1,"welcome-title"],[1,"subtitle"],[1,"input-wrapper"],[1,"phone-input-group"],[1,"country-code"],[1,"vertical-divider"],["type","tel","id","mobileNumber","placeholder","Mobile Number","maxlength","10","pattern","[0-9]{10}",3,"ngModelChange","input","focus","blur","ngModel","disabled"],["class","error-feedback",4,"ngIf"],[1,"bottom-actions"],["id","recaptcha-container"],[1,"privacy-note"],[1,"continue-btn",3,"click","disabled"],[4,"ngIf"],["class","spinner-dots",4,"ngIf"],[1,"error-feedback"],["width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["cx","12","cy","12","r","10"],["x1","12","y1","8","x2","12","y2","12"],["x1","12","y1","16","x2","12.01","y2","16"],[1,"spinner-dots"],[1,"dot"]],template:function(t,i){t&1&&(N(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),ee(4,"Bengaluru Swada"),$(),N(5,"p",4),ee(6,"Enter your number to start exploring."),$()(),N(7,"div",5)(8,"div",6)(9,"span",7),ee(10,"+91"),$(),ae(11,"div",8),N(12,"input",9),ii("ngModelChange",function(s){return di(i.mobile,s)||(i.mobile=s),s}),he("input",function(){return i.onInput()})("focus",function(){return i.isFocused=!0})("blur",function(){return i.isFocused=!1}),$()(),Ve(13,zX,7,1,"div",10),$(),N(14,"div",11),ae(15,"div",12),N(16,"p",13),ee(17," By continuing, you verify that you are the owner of this number. "),$(),N(18,"button",14),he("click",function(){return i.continue()}),Ve(19,HX,2,0,"span",15)(20,qX,4,0,"div",16),$()()()()),t&2&&(W(8),Qe("focused",i.isFocused),W(4),ni("ngModel",i.mobile),ce("disabled",i.loading),W(),ce("ngIf",i.error),W(5),Qe("active",i.valid&&!i.loading),ce("disabled",!i.valid||i.loading),W(),ce("ngIf",!i.loading),W(),ce("ngIf",i.loading))},dependencies:[Pt,qt,ji,$i,Fr,Np,aA,pr],styles:["[_nghost-%COMP%]{display:block;height:100vh;font-family:-apple-system,BlinkMacSystemFont,SF Pro Display,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#fff}.ios-login-layout[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;padding:24px;box-sizing:border-box;overflow-x:hidden;width:100%}.login-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;max-width:480px;margin:0 auto;width:100%}.header-section[_ngcontent-%COMP%]{margin-top:40px;margin-bottom:32px;animation:_ngcontent-%COMP%_slideDown .6s cubic-bezier(.2,.8,.2,1)}.welcome-title[_ngcontent-%COMP%]{font-size:34px;font-weight:800;color:#1c1c1e;line-height:1.1;margin:0 0 12px;letter-spacing:-.02em}.subtitle[_ngcontent-%COMP%]{font-size:17px;color:#8e8e93;margin:0;font-weight:400}.input-wrapper[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .8s ease backwards;animation-delay:.2s}.phone-input-group[_ngcontent-%COMP%]{background:#f2f2f7;border-radius:16px;padding:4px 16px;display:flex;align-items:center;height:64px;transition:background .2s,box-shadow .2s;border:2px solid transparent}.phone-input-group.focused[_ngcontent-%COMP%]{background:#fff;border-color:var(--primary-color);box-shadow:0 4px 20px var(--primary-shadow-sm)}.country-code[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#1c1c1e}.vertical-divider[_ngcontent-%COMP%]{width:1px;height:24px;background:#c7c7cc;margin:0 16px}input[_ngcontent-%COMP%]{flex:1;border:none;background:transparent;font-size:20px;font-weight:500;color:#1c1c1e;outline:none;padding:0;letter-spacing:.5px;height:100%}input[_ngcontent-%COMP%]::placeholder{color:#aeaeb2}.error-feedback[_ngcontent-%COMP%]{margin-top:12px;display:flex;align-items:center;gap:6px;color:var(--primary-color);font-size:13px;font-weight:500;padding-left:8px;animation:_ngcontent-%COMP%_shake .4s ease}.bottom-actions[_ngcontent-%COMP%]{margin-top:32px;margin-bottom:24px;animation:_ngcontent-%COMP%_slideUp .6s cubic-bezier(.2,.8,.2,1);animation-delay:.3s}.privacy-note[_ngcontent-%COMP%]{font-size:13px;color:#aeaeb2;text-align:center;margin-bottom:24px}.continue-btn[_ngcontent-%COMP%]{width:100%;height:56px;border-radius:16px;background:#e5e5ea;color:#8e8e93;font-size:17px;font-weight:600;border:none;cursor:not-allowed;transition:transform .1s,background .3s,box-shadow .3s;display:flex;align-items:center;justify-content:center}.continue-btn.active[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;cursor:pointer;box-shadow:0 8px 24px var(--primary-shadow)}.continue-btn.active[_ngcontent-%COMP%]:active{transform:scale(.96)}.spinner-dots[_ngcontent-%COMP%]{display:flex;gap:4px}.spinner-dots[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{width:8px;height:8px;background:#fff;border-radius:50%;animation:_ngcontent-%COMP%_bounce 1.4s infinite ease-in-out both}.spinner-dots[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]:nth-child(1){animation-delay:-.32s}.spinner-dots[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]:nth-child(2){animation-delay:-.16s}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_shake{0%,to{transform:translate(0)}25%{transform:translate(-4px)}75%{transform:translate(4px)}}@keyframes _ngcontent-%COMP%_bounce{0%,80%,to{transform:scale(0)}40%{transform:scale(1)}}"]})};var WX=()=>[0,1,2,3,4,5];function KX(n,e){if(n&1){let t=Et();N(0,"div",21)(1,"input",22),ii("ngModelChange",function(r){let s=xe(t).index,o=ve();return di(o.otp[s],r)||(o.otp[s]=r),Ae(r)}),he("input",function(){let r=xe(t).index,s=ve();return Ae(s.onOtpInput(r))})("keydown",function(r){let s=xe(t).index,o=ve();return Ae(o.onKeyDown(r,s))})("focus",function(){let r=xe(t).index,s=ve();return Ae(s.currentFocusIndex=r)})("blur",function(){xe(t);let r=ve();return Ae(r.currentFocusIndex=-1)}),$()()}if(n&2){let t=e.index,i=ve();Qe("filled",(i.otp[t]==null?null:i.otp[t].length)>0)("active",t===i.currentFocusIndex),W(),ni("ngModel",i.otp[t])}}function YX(n,e){if(n&1&&(N(0,"div",23),Re(),N(1,"svg",24),ae(2,"circle",25)(3,"line",26)(4,"line",27),$(),Be(),N(5,"span"),ee(6),$()()),n&2){let t=ve();W(6),ut(t.error||"Invalid code. Please try again.")}}function QX(n,e){if(n&1&&(N(0,"p",28),ee(1," Resend code in "),N(2,"span",29),ee(3),$()()),n&2){let t=ve();W(3),Mt("00:",t.countdown<10?"0"+t.countdown:t.countdown,"")}}function ZX(n,e){if(n&1){let t=Et();N(0,"button",30),he("click",function(){xe(t);let r=ve();return Ae(r.resend())}),ee(1," Resend Code "),$()}}function XX(n,e){n&1&&(N(0,"span"),ee(1,"Verify Number"),$())}function JX(n,e){n&1&&(N(0,"div",31),ae(1,"div",32)(2,"div",32)(3,"div",32),$())}function eJ(n,e){n&1&&(N(0,"div",33)(1,"div",34),Re(),N(2,"svg",35),ae(3,"polyline",36),$()(),Be(),N(4,"h2"),ee(5,"Verified"),$()())}var t_=class n{constructor(e,t,i,r,s){this.router=e;this.cdr=t;this.phoneAuthService=i;this.auth=r;this.document=s;this.phone=this.phoneAuthService.getPhoneNumber(),this.confirmationResult=this.phoneAuthService.getConfirmationResult(),this.confirmationResult||this.router.navigate(["/phone-input"])}phone="";back=new tt;verified=new tt;otp=["","","","","",""];countdown=30;timerHandle;complete=!1;loading=!1;error="";currentFocusIndex=-1;confirmationResult=null;hasError=!1;isVerified=!1;recaptchaVerifier;ngOnInit(){this.startTimer(),setTimeout(()=>{this.recaptchaVerifier||(this.recaptchaVerifier=new _c(this.auth,"recaptcha-container-otp",{size:"invisible",callback:()=>{}}))})}startTimer(){clearInterval(this.timerHandle),this.countdown=30,this.timerHandle=setInterval(()=>{this.countdown>0?this.countdown--:clearInterval(this.timerHandle),this.cdr.detectChanges()},1e3)}onOtpInput(e){if(this.complete=this.otp.join("").length===6&&/^\d{6}$/.test(this.otp.join("")),this.error="",this.hasError=!1,this.otp[e]&&e<5){let t=this.document.querySelectorAll(".native-input")[e+1];t&&t.focus()}}onKeyDown(e,t){if(e.key==="Backspace"&&!this.otp[t]&&t>0){let i=this.document.querySelectorAll(".native-input")[t-1];i&&i.focus()}}verify(){return U(this,null,function*(){if(!(!this.complete||this.loading||!this.confirmationResult)){this.loading=!0,this.error="",this.hasError=!1;try{let e=this.otp.join(""),t=yield this.confirmationResult.confirm(e);console.log("User signed in successfully:",t.user),this.isVerified=!0,this.loading=!1,setTimeout(()=>{this.router.navigate(["/location-permission"],{replaceUrl:!0})},2e3)}catch(e){console.error("Error verifying OTP:",e),e.code==="auth/invalid-verification-code"?this.error="Invalid OTP. Please check and try again.":e.code==="auth/code-expired"?this.error="OTP has expired. Please request a new one.":this.error="Verification failed. Please try again.",this.loading=!1,this.hasError=!0,this.complete=!1}}})}resend(){return U(this,null,function*(){if(!this.loading){this.loading=!0,this.error="";try{console.log("Current stored phone:",this.phone);let e=this.phone;e.startsWith("+")||(e="+91"+e),console.log("Sending OTP to:",e);let t=yield this.phoneAuthService.sendOtp(e,this.recaptchaVerifier);this.confirmationResult=t,this.phoneAuthService.setConfirmationResult(t),this.startTimer(),this.otp=["","","","","",""],this.complete=!1,this.loading=!1}catch(e){console.error("Resend error:",e),this.error="Failed to resend OTP. Try again later.",this.loading=!1}}})}change(){this.router.navigate(["/phone-input"])}static \u0275fac=function(t){return new(t||n)(pe(gt),pe(xi),pe(Ud),pe(jt),pe(yn))};static \u0275cmp=_t({type:n,selectors:[["app-otp"]],outputs:{back:"back",verified:"verified"},standalone:!0,features:[Tt],decls:25,vars:12,consts:[[1,"ios-otp-layout"],[1,"otp-content"],[1,"top-bar",3,"click"],["width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","#007AFF","stroke-width","2"],["d","M15 18l-6-6 6-6"],[1,"back-text"],[1,"header-section"],[1,"subtitle"],[1,"highlight-phone"],[1,"otp-wrapper"],["class","digit-box",3,"filled","active",4,"ngFor","ngForOf"],["class","error-feedback",4,"ngIf"],[1,"action-area"],[1,"resend-wrapper"],["class","timer-text",4,"ngIf"],["class","resend-btn",3,"click",4,"ngIf"],[1,"verify-action-btn",3,"click","disabled"],[4,"ngIf"],["class","spinner-dots",4,"ngIf"],["id","recaptcha-container-otp"],["class","success-screen",4,"ngIf"],[1,"digit-box"],["type","text","inputmode","numeric","maxlength","1",1,"native-input",3,"ngModelChange","input","keydown","focus","blur","ngModel"],[1,"error-feedback"],["width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["cx","12","cy","12","r","10"],["x1","12","y1","8","x2","12","y2","12"],["x1","12","y1","16","x2","12.01","y2","16"],[1,"timer-text"],[1,"time-val"],[1,"resend-btn",3,"click"],[1,"spinner-dots"],[1,"dot"],[1,"success-screen"],[1,"success-icon-box"],["width","40","height","40","viewBox","0 0 24 24","fill","none","stroke","white","stroke-width","3"],["points","20 6 9 17 4 12"]],template:function(t,i){t&1&&(N(0,"div",0)(1,"div",1)(2,"div",2),he("click",function(){return i.change()}),Re(),N(3,"svg",3),ae(4,"path",4),$(),Be(),N(5,"span",5),ee(6,"Wrong number?"),$()(),N(7,"div",6)(8,"p",7),ee(9,"Enter the 6-digit code sent to "),ae(10,"br"),N(11,"span",8),ee(12),$()()(),N(13,"div",9),Ve(14,KX,2,5,"div",10),$(),Ve(15,YX,7,1,"div",11),N(16,"div",12)(17,"div",13),Ve(18,QX,4,1,"p",14)(19,ZX,2,0,"button",15),$(),N(20,"button",16),he("click",function(){return i.verify()}),Ve(21,XX,2,0,"span",17)(22,JX,4,0,"div",18),$(),ae(23,"div",19),$()(),Ve(24,eJ,6,0,"div",20),$()),t&2&&(W(12),ut(i.phone),W(2),ce("ngForOf",xk(11,WX)),W(),ce("ngIf",i.hasError||i.error),W(3),ce("ngIf",i.countdown>0),W(),ce("ngIf",i.countdown===0),W(),Qe("active",i.complete&&!i.loading),ce("disabled",!i.complete||i.loading),W(),ce("ngIf",!i.loading),W(),ce("ngIf",i.loading),W(2),ce("ngIf",i.isVerified))},dependencies:[ji,$i,Fr,Np,pr,Pt,Hn,qt],styles:["[_nghost-%COMP%]{display:block;height:100vh;font-family:-apple-system,BlinkMacSystemFont,SF Pro Display,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#fff}.ios-otp-layout[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;padding:0 32px;box-sizing:border-box;position:relative}.otp-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;max-width:480px;margin:0 auto;width:100%;padding-top:20px}.top-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;cursor:pointer;padding:12px 0;opacity:0;animation:_ngcontent-%COMP%_fadeIn .6s ease forwards;width:fit-content}.top-bar[_ngcontent-%COMP%]   .back-text[_ngcontent-%COMP%]{font-size:15px;color:#007aff;font-weight:500}.header-section[_ngcontent-%COMP%]{margin-top:40px;margin-bottom:40px;animation:_ngcontent-%COMP%_slideDown .6s cubic-bezier(.2,.8,.2,1)}.verify-title[_ngcontent-%COMP%]{font-size:34px;font-weight:800;color:#1c1c1e;line-height:1.1;margin:0 0 12px;letter-spacing:-.02em}.subtitle[_ngcontent-%COMP%]{font-size:17px;color:#8e8e93;margin:0;font-weight:400;line-height:1.5}.subtitle[_ngcontent-%COMP%]   .highlight-phone[_ngcontent-%COMP%]{color:#1c1c1e;font-weight:600}.otp-wrapper[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:space-between;margin-bottom:16px;animation:_ngcontent-%COMP%_fadeIn .8s ease backwards .2s}.digit-box[_ngcontent-%COMP%]{flex:1;aspect-ratio:.85;background:#f2f2f7;border-radius:12px;position:relative;border:2px solid transparent;transition:all .2s}.digit-box.active[_ngcontent-%COMP%]{background:#fff;border-color:var(--primary-color);box-shadow:0 4px 12px var(--primary-shadow-sm);transform:translateY(-2px)}.digit-box.filled[_ngcontent-%COMP%]{background:#f2f2f7;border-color:#e5e5ea}.digit-box.filled[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#1c1c1e}.digit-box[_ngcontent-%COMP%]   .native-input[_ngcontent-%COMP%]{width:100%;height:100%;border:none;background:transparent;text-align:center;font-size:24px;font-weight:700;color:#1c1c1e;padding:0;outline:none;caret-color:var(--primary-color)}.error-feedback[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;color:var(--primary-color);font-size:14px;font-weight:500;animation:_ngcontent-%COMP%_shake .4s ease}.action-area[_ngcontent-%COMP%]{margin-top:32px;margin-bottom:32px;display:flex;flex-direction:column;gap:24px;animation:_ngcontent-%COMP%_slideUp .6s cubic-bezier(.2,.8,.2,1) .3s backwards}.resend-wrapper[_ngcontent-%COMP%]{text-align:center;min-height:20px}.timer-text[_ngcontent-%COMP%]{font-size:15px;color:#8e8e93;margin:0}.timer-text[_ngcontent-%COMP%]   .time-val[_ngcontent-%COMP%]{font-variant-numeric:tabular-nums;color:#1c1c1e;font-weight:600}.resend-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary-color);font-size:15px;font-weight:600;cursor:pointer;padding:4px 12px}.resend-btn[_ngcontent-%COMP%]:active{opacity:.7}.verify-action-btn[_ngcontent-%COMP%]{width:100%;height:56px;border-radius:16px;background:#e5e5ea;color:#8e8e93;font-size:17px;font-weight:600;border:none;cursor:not-allowed;transition:transform .1s,background .3s,box-shadow .3s;display:flex;align-items:center;justify-content:center}.verify-action-btn.active[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;cursor:pointer;box-shadow:0 8px 24px var(--primary-shadow)}.verify-action-btn.active[_ngcontent-%COMP%]:active{transform:scale(.96)}.spinner-dots[_ngcontent-%COMP%]{display:flex;gap:4px}.spinner-dots[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{width:8px;height:8px;background:#fff;border-radius:50%;animation:_ngcontent-%COMP%_bounce 1.4s infinite ease-in-out both}.spinner-dots[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]:nth-child(1){animation-delay:-.32s}.spinner-dots[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]:nth-child(2){animation-delay:-.16s}.success-screen[_ngcontent-%COMP%]{position:absolute;inset:0;background:#fffffffa;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:100;animation:_ngcontent-%COMP%_fadeIn .3s ease}.success-screen[_ngcontent-%COMP%]   .success-icon-box[_ngcontent-%COMP%]{width:80px;height:80px;background:#34c759;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-bottom:24px;box-shadow:0 8px 24px #34c7594d;animation:_ngcontent-%COMP%_scaleIn .4s cubic-bezier(.175,.885,.32,1.275)}.success-screen[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#1c1c1e;margin:0;animation:_ngcontent-%COMP%_slideUp .4s ease .1s backwards}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scaleIn{0%{transform:scale(0)}to{transform:scale(1)}}@keyframes _ngcontent-%COMP%_shake{0%,to{transform:translate(0)}25%{transform:translate(-4px)}75%{transform:translate(4px)}}@keyframes _ngcontent-%COMP%_bounce{0%,80%,to{transform:scale(0)}40%{transform:scale(1)}}"]})};var Gi=class n{userLocation=null;locationPromise=null;LOCATION_TIMEOUT_MS=5e3;DEFAULT_LOCATION={latitude:12.9352,longitude:77.6245};AREAS=[{name:"Adugodi",pincode:"560030",lat:12.9716,lng:77.5946},{name:"Agaram",pincode:"560007",lat:12.8431,lng:77.4863},{name:"Air Force Stn. Yelahanka",pincode:"560063",lat:13.1048,lng:77.5763},{name:"Banashankari",pincode:"560050",lat:12.925453,lng:77.546761},{name:"Banashankari 2nd Stage",pincode:"560070",lat:12.9249,lng:77.5662},{name:"Banashankari 3rd Stage",pincode:"560085",lat:12.9216,lng:77.5543},{name:"Banashankari 6th Stage",pincode:"560062",lat:12.8963,lng:77.5353},{name:"Banaswadi",pincode:"560043",lat:13.0159,lng:77.6516},{name:"Basavanapura",pincode:"560036",lat:12.9835,lng:77.6773},{name:"Basaveshwaranagar",pincode:"560079",lat:12.9975,lng:77.5334},{name:"Bellandur",pincode:"560103",lat:12.9304,lng:77.6784},{name:"Bidadi",pincode:"562109",lat:12.8274,lng:77.3971},{name:"Bilekahalli",pincode:"560076",lat:12.8989,lng:77.6103},{name:"Binnamangala",pincode:"560038",lat:12.9837,lng:77.6388},{name:"Bommanahalli",pincode:"560068",lat:12.9082,lng:77.6245},{name:"Bommasandra",pincode:"560099",lat:12.8009,lng:77.699},{name:"Brookefield",pincode:"560037",lat:12.9698,lng:77.7184},{name:"BTM 2nd Stage",pincode:"560076",lat:12.9167,lng:77.6108},{name:"Budigere",pincode:"562129",lat:13.035,lng:77.7478},{name:"Byatarayanapura",pincode:"560026",lat:13.056,lng:77.5926},{name:"C V Raman Nagar",pincode:"560093",lat:12.9767,lng:77.6597},{name:"Chamarajpet",pincode:"560018",lat:12.9582,lng:77.5709},{name:"Channasandra",pincode:"560067",lat:12.9629,lng:77.758},{name:"Chikbasavanapura",pincode:"560067",lat:12.9948,lng:77.7327},{name:"Chickpet",pincode:"560053",lat:12.9662,lng:77.5767},{name:"Chikkalasandra",pincode:"560061",lat:12.9132,lng:77.5454},{name:"Choodasandra",pincode:"560099",lat:12.8848,lng:77.6785},{name:"Cox Town",pincode:"560005",lat:12.9996,lng:77.6229},{name:"D J Halli",pincode:"560005",lat:13.0083,lng:77.6228},{name:"Doddabidarakallu",pincode:"560073",lat:13.0426,lng:77.5019},{name:"Doorvaninagar",pincode:"560016",lat:13.0252,lng:77.6688},{name:"Ejipura",pincode:"560047",lat:12.9437,lng:77.6274},{name:"Electronic City",pincode:"560100",lat:12.8394,lng:77.677},{name:"Frazer Town",pincode:"560005",lat:12.999,lng:77.6226},{name:"Gandhi Nagar",pincode:"560009",lat:12.9772,lng:77.573},{name:"Gavipuram Extn",pincode:"560019",lat:12.9552,lng:77.5668},{name:"Geddalahalli",pincode:"560077",lat:13.0309,lng:77.6389},{name:"Gottigere",pincode:"560083",lat:12.8725,lng:77.5944},{name:"Halasur",pincode:"560042",lat:12.9833,lng:77.6194},{name:"Hebbal",pincode:"560024",lat:13.0355,lng:77.606},{name:"Heggere",pincode:"560073",lat:13.0172,lng:77.5004},{name:"HMT Layout",pincode:"560031",lat:13.039,lng:77.547},{name:"Horamavu",pincode:"560043",lat:13.0267,lng:77.6571},{name:"Hosakerehalli",pincode:"560085",lat:12.9251,lng:77.536},{name:"HSR Layout",pincode:"560102",lat:12.9121,lng:77.6446},{name:"Hulimavu",pincode:"560076",lat:12.8829,lng:77.6083},{name:"Indiranagar",pincode:"560038",lat:12.9719,lng:77.6412},{name:"ISRO Layout",pincode:"560078",lat:12.9056,lng:77.5665},{name:"J P Nagar",pincode:"560078",lat:12.9041,lng:77.5852},{name:"Jakkur",pincode:"560064",lat:13.0811,lng:77.5924},{name:"Jalahalli",pincode:"560013",lat:13.0491,lng:77.5422},{name:"Jayanagar 4th T Block",pincode:"560041",lat:12.9352,lng:77.5837},{name:"Jigani",pincode:"560105",lat:12.7849,lng:77.642},{name:"Kadubeesanahalli",pincode:"560103",lat:12.956,lng:77.7026},{name:"Kadugodi",pincode:"560067",lat:12.9968,lng:77.7583},{name:"Kaggadasapura",pincode:"560093",lat:12.9782,lng:77.6801},{name:"Kalasipalyam",pincode:"560002",lat:12.9636,lng:77.5777},{name:"Kalyananagar",pincode:"560043",lat:13.0288,lng:77.6402},{name:"Kamakshipalya",pincode:"560079",lat:12.9829,lng:77.5208},{name:"Kengeri",pincode:"560060",lat:12.9177,lng:77.4822},{name:"Kodichikkanahalli",pincode:"560068",lat:12.8903,lng:77.6239},{name:"Koramangala",pincode:"560095",lat:12.9344,lng:77.6173},{name:"KR Puram",pincode:"560036",lat:13.0022,lng:77.6951},{name:"Kyalasanahalli",pincode:"560077",lat:13.0269,lng:77.6589},{name:"Laggere",pincode:"560058",lat:13.0102,lng:77.5157},{name:"Mahadevapura",pincode:"560048",lat:12.9923,lng:77.6957},{name:"Majestic",pincode:"560009",lat:12.9779,lng:77.572},{name:"Malleshpalya",pincode:"560075",lat:12.9839,lng:77.6702},{name:"Malleshwaram",pincode:"560003",lat:12.9999,lng:77.5715},{name:"Manorayanapalya",pincode:"560032",lat:13.0365,lng:77.5726},{name:"Marathahalli",pincode:"560037",lat:12.9563,lng:77.7019},{name:"Mathikere",pincode:"560054",lat:13.0307,lng:77.5639},{name:"Munnekollal",pincode:"560037",lat:12.9568,lng:77.7045},{name:"Nagarbhavi",pincode:"560072",lat:12.9674,lng:77.5049},{name:"Nayandahalli",pincode:"560039",lat:12.9413,lng:77.5159},{name:"Neelasandra",pincode:"560047",lat:12.9479,lng:77.6236},{name:"Peenya",pincode:"560058",lat:13.0194,lng:77.5153},{name:"Raghuvanahalli",pincode:"560062",lat:12.8821,lng:77.5466},{name:"Rajajinagar",pincode:"560010",lat:12.9989,lng:77.5536},{name:"Ramamurthy Nagar",pincode:"560016",lat:13.0045,lng:77.6797},{name:"RT Nagar",pincode:"560032",lat:13.0266,lng:77.5979},{name:"Sadashivanagar",pincode:"560080",lat:13.0093,lng:77.5772},{name:"Shanti Nagar",pincode:"560027",lat:12.9537,lng:77.5926},{name:"Tavarekere",pincode:"560029",lat:12.931,lng:77.6106},{name:"Varthur",pincode:"560087",lat:12.9352,lng:77.7501},{name:"Vidyaranyapura",pincode:"560097",lat:13.067,lng:77.56}];locationSource=new mn(null);currentLocation$=this.locationSource.asObservable();updateLocation(e,t,i){this.setUserLocation(t,i),this.locationSource.next({name:e,lat:t,lng:i})}DEFAULT_LOCATION_DATA={name:"Koramangala",lat:12.9352,lng:77.6245};getUserLocation(){return this.userLocation?Promise.resolve(this.userLocation):this.locationPromise?this.locationPromise:(this.locationPromise=new Promise(e=>{let t=!1,i=setTimeout(()=>{t||(t=!0,console.warn("[LocationService] Timeout expired. Using default location."),this.userLocation=this.DEFAULT_LOCATION,e(this.DEFAULT_LOCATION),this.locationPromise=null)},this.LOCATION_TIMEOUT_MS);if(!("geolocation"in navigator)){t||(t=!0,clearTimeout(i),this.userLocation=this.DEFAULT_LOCATION,e(this.DEFAULT_LOCATION));return}navigator.geolocation.getCurrentPosition(r=>{t||(t=!0,clearTimeout(i),this.userLocation={latitude:r.coords.latitude,longitude:r.coords.longitude},e(this.userLocation))},r=>{t||(t=!0,clearTimeout(i),console.warn("[LocationService] Geolocation error, using default. Code:",r.code),this.userLocation=this.DEFAULT_LOCATION,e(this.DEFAULT_LOCATION))},{enableHighAccuracy:!1,timeout:4e3,maximumAge:6e5})}),this.locationPromise)}setUserLocation(e,t){this.userLocation={latitude:e,longitude:t}}calculateDistance(e,t,i,r){let o=this.toRadians(i-e),a=this.toRadians(r-t),l=Math.sin(o/2)*Math.sin(o/2)+Math.cos(this.toRadians(e))*Math.cos(this.toRadians(i))*Math.sin(a/2)*Math.sin(a/2);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}formatDistance(e){return e<1?`${Math.round(e*1e3)} m`:`${e.toFixed(1)} km`}getDistanceFromUser(e,t){return U(this,null,function*(){let i=yield this.getUserLocation(),r=this.calculateDistance(i.latitude,i.longitude,e,t);return this.formatDistance(r)})}toRadians(e){return e*(Math.PI/180)}clearLocation(){this.userLocation=null}getAreaName(e,t){return this.findNearestArea(e,t)}findNearestArea(e,t){let i="Bangalore",r=1/0;for(let s of this.AREAS){let o=this.calculateDistance(e,t,s.lat,s.lng);o<r&&(r=o,i=s.name)}return i}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})};var tJ=["searchInput"];function nJ(n,e){if(n&1){let t=Et();N(0,"div",39),he("click",function(){let r=xe(t).$implicit,s=ve(2);return Ae(s.selectLocation(r))}),N(1,"div",40),Re(),N(2,"svg",41),ae(3,"path",42)(4,"circle",6),$()(),Be(),N(5,"div",43)(6,"span",44),ee(7),$(),N(8,"span",45),ee(9),$()(),Re(),N(10,"svg",46),ae(11,"polyline",47),$()()}if(n&2){let t=e.$implicit;W(7),ut(t.name),W(2),ut(t.pincode)}}function iJ(n,e){n&1&&(N(0,"div",48)(1,"p"),ee(2,"No locations found"),$()())}function rJ(n,e){if(n&1){let t=Et();N(0,"div",22),he("click",function(){xe(t);let r=ve();return Ae(r.closeLocationModal())}),N(1,"div",23),he("click",function(r){return xe(t),Ae(r.stopPropagation())}),ae(2,"div",24),N(3,"div",25)(4,"h2"),ee(5,"Select Location"),$(),N(6,"button",26),he("click",function(){xe(t);let r=ve();return Ae(r.closeLocationModal())}),Re(),N(7,"svg",27),ae(8,"line",28)(9,"line",29),$()()(),Be(),N(10,"div",30)(11,"div",31),Re(),N(12,"svg",32),ae(13,"circle",33)(14,"line",34),$(),Be(),N(15,"input",35,0),ii("ngModelChange",function(r){xe(t);let s=ve();return di(s.searchQuery,r)||(s.searchQuery=r),Ae(r)}),$()()(),N(17,"div",36),Ve(18,nJ,12,2,"div",37)(19,iJ,3,0,"div",38),$()()()}if(n&2){let t=ve();W(15),ni("ngModel",t.searchQuery),W(3),ce("ngForOf",t.filteredLocations),W(),ce("ngIf",t.filteredLocations.length===0)}}var n_=class n{constructor(e,t){this.router=e;this.locationService=t}searchInput;showLocationModal=!1;searchQuery="";locations=[{name:"Adugodi",pincode:"560030",lat:12.9716,lng:77.5946},{name:"Agaram",pincode:"560007",lat:12.8431,lng:77.4863},{name:"Air Force Stn. Yelahanka",pincode:"560063",lat:13.1048,lng:77.5763},{name:"Banashankari",pincode:"560050",lat:12.925453,lng:77.546761},{name:"Banashankari 2nd Stage",pincode:"560070",lat:12.9249,lng:77.5662},{name:"Banashankari 3rd Stage",pincode:"560085",lat:12.9216,lng:77.5543},{name:"Banashankari 6th Stage",pincode:"560062",lat:12.8963,lng:77.5353},{name:"Banaswadi",pincode:"560043",lat:13.0159,lng:77.6516},{name:"Basavanapura",pincode:"560036",lat:12.9835,lng:77.6773},{name:"Basaveshwaranagar",pincode:"560079",lat:12.9975,lng:77.5334},{name:"Bellandur",pincode:"560103",lat:12.9304,lng:77.6784},{name:"Bidadi",pincode:"562109",lat:12.8274,lng:77.3971},{name:"Bilekahalli",pincode:"560076",lat:12.8989,lng:77.6103},{name:"Binnamangala",pincode:"560038",lat:12.9837,lng:77.6388},{name:"Bommanahalli",pincode:"560068",lat:12.9082,lng:77.6245},{name:"Bommasandra",pincode:"560099",lat:12.8009,lng:77.699},{name:"Brookefield",pincode:"560037",lat:12.9698,lng:77.7184},{name:"BTM 2nd Stage",pincode:"560076",lat:12.9167,lng:77.6108},{name:"Budigere",pincode:"562129",lat:13.035,lng:77.7478},{name:"Byatarayanapura",pincode:"560026",lat:13.056,lng:77.5926},{name:"C V Raman Nagar",pincode:"560093",lat:12.9767,lng:77.6597},{name:"Chamarajpet",pincode:"560018",lat:12.9582,lng:77.5709},{name:"Channasandra",pincode:"560067",lat:12.9629,lng:77.758},{name:"Chikbasavanapura",pincode:"560067",lat:12.9948,lng:77.7327},{name:"Chickpet",pincode:"560053",lat:12.9662,lng:77.5767},{name:"Chikkalasandra",pincode:"560061",lat:12.9132,lng:77.5454},{name:"Choodasandra",pincode:"560099",lat:12.8848,lng:77.6785},{name:"Cox Town",pincode:"560005",lat:12.9996,lng:77.6229},{name:"D J Halli",pincode:"560005",lat:13.0083,lng:77.6228},{name:"Doddabidarakallu",pincode:"560073",lat:13.0426,lng:77.5019},{name:"Doorvaninagar",pincode:"560016",lat:13.0252,lng:77.6688},{name:"Ejipura",pincode:"560047",lat:12.9437,lng:77.6274},{name:"Electronic City",pincode:"560100",lat:12.8394,lng:77.677},{name:"Frazer Town",pincode:"560005",lat:12.999,lng:77.6226},{name:"Gandhi Nagar",pincode:"560009",lat:12.9772,lng:77.573},{name:"Gavipuram Extn",pincode:"560019",lat:12.9552,lng:77.5668},{name:"Geddalahalli",pincode:"560077",lat:13.0309,lng:77.6389},{name:"Gottigere",pincode:"560083",lat:12.8725,lng:77.5944},{name:"Halasur",pincode:"560042",lat:12.9833,lng:77.6194},{name:"Hebbal",pincode:"560024",lat:13.0355,lng:77.606},{name:"Heggere",pincode:"560073",lat:13.0172,lng:77.5004},{name:"HMT Layout",pincode:"560031",lat:13.039,lng:77.547},{name:"Horamavu",pincode:"560043",lat:13.0267,lng:77.6571},{name:"Hosakerehalli",pincode:"560085",lat:12.9251,lng:77.536},{name:"HSR Layout",pincode:"560102",lat:12.9121,lng:77.6446},{name:"Hulimavu",pincode:"560076",lat:12.8829,lng:77.6083},{name:"Indiranagar",pincode:"560038",lat:12.9719,lng:77.6412},{name:"ISRO Layout",pincode:"560078",lat:12.9056,lng:77.5665},{name:"J P Nagar",pincode:"560078",lat:12.9041,lng:77.5852},{name:"Jakkur",pincode:"560064",lat:13.0811,lng:77.5924},{name:"Jalahalli",pincode:"560013",lat:13.0491,lng:77.5422},{name:"Jayanagar 4th T Block",pincode:"560041",lat:12.9352,lng:77.5837},{name:"Jigani",pincode:"560105",lat:12.7849,lng:77.642},{name:"Kadubeesanahalli",pincode:"560103",lat:12.956,lng:77.7026},{name:"Kadugodi",pincode:"560067",lat:12.9968,lng:77.7583},{name:"Kaggadasapura",pincode:"560093",lat:12.9782,lng:77.6801},{name:"Kalasipalyam",pincode:"560002",lat:12.9636,lng:77.5777},{name:"Kalyananagar",pincode:"560043",lat:13.0288,lng:77.6402},{name:"Kamakshipalya",pincode:"560079",lat:12.9829,lng:77.5208},{name:"Kengeri",pincode:"560060",lat:12.9177,lng:77.4822},{name:"Kodichikkanahalli",pincode:"560068",lat:12.8903,lng:77.6239},{name:"Koramangala",pincode:"560095",lat:12.9344,lng:77.6173},{name:"KR Puram",pincode:"560036",lat:13.0022,lng:77.6951},{name:"Kyalasanahalli",pincode:"560077",lat:13.0269,lng:77.6589},{name:"Laggere",pincode:"560058",lat:13.0102,lng:77.5157},{name:"Mahadevapura",pincode:"560048",lat:12.9923,lng:77.6957},{name:"Majestic",pincode:"560009",lat:12.9779,lng:77.572},{name:"Malleshpalya",pincode:"560075",lat:12.9839,lng:77.6702},{name:"Malleshwaram",pincode:"560003",lat:12.9999,lng:77.5715},{name:"Manorayanapalya",pincode:"560032",lat:13.0365,lng:77.5726},{name:"Marathahalli",pincode:"560037",lat:12.9563,lng:77.7019},{name:"Mathikere",pincode:"560054",lat:13.0307,lng:77.5639},{name:"Munnekollal",pincode:"560037",lat:12.9568,lng:77.7045},{name:"Nagarbhavi",pincode:"560072",lat:12.9674,lng:77.5049},{name:"Nayandahalli",pincode:"560039",lat:12.9413,lng:77.5159},{name:"Neelasandra",pincode:"560047",lat:12.9479,lng:77.6236},{name:"Peenya",pincode:"560058",lat:13.0194,lng:77.5153},{name:"Raghuvanahalli",pincode:"560062",lat:12.8821,lng:77.5466},{name:"Rajajinagar",pincode:"560010",lat:12.9989,lng:77.5536},{name:"Ramamurthy Nagar",pincode:"560016",lat:13.0045,lng:77.6797},{name:"RT Nagar",pincode:"560032",lat:13.0266,lng:77.5979},{name:"Sadashivanagar",pincode:"560080",lat:13.0093,lng:77.5772},{name:"Shanti Nagar",pincode:"560027",lat:12.9537,lng:77.5926},{name:"Tavarekere",pincode:"560029",lat:12.931,lng:77.6106},{name:"Varthur",pincode:"560087",lat:12.9352,lng:77.7501},{name:"Vidyaranyapura",pincode:"560097",lat:13.067,lng:77.56}];ngAfterViewInit(){this.showLocationModal&&this.searchInput&&setTimeout(()=>this.searchInput?.nativeElement.focus(),300)}allow(){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(e=>{let t=e.coords.latitude,i=e.coords.longitude,r=this.locationService.findNearestArea(t,i);this.locationService.setUserLocation(t,i),this.router.navigate(["/main-app"],{replaceUrl:!0,state:{location:r,latitude:t,longitude:i}})},e=>{console.error("Location error:",e),alert("Location denied or unavailable")},{enableHighAccuracy:!0,timeout:1e4}):alert("Geolocation not supported")}manual(){this.showLocationModal=!0,this.searchQuery="",setTimeout(()=>this.searchInput?.nativeElement.focus(),300)}closeLocationModal(){this.showLocationModal=!1,this.searchQuery=""}selectLocation(e){this.locationService.setUserLocation(e.lat,e.lng),this.router.navigate(["/main-app"],{replaceUrl:!0,state:{location:e.name,latitude:e.lat,longitude:e.lng}})}get filteredLocations(){if(!this.searchQuery.trim())return this.locations;let e=this.searchQuery.toLowerCase();return this.locations.filter(t=>t.name.toLowerCase().includes(e)||t.pincode.includes(e))}static \u0275fac=function(t){return new(t||n)(pe(gt),pe(Gi))};static \u0275cmp=_t({type:n,selectors:[["app-location-permission"]],viewQuery:function(t,i){if(t&1&&Ui(tJ,5),t&2){let r;Si(r=Ci())&&(i.searchInput=r.first)}},standalone:!0,features:[Tt],decls:36,vars:1,consts:[["searchInput",""],[1,"ios-layout"],[1,"hero-content"],[1,"pin-icon-container"],["width","60","height","60","viewBox","0 0 24 24","fill","none",1,"location-pin"],["d","M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z","fill","#10B981"],["cx","12","cy","9","r","2.5","fill","white"],[1,"pin-shadow"],[1,"ios-title"],[1,"ios-subtitle"],[1,"features-list"],[1,"feature-row"],[1,"icon-circle","pink-bg"],[1,"emoji"],[1,"feature-text"],[1,"icon-circle","yellow-bg"],[1,"action-area"],[1,"primary-btn",3,"click"],[1,"secondary-btn",3,"click"],[1,"privacy-note"],[1,"privacy-line"],["class","modal-backdrop",3,"click",4,"ngIf"],[1,"modal-backdrop",3,"click"],[1,"ios-sheet",3,"click"],[1,"drag-handle"],[1,"sheet-header"],[1,"close-icon-btn",3,"click"],["width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"search-container"],[1,"search-bar"],["width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","#8E8E93","stroke-width","2"],["cx","11","cy","11","r","8"],["x1","21","y1","21","x2","16.65","y2","16.65"],["type","text","placeholder","Search area or pincode",3,"ngModelChange","ngModel"],[1,"locations-scroll"],["class","location-row",3,"click",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[1,"location-row",3,"click"],[1,"loc-icon-bg"],["width","20","height","20","viewBox","0 0 24 24","fill","#10B981"],["d","M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"],[1,"loc-details"],[1,"loc-name"],[1,"loc-sub"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","#C7C7CC","stroke-width","2"],["points","9 18 15 12 9 6"],[1,"empty-state"]],template:function(t,i){t&1&&(N(0,"div",1)(1,"div",2)(2,"div",3),Re(),N(3,"svg",4),ae(4,"path",5)(5,"circle",6),$(),Be(),ae(6,"div",7),$(),N(7,"h1",8),ee(8,"Find Street Food"),ae(9,"br"),ee(10,"Near You"),$(),N(11,"p",9),ee(12,"We need your location to show you the best street food options around you."),$(),N(13,"div",10)(14,"div",11)(15,"div",12)(16,"span",13),ee(17,"\u{1F3AF}"),$()(),N(18,"span",14),ee(19,"Discover food stalls nearby"),$()(),N(20,"div",11)(21,"div",15)(22,"span",13),ee(23,"\u{1F4B0}"),$()(),N(24,"span",14),ee(25,"See accurate prices & distance"),$()()()(),N(26,"div",16)(27,"button",17),he("click",function(){return i.allow()}),ee(28,"Allow Location Access"),$(),N(29,"button",18),he("click",function(){return i.manual()}),ee(30,"Select Location Manually"),$(),N(31,"div",19),ae(32,"div",20),N(33,"p"),ee(34,"Your location data is secure and only used to show nearby food options."),$()()(),Ve(35,rJ,20,3,"div",21),$()),t&2&&(W(35),ce("ngIf",i.showLocationModal))},dependencies:[Pt,Hn,qt,ji,$i,Fr,pr],styles:["[_nghost-%COMP%]{display:block;height:100vh;background:#fff;font-family:-apple-system,BlinkMacSystemFont,SF Pro Display,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:#1c1c1e}.ios-layout[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;position:relative;overflow:hidden}.hero-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0 32px;text-align:center;margin-top:-40px}.pin-icon-container[_ngcontent-%COMP%]{position:relative;margin-bottom:32px}.pin-icon-container[_ngcontent-%COMP%]   .location-pin[_ngcontent-%COMP%]{filter:drop-shadow(0 8px 16px var(--primary-shadow));animation:_ngcontent-%COMP%_float 3s ease-in-out infinite}.pin-icon-container[_ngcontent-%COMP%]   .pin-shadow[_ngcontent-%COMP%]{width:30px;height:6px;background:#0000001a;border-radius:50%;margin:10px auto 0;animation:_ngcontent-%COMP%_shadow-pulse 3s ease-in-out infinite}@keyframes _ngcontent-%COMP%_float{0%,to{transform:translateY(0)}50%{transform:translateY(-12px)}}@keyframes _ngcontent-%COMP%_shadow-pulse{0%,to{transform:scale(1);opacity:.3}50%{transform:scale(.6);opacity:.1}}.ios-title[_ngcontent-%COMP%]{font-size:28px;font-weight:700;line-height:1.2;margin:0 0 12px;letter-spacing:-.02em;color:#000}.ios-subtitle[_ngcontent-%COMP%]{font-size:16px;line-height:1.5;color:#8e8e93;margin:0 0 40px;max-width:280px}.features-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px;width:100%;max-width:320px}.feature-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;text-align:left}.icon-circle[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0}.icon-circle.pink-bg[_ngcontent-%COMP%]{background:var(--primary-tint)}.icon-circle.yellow-bg[_ngcontent-%COMP%]{background:var(--primary-shadow-sm)}.icon-circle[_ngcontent-%COMP%]   .emoji[_ngcontent-%COMP%]{font-size:22px}.feature-text[_ngcontent-%COMP%]{font-size:16px;font-weight:500;color:#1c1c1e}.action-area[_ngcontent-%COMP%]{padding:24px 24px 40px;background:#fff;display:flex;flex-direction:column;gap:12px}.primary-btn[_ngcontent-%COMP%]{width:100%;height:56px;border-radius:16px;background:var(--primary-color);color:#fff;font-size:17px;font-weight:600;border:none;box-shadow:0 4px 12px var(--primary-shadow);cursor:pointer;transition:transform .1s}.primary-btn[_ngcontent-%COMP%]:active{transform:scale(.96)}.secondary-btn[_ngcontent-%COMP%]{width:100%;height:56px;border-radius:16px;background:#f2f2f7;color:#000;font-size:17px;font-weight:600;border:none;cursor:pointer;transition:background .2s,transform .1s}.secondary-btn[_ngcontent-%COMP%]:active{background:#e5e5ea;color:#8e8e93;transform:scale(.96)}.privacy-note[_ngcontent-%COMP%]{margin-top:16px;padding:16px;background:#f9f9f9;border-radius:12px;display:flex;gap:12px;text-align:left}.privacy-note[_ngcontent-%COMP%]   .privacy-line[_ngcontent-%COMP%]{width:3px;background:var(--primary-color);border-radius:2px;flex-shrink:0}.privacy-note[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:13px;color:#8e8e93;line-height:1.4}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0006;backdrop-filter:blur(4px);z-index:100;display:flex;align-items:flex-end;animation:_ngcontent-%COMP%_fadeIn .3s ease}.ios-sheet[_ngcontent-%COMP%]{width:100%;max-height:85vh;background:#fff;border-radius:24px 24px 0 0;display:flex;flex-direction:column;padding-bottom:24px;animation:_ngcontent-%COMP%_slideUp .4s cubic-bezier(.19,1,.22,1);box-shadow:0 -4px 30px #0000001a}.drag-handle[_ngcontent-%COMP%]{width:36px;height:4px;background:#e5e5ea;border-radius:2px;margin:8px auto 0}.sheet-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px}.sheet-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:700;margin:0}.close-icon-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;background:#f2f2f7;border:none;display:flex;align-items:center;justify-content:center;color:#8e8e93;cursor:pointer}.search-container[_ngcontent-%COMP%]{padding:0 24px 16px}.search-bar[_ngcontent-%COMP%]{background:#f2f2f7;border-radius:12px;height:44px;display:flex;align-items:center;padding:0 12px;gap:8px}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;background:transparent;font-size:17px;width:100%;color:#000;height:100%;outline:none}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#8e8e93}.locations-scroll[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:0 24px}.location-row[_ngcontent-%COMP%]{display:flex;align-items:center;padding:16px 0;gap:16px;border-bottom:1px solid #E5E5EA;cursor:pointer}.location-row[_ngcontent-%COMP%]:active{opacity:.6}.loc-icon-bg[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:10px;background:var(--primary-shadow-xs);display:flex;align-items:center;justify-content:center}.loc-details[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:2px}.loc-name[_ngcontent-%COMP%]{font-size:17px;font-weight:600;color:#000}.loc-sub[_ngcontent-%COMP%]{font-size:14px;color:#8e8e93}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 0;color:#8e8e93}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(100%)}to{transform:translateY(0)}}"],data:{animation:[Qb("fadeIn",[Lf(":enter",[Os({opacity:0}),kf("200ms ease-out",Os({opacity:1}))]),Lf(":leave",[kf("200ms ease-in",Os({opacity:0}))])]),Qb("slideUp",[Lf(":enter",[Os({transform:"translateY(100%)",opacity:0}),kf("300ms cubic-bezier(0.4, 0, 0.2, 1)",Os({transform:"translateY(0)",opacity:1}))]),Lf(":leave",[kf("200ms ease-in",Os({transform:"translateY(100%)",opacity:0}))])])]}})};var Ie=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},sJ=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=oJ},oJ=Number.MAX_SAFE_INTEGER||9007199254740991,Ne=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),Q=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),I=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({}),mt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},De={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},dl=class{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){let i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){let e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}},PA=class{constructor(e,t,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new dl(e),this.fast_=new dl(t),this.defaultTTFB_=r,this.ttfb_=new dl(e)}update(e,t){let{slow_:i,fast_:r,ttfb_:s}=this;i.halfLife!==e&&(this.slow_=new dl(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.fast_=new dl(t,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new dl(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);let i=8*t,r=e/1e3,s=i/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(e){let t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}};function aJ(n,e,t){return(e=cJ(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Wt(){return Wt=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Wt.apply(null,arguments)}function KV(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function zt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?KV(Object(t),!0).forEach(function(i){aJ(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):KV(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function lJ(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function cJ(n){var e=lJ(n,"string");return typeof e=="symbol"?e:e+""}var qi=class{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;let i=`[${e}]:`;this.trace=hl,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}},hl=function(){},uJ={trace:hl,debug:hl,log:hl,warn:hl,info:hl,error:hl};function RA(){return Wt({},uJ)}function dJ(n,e){let t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):hl}function YV(n,e,t){return e[n]?e[n].bind(e):dJ(n,t)}var MA=RA();function hJ(n,e,t){let i=RA();if(typeof console=="object"&&n===!0||typeof n=="object"){let r=["debug","log","info","warn","error"];r.forEach(s=>{i[s]=YV(s,n,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return RA()}r.forEach(s=>{MA[s]=YV(s,n)})}else Wt(MA,i);return i}var Ht=MA;function fl(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function fJ(n){return typeof self<"u"&&n===self.ManagedMediaSource}function oU(n,e){let t=Object.keys(n),i=Object.keys(e),r=t.length,s=i.length;return!r||!s||r===s&&!t.some(o=>i.indexOf(o)===-1)}function vr(n,e=!1){if(typeof TextDecoder<"u"){let u=new TextDecoder("utf-8").decode(n);if(e){let d=u.indexOf("\0");return d!==-1?u.substring(0,d):u}return u.replace(/\0/g,"")}let t=n.length,i,r,s,o="",a=0;for(;a<t;){if(i=n[a++],i===0&&e)return o;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:r=n[a++],o+=String.fromCharCode((i&31)<<6|r&63);break;case 14:r=n[a++],s=n[a++],o+=String.fromCharCode((i&15)<<12|(r&63)<<6|(s&63)<<0);break}}return o}function ri(n){let e="";for(let t=0;t<n.length;t++){let i=n[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}function aU(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function pJ(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var lA={exports:{}},QV;function mJ(){return QV||(QV=1,function(n,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,u,d){if(d=d||{},l=l.trim(),u=u.trim(),!u){if(!d.alwaysNormalize)return l;var f=a.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");return f.path=a.normalizePath(f.path),a.buildURLFromParts(f)}var m=a.parseURL(u);if(!m)throw new Error("Error trying to parse relative URL.");if(m.scheme)return d.alwaysNormalize?(m.path=a.normalizePath(m.path),a.buildURLFromParts(m)):u;var y=a.parseURL(l);if(!y)throw new Error("Error trying to parse base URL.");if(!y.netLoc&&y.path&&y.path[0]!=="/"){var v=r.exec(y.path);y.netLoc=v[1],y.path=v[2]}y.netLoc&&!y.path&&(y.path="/");var E={scheme:y.scheme,netLoc:m.netLoc,path:null,params:m.params,query:m.query,fragment:m.fragment};if(!m.netLoc&&(E.netLoc=y.netLoc,m.path[0]!=="/"))if(!m.path)E.path=y.path,m.params||(E.params=y.params,m.query||(E.query=y.query));else{var T=y.path,C=T.substring(0,T.lastIndexOf("/")+1)+m.path;E.path=a.normalizePath(C)}return E.path===null&&(E.path=d.alwaysNormalize?a.normalizePath(m.path):m.path),a.buildURLFromParts(E)},parseURL:function(l){var u=i.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=a})()}(lA)),lA.exports}var YD=mJ(),Gp=class{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},Qt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},I_=class{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,gJ(this,"stats")}setByteRange(e,t){let i=e.split("@",2),r;i.length===1?r=t?.byteRangeEndOffset||0:r=parseInt(i[1]),this._byteRange=[r,parseInt(i[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Qt.AUDIO]:null,[Qt.VIDEO]:null,[Qt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Gp),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=YD.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){let{elementaryStreams:e}=this;e[Qt.AUDIO]=null,e[Qt.VIDEO]=null,e[Qt.AUDIOVIDEO]=null}};function In(n){return n.sn!=="initSegment"}var Bp=class extends I_{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){let e=this.stats.total;if(e)return e}if(this.byteRange.length){let e=this.byteRange[0],t=this.byteRange[1];if(Ie(e)&&Ie(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;let{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){let i=Object.keys(t);if(i.length===1){let r=this._decryptdata=t[i[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;let e=Ie(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;let i=Object.keys(this.levelkeys),r=i.length;if(r>1||r===1&&(t=this.levelkeys[i[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Ie(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return In(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){let t=this.levelkeys;if(t){var i;let r=t[e];r&&!((i=this._decryptdata)!=null&&i.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,r,s,o=!1){let{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:i,startDTS:r,endDTS:s,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,i),l.startDTS=Math.min(l.startDTS,r),l.endDTS=Math.max(l.endDTS,s)}},kA=class extends I_{constructor(e,t,i,r,s){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;let o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){let{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}};function lU(n,e){let t=Object.getPrototypeOf(n);if(t){let i=Object.getOwnPropertyDescriptor(t,e);return i||lU(t,e)}}function gJ(n,e){let t=lU(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}var ZV=Math.pow(2,32)-1,yJ=[].push,cU={video:1,audio:2,id3:3,text:4};function Un(n){return String.fromCharCode.apply(null,n)}function uU(n,e){let t=n[e]<<8|n[e+1];return t<0?65536+t:t}function He(n,e){let t=dU(n,e);return t<0?4294967296+t:t}function XV(n,e){let t=He(n,e);return t*=Math.pow(2,32),t+=He(n,e+4),t}function dU(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function vJ(n){let e=n.byteLength;for(let t=0;t<e;){let i=He(n,t);if(i>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=i>1?t+i:e}return!1}function ft(n,e){let t=[];if(!e.length)return t;let i=n.byteLength;for(let r=0;r<i;){let s=He(n,r),o=Un(n.subarray(r+4,r+8)),a=s>1?r+s:i;if(o===e[0])if(e.length===1)t.push(n.subarray(r+8,a));else{let l=ft(n.subarray(r+8,a),e.slice(1));l.length&&yJ.apply(t,l)}r=a}return t}function _J(n){let e=[],t=n[0],i=8,r=He(n,i);i+=4;let s=0,o=0;t===0?(s=He(n,i),o=He(n,i+4),i+=8):(s=XV(n,i),o=XV(n,i+8),i+=16),i+=2;let a=n.length+o,l=uU(n,i);i+=2;for(let u=0;u<l;u++){let d=i,f=He(n,d);d+=4;let m=f&2147483647;if((f&2147483648)>>>31===1)return Ht.warn("SIDX has hierarchical references (not supported)"),null;let v=He(n,d);d+=4,e.push({referenceSize:m,subsegmentDuration:v,info:{duration:v/r,start:a,end:a+m-1}}),a+=m,d+=4,i=d}return{earliestPresentationTime:s,timescale:r,version:t,referencesCount:l,references:e}}function hU(n){let e=[],t=ft(n,["moov","trak"]);for(let r=0;r<t.length;r++){let s=t[r],o=ft(s,["tkhd"])[0];if(o){let a=o[0],l=He(o,a===0?12:20),u=ft(s,["mdia","mdhd"])[0];if(u){a=u[0];let d=He(u,a===0?12:20),f=ft(s,["mdia","hdlr"])[0];if(f){let m=Un(f.subarray(8,12)),y={soun:Qt.AUDIO,vide:Qt.VIDEO}[m],v=ft(s,["mdia","minf","stbl","stsd"])[0],E=EJ(v);y?(e[l]={timescale:d,type:y,stsd:E},e[y]=zt({timescale:d,id:l},E)):e[l]={timescale:d,type:m,stsd:E}}}}}return ft(n,["moov","mvex","trex"]).forEach(r=>{let s=He(r,4),o=e[s];o&&(o.default={duration:He(r,12),flags:He(r,20)})}),e}function EJ(n){let e=n.subarray(8),t=e.subarray(86),i=Un(e.subarray(4,8)),r=i,s,o=i==="enca"||i==="encv";if(o){let u=ft(e,[i])[0].subarray(i==="enca"?28:78);ft(u,["sinf"]).forEach(f=>{let m=ft(f,["schm"])[0];if(m){let y=Un(m.subarray(4,8));if(y==="cbcs"||y==="cenc"){let v=ft(f,["frma"])[0];v&&(r=Un(v))}}})}let a=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{let l=ft(t,["avcC"])[0];l&&l.length>3&&(r+="."+r_(l[1])+r_(l[2])+r_(l[3]),s=i_(a==="avc1"?"dva1":"dvav",t));break}case"mp4a":{let l=ft(e,[i])[0],u=ft(l.subarray(28),["esds"])[0];if(u&&u.length>7){let d=4;if(u[d++]!==3)break;d=cA(u,d),d+=2;let f=u[d++];if(f&128&&(d+=2),f&64&&(d+=u[d++]),u[d++]!==4)break;d=cA(u,d);let m=u[d++];if(m===64)r+="."+r_(m);else break;if(d+=12,u[d++]!==5)break;d=cA(u,d);let y=u[d++],v=(y&248)>>3;v===31&&(v+=1+((y&7)<<3)+((u[d]&224)>>5)),r+="."+v}break}case"hvc1":case"hev1":{let l=ft(t,["hvcC"])[0];if(l&&l.length>12){let u=l[1],d=["","A","B","C"][u>>6],f=u&31,m=He(l,2),y=(u&32)>>5?"H":"L",v=l[12],E=l.subarray(6,12);r+="."+d+f,r+="."+TJ(m).toString(16).toUpperCase(),r+="."+y+v;let T="";for(let C=E.length;C--;){let D=E[C];(D||T)&&(T="."+D.toString(16).toUpperCase()+T)}r+=T}s=i_(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=i_(r,t)||r;break}case"vp09":{let l=ft(t,["vpcC"])[0];if(l&&l.length>6){let u=l[4],d=l[5],f=l[6]>>4&15;r+="."+Xs(u)+"."+Xs(d)+"."+Xs(f)}break}case"av01":{let l=ft(t,["av1C"])[0];if(l&&l.length>2){let u=l[1]>>>5,d=l[1]&31,f=l[2]>>>7?"H":"M",m=(l[2]&64)>>6,y=(l[2]&32)>>5,v=u===2&&m?y?12:10:m?10:8,E=(l[2]&16)>>4,T=(l[2]&8)>>3,C=(l[2]&4)>>2,D=l[2]&3;r+="."+u+"."+Xs(d)+f+"."+Xs(v)+"."+E+"."+T+C+D+"."+Xs(1)+"."+Xs(1)+"."+Xs(1)+"."+0,s=i_("dav1",t)}break}}return{codec:r,encrypted:o,supplemental:s}}function i_(n,e){let t=ft(e,["dvvC"]),i=t.length?t[0]:ft(e,["dvcC"])[0];if(i){let r=i[2]>>1&127,s=i[2]<<5&32|i[3]>>3&31;return n+"."+Xs(r)+"."+Xs(s)}}function TJ(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function cA(n,e){let t=e+5;for(;n[e++]&128&&e<t;);return e}function r_(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function Xs(n){return(n<10?"0":"")+n}function wJ(n,e){if(!n||!e)return;let t=e.keyId;t&&e.isCommonEncryption&&fU(n,(i,r)=>{let s=i.subarray(8,24);s.some(o=>o!==0)||(Ht.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${ri(s)} -> ${ri(t)}`),i.set(t,8))})}function bJ(n){let e=[];return fU(n,t=>e.push(t.subarray(8,24))),e}function fU(n,e){ft(n,["moov","trak"]).forEach(i=>{let r=ft(i,["mdia","minf","stbl","stsd"])[0];if(!r)return;let s=r.subarray(8),o=ft(s,["enca"]),a=o.length>0;a||(o=ft(s,["encv"])),o.forEach(l=>{let u=a?l.subarray(28):l.subarray(78);ft(u,["sinf"]).forEach(f=>{let m=pU(f);m&&e(m,a)})})})}function pU(n){let e=ft(n,["schm"])[0];if(e){let t=Un(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){let i=ft(n,["schi","tenc"])[0];if(i)return i}}}function IJ(n,e,t){let i={},r=ft(n,["moof","traf"]);for(let s=0;s<r.length;s++){let o=r[s],a=ft(o,["tfhd"])[0],l=He(a,4),u=e[l];if(!u)continue;i[l]||(i[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});let d=i[l],f=ft(o,["tfdt"])[0];if(f){let P=f[0],V=He(f,4);P===1&&(V===ZV?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(V*=ZV+1,V+=He(f,8))),Ie(V)&&(!Ie(d.start)||V<d.start)&&(d.start=V)}let m=u.default,y=He(a,0)|m?.flags,v=m?.duration||0;y&8&&(y&2?v=He(a,12):v=He(a,8));let E=ft(o,["trun"]),T=d.start||0,C=0,D=v;for(let P=0;P<E.length;P++){let V=E[P],G=He(V,4),H=d.sampleCount;d.sampleCount+=G;let A=V[3]&1,x=V[3]&4,R=V[2]&1,M=V[2]&2,F=V[2]&4,j=V[2]&8,B=8,ge=G;for(A&&(B+=4),x&&G&&(!(V[B+1]&1)&&d.keyFrameIndex===void 0&&(d.keyFrameIndex=H),B+=4,R?(D=He(V,B),B+=4):D=v,M&&(B+=4),j&&(B+=4),T+=D,C+=D,ge--);ge--;)R?(D=He(V,B),B+=4):D=v,M&&(B+=4),F&&(V[B+1]&1||d.keyFrameIndex===void 0&&(d.keyFrameIndex=d.sampleCount-(ge+1),d.keyFrameStart=T),B+=4),j&&(B+=4),T+=D,C+=D;!C&&v&&(C+=v*G)}d.duration+=C}if(!Object.keys(i).some(s=>i[s].duration)){let s=1/0,o=0,a=ft(n,["sidx"]);for(let l=0;l<a.length;l++){let u=_J(a[l]);if(u!=null&&u.references){s=Math.min(s,u.earliestPresentationTime/u.timescale);let d=u.references.reduce((f,m)=>f+m.info.duration||0,0);o=Math.max(o,d+u.earliestPresentationTime/u.timescale)}}o&&Ie(o)&&Object.keys(i).forEach(l=>{i[l].duration||(i[l].duration=o*i[l].timescale-i[l].start)})}return i}function SJ(n){let e={valid:null,remainder:null},t=ft(n,["moof"]);if(t.length<2)return e.remainder=n,e;let i=t[t.length-1];return e.valid=n.slice(0,i.byteOffset-8),e.remainder=n.slice(i.byteOffset-8),e}function Vr(n,e){let t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function JV(n,e){let t=[],i=e.samples,r=e.timescale,s=e.id,o=!1;return ft(i,["moof"]).map(l=>{let u=l.byteOffset-8;ft(l,["traf"]).map(f=>{let m=ft(f,["tfdt"]).map(y=>{let v=y[0],E=He(y,4);return v===1&&(E*=Math.pow(2,32),E+=He(y,8)),E/r})[0];return m!==void 0&&(n=m),ft(f,["tfhd"]).map(y=>{let v=He(y,4),E=He(y,0)&16777215,T=(E&1)!==0,C=(E&2)!==0,D=(E&8)!==0,P=0,V=(E&16)!==0,G=0,H=(E&32)!==0,A=8;v===s&&(T&&(A+=8),C&&(A+=4),D&&(P=He(y,A),A+=4),V&&(G=He(y,A),A+=4),H&&(A+=4),e.type==="video"&&(o=Y_(e.codec)),ft(f,["trun"]).map(x=>{let R=x[0],M=He(x,0)&16777215,F=(M&1)!==0,j=0,B=(M&4)!==0,ge=(M&256)!==0,we=0,q=(M&512)!==0,te=0,K=(M&1024)!==0,ne=(M&2048)!==0,Ee=0,oe=He(x,4),ie=8;F&&(j=He(x,ie),ie+=4),B&&(ie+=4);let fe=j+u;for(let me=0;me<oe;me++){if(ge?(we=He(x,ie),ie+=4):we=P,q?(te=He(x,ie),ie+=4):te=G,K&&(ie+=4),ne&&(R===0?Ee=He(x,ie):Ee=dU(x,ie),ie+=4),e.type===Qt.VIDEO){let Fe=0;for(;Fe<te;){let Ge=He(i,fe);if(fe+=4,CJ(o,i[fe])){let et=i.subarray(fe,fe+Ge);QD(et,o?2:1,n+Ee/r,t)}fe+=Ge,Fe+=Ge+4}}n+=we/r}}))})})}),t}function Y_(n){if(!n)return!1;let e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function CJ(n,e){if(n){let t=e>>1&63;return t===39||t===40}else return(e&31)===6}function QD(n,e,t,i){let r=mU(n),s=0;s+=e;let o=0,a=0,l=0;for(;s<r.length;){o=0;do{if(s>=r.length)break;l=r[s++],o+=l}while(l===255);a=0;do{if(s>=r.length)break;l=r[s++],a+=l}while(l===255);let u=r.length-s,d=s;if(a<u)s+=a;else if(a>u){Ht.error(`Malformed SEI payload. ${a} is too small, only ${u} bytes left to parse.`);break}if(o===4){if(r[d++]===181){let m=uU(r,d);if(d+=2,m===49){let y=He(r,d);if(d+=4,y===1195456820){let v=r[d++];if(v===3){let E=r[d++],T=31&E,C=64&E,D=C?2+T*3:0,P=new Uint8Array(D);if(C){P[0]=E;for(let V=1;V<D;V++)P[V]=r[d++]}i.push({type:v,payloadType:o,pts:t,bytes:P})}}}}}else if(o===5&&a>16){let f=[];for(let v=0;v<16;v++){let E=r[d++].toString(16);f.push(E.length==1?"0"+E:E),(v===3||v===5||v===7||v===9)&&f.push("-")}let m=a-16,y=new Uint8Array(m);for(let v=0;v<m;v++)y[v]=r[d++];i.push({payloadType:o,pts:t,uuid:f.join(""),userData:vr(y),userDataBytes:y})}}}function mU(n){let e=n.byteLength,t=[],i=1;for(;i<e-2;)n[i]===0&&n[i+1]===0&&n[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return n;let r=e-t.length,s=new Uint8Array(r),o=0;for(i=0;i<r;o++,i++)o===t[0]&&(o++,t.shift()),s[i]=n[o];return s}function xJ(n){let e=n[0],t="",i="",r=0,s=0,o=0,a=0,l=0,u=0;if(e===0){for(;Un(n.subarray(u,u+1))!=="\0";)t+=Un(n.subarray(u,u+1)),u+=1;for(t+=Un(n.subarray(u,u+1)),u+=1;Un(n.subarray(u,u+1))!=="\0";)i+=Un(n.subarray(u,u+1)),u+=1;i+=Un(n.subarray(u,u+1)),u+=1,r=He(n,12),s=He(n,16),a=He(n,20),l=He(n,24),u=28}else if(e===1){u+=4,r=He(n,u),u+=4;let f=He(n,u);u+=4;let m=He(n,u);for(u+=4,o=2**32*f+m,sJ(o)||(o=Number.MAX_SAFE_INTEGER,Ht.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=He(n,u),u+=4,l=He(n,u),u+=4;Un(n.subarray(u,u+1))!=="\0";)t+=Un(n.subarray(u,u+1)),u+=1;for(t+=Un(n.subarray(u,u+1)),u+=1;Un(n.subarray(u,u+1))!=="\0";)i+=Un(n.subarray(u,u+1)),u+=1;i+=Un(n.subarray(u,u+1)),u+=1}let d=n.subarray(u,n.byteLength);return{schemeIdUri:t,value:i,timeScale:r,presentationTime:o,presentationTimeDelta:s,eventDuration:a,id:l,payload:d}}function AJ(n,...e){let t=e.length,i=8,r=t;for(;r--;)i+=e[r].byteLength;let s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=i&255,s.set(n,4),r=0,i=8;r<t;r++)s.set(e[r],i),i+=e[r].byteLength;return s}function DJ(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let i,r;i=0,r=new Uint8Array;let s;i>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;let o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),AJ([112,115,115,104],new Uint8Array([i,0,0,0]),n,s,r,o,t)}function PJ(n){let e=[];if(n instanceof ArrayBuffer){let t=n.byteLength,i=0;for(;i+32<t;){let r=new DataView(n,i),s=RJ(r);e.push(s),i+=s.size}}return e}function RJ(n){let e=n.getUint32(0),t=n.byteOffset,i=n.byteLength;if(i<e)return{offset:t,size:i};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};let s=n.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};let o=n.buffer,a=ri(new Uint8Array(o,t+12,16)),l=null,u=null,d=0;if(s===0)d=28;else{let m=n.getUint32(28);if(!m||i<32+m*16)return{offset:t,size:e};l=[];for(let y=0;y<m;y++)l.push(new Uint8Array(o,t+32+y*16,16));d=32+m*16}if(!d)return{offset:t,size:e};let f=n.getUint32(d);return e-32<f?{offset:t,size:e}:(u=new Uint8Array(o,t+d+4,f),{version:s,systemId:a,kids:l,data:u,offset:t,size:e})}var gU=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),eh={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function ZD(n,e){let t=eh[e];return!!t&&!!t[n.slice(0,4)]}function zp(n,e,t=!0){return!n.split(",").some(i=>!XD(i,e,t))}function XD(n,e,t=!0){var i;let r=fl(t);return(i=r?.isTypeSupported(Hp(n,e)))!=null?i:!1}function Hp(n,e){return`${e}/mp4;codecs=${n}`}function eB(n){if(n){let e=n.substring(0,4);return eh.video[e]}return 2}function S_(n){let e=gU();return n.split(",").reduce((t,i)=>{let s=e&&Y_(i)?9:eh.video[i];return s?(s*2+t)/(t?3:2):(eh.audio[i]+t)/(t?2:1)},0)}var uA={};function MJ(n,e=!0){if(uA[n])return uA[n];let t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let r=0;r<t.length;r++){var i;if(XD(t[r],"audio",e))return uA[n]=t[r],t[r];if(t[r]==="mp3"&&(i=fl(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return n}var kJ=/flac|opus|mp4a\.40\.34/i;function C_(n,e=!0){return n.replace(kJ,t=>MJ(t.toLowerCase(),e))}function LJ(n,e){let t=[];if(n){let i=n.split(",");for(let r=0;r<i.length;r++)ZD(i[r],"video")||t.push(i[r])}return e&&t.push(e),t.join(",")}function y_(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(tB(n,"audio")||tB(n,"video")))return n;if(e){let t=e.split(",");if(t.length>1){if(n){for(let i=t.length;i--;)if(t[i].substring(0,4)===n.substring(0,4))return t[i]}return t[0]}}return e||n}function tB(n,e){return ZD(n,e)&&XD(n,e)}function OJ(n){let e=n.split(",");for(let t=0;t<e.length;t++){let i=e[t].split(".");i.length>2&&i[0]==="avc1"&&(e[t]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function NJ(n){if(n.startsWith("av01.")){let e=n.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return n}function nB(n){let e=fl(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function LA(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}var FJ={supported:!0,powerEfficient:!0,smooth:!0},VJ={supported:!1,smooth:!1,powerEfficient:!1},yU={supported:!0,configurations:[],decodingInfoResults:[FJ]};function vU(n,e){return{supported:!1,configurations:e,decodingInfoResults:[VJ],error:n}}function BJ(n,e,t,i,r,s){let o=n.videoCodec,a=n.audioCodec?n.audioGroups:null,l=s?.audioCodec,u=s?.channels,d=u?parseInt(u):l?1/0:2,f=null;if(a!=null&&a.length)try{a.length===1&&a[0]?f=e.groups[a[0]].channels:f=a.reduce((m,y)=>{if(y){let v=e.groups[y];if(!v)throw new Error(`Audio track group ${y} not found`);Object.keys(v.channels).forEach(E=>{m[E]=(m[E]||0)+v.channels[E]})}return m},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(m=>Y_(m))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(i,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(r,8e6))||!!f&&Ie(d)&&Object.keys(f).some(m=>parseInt(m)>d)}function _U(n,e,t,i={}){let r=n.videoCodec;if(!r&&!n.audioCodec||!t)return Promise.resolve(yU);let s=[],o=UJ(n),a=o.length,l=$J(n,e,a>0),u=l.length;for(let d=a||1*u||1;d--;){let f={type:"media-source"};if(a&&(f.video=o[d%a]),u){f.audio=l[d%u];let m=f.audio.bitrate;f.video&&m&&(f.video.bitrate-=m)}s.push(f)}if(r){let d=navigator.userAgent;if(r.split(",").some(f=>Y_(f))&&gU())return Promise.resolve(vU(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${d})`),s))}return Promise.all(s.map(d=>{let f=GJ(d);return i[f]||(i[f]=t.decodingInfo(d))})).then(d=>({supported:!d.some(f=>!f.supported),configurations:s,decodingInfoResults:d})).catch(d=>({supported:!1,configurations:s,decodingInfoResults:[],error:d}))}function UJ(n){var e;let t=(e=n.videoCodec)==null?void 0:e.split(","),i=EU(n),r=n.width||640,s=n.height||480,o=n.frameRate||30,a=n.videoRange.toLowerCase();return t?t.map(l=>{let u={contentType:Hp(NJ(l),"video"),width:r,height:s,bitrate:i,framerate:o};return a!=="sdr"&&(u.transferFunction=a),u}):[]}function $J(n,e,t){var i;let r=(i=n.audioCodec)==null?void 0:i.split(","),s=EU(n);return r&&n.audioGroups?n.audioGroups.reduce((o,a)=>{var l;let u=a?(l=e.groups[a])==null?void 0:l.tracks:null;return u?u.reduce((d,f)=>{if(f.groupId===a){let m=parseFloat(f.channels||"");r.forEach(y=>{let v={contentType:Hp(y,"audio"),bitrate:t?jJ(y,s):s};m&&(v.channels=""+m),d.push(v)})}return d},o):o},[]):[]}function jJ(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function EU(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function GJ(n){let e="",{audio:t,video:i}=n;if(i){let r=LA(i.contentType);e+=`${r}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(t){let r=LA(t.contentType);e+=`${i?"_":""}${r}_c${t.channels}`}return e}var OA=["NONE","TYPE-0","TYPE-1",null];function zJ(n){return OA.indexOf(n)>-1}var x_=["SDR","PQ","HLG"];function HJ(n){return!!n&&x_.indexOf(n)>-1}var v_={No:"",Yes:"YES",v2:"v2"};function iB(n){let{canSkipUntil:e,canSkipDateRanges:t,age:i}=n,r=i<e/2;return e&&r?t?v_.v2:v_.Yes:v_.No}var A_=class{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){let t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}},jc=class{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;let i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return rB(this._audioGroups,e)}hasSubtitleGroup(e){return rB(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}};function rB(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function qJ(){if(typeof matchMedia=="function"){let n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function WJ(n,e){let t=!1,i=[];if(n&&(t=n!=="SDR",i=[n]),e){i=e.allowedVideoRanges||x_.slice(0);let r=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&qJ(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}var KJ=n=>{let e=new WeakSet;return(t,i)=>{if(n&&(i=n(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},Zt=(n,e)=>JSON.stringify(n,KJ(e));function YJ(n,e,t,i,r){let s=Object.keys(n),o=i?.channels,a=i?.audioCodec,l=r?.videoCodec,u=o&&parseInt(o)===2,d=!1,f=!1,m=1/0,y=1/0,v=1/0,E=1/0,T=0,C=[],{preferHDR:D,allowedVideoRanges:P}=WJ(e,r);for(let x=s.length;x--;){let R=n[s[x]];d||(d=R.channels[2]>0),m=Math.min(m,R.minHeight),y=Math.min(y,R.minFramerate),v=Math.min(v,R.minBitrate),P.filter(F=>R.videoRanges[F]>0).length>0&&(f=!0)}m=Ie(m)?m:0,y=Ie(y)?y:0;let V=Math.max(1080,m),G=Math.max(30,y);v=Ie(v)?v:t,t=Math.max(v,t),f||(e=void 0);let H=s.length>1;return{codecSet:s.reduce((x,R)=>{let M=n[R];if(R===x)return x;if(C=f?P.filter(F=>M.videoRanges[F]>0):[],H){if(M.minBitrate>t)return Qs(R,`min bitrate of ${M.minBitrate} > current estimate of ${t}`),x;if(!M.hasDefaultAudio)return Qs(R,"no renditions with default or auto-select sound found"),x;if(a&&R.indexOf(a.substring(0,4))%5!==0)return Qs(R,`audio codec preference "${a}" not found`),x;if(o&&!u){if(!M.channels[o])return Qs(R,`no renditions with ${o} channel sound found (channels options: ${Object.keys(M.channels)})`),x}else if((!a||u)&&d&&M.channels[2]===0)return Qs(R,"no renditions with stereo sound found"),x;if(M.minHeight>V)return Qs(R,`min resolution of ${M.minHeight} > maximum of ${V}`),x;if(M.minFramerate>G)return Qs(R,`min framerate of ${M.minFramerate} > maximum of ${G}`),x;if(!C.some(F=>M.videoRanges[F]>0))return Qs(R,`no variants with VIDEO-RANGE of ${Zt(C)} found`),x;if(l&&R.indexOf(l.substring(0,4))%5!==0)return Qs(R,`video codec preference "${l}" not found`),x;if(M.maxScore<T)return Qs(R,`max score of ${M.maxScore} < selected max of ${T}`),x}return x&&(S_(R)>=S_(x)||M.fragmentError>n[x].fragmentError)?x:(E=M.minIndex,T=M.maxScore,R)},void 0),videoRanges:C,preferHDR:D,minFramerate:y,minBitrate:v,minIndex:E}}function Qs(n,e){Ht.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function TU(n){return n.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);let r=t.channels||"2";return i.channels[r]=(i.channels[r]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function QJ(n,e,t,i){return n.slice(t,i+1).reduce((r,s,o)=>{if(!s.codecSet)return r;let a=s.audioGroups,l=r[s.codecSet];l||(r[s.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,s.bitrate);let u=Math.min(s.height,s.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,s.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,s.score),l.fragmentError+=s.fragmentError,l.videoRanges[s.videoRange]=(l.videoRanges[s.videoRange]||0)+1,a&&a.forEach(d=>{if(!d)return;let f=e.groups[d];f&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?f.hasDefault:f.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(f.channels).forEach(m=>{l.channels[m]=(l.channels[m]||0)+f.channels[m]}))}),r},{})}function sB(n){if(!n)return n;let{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:s}=n;return{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:s}}function eo(n,e,t){if("attrs"in n){let i=e.indexOf(n);if(i!==-1)return i}for(let i=0;i<e.length;i++){let r=e[i];if(Uc(n,r,t))return i}return-1}function Uc(n,e,t){let{groupId:i,name:r,lang:s,assocLang:o,default:a}=n,l=n.forced;return(i===void 0||e.groupId===i)&&(r===void 0||e.name===r)&&(s===void 0||ZJ(s,e.lang))&&(s===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||XJ(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function ZJ(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function XJ(n,e=""){let t=n.split(","),i=e.split(",");return t.length===i.length&&!t.some(r=>i.indexOf(r)===-1)}function Vc(n,e){let{audioCodec:t,channels:i}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function JJ(n,e,t,i,r){let s=e[i],a=e.reduce((m,y,v)=>{let E=y.uri;return(m[E]||(m[E]=[])).push(v),m},{})[s.uri];a.length>1&&(i=Math.max.apply(Math,a));let l=s.videoRange,u=s.frameRate,d=s.codecSet.substring(0,4),f=oB(e,i,m=>{if(m.videoRange!==l||m.frameRate!==u||m.codecSet.substring(0,4)!==d)return!1;let y=m.audioGroups,v=t.filter(E=>!y||y.indexOf(E.groupId)!==-1);return eo(n,v,r)>-1});return f>-1?f:oB(e,i,m=>{let y=m.audioGroups,v=t.filter(E=>!y||y.indexOf(E.groupId)!==-1);return eo(n,v,r)>-1})}function oB(n,e,t){for(let i=e;i>-1;i--)if(t(n[i]))return i;for(let i=e+1;i<n.length;i++)if(t(n[i]))return i;return-1}function D_(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}var NA=class extends qi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;let{fragCurrent:r,partCurrent:s,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!r||!l)return;let u=performance.now(),d=s?s.stats:r.stats,f=s?s.duration:r.duration,m=u-d.loading.start,y=o.minAutoLevel,v=r.level,E=this._nextAutoLevel;if(d.aborted||d.loaded&&d.loaded===d.total||v<=y){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;let T=E>-1&&E!==v,C=!!t||T;if(!C&&(l.paused||!l.playbackRate||!l.readyState))return;let D=o.mainForwardBufferInfo;if(!C&&D===null)return;let P=this.bwEstimator.getEstimateTTFB(),V=Math.abs(l.playbackRate);if(m<=Math.max(P,1e3*(f/(V*2))))return;let G=D?D.len/V:0,H=d.loading.first?d.loading.first-d.loading.start:-1,A=d.loaded&&H>-1,x=this.getBwEstimate(),R=o.levels,M=R[v],F=Math.max(d.loaded,Math.round(f*(r.bitrate||M.averageBitrate)/8)),j=A?m-H:m;j<1&&A&&(j=Math.min(m,d.loaded*8/x));let B=A?d.loaded*1e3/j:0,ge=P/1e3,we=B?(F-d.loaded)/B:F*8/x+ge;if(we<=G)return;let q=B?B*8:x,te=((i=t?.details||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,K=this.hls.config.abrBandWidthUpFactor,ne=Number.POSITIVE_INFINITY,Ee;for(Ee=v-1;Ee>y;Ee--){let me=R[Ee].maxBitrate,Fe=!R[Ee].details||te;if(ne=this.getTimeToLoadFrag(ge,q,f*me,Fe),ne<Math.min(G,f+ge))break}if(ne>=we||ne>f*10)return;A?this.bwEstimator.sample(m-Math.min(P,H),d.loaded):this.bwEstimator.sampleTTFB(m);let oe=R[Ee].maxBitrate;this.getBwEstimate()*K>oe&&this.resetEstimator(oe);let ie=this.findBestLevel(oe,y,Ee,0,G,1,1);ie>-1&&(Ee=ie),this.warn(`Fragment ${r.sn}${s?" part "+s.index:""} of level ${v} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${G.toFixed(3)} s
      Estimated load time for current fragment: ${we.toFixed(3)} s
      Estimated load time for down switch fragment: ${ne.toFixed(3)} s
      TTFB estimate: ${H|0} ms
      Current BW estimate: ${Ie(x)?x|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${Ee} @ ${oe|0} bps`),o.nextLoadLevel=o.nextAutoLevel=Ee,this.clearTimer();let fe=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===Ee&&Ee>0){let me=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${Ee>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${me.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,Ee>y){let Fe=this.findBestLevel(this.hls.levels[y].bitrate,y,Ee,0,me,1,1);Fe===-1&&(Fe=y),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Fe,this.resetEstimator(this.hls.levels[Fe].bitrate)}}};T||we>ne*2?fe():this.timer=self.setInterval(fe,ne*1e3),o.trigger(I.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:s,stats:d})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){let e=this.hls.config;return new PA(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){let{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.FRAG_LOADING,this.onFragLoading,this),e.on(I.FRAG_LOADED,this.onFragLoaded,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this),e.on(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e&&(e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.FRAG_LOADING,this.onFragLoading,this),e.off(I.FRAG_LOADED,this.onFragLoaded,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this),e.off(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(I.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){let i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var r;this.fragCurrent=i,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Q.FRAG_LOAD_TIMEOUT:{let i=t.frag,{fragCurrent:r,partCurrent:s}=this;if(i&&r&&i.sn===r.sn&&i.level===r.level){let o=performance.now(),a=s?s.stats:i.stats,l=o-a.loading.start,u=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&u>-1){let f=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(f,u),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,i,r){let s=e+i/t,o=r?e+this.lastLevelLoadSec:0;return s+o}onLevelLoaded(e,t){let i=this.hls.config,{loading:r}=t.stats,s=r.end-r.first;Ie(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){let r=i?i.stats:t.stats;if(t.type===De.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){let s=i?i.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+r.loaded,l=(o.loaded?o.loaded.duration:0)+s;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){let s={stats:r,frag:t,part:i,id:t.type};this.onFragBuffered(I.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){let{frag:i,part:r}=t,s=r!=null&&r.stats.loaded?r.stats:i.stats;if(s.aborted||this.ignoreFragment(i))return;let o=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,s.loaded),s.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==De.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){let{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,s=this.findBestLevel(i,t,e,0,r,1,1);if(s>-1)return s;let o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){let e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;let s=i&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){let o=this.hls.levels;if(o.length>Math.max(e,s)&&o[e].loadError<=o[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){let{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;let{maxAutoLevel:r,config:s,minAutoLevel:o}=i,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay(),d=s.abrBandWidthFactor,f=s.abrBandWidthUpFactor;if(u){let T=this.findBestLevel(l,o,r,u,0,d,f);if(T>=0)return this.rebufferNotice=-1,T}let m=a?Math.min(a,s.maxStarvationDelay):s.maxStarvationDelay;if(!u){let T=this.bitrateTestDelay;T&&(m=(a?Math.min(a,s.maxLoadingDelay):s.maxLoadingDelay)-T,this.info(`bitrate test took ${Math.round(1e3*T)}ms, set first fragment max fetchDuration to ${Math.round(1e3*m)} ms`),d=f=1)}let y=this.findBestLevel(l,o,r,u,m,d,f);if(this.rebufferNotice!==y&&(this.rebufferNotice=y,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${y}`)),y>-1)return y;let v=i.levels[o],E=i.loadLevelObj;return E&&v?.bitrate<E.bitrate?o:i.loadLevel}getStarvationDelay(){let e=this.hls,t=e.media;if(!t)return 1/0;let i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,r,s,o,a){var l;let u=r+s,d=this.lastLoadedFragLevel,f=d===-1?this.hls.firstLevel:d,{fragCurrent:m,partCurrent:y}=this,{levels:v,allAudioTracks:E,loadLevel:T,config:C}=this.hls;if(v.length===1)return 0;let D=v[f],P=!!((l=this.hls.latestLevelDetails)!=null&&l.live),V=T===-1||d===-1,G,H="SDR",A=D?.frameRate||0,{audioPreference:x,videoPreference:R}=C,M=this.audioTracksByGroup||(this.audioTracksByGroup=TU(E)),F=-1;if(V){if(this.firstSelection!==-1)return this.firstSelection;let q=this.codecTiers||(this.codecTiers=QJ(v,M,t,i)),te=YJ(q,H,e,x,R),{codecSet:K,videoRanges:ne,minFramerate:Ee,minBitrate:oe,minIndex:ie,preferHDR:fe}=te;F=ie,G=K,H=fe?ne[ne.length-1]:ne[0],A=Ee,e=Math.max(e,oe),this.log(`picked start tier ${Zt(te)}`)}else G=D?.codecSet,H=D?.videoRange;let j=y?y.duration:m?m.duration:0,B=this.bwEstimator.getEstimateTTFB()/1e3,ge=[];for(let q=i;q>=t;q--){var we;let te=v[q],K=q>f;if(!te)continue;if(C.useMediaCapabilities&&!te.supportedResult&&!te.supportedPromise){let Fe=navigator.mediaCapabilities;typeof Fe?.decodingInfo=="function"&&BJ(te,M,H,A,e,x)?(te.supportedPromise=_U(te,M,Fe,this.supportedCache),te.supportedPromise.then(Ge=>{if(!this.hls)return;te.supportedResult=Ge;let et=this.hls.levels,Lt=et.indexOf(te);Ge.error?this.warn(`MediaCapabilities decodingInfo error: "${Ge.error}" for level ${Lt} ${Zt(Ge)}`):Ge.supported?Ge.decodingInfoResults.some(Ot=>Ot.smooth===!1||Ot.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Lt} not smooth or powerEfficient: ${Zt(Ge)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Lt} ${Zt(Ge)}`),Lt>-1&&et.length>1&&(this.log(`Removing unsupported level ${Lt}`),this.hls.removeLevel(Lt),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(Ge=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${Ge}`)})):te.supportedResult=yU}if((G&&te.codecSet!==G||H&&te.videoRange!==H||K&&A>te.frameRate||!K&&A>0&&A<te.frameRate||(we=te.supportedResult)!=null&&(we=we.decodingInfoResults)!=null&&we.some(Fe=>Fe.smooth===!1))&&(!V||q!==F)){ge.push(q);continue}let ne=te.details,Ee=(y?ne?.partTarget:ne?.averagetargetduration)||j,oe;K?oe=a*e:oe=o*e;let ie=j&&r>=j*2&&s===0?te.averageBitrate:te.maxBitrate,fe=this.getTimeToLoadFrag(B,oe,ie*Ee,ne===void 0);if(oe>=ie&&(q===d||te.loadError===0&&te.fragmentError===0)&&(fe<=B||!Ie(fe)||P&&!this.bitrateTestDelay||fe<u)){let Fe=this.forcedAutoLevel;return q!==T&&(Fe===-1||Fe!==T)&&(ge.length&&this.trace(`Skipped level(s) ${ge.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${v[ge[0]].codecs}" ${v[ge[0]].videoRange}; not compatible with "${G}" ${H}`),this.info(`switch candidate:${f}->${q} adjustedbw(${Math.round(oe)})-bitrate=${Math.round(oe-ie)} ttfb:${B.toFixed(1)} avgDuration:${Ee.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${fe.toFixed(1)} firstSelection:${V} codecSet:${te.codecSet} videoRange:${te.videoRange} hls.loadLevel:${T}`)),V&&(this.firstSelection=q),q}}return-1}set nextAutoLevel(e){let t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){let{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}},wU={search:function(n,e){let t=0,i=n.length-1,r=null,s=null;for(;t<=i;){r=(t+i)/2|0,s=n[r];let o=e(s);if(o>0)t=r+1;else if(o<0)i=r-1;else return s}return null}};function eee(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!Ie(e))return null;let i=n[0].programDateTime;if(e<(i||0))return null;let r=n[n.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let s=0;s<n.length;++s){let o=n[s];if(nee(e,t,o))return o}return null}function Gc(n,e,t=0,i=0,r=.005){let s=null;if(n){s=e[1+n.sn-e[0].sn]||null;let a=n.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),s&&n.level!==s.level&&s.end<=n.end&&(s=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!n||n.level===s.level)&&aB(t,i,s)===0||tee(s,n,Math.min(r,i))))return s;let o=wU.search(e,aB.bind(null,t,i));return o&&(o!==n||!s)?o:s}function tee(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){let i=e.tagList.reduce((r,s)=>(s[0]==="INF"&&(r+=parseFloat(s[1])),r),t);return n.start<=i}return!1}function aB(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;let i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=n?1:t.start-i>n&&t.start?-1:0}function nee(n,e,t){let i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>n}function bU(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let i=n.fragments,{fragmentHint:r}=n;r&&(i=i.concat(r));let s;return wU.search(i,o=>o.cc<e?1:o.cc>e?-1:(s=o,o.end<=t?1:o.start>t?-1:0)),s||null}return null}function P_(n){switch(n.details){case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_TIMEOUT:case Q.LEVEL_LOAD_TIMEOUT:case Q.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function IU(n){return n.details.startsWith("key")}function SU(n){return IU(n)&&!!n.frag&&!n.frag.decryptdata}function lB(n,e){let t=P_(e);return n.default[`${t?"timeout":"error"}Retry`]}function JD(n,e){let t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function cB(n){return zt(zt({},n),{errorRetry:null,timeoutRetry:null})}function R_(n,e,t,i){if(!n)return!1;let r=i?.code,s=e<n.maxNumRetry&&(iee(r)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,i,s):s}function iee(n){return FA(n)||!!n&&(n<400||n>499)}function FA(n){return n===0&&navigator.onLine===!1}var Qn={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},mr={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4,SwitchToSDR:8},VA=class extends qi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){let e=this.hls;e.on(I.ERROR,this.onError,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){let e=this.hls;e&&(e.off(I.ERROR,this.onError,this),e.off(I.ERROR,this.onErrorOut,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===De.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;let t=this.hls,i=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||i===-1?t.loadLevel:i}variantHasKey(e,t){if(e){var i;if((i=e.details)!=null&&i.hasKey(t))return!0;let r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(o=>r.indexOf(o.groupId)>=0).some(o=>{var a;return(a=o.details)==null?void 0:a.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;let r=this.hls,s=t.context;switch(t.details){case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Q.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=Qd();return}case Q.FRAG_GAP:case Q.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Qn.SendAlternateToPenaltyBox;return}case Q.LEVEL_EMPTY_ERROR:case Q.LEVEL_PARSING_ERROR:{var o;let l=t.parent===De.MAIN?t.level:r.loadLevel;t.details===Q.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case Q.LEVEL_LOAD_ERROR:case Q.LEVEL_LOAD_TIMEOUT:typeof s?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case Q.AUDIO_TRACK_LOAD_ERROR:case Q.AUDIO_TRACK_LOAD_TIMEOUT:case Q.SUBTITLE_LOAD_ERROR:case Q.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){let l=r.loadLevelObj;if(l&&(s.type===mt.AUDIO_TRACK&&l.hasAudioGroup(s.groupId)||s.type===mt.SUBTITLE_TRACK&&l.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Qn.SendAlternateToPenaltyBox,t.errorAction.flags=mr.MoveAllAlternatesMatchingHost;return}}return;case Q.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Qn.SendAlternateToPenaltyBox,flags:mr.MoveAllAlternatesMatchingHDCP};return;case Q.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Q.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Q.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Qn.SendAlternateToPenaltyBox,flags:mr.MoveAllAlternatesMatchingKey};return;case Q.BUFFER_ADD_CODEC_ERROR:case Q.REMUX_ALLOC_ERROR:case Q.BUFFER_APPEND_ERROR:if(!t.errorAction){var a;t.errorAction=this.getLevelSwitchAction(t,(a=t.level)!=null?a:r.loadLevel)}return;case Q.INTERNAL_EXCEPTION:case Q.BUFFER_APPENDING_ERROR:case Q.BUFFER_FULL_ERROR:case Q.LEVEL_SWITCH_ERROR:case Q.BUFFER_STALLED_ERROR:case Q.BUFFER_SEEK_OVER_HOLE:case Q.BUFFER_NUDGE_ON_STALL:t.errorAction=Qd();return}t.type===Ne.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Qd())}getPlaylistRetryOrSwitchAction(e,t){let i=this.hls,r=lB(i.config.playlistLoadPolicy,e),s=this.playlistError++;if(R_(r,s,P_(e),e.response))return{action:Qn.RetryRequest,flags:mr.None,retryConfig:r,retryCount:s};let a=this.getLevelSwitchAction(e,t);return r&&(a.retryConfig=r,a.retryCount=s),a}getFragRetryOrSwitchAction(e){let t=this.hls,i=this.getVariantLevelIndex(e.frag),r=t.levels[i],{fragLoadPolicy:s,keyLoadPolicy:o}=t.config,a=lB(IU(e)?o:s,e),l=t.levels.reduce((d,f)=>d+f.fragmentError,0);if(r&&(e.details!==Q.FRAG_GAP&&r.fragmentError++,!SU(e)&&R_(a,l,P_(e),e.response)))return{action:Qn.RetryRequest,flags:mr.None,retryConfig:a,retryCount:l};let u=this.getLevelSwitchAction(e,i);return a&&(u.retryConfig=a,u.retryCount=l),u}getLevelSwitchAction(e,t){let i=this.hls;t==null&&(t=i.loadLevel);let r=this.hls.levels[t];if(r){var s,o;let u=e.details;r.loadError++,u===Q.BUFFER_APPEND_ERROR&&r.fragmentError++;let d=-1,{levels:f,loadLevel:m,minAutoLevel:y,maxAutoLevel:v}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);let E=(s=e.frag)==null?void 0:s.type,C=(E===De.AUDIO&&u===Q.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===Q.BUFFER_ADD_CODEC_ERROR||u===Q.BUFFER_APPEND_ERROR))&&f.some(({audioCodec:H})=>r.audioCodec!==H),P=e.sourceBufferName==="video"&&(u===Q.BUFFER_ADD_CODEC_ERROR||u===Q.BUFFER_APPEND_ERROR)&&f.some(({codecSet:H,audioCodec:A})=>r.codecSet!==H&&r.audioCodec===A),{type:V,groupId:G}=(o=e.context)!=null?o:{};for(let H=f.length;H--;){let A=(H+m)%f.length;if(A!==m&&A>=y&&A<=v&&f[A].loadError===0){var a,l;let x=f[A];if(u===Q.FRAG_GAP&&E===De.MAIN&&e.frag){let R=f[A].details;if(R){let M=Gc(e.frag,R.fragments,e.frag.start);if(M!=null&&M.gap)continue}}else{if(V===mt.AUDIO_TRACK&&x.hasAudioGroup(G)||V===mt.SUBTITLE_TRACK&&x.hasSubtitleGroup(G))continue;if(E===De.AUDIO&&(a=r.audioGroups)!=null&&a.some(R=>x.hasAudioGroup(R))||E===De.SUBTITLE&&(l=r.subtitleGroups)!=null&&l.some(R=>x.hasSubtitleGroup(R))||C&&r.audioCodec===x.audioCodec||P&&r.codecSet===x.codecSet||!C&&r.codecSet!==x.codecSet)continue}d=A;break}}if(d>-1&&i.loadLevel!==d)return e.levelRetry=!0,this.playlistError=0,{action:Qn.SendAlternateToPenaltyBox,flags:mr.None,nextAutoLevel:d}}return{action:Qn.SendAlternateToPenaltyBox,flags:mr.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case Qn.DoNothing:break;case Qn.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Q.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break;case Qn.RetryRequest:break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){let t=this.hls,i=e.errorAction;if(!i)return;let{flags:r}=i,s=i.nextAutoLevel;switch(r){case mr.None:this.switchLevel(e,s);break;case mr.MoveAllAlternatesMatchingHDCP:{let l=this.getVariantLevelIndex(e.frag),u=t.levels[l],d=u?.attrs["HDCP-LEVEL"];if(i.hdcpLevel=d,d==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(d){t.maxHdcpLevel=OA[OA.indexOf(d)-1],i.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case mr.MoveAllAlternatesMatchingKey:{let l=e.decryptdata;if(l){let u=this.hls.levels,d=u.length;for(let m=d;m--;)if(this.variantHasKey(u[m],l)){var o,a;this.log(`Banned key found in level ${m} (${u[m].bitrate}bps) or audio group "${(o=u[m].audioGroups)==null?void 0:o.join(",")}" (${(a=e.frag)==null?void 0:a.type} fragment) ${ri(l.keyId||[])}`),u[m].fragmentError++,u[m].loadError++,this.log(`Removing level ${m} with key error (${e.error})`),this.hls.removeLevel(m)}let f=e.frag;if(this.hls.levels.length<d)i.resolved=!0;else if(f&&f.type!==De.MAIN){let m=f.decryptdata;m&&!l.matches(m)&&(i.resolved=!0)}}break}}i.resolved||this.switchLevel(e,s)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Q.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){let i=LA(e.mimeType),r=this.hls.levels;for(let s=r.length;s--;)r[s][`${e.sourceBufferName}Codec`]===i&&(this.log(`Removing level ${s} for ${e.details} ("${i}" not supported)`),this.hls.removeLevel(s))}}};function Qd(n){let e={action:Qn.DoNothing,flags:mr.None};return n&&(e.resolved=!0),e}var $n={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},BA=class{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){let{hls:e}=this;e&&(e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.BUFFER_APPENDED,this.onBufferAppended,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this),e.on(I.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){let{hls:e}=this;e&&(e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.BUFFER_APPENDED,this.onBufferAppended,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this),e.off(I.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){let i=this.activePartLists[t];if(i)for(let r=i.length;r--;){let s=i[r];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){let{fragments:r}=this,s=Object.keys(r);for(let o=s.length;o--;){let a=r[s[o]];if(a?.body.type===t&&(!i||a.buffered)){let l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,i,r,s){this.timeRanges&&(this.timeRanges[e]=t);let o=r?.fragment.sn||-1;Object.keys(this.fragments).forEach(a=>{let l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||s)){l.body.type===i&&this.removeFragment(l.body);return}let u=l.range[e];if(u){if(u.time.length===0){this.removeFragment(l.body);return}u.time.some(d=>{let f=!this.isTimeBuffered(d.startPTS,d.endPTS,t);return f&&this.removeFragment(l.body),f})}})}detectPartialFragments(e){let t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;let i=e.frag,r=jd(i),s=this.fragments[r];if(!s||s.buffered&&i.gap)return;let o=!i.relurl;Object.keys(t).forEach(a=>{let l=i.elementaryStreams[a];if(!l)return;let u=t[a],d=o||l.partial===!0;s.range[a]=this.getBufferedTimes(i,e.part,d,u)}),s.loaded=null,Object.keys(s.range).length?(this.bufferedEnd(s,i),s_(s)||this.removeParts(i.sn-1,i.type)):this.removeFragment(s.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){let i=this.activePartLists[t];i&&(this.activePartLists[t]=uB(i,r=>r.fragment.sn>=e))}fragBuffered(e,t){let i=jd(e),r=this.fragments[i];!r&&t&&(r=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,e))}getBufferedTimes(e,t,i,r){let s={time:[],partial:i},o=e.start,a=e.end,l=e.minEndPTS||a,u=e.maxStartPTS||o;for(let d=0;d<r.length;d++){let f=r.start(d)-this.bufferPadding,m=r.end(d)+this.bufferPadding;if(u>=f&&l<=m){s.time.push({startPTS:Math.max(o,r.start(d)),endPTS:Math.min(a,r.end(d))});break}else if(o<m&&a>f){let y=Math.max(o,r.start(d)),v=Math.min(a,r.end(d));v>y&&(s.partial=!0,s.time.push({startPTS:y,endPTS:v}))}else if(a<=f)break}return s}getPartialFragment(e){let t=null,i,r,s,o=0,{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(u=>{let d=l[u];d&&s_(d)&&(r=d.body.start-a,s=d.body.end+a,e>=r&&e<=s&&(i=Math.min(e-r,s-e),o<=i&&(t=d.body,o=i)))}),t}isEndListAppended(e){let t=this.endListFragments[e];return t!==void 0&&(t.buffered||s_(t))}getState(e){let t=jd(e),i=this.fragments[t];return i?i.buffered?s_(i)?$n.PARTIAL:$n.OK:$n.APPENDING:$n.NOT_LOADED}isTimeBuffered(e,t,i){let r,s;for(let o=0;o<i.length;o++){if(r=i.start(o)-this.bufferPadding,s=i.end(o)+this.bufferPadding,e>=r&&t<=s)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;let i=t.frag,r=t.part?null:t,s=jd(i);this.fragments[s]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){let{frag:i,part:r,timeRanges:s,type:o}=t;if(i.sn==="initSegment")return;let a=i.type;if(r){let u=this.activePartLists[a];u||(this.activePartLists[a]=u=[]),u.push(r)}this.timeRanges=s;let l=s[o];this.detectEvictedFragments(o,l,a,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){let t=jd(e);return!!this.fragments[t]}hasFragments(e){let{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let r=i.length;r--;){let s=t[i[r]];if(s?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{let a=this.fragments[o];if(!a)return;let l=a.body;l.type!==i||r&&!l.gap||l.start<t&&l.end>e&&(a.buffered||s)&&this.removeFragment(l)})}removeFragment(e){let t=jd(e);e.clearElementaryStreamInfo();let i=this.activePartLists[e.type];if(i){let r=e.sn;this.activePartLists[e.type]=uB(i,s=>s.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;let t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(i=>i.clearElementaryStreamInfo())}};function s_(n){var e,t,i;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(i=n.range.audiovideo)!=null&&i.partial)}function jd(n){return`${n.type}_${n.level}_${n.sn}`}function uB(n,e){return n.filter(t=>{let i=e(t);return i||t.clearElementaryStreamInfo(),i})}var pl={cbc:0,ctr:1},UA=class{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case pl.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case pl.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}};function ree(n){let e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}var $A=class{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){let t=new DataView(e),i=new Uint32Array(4);for(let r=0;r<4;r++)i[r]=t.getUint32(r*4);return i}initTable(){let e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],s=i[1],o=i[2],a=i[3],l=this.invSubMix,u=l[0],d=l[1],f=l[2],m=l[3],y=new Uint32Array(256),v=0,E=0,T=0;for(T=0;T<256;T++)T<128?y[T]=T<<1:y[T]=T<<1^283;for(T=0;T<256;T++){let C=E^E<<1^E<<2^E<<3^E<<4;C=C>>>8^C&255^99,e[v]=C,t[C]=v;let D=y[v],P=y[D],V=y[P],G=y[C]*257^C*16843008;r[v]=G<<24|G>>>8,s[v]=G<<16|G>>>16,o[v]=G<<8|G>>>24,a[v]=G,G=V*16843009^P*65537^D*257^v*16843008,u[C]=G<<24|G>>>8,d[C]=G<<16|G>>>16,f[C]=G<<8|G>>>24,m[C]=G,v?(v=D^y[y[y[V^D]]],E^=y[y[E]]):v=E=1}}expandKey(e){let t=this.uint8ArrayToUint32Array_(e),i=!0,r=0;for(;r<t.length&&i;)i=t[r]===this.key[r],r++;if(i)return;this.key=t;let s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);let o=this.ksRows=(s+6+1)*4,a,l,u=this.keySchedule=new Uint32Array(o),d=this.invKeySchedule=new Uint32Array(o),f=this.sBox,m=this.rcon,y=this.invSubMix,v=y[0],E=y[1],T=y[2],C=y[3],D,P;for(a=0;a<o;a++){if(a<s){D=u[a]=t[a];continue}P=D,a%s===0?(P=P<<8|P>>>24,P=f[P>>>24]<<24|f[P>>>16&255]<<16|f[P>>>8&255]<<8|f[P&255],P^=m[a/s|0]<<24):s>6&&a%s===4&&(P=f[P>>>24]<<24|f[P>>>16&255]<<16|f[P>>>8&255]<<8|f[P&255]),u[a]=D=(u[a-s]^P)>>>0}for(l=0;l<o;l++)a=o-l,l&3?P=u[a]:P=u[a-4],l<4||a<=4?d[l]=P:d[l]=v[f[P>>>24]]^E[f[P>>>16&255]]^T[f[P>>>8&255]]^C[f[P&255]],d[l]=d[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){let r=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],u=a[1],d=a[2],f=a[3],m=this.uint8ArrayToUint32Array_(i),y=m[0],v=m[1],E=m[2],T=m[3],C=new Int32Array(e),D=new Int32Array(C.length),P,V,G,H,A,x,R,M,F,j,B,ge,we,q,te=this.networkToHostOrderSwap;for(;t<C.length;){for(F=te(C[t]),j=te(C[t+1]),B=te(C[t+2]),ge=te(C[t+3]),A=F^s[0],x=ge^s[1],R=B^s[2],M=j^s[3],we=4,q=1;q<r;q++)P=l[A>>>24]^u[x>>16&255]^d[R>>8&255]^f[M&255]^s[we],V=l[x>>>24]^u[R>>16&255]^d[M>>8&255]^f[A&255]^s[we+1],G=l[R>>>24]^u[M>>16&255]^d[A>>8&255]^f[x&255]^s[we+2],H=l[M>>>24]^u[A>>16&255]^d[x>>8&255]^f[R&255]^s[we+3],A=P,x=V,R=G,M=H,we=we+4;P=o[A>>>24]<<24^o[x>>16&255]<<16^o[R>>8&255]<<8^o[M&255]^s[we],V=o[x>>>24]<<24^o[R>>16&255]<<16^o[M>>8&255]<<8^o[A&255]^s[we+1],G=o[R>>>24]<<24^o[M>>16&255]<<16^o[A>>8&255]<<8^o[x&255]^s[we+2],H=o[M>>>24]<<24^o[A>>16&255]<<16^o[x>>8&255]<<8^o[R&255]^s[we+3],D[t]=te(P^y),D[t+1]=te(H^v),D[t+2]=te(G^E),D[t+3]=te(V^T),y=F,v=j,E=B,T=ge,t=t+4}return D.buffer}},jA=class{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){let e=see(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}};function see(n){switch(n){case pl.cbc:return"AES-CBC";case pl.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}var oee=16,qp=class{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{let i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){let{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;let i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?ree(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,r){return this.useSoftware?new Promise((s,o)=>{let a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,i,r);let l=this.flush();l?s(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,r)}softwareDecrypt(e,t,i,r){let{currentIV:s,currentResult:o,remainderData:a}=this;if(r!==pl.cbc||t.byteLength!==16)return Ht.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=Vr(a,e),this.remainderData=null);let l=this.getValidChunk(e);if(!l.length)return null;s&&(i=s);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new $A),u.expandKey(t);let d=o;return this.currentResult=u.decrypt(l.buffer,0,i),this.currentIV=l.slice(-16).buffer,d||null}webCryptoDecrypt(e,t,i,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,r));this.key=t,this.fastAesKey=new jA(this.subtle,t,r)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new UA(this.subtle,new Uint8Array(i),r).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Ht.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,i,r)))}onWebCryptoError(e,t,i,r){let s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,r);let o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e,i=e.length-e.length%oee;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(Ht.log(`[decrypter]: ${e}`),this.logEnabled=!1)}},dB=Math.pow(2,17),GA=class{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){let i=e.url;if(!i)return Promise.reject(new us({type:Ne.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();let r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(v=>v[0]==="GAP")){l(fB(e));return}else e.gap=!1;let u=this.loader=s?new s(r):new o(r),d=hB(e);e.loader=u;let f=cB(r.fragLoadPolicy.default),m={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:dB};e.stats=u.stats;let y={onSuccess:(v,E,T,C)=>{this.resetLoader(e,u);let D=v.data;T.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(D.slice(0,16)),D=D.slice(16)),a({frag:e,part:null,payload:D,networkDetails:C})},onError:(v,E,T,C)=>{this.resetLoader(e,u),l(new us({type:Ne.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:zt({url:i,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:T,stats:C}))},onAbort:(v,E,T)=>{this.resetLoader(e,u),l(new us({type:Ne.NETWORK_ERROR,details:Q.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:T,stats:v}))},onTimeout:(v,E,T)=>{this.resetLoader(e,u),l(new us({type:Ne.NETWORK_ERROR,details:Q.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:T,stats:v}))}};t&&(y.onProgress=(v,E,T,C)=>t({frag:e,part:null,payload:T,networkDetails:C})),u.load(d,m,y)})}loadPart(e,t,i){this.abort();let r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(fB(e,t));return}let u=this.loader=s?new s(r):new o(r),d=hB(e,t);e.loader=u;let f=cB(r.fragLoadPolicy.default),m={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:dB};t.stats=u.stats,u.load(d,m,{onSuccess:(y,v,E,T)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);let C={frag:e,part:t,payload:y.data,networkDetails:T};i(C),a(C)},onError:(y,v,E,T)=>{this.resetLoader(e,u),l(new us({type:Ne.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:zt({url:d.url,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:E,stats:T}))},onAbort:(y,v,E)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new us({type:Ne.NETWORK_ERROR,details:Q.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:E,stats:y}))},onTimeout:(y,v,E)=>{this.resetLoader(e,u),l(new us({type:Ne.NETWORK_ERROR,details:Q.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:E,stats:y}))}})})}updateStatsFromPart(e,t){let i=e.stats,r=t.stats,s=r.total;if(i.loaded+=r.loaded,s){let l=Math.round(e.duration/t.duration),u=Math.min(Math.round(i.loaded/s),l),f=(l-u)*Math.round(i.loaded/u);i.total=i.loaded+f}else i.total=Math.max(i.loaded,i.total);let o=i.loading,a=r.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}};function hB(n,e=null){let t=e||n,i={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(Ie(r)&&Ie(s)){var o;let a=r,l=s;if(n.sn==="initSegment"&&aee((o=n.decryptdata)==null?void 0:o.method)){let u=s-r;u%16&&(l=s+(16-u%16)),r!==0&&(i.resetIV=!0,a=r-16)}i.rangeStart=a,i.rangeEnd=l}return i}function fB(n,e){let t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),i={type:Ne.MEDIA_ERROR,details:Q.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(i.part=e),(e||n).stats.aborted=!0,new us(i)}function aee(n){return n==="AES-128"||n==="AES-256"}var us=class extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}},M_=class extends qi{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}},Wp=class{constructor(e,t,i,r=0,s=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=o_(),this.buffering={audio:o_(),video:o_(),audiovideo:o_()},this.level=e,this.sn=t,this.id=i,this.size=r,this.part=s,this.partial=o}};function o_(){return{start:0,executeStart:0,executeEnd:0,end:0}}var pB={length:0,start:()=>0,end:()=>0},lt=class n{static isBuffered(e,t){if(e){let i=n.getBuffered(e);for(let r=i.length;r--;)if(t>=i.start(r)&&t<=i.end(r))return!0}return!1}static bufferedRanges(e){if(e){let t=n.getBuffered(e);return n.timeRangesToArray(t)}return[]}static timeRangesToArray(e){let t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){let r=n.bufferedRanges(e);if(r.length)return n.bufferedInfo(r,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((d,f)=>d.start-f.start||f.end-d.end);let r=-1,s=[];if(i)for(let d=0;d<e.length;d++){t>=e[d].start&&t<=e[d].end&&(r=d);let f=s.length;if(f){let m=s[f-1].end;e[d].start-m<i?e[d].end>m&&(s[f-1].end=e[d].end):s.push(e[d])}else s.push(e[d])}else s=e;let o=0,a,l=t,u=t;for(let d=0;d<s.length;d++){let f=s[d].start,m=s[d].end;if(r===-1&&t>=f&&t<=m&&(r=d),t+i>=f&&t<m)l=f,u=m,o=u-t;else if(t+i<f){a=f;break}}return{len:o,start:l||0,end:u||0,nextStart:a,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||pB}catch(t){return Ht.log("failed to get media.buffered",t),pB}}},CU=/\{\$([a-zA-Z0-9-_]+)\}/g;function mB(n){return CU.test(n)}function zA(n,e){if(n.variableList!==null||n.hasVariableRefs){let t=n.variableList;return e.replace(CU,i=>{let r=i.substring(2,i.length-1),s=t?.[r];return s===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),i):s})}return e}function gB(n,e,t){let i=n.variableList;i||(n.variableList=i={});let r,s;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{let o=new self.URL(t).searchParams;if(o.has(r))s=o.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else r=e.NAME,s=e.VALUE;r in i?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):i[r]=s||""}function lee(n,e,t){let i=e.IMPORT;if(t&&i in t){let r=n.variableList;r||(n.variableList=r={}),r[i]=t[i]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}var cee=/^(\d+)x(\d+)$/,yB=/(.+?)=(".*?"|.*?)(?:,|$)/g,hn=class n{constructor(e,t){typeof e=="string"&&(e=n.parseAttrList(e,t)),Wt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){let t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;let i=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)i[r]=parseInt(t.slice(r*2,r*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){let t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){let i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){let i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((r,s)=>(r[s.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){let t=cee.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i,r={},s='"';for(yB.lastIndex=0;(i=yB.exec(e))!==null;){let o=i[1].trim(),a=i[2],l=a.indexOf(s)===0&&a.lastIndexOf(s)===a.length-1,u=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))a=zA(t,a);else if(!u&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ht.warn(`${e}: attribute ${o} is missing quotes`)}r[o]=a}return r}},uee="com.apple.hls.interstitial";function dee(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function hee(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}var k_=class{constructor(e,t,i=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(r=t?.tagOrder)!=null?r:i,t){let s=t.attr;for(let o in s)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==s[o]){Ht.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=Wt(new hn({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){let s=t?.endDate||new Date(this.attr["END-DATE"]);Ie(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){let e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){let{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Ht.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){let e=this._endDate||this._dateAtEnd;if(e)return e;let t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){let e=this.attr.decimalFloatingPoint("DURATION");if(Ie(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===uee}get isValid(){return!!this.id&&!this._badValueForSameId&&Ie(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}},fee=10,HA=class{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}let t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let i=t.decryptdata;return i||(t.setKeyFormat(e.keyFormat),i=t.decryptdata),!!i&&e.matches(i)})}get hasProgramDateTime(){return this.fragments.length?Ie(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||fee}get drift(){let e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){let e=this.partList;if(e){let t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){let e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}};function L_(n,e){return n.length===e.length?!n.some((t,i)=>t!==e[i]):!1}function vB(n,e){return!n&&!e?!0:!n||!e?!1:L_(n,e)}function Zd(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function e1(n){switch(n){case"AES-128":case"AES-256":return pl.cbc;case"AES-256-CTR":return pl.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function t1(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function qA(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function pee(n){let e=qA(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function xU(n){let e=function(i,r,s){let o=i[r];i[r]=i[s],i[s]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function AU(n){let e=n.split(":"),t=null;if(e[0]==="data"&&e.length===2){let i=e[1].split(";"),r=i[i.length-1].split(",");if(r.length===2){let s=r[0]==="base64",o=r[1];s?(i.splice(-1,1),t=t1(o)):t=pee(o)}}return t}var O_=typeof self<"u"?self:void 0,fn={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},si={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function __(n){switch(n){case si.FAIRPLAY:return fn.FAIRPLAY;case si.PLAYREADY:return fn.PLAYREADY;case si.WIDEVINE:return fn.WIDEVINE;case si.CLEARKEY:return fn.CLEARKEY}}function dA(n){switch(n){case fn.FAIRPLAY:return si.FAIRPLAY;case fn.PLAYREADY:return si.PLAYREADY;case fn.WIDEVINE:return si.WIDEVINE;case fn.CLEARKEY:return si.CLEARKEY}}function Vp(n){let{drmSystems:e,widevineLicenseUrl:t}=n,i=e?[fn.FAIRPLAY,fn.WIDEVINE,fn.PLAYREADY,fn.CLEARKEY].filter(r=>!!e[r]):[];return!i[fn.WIDEVINE]&&t&&i.push(fn.WIDEVINE),i}var DU=function(n){return O_!=null&&(n=O_.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function mee(n,e,t,i){let r;switch(n){case fn.FAIRPLAY:r=["cenc","sinf"];break;case fn.WIDEVINE:case fn.PLAYREADY:r=["cenc"];break;case fn.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return gee(r,e,t,i)}function gee(n,e,t,i){return[{initDataTypes:n,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function yee(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function PU(n){let e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(o){let a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){let l=t1(a).subarray(0,16);return xU(l),l}}return null}var Gd={},th=class n{static clearKeyUriToKeyIdMap(){Gd={}}static setKeyIdForUri(e,t){Gd[e]=t}static addKeyIdForUri(e){let t=Object.keys(Gd).length%Number.MAX_SAFE_INTEGER,i=new Uint8Array(16);return new DataView(i.buffer,12,4).setUint32(0,t),Gd[e]=i,i}constructor(e,t,i,r=[1],s=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=r,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Zd(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(aU(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&L_(e.keyFormatVersions,this.keyFormatVersions)&&vB(e.iv,this.iv)&&vB(e.keyId,this.keyId)}isSupported(){if(this.method){if(Zd(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case si.FAIRPLAY:case si.WIDEVINE:case si.PLAYREADY:case si.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Zd(this.method)){let s=this.iv;return s||(typeof e!="number"&&(Ht.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),s=_ee(e)),new n(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){let s=Gd[this.uri];if(s&&!L_(this.keyId,s)&&n.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}let i=AU(this.uri);if(i)switch(this.keyFormat){case si.WIDEVINE:if(this.pssh=i,!this.keyId){let s=PJ(i.buffer);if(s.length){var r;let o=s[0];this.keyId=(r=o.kids)!=null&&r.length?o.kids[0]:null}}this.keyId||(this.keyId=_B(t));break;case si.PLAYREADY:{let s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=DJ(s,null,i),this.keyId=PU(i);break}default:{let s=i.subarray(0,16);if(s.length!==16){let o=new Uint8Array(16);o.set(s,16-s.length),s=o}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s;s=vee(t),s||(s=_B(t),s||(s=Gd[this.uri])),s&&(this.keyId=s,n.setKeyIdForUri(this.uri,s))}return this}};function vee(n){let e=n?.[si.WIDEVINE];return e?e.keyId:null}function _B(n){let e=n?.[si.PLAYREADY];if(e){let t=AU(e.uri);if(t)return PU(t)}return null}function _ee(n){let e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}var EB=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,TB=/#EXT-X-MEDIA:(.*)/g,Eee=/^#EXT(?:INF|-X-TARGETDURATION):/m,hA=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Tee=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Bc=class n{static findGroup(e,t){for(let i=0;i<e.length;i++){let r=e[i];if(r.id===t)return r}}static resolve(e,t){return YD.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Eee.test(e)}static parseMasterPlaylist(e,t){let i=mB(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},s=[];if(EB.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let o;for(;(o=EB.exec(e))!=null;)if(o[1]){var a;let u=new hn(o[1],r),d=zA(r,o[2]),f={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:n.resolve(d,t)},m=u.decimalResolution("RESOLUTION");m&&(f.width=m.width,f.height=m.height),IB(u.CODECS,f);let y=u["SUPPLEMENTAL-CODECS"];y&&(f.supplemental={},IB(y,f.supplemental)),(a=f.unknownCodecs)!=null&&a.length||s.push(f),r.levels.push(f)}else if(o[3]){let u=o[3],d=o[4];switch(u){case"SESSION-DATA":{let f=new hn(d,r),m=f["DATA-ID"];m&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[m]=f);break}case"SESSION-KEY":{let f=wB(d,t,r);f.encrypted&&f.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(f)):Ht.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${d}"`);break}case"DEFINE":{{let f=new hn(d,r);gB(r,f,t)}break}case"CONTENT-STEERING":{let f=new hn(d,r);r.contentSteering={uri:n.resolve(f["SERVER-URI"],t),pathwayId:f["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=bB(d);break}}}let l=s.length>0&&s.length<r.levels.length;return r.levels=l?s:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,i){let r,s={},o=i.levels,a={AUDIO:o.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:o.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]},l=0;for(TB.lastIndex=0;(r=TB.exec(e))!==null;){let u=new hn(r[1],i),d=u.TYPE;if(d){let f=a[d],m=s[d]||[];s[d]=m;let y=u.LANGUAGE,v=u["ASSOC-LANGUAGE"],E=u.CHANNELS,T=u.CHARACTERISTICS,C=u["INSTREAM-ID"],D={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||y||"",type:d,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:y,url:u.URI?n.resolve(u.URI,t):""};if(v&&(D.assocLang=v),E&&(D.channels=E),T&&(D.characteristics=T),C&&(D.instreamId=C),f!=null&&f.length){let P=n.findGroup(f,D.groupId)||f[0];SB(D,P,"audioCodec"),SB(D,P,"textCodec")}m.push(D)}}return s}static parseLevelPlaylist(e,t,i,r,s,o){var a;let l={url:t},u=new HA(t),d=u.fragments,f=[],m=null,y=0,v=0,E=0,T=0,C=0,D=null,P=new Bp(r,l),V,G,H,A=-1,x=!1,R=null,M;if(hA.lastIndex=0,u.m3u8=e,u.hasVariableRefs=mB(e),((a=hA.exec(e))==null?void 0:a[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(V=hA.exec(e))!==null;){x&&(x=!1,P=new Bp(r,l),P.playlistOffset=E,P.setStart(E),P.sn=y,P.cc=T,C&&(P.bitrate=C),P.level=i,m&&(P.initSegment=m,m.rawProgramDateTime&&(P.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null),R&&(P.setByteRange(R),R=null)));let ge=V[1];if(ge){P.duration=parseFloat(ge);let we=(" "+V[2]).slice(1);P.title=we||null,P.tagList.push(we?["INF",ge,we]:["INF",ge])}else if(V[3]){if(Ie(P.duration)){P.playlistOffset=E,P.setStart(E),H&&xB(P,H,u),P.sn=y,P.level=i,P.cc=T,d.push(P);let we=(" "+V[3]).slice(1);P.relurl=zA(u,we),WA(P,D,f),D=P,E+=P.duration,y++,v=0,x=!0}}else{if(V=V[0].match(Tee),!V){Ht.warn("No matches on slow regex match for level playlist!");continue}for(G=1;G<V.length&&V[G]===void 0;G++);let we=(" "+V[G]).slice(1),q=(" "+V[G+1]).slice(1),te=V[G+2]?(" "+V[G+2]).slice(1):null;switch(we){case"BYTERANGE":D?P.setByteRange(q,D):P.setByteRange(q);break;case"PROGRAM-DATE-TIME":P.rawProgramDateTime=q,P.tagList.push(["PROGRAM-DATE-TIME",q]),A===-1&&(A=d.length);break;case"PLAYLIST-TYPE":u.type&&Zo(u,we,V),u.type=q.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?Zo(u,we,V):d.length>0&&AB(u,we,V),y=u.startSN=parseInt(q);break;case"SKIP":{u.skippedSegments&&Zo(u,we,V);let K=new hn(q,u),ne=K.decimalInteger("SKIPPED-SEGMENTS");if(Ie(ne)){u.skippedSegments+=ne;for(let oe=ne;oe--;)d.push(null);y+=ne}let Ee=K.enumeratedString("RECENTLY-REMOVED-DATERANGES");Ee&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(Ee.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&Zo(u,we,V),u.targetduration=Math.max(parseInt(q),1);break;case"VERSION":u.version!==null&&Zo(u,we,V),u.version=parseInt(q);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||Zo(u,we,V),u.live=!1;break;case"#":(q||te)&&P.tagList.push(te?[q,te]:[q]);break;case"DISCONTINUITY":T++,P.tagList.push(["DIS"]);break;case"GAP":P.gap=!0,P.tagList.push([we]);break;case"BITRATE":P.tagList.push([we,q]),C=parseInt(q)*1e3,Ie(C)?P.bitrate=C:C=0;break;case"DATERANGE":{let K=new hn(q,u),ne=new k_(K,u.dateRanges[K.ID],u.dateRangeTagCount);u.dateRangeTagCount++,ne.isValid||u.skippedSegments?u.dateRanges[ne.id]=ne:Ht.warn(`Ignoring invalid DATERANGE tag: "${q}"`),P.tagList.push(["EXT-X-DATERANGE",q]);break}case"DEFINE":{{let K=new hn(q,u);"IMPORT"in K?lee(u,K,o):gB(u,K,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?Zo(u,we,V):d.length>0&&AB(u,we,V),u.startCC=T=parseInt(q);break;case"KEY":{let K=wB(q,t,u);if(K.isSupported()){if(K.method==="NONE"){H=void 0;break}H||(H={});let ne=H[K.keyFormat];ne!=null&&ne.matches(K)||(ne&&(H=Wt({},H)),H[K.keyFormat]=K)}else Ht.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${q}"`);break}case"START":u.startTimeOffset=bB(q);break;case"MAP":{let K=new hn(q,u);if(P.duration){let ne=new Bp(r,l);CB(ne,K,i,H),m=ne,P.initSegment=m,m.rawProgramDateTime&&!P.rawProgramDateTime&&(P.rawProgramDateTime=m.rawProgramDateTime)}else{let ne=P.byteRangeEndOffset;if(ne){let Ee=P.byteRangeStartOffset;R=`${ne-Ee}@${Ee}`}else R=null;CB(P,K,i,H),m=P,x=!0}m.cc=T;break}case"SERVER-CONTROL":{M&&Zo(u,we,V),M=new hn(q),u.canBlockReload=M.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=M.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&M.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=M.optionalFloat("PART-HOLD-BACK",0),u.holdBack=M.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&Zo(u,we,V);let K=new hn(q);u.partTarget=K.decimalFloatingPoint("PART-TARGET");break}case"PART":{let K=u.partList;K||(K=u.partList=[]);let ne=v>0?K[K.length-1]:void 0,Ee=v++,oe=new hn(q,u),ie=new kA(oe,P,l,Ee,ne);K.push(ie),P.duration+=ie.duration;break}case"PRELOAD-HINT":{let K=new hn(q,u);u.preloadHint=K;break}case"RENDITION-REPORT":{let K=new hn(q,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(K);break}default:Ht.warn(`line parsed but not handled: ${V}`);break}}}D&&!D.relurl?(d.pop(),E-=D.duration,u.partList&&(u.fragmentHint=D)):u.partList&&(WA(P,D,f),P.cc=T,u.fragmentHint=P,H&&xB(P,H,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));let F=d.length,j=d[0],B=d[F-1];if(E+=u.skippedSegments*u.targetduration,E>0&&F&&B){u.averagetargetduration=E/F;let ge=B.sn;u.endSN=ge!=="initSegment"?ge:0,u.live||(B.endList=!0),A>0&&(bee(d,A),j&&f.unshift(j))}return u.fragmentHint&&(E+=u.fragmentHint.duration),u.totalduration=E,f.length&&u.dateRangeTagCount&&j&&RU(f,u),u.endCC=T,u}};function RU(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){let a=e.fragments[e.fragments.length-1];n.push(a),t++}else return;let i=n[t-1],r=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let a=s.length;a--;){let l=e.dateRanges[s[a]],u=l.startDate.getTime();l.tagAnchor=i.ref;for(let d=t;d--;){var o;if(((o=n[d])==null?void 0:o.sn)<e.startSN)break;let f=wee(e,u,n,d,r);if(f!==-1){l.tagAnchor=e.fragments[f].ref;break}}}}function wee(n,e,t,i,r){let s=t[i];if(s){let a=s.programDateTime;if(e>=a||i===0){var o;let l=(((o=t[i+1])==null?void 0:o.start)||r)-s.start;if(e<=a+l*1e3){let u=t[i].sn-n.startSN;if(u<0)return-1;let d=n.fragments;if(d.length>t.length){let m=(t[i+1]||d[d.length-1]).sn-n.startSN;for(let y=m;y>u;y--){let v=d[y].programDateTime;if(e>=v&&e<v+d[y].duration*1e3)return y}}return u}}}return-1}function wB(n,e,t){var i,r;let s=new hn(n,t),o=(i=s.METHOD)!=null?i:"",a=s.URI,l=s.hexadecimalInteger("IV"),u=s.KEYFORMATVERSIONS,d=(r=s.KEYFORMAT)!=null?r:"identity";a&&s.IV&&!l&&Ht.error(`Invalid IV: ${s.IV}`);let f=a?Bc.resolve(a,e):"",m=(u||"1").split("/").map(Number).filter(Number.isFinite);return new th(o,f,d,m,l,s.KEYID)}function bB(n){let t=new hn(n).decimalFloatingPoint("TIME-OFFSET");return Ie(t)?t:null}function IB(n,e){let t=(n||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{let r=t.filter(s=>ZD(s,i));r.length&&(e[`${i}Codec`]=r.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>r.indexOf(s)===-1))}),e.unknownCodecs=t}function SB(n,e,t){let i=e[t];i&&(n[t]=i)}function bee(n,e){let t=n[e];for(let i=e;i--;){let r=n[i];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function WA(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function CB(n,e,t,i){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",i&&(n.levelkeys=i),n.initSegment=null}function xB(n,e,t){n.levelkeys=e;let{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&i.push(n)}function Zo(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function AB(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function fA(n,e){let t=e.startPTS;if(Ie(t)){let i=0,r;e.sn>n.sn?(i=t-n.start,r=n):(i=n.start-t,r=e),r.duration!==i&&r.setDuration(i)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function MU(n,e,t,i,r,s,o){i-t<=0&&(o.warn("Fragment should have a positive duration",e),i=t+e.duration,s=r+e.duration);let l=t,u=i,d=e.startPTS,f=e.endPTS;if(Ie(d)){let C=Math.abs(d-t);n&&C>n.totalduration?o.warn(`media timestamps and playlist times differ by ${C}s for level ${e.level} ${n.url}`):Ie(e.deltaPTS)?e.deltaPTS=Math.max(C,e.deltaPTS):e.deltaPTS=C,l=Math.max(t,d),t=Math.min(t,d),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,u=Math.min(i,f),i=Math.max(i,f),s=e.endDTS!==void 0?Math.max(s,e.endDTS):s}let m=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=r,e.endPTS=i,e.minEndPTS=u,e.endDTS=s;let y=e.sn;if(!n||y<n.startSN||y>n.endSN)return 0;let v,E=y-n.startSN,T=n.fragments;for(T[E]=e,v=E;v>0;v--)fA(T[v],T[v-1]);for(v=E;v<T.length-1;v++)fA(T[v],T[v+1]);return n.fragmentHint&&fA(T[T.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,m}function Iee(n,e,t){if(n===e)return;let i=null,r=n.fragments;for(let d=r.length-1;d>=0;d--){let f=r[d].initSegment;if(f){i=f;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let s;xee(n,e,(d,f,m,y)=>{if((!e.startCC||e.skippedSegments)&&f.cc!==d.cc){let v=d.cc-f.cc;for(let E=m;E<y.length;E++)y[E].cc+=v;e.endCC=y[y.length-1].cc}Ie(d.startPTS)&&Ie(d.endPTS)&&(f.setStart(f.startPTS=d.startPTS),f.startDTS=d.startDTS,f.maxStartPTS=d.maxStartPTS,f.endPTS=d.endPTS,f.endDTS=d.endDTS,f.minEndPTS=d.minEndPTS,f.setDuration(d.endPTS-d.startPTS),f.duration&&(s=f),e.PTSKnown=e.alignedSliding=!0),d.hasStreams&&(f.elementaryStreams=d.elementaryStreams),f.loader=d.loader,d.hasStats&&(f.stats=d.stats),d.initSegment&&(f.initSegment=d.initSegment,i=d.initSegment)});let o=e.fragments,a=e.fragmentHint?o.concat(e.fragmentHint):o;if(i&&a.forEach(d=>{var f;d&&(!d.initSegment||d.initSegment.relurl===((f=i)==null?void 0:f.relurl))&&(d.initSegment=i)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(d=>!d),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let d=e.skippedSegments;d--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=See(n.dateRanges,e,t));let d=n.fragments.filter(f=>f.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let f=1;f<a.length;f++)a[f].programDateTime===null&&WA(a[f],a[f-1],d);RU(d,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var l;let d=OU(n,e.startSN-1);e.startCC=(l=d?.cc)!=null?l:o[0].cc}Cee(n.partList,e.partList,(d,f)=>{f.elementaryStreams=d.elementaryStreams,f.stats=d.stats}),s?MU(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,t):kU(n,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;let u=e.advancedDateTime;if(e.advanced&&u){let d=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=d),e.driftEndTime=u,e.driftEnd=d}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function See(n,e,t){let{dateRanges:i,recentlyRemovedDateranges:r}=e,s=Wt({},n);r&&r.forEach(l=>{delete s[l]});let a=Object.keys(s).length;return a?(Object.keys(i).forEach(l=>{let u=s[l],d=new k_(i[l].attr,u);d.isValid?(s[l]=d,u||(d.tagOrder+=a)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Zt(i[l].attr)}"`)}),s):i}function Cee(n,e,t){if(n&&e){let i=0;for(let r=0,s=n.length;r<=s;r++){let o=n[r],a=e[r+i];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):i--}}}function xee(n,e,t){let i=e.skippedSegments,r=Math.max(n.startSN,e.startSN)-e.startSN,s=(n.fragmentHint?1:0)+(i?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let u=r;u<=s;u++){let d=l[o+u],f=a[u];if(i&&!f&&d&&(f=e.fragments[u]=d),d&&f){t(d,f,u,a);let m=d.relurl,y=f.relurl;if(m&&Aee(m,y)){e.playlistParsingError=DB(`media sequence mismatch ${f.sn}:`,n,e,d,f);return}else if(d.cc!==f.cc){e.playlistParsingError=DB(`discontinuity sequence mismatch (${d.cc}!=${f.cc})`,n,e,d,f);return}}}}function DB(n,e,t,i,r){return new Error(`${n} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function kU(n,e,t=!0){let i=e.startSN+e.skippedSegments-n.startSN,r=n.fragments,s=i>=0,o=0;if(s&&i<r.length)o=r[i].start;else if(s&&e.startSN===n.endSN+1)o=n.fragmentEnd;else if(s&&t)o=n.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=n.fragmentStart;else return;KA(e,o)}function KA(n,e){if(e){let t=n.fragments;for(let i=n.skippedSegments;i<t.length;i++)t[i].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function LU(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){let i=n.fragments;if(i.length&&t*4>e){let s=i[i.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function OU(n,e,t){if(!n)return null;let i=n.fragments[e-n.startSN];return i||(i=n.fragmentHint,i&&i.sn===e)?i:e<n.startSN&&t&&t.sn===e?t:null}function PB(n,e,t){return n?NU(n.partList,e,t):null}function NU(n,e,t){if(n)for(let i=n.length;i--;){let r=n[i];if(r.index===t&&r.fragment.sn===e)return r}return null}function FU(n){n.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function Aee(n,e){return n!==e&&e?RB(n)!==RB(e):!1}function RB(n){return n.replace(/\?[^?]*$/,"")}function Up(n,e){for(let i=0,r=n.length;i<r;i++){var t;if(((t=n[i])==null?void 0:t.cc)===e)return n[i]}return null}function Dee(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function MB(n,e){let t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function VU(n,e){let t=e.fragments;for(let i=0,r=t.length;i<r;i++)MB(t[i],n);e.fragmentHint&&MB(e.fragmentHint,n),e.alignedSliding=!0}function Pee(n,e){n&&(BU(e,n),e.alignedSliding||N_(e,n),!e.alignedSliding&&!e.skippedSegments&&kU(n,e,!1))}function BU(n,e){if(!Dee(e,n))return;let t=Math.min(e.endCC,n.endCC),i=Up(e.fragments,t),r=Up(n.fragments,t);if(!i||!r)return;Ht.log(`Aligning playlist at start of dicontinuity sequence ${t}`);let s=i.start-r.start;VU(s,n)}function N_(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;let t=n.fragments,i=e.fragments;if(!t.length||!i.length)return;let r,s,o=Math.min(e.endCC,n.endCC);e.startCC<o&&n.startCC<o&&(r=Up(i,o),s=Up(t,o)),(!r||!s)&&(r=i[Math.floor(i.length/2)],s=Up(t,r.cc)||t[Math.floor(t.length/2)]);let a=r.programDateTime,l=s.programDateTime;if(!a||!l)return;let u=(l-a)/1e3-(s.start-r.start);VU(u,n)}function Ri(n,e,t){Hi(n,e,t),n.addEventListener(e,t)}function Hi(n,e,t){n.removeEventListener(e,t)}var Ree={toString:function(n){let e="",t=n.length;for(let i=0;i<t;i++)e+=`[${n.start(i).toFixed(3)}-${n.end(i).toFixed(3)}]`;return e}},re={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},Kp=class extends M_{constructor(e,t,i,r,s){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=re.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{let{config:o,fragCurrent:a,media:l,mediaBuffer:u,state:d}=this,f=l?l.currentTime:0,m=lt.bufferInfo(u||l,f,o.maxBufferHole),y=!m.len;if(this.log(`Media seeking to ${Ie(f)?f.toFixed(3):f}, state: ${d}, ${y?"out of":"in"} buffer`),this.state===re.ENDED)this.resetLoadingState();else if(a){let v=o.maxFragLookUpTolerance,E=a.start-v,T=a.start+a.duration+v;if(y||T<m.start||E>m.end){let C=f>T;(f<E||C)&&(C&&a.loader&&(this.log(`Cancelling fragment load for seek (sn: ${a.sn})`),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(f,1/0,this.playlistType,!0);let v=this.lastCurrentTime;if(f>v&&(this.lastCurrentTime=f),!this.loadingParts){let E=Math.max(m.end,f),T=this.shouldLoadParts(this.getLevelDetails(),E);T&&(this.log(`LL-Part loading ON after seeking to ${f.toFixed(2)} with buffer @${E.toFixed(2)}`),this.loadingParts=T)}}this.hls.hasEnoughToStart||(this.log(`Setting ${y?"startPosition":"nextLoadPosition"} to ${f} for seek without enough to start`),this.nextLoadPosition=f,y&&(this.startPosition=f)),y&&this.state===re.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new GA(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new qp(e.config)}registerListeners(){let{hls:e}=this;e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===re.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);let e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=re.STOPPED}get startPositionValue(){let{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;let i=e.end||0,r=this.config.timelineOffset||0;if(i<=r)return!1;let s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=lt.bufferedInfo(s,e.start,0));let o=e.nextStart;if(o&&o>r&&o<t.edge||this.media.currentTime<e.start)return!1;let l=t.partList;if(l!=null&&l.length){let d=l[l.length-1];return lt.isBuffered(this.media,d.start+d.duration/2)}let u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){let e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){let i=this.media=this.mediaBuffer=t.media;Ri(i,"seeking",this.onMediaSeeking),Ri(i,"ended",this.onMediaEnded);let r=this.config;this.levels&&r.autoStartLoad&&this.state===re.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){let i=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Hi(r,"seeking",this.onMediaSeeking),Hi(r,"ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=re.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){let r=s=>{let o=s.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(o,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,i,r).then(s=>{if(!s)return;let o=this.state,a=s.frag;if(this.fragContextChanged(a)){(o===re.FRAG_LOADING||!this.fragCurrent&&o===re.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=re.IDLE);return}"payload"in s&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(I.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(`Frag error: ${s?.message||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;let{fragmentTracker:i}=this;if(i.getState(e)===$n.APPENDING){let s=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,s),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===$n.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){let t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){let t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;let r={startOffset:e,endOffset:t,type:i};this.hls.trigger(I.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{let r=i?.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{let{hls:r}=this,{frag:s,payload:o}=i,a=s.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&Zd(a.method)){let l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,e1(a.method)).catch(u=>{throw r.trigger(I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:s}),u}).then(u=>{let d=self.performance.now();return r.trigger(I.FRAG_DECRYPTED,{frag:s,payload:u,stats:{tstart:l,tdecrypt:d}}),i.payload=u,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){let{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");let i=e.frag.stats;this.state!==re.STOPPED&&(this.state=re.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var i,r;let s=e.tracks;if(s&&!t.encrypted&&((i=s.audio)!=null&&i.encrypted||(r=s.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){let o=this.media,a=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(a.message),!o||o.mediaKeys?!1:(this.hls.trigger(I.ERROR,{type:Ne.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_KEYS,fatal:!1,error:a,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){let{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){let i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?Ree.toString(lt.getBuffered(i)):"(detached)"})`),In(e)){var r;if(e.type!==De.SUBTITLE){let o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=re.IDLE;return}}let s=(r=this.levels)==null?void 0:r[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=re.IDLE}_handleFragmentLoadComplete(e){let{transmuxer:t}=this;if(!t)return;let{frag:i,part:r,partsLoaded:s}=e,o=!s||s.length===0||s.some(l=>!l),a=new Wp(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,r){var s;this.fragCurrent=e;let o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=re.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(m=>{if(!this.fragContextChanged(m.frag))return this.hls.trigger(I.KEY_LOADED,m),this.state===re.KEY_LOADING&&(this.state=re.IDLE),m}),this.hls.trigger(I.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(a=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));let l=this.fragPrevious;if(In(e)&&(!l||e.sn!==l.sn)){let m=this.shouldLoadParts(t.details,e.end);m!==this.loadingParts&&(this.log(`LL-Part loading ${m?"ON":"OFF"} loading sn ${l?.sn}->${e.sn}`),this.loadingParts=m)}if(i=Math.max(e.start,i||0),this.loadingParts&&In(e)){let m=o.partList;if(m&&r){i>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);let y=this.getNextPart(m,e,i);if(y>-1){let v=m[y];e=this.fragCurrent=v.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${v.index} (${y}/${m.length-1}) of ${this.fragInfo(e,!1,v)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=v.start+v.duration,this.state=re.FRAG_LOADING;let E;return a?E=a.then(T=>!T||this.fragContextChanged(T.frag)?null:this.doFragPartsLoad(e,v,t,r)).catch(T=>this.handleFragLoadError(T)):E=this.doFragPartsLoad(e,v,t,r).catch(T=>this.handleFragLoadError(T)),this.hls.trigger(I.FRAG_LOADING,{frag:e,part:v,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):E}else if(!e.url||this.loadedEndOfParts(m,i))return Promise.resolve(null)}}if(In(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=o.partList)==null?void 0:u.filter(m=>m.loaded).map(m=>`[${m.start}-${m.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(i.toFixed(3))}`),Ie(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=re.FRAG_LOADING;let d=this.config.progressive&&e.type!==De.SUBTITLE,f;return d&&a?f=a.then(m=>!m||this.fragContextChanged(m.frag)?null:this.fragmentLoader.load(e,r)).catch(m=>this.handleFragLoadError(m)):f=Promise.all([this.fragmentLoader.load(e,d?r:void 0),a]).then(([m])=>(!d&&r&&r(m),m)).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(I.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):f}doFragPartsLoad(e,t,i,r){return new Promise((s,o)=>{var a;let l=[],u=(a=i.details)==null?void 0:a.partList,d=f=>{this.fragmentLoader.loadPart(e,f,r).then(m=>{l[f.index]=m;let y=m.part;this.hls.trigger(I.FRAG_LOADED,m);let v=PB(i.details,e.sn,f.index+1)||NU(u,e.sn,f.index+1);if(v)d(v);else return s({frag:e,part:y,partsLoaded:l})}).catch(o)};d(t)})}handleFragLoadError(e){if("data"in e){let t=e.data;t.frag&&t.details===Q.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Ne.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(I.ERROR,t)}else this.hls.trigger(I.ERROR,{type:Ne.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){let t=this.getCurrentContext(e);if(!t||this.state!==re.PARSING){!this.fragCurrent&&this.state!==re.STOPPED&&this.state!==re.ERROR&&(this.state=re.IDLE);return}let{frag:i,part:r,level:s}=t,o=self.performance.now();i.stats.parsing.end=o,r&&(r.stats.parsing.end=o);let a=this.getLevelDetails(),u=a&&i.sn>a.endSN||this.shouldLoadParts(a,i.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(i,r,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var i;let s=e.partList[0];if(s.fragment.type===De.SUBTITLE)return!1;let o=s.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=o){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){let{levels:t,fragCurrent:i}=this,{level:r,sn:s,part:o}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;let a=t[r],l=a.details,u=o>-1?PB(l,s,o):null,d=u?u.fragment:OU(l,s,i);return d?(i&&i!==d&&(d.stats=i.stats),{frag:d,part:u,level:a}):null}bufferFragmentData(e,t,i,r,s){if(this.state!==re.PARSING)return;let{data1:o,data2:a}=e,l=o;if(a&&(l=Vr(o,a)),!l.length)return;let u=this.initPTS[t.cc],d=u?-u.baseTime/u.timescale:void 0,f={type:e.type,frag:t,part:i,chunkMeta:r,offset:d,parent:t.type,data:l};if(this.hls.trigger(I.BUFFER_APPENDING,f),e.dropped&&e.independent&&!i){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){let t=this.media;if(!t)return;if(!lt.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}let i=t.currentTime,r=lt.bufferInfo(t,i,0),s=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),a=Math.max(Math.min(e.start-o,r.end-o),i+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var i;let r=this.getLoadPosition();if(!Ie(r))return null;let o=this.lastCurrentTime>r||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,o)}getFwdBufferInfoAtPos(e,t,i,r){let s=lt.bufferInfo(e,t,r);if(s.len===0&&s.nextStart!==void 0){let o=this.fragmentTracker.getBufferedFrag(t,i);if(o&&(s.nextStart<=o.end||o.gap)){let a=Math.max(Math.min(s.nextStart,o.end)-t,r);return lt.bufferInfo(e,t,a)}}return s}getMaxBufferLength(e){let{config:t}=this,i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){let i=this.config,r=Math.max(Math.min(e-t,i.maxBufferLength),t),s=Math.max(e-t*3,i.maxMaxBufferLength/2,r);return s>=r?(i.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=De.MAIN){let i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){let i=t.fragments,r=i.length;if(!r)return null;let{config:s}=this,o=i[0].start,a=s.lowLatencyMode&&!!t.partList,l=null;if(t.live){let f=s.initialLiveManifestSize;if(r<f)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${f})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var u;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);let m=this.hls.startPosition,y=this.hls.liveSyncPosition,v=l?(m!==-1&&m>=o?m:y)||l.start:e;this.log(`Setting startPosition to ${v} to match start frag at live edge. mainStart: ${m} liveSyncPosition: ${y} frag.start: ${(u=l)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=v}}else e<=o&&(l=i[0]);if(!l){let f=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,f,t)}let d=this.filterReplacedPrimary(l,t);if(!d&&l){let f=l.sn-t.startSN;d=this.filterReplacedPrimary(i[f+1]||null,t)}return this.mapToInitFragWhenRequired(d)}isLoopLoading(e,t){let i=this.fragmentTracker.getState(e);return(i===$n.OK||i===$n.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,r,s){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&i.nextStart)){let a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r,0);if(a!==null&&i.len+a.len>=s){let l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(kB(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(kB(this.config)&&e.type!==De.SUBTITLE){let i=this.hls.interstitialsManager,r=i?.bufferingItem;if(r){let o=r.event;if(o){if(o.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&t?.live===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}let s=i?.playerQueue;if(s)for(let o=s.length;o--;){let a=s[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let r=-1,s=!1,o=!0;for(let a=0,l=e.length;a<l;a++){let u=e[a];if(o=o&&!u.independent,r>-1&&i<u.start)break;let d=u.loaded;d?r=-1:(s||(u.independent||o)&&u.fragment===t)&&(u.fragment!==t&&this.warn(`Need buffer at ${i} but next unloaded part starts at ${u.start}`),r=a),s=d}return r}loadedEndOfParts(e,t){let i;for(let r=e.length;r--;){if(i=e[r],!i.loaded)return!1;if(t>i.start)return!0}return!1}getInitialLiveFragment(e){let t=e.fragments,i=this.fragPrevious,r=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=eee(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){let s=i.sn+1;if(s>=e.startSN&&s<=e.endSN){let o=t[s-e.startSN];i.cc===o.cc&&(r=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=bU(e,i.cc,i.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{let s=this.hls.liveSyncPosition;s!==null&&(r=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,i){let{config:r}=this,{fragPrevious:s}=this,{fragments:o,endSN:a}=i,{fragmentHint:l}=i,{maxFragLookUpTolerance:u}=r,d=i.partList,f=!!(this.loadingParts&&d!=null&&d.length&&l);f&&!this.bitrateTest&&d[d.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let m;if(e<t){var y;let E=e<this.lastCurrentTime||e>t-u||(y=this.media)!=null&&y.paused||!this.startFragRequested?0:u;m=Gc(s,o,e,E)}else m=o[o.length-1];if(m){let v=m.sn-i.startSN,E=this.fragmentTracker.getState(m);if((E===$n.OK||E===$n.PARTIAL&&m.gap)&&(s=m),s&&m.sn===s.sn&&(!f||d[0].fragment.sn>m.sn||!i.live)&&m.level===s.level){let C=o[v+1];m.sn<a&&this.fragmentTracker.getState(C)!==$n.OK?m=C:m=null}}return m}alignPlaylists(e,t,i){let r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;let s=e.fragmentStart,o=!t,a=e.alignedSliding&&Ie(s);if(o||!a&&!s){Pee(i,e);let l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),l}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);let r=this.timelineOffset;if(i===-1){let s=this.startTimeOffset!==null,o=s?this.startTimeOffset:e.startTimeOffset;o!==null&&Ie(o)?(i=t+o,o<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${o} found in ${s?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+r}this.nextLoadPosition=i+r}getLoadPosition(){var e;let{media:t}=this,i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&In(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==re.FRAG_LOADING_WAITING_RETRY)&&(this.state=re.IDLE)}onFragmentOrKeyLoadError(e,t){var i;if(t.chunkMeta&&!t.frag){let C=this.getCurrentContext(t.chunkMeta);C&&(t.frag=C.frag)}let r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var s;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}let o=t.details===Q.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(r,!0);let a=t.errorAction;if(!a){this.state=re.ERROR;return}let{action:l,flags:u,retryCount:d=0,retryConfig:f}=a,m=!!f,y=m&&l===Qn.RetryRequest,v=m&&!a.resolved&&u===mr.MoveAllAlternatesMatchingHost,E=(i=this.hls.latestLevelDetails)==null?void 0:i.live;if(!y&&v&&In(r)&&!r.endList&&E&&!SU(t))this.resetFragmentErrors(e),this.treatAsGap(r),a.resolved=!0;else if((y||v)&&d<f.maxNumRetry){var T;let C=FA((T=t.response)==null?void 0:T.code),D=JD(f,d);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+D,this.state=re.FRAG_LOADING_WAITING_RETRY,a.resolved=!0,C){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${d+1}/${f.maxNumRetry} in ${D}ms`)}else if(f)if(this.resetFragmentErrors(e),d<f.maxNumRetry)!o&&l!==Qn.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${d})`);return}else l===Qn.SendAlternateToPenaltyBox?this.state=re.WAITING_LEVEL:this.state=re.ERROR;this.tickImmediate()}checkRetryDate(){let e=self.performance.now(),t=this.retryDate,i=t===1/0;(!t||e>=t||i&&!FA(0))&&(i&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=re.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===re.PARSING||this.state===re.PARSED){let t=e.frag,i=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,i),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len,t?.duration||10);let o=!s;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===De.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==re.STOPPED&&(this.state=re.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;let r=lt.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,i),this.state===re.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==re.STOPPED&&(this.state=re.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;let e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,r){let s=i.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{let d=e.elementaryStreams[u];if(d){let f=d.endPTS-d.startPTS;if(f<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${f})`),l||!1;let m=r?0:MU(s,e,d.startPTS,d.endPTS,d.startDTS,d.endDTS,this);return this.hls.trigger(I.LEVEL_PTS_UPDATED,{details:s,level:i,drift:m,type:u,frag:e,start:d.startPTS,end:d.endPTS}),!0}return l},!1)){var a;let l=((a=this.transmuxer)==null?void 0:a.error)===null;if((i.fragmentError===0||l&&(i.fragmentError<2||e.endList))&&this.treatAsGap(e,i),l){let u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=re.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(I.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===De.MAIN?"level":"track"}fragInfo(e,t=!0,i){var r,s;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((r=t&&!i?e.startPTS:(i||e).start)!=null?r:NaN).toFixed(3)}-${((s=t&&!i?e.endPTS:(i||e).end)!=null?s:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){let t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}};function kB(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}var F_=class{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){let{chunks:e,dataLength:t}=this,i;if(e.length)e.length===1?i=e[0]:i=Mee(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}};function Mee(n,e){let t=new Uint8Array(e),i=0;for(let r=0;r<n.length;r++){let s=n[r];t.set(s,i),i+=s.length}return t}var pA={exports:{}},LB;function kee(){return LB||(LB=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function r(l,u,d){this.fn=l,this.context=u,this.once=d||!1}function s(l,u,d,f,m){if(typeof d!="function")throw new TypeError("The listener must be a function");var y=new r(d,f||l,m),v=t?t+u:u;return l._events[v]?l._events[v].fn?l._events[v]=[l._events[v],y]:l._events[v].push(y):(l._events[v]=y,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new i:delete l._events[u]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],d,f;if(this._eventsCount===0)return u;for(f in d=this._events)e.call(d,f)&&u.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},a.prototype.listeners=function(u){var d=t?t+u:u,f=this._events[d];if(!f)return[];if(f.fn)return[f.fn];for(var m=0,y=f.length,v=new Array(y);m<y;m++)v[m]=f[m].fn;return v},a.prototype.listenerCount=function(u){var d=t?t+u:u,f=this._events[d];return f?f.fn?1:f.length:0},a.prototype.emit=function(u,d,f,m,y,v){var E=t?t+u:u;if(!this._events[E])return!1;var T=this._events[E],C=arguments.length,D,P;if(T.fn){switch(T.once&&this.removeListener(u,T.fn,void 0,!0),C){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,d),!0;case 3:return T.fn.call(T.context,d,f),!0;case 4:return T.fn.call(T.context,d,f,m),!0;case 5:return T.fn.call(T.context,d,f,m,y),!0;case 6:return T.fn.call(T.context,d,f,m,y,v),!0}for(P=1,D=new Array(C-1);P<C;P++)D[P-1]=arguments[P];T.fn.apply(T.context,D)}else{var V=T.length,G;for(P=0;P<V;P++)switch(T[P].once&&this.removeListener(u,T[P].fn,void 0,!0),C){case 1:T[P].fn.call(T[P].context);break;case 2:T[P].fn.call(T[P].context,d);break;case 3:T[P].fn.call(T[P].context,d,f);break;case 4:T[P].fn.call(T[P].context,d,f,m);break;default:if(!D)for(G=1,D=new Array(C-1);G<C;G++)D[G-1]=arguments[G];T[P].fn.apply(T[P].context,D)}}return!0},a.prototype.on=function(u,d,f){return s(this,u,d,f,!1)},a.prototype.once=function(u,d,f){return s(this,u,d,f,!0)},a.prototype.removeListener=function(u,d,f,m){var y=t?t+u:u;if(!this._events[y])return this;if(!d)return o(this,y),this;var v=this._events[y];if(v.fn)v.fn===d&&(!m||v.once)&&(!f||v.context===f)&&o(this,y);else{for(var E=0,T=[],C=v.length;E<C;E++)(v[E].fn!==d||m&&!v[E].once||f&&v[E].context!==f)&&T.push(v[E]);T.length?this._events[y]=T.length===1?T[0]:T:o(this,y)}return this},a.prototype.removeAllListeners=function(u){var d;return u?(d=t?t+u:u,this._events[d]&&o(this,d)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a}(pA)),pA.exports}var Lee=kee(),n1=pJ(Lee),Yp="1.6.15",nh={};function Oee(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Nee(){let n=nh[Yp];if(n)return n.clientCount++,n;let e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return nh[Yp]=r,r}function Fee(n){let e=nh[n];if(e)return e.clientCount++,e;let t=new self.URL(n,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return nh[n]=r,r}function Vee(n){let e=nh[n||Yp];if(e&&e.clientCount--===1){let{worker:i,objectURL:r}=e;delete nh[n||Yp],r&&self.URL.revokeObjectURL(r),i.terminate()}}function UU(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function i1(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Q_(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function Qp(n,e){let t=e,i=0;for(;i1(n,e);){i+=10;let r=Q_(n,e+6);i+=r,UU(n,e+10)&&(i+=10),e+=i}if(i>0)return n.subarray(t,t+i)}function Bee(n,e,t,i){let r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],o=s>>2&15;if(o>12){let y=new Error(`invalid ADTS sampling index:${o}`);n.emit(I.ERROR,I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!0,error:y,reason:y.message});return}let a=(s>>6&3)+1,l=e[t+3]>>6&3|(s&1)<<2,u="mp4a.40."+a,d=r[o],f=o;(a===5||a===29)&&(f-=3);let m=[a<<3|(f&14)>>1,(f&1)<<7|l<<3];return Ht.log(`manifest codec:${i}, parsed codec:${u}, channels:${l}, rate:${d} (ADTS object type:${a} sampling index:${o})`),{config:m,samplerate:d,channelCount:l,codec:u,parsedCodec:u,manifestCodec:i}}function $U(n,e){return n[e]===255&&(n[e+1]&246)===240}function jU(n,e){return n[e+1]&1?7:9}function r1(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function Uee(n,e){return e+5<n.length}function V_(n,e){return e+1<n.length&&$U(n,e)}function $ee(n,e){return Uee(n,e)&&$U(n,e)&&r1(n,e)<=n.length-e}function jee(n,e){if(V_(n,e)){let t=jU(n,e);if(e+t>=n.length)return!1;let i=r1(n,e);if(i<=t)return!1;let r=e+i;return r===n.length||V_(n,r)}return!1}function GU(n,e,t,i,r){if(!n.samplerate){let s=Bee(e,t,i,r);if(!s)return;Wt(n,s)}}function zU(n){return 1024*9e4/n}function Gee(n,e){let t=jU(n,e);if(e+t<=n.length){let i=r1(n,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function HU(n,e,t,i,r){let s=zU(n.samplerate),o=i+r*s,a=Gee(e,t),l;if(a){let{frameLength:f,headerLength:m}=a,y=m+f,v=Math.max(0,t+y-e.length);v?(l=new Uint8Array(y-m),l.set(e.subarray(t+m,e.length),0)):l=e.subarray(t+m,t+y);let E={unit:l,pts:o};return v||n.samples.push(E),{sample:E,length:y,missing:v}}let u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:u,missing:-1}}function zee(n,e){return i1(n,e)&&Q_(n,e+6)+10<=n.length-e}function Hee(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function mA(n,e=0,t=1/0){return qee(n,e,t,Uint8Array)}function qee(n,e,t,i){let r=Wee(n),s=1;"BYTES_PER_ELEMENT"in i&&(s=i.BYTES_PER_ELEMENT);let o=Kee(n)?n.byteOffset:0,a=(o+n.byteLength)/s,l=(o+e)/s,u=Math.floor(Math.max(0,Math.min(l,a))),d=Math.floor(Math.min(u+Math.max(t,0),a));return new i(r,u,d-u)}function Wee(n){return n instanceof ArrayBuffer?n:n.buffer}function Kee(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function Yee(n){let e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}let i=n.data.subarray(1).indexOf(0);if(i===-1)return;let r=vr(mA(n.data,1,i)),s=n.data[2+i],o=n.data.subarray(3+i).indexOf(0);if(o===-1)return;let a=vr(mA(n.data,3+i,o)),l;return r==="-->"?l=vr(mA(n.data,4+i+o)):l=Hee(n.data.subarray(4+i+o)),e.mimeType=r,e.pictureType=s,e.description=a,e.data=l,e}function Qee(n){if(n.size<2)return;let e=vr(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function Zee(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1,i=vr(n.data.subarray(t),!0);t+=i.length+1;let r=vr(n.data.subarray(t));return{key:n.type,info:i,data:r}}let e=vr(n.data.subarray(1));return{key:n.type,info:"",data:e}}function Xee(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1,i=vr(n.data.subarray(t),!0);t+=i.length+1;let r=vr(n.data.subarray(t));return{key:n.type,info:i,data:r}}let e=vr(n.data);return{key:n.type,info:"",data:e}}function Jee(n){return n.type==="PRIV"?Qee(n):n.type[0]==="W"?Xee(n):n.type==="APIC"?Yee(n):Zee(n)}function ete(n){let e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=Q_(n,4),i=10;return{type:e,size:t,data:n.subarray(i,i+t)}}var a_=10,tte=10;function qU(n){let e=0,t=[];for(;i1(n,e);){let i=Q_(n,e+6);n[e+5]>>6&1&&(e+=a_),e+=a_;let r=e+i;for(;e+tte<r;){let s=ete(n.subarray(e)),o=Jee(s);o&&t.push(o),e+=s.size+a_}UU(n,e)&&(e+=a_)}return t}function WU(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function nte(n){if(n.data.byteLength===8){let e=new Uint8Array(n.data),t=e[3]&1,i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function s1(n){let e=qU(n);for(let t=0;t<e.length;t++){let i=e[t];if(WU(i))return nte(i)}}var yr=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function Js(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}var Zp=class{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=Vr(this.cachedData,e),this.cachedData=null);let i=Qp(e,0),r=i?i.length:0,s,o=this._audioTrack,a=this._id3Track,l=i?s1(i):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&Ie(l))&&(this.basePTS=ite(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:yr.audioId3,duration:Number.POSITIVE_INFINITY});r<u;){if(this.canParse(e,r)){let d=this.appendFrame(o,e,r);d?(this.frameIndex++,this.lastPTS=d.sample.pts,r+=d.length,s=r):r=u}else zee(e,r)?(i=Qp(e,r),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:yr.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,s=r):r++;if(r===u&&s!==u){let d=e.slice(s);this.cachedData?this.cachedData=Vr(this.cachedData,d):this.cachedData=d}}return{audioTrack:o,videoTrack:Js(),id3Track:a,textTrack:Js()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){let t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Js(),id3Track:this._id3Track,textTrack:Js()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}},ite=(n,e,t)=>{if(Ie(n))return n*90;let i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i},l_=null,rte=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],ste=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],ote=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],ate=[0,1,1,4];function KU(n,e,t,i,r){if(t+24>e.length)return;let s=YU(e,t);if(s&&t+s.frameLength<=e.length){let o=s.samplesPerFrame*9e4/s.sampleRate,a=i+r*o,l={unit:e.subarray(t,t+s.frameLength),pts:a,dts:a};return n.config=[],n.channelCount=s.channelCount,n.samplerate=s.sampleRate,n.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function YU(n,e){let t=n[e+1]>>3&3,i=n[e+1]>>1&3,r=n[e+2]>>4&15,s=n[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&s!==3){let o=n[e+2]>>1&1,a=n[e+3]>>6,l=t===3?3-i:i===3?3:4,u=rte[l*14+r-1]*1e3,f=ste[(t===3?0:t===2?1:2)*3+s],m=a===3?1:2,y=ote[t][i],v=ate[i],E=y*8*v,T=Math.floor(y*u/f+o)*v;if(l_===null){let P=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);l_=P?parseInt(P[1]):0}return!!l_&&l_<=87&&i===2&&u>=224e3&&a===0&&(n[e+3]=n[e+3]|128),{sampleRate:f,channelCount:m,frameLength:T,samplesPerFrame:E}}}function o1(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function QU(n,e){return e+1<n.length&&o1(n,e)}function lte(n,e){return o1(n,e)&&4<=n.length-e}function ZU(n,e){if(e+1<n.length&&o1(n,e)){let i=YU(n,e),r=4;i!=null&&i.frameLength&&(r=i.frameLength);let s=e+r;return s===n.length||QU(n,s)}return!1}var YA=class extends Zp{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;let i=Qp(e,0),r=i?.length||0;if(ZU(e,r))return!1;for(let s=e.length;r<s;r++)if(jee(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return $ee(e,t)}appendFrame(e,t,i){GU(e,this.observer,t,i,e.manifestCodec);let r=HU(e,t,i,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}},XU=(n,e)=>{let t=0,i=5;e+=i;let r=new Uint32Array(1),s=new Uint32Array(1),o=new Uint8Array(1);for(;i>0;){o[0]=n[e];let a=Math.min(i,8),l=8-a;s[0]=4278190080>>>24+l<<l,r[0]=(o[0]&s[0])>>l,t=t?t<<a|r[0]:r[0],e+=1,i-=a}return t},QA=class extends Zp{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){let r=JU(e,t,i,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;let t=Qp(e,0);if(!t)return!1;let i=t.length;return e[i]===11&&e[i+1]===119&&s1(t)!==void 0&&XU(e,i)<16}};function JU(n,e,t,i,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;let s=e[t+4]>>6;if(s>=3)return-1;let a=[48e3,44100,32e3][s],l=e[t+4]&63,d=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+s]*2;if(t+d>e.length)return-1;let f=e[t+6]>>5,m=0;f===2?m+=2:(f&1&&f!==1&&(m+=2),f&4&&(m+=2));let y=(e[t+6]<<8|e[t+7])>>12-m&1,E=[2,1,2,3,3,4,4,5][f]+y,T=e[t+5]>>3,C=e[t+5]&7,D=new Uint8Array([s<<6|T<<1|C>>2,(C&3)<<6|f<<3|y<<2|l>>4,l<<4&224]),P=1536/a*9e4,V=i+r*P,G=e.subarray(t,t+d);return n.config=D,n.channelCount=E,n.samplerate=a,n.samples.push({unit:G,pts:V}),d}var ZA=class extends Zp{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=Qp(e,0),i=t?.length||0;if(t&&e[i]===11&&e[i+1]===119&&s1(t)!==void 0&&XU(e,i)<=16)return!1;for(let r=e.length;i<r;i++)if(ZU(e,i))return Ht.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return lte(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return KU(e,t,i,this.basePTS,this.frameIndex)}},cte=/\/emsg[-/]ID3/i,XA=class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,r){let s=this.videoTrack=Js("video",1),o=this.audioTrack=Js("audio",1),a=this.txtTrack=Js("text",1);if(this.id3Track=Js("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;let l=hU(e);if(l.video){let{id:u,timescale:d,codec:f,supplemental:m}=l.video;s.id=u,s.timescale=a.timescale=d,s.codec=f,s.supplemental=m}if(l.audio){let{id:u,timescale:d,codec:f}=l.audio;o.id=u,o.timescale=d,o.codec=f}a.id=cU.text,s.sampleDuration=0,s.duration=o.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return vJ(e)}demux(e,t){this.timeOffset=t;let i=e,r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=Vr(this.remainderData,e));let a=SJ(i);this.remainderData=a.remainder,r.samples=a.valid||new Uint8Array}else r.samples=i;let o=this.extractID3Track(r,t);return s.samples=JV(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){let e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;let r=this.extractID3Track(t,this.timeOffset);return i.samples=JV(e,t),{videoTrack:t,audioTrack:Js(),id3Track:r,textTrack:Js()}}extractID3Track(e,t){let i=this.id3Track;if(e.samples.length){let r=ft(e.samples,["emsg"]);r&&r.forEach(s=>{let o=xJ(s);if(cte.test(o.schemeIdUri)){let a=OB(o,t),l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);let u=o.payload;i.samples.push({data:u,len:u.byteLength,dts:a,pts:a,type:yr.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){let a=OB(o,t);i.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:yr.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}};function OB(n,e){return Ie(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}var JA=class{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new qp(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,pl.cbc)}decryptAacSample(e,t,i){let r=e[t].unit;if(r.length<=16)return;let s=r.subarray(16,r.length-r.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(o).then(a=>{let l=new Uint8Array(a);r.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)}).catch(i)}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){let t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t),r=0;for(let s=32;s<e.length-16;s+=160,r+=16)i.set(e.subarray(s,s+16),r);return i}getAvcDecryptedUnit(e,t){let i=new Uint8Array(t),r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(i.subarray(r,r+16),s);return e}decryptAvcSample(e,t,i,r,s){let o=mU(s.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,r)}).catch(r)}decryptAvcSamples(e,t,i,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){r();return}let s=e[t].units;for(;!(i>=s.length);i++){let o=s[i];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,i,r,o),!this.decrypter.isSync()))return}}}},B_=class{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,r;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){let s=i.units;r=s[s.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){let i=t.samples,r=i.length;if(r){let s=i[r-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){let r=t.byteLength,s=e.naluState||0,o=s,a=[],l=0,u,d,f,m=-1,y=0;for(s===-1&&(m=0,y=this.getNALuType(t,0),s=0,l=1);l<r;){if(u=t[l++],!s){s=u?0:1;continue}if(s===1){s=u?0:2;continue}if(!u)s=3;else if(u===1){if(d=l-s-1,m>=0){let v={data:t.subarray(m,d),type:y};a.push(v)}else{let v=this.getLastNalUnit(e.samples);v&&(o&&l<=4-o&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-o)),d>0&&(v.data=Vr(v.data,t.subarray(0,d)),v.state=0))}l<r?(f=this.getNALuType(t,l),m=l,y=f,s=0):s=-1}else s=0}if(m>=0&&s>=0){let v={data:t.subarray(m,r),type:y,state:s};a.push(v)}if(a.length===0){let v=this.getLastNalUnit(e.samples);v&&(v.data=Vr(v.data,t))}return e.naluState=s,a}},$c=class{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){let e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");r.set(e.subarray(i,i+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;if(e>32&&Ht.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){let e=this.skipLZ();return this.readBits(e+1)-1}readEG(){let e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}},eD=class extends B_{parsePES(e,t,i,r){let s=this.parseNALu(e,i.data,r),o=this.VideoSample,a,l=!1;i.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(u=>{var d,f;switch(u.type){case 1:{let E=!1;a=!0;let T=u.data;if(l&&T.length>4){let C=this.readSliceType(T);(C===2||C===4||C===7||C===9)&&(E=!0)}if(E){var m;(m=o)!=null&&m.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.frame=!0,o.key=E;break}case 5:a=!0,(d=o)!=null&&d.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,QD(u.data,1,i.pts,t.samples);break}case 7:{var y,v;a=!0,l=!0;let E=u.data,T=this.readSPS(E);if(!e.sps||e.width!==T.width||e.height!==T.height||((y=e.pixelRatio)==null?void 0:y[0])!==T.pixelRatio[0]||((v=e.pixelRatio)==null?void 0:v[1])!==T.pixelRatio[1]){e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.sps=[E];let C=E.subarray(1,4),D="avc1.";for(let P=0;P<3;P++){let V=C[P].toString(16);V.length<2&&(V="0"+V),D+=V}e.codec=D}break}case 8:a=!0,e.pps=[u.data];break;case 9:a=!0,e.audFound=!0,(f=o)!=null&&f.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(u)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){let t=new $c(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,r=8,s;for(let o=0;o<e;o++)r!==0&&(s=t.readEG(),r=(i+s+256)%256),i=r===0?i:r}readSPS(e){let t=new $c(e),i=0,r=0,s=0,o=0,a,l,u,d=t.readUByte.bind(t),f=t.readBits.bind(t),m=t.readUEG.bind(t),y=t.readBoolean.bind(t),v=t.skipBits.bind(t),E=t.skipEG.bind(t),T=t.skipUEG.bind(t),C=this.skipScalingList.bind(this);d();let D=d();if(f(5),v(3),d(),T(),D===100||D===110||D===122||D===244||D===44||D===83||D===86||D===118||D===128){let x=m();if(x===3&&v(1),T(),T(),v(1),y())for(l=x!==3?8:12,u=0;u<l;u++)y()&&(u<6?C(16,t):C(64,t))}T();let P=m();if(P===0)m();else if(P===1)for(v(1),E(),E(),a=m(),u=0;u<a;u++)E();T(),v(1);let V=m(),G=m(),H=f(1);H===0&&v(1),v(1),y()&&(i=m(),r=m(),s=m(),o=m());let A=[1,1];if(y()&&y())switch(d()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[d()<<8|d(),d()<<8|d()];break}}return{width:Math.ceil((V+1)*16-i*2-r*2),height:(2-H)*(G+1)*16-(H?2:4)*(s+o),pixelRatio:A}}},tD=class extends B_{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,r){let s=this.parseNALu(e,i.data,r),o=this.VideoSample,a,l=!1;i.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(u=>{var d,f;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var m;(m=o)!=null&&m.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(d=o)!=null&&d.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,QD(u.data,2,i.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Wt(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){let y=this.readSPS(u.data);e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.codec=y.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(let v in y.params)e.params[v]=y.params[v]}this.pushParameterSet(e.sps,u.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];let y=this.readPPS(u.data);for(let v in y)e.params[v]=y[v]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(f=o)!=null&&f.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:a=!1;break}o&&a&&o.units.push(u)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){let t=new Uint8Array(e.byteLength),i=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[i]=e[r],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){let t=new $c(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);let i=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:r}}readSPS(e){let t=new $c(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);let i=t.readBits(3);t.readBoolean();let r=t.readBits(2),s=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),l=t.readUByte(),u=t.readUByte(),d=t.readUByte(),f=t.readUByte(),m=t.readUByte(),y=t.readUByte(),v=t.readUByte(),E=t.readUByte(),T=t.readUByte(),C=t.readUByte(),D=[],P=[];for(let ct=0;ct<i;ct++)D.push(t.readBoolean()),P.push(t.readBoolean());if(i>0)for(let ct=i;ct<8;ct++)t.readBits(2);for(let ct=0;ct<i;ct++)D[ct]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),P[ct]&&t.readUByte();t.readUEG();let V=t.readUEG();V==3&&t.skipBits(1);let G=t.readUEG(),H=t.readUEG(),A=t.readBoolean(),x=0,R=0,M=0,F=0;A&&(x+=t.readUEG(),R+=t.readUEG(),M+=t.readUEG(),F+=t.readUEG());let j=t.readUEG(),B=t.readUEG(),ge=t.readUEG(),we=t.readBoolean();for(let ct=we?0:i;ct<=i;ct++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Tn=0;Tn<4;Tn++)for(let Zn=0;Zn<(Tn===3?2:6);Zn++)if(!t.readBoolean())t.readUEG();else{let Xn=Math.min(64,1<<4+(Tn<<1));Tn>1&&t.readEG();for(let Ki=0;Ki<Xn;Ki++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());let K=t.readUEG(),ne=0;for(let ct=0;ct<K;ct++){let Tn=!1;if(ct!==0&&(Tn=t.readBoolean()),Tn){ct===K&&t.readUEG(),t.readBoolean(),t.readUEG();let Zn=0;for(let Mi=0;Mi<=ne;Mi++){let Xn=t.readBoolean(),Ki=!1;Xn||(Ki=t.readBoolean()),(Xn||Ki)&&Zn++}ne=Zn}else{let Zn=t.readUEG(),Mi=t.readUEG();ne=Zn+Mi;for(let Xn=0;Xn<Zn;Xn++)t.readUEG(),t.readBoolean();for(let Xn=0;Xn<Mi;Xn++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){let ct=t.readUEG();for(let Tn=0;Tn<ct;Tn++){for(let Zn=0;Zn<ge+4;Zn++)t.readBits(1);t.readBits(1)}}let oe=0,ie=1,fe=1,me=!0,Fe=1,Ge=0;t.readBoolean(),t.readBoolean();let et=!1;if(t.readBoolean()){if(t.readBoolean()){let _r=t.readUByte(),Kc=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Er=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];_r>0&&_r<16?(ie=Kc[_r-1],fe=Er[_r-1]):_r===255&&(ie=t.readBits(16),fe=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),et=t.readBoolean(),et&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(Fe=t.readBits(32),Ge=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){let Er=t.readBoolean(),so=t.readBoolean(),Tr=!1;(Er||so)&&(Tr=t.readBoolean(),Tr&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Tr&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let wn=0;wn<=i;wn++){me=t.readBoolean();let Cn=me||t.readBoolean(),fs=!1;Cn?t.readEG():fs=t.readBoolean();let _l=fs?1:t.readUEG()+1;if(Er)for(let Br=0;Br<_l;Br++)t.readUEG(),t.readUEG(),Tr&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(so)for(let Br=0;Br<_l;Br++)t.readUEG(),t.readUEG(),Tr&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),oe=t.readUEG())}let Ot=G,Xt=H;if(A){let ct=1,Tn=1;V===1?ct=Tn=2:V==2&&(ct=2),Ot=G-ct*R-ct*x,Xt=H-Tn*F-Tn*M}let Sn=r?["A","B","C"][r]:"",vl=a<<24|l<<16|u<<8|d,ds=0;for(let ct=0;ct<32;ct++)ds=(ds|(vl>>ct&1)<<31-ct)>>>0;let hs=ds.toString(16);return o===1&&hs==="2"&&(hs="6"),{codecString:`hvc1.${Sn}${o}.${hs}.${s?"H":"L"}${C}.B0`,params:{general_tier_flag:s,general_profile_idc:o,general_profile_space:r,general_profile_compatibility_flags:[a,l,u,d],general_constraint_indicator_flags:[f,m,y,v,E,T],general_level_idc:C,bit_depth:j+8,bit_depth_luma_minus8:j,bit_depth_chroma_minus8:B,min_spatial_segmentation_idc:oe,chroma_format_idc:V,frame_rate:{fixed:me,fps:Ge/Fe}},width:Ot,height:Xt,pixelRatio:[ie,fe]}}readPPS(e){let t=new $c(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);let r=t.readBoolean(),s=t.readBoolean(),o=1;return s&&r?o=0:s?o=3:r&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}},Yn=188,nD=class n{constructor(e,t,i,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=r,this.videoParser=null}static probe(e,t){let i=n.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){let t=e.length,i=Math.min(Yn*5,t-Yn)+1,r=0;for(;r<i;){let s=!1,o=-1,a=0;for(let l=r;l<t;l+=Yn)if(e[l]===71&&(t-l===Yn||e[l+Yn]===71)){if(a++,o===-1&&(o=l,o!==0&&(i=Math.min(o+Yn*99,e.length-Yn)+1)),s||(s=iD(e,l)===0),s&&a>1&&(o===0&&a>2||l+Yn>i))return o}else{if(a)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:cU[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=n.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=n.createTrack("audio",r),this._id3Track=n.createTrack("id3"),this._txtTrack=n.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){let{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,r=!1){i||(this.sampleAes=null);let s,o=this._videoTrack,a=this._audioTrack,l=this._id3Track,u=this._txtTrack,d=o.pid,f=o.pesData,m=a.pid,y=l.pid,v=a.pesData,E=l.pesData,T=null,C=this.pmtParsed,D=this._pmtId,P=e.length;if(this.remainderData&&(e=Vr(this.remainderData,e),P=e.length,this.remainderData=null),P<Yn&&!r)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};let V=Math.max(0,n.syncOffset(e));P-=(P-V)%Yn,P<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,P,e.buffer.byteLength-P));let G=0;for(let A=V;A<P;A+=Yn)if(e[A]===71){let x=!!(e[A+1]&64),R=iD(e,A),M=(e[A+3]&48)>>4,F;if(M>1){if(F=A+5+e[A+4],F===A+Yn)continue}else F=A+4;switch(R){case d:x&&(f&&(s=zd(f,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,u,s,!1)),f={data:[],size:0}),f&&(f.data.push(e.subarray(F,A+Yn)),f.size+=A+Yn-F);break;case m:if(x){if(v&&(s=zd(v,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,s);break;case"mp3":this.parseMPEGPES(a,s);break;case"ac3":this.parseAC3PES(a,s);break}v={data:[],size:0}}v&&(v.data.push(e.subarray(F,A+Yn)),v.size+=A+Yn-F);break;case y:x&&(E&&(s=zd(E,this.logger))&&this.parseID3PES(l,s),E={data:[],size:0}),E&&(E.data.push(e.subarray(F,A+Yn)),E.size+=A+Yn-F);break;case 0:x&&(F+=e[F]+1),D=this._pmtId=ute(e,F);break;case D:{x&&(F+=e[F]+1);let j=dte(e,F,this.typeSupported,i,this.observer,this.logger);d=j.videoPid,d>0&&(o.pid=d,o.segmentCodec=j.segmentVideoCodec),m=j.audioPid,m>0&&(a.pid=m,a.segmentCodec=j.segmentAudioCodec),y=j.id3Pid,y>0&&(l.pid=y),T!==null&&!C&&(this.logger.warn(`MPEG-TS PMT found at ${A} after unknown PID '${T}'. Backtracking to sync byte @${V} to parse all TS packets.`),T=null,A=V-188),C=this.pmtParsed=!0;break}case 17:case 8191:break;default:T=R;break}}else G++;G>0&&rD(this.observer,new Error(`Found ${G} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=f,a.pesData=v,l.pesData=E;let H={audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};return r&&this.extractRemainingSamples(H),H}flush(){let{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){let{audioTrack:t,videoTrack:i,id3Track:r,textTrack:s}=e,o=i.pesData,a=t.pesData,l=r.pesData,u;if(o&&(u=zd(o,this.logger))?(this.readyVideoParser(i.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(i,s,u,!0),i.pesData=null)):i.pesData=o,a&&(u=zd(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(u=zd(l,this.logger))?(this.parseID3PES(r,u),r.pesData=null):r.pesData=l}demuxSampleAes(e,t,i){let r=this.demux(e,i,!0,!this.config.progressive),s=this.sampleAes=new JA(this.observer,this.config,t);return this.decrypt(r,s)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new eD:e==="hevc"&&(this.videoParser=new tD))}decrypt(e,t){return new Promise(i=>{let{audioTrack:r,videoTrack:s}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{i(e)}):i(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0,r=this.aacOverFlow,s=t.data;if(r){this.aacOverFlow=null;let f=r.missing,m=r.sample.unit.byteLength;if(f===-1)s=Vr(r.sample.unit,s);else{let y=m-f;r.sample.unit.set(s.subarray(0,f),y),e.samples.push(r.sample),i=r.missing}}let o,a;for(o=i,a=s.length;o<a-1&&!V_(s,o);o++);if(o!==i){let f,m=o<a-1;if(m?f=`AAC PES did not start with ADTS header,offset:${o}`:f="No ADTS header found in AAC PES",rD(this.observer,new Error(f),m,this.logger),!m)return}GU(e,this.observer,s,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(r){let f=zU(e.samplerate);l=r.sample.pts+f}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,d;for(;o<a;)if(d=HU(e,s,o,l,u),o+=d.length,d.missing){this.aacOverFlow=d;break}else for(u++;o<a-1&&!V_(s,o);o++);}parseMPEGPES(e,t){let i=t.data,r=i.length,s=0,o=0,a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<r;)if(QU(i,o)){let l=KU(e,i,o,a,s);if(l)o+=l.length,s++;else break}else o++}parseAC3PES(e,t){{let i=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}let s=i.length,o=0,a=0,l;for(;a<s&&(l=JU(e,i,a,r,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}let i=Wt({},t,{type:this._videoTrack?yr.emsg:yr.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}};function iD(n,e){return((n[e+1]&31)<<8)+n[e+2]}function ute(n,e){return(n[e+10]&31)<<8|n[e+11]}function dte(n,e,t,i,r,s){let o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(n[e+1]&15)<<8|n[e+2],l=e+3+a-4,u=(n[e+10]&15)<<8|n[e+11];for(e+=12+u;e<l;){let d=iD(n,e),f=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!i){gA("ADTS AAC",s);break}case 15:o.audioPid===-1&&(o.audioPid=d);break;case 21:o.id3Pid===-1&&(o.id3Pid=d);break;case 219:if(!i){gA("H.264",s);break}case 27:o.videoPid===-1&&(o.videoPid=d);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=d,o.segmentAudioCodec="mp3");break;case 193:if(!i){gA("AC-3",s);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=d,o.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&f>0){let m=e+5,y=f;for(;y>2;){switch(n[m]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=d,o.segmentAudioCodec="ac3");break}let E=n[m+1]+2;m+=E,y-=E}}break;case 194:case 135:return rD(r,new Error("Unsupported EC-3 in M2TS found"),void 0,s),o;case 36:o.videoPid===-1&&(o.videoPid=d,o.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=f+5}return o}function rD(n,e,t,i){i.warn(`parsing error: ${e.message}`),n.emit(I.ERROR,I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function gA(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function zd(n,e){let t=0,i,r,s,o,a,l=n.data;if(!n||n.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Vr(l[0],l[1]),l.splice(1,1);if(i=l[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(r=(i[4]<<8)+i[5],r&&r>n.size-6)return null;let d=i[7];d&192&&(o=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,d&64?(a=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),s=i[8];let f=s+9;if(n.size<=f)return null;n.size-=f;let m=new Uint8Array(n.size);for(let y=0,v=l.length;y<v;y++){i=l[y];let E=i.byteLength;if(f)if(f>E){f-=E;continue}else i=i.subarray(f),E-=f,f=0;m.set(i,t),t+=E}return r&&(r-=s+3),{data:m,pts:o,dts:a,len:r}}return null}var sD=class{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}},cl=Math.pow(2,32)-1,Hd=(()=>{class n{static init(){n.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let t;for(t in n.types)n.types.hasOwnProperty(t)&&(n.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);let i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);n.HDLR_TYPES={video:i,audio:r};let s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);n.STTS=n.STSC=n.STCO=o,n.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),n.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),n.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),n.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);let a=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);n.FTYP=n.box(n.types.ftyp,a,u,a,l),n.DINF=n.box(n.types.dinf,n.box(n.types.dref,s))}static box(t,...i){let r=8,s=i.length,o=s;for(;s--;)r+=i[s].byteLength;let a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=r&255,a.set(t,4),s=0,r=8;s<o;s++)a.set(i[s],r),r+=i[s].byteLength;return a}static hdlr(t){return n.box(n.types.hdlr,n.HDLR_TYPES[t])}static mdat(t){return n.box(n.types.mdat,t)}static mdhd(t,i){i*=t;let r=Math.floor(i/(cl+1)),s=Math.floor(i%(cl+1));return n.box(n.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(t){return n.box(n.types.mdia,n.mdhd(t.timescale||0,t.duration||0),n.hdlr(t.type),n.minf(t))}static mfhd(t){return n.box(n.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))}static minf(t){return t.type==="audio"?n.box(n.types.minf,n.box(n.types.smhd,n.SMHD),n.DINF,n.stbl(t)):n.box(n.types.minf,n.box(n.types.vmhd,n.VMHD),n.DINF,n.stbl(t))}static moof(t,i,r){return n.box(n.types.moof,n.mfhd(t),n.traf(r,i))}static moov(t){let i=t.length,r=[];for(;i--;)r[i]=n.trak(t[i]);return n.box.apply(null,[n.types.moov,n.mvhd(t[0].timescale||0,t[0].duration||0)].concat(r).concat(n.mvex(t)))}static mvex(t){let i=t.length,r=[];for(;i--;)r[i]=n.trex(t[i]);return n.box.apply(null,[n.types.mvex,...r])}static mvhd(t,i){i*=t;let r=Math.floor(i/(cl+1)),s=Math.floor(i%(cl+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return n.box(n.types.mvhd,o)}static sdtp(t){let i=t.samples||[],r=new Uint8Array(4+i.length),s,o;for(s=0;s<i.length;s++)o=i[s].flags,r[s+4]=o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy;return n.box(n.types.sdtp,r)}static stbl(t){return n.box(n.types.stbl,n.stsd(t),n.box(n.types.stts,n.STTS),n.box(n.types.stsc,n.STSC),n.box(n.types.stsz,n.STSZ),n.box(n.types.stco,n.STCO))}static avc1(t){let i=[],r=[],s,o,a;for(s=0;s<t.sps.length;s++)o=t.sps[s],a=o.byteLength,i.push(a>>>8&255),i.push(a&255),i=i.concat(Array.prototype.slice.call(o));for(s=0;s<t.pps.length;s++)o=t.pps[s],a=o.byteLength,r.push(a>>>8&255),r.push(a&255),r=r.concat(Array.prototype.slice.call(o));let l=n.box(n.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(r))),u=t.width,d=t.height,f=t.pixelRatio[0],m=t.pixelRatio[1];return n.box(n.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,n.box(n.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),n.box(n.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,m>>24,m>>16&255,m>>8&255,m&255])))}static esds(t){let i=t.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...i,6,1,2])}static audioStsd(t){let i=t.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount||0,0,16,0,0,0,0,i>>8&255,i&255,0,0])}static mp4a(t){return n.box(n.types.mp4a,n.audioStsd(t),n.box(n.types.esds,n.esds(t)))}static mp3(t){return n.box(n.types[".mp3"],n.audioStsd(t))}static ac3(t){return n.box(n.types["ac-3"],n.audioStsd(t),n.box(n.types.dac3,t.config))}static stsd(t){let{segmentCodec:i}=t;if(t.type==="audio"){if(i==="aac")return n.box(n.types.stsd,n.STSD,n.mp4a(t));if(i==="ac3"&&t.config)return n.box(n.types.stsd,n.STSD,n.ac3(t));if(i==="mp3"&&t.codec==="mp3")return n.box(n.types.stsd,n.STSD,n.mp3(t))}else if(t.pps&&t.sps){if(i==="avc")return n.box(n.types.stsd,n.STSD,n.avc1(t));if(i==="hevc"&&t.vps)return n.box(n.types.stsd,n.STSD,n.hvc1(t))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${t.type} segment codec (${i}/${t.codec})`)}static tkhd(t){let i=t.id,r=(t.duration||0)*(t.timescale||0),s=t.width||0,o=t.height||0,a=Math.floor(r/(cl+1)),l=Math.floor(r%(cl+1));return n.box(n.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,i&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,l>>24,l>>16&255,l>>8&255,l&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,o>>8&255,o&255,0,0]))}static traf(t,i){let r=n.sdtp(t),s=t.id,o=Math.floor(i/(cl+1)),a=Math.floor(i%(cl+1));return n.box(n.types.traf,n.box(n.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),n.box(n.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255])),n.trun(t,r.length+16+20+8+16+8+8),r)}static trak(t){return t.duration=t.duration||4294967295,n.box(n.types.trak,n.tkhd(t),n.mdia(t))}static trex(t){let i=t.id;return n.box(n.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,i){let r=t.samples||[],s=r.length,o=12+16*s,a=new Uint8Array(o),l,u,d,f,m,y;for(i+=8+o,a.set([t.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255],0),l=0;l<s;l++)u=r[l],d=u.duration,f=u.size,m=u.flags,y=u.cts,a.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&61440,m.degradPrio&15,y>>>24&255,y>>>16&255,y>>>8&255,y&255],12+16*l);return n.box(n.types.trun,a)}static initSegment(t){n.types||n.init();let i=n.moov(t);return Vr(n.FTYP,i)}static hvc1(t){let i=t.params,r=[t.vps,t.sps,t.pps],s=4,o=new Uint8Array([1,i.general_profile_space<<6|(i.general_tier_flag?32:0)|i.general_profile_idc,i.general_profile_compatibility_flags[0],i.general_profile_compatibility_flags[1],i.general_profile_compatibility_flags[2],i.general_profile_compatibility_flags[3],i.general_constraint_indicator_flags[0],i.general_constraint_indicator_flags[1],i.general_constraint_indicator_flags[2],i.general_constraint_indicator_flags[3],i.general_constraint_indicator_flags[4],i.general_constraint_indicator_flags[5],i.general_level_idc,240|i.min_spatial_segmentation_idc>>8,255&i.min_spatial_segmentation_idc,252|i.parallelismType,252|i.chroma_format_idc,248|i.bit_depth_luma_minus8,248|i.bit_depth_chroma_minus8,0,parseInt(i.frame_rate.fps),s-1|i.temporal_id_nested<<2|i.num_temporal_layers<<3|(i.frame_rate.fixed?64:0),r.length]),a=o.length;for(let E=0;E<r.length;E+=1){a+=3;for(let T=0;T<r[E].length;T+=1)a+=2+r[E][T].length}let l=new Uint8Array(a);l.set(o,0),a=o.length;let u=r.length-1;for(let E=0;E<r.length;E+=1){l.set(new Uint8Array([32+E|(E===u?128:0),0,r[E].length]),a),a+=3;for(let T=0;T<r[E].length;T+=1)l.set(new Uint8Array([r[E][T].length>>8,r[E][T].length&255]),a),a+=2,l.set(r[E][T],a),a+=r[E][T].length}let d=n.box(n.types.hvcC,l),f=t.width,m=t.height,y=t.pixelRatio[0],v=t.pixelRatio[1];return n.box(n.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,n.box(n.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),n.box(n.types.pasp,new Uint8Array([y>>24,y>>16&255,y>>8&255,y&255,v>>24,v>>16&255,v>>8&255,v&255])))}}return n.types=void 0,n.HDLR_TYPES=void 0,n.STTS=void 0,n.STSC=void 0,n.STCO=void 0,n.STSZ=void 0,n.VMHD=void 0,n.SMHD=void 0,n.STSD=void 0,n.FTYP=void 0,n.DINF=void 0,n})(),e$=9e4;function a1(n,e,t=1,i=!1){let r=n*e*t;return i?Math.round(r):r}function hte(n,e,t=1,i=!1){return a1(n,e,1/t,i)}function Fp(n,e=!1){return a1(n,1e3,1/e$,e)}function fte(n,e=1){return a1(n,e$,1/e)}function NB(n){let{baseTime:e,timescale:t,trackId:i}=n;return`${e/t} (${e}/${t}) trackId: ${i}`}var pte=10*1e3,mte=1024,gte=1152,yte=1536,qd=null,yA=null;function FB(n,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}var Xd=class extends qi{constructor(e,t,i,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,qd===null){let o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);qd=o?parseInt(o[1]):0}if(yA===null){let s=navigator.userAgent.match(/Safari\/(\d+)/i);yA=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){let t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&NB(t)} > ${e&&NB(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1,i=e[0].pts,r=e.reduce((s,o)=>{let a=o.pts,l=a-s;return l<-4294967296&&(t=!0,a=gr(a,i),l=a-s),l>0?s:a},i);return t&&this.debug("PTS rollover detected"),r}remux(e,t,i,r,s,o,a,l){let u,d,f,m,y,v,E=s,T=s,C=e.pid>-1,D=t.pid>-1,P=t.samples.length,V=e.samples.length>0,G=a&&P>0||P>1;if((!C||V)&&(!D||G)||this.ISGenerated||a){if(this.ISGenerated){var A,x,R,M;let ge=this.videoTrackConfig;(ge&&(t.width!==ge.width||t.height!==ge.height||((A=t.pixelRatio)==null?void 0:A[0])!==((x=ge.pixelRatio)==null?void 0:x[0])||((R=t.pixelRatio)==null?void 0:R[1])!==((M=ge.pixelRatio)==null?void 0:M[1]))||!ge&&G||this.nextAudioTs===null&&V)&&this.resetInitSegment()}this.ISGenerated||(f=this.generateIS(e,t,s,o));let F=this.isVideoContiguous,j=-1,B;if(G&&(j=vte(t.samples),!F&&this.config.forceKeyFrameOnDiscontinuity))if(v=!0,j>0){this.warn(`Dropped ${j} out of ${P} video samples due to a missing keyframe`);let ge=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(j),t.dropped+=j,T+=(t.samples[0].pts-ge)/t.inputTimeScale,B=T}else j===-1&&(this.warn(`No keyframe found out of ${P} video samples`),v=!1);if(this.ISGenerated){if(V&&G){let ge=this.getVideoStartPts(t.samples),q=(gr(e.samples[0].pts,ge)-ge)/t.inputTimeScale;E+=Math.max(0,q),T+=Math.max(0,-q)}if(V){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),f=this.generateIS(e,t,s,o)),d=this.remuxAudio(e,E,this.isAudioContiguous,o,D||G||l===De.AUDIO?T:void 0),G){let ge=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),f=this.generateIS(e,t,s,o)),u=this.remuxVideo(t,T,F,ge)}}else G&&(u=this.remuxVideo(t,T,F,0));u&&(u.firstKeyFrame=j,u.independent=j!==-1,u.firstKeyFramePTS=B)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(y=t$(i,s,this._initPTS,this._initDTS)),r.samples.length&&(m=n$(r,s,this._initPTS))),{audio:d,video:u,initSegment:f,independent:v,text:m,id3:y}}computeInitPts(e,t,i,r){let s=Math.round(i*t),o=gr(e,s);if(o<s+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(s-o)/t} ${r}`);o<s+t;)o+=8589934592;return o-s}generateIS(e,t,i,r){let s=e.samples,o=t.samples,a=this.typeSupported,l={},u=this._initPTS,d=!u||r,f="audio/mp4",m,y,v,E=-1;if(d&&(m=y=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:f,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):Hd.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(E=e.id,v=e.inputTimeScale,!u||v!==u.timescale?m=y=this.computeInitPts(s[0].pts,v,i,"audio"):d=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Hd.initSegment([t]),metadata:{width:t.width,height:t.height}},d)if(E=t.id,v=t.inputTimeScale,!u||v!==u.timescale){let T=this.getVideoStartPts(o),C=gr(o[0].dts,T),D=this.computeInitPts(C,v,i,"video"),P=this.computeInitPts(T,v,i,"video");y=Math.min(y,D),m=Math.min(m,P)}else d=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,d?(u&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${i} ${m/v} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${m/v} (${m}/${v}) trackId: ${E}`),this._initPTS={baseTime:m,timescale:v,trackId:E},this._initDTS={baseTime:y,timescale:v,trackId:E}):m=v=void 0,{tracks:l,initPTS:m,timescale:v,trackId:E}}remuxVideo(e,t,i,r){let s=e.inputTimeScale,o=e.samples,a=[],l=o.length,u=this._initPTS,d=u.baseTime*s/u.timescale,f=this.nextVideoTs,m=8,y=this.videoSampleDuration,v,E,T=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY,D=!1;if(!i||f===null){let oe=d+t*s,ie=o[0].pts-gr(o[0].dts,o[0].pts);qd&&f!==null&&Math.abs(oe-ie-(f+d))<15e3?i=!0:f=oe-ie-d}let P=f+d;for(let oe=0;oe<l;oe++){let ie=o[oe];ie.pts=gr(ie.pts,P),ie.dts=gr(ie.dts,P),ie.dts<o[oe>0?oe-1:oe].dts&&(D=!0)}D&&o.sort(function(oe,ie){let fe=oe.dts-ie.dts,me=oe.pts-ie.pts;return fe||me}),v=o[0].dts,E=o[o.length-1].dts;let V=E-v,G=V?Math.round(V/(l-1)):y||e.inputTimeScale/30;if(i){let oe=v-P,ie=oe>G,fe=oe<-1;if((ie||fe)&&(ie?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Fp(oe,!0)} ms (${oe}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Fp(-oe,!0)} ms (${oe}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!fe||P>=o[0].pts||qd)){v=P;let me=o[0].pts-oe;if(ie)o[0].dts=v,o[0].pts=me;else{let Fe=!0;for(let Ge=0;Ge<o.length&&!(o[Ge].dts>me&&Fe);Ge++){let et=o[Ge].pts;if(o[Ge].dts-=oe,o[Ge].pts-=oe,Ge<o.length-1){let Lt=o[Ge+1].pts,Ot=o[Ge].pts,Xt=Lt<=Ot,Sn=Lt<=et;Fe=Xt==Sn}}}this.log(`Video: Initial PTS/DTS adjusted: ${Fp(me,!0)}/${Fp(v,!0)}, delta: ${Fp(oe,!0)} ms`)}}v=Math.max(0,v);let H=0,A=0,x=v;for(let oe=0;oe<l;oe++){let ie=o[oe],fe=ie.units,me=fe.length,Fe=0;for(let Ge=0;Ge<me;Ge++)Fe+=fe[Ge].data.length;A+=Fe,H+=me,ie.length=Fe,ie.dts<x?(ie.dts=x,x+=G/4|0||1):x=ie.dts,T=Math.min(ie.pts,T),C=Math.max(ie.pts,C)}E=o[l-1].dts;let R=A+4*H+8,M;try{M=new Uint8Array(R)}catch(oe){this.observer.emit(I.ERROR,I.ERROR,{type:Ne.MUX_ERROR,details:Q.REMUX_ALLOC_ERROR,fatal:!1,error:oe,bytes:R,reason:`fail allocating video mdat ${R}`});return}let F=new DataView(M.buffer);F.setUint32(0,R),M.set(Hd.types.mdat,4);let j=!1,B=Number.POSITIVE_INFINITY,ge=Number.POSITIVE_INFINITY,we=Number.NEGATIVE_INFINITY,q=Number.NEGATIVE_INFINITY;for(let oe=0;oe<l;oe++){let ie=o[oe],fe=ie.units,me=0;for(let et=0,Lt=fe.length;et<Lt;et++){let Ot=fe[et],Xt=Ot.data,Sn=Ot.data.byteLength;F.setUint32(m,Sn),m+=4,M.set(Xt,m),m+=Sn,me+=4+Sn}let Fe;if(oe<l-1)y=o[oe+1].dts-ie.dts,Fe=o[oe+1].pts-ie.pts;else{let et=this.config,Lt=oe>0?ie.dts-o[oe-1].dts:G;if(Fe=oe>0?ie.pts-o[oe-1].pts:G,et.stretchShortVideoTrack&&this.nextAudioTs!==null){let Ot=Math.floor(et.maxBufferHole*s),Xt=(r?T+r*s:this.nextAudioTs+d)-ie.pts;Xt>Ot?(y=Xt-Lt,y<0?y=Lt:j=!0,this.log(`It is approximately ${Xt/90} ms to the next segment; using duration ${y/90} ms for the last video frame.`)):y=Lt}else y=Lt}let Ge=Math.round(ie.pts-ie.dts);B=Math.min(B,y),we=Math.max(we,y),ge=Math.min(ge,Fe),q=Math.max(q,Fe),a.push(FB(ie.key,y,me,Ge))}if(a.length){if(qd){if(qd<70){let oe=a[0].flags;oe.dependsOn=2,oe.isNonSync=0}}else if(yA&&q-ge<we-B&&G/we<.025&&a[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let oe=v;for(let ie=0,fe=a.length;ie<fe;ie++){let me=oe+a[ie].duration,Fe=oe+a[ie].cts;if(ie<fe-1){let Ge=me+a[ie+1].cts;a[ie].duration=Ge-Fe}else a[ie].duration=ie?a[ie-1].duration:G;a[ie].cts=0,oe=me}}}y=j||!y?G:y;let te=E+y;this.nextVideoTs=f=te-d,this.videoSampleDuration=y,this.isVideoContiguous=!0;let Ee={data1:Hd.moof(e.sequenceNumber++,v,Wt(e,{samples:a})),data2:M,startPTS:(T-d)/s,endPTS:(C+y-d)/s,startDTS:(v-d)/s,endDTS:f/s,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Ee}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return gte;case"ac3":return yte;default:return mte}}remuxAudio(e,t,i,r,s){let o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,u=this.getSamplesPerFrame(e),d=u*l,f=this._initPTS,m=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,y=[],v=s!==void 0,E=e.samples,T=m?0:8,C=this.nextAudioTs||-1,D=f.baseTime*o/f.timescale,P=D+t*o;if(this.isAudioContiguous=i=i||E.length&&C>0&&(r&&Math.abs(P-(C+D))<9e3||Math.abs(gr(E[0].pts,P)-(C+D))<20*d),E.forEach(function(q){q.pts=gr(q.pts,P)}),!i||C<0){let q=E.length;if(E=E.filter(te=>te.pts>=0),q!==E.length&&this.warn(`Removed ${E.length-q} of ${q} samples (initPTS ${D} / ${o})`),!E.length)return;s===0?C=0:r&&!v?C=Math.max(0,P-D):C=E[0].pts-D}if(e.segmentCodec==="aac"){let q=this.config.maxAudioFramesDrift;for(let te=0,K=C+D;te<E.length;te++){let ne=E[te],Ee=ne.pts,oe=Ee-K,ie=Math.abs(1e3*oe/o);if(oe<=-q*d&&v)te===0&&(this.warn(`Audio frame @ ${(Ee/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*oe/o)} ms.`),this.nextAudioTs=C=Ee-D,K=Ee);else if(oe>=q*d&&ie<pte&&v){let fe=Math.round(oe/d);for(K=Ee-fe*d;K<0&&fe&&d;)fe--,K+=d;te===0&&(this.nextAudioTs=C=K-D),this.warn(`Injecting ${fe} audio frames @ ${((K-D)/o).toFixed(3)}s due to ${Math.round(1e3*oe/o)} ms gap.`);for(let me=0;me<fe;me++){let Fe=sD.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Fe||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Fe=ne.unit.subarray()),E.splice(te,0,{unit:Fe,pts:K}),K+=d,te++}}ne.pts=K,K+=d}}let V=null,G=null,H,A=0,x=E.length;for(;x--;)A+=E[x].unit.byteLength;for(let q=0,te=E.length;q<te;q++){let K=E[q],ne=K.unit,Ee=K.pts;if(G!==null){let ie=y[q-1];ie.duration=Math.round((Ee-G)/l)}else if(i&&e.segmentCodec==="aac"&&(Ee=C+D),V=Ee,A>0){A+=T;try{H=new Uint8Array(A)}catch(ie){this.observer.emit(I.ERROR,I.ERROR,{type:Ne.MUX_ERROR,details:Q.REMUX_ALLOC_ERROR,fatal:!1,error:ie,bytes:A,reason:`fail allocating audio mdat ${A}`});return}m||(new DataView(H.buffer).setUint32(0,A),H.set(Hd.types.mdat,4))}else return;H.set(ne,T);let oe=ne.byteLength;T+=oe,y.push(FB(!0,u,oe,0)),G=Ee}let R=y.length;if(!R)return;let M=y[y.length-1];C=G-D,this.nextAudioTs=C+l*M.duration;let F=m?new Uint8Array(0):Hd.moof(e.sequenceNumber++,V/l,Wt({},e,{samples:y}));e.samples=[];let j=(V-D)/o,B=this.nextAudioTs/o,we={data1:F,data2:H,startPTS:j,endPTS:B,startDTS:j,endDTS:B,type:"audio",hasAudio:!0,hasVideo:!1,nb:R};return this.isAudioContiguous=!0,we}};function gr(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function vte(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function t$(n,e,t,i){let r=n.samples.length;if(!r)return;let s=n.inputTimeScale;for(let a=0;a<r;a++){let l=n.samples[a];l.pts=gr(l.pts-t.baseTime*s/t.timescale,e*s)/s,l.dts=gr(l.dts-i.baseTime*s/i.timescale,e*s)/s}let o=n.samples;return n.samples=[],{samples:o}}function n$(n,e,t){let i=n.samples.length;if(!i)return;let r=n.inputTimeScale;for(let o=0;o<i;o++){let a=n.samples[o];a.pts=gr(a.pts-t.baseTime*r/t.timescale,e*r)/r}n.samples.sort((o,a)=>o.pts-a.pts);let s=n.samples;return n.samples=[],{samples:s}}var oD=class extends qi{constructor(e,t,i,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;let t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,i,r){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:i,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}let{audio:s,video:o}=this.initData=hU(e);if(t)wJ(e,t);else{let l=s||o;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}s&&(i=VB(s,Qt.AUDIO,this)),o&&(r=VB(o,Qt.VIDEO,this));let a={};s&&o?a.audiovideo={container:"video/mp4",codec:i+","+r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:s?a.audio={container:"audio/mp4",codec:i,encrypted:s.encrypted,initSegment:e,id:"audio"}:o?a.video={container:"video/mp4",codec:r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,i,r,s,o){var a,l;let{initPTS:u,lastEndTime:d}=this,f={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};Ie(d)||(d=this.lastEndTime=s||0);let m=t.samples;if(!m.length)return f;let y={initPTS:void 0,timescale:void 0,trackId:void 0},v=this.initData;if((a=v)!=null&&a.length||(this.generateInitSegment(m),v=this.initData),!((l=v)!=null&&l.length))return this.warn("Failed to generate initSegment."),f;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1);let E=IJ(m,v,this),T=v.audio?E[v.audio.id]:null,C=v.video?E[v.video.id]:null,D=c_(C,1/0),P=c_(T,1/0),V=c_(C,0,!0),G=c_(T,0,!0),H=s,A=0,x=T&&(!C||!u&&P<D||u&&u.trackId===v.audio.id),R=x?T:C;if(R){let K=R.timescale,ne=R.start-s*K,Ee=x?v.audio.id:v.video.id;H=R.start/K,A=x?G-P:V-D,(o||!u)&&(_te(u,H,s,A)||K!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${s} ${ne/K} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${H-s} (${ne}/${K}) trackId: ${Ee}`),u=null,y.initPTS=ne,y.timescale=K,y.trackId=Ee)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);u?(y.initPTS=u.baseTime,y.timescale=u.timescale,y.trackId=u.trackId):((!y.timescale||y.trackId===void 0||y.initPTS===void 0)&&(this.warn("Could not set initPTS"),y.initPTS=H,y.timescale=1,y.trackId=-1),this.initPTS=u={baseTime:y.initPTS,timescale:y.timescale,trackId:y.trackId});let M=H-u.baseTime/u.timescale,F=M+A;A>0?this.lastEndTime=F:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());let j=!!v.audio,B=!!v.video,ge="";j&&(ge+="audio"),B&&(ge+="video");let we=(v.audio?v.audio.encrypted:!1)||(v.video?v.video.encrypted:!1),q={data1:m,startPTS:M,startDTS:M,endPTS:F,endDTS:F,type:ge,hasAudio:j,hasVideo:B,nb:1,dropped:0,encrypted:we};f.audio=j&&!B?q:void 0,f.video=B?q:void 0;let te=C?.sampleCount;if(te){let K=C.keyFrameIndex,ne=K!==-1;q.nb=te,q.dropped=K===0||this.isVideoContiguous?0:ne?K:te,q.independent=ne,q.firstKeyFrame=K,ne&&C.keyFrameStart&&(q.firstKeyFramePTS=(C.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(f.independent=ne),this.isVideoContiguous||(this.isVideoContiguous=ne),q.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${K}/${te} dropped: ${q.dropped} start: ${q.firstKeyFramePTS||"NA"}`)}return f.initSegment=y,f.id3=t$(i,s,u,u),r.samples.length&&(f.text=n$(r,s,u)),f}};function c_(n,e,t=!1){return n?.start!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function _te(n,e,t,i){if(n===null)return!0;let r=Math.max(i,1),s=e-n.baseTime/n.timescale;return Math.abs(s-t)>r}function VB(n,e,t){let i=n.codec;return i&&i.length>4?i:e===Qt.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?C_(i,!1):(t.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(t.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}var Jo;try{Jo=self.performance.now.bind(self.performance)}catch{Jo=Date.now}var E_=[{demux:XA,remux:oD},{demux:nD,remux:Xd},{demux:YA,remux:Xd},{demux:ZA,remux:Xd}];E_.splice(2,0,{demux:QA,remux:Xd});var U_=class{constructor(e,t,i,r,s,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=s,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,r){let s=i.transmuxing;s.executeStart=Jo();let o=new Uint8Array(e),{currentTransmuxState:a,transmuxConfig:l}=this;r&&(this.currentTransmuxState=r);let{contiguous:u,discontinuity:d,trackSwitch:f,accurateTimeOffset:m,timeOffset:y,initSegmentChange:v}=r||a,{audioCodec:E,videoCodec:T,defaultInitPts:C,duration:D,initSegmentData:P}=l,V=Ete(o,t);if(V&&Zd(V.method)){let x=this.getDecrypter(),R=e1(V.method);if(x.isSync()){let M=x.softwareDecrypt(o,V.key.buffer,V.iv.buffer,R);if(i.part>-1){let j=x.flush();M=j&&j.buffer}if(!M)return s.executeEnd=Jo(),vA(i);o=new Uint8Array(M)}else return this.asyncResult=!0,this.decryptionPromise=x.webCryptoDecrypt(o,V.key.buffer,V.iv.buffer,R).then(M=>{let F=this.push(M,null,i);return this.decryptionPromise=null,F}),this.decryptionPromise}let G=this.needsProbing(d,f);if(G){let x=this.configureTransmuxer(o);if(x)return this.logger.warn(`[transmuxer] ${x.message}`),this.observer.emit(I.ERROR,I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,error:x,reason:x.message}),s.executeEnd=Jo(),vA(i)}(d||f||v||G)&&this.resetInitSegment(P,E,T,D,t),(d||v||G)&&this.resetInitialTimestamp(C),u||this.resetContiguity();let H=this.transmux(o,V,y,m,i);this.asyncResult=Xp(H);let A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,s.executeEnd=Jo(),H}flush(e){let t=e.transmuxing;t.executeStart=Jo();let{decrypter:i,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));let o=[],{timeOffset:a}=r;if(i){let f=i.flush();f&&o.push(this.push(f.buffer,null,e))}let{demuxer:l,remuxer:u}=this;if(!l||!u){t.executeEnd=Jo();let f=[vA(e)];return this.asyncResult?Promise.resolve(f):f}let d=l.flush(a);return Xp(d)?(this.asyncResult=!0,d.then(f=>(this.flushRemux(o,f,e),o))):(this.flushRemux(o,d,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,i){let{audioTrack:r,videoTrack:s,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===De.MAIN?"level":"track"} ${i.level}`);let d=this.remuxer.remux(r,s,o,a,u,l,!0,this.id);e.push({remuxResult:d,chunkMeta:i}),i.transmuxing.executeEnd=Jo()}resetInitialTimestamp(e){let{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){let{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,r,s){let{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,i,r),a.resetInitSegment(e,t,i,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,r,s){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,i,r,s):o=this.transmuxUnencrypted(e,i,r,s),o}transmuxUnencrypted(e,t,i,r){let{audioTrack:s,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,o,a,l,t,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,i,r,s){return this.demuxer.demuxSampleAes(e,t,i).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,i,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){let{config:t,observer:i,typeSupported:r}=this,s;for(let f=0,m=E_.length;f<m;f++){var o;if((o=E_[f].demux)!=null&&o.probe(e,this.logger)){s=E_[f];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");let a=this.demuxer,l=this.remuxer,u=s.remux,d=s.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(i,t,r,this.logger)),(!a||!(a instanceof d))&&(this.demuxer=new d(i,t,r,this.logger),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new qp(this.config)),e}};function Ete(n,e){let t=null;return n.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}var vA=n=>({remuxResult:{},chunkMeta:n});function Xp(n){return"then"in n&&n.then instanceof Function}var aD=class{constructor(e,t,i,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=r,this.defaultInitPts=s||null}},lD=class{constructor(e,t,i,r,s,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=o}},BB=0,$_=class{constructor(e,t,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=BB++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{let u=l.data,d=this.hls;if(!(!d||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var f;let m=(f=this.workerContext)==null?void 0:f.objectURL;m&&self.URL.revokeObjectURL(m);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{d.logger[u.data.logType]&&d.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,d.trigger(u.event,u.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;let u=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(I.ERROR,{type:Ne.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};let s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;let o=(l,u)=>{u=u||{},u.frag=this.frag||void 0,l===I.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(l,u)};this.observer=new n1,this.observer.on(I.FRAG_DECRYPTED,o),this.observer.on(I.ERROR,o);let a=nB(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){let l=this.hls.logger;if(s.workerPath||Oee()){try{s.workerPath?(l.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=Fee(s.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=Nee());let{worker:d}=this.workerContext;d.addEventListener("message",this.onWorkerMessage),d.addEventListener("error",this.onWorkerError),d.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:Zt(s)})}catch(d){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,d),this.terminateWorker(),this.error=null,this.transmuxer=new U_(this.observer,a,s,"",t,e.logger)}return}}this.transmuxer=new U_(this.observer,a,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){let e=this.instanceNo;this.instanceNo=BB++;let t=this.hls.config,i=nB(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:Zt(t)})}}terminateWorker(){if(this.workerContext){let{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Vee(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{let t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}let e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,r,s,o,a,l,u,d){var f,m;u.transmuxing.start=self.performance.now();let{instanceNo:y,transmuxer:v}=this,E=o?o.start:s.start,T=s.decryptdata,C=this.frag,D=!(C&&s.cc===C.cc),P=!(C&&u.level===C.level),V=C?u.sn-C.sn:-1,G=this.part?u.part-this.part.index:-1,H=V===0&&u.id>1&&u.id===C?.stats.chunkCount,A=!P&&(V===1||V===0&&(G===1||H&&G<=0)),x=self.performance.now();(P||V||s.stats.parsing.start===0)&&(s.stats.parsing.start=x),o&&(G||!A)&&(o.stats.parsing.start=x);let R=!(C&&((f=s.initSegment)==null?void 0:f.url)===((m=C.initSegment)==null?void 0:m.url)),M=new lD(D,A,l,P,E,R);if(!A||D||R){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===De.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${D}
        trackSwitch: ${P}
        contiguous: ${A}
        accurateTimeOffset: ${l}
        timeOffset: ${E}
        initSegmentChange: ${R}`);let F=new aD(i,r,t,a,d);this.configureTransmuxer(F)}if(this.frag=s,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:y,cmd:"demux",data:e,decryptdata:T,chunkMeta:u,state:M},e instanceof ArrayBuffer?[e]:[]);else if(v){let F=v.push(e,T,u,M);Xp(F)?F.then(j=>{this.handleTransmuxComplete(j)}).catch(j=>{this.transmuxerError(j,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(F)}}flush(e){e.transmuxing.start=self.performance.now();let{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){let r=i.flush(e);Xp(r)?r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){let{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}},UB=100,cD=class extends Kp{constructor(e,t,i){super(e,t,i,"audio-stream-controller",De.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();let{hls:e}=this;e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(I.BUFFER_RESET,this.onBufferReset,this),e.on(I.BUFFER_CREATED,this.onBufferCreated,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(I.FRAG_LOADING,this.onFragLoading,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){let{hls:e}=this;e&&(super.unregisterListeners(),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(I.BUFFER_RESET,this.onBufferReset,this),e.off(I.BUFFER_CREATED,this.onBufferCreated,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(I.FRAG_LOADING,this.onFragLoading,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s,trackId:o}){if(i===De.MAIN){let a=t.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:r,timescale:s,trackId:o},this.log(`InitPTS for cc: ${a} found from main: ${r/s} (${r}/${s}) trackId: ${o}`),this.mainAnchor=t,this.state===re.WAITING_INIT_PTS){let u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==a)&&this.syncWithAnchor(t,u?.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===re.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var i;let r=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(t&&r?.cc===t.cc)return;let s=(r||e).cc,o=this.getLevelDetails(),a=this.getLoadPosition(),l=bU(o,s,a);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===re.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=re.STOPPED;return}let i=this.lastCurrentTime;this.stopLoad(),this.setInterval(UB),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=re.IDLE):this.state=re.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case re.IDLE:this.doTickIdle();break;case re.WAITING_TRACK:{let{levels:e,trackId:t}=this,i=e?.[t],r=i?.details;if(r&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(r))break;this.state=re.WAITING_INIT_PTS}break}case re.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case re.WAITING_INIT_PTS:{let e=this.waitingData;if(e){let{frag:t,part:i,cache:r,complete:s}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=re.FRAG_LOADING;let a=r.flush().buffer,l={frag:t,part:i,payload:a,networkDetails:null};this._handleFragmentLoadProgress(l),s&&super._handleFragmentLoadComplete(l)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=re.IDLE}}this.onTickEnd()}resetLoadingState(){let e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){let{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;let{hls:t,levels:i,media:r,trackId:s}=this,o=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(i!=null&&i[s]))return;let a=i[s],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=re.WAITING_TRACK,this.startFragRequested=!1;return}let u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,Qt.AUDIO,De.AUDIO));let d=this.getFwdBufferInfo(u,De.AUDIO);if(d===null)return;if(!this.switchingTrack&&this._streamEnded(d,l)){t.trigger(I.BUFFER_EOS,{type:"audio"}),this.state=re.ENDED;return}let f=d.len,m=t.maxBufferLength,y=l.fragments,v=y[0].start,E=this.getLoadPosition(),T=this.flushing?E:d.end;if(this.switchingTrack&&r){let P=E;l.PTSKnown&&P<v&&(d.end>v||d.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=v+.05)}if(f>=m&&!this.switchingTrack&&T<y[y.length-1].start)return;let C=this.getNextFragment(T,l);if(C&&this.isLoopLoading(C,T)&&(C=this.getNextFragmentLoopLoading(C,l,d,De.MAIN,m)),!C){this.bufferFlushed=!0;return}let D=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&D&&In(C)&&!C.endList&&(!l.live||!this.loadingParts&&T<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(D)===$n.OK&&(this.mainFragLoading=D=null),D&&In(D))){if(C.start>D.end){let V=this.fragmentTracker.getFragAtPos(T,De.MAIN);V&&V.end>D.end&&(D=V,this.mainFragLoading={frag:V,targetBufferTime:null})}if(C.start>D.end)return}this.loadFragment(C,a,T)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new jc(i))}onAudioTrackSwitching(e,t){let i=!!t.url;this.trackId=t.id;let{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==re.STOPPED&&(this.setInterval(UB),this.state=re.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;let i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(I.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;let{levels:r}=this,{details:s,id:o,groupId:a,track:l}=t;if(!r){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}let u=this.mainDetails;if(!u||s.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==re.STOPPED&&(this.state=re.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);let d=r[o],f=0;if(s.live||(i=d.details)!=null&&i.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(d.details){var m;f=this.alignPlaylists(s,d.details,(m=this.levelLastLoaded)==null?void 0:m.details)}s.alignedSliding||(BU(s,u),s.alignedSliding||N_(s,u),f=s.fragmentStart)}d.details=s,this.levelLastLoaded=d,this.startFragRequested||this.setStartPosition(u,f),this.hls.trigger(I.AUDIO_TRACK_UPDATED,{details:s,id:o,groupId:t.groupId}),this.state===re.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=re.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;let i=e.frag,{part:r,payload:s}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}let u=l[a];if(!u){this.warn("Audio track is undefined on fragment load progress");return}let d=u.details;if(!d){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}let f=o.defaultAudioCodec||u.audioCodec||"mp4a.40.2",m=this.transmuxer;m||(m=this.transmuxer=new $_(this.hls,De.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));let y=this.initPTS[i.cc],v=(t=i.initSegment)==null?void 0:t.data;if(y!==void 0){let T=r?r.index:-1,C=T!==-1,D=new Wp(i.level,i.sn,i.stats.chunkCount,s.byteLength,T,C);m.push(s,v,f,"",i,r,d.totalduration,!1,D,y)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${d.startSN} ,${d.endSN}],track ${a}`);let{cache:E}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new F_,complete:!1};E.push(new Uint8Array(s)),this.state!==re.STOPPED&&(this.state=re.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;let i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===De.MAIN&&In(t.frag)&&(this.mainFragLoading=t,this.state===re.IDLE&&this.tick())}onFragBuffered(e,t){let{frag:i,part:r}=t;if(i.type!==De.AUDIO){!this.audioOnly&&i.type===De.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(In(i)){this.fragPrevious=i;let s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(I.AUDIO_TRACK_SWITCHED,zt({},s)))}this.fragBufferedComplete(i,r),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=re.ERROR;return}switch(t.details){case Q.FRAG_GAP:case Q.FRAG_PARSING_ERROR:case Q.FRAG_DECRYPT_ERROR:case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(De.AUDIO,t);break;case Q.AUDIO_TRACK_LOAD_ERROR:case Q.AUDIO_TRACK_LOAD_TIMEOUT:case Q.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===re.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===mt.AUDIO_TRACK&&(this.state=re.IDLE);break;case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Q.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Q.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Qt.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Qt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===re.ENDED&&(this.state=re.IDLE);let i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,De.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;let i="audio",{hls:r}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}let{frag:l,part:u,level:d}=a,{details:f}=d,{audio:m,text:y,id3:v,initSegment:E}=s;if(this.fragContextChanged(l)||!f){this.fragmentTracker.removeFragment(l);return}if(this.state=re.PARSING,this.switchingTrack&&m&&this.completeAudioSwitch(this.switchingTrack),E!=null&&E.tracks){let T=l.initSegment||l;if(this.unhandledEncryptionError(E,l))return;this._bufferInitSegment(d,E.tracks,T,o),r.trigger(I.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:i,tracks:E.tracks})}if(m){let{startPTS:T,endPTS:C,startDTS:D,endDTS:P}=m;u&&(u.elementaryStreams[Qt.AUDIO]={startPTS:T,endPTS:C,startDTS:D,endDTS:P}),l.setElementaryStreamInfo(Qt.AUDIO,T,C,D,P),this.bufferFragmentData(m,l,u,o)}if(v!=null&&(t=v.samples)!=null&&t.length){let T=Wt({id:i,frag:l,details:f},v);r.trigger(I.FRAG_PARSING_METADATA,T)}if(y){let T=Wt({id:i,frag:l,details:f},y);r.trigger(I.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,i,r){if(this.state!==re.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;let s=t.audio;s.id=De.AUDIO;let o=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${o}/${s.codec}]`),o&&o.split(",").length===1&&(s.levelCodec=o),this.hls.trigger(I.BUFFER_CODECS,t);let a=s.initSegment;if(a!=null&&a.byteLength){let l={type:"audio",frag:i,part:null,chunkMeta:r,parent:i.type,data:a};this.hls.trigger(I.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,i){let r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===$n.NOT_LOADED||r===$n.PARTIAL){var s;if(!In(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=re.WAITING_INIT_PTS;let o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&N_(t.details,o)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){let{name:t,lang:i,assocLang:r,characteristics:s,audioCodec:o,channels:a}=this.bufferedTrack;Uc({name:t,lang:i,assocLang:r,characteristics:s,audioCodec:o,channels:a},e,Vc)||(D_(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){let{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(I.AUDIO_TRACK_SWITCHED,zt({},e))}},Jp=class extends qi{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){let r=t?.renditionReports;if(r){let s=-1;for(let o=0;o<r.length;o++){let a=r[o],l;try{l=new self.URL(a.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),l=a.URI||""}if(l===e){s=o;break}else l===e.substring(0,l.length)&&(s=o)}if(s!==-1){let o=r[s],a=parseInt(o["LAST-MSN"])||t.lastPartSn,l=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){let d=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&d>t.partTarget&&(l+=1)}let u=i&&iB(i);return new A_(a,l>=0?l:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){let{details:r,stats:s}=t,o=self.performance.now(),a=s.loading.first?Math.max(0,o-s.loading.first):0;r.advancedDateTime=Date.now()-a;let l=this.hls.config.timelineOffset;if(l!==r.appliedTimelineOffset){let d=Math.max(l||0,0);r.appliedTimelineOffset=d,r.fragments.forEach(f=>{f.setStart(f.playlistOffset+d)})}if(r.live||i!=null&&i.live){let d="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(i),i&&r.fragments.length>0){Iee(i,r,this);let D=r.playlistParsingError;if(D){this.warn(D);let P=this.hls;if(!P.config.ignorePlaylistParsingErrors){var u;let{networkDetails:V}=t;P.trigger(I.ERROR,{type:Ne.NETWORK_ERROR,details:Q.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:D,reason:D.message,level:t.level||void 0,parent:(u=r.fragments[0])==null?void 0:u.type,networkDetails:V,stats:s});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=s.loading.start);let f=this.hls.mainForwardBufferInfo,m=f?f.end-f.len:0,y=(r.edge-m)*1e3,v=LU(r,y);if(r.requestScheduled+v<o?r.requestScheduled=o:r.requestScheduled+=v,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let E,T,C;if(r.canBlockReload&&r.endSN&&r.advanced){let D=this.hls.config.lowLatencyMode,P=r.lastPartSn,V=r.endSN,G=r.lastPartIndex,H=G!==-1,A=P===V;H?A?(T=V+1,C=D?0:G):(T=P,C=D?G+1:r.maxPartIndex):T=V+1;let x=r.age,R=x+r.ageHeader,M=Math.min(R-r.partTarget,r.targetduration*1.5);if(M>0){if(R>r.targetduration*3)this.log(`Playlist last advanced ${x.toFixed(2)}s ago. Omitting segment and part directives.`),T=void 0,C=void 0;else if(i!=null&&i.tuneInGoal&&R-r.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${M} with playlist age: ${r.age}`),M=0;else{let F=Math.floor(M/r.targetduration);if(T+=F,C!==void 0){let j=Math.round(M%r.targetduration/r.partTarget);C+=j}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${x.toFixed(2)}s goal: ${M} skip sn ${F} to part ${C}`)}r.tuneInGoal=M}if(E=this.getDeliveryDirectives(r,t.deliveryDirectives,T,C),D||!A){r.requestScheduled=o,this.loadingPlaylist(d,E);return}}else(r.canBlockReload||r.canSkipUntil)&&(E=this.getDeliveryDirectives(r,t.deliveryDirectives,T,C));E&&T!==void 0&&r.canBlockReload&&(r.requestScheduled=s.loading.first+Math.max(v-a*2,v/2)),this.scheduleLoading(d,E,r)}else this.clearTimer()}scheduleLoading(e,t,i){let r=i||e.details;if(!r){this.loadingPlaylist(e,t);return}let s=self.performance.now(),o=r.requestScheduled;if(s>=o){this.loadingPlaylist(e,t);return}let a=o-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,i,r){let s=iB(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,r=t.part,s=v_.No),new A_(i,r,s)}checkRetry(e){let t=e.details,i=P_(e),r=e.errorAction,{action:s,retryCount:o=0,retryConfig:a}=r||{},l=!!r&&!!a&&(s===Qn.RetryRequest||!r.resolved&&s===Qn.SendAlternateToPenaltyBox);if(l){var u;if(o>=a.maxNumRetry)return!1;if(i&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{let d=JD(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),d),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${d}ms`)}e.levelRetry=!0,r.resolved=!0}return l}};function i$(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!em(n[t].attrs,e[t].attrs))return!1;return!0}function em(n,e,t){let i=n["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>n[r]!==e[r])}function uD(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}var dD=class extends Jp{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){let{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(I.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){let{id:i,groupId:r,details:s}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==r){this.warn(`Audio track with id:${i} and group:${r} not found in active group ${o?.groupId}`);return}let a=o.details;o.details=t.details,this.log(`Audio track ${i} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!t)return;let i=t.audioGroups||null,r=this.groupIds,s=this.currentTrack;if(!i||r?.length!==i?.length||i!=null&&i.some(a=>r?.indexOf(a)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;let a=this.tracks.filter(m=>!i||i.indexOf(m.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(m=>m.default)&&(this.selectDefaultTrack=!1),a.forEach((m,y)=>{m.id=y});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;let l=this.hls.config.audioPreference;if(!s&&l){let m=eo(l,a,Vc);if(m>-1)s=a[m];else{let y=eo(l,this.tracks);s=this.tracks[y]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));let d={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${i?.join(",")}`),this.hls.trigger(I.AUDIO_TRACKS_UPDATED,d);let f=this.trackId;if(u!==-1&&f===-1)this.setAudioTrack(u);else if(a.length&&f===-1){var o;let m=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(m.message),this.hls.trigger(I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:m})}}}onError(e,t){t.fatal||!t.context||t.context.type===mt.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){let t=this.hls;if(t.config.audioPreference=e,e){let i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){let r=this.currentTrack;if(r&&Uc(e,r,Vc))return r;let s=eo(e,this.tracksInGroup,Vc);if(s>-1){let o=this.tracksInGroup[s];return this.setAudioTrack(s),o}else if(r){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);let a=JJ(e,t.levels,i,o,Vc);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){let o=eo(e,i);if(o>-1)return i[o]}}}return null}setAudioTrack(e){let t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;let i=this.currentTrack,r=t[e],s=r.details&&!r.details.live;if(e===this.trackId&&r===i&&s||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(I.AUDIO_TRACK_SWITCHING,zt({},r)),s))return;let o=this.switchParams(r.url,i?.details,r.details);this.loadPlaylist(o)}findTrackId(e){let t=this.tracksInGroup;for(let i=0;i<t.length;i++){let r=t[i];if(!(this.selectDefaultTrack&&!r.default)&&(!e||Uc(e,r,Vc)))return i}if(e){let{name:i,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l}=e;for(let u=0;u<t.length;u++){let d=t[u];if(Uc({name:i,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l},d,Vc))return u}for(let u=0;u<t.length;u++){let d=t[u];if(em(e.attrs,d.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){let d=t[u];if(em(e.attrs,d.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();let t=this.currentTrack;this.shouldLoadPlaylist(t)&&D_(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);let i=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),o=e.details,a=o?.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(I.AUDIO_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:t||null,track:e})}},hD=class{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;let r=this.queues[t];r.push(e),r.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{let i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){let i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;let i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;let t=this.queues[e];if(t.length){let r=t[0];try{r.execute()}catch(s){var i;if(r.onError(s),this.queues===null||this.tracks===null)return;let o=(i=this.tracks[e])==null?void 0:i.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){let{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;let i=(t=this.tracks)==null?void 0:t[e],r=i?.buffer;return r?`SourceBuffer${r.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}},$B=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,r$="HlsJsTrackRemovedError",fD=class extends Error{constructor(e){super(e),this.name=r$}},pD=class extends qi{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{let{media:r,mediaSource:s}=this;i&&this.log("Media source opened"),!(!r||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(I.MEDIA_ATTACHED,{media:r,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{let{mediaSrc:i,_objectUrl:r}=this;i!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=fJ(fl(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){let{hls:e}=this;e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.BUFFER_RESET,this.onBufferReset,this),e.on(I.BUFFER_APPENDING,this.onBufferAppending,this),e.on(I.BUFFER_CODECS,this.onBufferCodecs,this),e.on(I.BUFFER_EOS,this.onBufferEos,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.FRAG_PARSED,this.onFragParsed,this),e.on(I.FRAG_CHANGED,this.onFragChanged,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.BUFFER_RESET,this.onBufferReset,this),e.off(I.BUFFER_APPENDING,this.onBufferAppending,this),e.off(I.BUFFER_CODECS,this.onBufferCodecs,this),e.off(I.BUFFER_EOS,this.onBufferEos,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.FRAG_PARSED,this.onFragParsed,this),e.off(I.FRAG_CHANGED,this.onFragChanged,this),e.off(I.ERROR,this.onError,this)}transferMedia(){let{media:e,mediaSource:t}=this;if(!e)return null;let i={};if(this.operationQueue){let s=this.isUpdating();s||this.operationQueue.removeBlockers();let o=this.isQueued();(s||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}let r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?Wt(i,r.tracks):this.sourceBuffers.forEach(s=>{let[o]=s;o&&(i[o]=Wt({},this.tracks[o]),this.removeBuffer(o)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){let e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){let i=this.media=t.media;this.transferData=this.overrides=void 0;let r=fl(this.appendSource);if(r){let s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);let o=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(o),s)this._objectUrl=i.src,this.attachTransferred();else{let a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{i.removeAttribute("src");let l=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||l&&o instanceof l,jB(i),Tte(i,a),i.load()}catch{i.src=a}else i.src=a}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){let e=this.media,t=this.transferData;if(!t||!e)return;let i=this.tracks,r=t.tracks,s=r?Object.keys(r):null,o=s?s.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&s&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Zt(i,(l,u)=>l==="initSegment"?void 0:u)};
transfer tracks: ${Zt(r,(l,u)=>l==="initSegment"?void 0:u)}}`),!oU(r,i)){t.mediaSource=null,t.tracks=void 0;let l=e.currentTime,u=this.details,d=Math.max(l,u?.fragments[0].start||0);if(d-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${d}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(i)}") start time: ${d} currentTime: ${l}`),this.onMediaDetaching(I.MEDIA_DETACHING,{}),this.onMediaAttaching(I.MEDIA_ATTACHING,t),e.currentTime=d;return}this.transferData=void 0,s.forEach(l=>{let u=l,d=r[u];if(d){let f=d.buffer;if(f){let m=this.fragmentTracker,y=d.id;if(m.hasFragments(y)||m.hasParts(y)){let T=lt.getBuffered(f);m.detectEvictedFragments(u,T,y,null,!0)}let v=_A(u),E=[u,f];this.sourceBuffers[v]=E,f.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,d)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;let t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){let i=!!t.transferMedia;this.transferData=this.overrides=void 0;let{media:r,mediaSource:s,_objectUrl:o}=this;if(s){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){let a=s.readyState==="open";try{let l=s.sourceBuffers;for(let u=l.length;u--;)a&&l[u].abort(),s.removeSourceBuffer(l[u]);a&&s.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),i||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(r.removeAttribute("src"),this.appendSource&&jB(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(I.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;let i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[_A(e)]=[null,null];let t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new hD(this.tracks)}onBufferCodecs(e,t){var i;let r=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);let o="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),a=!o&&this.sourceBufferCount&&this.media&&s.some(l=>!r[l]);if(o||a){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${s}" SourceBuffers`);return}s.forEach(l=>{var u,d;let f=t[l],{id:m,codec:y,levelCodec:v,container:E,metadata:T,supplemental:C}=f,D=r[l],P=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[l],V=P!=null&&P.buffer?P:D,G=V?.pendingCodec||V?.codec,H=V?.levelCodec;D||(D=r[l]={buffer:void 0,listeners:[],codec:y,supplemental:C,container:E,levelCodec:v,metadata:T,id:m});let A=y_(G,H),x=A?.replace($B,"$1"),R=y_(y,v),M=(d=R)==null?void 0:d.replace($B,"$1");R&&A&&x!==M&&(l.slice(0,5)==="audio"&&(R=C_(R,this.appendSource)),this.log(`switching codec ${G} to ${R}`),R!==(D.pendingCodec||D.codec)&&(D.pendingCodec=R),D.container=E,this.appendChangeType(l,E,R))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((i=t.audio)==null?void 0:i.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{let i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){let r=`${t};codecs=${i}`,s={label:`change-type=${r}`,execute:()=>{let o=this.tracks[e];if(o){let a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),a.changeType(r),o.codec=i,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;let i=e.start,r=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,De.MAIN))==null?void 0:t.gap)===!0)return;let o={label:"block-audio",execute:()=>{var a;let l=this.tracks.video;(this.lastVideoAppendEnd>r||l!=null&&l.buffer&&lt.isBuffered(l.buffer,r)||((a=this.fragmentTracker.getAppendedFrag(r,De.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){let{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){let{tracks:i}=this,{data:r,type:s,parent:o,frag:a,part:l,chunkMeta:u,offset:d}=t,f=u.buffering[s],{sn:m,cc:y}=a,v=self.performance.now();f.start=v;let E=a.stats.buffering,T=l?l.stats.buffering:null;E.start===0&&(E.start=v),T&&T.start===0&&(T.start=v);let C=i.audio,D=!1;s==="audio"&&C?.container==="audio/mpeg"&&(D=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);let P=i.video,V=P?.buffer;if(V&&m!=="initSegment"){let A=l||a,x=this.blockedAudioAppend;if(s==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(P.ending||P.ended)){let M=A.start+A.duration*.05,F=V.buffered,j=this.currentOp("video");!F.length&&!j?this.blockAudio(A):!j&&!lt.isBuffered(V,M)&&this.lastVideoAppendEnd<M&&this.blockAudio(A)}else if(s==="video"){let R=A.end;if(x){let M=x.frag.start;(R>M||R<this.lastVideoAppendEnd||lt.isBuffered(V,M))&&this.unblockAudio()}this.lastVideoAppendEnd=R}}let G=(l||a).start,H={label:`append-${s}`,execute:()=>{var A;f.executeStart=self.performance.now();let x=(A=this.tracks[s])==null?void 0:A.buffer;x&&(D?this.updateTimestampOffset(x,G,.1,s,m,y):d!==void 0&&Ie(d)&&this.updateTimestampOffset(x,d,1e-6,s,m,y)),this.appendExecutor(r,s)},onStart:()=>{},onComplete:()=>{let A=self.performance.now();f.executeEnd=f.end=A,E.first===0&&(E.first=A),T&&T.first===0&&(T.first=A);let x={};this.sourceBuffers.forEach(([R,M])=>{R&&(x[R]=lt.getBuffered(M))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(I.BUFFER_APPENDED,{type:s,frag:a,part:l,chunkMeta:u,parent:a.type,timeRanges:x})},onError:A=>{var x;let R={type:Ne.MEDIA_ERROR,parent:a.type,details:Q.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:a,part:l,chunkMeta:u,error:A,err:A,fatal:!1},M=(x=this.media)==null?void 0:x.error;if(A.code===DOMException.QUOTA_EXCEEDED_ERR||A.name=="QuotaExceededError"||"quota"in A)R.details=Q.BUFFER_FULL_ERROR;else if(A.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!M)R.errorAction=Qd(!0);else if(A.name===r$&&this.sourceBufferCount===0)R.errorAction=Qd(!0);else{let F=++this.appendErrors[s];this.warn(`Failed ${F}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${M||"no media error"})`),(F>=this.hls.config.appendErrorMaxRetry||M)&&(R.fatal=!0)}this.hls.trigger(I.ERROR,R)}};this.log(`queuing "${s}" append sn: ${m}${l?" p: "+l.index:""} of ${a.type===De.MAIN?"level":"track"} ${a.level} cc: ${y}`),this.append(H,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(I.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){let{type:i,startOffset:r,endOffset:s}=t;i?this.append(this.getFlushOp(i,r,s),i):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,r,s),o)})}onFragParsed(e,t){let{frag:i,part:r}=t,s=[],o=r?r.elementaryStreams:i.elementaryStreams;o[Qt.AUDIOVIDEO]?s.push("audiovideo"):(o[Qt.AUDIO]&&s.push("audio"),o[Qt.VIDEO]&&s.push("video"));let a=()=>{let l=self.performance.now();i.stats.buffering.end=l,r&&(r.stats.buffering.end=l);let u=r?r.stats:i.stats;this.hls.trigger(I.FRAG_BUFFERED,{frag:i,part:r,stats:u,id:i.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(a,s).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){let t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([o])=>{if(o){let a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});let r=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();let{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(I.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(I.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){let t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{let e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Q.BUFFER_APPEND_ERROR&&t.frag){var i;let r=(i=t.errorAction)==null?void 0:i.nextAutoLevel;Ie(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){let{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;let r=e.config,s=i.currentTime,o=t.levelTargetDuration,a=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(Ie(a)&&a>=0){let u=Math.max(a,o),d=Math.floor(s/o)*o-u;this.flushBackBuffer(s,o,d)}let l=r.frontBufferFlushThreshold;if(Ie(l)&&l>0){let u=Math.max(r.maxBufferLength,l),d=Math.max(u,o),f=Math.floor(s/o)*o+d;this.flushFrontBuffer(s,o,f)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([r,s])=>{if(s){let a=lt.getBuffered(s);if(a.length>0&&i>a.start(0)){var o;this.hls.trigger(I.BACK_BUFFER_REACHED,{bufferEnd:i});let l=this.tracks[r];if((o=this.details)!=null&&o.live)this.hls.trigger(I.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(l!=null&&l.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(I.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:r})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([r,s])=>{if(s){let o=lt.getBuffered(s),a=o.length;if(a<2)return;let l=o.start(a-1),u=o.end(a-1);if(i>l||e>=l&&e<=u)return;this.hls.trigger(I.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;let{details:t,mediaSource:i}=this;if(!t||!this.media||i?.readyState!=="open")return null;let r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&i.setLiveSeekableRange){let u=Math.max(0,t.fragmentStart),d=Math.max(u,r);return{duration:1/0,start:u,end:d}}return{duration:1/0}}let s=(e=this.overrides)==null?void 0:e.duration;if(s)return Ie(s)?{duration:s}:null;let o=this.media.duration,a=Ie(i.duration)?i.duration:0;return r>a&&r>o||!Ie(o)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:i}){let r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(Ie(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${i}.`),r.setLiveSeekableRange(t,i)))}get tracksReady(){let e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){let{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Zt(i)}`),this.tracksReady){var r;let s=(r=this.transferData)==null?void 0:r.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){let e={};this.sourceBuffers.forEach(([t,i])=>{if(t){let r=this.tracks[t];e[t]={buffer:i,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(I.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{let e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){let{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(let s in e){let o=s,a=e[o];if(this.isPending(a)){let l=this.getTrackCodec(a,o),u=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${u})${this.currentOp(o)?" Queued":""} ${Zt(a)}`);try{let d=i.addSourceBuffer(u),f=_A(o),m=[o,d];t[f]=m,a.buffer=d}catch(d){var r;this.error(`error while trying to add sourceBuffer: ${d.message}`),this.shiftAndExecuteNext(o),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[o],this.hls.trigger(I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:d,sourceBufferName:o,mimeType:u,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){let i=e.supplemental,r=e.codec;i&&(t==="video"||t==="audiovideo")&&zp(i,"video")&&(r=LJ(r,i));let s=y_(r,e.levelCodec);return s?t.slice(0,5)==="audio"?C_(s,this.appendSource):s:""}trackSourceBuffer(e,t){let i=t.buffer;if(!i)return;let r=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,o)=>{let a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(I.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;let i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i?.src}onSBUpdateStart(e){let t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}let i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;let r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${r}`,t),this.hls.trigger(I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});let s=this.currentOp(e);s&&s.onError(r)}updateTimestampOffset(e,t,i,r,s,o){let a=t-e.timestampOffset;Math.abs(a)>=i&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${s} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,i){let{media:r,mediaSource:s}=this,o=this.tracks[e],a=o?.buffer;if(!r||!s||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}let l=Ie(r.duration)?r.duration:1/0,u=Ie(s.duration)?s.duration:1/0,d=Math.max(0,t),f=Math.min(i,l,u);f>d&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${d},${f}] from the ${e} SourceBuffer`),a.remove(d,f)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){let i=this.tracks[t],r=i?.buffer;if(!r)throw new fD(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);let{operationQueue:i}=this,r=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(o=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;let r=(i=this.tracks[t])==null?void 0:i.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){let r=this.tracks[e];if(!r)return;let s=r.buffer;if(!s)return;let o=i.bind(this,e);r.listeners.push({event:t,listener:o}),s.addEventListener(t,o)}removeBufferListeners(e){let t=this.tracks[e];if(!t)return;let i=t.buffer;i&&(t.listeners.forEach(r=>{i.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}};function jB(n){let e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function Tte(n,e){let t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function _A(n){return n==="audio"?1:0}var mD=class n{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){let{hls:e}=this;e.on(I.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.BUFFER_CODECS,this.onBufferCodecs,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){let{hls:e}=this;e.off(I.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.BUFFER_CODECS,this.onBufferCodecs,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){let i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){let i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Ie(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}let e=this.hls.levels;if(e.length){let t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){let t=this.hls.levels;if(!t.length)return-1;let i=t.filter((r,s)=>this.isLevelAllowed(r)&&s<=e);return this.clientRect=null,n.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;let e=this.media,t={width:0,height:0};if(e){let i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;let r=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0,s=e.length-1,o=Math.max(t,i);for(let a=0;a<e.length;a+=1){let l=e[a];if((l.width>=o||l.height>=o)&&r(l,e[a+1])){s=a;break}}return s}},wte={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},zi=wte,bte={HLS:"h"},Ite=bte,ea=class n{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof n?i:new n(i))),this.value=e,this.params=t}},Ste="Dict";function Cte(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function xte(n,e,t,i){return new Error(`failed to ${n} "${Cte(e)}" as ${t}`,{cause:i})}function to(n,e,t){return xte("serialize",n,e,t)}var j_=class{constructor(e){this.description=e}},GB="Bare Item",Ate="Boolean";function Dte(n){if(typeof n!="boolean")throw to(n,Ate);return n?"?1":"?0"}function Pte(n){return btoa(String.fromCharCode(...n))}var Rte="Byte Sequence";function Mte(n){if(ArrayBuffer.isView(n)===!1)throw to(n,Rte);return`:${Pte(n)}:`}var kte="Integer";function Lte(n){return n<-999999999999999||999999999999999<n}function s$(n){if(Lte(n))throw to(n,kte);return n.toString()}function Ote(n){return`@${s$(n.getTime()/1e3)}`}function o$(n,e){if(n<0)return-o$(-n,e);let t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){let r=Math.floor(n*t);return(r%2===0?r:r+1)/t}else return Math.round(n*t)/t}var Nte="Decimal";function Fte(n){let e=o$(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw to(n,Nte);let t=e.toString();return t.includes(".")?t:`${t}.0`}var Vte="String",Bte=/[\x00-\x1f\x7f]+/;function Ute(n){if(Bte.test(n))throw to(n,Vte);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function $te(n){return n.description||n.toString().slice(7,-1)}var jte="Token";function zB(n){let e=$te(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw to(e,jte);return e}function gD(n){switch(typeof n){case"number":if(!Ie(n))throw to(n,GB);return Number.isInteger(n)?s$(n):Fte(n);case"string":return Ute(n);case"symbol":return zB(n);case"boolean":return Dte(n);case"object":if(n instanceof Date)return Ote(n);if(n instanceof Uint8Array)return Mte(n);if(n instanceof j_)return zB(n);default:throw to(n,GB)}}var Gte="Key";function yD(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw to(n,Gte);return n}function l1(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${yD(e)}`:`;${yD(e)}=${gD(t)}`).join("")}function a$(n){return n instanceof ea?`${gD(n.value)}${l1(n.params)}`:gD(n)}function zte(n){return`(${n.value.map(a$).join(" ")})${l1(n.params)}`}function Hte(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw to(n,Ste);let t=n instanceof Map?n.entries():Object.entries(n),i=e?.whitespace?" ":"";return Array.from(t).map(([r,s])=>{s instanceof ea||(s=new ea(s));let o=yD(r);return s.value===!0?o+=l1(s.params):(o+="=",Array.isArray(s.value)?o+=zte(s):o+=a$(s)),o}).join(`,${i}`)}function l$(n,e){return Hte(n,e)}var Zs="CMCD-Object",En="CMCD-Request",Nc="CMCD-Session",ul="CMCD-Status",qte={br:Zs,ab:Zs,d:Zs,ot:Zs,tb:Zs,tpb:Zs,lb:Zs,tab:Zs,lab:Zs,url:Zs,pb:En,bl:En,tbl:En,dl:En,ltc:En,mtp:En,nor:En,nrr:En,rc:En,sn:En,sta:En,su:En,ttfb:En,ttfbb:En,ttlb:En,cmsdd:En,cmsds:En,smrt:En,df:En,cs:En,ts:En,cid:Nc,pr:Nc,sf:Nc,sid:Nc,st:Nc,v:Nc,msd:Nc,bs:ul,bsd:ul,cdn:ul,rtp:ul,bg:ul,pt:ul,ec:ul,e:ul},Wte={REQUEST:En};function Kte(n){return Object.keys(n).reduce((e,t)=>{var i;return(i=n[t])===null||i===void 0||i.forEach(r=>e[r]=t),e},{})}function Yte(n,e){let t={};if(!n)return t;let i=Object.keys(n),r=e?Kte(e):{};return i.reduce((s,o)=>{var a;let l=qte[o]||r[o]||Wte.REQUEST,u=(a=s[l])!==null&&a!==void 0?a:s[l]={};return u[o]=n[o],s},t)}function Qte(n){return["ot","sf","st","e","sta"].includes(n)}function Zte(n){return typeof n=="number"?Ie(n):n!=null&&n!==""&&n!==!1}var c$="event";function Xte(n,e){let t=new URL(n),i=new URL(e);if(t.origin!==i.origin)return n;let r=t.pathname.split("/").slice(1),s=i.pathname.split("/").slice(1,-1);for(;r[0]===s[0];)r.shift(),s.shift();for(;s.length;)s.shift(),r.unshift("..");return r.join("/")+t.search+t.hash}var T_=n=>Math.round(n),vD=(n,e)=>Array.isArray(n)?n.map(t=>vD(t,e)):n instanceof ea&&typeof n.value=="string"?new ea(vD(n.value,e),n.params):(e.baseUrl&&(n=Xte(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),u_=n=>T_(n/100)*100,Jte=(n,e)=>{let t=n;return e.version>=2&&(n instanceof ea&&typeof n.value=="string"?t=new ea([n]):typeof n=="string"&&(t=[n])),vD(t,e)},ene={br:T_,d:T_,bl:u_,dl:u_,mtp:u_,nor:Jte,rtp:u_,tb:T_},u$="request",d$="response",c1=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],tne=["e"],nne=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Z_(n){return nne.test(n)}function ine(n){return c1.includes(n)||tne.includes(n)||Z_(n)}var h$=["d","dl","nor","ot","rtp","su"];function rne(n){return c1.includes(n)||h$.includes(n)||Z_(n)}var sne=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function one(n){return c1.includes(n)||h$.includes(n)||sne.includes(n)||Z_(n)}var ane=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function lne(n){return ane.includes(n)||Z_(n)}var cne={[d$]:one,[c$]:ine,[u$]:rne};function f$(n,e={}){let t={};if(n==null||typeof n!="object")return t;let i=e.version||n.v||1,r=e.reportingMode||u$,s=i===1?lne:cne[r],o=Object.keys(n).filter(s),a=e.filter;typeof a=="function"&&(o=o.filter(a));let l=r===d$||r===c$;l&&!o.includes("ts")&&o.push("ts"),i>1&&!o.includes("v")&&o.push("v");let u=Wt({},ene,e.formatters),d={version:i,reportingMode:r,baseUrl:e.baseUrl};return o.sort().forEach(f=>{let m=n[f],y=u[f];if(typeof y=="function"&&(m=y(m,d)),f==="v"){if(i===1)return;m=i}f=="pr"&&m===1||(l&&f==="ts"&&!Ie(m)&&(m=Date.now()),Zte(m)&&(Qte(f)&&typeof m=="string"&&(m=new j_(m)),t[f]=m))}),t}function une(n,e={}){let t={};if(!n)return t;let i=f$(n,e),r=Yte(i,e?.customHeaderMap);return Object.entries(r).reduce((s,[o,a])=>{let l=l$(a,{whitespace:!1});return l&&(s[o]=l),s},t)}function dne(n,e,t){return Wt(n,une(e,t))}var hne="CMCD";function fne(n,e={}){return n?l$(f$(n,e),{whitespace:!1}):""}function pne(n,e={}){if(!n)return"";let t=fne(n,e);return encodeURIComponent(t)}function mne(n,e={}){if(!n)return"";let t=pne(n,e);return`${hne}=${t}`}var HB=/CMCD=[^&#]+/;function gne(n,e,t){let i=mne(e,t);if(!i)return n;if(HB.test(n))return n.replace(HB,i);let r=n.includes("?")?"&":"?";return`${n}${r}${i}`}var _D=class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:zi.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=r=>{try{let{frag:s,part:o}=r,a=this.hls.levels[s.level],l=this.getObjectType(s),u={d:(o||s).duration*1e3,ot:l};(l===zi.VIDEO||l===zi.AUDIO||l==zi.MUXED)&&(u.br=a.bitrate/1e3,u.tb=this.getTopBandwidth(l)/1e3,u.bl=this.getBufferLength(l));let d=o?this.getNextPart(o):this.getNextFrag(s);d!=null&&d.url&&d.url!==s.url&&(u.nor=d.url),this.apply(r,u)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;let t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){let e=this.hls;e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHED,this.onMediaDetached,this),e.on(I.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){let e=this.hls;e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHED,this.onMediaDetached,this),e.off(I.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,r;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:Ite.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Wt(t,this.createData());let i=t.ot===zi.INIT||t.ot===zi.VIDEO||t.ot===zi.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);let{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((o,a)=>(r.includes(a)&&(o[a]=t[a]),o),{}));let s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),dne(e.headers,t,s)):e.url=gne(e.url,t,s)}getNextFrag(e){var t;let i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){let r=e.sn-i.startSN;return i.fragments[r+1]}}getNextPart(e){var t;let{index:i,fragment:r}=e,s=(t=this.hls.levels[r.level])==null||(t=t.details)==null?void 0:t.partList;if(s){let{sn:o}=r;for(let a=s.length-1;a>=0;a--){let l=s[a];if(l.index===i&&l.fragment.sn===o)return s[a+1]}}}getObjectType(e){let{type:t}=e;if(t==="subtitle")return zi.TIMED_TEXT;if(e.sn==="initSegment")return zi.INIT;if(t==="audio")return zi.AUDIO;if(t==="main")return this.hls.audioTracks.length?zi.VIDEO:zi.MUXED}getTopBandwidth(e){let t=0,i,r=this.hls;if(e===zi.AUDIO)i=r.audioTracks;else{let s=r.maxAutoLevel,o=s>-1?s+1:r.levels.length;i=r.levels.slice(0,o)}return i.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){let t=this.media,i=e===zi.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:lt.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){let{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}createFragmentLoader(){let{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}},yne=3e5,ED=class extends qi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){let e=this.hls;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){let e=this.hls;e&&(e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){let e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){let t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){let{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){let{errorAction:i}=t;if(i?.action===Qn.SendAlternateToPenaltyBox&&i.flags===mr.MoveAllAlternatesMatchingHost){let r=this.levels,s=this._pathwayPriority,o=this.pathwayId;if(t.context){let{groupId:a,pathwayId:l,type:u}=t.context;a&&r?o=this.getPathwayForGroupId(a,u,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!s&&r&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),i.resolved=this.pathwayId!==o),t.details===Q.BUFFER_APPEND_ERROR&&!t.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${r&&r.length} priorities: ${Zt(s)} penalized: ${Zt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){let i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t,i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach(s=>{r-i[s]>yne&&delete i[s]});for(let s=0;s<e.length;s++){let o=e[s];if(o in i)continue;if(o===this.pathwayId)return;let a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,FU(t),this.hls.trigger(I.LEVELS_UPDATED,{levels:t});let u=this.hls.levels[a];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,i){let r=this.getLevelsForPathway(i).concat(this.levels||[]);for(let s=0;s<r.length;s++)if(t===mt.AUDIO_TRACK&&r[s].hasAudioGroup(e)||t===mt.SUBTITLE_TRACK&&r[s].hasSubtitleGroup(e))return r[s].pathwayId;return i}clonePathways(e){let t=this.levels;if(!t)return;let i={},r={};e.forEach(s=>{let{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=s;if(t.some(d=>d.pathwayId===o))return;let u=this.getLevelsForPathway(a).map(d=>{let f=new hn(d.attrs);f["PATHWAY-ID"]=o;let m=f.AUDIO&&`${f.AUDIO}_clone_${o}`,y=f.SUBTITLES&&`${f.SUBTITLES}_clone_${o}`;m&&(i[f.AUDIO]=m,f.AUDIO=m),y&&(r[f.SUBTITLES]=y,f.SUBTITLES=y);let v=p$(d.uri,f["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),E=new jc({attrs:f,audioCodec:d.audioCodec,bitrate:d.bitrate,height:d.height,name:d.name,url:v,videoCodec:d.videoCodec,width:d.width});if(d.audioGroups)for(let T=1;T<d.audioGroups.length;T++)E.addGroupId("audio",`${d.audioGroups[T]}_clone_${o}`);if(d.subtitleGroups)for(let T=1;T<d.subtitleGroups.length;T++)E.addGroupId("text",`${d.subtitleGroups[T]}_clone_${o}`);return E});t.push(...u),qB(this.audioTracks,i,l,o),qB(this.subtitleTracks,r,l,o)})}loadSteeringManifest(e){let t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){let d=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+d)}let s={responseType:"json",url:r.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},u={onSuccess:(d,f,m,y)=>{this.log(`Loaded steering manifest: "${r}"`);let v=d.data;if(v?.VERSION!==1){this.log(`Steering VERSION ${v.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=v.TTL;let{"RELOAD-URI":E,"PATHWAY-CLONES":T,"PATHWAY-PRIORITY":C}=v;if(E)try{this.uri=new self.URL(E,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${E}`);return}this.scheduleRefresh(this.uri||m.url),T&&this.clonePathways(T);let D={steeringManifest:v,url:r.toString()};this.hls.trigger(I.STEERING_MANIFEST_LOADED,D),C&&this.updatePathwayPriority(C)},onError:(d,f,m,y)=>{if(this.log(`Error loading steering manifest: ${d.code} ${d.text} (${f.url})`),this.stopLoad(),d.code===410){this.enabled=!1,this.log(`Steering manifest ${f.url} no longer available`);return}let v=this.timeToLoad*1e3;if(d.code===429){let E=this.loader;if(typeof E?.getResponseHeader=="function"){let T=E.getResponseHeader("Retry-After");T&&(v=parseFloat(T)*1e3)}this.log(`Steering manifest ${f.url} rate limited`);return}this.scheduleRefresh(this.uri||f.url,v)},onTimeout:(d,f,m)=>{this.log(`Timeout loading steering manifest (${f.url})`),this.scheduleRefresh(this.uri||f.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;let r=(i=this.hls)==null?void 0:i.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}};function qB(n,e,t,i){n&&Object.keys(e).forEach(r=>{let s=n.filter(o=>o.groupId===r).map(o=>{let a=Wt({},o);return a.details=void 0,a.attrs=new hn(a.attrs),a.url=a.attrs.URI=p$(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[r],a.attrs["PATHWAY-ID"]=i,a});n.push(...s)})}function p$(n,e,t,i){let{HOST:r,PARAMS:s,[t]:o}=i,a;e&&(a=o?.[e],a&&(n=a));let l=new self.URL(n);return r&&!a&&(l.host=r),s&&Object.keys(s).sort().forEach(u=>{u&&l.searchParams.set(u,s[u])}),l.href}var vne=(()=>{class n extends qi{constructor(t){super("eme",t.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=n.CDMCleanupPromise?[n.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=i=>{let{initDataType:r,initData:s}=i,o=`"${i.type}" event: init data type: "${r}"`;if(this.debug(o),s!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=Vp(this.config));let l=a.map(dA).filter(u=>!!u);this.keyFormatPromise=this.getKeyFormatPromise(l)}this.keyFormatPromise.then(a=>{let l=__(a);if(r!=="sinf"||l!==fn.FAIRPLAY){this.log(`Ignoring "${i.type}" event with init data type: "${r}" for selected key-system ${l}`);return}let u;try{let v=Un(new Uint8Array(s)),E=t1(JSON.parse(v).sinf),T=pU(E);if(!T)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");u=new Uint8Array(T.subarray(8,24))}catch(v){this.warn(`${o} Failed to parse sinf: ${v}`);return}let d=ri(u),{keyIdToKeySessionPromise:f,mediaKeySessions:m}=this,y=f[d];for(let v=0;v<m.length;v++){let E=m[v],T=E.decryptdata;if(!T.keyId)continue;let C=ri(T.keyId);if(L_(u,T.keyId)||T.uri.replace(/-/g,"").indexOf(d)!==-1){if(y=f[C],!y)continue;if(T.pssh)break;delete f[C],T.pssh=new Uint8Array(s),T.keyId=u,y=f[d]=y.then(()=>this.generateRequestWithPreferredKeySession(E,r,s,"encrypted-event-key-match")),y.catch(D=>this.handleError(D));break}}y||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${m.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=i=>{this.log(`"${i.type}" event`)},this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();let t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(I.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(I.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(I.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(I.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(I.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(I.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(t){let{drmSystems:i,widevineLicenseUrl:r}=this.config,s=i?.[t];if(s)return s.licenseUrl;if(t===fn.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(t){let i=this.getLicenseServerUrl(t);if(i===void 0)throw new Error(`no license server URL configured for key-system "${t}"`);return i}getServerCertificateUrl(t){let{drmSystems:i}=this.config,r=i?.[t];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){let i=this.hls.levels,r=(a,l,u)=>!!a&&u.indexOf(a)===l,s=i.map(a=>a.audioCodec).filter(r),o=i.map(a=>a.videoCodec).filter(r);return s.length+o.length===0&&o.push("avc1.42e01e"),new Promise((a,l)=>{let u=d=>{let f=d.shift();this.getMediaKeysPromise(f,s,o).then(m=>a({keySystem:f,mediaKeys:m})).catch(m=>{d.length?u(d):m instanceof Pi?l(m):l(new Pi({type:Ne.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};u(t)})}requestMediaKeySystemAccess(t,i){let{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${r}`;return DU===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return r(t,i)}getMediaKeysPromise(t,i,r){var s;let o=mee(t,i,r,this.config.drmSystemOptions||{}),a=this.keySystemAccessPromises[t],l=(s=a)==null?void 0:s.keySystemAccess;if(!l){this.log(`Requesting encrypted media "${t}" key-system access with config: ${Zt(o)}`),l=this.requestMediaKeySystemAccess(t,o);let u=a=this.keySystemAccessPromises[t]={keySystemAccess:l};return l.catch(d=>{this.log(`Failed to obtain access to key-system "${t}": ${d}`)}),l.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);let f=this.fetchServerCertificate(t);this.log(`Create media-keys for "${t}"`);let m=u.mediaKeys=d.createMediaKeys().then(y=>(this.log(`Media-keys created for "${t}"`),u.hasMediaKeys=!0,f.then(v=>v?this.setMediaKeysServerCertificate(y,t,v):y)));return m.catch(y=>{this.error(`Failed to create media-keys for "${t}"}: ${y}`)}),m})}return l.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:i,mediaKeys:r}){this.log(`Creating key-system session "${i}" keyId: ${ri(t.keyId||[])} keyUri: ${t.uri}`);let s=r.createSession(),o={decryptdata:t,keySystem:i,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o}renewKeySession(t){let i=t.decryptdata;if(i.pssh){let r=this.createMediaKeySessionContext(t),s=d_(i),o="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(r,o,i.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}updateKeySession(t,i){let r=t.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${ri(t.decryptdata.keyId||[])}
      } (data length: ${i.byteLength})`),r.update(i)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(t=>({keySystem:t,hasMediaKeys:this.keySystemAccessPromises[t].hasMediaKeys})).filter(({hasMediaKeys:t})=>!!t).map(({keySystem:t})=>dA(t)).filter(t=>!!t)}getKeySystemAccess(t){return this.getKeySystemSelectionPromise(t).then(({keySystem:i,mediaKeys:r})=>this.attemptSetMediaKeys(i,r))}selectKeySystem(t){return new Promise((i,r)=>{this.getKeySystemSelectionPromise(t).then(({keySystem:s})=>{let o=dA(s);o?i(o):r(new Error(`Unable to find format for key-system "${s}"`))}).catch(r)})}selectKeySystemFormat(t){let i=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)),this.keyFormatPromise}getKeyFormatPromise(t){let i=Vp(this.config),r=t.map(__).filter(s=>!!s&&i.indexOf(s)!==-1);return this.selectKeySystem(r)}getKeyStatus(t){let{mediaKeySessions:i}=this;for(let r=0;r<i.length;r++){let s=_ne(t,i[r]);if(s)return s}}loadKey(t){let i=t.keyInfo.decryptdata,r=d_(i),s=this.bannedKeyIds[r];if(s||this.getKeyStatus(i)==="internal-error"){let l=WB(s||"internal-error",i);return this.handleError(l,t.frag),Promise.reject(l)}let o=`(keyId: ${r} format: "${i.keyFormat}" method: ${i.method} uri: ${i.uri})`;this.log(`Starting session for key ${o}`);let a=this.keyIdToKeySessionPromise[r];if(!a){let l=this.getKeySystemForKeyPromise(i).then(({keySystem:u,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${o}`),this.attemptSetMediaKeys(u,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:u,mediaKeys:d,decryptdata:i}))))).then(u=>{let d="cenc",f=i.pssh?i.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(u,d,f,"playlist-key")});return l.catch(u=>this.handleError(u,t.frag)),this.keyIdToKeySessionPromise[r]=l,l}return a.catch(l=>{if(l instanceof Pi){let u=zt({},l.data);this.getKeyStatus(i)==="internal-error"&&(u.decryptdata=i);let d=new Pi(u,l.message);this.handleError(d,t.frag)}}),a}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t,i){if(this.hls)if(t instanceof Pi){i&&(t.data.frag=i);let r=t.data.decryptdata;this.error(`${t.message}${r?` (${ri(r.keyId||[])})`:""}`),this.hls.trigger(I.ERROR,t.data)}else this.error(t.message),this.hls.trigger(I.ERROR,{type:Ne.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0})}getKeySystemForKeyPromise(t){let i=d_(t),r=this.keyIdToKeySessionPromise[i];if(!r){let s=__(t.keyFormat),o=s?[s]:Vp(this.config);return this.attemptKeySystemAccess(o)}return r}getKeySystemSelectionPromise(t){if(t.length||(t=Vp(this.config)),t.length===0)throw new Pi({type:Ne.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Zt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}attemptSetMediaKeys(t,i){if(this.mediaResolved=void 0,this.mediaKeys===i)return Promise.resolve();let r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);let s=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(i):new Promise((o,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=i,this.media.setMediaKeys(i).then(o).catch(a)}}));return this.mediaKeys=i,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${t}"`),r.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(o=>r.indexOf(o)===-1)})}generateRequestWithPreferredKeySession(t,i,r,s){var o;let a=(o=this.config.drmSystems)==null||(o=o[t.keySystem])==null?void 0:o.generateRequest;if(a)try{let E=a.call(this.hls,i,r,t);if(!E)throw new Error("Invalid response from configured generateRequest filter");i=E.initDataType,r=E.initData?E.initData:null,t.decryptdata.pssh=r?new Uint8Array(r):null}catch(E){if(this.warn(E.message),this.hls&&this.hls.config.debug)throw E}if(r===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(t);let l=d_(t.decryptdata),u=t.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${l} URI: ${u} (init data type: ${i} length: ${r.byteLength})`);let d=new n1,f=t._onmessage=E=>{let T=t.mediaKeysSession;if(!T){d.emit("error",new Error("invalid state"));return}let{messageType:C,message:D}=E;this.log(`"${C}" message event for session "${T.sessionId}" message size: ${D.byteLength}`),C==="license-request"||C==="license-renewal"?this.renewLicense(t,D).catch(P=>{d.eventNames().length?d.emit("error",P):this.handleError(P)}):C==="license-release"?t.keySystem===fn.FAIRPLAY&&this.updateKeySession(t,qA("acknowledged")).then(()=>this.removeSession(t)).catch(P=>this.handleError(P)):this.warn(`unhandled media key message type "${C}"`)},m=(E,T)=>{T.keyStatus=E;let C;E.startsWith("usable")?d.emit("resolved"):E==="internal-error"||E==="output-restricted"||E==="output-downscaled"?C=WB(E,T.decryptdata):E==="expired"?C=new Error(`key expired (keyId: ${l})`):E==="released"?C=new Error("key released"):E==="status-pending"||this.warn(`unhandled key status change "${E}" (keyId: ${l})`),C&&(d.eventNames().length?d.emit("error",C):this.handleError(C))},y=t._onkeystatuseschange=E=>{if(!t.mediaKeysSession){d.emit("error",new Error("invalid state"));return}let C=this.getKeyStatuses(t);if(!Object.keys(C).some(G=>C[G]!=="status-pending"))return;if(C[l]==="expired"){this.log(`Expired key ${Zt(C)} in key-session "${t.mediaKeysSession.sessionId}"`),this.renewKeySession(t);return}let P=C[l];if(P)m(P,t);else{var V;t.keyStatusTimeouts||(t.keyStatusTimeouts={}),(V=t.keyStatusTimeouts)[l]||(V[l]=self.setTimeout(()=>{if(!t.mediaKeysSession||!this.mediaKeys)return;let H=this.getKeyStatus(t.decryptdata);if(H&&H!=="status-pending")return this.log(`No status for keyId ${l} in key-session "${t.mediaKeysSession.sessionId}". Using session key-status ${H} from other session.`),m(H,t);this.log(`key status for ${l} in key-session "${t.mediaKeysSession.sessionId}" timed out after 1000ms`),P="internal-error",m(P,t)},1e3)),this.log(`No status for keyId ${l} (${Zt(C)}).`)}};Ri(t.mediaKeysSession,"message",f),Ri(t.mediaKeysSession,"keystatuseschange",y);let v=new Promise((E,T)=>{d.on("error",T),d.on("resolved",E)});return t.mediaKeysSession.generateRequest(i,r).then(()=>{this.log(`Request generated for key-session "${t.mediaKeysSession.sessionId}" keyId: ${l} URI: ${u}`)}).catch(E=>{throw new Pi({type:Ne.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_SESSION,error:E,decryptdata:t.decryptdata,fatal:!1},`Error generating key-session request: ${E}`)}).then(()=>v).catch(E=>(d.removeAllListeners(),this.removeSession(t).then(()=>{throw E}))).then(()=>(d.removeAllListeners(),t))}getKeyStatuses(t){let i={};return t.mediaKeysSession.keyStatuses.forEach((r,s)=>{if(typeof s=="string"&&typeof r=="object"){let l=s;s=r,r=l}let o="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);if(t.keySystem===fn.PLAYREADY&&o.length===16){let l=ri(o);i[l]=r,xU(o)}let a=ri(o);r==="internal-error"&&(this.bannedKeyIds[a]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${a} key-session "${t.mediaKeysSession.sessionId}"`),i[a]=r}),i}fetchServerCertificate(t){let i=this.config,r=i.loader,s=new r(i),o=this.getServerCertificateUrl(t);return o?(this.log(`Fetching server certificate for "${t}"`),new Promise((a,l)=>{let u={responseType:"arraybuffer",url:o},d=i.certLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(y,v,E,T)=>{a(y.data)},onError:(y,v,E,T)=>{l(new Pi({type:Ne.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:zt({url:u.url,data:void 0},y)},`"${t}" certificate request failed (${o}). Status: ${y.code} (${y.text})`))},onTimeout:(y,v,E)=>{l(new Pi({type:Ne.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:{url:u.url,data:void 0}},`"${t}" certificate request timed out (${o})`))},onAbort:(y,v,E)=>{l(new Error("aborted"))}};s.load(u,f,m)})):Promise.resolve()}setMediaKeysServerCertificate(t,i,r){return new Promise((s,o)=>{t.setServerCertificate(r).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${r.byteLength}) on "${i}"`),s(t)}).catch(a=>{o(new Pi({type:Ne.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(t,i){return this.requestLicense(t,new Uint8Array(i)).then(r=>this.updateKeySession(t,new Uint8Array(r)).catch(s=>{throw new Pi({type:Ne.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:t.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(t,i){let r=String.fromCharCode.apply(null,new Uint16Array(i.buffer));if(!r.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),i;let s=new DOMParser().parseFromString(r,"application/xml"),o=s.querySelectorAll("HttpHeader");if(o.length>0){let f;for(let m=0,y=o.length;m<y;m++){var a,l;f=o[m];let v=(a=f.querySelector("name"))==null?void 0:a.textContent,E=(l=f.querySelector("value"))==null?void 0:l.textContent;v&&E&&t.setRequestHeader(v,E)}}let u=s.querySelector("Challenge"),d=u?.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return qA(atob(d))}setupLicenseXHR(t,i,r,s){let o=this.config.licenseXhrSetup;return o?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return o.call(this.hls,t,i,r,s)}).catch(a=>{if(!r.decryptdata)throw a;return t.open("POST",i,!0),o.call(this.hls,t,i,r,s)}).then(a=>(t.readyState||t.open("POST",i,!0),{xhr:t,licenseChallenge:a||s})):(t.open("POST",i,!0),Promise.resolve({xhr:t,licenseChallenge:s}))}requestLicense(t,i){let r=this.config.keyLoadPolicy.default;return new Promise((s,o)=>{let a=this.getLicenseServerUrlOrThrow(t.keySystem);this.log(`Sending license request to URL: ${a}`);let l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return o(new Error("invalid state"));if(l.readyState===4)if(l.status===200){this._requestLicenseFailureCount=0;let u=l.response;this.log(`License received ${u instanceof ArrayBuffer?u.byteLength:u}`);let d=this.config.licenseResponseCallback;if(d)try{u=d.call(this.hls,l,a,t)}catch(f){this.error(f)}s(u)}else{let u=r.errorRetry,d=u?u.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||l.status>=400&&l.status<500)o(new Pi({type:Ne.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:t.decryptdata,fatal:!0,networkDetails:l,response:{url:a,data:void 0,code:l.status,text:l.statusText}},`License Request XHR failed (${a}). Status: ${l.status} (${l.statusText})`));else{let f=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(t,i).then(s,o)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=l,this.setupLicenseXHR(l,a,t,i).then(({xhr:u,licenseChallenge:d})=>{t.keySystem==fn.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(u,d)),u.send(d)}).catch(o)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(t,i){if(!this.config.emeEnabled)return;let r=i.media;this.media=r,Ri(r,"encrypted",this.onMediaEncrypted),Ri(r,"waitingforkey",this.onWaitingForKey);let s=this.mediaResolved;s?s():this.mediaKeys=r.mediaKeys}onMediaDetached(){let t=this.media;t&&(Hi(t,"encrypted",this.onMediaEncrypted),Hi(t,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var t;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};let i=this.mediaResolved;if(i&&i(),!this.mediaKeys&&!this.mediaKeySessions.length)return;let r=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,th.clearKeyUriToKeyIdMap();let o=s.length;n.CDMCleanupPromise=Promise.all(s.map(a=>this.removeSession(a)).concat((r==null||(t=r.setMediaKeys(null))==null?void 0:t.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(I.ERROR,{type:Ne.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(I.ERROR,{type:Ne.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{o&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(t,{sessionKeys:i}){if(!(!i||!this.config.emeEnabled)&&!this.keyFormatPromise){let r=i.reduce((s,o)=>(s.indexOf(o.keyFormat)===-1&&s.push(o.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(t){let{mediaKeysSession:i,licenseXhr:r,decryptdata:s}=t;if(i){this.log(`Remove licenses and keys and close session "${i.sessionId}" keyId: ${ri(s?.keyId||[])}`),t._onmessage&&(i.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(i.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;let o=this.mediaKeySessions.indexOf(t);o>-1&&this.mediaKeySessions.splice(o,1);let{keyStatusTimeouts:a}=t;a&&Object.keys(a).forEach(d=>self.clearTimeout(a[d]));let{drmSystemOptions:l}=this.config;return(yee(l)?new Promise((d,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),i.remove().then(d).catch(f)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(I.ERROR,{type:Ne.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>i.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(I.ERROR,{type:Ne.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}return n.CDMCleanupPromise=void 0,n})();function d_(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return ri(n.keyId)}function _ne(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}var Pi=class extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}};function WB(n,e){let t=n==="output-restricted",i=t?Q.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Q.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Pi({type:Ne.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}var TD=class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(I.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(I.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){let i=this.hls.config;if(i.capLevelOnFPSDrop){let r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){let r=performance.now();if(t){if(this.lastTime){let s=r-this.lastTime,o=i-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/s,u=this.hls;if(u.trigger(I.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:i}),l>0&&o>u.config.fpsDroppedMonitoringThreshold*a){let d=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=d)&&(d=d-1,u.trigger(I.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:u.currentLevel}),u.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){let e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){let t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}};function m$(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function g$(n,e){let t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){Ht.debug(`[texttrack-utils]: ${i}`);try{let r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,n.addCue(r)}catch(r){Ht.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(n.mode=t)}function Kd(n,e){let t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let i=n.cues.length;i--;)e&&n.cues[i].removeEventListener("enter",e),n.removeCue(n.cues[i]);t==="disabled"&&(n.mode=t)}function wD(n,e,t,i){let r=n.mode;if(r==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){let s=Tne(n.cues,e,t);for(let o=0;o<s.length;o++)(!i||i(s[o]))&&n.removeCue(s[o])}r==="disabled"&&(n.mode=r)}function Ene(n,e){if(e<=n[0].startTime)return 0;let t=n.length-1;if(e>n[t].endTime)return-1;let i=0,r=t,s;for(;i<=r;)if(s=Math.floor((r+i)/2),e<n[s].startTime)r=s-1;else if(e>n[s].startTime&&i<t)i=s+1;else return s;return n[i].startTime-e<e-n[r].startTime?i:r}function Tne(n,e,t){let i=[],r=Ene(n,e);if(r>-1)for(let s=r,o=n.length;s<o;s++){let a=n[s];if(a.startTime>=e&&a.endTime<=t)i.push(a);else if(a.startTime>t)return i}return i}function w_(n){let e=[];for(let t=0;t<n.length;t++){let i=n[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(n[t])}return e}var bD=class extends Jp{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null,i=w_(this.media.textTracks);for(let s=0;s<i.length;s++)if(i[s].mode==="hidden")t=i[s];else if(i[s].mode==="showing"){t=i[s];break}let r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){let{hls:e}=this;e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(I.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){let i=this.media;if(!i)return;let r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;w_(i.textTracks).forEach(o=>{Kd(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){let{id:i,groupId:r,details:s}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==r){this.warn(`Subtitle track with id:${i} and group:${r} not found in active group ${o?.groupId}`);return}let a=o.details;o.details=t.details,this.log(`Subtitle track ${i} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!t)return;let i=t.subtitleGroups||null,r=this.groupIds,s=this.currentTrack;if(!i||r?.length!==i?.length||i!=null&&i.some(o=>r?.indexOf(o)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;let o=this.tracks.filter(d=>!i||i.indexOf(d.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(d=>d.default)&&(this.selectDefaultTrack=!1),o.forEach((d,f)=>{d.id=f});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;let a=this.hls.config.subtitlePreference;if(!s&&a){this.selectDefaultTrack=!1;let d=eo(a,o);if(d>-1)s=o[d];else{let f=eo(a,this.tracks);s=this.tracks[f]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));let u={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${i?.join(",")}" group-id`),this.hls.trigger(I.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){let t=this.tracksInGroup,i=this.selectDefaultTrack;for(let r=0;r<t.length;r++){let s=t[r];if(!(i&&!s.default||!i&&!e)&&(!e||Uc(s,e)))return r}if(e){for(let r=0;r<t.length;r++){let s=t[r];if(em(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){let s=t[r];if(em(e.attrs,s.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){let t=this.tracksInGroup;for(let i=0;i<t.length;i++){let r=t[i];if(uD(r,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===mt.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;let t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){let i=this.currentTrack;if(i&&Uc(e,i))return i;let r=eo(e,this.tracksInGroup);if(r>-1){let s=this.tracksInGroup[r];return this.setSubtitleTrack(r),s}else{if(i)return null;{let s=eo(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);let i=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),o=e.details,a=o?.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(I.SUBTITLE_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){let{media:e}=this;if(!e)return;let t=w_(e.textTracks),i=this.currentTrack,r;if(i&&(r=t.filter(s=>uD(i,s))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==r&&(s.mode="disabled")}),r){let s=this.subtitleDisplay?"showing":"hidden";r.mode!==s&&(r.mode=s)}}setSubtitleTrack(e){let t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Ie(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;let i=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(I.SUBTITLE_TRACK_SWITCH,{id:e});return}let s=!!r.details&&!r.details.live;if(e===this.trackId&&r===i&&s)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));let{id:o,groupId:a="",name:l,type:u,url:d}=r;this.hls.trigger(I.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:u,url:d});let f=this.switchParams(r.url,i?.details,r.details);this.loadPlaylist(f)}};function wne(){try{return crypto.randomUUID()}catch{try{let e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?s:s&3|8).toString(16)})}}}function $p(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}var Jd=.025,G_=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function bne(n,e,t){return`${n.identifier}-${t+1}-${$p(e)}`}var ID=class{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;let i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){let e=this.dateRange.startTime;if(this.snapOptions.out){let t=this.dateRange.tagAnchor;if(t)return EA(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;let e=this.dateRange.tagAnchor;if(e){let t=this.dateRange.startTime,i=EA(t,e);return t-i<.1}return!1}get resumptionOffset(){let e=this.resumeOffset,t=Ie(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){let e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){let t=this.resumeAnchor;if(t)return EA(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Jd))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){let e=this.playoutLimit,t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?G_.Range:G_.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return Ine(this)}};function EA(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<Jd)?e.start:e.start+e.duration}function y$(n,e,t){let i=new self.URL(n,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function TA(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function Ine(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function Wd(n){let e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}var SD=class{constructor(e,t,i,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(I.PLAYOUT_LIMIT_REACHED,{})};let s=this.hls=new e(t);this.interstitial=i,this.assetItem=r;let o=()=>{this.hasDetails=!0};s.once(I.LEVEL_LOADED,o),s.once(I.AUDIO_TRACK_LOADED,o),s.once(I.SUBTITLE_TRACK_LOADED,o),s.on(I.MEDIA_ATTACHING,(a,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(I.BUFFER_APPENDED,()=>{let d=this.bufferedEnd;this.reachedPlayout(d)&&(this._bufferedEosTime=d,s.trigger(I.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){let e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=y$(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;let i=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,s=lt.bufferInfo(e,r,0);return this.getAssetTime(s.end)>=i-.02}reachedPlayout(e){let i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){let e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;let t=lt.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){let e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){let e=this.assetItem.duration;if(!e)return 0;let t=this.interstitial.playoutLimit;if(t){let i=t-this.startOffset;if(i>0&&i<e)return i}return e}get remaining(){let e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){let t=this.timelineOffset;if(e!==t){let i=e-t;if(Math.abs(i)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){let t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){let e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){let e=this.hls;if(e&&this.hasDetails){e.stopLoad();let t=i=>delete i.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,i){var r;(r=this.hls)==null||r.on(e,t)}once(e,t,i){var r;(r=this.hls)==null||r.once(e,t)}off(e,t,i){var r;(r=this.hls)==null||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Wd(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}},KB=.033,CD=class extends qi{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,i+1):i,0):0}get duration(){let e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);let r=this.items;if(r)for(r[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(s=r[i])!=null&&s.event;){var s;i--}return i}findItemIndexAtTime(e,t){let i=this.items;if(i)for(let r=0;r<i.length;r++){let s=i[r];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return r}return-1}findJumpRestrictedIndex(e,t){let i=this.items;if(i)for(let r=e;r<=t&&i[r];r++){let s=i[r].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return r}return-1}findEventIndex(e){let t=this.items;if(t)for(let r=t.length;r--;){var i;if(((i=t[r].event)==null?void 0:i.identifier)===e)return r}return-1}findAssetIndex(e,t){let i=e.assetList,r=i.length;if(r>1)for(let s=0;s<r;s++){let o=i[s];if(!o.error){let a=o.timelineStart;if(t===a||t>a&&(t<a+(o.duration||0)||s===r-1))return s}}return 0}get assetIdAtEnd(){var e;let t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){let i=t.assetList,r=i[i.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){let i=e.main.details,{dateRanges:r}=i,s=this.events,o=this.parseDateRanges(r,{url:i.url},t),a=Object.keys(r),l=s?s.filter(u=>!a.includes(u.identifier)):[];o.length&&o.sort((u,d)=>{let f=u.cue.pre,m=u.cue.post,y=d.cue.pre,v=d.cue.post;if(f&&!y)return-1;if(y&&!f||m&&!v)return 1;if(v&&!m)return-1;if(!f&&!y&&!m&&!v){let E=u.startTime,T=d.startTime;if(E!==T)return E-T}return u.dateRange.tagOrder-d.dateRange.tagOrder}),this.events=o,l.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],i=!1){let r=this.events||[];if(r.length||t.length||this.length<2){let s=this.items,o=this.parseSchedule(r,e);(i||t.length||s?.length!==o.length||o.some((l,u)=>Math.abs(l.playout.start-s[u].playout.start)>.005||Math.abs(l.playout.end-s[u].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,i){let r=[],s=Object.keys(e);for(let o=0;o<s.length;o++){let a=s[o],l=e[a];if(l.isInterstitial){let u=this.eventMap[a];u?u.setDateRange(l):(u=new ID(l,t),this.eventMap[a]=u,i===!1&&(u.appendInPlace=i)),r.push(u)}}return r}parseSchedule(e,t){let i=[],r=t.main.details,s=r.live?1/0:r.edge,o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,u=0;if(e.forEach((d,f)=>{let m=d.cue.pre,y=d.cue.post,v=e[f-1]||null,E=d.appendInPlace,T=y?s:d.startOffset,C=d.duration,D=d.timelineOccupancy===G_.Range?C:0,P=d.resumptionOffset,V=v?.startTime===T,G=T+d.cumulativeDuration,H=E?G+C:T+P;if(m||!y&&T<=0){let x=u;u+=D,d.timelineStart=G;let R=o;o+=C,i.push({event:d,start:G,end:H,playout:{start:R,end:o},integrated:{start:x,end:u}})}else if(T<=s){if(!V){let M=T-l;if(M>KB){let F=l,j=u;u+=M;let B=o;o+=M;let ge={previousEvent:e[f-1]||null,nextEvent:d,start:F,end:F+M,playout:{start:B,end:o},integrated:{start:j,end:u}};i.push(ge)}else M>0&&v&&(v.cumulativeDuration+=M,i[i.length-1].end=T)}y&&(H=G),d.timelineStart=G;let x=u;u+=D;let R=o;o+=C,i.push({event:d,start:G,end:H,playout:{start:R,end:o},integrated:{start:x,end:u}})}else return;let A=d.resumeTime;y||A>s?l=s:l=A}),l<s){var a;let d=l,f=u,m=s-l;u+=m;let y=o;o+=m,i.push({previousEvent:((a=i[i.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:d+m,playout:{start:y,end:o},integrated:{start:f,end:u}})}this.setDurations(s,o,u)}else i.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){let i=t.main.details,r=i.live?1/0:i.edge,s=0,o=-1;e.forEach((a,l)=>{let u=a.cue.pre,d=a.cue.post,f=u?0:d?r:a.startTime;this.updateAssetDurations(a),o===f?a.cumulativeDuration=s:(s=0,o=f),!d&&a.snapOptions.in&&(a.resumeAnchor=Gc(null,i.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<KB&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));let y=Ie(a.resumeOffset)?a.resumeOffset:a.duration;s+=y})}primaryCanResumeInPlaceAt(e,t){let i=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(i-r)>Jd?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${r}`),!1):!Object.keys(t).some(o=>{let a=t[o].details,l=a.edge;if(i>=l)return this.log(`"${e.identifier}" resumption ${i} past ${o} playlist end ${l}`),!1;let u=Gc(null,a.fragments,i);if(!u)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;let d=o==="audio"?.175:0;return Math.abs(u.start-i)<Jd+d||Math.abs(u.end-i)<Jd+d?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${o} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;let t=e.timelineStart,i=0,r=!1,s=!1;for(let o=0;o<e.assetList.length;o++){let a=e.assetList[o],l=t+i;a.startOffset=i,a.timelineStart=l,r||(r=a.duration===null),s||(s=!!a.error);let u=a.error?0:a.duration||0;i+=u}r&&!s?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}};function ls(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}var xD=class{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){let i=e.assetListUrl,r;try{r=y$(i,this.hls.sessionId,e.baseUrl)}catch(m){let y=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_ERROR,m,i);this.hls.trigger(I.ERROR,y);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);let s=this.hls.config,o=s.loader,a=new o(s),l={responseType:"json",url:r.href},u=s.interstitialAssetListLoadPolicy.default,d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(m,y,v,E)=>{let T=m.data,C=T?.ASSETS;if(!Array.isArray(C)){let D=this.assignAssetListError(e,Q.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),v.url,y,E);this.hls.trigger(I.ERROR,D);return}e.assetListResponse=T,this.hls.trigger(I.ASSET_LIST_LOADED,{event:e,assetListResponse:T,networkDetails:E})},onError:(m,y,v,E)=>{let T=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${m.code} ${m.text} (${y.url})`),y.url,E,v);this.hls.trigger(I.ERROR,T)},onTimeout:(m,y,v)=>{let E=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${y.url})`),y.url,m,v);this.hls.trigger(I.ERROR,E)}};return a.load(l,d,f),this.hls.trigger(I.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,i,r,s,o){return e.error=i,{type:Ne.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:i,networkDetails:o,stats:s}}};function YB(n){var e;n==null||(e=n.play())==null||e.catch(()=>{})}function h_(n,e){return`[${n}] Advancing timeline position to ${e}`}var AD=class extends qi{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{let i=this.currentTime;if(i===void 0||this.playbackDisabled||!this.schedule)return;let r=i-this.timelinePos;if(Math.abs(r)<1/7056e5)return;let o=r<=-.01;this.timelinePos=i,this.bufferedPos=i;let a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(i,i-r)&&this.updateSchedule(!0),this.checkBuffer(),o&&i<a.start||i>=a.end){var l;let y=this.findItemIndex(a),v=this.schedule.findItemIndexAtTime(i);if(v===-1&&(v=y+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${i} (resolving from ${y} to ${v})`)),!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o&&v>y){let E=this.schedule.findJumpRestrictedIndex(y+1,v);if(E>y){this.setSchedulePosition(E);return}}this.setSchedulePosition(v);return}let u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(a)){let y=a.event.assetList[0];y&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,y))}return}let d=u.timelineStart,f=u.duration||0;if(o&&i<d||i>=d+f){var m;(m=a.event)!=null&&m.appendInPlace&&(this.clearAssetPlayers(a.event,a),this.flushFrontBuffer(i)),this.setScheduleToAssetAtTime(i,u)}},this.onTimeupdate=()=>{let i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;let r=this.playingItem;if(!r||this.playingLastItem)return;if(i>=r.end){this.timelinePos=r.end;let a=this.findItemIndex(r);this.setSchedulePosition(a+1)}let s=this.playingAsset;if(!s)return;let o=s.timelineStart+(s.duration||0);i>=o&&this.setScheduleToAssetAtTime(i,s)},this.onScheduleUpdate=(i,r)=>{let s=this.schedule;if(!s)return;let o=this.playingItem,a=s.events||[],l=s.items||[],u=s.durations,d=i.map(E=>E.identifier),f=!!(a.length||d.length);(f||r)&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(E=>ls(E))} pos: ${this.timelinePos}`),d.length&&this.log(`Removed events ${d}`);let m=null,y=null;o&&(m=this.updateItem(o,this.timelinePos),this.itemsMatch(o,m)?this.playingItem=m:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);let v=this.bufferingItem;if(v&&(y=this.updateItem(v,this.bufferedPos),this.itemsMatch(v,y)?this.bufferingItem=y:v.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(v.event,null))),i.forEach(E=>{E.assetList.forEach(T=>{this.clearAssetPlayer(T.identifier,null)})}),this.playerQueue.forEach(E=>{if(E.interstitial.appendInPlace){let T=E.assetItem.timelineStart,C=E.timelineOffset-T;if(C)try{E.timelineOffset=T}catch(D){Math.abs(C)>Jd&&this.warn(`${D} ("${E.assetId}" ${E.timelineOffset}->${T})`)}}}),f||r){if(this.hls.trigger(I.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:u,removedIds:d}),this.isInterstitial(o)&&d.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(m,o),v&&y!==m&&this.trimInPlace(y,v),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new xD(e),this.schedule=new CD(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){let e=this.hls;e&&(e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(I.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(I.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(I.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(I.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(I.BUFFER_APPENDED,this.onBufferAppended,this),e.on(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(I.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(I.MEDIA_ENDED,this.onMediaEnded,this),e.on(I.ERROR,this.onError,this),e.on(I.DESTROYING,this.onDestroying,this))}unregisterListeners(){let e=this.hls;e&&(e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(I.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(I.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(I.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(I.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(I.BUFFER_CODECS,this.onBufferCodecs,this),e.off(I.BUFFER_APPENDED,this.onBufferAppended,this),e.off(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(I.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(I.MEDIA_ENDED,this.onMediaEnded,this),e.off(I.ERROR,this.onError,this),e.off(I.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){let e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Hi(e,"play",this.onPlay),Hi(e,"pause",this.onPause),Hi(e,"seeking",this.onSeeking),Hi(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){let i=this.media=t.media;Ri(i,"seeking",this.onSeeking),Ri(i,"timeupdate",this.onTimeupdate),Ri(i,"play",this.onPlay),Ri(i,"pause",this.onPause)}onMediaAttached(e,t){let i=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!r){this.clearScheduleState();let s=this.findItemIndex(i);this.setSchedulePosition(s)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){let i=!!t.transferMedia,r=this.media;if(this.media=null,!i&&(r&&this.removeMediaListeners(r),this.detachedData)){let s=this.getBufferingPlayer();s&&(this.log(`Removing schedule state for detachedData and ${s}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;let e=this,t=()=>e.bufferingItem||e.waitingItem,i=f=>f&&e.getAssetPlayer(f.identifier),r=(f,m,y,v,E)=>{if(f){let T=f[m].start,C=f.event;if(C){if(m==="playout"||C.timelineOccupancy!==G_.Point){let D=i(y);D?.interstitial===C&&(T+=D.assetItem.startOffset+D[E])}}else{let D=v==="bufferedPos"?o():e[v];T+=D-f.start}return T}return 0},s=(f,m)=>{var y;if(f!==0&&m!=="primary"&&(y=e.schedule)!=null&&y.length){var v;let E=e.schedule.findItemIndexAtTime(f),T=(v=e.schedule.items)==null?void 0:v[E];if(T){let C=T[m].start-T.start;return f+C}}return f},o=()=>{let f=e.bufferedPos;return f===Number.MAX_VALUE?a("primary"):Math.max(f,0)},a=f=>{var m,y;return(m=e.primaryDetails)!=null&&m.live?e.primaryDetails.edge:((y=e.schedule)==null?void 0:y.durations[f])||0},l=(f,m)=>{var y,v;let E=e.effectivePlayingItem;if(E!=null&&(y=E.event)!=null&&y.restrictions.skip||!e.schedule)return;e.log(`seek to ${f} "${m}"`);let T=e.effectivePlayingItem,C=e.schedule.findItemIndexAtTime(f,m),D=(v=e.schedule.items)==null?void 0:v[C],P=e.getBufferingPlayer(),V=P?.interstitial,G=V?.appendInPlace,H=T&&e.itemsMatch(T,D);if(T&&(G||H)){let A=i(e.playingAsset),x=A?.media||e.primaryMedia;if(x){let R=m==="primary"?x.currentTime:r(T,m,e.playingAsset,"timelinePos","currentTime"),M=f-R,F=(G?R:x.currentTime)+M;if(F>=0&&(!A||G||F<=A.duration)){x.currentTime=F;return}}}if(D){let A=f;if(m!=="primary"){let R=D[m].start,M=f-R;A=D.start+M}let x=!e.isInterstitial(D);if((!e.isInterstitial(T)||T.event.appendInPlace)&&(x||D.event.appendInPlace)){let R=e.media||(G?P?.media:null);R&&(R.currentTime=A)}else if(T){let R=e.findItemIndex(T);if(C>R){let F=e.schedule.findJumpRestrictedIndex(R+1,C);if(F>R){e.setSchedulePosition(F);return}}let M=0;if(x)e.timelinePos=A,e.checkBuffer();else{let F=D.event.assetList,j=f-(D[m]||D).start;for(let B=F.length;B--;){let ge=F[B];if(ge.duration&&j>=ge.startOffset&&j<ge.startOffset+ge.duration){M=B;break}}}e.setSchedulePosition(C,M)}}},u=()=>{let f=e.effectivePlayingItem;if(e.isInterstitial(f))return f;let m=t();return e.isInterstitial(m)?m:null},d={get bufferedEnd(){let f=t(),m=e.bufferingItem;if(m&&m===f){var y;return r(m,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-m.playout.start||((y=e.bufferingAsset)==null?void 0:y.startOffset)||0}return 0},get currentTime(){let f=u(),m=e.effectivePlayingItem;return m&&m===f?r(m,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-m.playout.start:0},set currentTime(f){let m=u(),y=e.effectivePlayingItem;y&&y===m&&l(f+y.playout.start,"playout")},get duration(){let f=u();return f?f.playout.end-f.playout.start:0},get assetPlayers(){var f;let m=(f=u())==null?void 0:f.event.assetList;return m?m.map(y=>e.getAssetPlayer(y.identifier)):[]},get playingIndex(){var f;let m=(f=u())==null?void 0:f.event;return m&&e.effectivePlayingAsset?m.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var f;return((f=e.schedule)==null||(f=f.events)==null?void 0:f.slice(0))||[]},get schedule(){var f;return((f=e.schedule)==null||(f=f.items)==null?void 0:f.slice(0))||[]},get interstitialPlayer(){return u()?d:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){let f=t();return e.findItemIndex(f)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){let f=e.effectivePlayingItem;return e.findItemIndex(f)},primary:{get bufferedEnd(){return o()},get currentTime(){let f=e.timelinePos;return f>0?f:0},set currentTime(f){l(f,"primary")},get duration(){return a("primary")},get seekableStart(){var f;return((f=e.primaryDetails)==null?void 0:f.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(f){l(f,"integrated")},get duration(){return a("integrated")},get seekableStart(){var f;return s(((f=e.primaryDetails)==null?void 0:f.fragmentStart)||0,"integrated")}},skip:()=>{let f=e.effectivePlayingItem,m=f?.event;if(m&&!m.restrictions.skip){let y=e.findItemIndex(f);if(m.appendInPlace){let v=f.playout.start+f.event.duration;l(v+.001,"playout")}else e.advanceAfterAssetEnded(m,y,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;let t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;let i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);let s=(t=r)==null?void 0:t.currentTime;if(!(s===void 0||!Ie(s)))return s}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){let i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){let i=e.interstitial.appendInPlace,r=e.media;if(i&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}let s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Zt(s)}`),this.detachedData=s}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var i,r;if(e.media===t)return;let s=null,o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,u=(i=this.detachedData)==null?void 0:i.mediaSource,d;if(o.media)l&&(s=o.transferMedia(),this.detachedData=s),d="Primary";else if(u){let v=this.getBufferingPlayer();v?(s=v.transferMedia(),d=`${v}`):d="detached MediaSource"}else d="detached media";if(!s){if(u)s=this.detachedData,this.log(`using detachedData: MediaSource ${Zt(s)}`);else if(!this.detachedData||o.media===t){let v=this.playerQueue;v.length>1&&v.forEach(E=>{if(a&&E.interstitial.appendInPlace!==l){let T=E.interstitial;this.clearInterstitial(E.interstitial,null),T.appendInPlace=!1,T.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${T}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}let f=s&&"mediaSource"in s&&((r=s.mediaSource)==null?void 0:r.readyState)!=="closed",m=f&&s?s:t;this.log(`${f?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${d} (media.currentTime: ${t.currentTime})`);let y=this.schedule;if(m===s&&y){let v=a&&e.assetId===y.assetIdAtEnd;m.overrides={duration:y.duration,endOfStream:!a||v,cueRemoval:!a}}e.attachMedia(m)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){let e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);let i=this.timelinePos,r=this.effectivePlayingItem;if(i===-1){let s=this.hls.startPosition;if(this.log(h_("checkStart",s)),this.timelinePos=s,t.length&&t[0].cue.pre){let o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(s>=0||!this.primaryLive){let o=this.timelinePos=s>0?s:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(r&&!this.playingItem){let s=e.findItemIndex(r);this.setSchedulePosition(s)}}advanceAssetBuffering(e,t){let i=e.event,r=i.findAssetIndex(t),s=TA(i,r);if(!i.isAssetPastPlayoutLimit(s))this.bufferedToEvent(e,s);else if(this.schedule){var o;let a=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];a&&this.bufferedToItem(a)}}advanceAfterAssetEnded(e,t,i){let r=TA(e,i);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){let s=this.schedule.items;if(s){let o=t+1,a=s.length;if(o>=a){this.setSchedulePosition(-1);return}let l=e.resumeTime;this.timelinePos<l&&(this.log(h_("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){let s=e.assetList[r];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){let i=this.schedule;if(!i)return;let r=t.parentIdentifier,s=i.getEvent(r);if(s){let o=i.findEventIndex(r),a=i.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,o,a-1)}}setSchedulePosition(e,t){var i;let r=(i=this.schedule)==null?void 0:i.items;if(!r||this.playbackDisabled)return;let s=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${s&&ls(s)}) pos: ${this.timelinePos}`);let o=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(o)){let d=o.event,f=this.playingAsset,m=f?.identifier,y=m?this.getAssetPlayer(m):null;if(y&&m&&(!this.eventItemsMatch(o,s)||t!==void 0&&m!==d.assetList[t].identifier)){var l;let v=d.findAssetIndex(f);if(this.log(`INTERSTITIAL_ASSET_ENDED ${v+1}/${d.assetList.length} ${Wd(f)}`),this.endedAsset=f,this.playingAsset=null,this.hls.trigger(I.INTERSTITIAL_ASSET_ENDED,{asset:f,assetListIndex:v,event:d,schedule:r.slice(0),scheduleIndex:e,player:y}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(d,this.findItemIndex(this.playingItem),v);return}this.retreiveMediaSource(m,s),y.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&y.detachMedia()}if(!this.eventItemsMatch(o,s)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${d} ${ls(o)}`),d.hasPlayed=!0,this.hls.trigger(I.INTERSTITIAL_ENDED,{event:d,schedule:r.slice(0),scheduleIndex:e}),d.cue.once)){var u;this.updateSchedule();let v=(u=this.schedule)==null?void 0:u.items;if(s&&v){let E=this.findItemIndex(s);this.advanceSchedule(E,v,t,o,a)}return}}this.advanceSchedule(e,r,t,o,a)}advanceSchedule(e,t,i,r,s){let o=this.schedule;if(!o)return;let a=t[e]||null,l=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(d=>{let f=d.interstitial,m=o.findEventIndex(f.identifier);(m<e||m>e+1)&&this.clearInterstitial(f,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);let d=a.event;if(i===void 0){i=o.findAssetIndex(d,this.timelinePos);let v=TA(d,i-1);if(d.isAssetPastPlayoutLimit(v)||d.appendInPlace&&this.timelinePos===a.end){this.advanceAfterAssetEnded(d,e,i);return}i=v}let f=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let m=this.preloadAssets(d,i);if(this.eventItemsMatch(a,f||r)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${ls(a)} ${d.appendInPlace?"append in place":""}`),this.hls.trigger(I.INTERSTITIAL_STARTED,{event:d,schedule:t.slice(0),scheduleIndex:e})),!d.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${d}`);return}if(d.assetListLoader&&(d.assetListLoader.destroy(),d.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${d}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;let y=d.assetList[i];if(!y){this.advanceAfterAssetEnded(d,e,i||0);return}if(m||(m=this.getAssetPlayer(y.identifier)),m===null||m.destroyed){let v=d.assetList.length;this.warn(`asset ${i+1}/${v} player destroyed ${d}`),m=this.createAssetPlayer(d,y,i),m.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&d.appendInPlace&&this.isAssetBuffered(y))return;this.startAssetPlayer(m,i,t,e,l),this.shouldPlay&&YB(m.media)}else a?(this.resumePrimary(a,e,r),this.shouldPlay&&YB(this.hls.media)):s&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var r,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${ls(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.log(h_("resumePrimary",a)),this.timelinePos=a),this.attachPrimary(a,e)}if(!i)return;let o=(s=this.schedule)==null?void 0:s.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${ls(e)}`),this.hls.trigger(I.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){let i=e.start;if(this.primaryLive){let r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(i<r.fragmentStart||i>r.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){let t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:lt.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;let r=this.primaryMedia;if(!r)return;let s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,r),i&&this.startLoadingPrimaryAt(e,i)),i||(this.log(h_("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;let r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((i=r.mainForwardBufferInfo)==null?void 0:i.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(I.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(I.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;let i=this.hls.levels[t.level];if(!i.details)return;let r=zt(zt({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){let i=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=zt(zt({},this.altSelection),{},{audio:i});return}let s=zt(zt({},r),{},{audio:i});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){let i=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=zt(zt({},this.altSelection),{},{subtitles:i});return}let s=zt(zt({},r),{},{subtitles:i});this.mediaSelection=s}onAudioTrackSwitching(e,t){let i=sB(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(t)||r.setAudioOption(i)))}onSubtitleTrackSwitch(e,t){let i=sB(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(t)||t.id!==-1&&r.setSubtitleOption(i)))}onBufferCodecs(e,t){let i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){let i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){let r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;let t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){let s=t[r];if(s.cue.post){var i;let o=this.schedule.findEventIndex(s.identifier),a=(i=this.schedule.items)==null?void 0:i[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){let t=this.playingItem;if(!this.playingLastItem&&t){let i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){var i;let r=(i=this.schedule)==null?void 0:i.items;if(e&&r){let s=this.findItemIndex(e,t);return r[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(s.identifier,null)});let i=e.end+.25,r=lt.bufferInfo(this.primaryMedia,i,0);(r.end>i||(r.nextStart||0)>i)&&(this.log(`trim buffered interstitial ${ls(e)} (was ${ls(t)})`),this.attachPrimary(i,null,!0),this.flushFrontBuffer(i))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;let i=this.mediaSelection;i&&((t=this.schedule)==null||t.updateSchedule(i,[],e))}checkBuffer(e){var t;let i=(t=this.schedule)==null?void 0:t.items;if(!i)return;let r=lt.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,i,e)}updateBufferedPos(e,t,i){let r=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}let o=this.playingItem,a=this.findItemIndex(o),l=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;let d=this.findItemIndex(s),f=Math.min(d+1,t.length-1),m=t[f];if((l===-1&&s&&e>=s.end||(u=m.event)!=null&&u.appendInPlace&&e+.01>=m.start)&&(l=f),this.isInterstitial(s)){let y=s.event;if(f-a>1&&y.appendInPlace===!1||y.assetList.length===0&&y.assetListLoader)return}if(this.bufferedPos=e,l>d&&l>a)this.bufferedToItem(m);else{let y=this.primaryDetails;this.primaryLive&&y&&e>y.edge-y.targetduration&&m.start<y.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(m)&&this.preloadAssets(m.event,0)}}else i&&o&&!this.itemsMatch(o,s)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{let s=this.getAssetPlayer(r.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){let t=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(e,t)&&i){let{items:r,events:s}=i;if(!r||!s)return t;let o=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));let l=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${ls(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){let u=i.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((d,f)=>{let m=this.getAssetPlayer(d.identifier);m&&(f===u&&m.loadSource(),m.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(I.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){let i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;let r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){let t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){let i=e.event,r=i.assetList.length===0&&!i.assetListLoader,s=i.cue.once;if(r||!s){let o=this.preloadAssets(i,t);if(o!=null&&o.interstitial.appendInPlace){let a=this.primaryMedia;a&&this.bufferAssetPlayer(o,a)}}}preloadAssets(e,t){let i=e.assetUrl,r=e.assetList.length,s=r===0&&!e.assetListLoader,o=e.cue.once;if(s){let l=e.timelineStart;if(e.appendInPlace){var a;let m=this.playingItem;!this.isInterstitial(m)&&(m==null||(a=m.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let u,d=0;if(!this.playingItem&&this.primaryLive&&(d=this.hls.startPosition,d===-1&&(d=this.hls.liveSyncPosition||0)),d&&!(e.cue.pre||e.cue.post)){let m=d-l;m>0&&(u=Math.round(m*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:r} ${e}${u?` live-start: ${d} start-offset: ${u}`:""}`),i)return this.createAsset(e,0,0,l,e.duration,i);let f=this.assetListLoader.loadAssetList(e,u);f&&(e.assetListLoader=f)}else if(!o&&r){for(let u=t;u<r;u++){let d=e.assetList[u],f=this.getAssetPlayerQueueIndex(d.identifier);(f===-1||this.playerQueue[f].destroyed)&&!d.error&&this.createAssetPlayer(e,d,u)}let l=e.assetList[t];if(l){let u=this.getAssetPlayer(l.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){let t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(I.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){let t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){let t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){let{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,r,s,o){let a={parentIdentifier:e.identifier,identifier:bne(e,o,t),duration:s,startOffset:i,timelineStart:r,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,i){let r=this.hls,s=r.userConfig,o=s.videoPreference,a=r.loadLevelObj||r.levels[r.currentLevel];(o||a)&&(o=Wt({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));let l=r.audioTracks[r.audioTrack],u=r.subtitleTracks[r.subtitleTrack],d=0;if(this.primaryLive||e.appendInPlace){let V=this.timelinePos-t.timelineStart;if(V>1){let G=t.duration;G&&V<G&&(d=V)}}let f=t.identifier,m=zt(zt({},s),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:f,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:d,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||s.audioPreference,subtitlePreference:u||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(m.timelineOffset=t.timelineStart));let y=m.cmcd;y!=null&&y.sessionId&&y.contentId&&(m.cmcd=Wt({},y,{contentId:$p(t.uri)})),this.getAssetPlayer(f)&&this.warn(`Duplicate date range identifier ${e} and asset ${f}`);let v=new SD(this.HlsPlayerClass,m,e,t);this.playerQueue.push(v),e.assetList[i]=t;let E=!0,T=V=>{if(V.live){var G;let x=new Error(`Interstitials MUST be VOD assets ${e}`),R={fatal:!0,type:Ne.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:x},M=((G=this.schedule)==null?void 0:G.findEventIndex(e.identifier))||-1;this.handleAssetItemError(R,e,M,i,x.message);return}let H=V.edge-V.fragmentStart,A=t.duration;(E||A===null||H>A)&&(E=!1,this.log(`Interstitial asset "${f}" duration change ${A} > ${H}`),t.duration=H,this.updateSchedule())};v.on(I.LEVEL_UPDATED,(V,{details:G})=>T(G)),v.on(I.LEVEL_PTS_UPDATED,(V,{details:G})=>T(G)),v.on(I.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());let C=(V,G)=>{let H=this.getAssetPlayer(f);if(H&&G.tracks){H.off(I.BUFFER_CODECS,C),H.tracks=G.tracks;let A=this.primaryMedia;this.bufferingAsset===H.assetItem&&A&&!H.media&&this.bufferAssetPlayer(H,A)}};v.on(I.BUFFER_CODECS,C);let D=()=>{var V;let G=this.getAssetPlayer(f);if(this.log(`buffered to end of asset ${G}`),!G||!this.schedule)return;let H=this.schedule.findEventIndex(e.identifier),A=(V=this.schedule.items)==null?void 0:V[H];this.isInterstitial(A)&&this.advanceAssetBuffering(A,t)};v.on(I.BUFFERED_TO_END,D);let P=V=>()=>{if(!this.getAssetPlayer(f)||!this.schedule)return;this.shouldPlay=!0;let H=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,H,V)};return v.once(I.MEDIA_ENDED,P(i)),v.once(I.PLAYOUT_LIMIT_REACHED,P(1/0)),v.on(I.ERROR,(V,G)=>{if(!this.schedule)return;let H=this.getAssetPlayer(f);if(G.details===Q.BUFFER_STALLED_ERROR){if(H!=null&&H.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(G,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${G.error} ${e}`)}),v.on(I.DESTROYING,()=>{if(!this.getAssetPlayer(f)||!this.schedule)return;let G=new Error(`Asset player destroyed unexpectedly ${f}`),H={fatal:!0,type:Ne.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:G};this.handleAssetItemError(H,e,this.schedule.findEventIndex(e.identifier),i,G.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Wd(t)}`),this.hls.trigger(I.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:v}),v}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)})}resetAssetPlayer(e){let t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);let i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,t){let i=this.getAssetPlayerQueueIndex(e);if(i!==-1){let r=this.playerQueue[i];this.log(`clear ${r} toSegment: ${t&&ls(t)}`),this.transferMediaFromPlayer(r,t),this.playerQueue.splice(i,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,r,s){let{interstitial:o,assetItem:a,assetId:l}=e,u=o.assetList.length,d=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!d||d.identifier!==l)&&(d&&(this.clearAssetPlayer(d.identifier,i[r]),delete d.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${Wd(a)}`),this.hls.trigger(I.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:i.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var i,r;if(!this.schedule)return;let{interstitial:s,assetItem:o}=e,a=this.schedule.findEventIndex(s.identifier),l=(i=this.schedule.items)==null?void 0:i[a];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=o;let u=this.getBufferingPlayer();if(u===e)return;let d=s.appendInPlace;if(d&&u?.interstitial.appendInPlace===!1)return;let f=u?.tracks||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(d&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(f&&!oU(f,e.tracks)){let m=new Error(`Asset ${Wd(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(f)}')`),y={fatal:!0,type:Ne.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:m},v=s.findAssetIndex(o);this.handleAssetItemError(y,s,a,v,m.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){let t=this.schedule,i=this.primaryMedia;if(!t||!i)return;let r=i.currentTime,s=t.findAssetIndex(e,r),o=e.assetList[s];if(o){let a=this.getAssetPlayer(o.identifier);if(a){let l=a.currentTime||r-o.timelineStart,u=a.duration-l;if(this.warn(`Stalled at ${l} of ${l+u} in ${a} ${e} (media.currentTime: ${r})`),l&&(u/i.playbackRate<.5||a.bufferedInPlaceToEnd(i))&&a.hls){let d=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,d,s)}}}}advanceInPlace(e){let t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,i,r,s){if(e.details===Q.BUFFER_STALLED_ERROR)return;let o=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&Wd(o)} ${e.error}`),!this.schedule)return;let a=o?.identifier||"",l=this.getAssetPlayerQueueIndex(a),u=this.playerQueue[l]||null,d=this.schedule.items,f=Wt({},e,{fatal:!1,errorAction:Qd(!0),asset:o,assetListIndex:r,event:t,schedule:d,scheduleIndex:i,player:u});if(this.hls.trigger(I.INTERSTITIAL_ASSET_ERROR,f),!e.fatal)return;let m=this.playingAsset,y=this.bufferingAsset,v=new Error(s);if(o&&(this.clearAssetPlayer(a,null),o.error=v),!t.assetList.some(E=>!E.error))t.error=v;else for(let E=r;E<t.assetList.length;E++)this.resetAssetPlayer(t.assetList[E].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):m&&m.identifier===a?this.advanceAfterAssetEnded(t,i,r):y&&y.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,y)}primaryFallback(e){let t=e.timelineStart,i=this.effectivePlayingItem,r=this.timelinePos;if(i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${r} playing: ${ls(i)} error: ${e.error}`),r===-1&&(r=this.hls.startPosition);let o=this.updateItem(i,r);this.itemsMatch(i,o)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(r===-1){this.checkStart();return}if(!this.schedule)return;let s=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(s)}onAssetListLoaded(e,t){var i,r;let s=t.event,o=s.identifier,a=t.assetListResponse.ASSETS;if(!((i=this.schedule)!=null&&i.hasEvent(o)))return;let l=s.timelineStart,u=s.duration,d=0;a.forEach((E,T)=>{let C=parseFloat(E.DURATION);this.createAsset(s,T,d,l+d,C,E.URI),d+=C}),s.duration=d,this.log(`Loaded asset-list with duration: ${d} (was: ${u}) ${s}`);let f=this.waitingItem,m=f?.event.identifier===o;this.updateSchedule();let y=(r=this.bufferingItem)==null?void 0:r.event;if(m){var v;let E=this.schedule.findEventIndex(o),T=(v=this.schedule.items)==null?void 0:v[E];if(T){if(!this.playingItem&&this.timelinePos>T.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==E){s.error=new Error(`Interstitial ${a.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${s}`),this.log(s.error.message),this.updateSchedule(!0),this.primaryFallback(s);return}this.setBufferingItem(T)}this.setSchedulePosition(E)}else if(y?.identifier===o){let E=s.assetList[0];if(E){let T=this.getAssetPlayer(E.identifier);if(y.appendInPlace){let C=this.primaryMedia;T&&C&&this.bufferAssetPlayer(T,C)}else T&&T.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Q.ASSET_LIST_PARSING_ERROR:case Q.ASSET_LIST_LOAD_ERROR:case Q.ASSET_LIST_LOAD_TIMEOUT:{let i=t.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break}case Q.BUFFER_STALLED_ERROR:{let i=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&i.event.appendInPlace){this.handleInPlaceStall(i.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}},QB=500,DD=class extends Kp{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",De.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();let{hls:e}=this;e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(I.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();let{hls:e}=this;e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(I.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=re.IDLE,this.setInterval(QB),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){let{frag:i,success:r}=t;if(this.fragContextChanged(i)||(In(i)&&(this.fragPrevious=i),this.state=re.IDLE),!r)return;let s=this.tracksBuffered[this.currentTrackId];if(!s)return;let o,a=i.start;for(let u=0;u<s.length;u++)if(a>=s[u].start&&a<=s[u].end){o=s[u];break}let l=i.start+i.duration;o?o.end=l:(o={start:a,end:l},s.push(o)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){let{startOffset:i,endOffset:r}=t;if(i===0&&r!==Number.POSITIVE_INFINITY){let s=r-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=s){o.shift();continue}else if(o[a].start<s)o[a].start=s;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(i,s,De.SUBTITLE)}}onError(e,t){let i=t.frag;i?.type===De.SUBTITLE&&(t.details===Q.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==re.STOPPED&&(this.state=re.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&i$(this.levels,t)){this.levels=t.map(i=>new jc(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{let r=new jc(i);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,De.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}let r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==re.STOPPED&&this.setInterval(QB)}onSubtitleTrackLoaded(e,t){var i;let{currentTrackId:r,levels:s}=this,{details:o,id:a}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}let l=s[a];if(a>=s.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(o.live||(i=l.details)!=null&&i.live){if(o.deltaUpdateFailed)return;let f=this.mainDetails;if(!f){this.startFragRequested=!1;return}let m=f.fragments[0];if(!l.details)o.hasProgramDateTime&&f.hasProgramDateTime?(N_(o,f),u=o.fragmentStart):m&&(u=m.start,KA(o,u));else{var d;u=this.alignPlaylists(o,l.details,(d=this.levelLastLoaded)==null?void 0:d.details),u===0&&m&&(u=m.start,KA(o,u))}f&&!this.startFragRequested&&this.setStartPosition(f,u)}l.details=o,this.levelLastLoaded=l,a===r&&(this.hls.trigger(I.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===re.IDLE&&(Gc(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){let{frag:t,payload:i}=e,r=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&r!=null&&r.key&&r.iv&&Zd(r.method)){let o=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,e1(r.method)).catch(a=>{throw s.trigger(I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{let l=performance.now();s.trigger(I.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=re.IDLE})}}doTick(){if(!this.media){this.state=re.IDLE;return}if(this.state===re.IDLE){let{currentTrackId:e,levels:t}=this,i=t?.[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;let{config:r}=this,s=this.getLoadPosition(),o=lt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:a,len:l}=o,u=i.details,d=this.hls.maxBufferLength+u.levelTargetDuration;if(l>d)return;let f=u.fragments,m=f.length,y=u.edge,v=null,E=this.fragPrevious;if(a<y){let D=r.maxFragLookUpTolerance,P=a>y-D?0:D;v=Gc(E,f,Math.max(f[0].start,a),P),!v&&E&&E.start<f[0].start&&(v=f[0])}else v=f[m-1];if(v=this.filterReplacedPrimary(v,i.details),!v)return;let T=v.sn-u.startSN,C=f[T-1];if(C&&C.cc===v.cc&&this.fragmentTracker.getState(C)===$n.NOT_LOADED&&(v=C),this.fragmentTracker.getState(v)===$n.NOT_LOADED){let D=this.mapToInitFragWhenRequired(v);D&&this.loadFragment(D,i,a)}}}loadFragment(e,t,i){In(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new PD(this.tracksBuffered[this.currentTrackId]||[])}},PD=class{constructor(e){this.buffered=void 0;let t=(i,r,s)=>{if(r=r>>>0,r>s-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return e[r][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}},Sne={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},v$=n=>String.fromCharCode(Sne[n]||n),cs=15,Xo=100,Cne={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},xne={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Ane={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Dne={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Pne=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],RD=class{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){let i=typeof t=="function"?t():t;Ht.log(`${this.time} [${e}] ${i}`)}}},Fc=function(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t},z_=class{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){let t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){let r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}},MD=class{constructor(){this.uchar=" ",this.penState=new z_}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}},kD=class{constructor(e){this.chars=[],this.pos=0,this.currPenState=new z_,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Xo;t++)this.chars.push(new MD);this.logger=e}equals(e){for(let t=0;t<Xo;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Xo;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Xo;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Xo&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Xo)}moveCursor(e){let t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();let t=v$(e);if(this.pos>=Xo){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Xo;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){let e=[],t=!0;for(let i=0;i<Xo;i++){let r=this.chars[i].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}},jp=class{constructor(e){this.rows=[],this.currRow=cs-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<cs;t++)this.rows.push(new kD(e));this.logger=e}reset(){for(let e=0;e<cs;e++)this.rows[e].clear();this.currRow=cs-1}equals(e){let t=!0;for(let i=0;i<cs;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<cs;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<cs;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Zt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<cs;a++)this.rows[a].clear();let s=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){let a=o.rows[s].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(o.rows[s+u])}}this.currRow=t;let i=this.rows[this.currRow];if(e.indent!==null){let s=e.indent,o=Math.max(s-1,0);i.setCursor(e.indent),e.color=i.chars[o].penState.foreground}let r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Zt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());let e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;let t=[],i="",r=-1;for(let s=0;s<cs;s++){let o=this.rows[s].getTextString();o&&(r=s+1,e?t.push("Row "+r+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}},H_=class{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new jp(i),this.nonDisplayedMemory=new jp(i),this.lastOutputScreen=new jp(i),this.currRollUpRow=this.displayedMemory.rows[cs-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[cs-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);let t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){let e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){let t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{let i=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[i]}this.logger.log(2,"MIDROW: "+Zt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){let t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}},q_=class{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=Mne(),this.logger=void 0;let r=this.logger=new RD;this.channels=[null,new H_(e,t,r),new H_(e+1,i,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){let r=t[i]&127,s=t[i+1]&127,o=!1,a=null;if(r===0&&s===0)continue;this.logger.log(3,()=>"["+Fc([t[i],t[i+1]])+"] -> ("+Fc([r,s])+")");let l=this.cmdHistory;if(r>=16&&r<=31){if(Rne(r,s,l)){f_(null,null,l),this.logger.log(3,()=>"Repeated command ("+Fc([r,s])+") is dropped");continue}f_(r,s,this.cmdHistory),o=this.parseCmd(r,s),o||(o=this.parseMidrow(r,s)),o||(o=this.parsePAC(r,s)),o||(o=this.parseBackgroundAttributes(r,s))}else f_(null,null,l);if(!o&&(a=this.parseChars(r,s),a)){let d=this.currentChannel;d&&d>0?this.channels[d].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Fc([r,s])+" orig: "+Fc([t[i],t[i+1]]))}}parseCmd(e,t){let i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(i||r))return!1;let s=e===20||e===21||e===23?1:2,o=this.channels[s];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;let r=this.channels[i];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Fc([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i,r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(r||s))return!1;let o=e<=23?1:2;t>=64&&t<=95?i=o===1?Cne[e]:Ane[e]:i=o===1?xne[e]:Dne[e];let a=this.channels[o];return a?(a.setPAC(this.interpretPAC(i,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let i,r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,r.underline=(i&1)===1,i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((i-16)/2)*4,r}parseChars(e,t){let i,r=null,s=null;if(e>=25?(i=2,s=e-8):(i=1,s=e),s>=17&&s<=19){let o;s===17?o=t+80:s===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+v$(o)+"' in channel "+i),r=[o]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+Fc(r).join(",")),r}parseBackgroundAttributes(e,t){let i=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(i||r))return!1;let s,o={};e===16||e===24?(s=Math.floor((t-32)/2),o.background=Pne[s],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));let a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){let t=this.channels[e];t&&t.reset()}f_(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){let i=this.channels[t];i&&i.cueSplitAtTime(e)}}};function f_(n,e,t){t.a=n,t.b=e}function Rne(n,e,t){return t.a===n&&t.b===e}function Mne(){return{a:null,b:null}}var u1=function(){if(O_!=null&&O_.VTTCue)return self.VTTCue;let n=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;let u=l.toLowerCase();return~a.indexOf(u)?u:!1}function i(a){return t(n,a)}function r(a){return t(e,a)}function s(a,...l){let u=1;for(;u<arguments.length;u++){let d=arguments[u];for(let f in d)a[f]=d[f]}return a}function o(a,l,u){let d=this,f={enumerable:!0};d.hasBeenReset=!1;let m="",y=!1,v=a,E=l,T=u,C=null,D="",P=!0,V="auto",G="start",H=50,A="middle",x=50,R="middle";Object.defineProperty(d,"id",s({},f,{get:function(){return m},set:function(M){m=""+M}})),Object.defineProperty(d,"pauseOnExit",s({},f,{get:function(){return y},set:function(M){y=!!M}})),Object.defineProperty(d,"startTime",s({},f,{get:function(){return v},set:function(M){if(typeof M!="number")throw new TypeError("Start time must be set to a number.");v=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"endTime",s({},f,{get:function(){return E},set:function(M){if(typeof M!="number")throw new TypeError("End time must be set to a number.");E=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"text",s({},f,{get:function(){return T},set:function(M){T=""+M,this.hasBeenReset=!0}})),Object.defineProperty(d,"region",s({},f,{get:function(){return C},set:function(M){C=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"vertical",s({},f,{get:function(){return D},set:function(M){let F=i(M);if(F===!1)throw new SyntaxError("An invalid or illegal string was specified.");D=F,this.hasBeenReset=!0}})),Object.defineProperty(d,"snapToLines",s({},f,{get:function(){return P},set:function(M){P=!!M,this.hasBeenReset=!0}})),Object.defineProperty(d,"line",s({},f,{get:function(){return V},set:function(M){if(typeof M!="number"&&M!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");V=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"lineAlign",s({},f,{get:function(){return G},set:function(M){let F=r(M);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");G=F,this.hasBeenReset=!0}})),Object.defineProperty(d,"position",s({},f,{get:function(){return H},set:function(M){if(M<0||M>100)throw new Error("Position must be between 0 and 100.");H=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"positionAlign",s({},f,{get:function(){return A},set:function(M){let F=r(M);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");A=F,this.hasBeenReset=!0}})),Object.defineProperty(d,"size",s({},f,{get:function(){return x},set:function(M){if(M<0||M>100)throw new Error("Size must be between 0 and 100.");x=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"align",s({},f,{get:function(){return R},set:function(M){let F=r(M);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");R=F,this.hasBeenReset=!0}})),d.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}(),LD=class{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}};function _$(n){function e(i,r,s,o){return(i|0)*3600+(r|0)*60+(s|0)+parseFloat(o||0)}let t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}var OD=class{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){let i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}};function E$(n,e,t,i){let r=i?n.split(i):[n];for(let s in r){if(typeof r[s]!="string")continue;let o=r[s].split(t);if(o.length!==2)continue;let a=o[0],l=o[1];e(a,l)}}var ND=new u1(0,0,""),p_=ND.align==="middle"?"middle":"center";function kne(n,e,t){let i=n;function r(){let a=_$(n);if(a===null)throw new Error("Malformed timestamp: "+i);return n=n.replace(/^[^\sa-zA-Z-]+/,""),a}function s(a,l){let u=new OD;E$(a,function(m,y){let v;switch(m){case"region":for(let E=t.length-1;E>=0;E--)if(t[E].id===y){u.set(m,t[E].region);break}break;case"vertical":u.alt(m,y,["rl","lr"]);break;case"line":v=y.split(","),u.integer(m,v[0]),u.percent(m,v[0])&&u.set("snapToLines",!1),u.alt(m,v[0],["auto"]),v.length===2&&u.alt("lineAlign",v[1],["start",p_,"end"]);break;case"position":v=y.split(","),u.percent(m,v[0]),v.length===2&&u.alt("positionAlign",v[1],["start",p_,"end","line-left","line-right","auto"]);break;case"size":u.percent(m,y);break;case"align":u.alt(m,y,["start",p_,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let d=u.get("line","auto");d==="auto"&&ND.line===-1&&(d=-1),l.line=d,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",p_);let f=u.get("position","auto");f==="auto"&&ND.position===50&&(f=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=f}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=r(),o(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);n=n.slice(3),o(),e.endTime=r(),o(),s(n,e)}function T$(n){return n.replace(/<br(?: \/)?>/gi,`
`)}var FD=class{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new LD,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){let t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let s=t.buffer,o=0;for(s=T$(s);o<s.length&&s[o]!=="\r"&&s[o]!==`
`;)++o;let a=s.slice(0,o);return s[o]==="\r"&&++o,s[o]===`
`&&++o,t.buffer=s.slice(o),a}function r(s){E$(s,function(o,a){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=i();let a=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:s=i(),t.state){case"HEADER":/:/.test(s)?r(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new u1(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{kne(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{let a=s.indexOf("-->")!==-1;if(!s||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){let e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}},Lne=/\r\n|\n\r|\n|\r/g,wA=function(e,t,i=0){return e.slice(i,i+t.length)===t},One=function(e){let t=parseInt(e.slice(-3)),i=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Ie(t)||!Ie(i)||!Ie(r)||!Ie(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*r,t+=60*60*1e3*s,t};function d1(n,e,t){return $p(n.toString())+$p(e.toString())+$p(t)}var Nne=function(e,t,i){let r=e[t],s=e[r.prevCC];if(!s||!s.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(o=s)!=null&&o.new;){var o;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=i};function Fne(n,e,t,i,r,s,o){let a=new FD,l=vr(new Uint8Array(n)).trim().replace(Lne,`
`).split(`
`),u=[],d=e?fte(e.baseTime,e.timescale):0,f="00:00.000",m=0,y=0,v,E=!0;a.oncue=function(T){let C=t[i],D=t.ccOffset,P=(m-d)/9e4;if(C!=null&&C.new&&(y!==void 0?D=t.ccOffset=C.start:Nne(t,i,P)),P){if(!e){v=new Error("Missing initPTS for VTT MPEGTS");return}D=P-t.presentationOffset}let V=T.endTime-T.startTime,G=gr((T.startTime+D-y)*9e4,r*9e4)/9e4;T.startTime=Math.max(G,0),T.endTime=Math.max(G+V,0);let H=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(H)),T.id||(T.id=d1(T.startTime,T.endTime,H)),T.endTime>0&&u.push(T)},a.onparsingerror=function(T){v=T},a.onflush=function(){if(v){o(v);return}s(u)},l.forEach(T=>{if(E)if(wA(T,"X-TIMESTAMP-MAP=")){E=!1,T.slice(16).split(",").forEach(C=>{wA(C,"LOCAL:")?f=C.slice(6):wA(C,"MPEGTS:")&&(m=parseInt(C.slice(7)))});try{y=One(f)/1e3}catch(C){v=C}return}else T===""&&(E=!1);a.parse(T+`
`)}),a.flush()}var bA="stpp.ttml.im1t",w$=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,b$=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Vne={left:"start",center:"center",right:"end",start:"start",end:"end"};function ZB(n,e,t,i){let r=ft(new Uint8Array(n),["mdat"]);if(r.length===0){i(new Error("Could not parse IMSC1 mdat"));return}let s=r.map(a=>vr(a)),o=hte(e.baseTime,1,e.timescale);try{s.forEach(a=>t(Bne(a,o)))}catch(a){i(a)}}function Bne(n,e){let r=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");let s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(s).reduce((f,m)=>(f[m]=r.getAttribute(`ttp:${m}`)||s[m],f),{}),a=r.getAttribute("xml:space")!=="preserve",l=XB(IA(r,"styling","style")),u=XB(IA(r,"layout","region")),d=IA(r,"body","[begin]");return[].map.call(d,f=>{let m=I$(f,a);if(!m||!f.hasAttribute("begin"))return null;let y=CA(f.getAttribute("begin"),o),v=CA(f.getAttribute("dur"),o),E=CA(f.getAttribute("end"),o);if(y===null)throw JB(f);if(E===null){if(v===null)throw JB(f);E=y+v}let T=new u1(y-e,E-e,m);T.id=d1(T.startTime,T.endTime,T.text);let C=u[f.getAttribute("region")],D=l[f.getAttribute("style")],P=Une(C,D,l),{textAlign:V}=P;if(V){let G=Vne[V];G&&(T.lineAlign=G),T.align=V}return Wt(T,P),T}).filter(f=>f!==null)}function IA(n,e,t){let i=n.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function XB(n){return n.reduce((e,t)=>{let i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function I$(n,e){return[].slice.call(n.childNodes).reduce((t,i,r)=>{var s;return i.nodeName==="br"&&r?t+`
`:(s=i.childNodes)!=null&&s.length?I$(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function Une(n,e,t){let i="http://www.w3.org/ns/ttml#styling",r=null,s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(r=t[o]),s.reduce((a,l)=>{let u=SA(e,i,l)||SA(n,i,l)||SA(r,i,l);return u&&(a[l]=u),a},{})}function SA(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function JB(n){return new Error(`Could not parse ttml timestamp ${n}`)}function CA(n,e){if(!n)return null;let t=_$(n);return t===null&&(w$.test(n)?t=$ne(n,e):b$.test(n)&&(t=jne(n,e))),t}function $ne(n,e){let t=w$.exec(n),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function jne(n,e){let t=b$.exec(n),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}var Yd=class{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}},VD=class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=tU(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(I.FRAG_LOADING,this.onFragLoading,this),e.on(I.FRAG_LOADED,this.onFragLoaded,this),e.on(I.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(I.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(I.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){let{hls:e}=this;e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(I.FRAG_LOADING,this.onFragLoading,this),e.off(I.FRAG_LOADED,this.onFragLoaded,this),e.off(I.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(I.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(I.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){let e=new Yd(this,"textTrack1"),t=new Yd(this,"textTrack2"),i=new Yd(this,"textTrack3"),r=new Yd(this,"textTrack4");this.cea608Parser1=new q_(1,e,t),this.cea608Parser2=new q_(3,i,r)}addCues(e,t,i,r,s){let o=!1;for(let a=s.length;a--;){let l=s[a],u=Gne(l[0],l[1],t,i);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],i),o=!0,u/(i-t)>.5))return}if(o||s.push([t,i]),this.config.renderTextTracksNatively){let a=this.captionsTracks[e];this.Cues.newCue(a,t,i,r)}else{let a=this.Cues.newCue(null,t,i,r);this.hls.trigger(I.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s,trackId:o}){let{unparsedVttFrags:a}=this;i===De.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:s,trackId:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(I.FRAG_LOADED,l):this.hls.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){let{media:i}=this;if(i)for(let r=0;r<i.textTracks.length;r++){let s=i.textTracks[r];if(eU(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;let{captionsProperties:t,captionsTracks:i,media:r}=this,{label:s,languageCode:o}=t[e],a=this.getExistingTrack(s,o);if(a)i[e]=a,Kd(i[e]),m$(i[e],r);else{let l=this.createTextTrack("captions",s,o);l&&(l[e]=!0,i[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;let t=this.captionsProperties[e];if(!t)return;let i=t.label,r={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(I.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,i){let r=this.media;if(r)return r.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){let i=!!t.transferMedia;if(this.media=null,i)return;let{captionsTracks:r}=this;Object.keys(r).forEach(s=>{Kd(r[s]),delete r[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=tU(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){let{media:e}=this;if(!e)return;let t=e.textTracks;if(t)for(let i=0;i<t.length;i++)Kd(t[i])}onSubtitleTracksUpdated(e,t){let i=t.subtitleTracks||[],r=i.some(s=>s.textCodec===bA);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(i$(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){let o=this.media,a=o?w_(o.textTracks):null;if(this.tracks.forEach((l,u)=>{let d;if(a){let f=null;for(let m=0;m<a.length;m++)if(a[m]&&eU(a[m],l)){f=a[m],a[m]=null;break}f&&(d=f)}if(d)Kd(d);else{let f=S$(l);d=this.createTextTrack(f,l.name,l.lang),d&&(d.mode="disabled")}d&&this.textTracks.push(d)}),a!=null&&a.length){let l=a.filter(u=>u!==null).map(u=>u.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){let o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(I.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{let r=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!r)return;let s=`textTrack${r[1]}`,o=this.captionsProperties[s];o&&(o.label=i.name,i.lang&&(o.languageCode=i.lang),o.media=i)})}closedCaptionsForLevel(e){let t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===De.MAIN){var i,r;let{cea608Parser1:s,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:u}=t.frag,d=(i=(r=t.part)==null?void 0:r.index)!=null?i:-1;s&&o&&(u!==a+1||u===a&&d!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),o.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=d}}onFragLoaded(e,t){let{frag:i,payload:r}=t;if(i.type===De.SUBTITLE)if(r.byteLength){let s=i.decryptdata,o="stats"in t;if(s==null||!s.encrypted||o){let a=this.tracks[i.level],l=this.vttCCs;l[i.cc]||(l[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),a&&a.textCodec===bA?this._parseIMSC1(i,r):this._parseVTTs(t)}}else this.hls.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){let i=this.hls;ZB(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),i.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{i.logger.log(`Failed to parse IMSC1: ${r}`),i.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;let{frag:i,payload:r}=e,{initPTS:s,unparsedVttFrags:o}=this,a=s.length-1;if(!s[i.cc]&&a===-1){o.push(e);return}let l=this.hls,u=(t=i.initSegment)!=null&&t.data?Vr(i.initSegment.data,new Uint8Array(r)).buffer:r;Fne(u,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,d=>{this._appendCues(d,i.level),l.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},d=>{let f=d.message==="Missing initPTS for VTT MPEGTS";f?o.push(e):this._fallbackToIMSC1(i,r),l.logger.log(`Failed to parse VTT cue: ${d}`),!(f&&a>i.cc)&&l.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:d})})}_fallbackToIMSC1(e,t){let i=this.tracks[e.level];i.textCodec||ZB(t,this.initPTS[e.cc],()=>{i.textCodec=bA,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){let i=this.hls;if(this.config.renderTextTracksNatively){let r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(s=>g$(r,s))}else{let r=this.tracks[t];if(!r)return;let s=r.default?"default":"subtitles"+t;i.trigger(I.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){let{frag:i}=t;i.type===De.SUBTITLE&&this.onFragLoaded(I.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;let{frag:i,samples:r}=t;if(!(i.type===De.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let s=0;s<r.length;s++){let o=r[s].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();let a=this.extractCea608Data(o);this.cea608Parser1.addData(r[s].pts,a[0]),this.cea608Parser2.addData(r[s].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:r,type:s}){let{media:o}=this;if(!(!o||o.currentTime<i)){if(!s||s==="video"){let{captionsTracks:a}=this;Object.keys(a).forEach(l=>wD(a[l],t,i))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){let{textTracks:a}=this;Object.keys(a).forEach(l=>wD(a[l],t,r))}}}extractCea608Data(e){let t=[[],[]],i=e[0]&31,r=2;for(let s=0;s<i;s++){let o=e[r++],a=127&e[r++],l=127&e[r++];if(a===0&&l===0)continue;if((4&o)!==0){let d=3&o;(d===0||d===1)&&(t[d].push(a),t[d].push(l))}}return t}};function S$(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function eU(n,e){return!!n&&n.kind===S$(e)&&uD(e,n)}function Gne(n,e,t,i){return Math.min(e,i)-Math.max(n,t)}function tU(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}var zne=/\s/,Hne={newCue(n,e,t,i){let r=[],s,o,a,l,u,d=self.VTTCue||self.TextTrackCue;for(let m=0;m<i.rows.length;m++)if(s=i.rows[m],a=!0,l=0,u="",!s.isEmpty()){var f;for(let E=0;E<s.chars.length;E++)zne.test(s.chars[E].uchar)&&a?l++:(u+=s.chars[E].uchar,a=!1);s.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;let y=T$(u.trim()),v=d1(e,t,y);n!=null&&(f=n.cues)!=null&&f.getCueById(v)||(o=new d(e,t,y),o.id=v,o.line=m+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),r.push(o))}return n&&r.length&&(r.sort((m,y)=>m.line==="auto"||y.line==="auto"?0:m.line>8&&y.line>8?y.line-m.line:m.line-y.line),r.forEach(m=>g$(n,m))),r}};function qne(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var Wne=/(\d+)-(\d+)\/(\d+)/,W_=class{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Zne,this.controller=new self.AbortController,this.stats=new Gp}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){let r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();let s=Kne(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=l&&Ie(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(Xp(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(f=>{var m;this.response=this.loader=f;let y=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},u-(y-r.loading.start)),!f.ok){let{status:E,statusText:T}=f;throw new BD(T||"fetch, bad network response",E,f)}r.loading.first=y,r.total=Qne(f.headers)||r.total;let v=(m=this.callbacks)==null?void 0:m.onProgress;return v&&Ie(t.highWaterMark)?this.loadProgressively(f,r,e,t.highWaterMark,v):o?f.arrayBuffer():e.responseType==="json"?f.json():f.text()}).then(f=>{var m,y;let v=this.response;if(!v)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);let E=f[a];E&&(r.loaded=r.total=E);let T={url:v.url,data:f,code:v.status},C=(m=this.callbacks)==null?void 0:m.onProgress;C&&!Ie(t.highWaterMark)&&C(r,e,f,v),(y=this.callbacks)==null||y.onSuccess(T,r,e,v)}).catch(f=>{var m;if(self.clearTimeout(this.requestTimeout),r.aborted)return;let y=f&&f.code||0,v=f?f.message:null;(m=this.callbacks)==null||m.onError({code:y,text:v},e,f?f.details:null,r)})}getCacheAge(){let e=null;if(this.response){let t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,r=0,s){let o=new F_,a=e.body.getReader(),l=()=>a.read().then(u=>{if(u.done)return o.dataLength&&s(t,i,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));let d=u.value,f=d.length;return t.loaded+=f,f<r||o.dataLength?(o.push(d),o.dataLength>=r&&s(t,i,o.flush().buffer,e)):s(t,i,d.buffer,e),l()}).catch(()=>Promise.reject());return l()}};function Kne(n,e){let t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Wt({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function Yne(n){let e=Wne.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function Qne(n){let e=n.get("Content-Range");if(e){let i=Yne(e);if(Ie(i))return i}let t=n.get("Content-Length");if(t)return parseInt(t)}function Zne(n,e){return new self.Request(n.url,e)}var BD=class extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}},Xne=/^age:\s*[\d.]+\s*$/im,K_=class{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Gp,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){let e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){let{config:e,context:t}=this;if(!e||!t)return;let i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;let s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return s(i,t.url)}).catch(o=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),s(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:i.status,text:o.message},t,i,r)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);let r=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:o}=i.loadPolicy;if(r)for(let a in r)e.setRequestHeader(a,r[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=s&&Ie(s)?s:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){let{context:e,loader:t,stats:i}=this;if(!e||!t)return;let r=t.readyState,s=this.config;if(!i.aborted&&r>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;let u=t.status,d=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){let v=d??t.response;if(v!=null){var o,a;i.loading.end=Math.max(self.performance.now(),i.loading.first);let E=t.responseType==="arraybuffer"?v.byteLength:v.length;i.loaded=i.total=E,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);let T=(o=this.callbacks)==null?void 0:o.onProgress;T&&T(i,e,v,t);let C={url:t.responseURL,data:v,code:u};(a=this.callbacks)==null||a.onSuccess(C,i,e,t);return}}let f=s.loadPolicy.errorRetry,m=i.retry,y={url:e.url,data:void 0,code:u};if(R_(f,m,!1,y))this.retry(f);else{var l;Ht.error(`${u} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:u,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;let e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(R_(e,t,!0))this.retry(e);else{var i;Ht.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);let r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){let{context:t,stats:i}=this;this.retryDelay=JD(e,i.retry),i.retry++,Ht.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){let t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Xne.test(this.loader.getAllResponseHeaders())){let t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}},Jne={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},eie=zt(zt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:K_,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:NA,bufferController:pD,capLevelController:mD,errorController:VA,fpsController:TD,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:DU,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:Jne},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},tie()),{},{subtitleStreamController:DD,subtitleTrackController:bD,timelineController:VD,audioStreamController:cD,audioTrackController:dD,emeController:vne,cmcdController:_D,contentSteeringController:ED,interstitialsController:AD});function tie(){return{cueHandler:Hne,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function nie(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');let i=UD(n),r=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(o=>{let a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,u=[];s.forEach(d=>{let f=`${o}Loading${d}`,m=e[f];if(m!==void 0&&l){u.push(f);let y=i[a].default;switch(e[a]={default:y},d){case"TimeOut":y.maxLoadTimeMs=m,y.maxTimeToFirstByteMs=m;break;case"MaxRetry":y.errorRetry.maxNumRetry=m,y.timeoutRetry.maxNumRetry=m;break;case"RetryDelay":y.errorRetry.retryDelayMs=m,y.timeoutRetry.retryDelayMs=m;break;case"MaxRetryTimeout":y.errorRetry.maxRetryDelayMs=m,y.timeoutRetry.maxRetryDelayMs=m;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${a}": ${Zt(e[a])}`)}),zt(zt({},i),e)}function UD(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(UD):Object.keys(n).reduce((e,t)=>(e[t]=UD(n[t]),e),{}):n}function iie(n,e){let t=n.loader;t!==W_&&t!==K_?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):qne()&&(n.loader=W_,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}var b_=2,rie=.1,sie=.05,oie=100,$D=class extends M_{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(I.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){let{hls:e}=this;e&&(e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){let{hls:e}=this;e&&(e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(oie),this.mediaSource=t.mediaSource;let i=this.media=t.media;Ri(i,"playing",this.onMediaPlaying),Ri(i,"waiting",this.onMediaWaiting),Ri(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();let{media:i}=this;i&&(Hi(i,"playing",this.onMediaPlaying),Hi(i,"waiting",this.onMediaWaiting),Hi(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;let t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,r;let s=(i=this.hls)==null?void 0:i.config;if(!s)return;let o=this.media;if(!o)return;let{seeking:a}=o,l=this.seeking&&!a,u=!this.seeking&&a,d=o.paused&&!a||o.ended||o.playbackRate===0;if(this.seeking=a,e!==t){t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!d&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||l){l&&this.stallResolved(e);return}if(d){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(I.MEDIA_ENDED,{stalled:!1}));return}if(!lt.getBuffered(o).length){this.nudgeRetry=0;return}let f=lt.bufferInfo(o,e,0),m=f.nextStart||0,y=this.fragmentTracker;if(a&&y&&this.hls){let H=nU(this.hls.inFlightFragments,e),A=f.len>b_,x=!m||H||m-e>b_&&!y.getPartialFragment(e);if(A||x)return;this.moved=!1}let v=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&y){if(!(f.len>0)&&!m)return;let A=Math.max(m,f.start||0)-e,R=!!(v!=null&&v.live)?v.targetduration*2:b_,M=m_(e,y);if(A>0&&(A<=R||M)){o.paused||this._trySkipBufferHole(M);return}}let E=s.detectStallWithCurrentTimeMs,T=self.performance.now(),C=this.waiting,D=this.stalled;if(D===null)if(C>0&&T-C<E)D=this.stalled=C;else{this.stalled=T;return}let P=T-D;if(!a&&(P>=E||C)&&this.hls){var V;if(((V=this.mediaSource)==null?void 0:V.readyState)==="ended"&&!(v!=null&&v.live)&&Math.abs(e-(v?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(I.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(f),!this.media||!this.hls)return}let G=lt.bufferInfo(o,e,s.maxBufferHole);this._tryFixBufferStall(G,P,e)}stallResolved(e){let t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){let i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(I.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;let r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&r&&r.length>1&&e>r.end(0)){let s=lt.bufferedInfo(lt.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){let o=lt.timeRangesToArray(r),a=lt.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){let l=lt.bufferedInfo(o,e,0).bufferedIndex,u=o[a].end,d=o[a+1].start;if((l===-1||l>a)&&d-u<1&&e-u<2){let f=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${d} buffered index: ${l}`);this.warn(f.message),this.media.currentTime+=1e-6;let m=m_(e,this.fragmentTracker);m&&"fragment"in m?m=m.fragment:m||(m=void 0);let y=lt.bufferInfo(this.media,e,0);this.hls.trigger(I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:f,reason:f.message,frag:m,buffer:y.len,bufferInfo:y})}}}}}_tryFixBufferStall(e,t,i){var r,s;let{fragmentTracker:o,media:a}=this,l=(r=this.hls)==null?void 0:r.config;if(!a||!o||!l)return;let u=(s=this.hls)==null?void 0:s.latestLevelDetails,d=m_(i,o);if((d||u!=null&&u.live&&i<u.fragmentStart)&&(this._trySkipBufferHole(d)||!this.media))return;let f=e.buffered,m=this.adjacentTraversal(e,i);(f&&f.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-i<l.maxBufferHole||m))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){let i=this.fragmentTracker,r=e.nextStart;if(i&&r){let s=i.getFragAtPos(t,De.MAIN),o=i.getFragAtPos(r,De.MAIN);if(s&&o)return o.sn-s.sn<2}return!1}_reportStall(e){let{hls:t,media:i,stallReported:r,stalled:s}=this;if(!r&&s!==null&&i&&t){this.stallReported=!0;let o=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${Zt(e)})`);this.warn(o.message),t.trigger(I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;let{fragmentTracker:i,media:r}=this,s=(t=this.hls)==null?void 0:t.config;if(!r||!i||!s)return 0;let o=r.currentTime,a=lt.bufferInfo(r,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){let d=a.len<=s.maxBufferHole,f=a.len>0&&a.len<1&&r.readyState<3,m=l-o;if(m>0&&(d||f)){if(m>s.maxBufferHole){let v=!1;if(o===0){let E=i.getAppendedFrag(0,De.MAIN);E&&l<E.end&&(v=!0)}if(!v&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||nU(this.hls.inFlightFragments,l))return 0;let T=!1,C=e.end;for(;C<l;){let D=m_(C,i);if(D)C+=D.duration;else{T=!0;break}}if(T)return 0}}let y=Math.max(l+sie,o+rie);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${y}`),this.moved=!0,r.currentTime=y,!(e!=null&&e.gap)){let v=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${y}`),E={type:Ne.MEDIA_ERROR,details:Q.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:v,reason:v.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?E.part=e:E.frag=e),this.hls.trigger(I.ERROR,E)}return y}}return 0}_tryNudgeBuffer(e){let{hls:t,media:i,nudgeRetry:r}=this,s=t?.config;if(!i||!s)return 0;let o=i.currentTime;if(this.nudgeRetry++,r<s.nudgeMaxRetry){let a=o+(r+1)*s.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),i.currentTime=a,t.trigger(I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{let a=new Error(`Playhead still not moving while enough data buffered @${o} after ${s.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}};function nU(n,e){let t=iU(n.main);if(t&&t.start<=e)return t;let i=iU(n.audio);return i&&i.start<=e?i:null}function iU(n){if(!n)return null;switch(n.state){case re.IDLE:case re.STOPPED:case re.ENDED:case re.ERROR:return null}return n.frag}function m_(n,e){return e.getAppendedFrag(n,De.MAIN)||e.getPartialFragment(n)}var aie=.25;function jD(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function xA(n,e,t,i,r){let s=new n(e,t,"");try{s.value=i,r&&(s.type=r)}catch{s=new n(e,t,Zt(r?zt({type:r},i):i))}return s}var g_=(()=>{let n=jD();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})(),GD=class{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(I.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){let{hls:e}=this;e&&(e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){let{hls:e}=this;e&&(e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;let t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Kd(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){let t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){let i=e[t];if(i.kind==="metadata"&&i.label==="id3")return m$(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;let{enableEmsgMetadataCues:i,enableID3MetadataCues:r}=this.hls.config;if(!i&&!r)return;let{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));let o=jD();if(o)for(let a=0;a<s.length;a++){let l=s[a].type;if(l===yr.emsg&&!i||!r)continue;let u=qU(s[a].data),d=s[a].pts,f=d+s[a].duration;f>g_&&(f=g_),f-d<=0&&(f=d+aie);for(let y=0;y<u.length;y++){let v=u[y];if(!WU(v)){this.updateId3CueEnds(d,l);let E=xA(o,d,f,v,l);E&&this.id3Track.addCue(E)}}}}updateId3CueEnds(e,t){var i;let r=(i=this.id3Track)==null?void 0:i.cues;if(r)for(let s=r.length;s--;){let o=r[s];o.type===t&&o.startTime<e&&o.endTime===g_&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:r}){let{id3Track:s,hls:o}=this;if(!o)return;let{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(s&&(a||l)){let u;r==="audio"?u=d=>d.type===yr.audioId3&&l:r==="video"?u=d=>d.type===yr.emsg&&a:u=d=>d.type===yr.audioId3&&l||d.type===yr.emsg&&a,wD(s,t,i,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;let{assetPlayerId:i,timelineOffset:r,enableDateRangeMetadataCues:s,interstitialsController:o}=this.hls.config;if(!s)return;let a=jD();if(i&&r&&!o){let{fragmentStart:E,fragmentEnd:T}=e,C=this.assetCue;C?(C.startTime=E,C.endTime=T):a&&(C=this.assetCue=xA(a,E,T,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),C&&(C.id=i,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(C),C.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;let{id3Track:l}=this,{dateRanges:u}=e,d=Object.keys(u),f=this.dateRangeCuesAppended;if(l&&t){var m;if((m=l.cues)!=null&&m.length){let E=Object.keys(f).filter(T=>!d.includes(T));for(let T=E.length;T--;){var y;let C=E[T],D=(y=f[C])==null?void 0:y.cues;delete f[C],D&&Object.keys(D).forEach(P=>{let V=D[P];if(V){V.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(V)}catch{}}})}}else f=this.dateRangeCuesAppended={}}let v=e.fragments[e.fragments.length-1];if(!(d.length===0||!Ie(v?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let E=0;E<d.length;E++){let T=d[E],C=u[T],D=C.startTime,P=f[T],V=P?.cues||{},G=P?.durationKnown||!1,H=g_,{duration:A,endDate:x}=C;if(x&&A!==null)H=D+A,G=!0;else if(C.endOnNext&&!G){let M=d.reduce((F,j)=>{if(j!==C.id){let B=u[j];if(B.class===C.class&&B.startDate>C.startDate&&(!F||C.startDate<F.startDate))return B}return F},null);M&&(H=M.startTime,G=!0)}let R=Object.keys(C.attr);for(let M=0;M<R.length;M++){let F=R[M];if(!dee(F))continue;let j=V[F];if(j)G&&!(P!=null&&P.durationKnown)?j.endTime=H:Math.abs(j.startTime-D)>.01&&(j.startTime=D,j.endTime=H);else if(a){let B=C.attr[F];hee(F)&&(B=aU(B));let we=xA(a,D,H,{key:F,data:B},yr.dateRange);we&&(we.id=T,this.id3Track.addCue(we),V[F]=we,o&&(F==="X-ASSET-LIST"||F==="X-ASSET-URL")&&we.addEventListener("enter",this.onEventCueEnter))}}f[T]={cues:V,dateRange:C,durationKnown:G}}}}},zD=class{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{let{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;let r=this.computeLatency();if(r===null)return;this._latency=r;let{lowLatencyMode:s,maxLiveSyncPlaybackRate:o}=this.config;if(!s||o===1||!i.live)return;let a=this.targetLatency;if(a===null)return;let l=r-a,u=Math.min(this.maxLatency,a+i.targetduration);if(l<u&&l>.05&&this.forwardBufferLength>1){let f=Math.min(2,Math.max(1,o)),m=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,y=Math.min(f,Math.max(1,m));this.changeMediaPlaybackRate(t,y)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){let{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;let t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){let e=this.levelDetails;if(e===null||this.hls===null)return null;let{holdBack:t,partHoldBack:i,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig,u=a&&i||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=s!==void 0?s:o*r);let d=r;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,d)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){let e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;let i=this.levelDetails;if(i===null)return null;let r=i.edge,s=e-t-this.edgeStalled,o=r-i.totalduration,a=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(o,s),a)}get drift(){let e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){let e=this.levelDetails;if(e===null)return 0;let t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){let{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;let i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){let{hls:e}=this;e&&(e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.ERROR,this.onError,this))}unregisterListeners(){let{hls:e}=this;e&&(e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===Q.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,r;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){let e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){let e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}},HD=class extends Jp{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this),e.on(I.ERROR,this.onError,this)}_unregisterListeners(){let{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this),e.off(I.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){let i=this.hls.config.preferManagedMediaSource,r=[],s={},o={},a=!1,l=!1,u=!1;t.levels.forEach(d=>{let f=d.attrs,{audioCodec:m,videoCodec:y}=d;m&&(d.audioCodec=m=C_(m,i)||void 0),y&&(y=d.videoCodec=OJ(y));let{width:v,height:E,unknownCodecs:T}=d,C=T?.length||0;if(a||(a=!!(v&&E)),l||(l=!!y),u||(u=!!m),C||m&&!this.isAudioSupported(m)||y&&!this.isVideoSupported(y)){this.log(`Some or all CODECS not supported "${f.CODECS}"`);return}let{CODECS:D,"FRAME-RATE":P,"HDCP-LEVEL":V,"PATHWAY-ID":G,RESOLUTION:H,"VIDEO-RANGE":A}=f,R=`${`${G||"."}-`}${d.bitrate}-${H}-${P}-${D}-${A}-${V}`;if(s[R])if(s[R].uri!==d.url&&!d.attrs["PATHWAY-ID"]){let M=o[R]+=1;d.attrs["PATHWAY-ID"]=new Array(M+1).join(".");let F=this.createLevel(d);s[R]=F,r.push(F)}else s[R].addGroupId("audio",f.AUDIO),s[R].addGroupId("text",f.SUBTITLES);else{let M=this.createLevel(d);s[R]=M,o[R]=1,r.push(M)}}),this.filterAndSortMediaOptions(r,t,a,l,u)}createLevel(e){let t=new jc(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){let r=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(r.message),t.supportedResult=vU(r,[])}return t}isAudioSupported(e){return zp(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return zp(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,r,s){var o;let a=[],l=[],u=e,d=((o=t.stats)==null?void 0:o.parsing)||{};if((i||r)&&s&&(u=u.filter(({videoCodec:D,videoRange:P,width:V,height:G})=>(!!D||!!(V&&G))&&HJ(P))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let D="no level with compatible codecs found in manifest",P=D;t.levels.length&&(P=`one or more CODECS in variant not supported: ${Zt(t.levels.map(G=>G.attrs.CODECS).filter((G,H,A)=>A.indexOf(G)===H))}`,this.warn(P),D+=` (${P})`);let V=new Error(D);this.hls.trigger(I.ERROR,{type:Ne.MEDIA_ERROR,details:Q.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:V,reason:P})}}),d.end=performance.now();return}t.audioTracks&&(a=t.audioTracks.filter(D=>!D.audioCodec||this.isAudioSupported(D.audioCodec)),rU(a)),t.subtitles&&(l=t.subtitles,rU(l));let f=u.slice(0);u.sort((D,P)=>{if(D.attrs["HDCP-LEVEL"]!==P.attrs["HDCP-LEVEL"])return(D.attrs["HDCP-LEVEL"]||"")>(P.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&D.height!==P.height)return D.height-P.height;if(D.frameRate!==P.frameRate)return D.frameRate-P.frameRate;if(D.videoRange!==P.videoRange)return x_.indexOf(D.videoRange)-x_.indexOf(P.videoRange);if(D.videoCodec!==P.videoCodec){let V=eB(D.videoCodec),G=eB(P.videoCodec);if(V!==G)return G-V}if(D.uri===P.uri&&D.codecSet!==P.codecSet){let V=S_(D.codecSet),G=S_(P.codecSet);if(V!==G)return G-V}return D.averageBitrate!==P.averageBitrate?D.averageBitrate-P.averageBitrate:0});let m=f[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==f.length)){for(let D=0;D<f.length;D++)if(f[D].pathwayId===u[0].pathwayId){m=f[D];break}}this._levels=u;for(let D=0;D<u.length;D++)if(u[D]===m){var y;this._firstLevel=D;let P=m.bitrate,V=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${P}`),((y=this.hls.userConfig)==null?void 0:y.abrEwmaDefaultEstimate)===void 0){let G=Math.min(P,this.hls.config.abrEwmaDefaultEstimateMax);G>V&&V===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=G)}break}let v=s&&!r,E=this.hls.config,T=!!(E.audioStreamController&&E.audioTrackController),C={levels:u,audioTracks:a,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:r,altAudio:T&&!v&&a.some(D=>!!D.url)};d.end=performance.now(),this.hls.trigger(I.MANIFEST_PARSED,C)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){let t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){let d=new Error("invalid level idx"),f=e<0;if(this.hls.trigger(I.ERROR,{type:Ne.OTHER_ERROR,details:Q.LEVEL_SWITCH_ERROR,level:e,fatal:f,error:d,reason:d.message}),f)return;e=Math.min(e,t.length-1)}let i=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,i===e&&r&&s===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${i}${s?" with Pathway "+s:""}`);let l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(I.LEVEL_SWITCHING,l);let u=o.details;if(!u||u.live){let d=this.switchParams(o.uri,r?.details,u);this.loadPlaylist(d)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){let e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){let t=this.steering.pathways(),i=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===mt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===De.MAIN){let i=t.elementaryStreams;if(!Object.keys(i).some(s=>!!i[s]))return;let r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var i;let{level:r,details:s}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${r}`),(a=t.deliveryDirectives)!=null&&a.skip&&(s.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(r,t,l)}else(i=t.deliveryDirectives)!=null&&i.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);let i=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],o=e.details,a=o?.age;this.log(`Loading level index ${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(I.LEVEL_LOADING,{url:i,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;let i=this._levels.filter((s,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(a=>a.level=-1)),!1));FU(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);let r=i.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(I.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){let{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(I.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}};function rU(n){let e={};n.forEach(t=>{let i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function C$(){return self.SourceBuffer||self.WebKitSourceBuffer}function x$(){if(!fl())return!1;let e=C$();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function lie(){if(!x$())return!1;let n=fl();return typeof n?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Hp(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Hp(e,"audio"))))}function cie(){var n;let e=C$();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}var uie=100,qD=class extends Kp{constructor(e,t,i){super(e,t,i,"stream-controller",De.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{let r=this.media,s=r?r.currentTime:null;if(s===null||!Ie(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;let o=this.getFwdBufferInfoAtPos(r,s,De.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();let{hls:e}=this;e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(I.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(I.BUFFER_CREATED,this.onBufferCreated,this),e.on(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();let{hls:e}=this;e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(I.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(I.BUFFER_CREATED,this.onBufferCreated,this),e.off(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){let{lastCurrentTime:i,hls:r}=this;if(this.stopLoad(),this.setInterval(uie),this.level=-1,!this.startFragRequested){let s=r.startLevel;s===-1&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.firstAutoLevel),r.nextLoadLevel=s,this.level=r.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=re.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=re.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case re.WAITING_LEVEL:{let{levels:e,level:t}=this,i=e?.[t],r=i?.details;if(r&&(!r.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(r))break;this.state=re.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=re.IDLE;break}break}case re.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===re.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){let{hls:e,levelLastLoaded:t,levels:i,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;let s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[s]))return;let o=i[s],a=this.getMainFwdBufferInfo();if(a===null)return;let l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){let E={};this.altAudio===2&&(E.type="video"),this.hls.trigger(I.BUFFER_EOS,E),this.state=re.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;let u=o.details;if(!u||this.state===re.WAITING_LEVEL||this.waitForLive(o)){this.level=s,this.state=re.WAITING_LEVEL,this.startFragRequested=!1;return}let d=a.len,f=this.getMaxBufferLength(o.maxBitrate);if(d>=f)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);let m=this.backtrackFragment?this.backtrackFragment.start:a.end,y=this.getNextFragment(m,u);if(this.couldBacktrack&&!this.fragPrevious&&y&&In(y)&&this.fragmentTracker.getState(y)!==$n.OK){var v;let T=((v=this.backtrackFragment)!=null?v:y).sn-u.startSN,C=u.fragments[T-1];C&&y.cc===C.cc&&(y=C,this.fragmentTracker.removeFragment(C))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(y&&this.isLoopLoading(y,m)){if(!y.gap){let T=this.audioOnly&&!this.altAudio?Qt.AUDIO:Qt.VIDEO,C=(T===Qt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;C&&this.afterBufferFlushed(C,T,De.MAIN)}y=this.getNextFragmentLoopLoading(y,u,a,De.MAIN,f)}y&&(y.initSegment&&!y.initSegment.data&&!this.bitrateTest&&(y=y.initSegment),this.loadFragment(y,o,m))}loadFragment(e,t,i){let r=this.fragmentTracker.getState(e);r===$n.NOT_LOADED||r===$n.PARTIAL?In(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,De.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){let{levels:e,media:t}=this;if(t!=null&&t.readyState){let i,r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);let s=this.getLevelDetails();if(s!=null&&s.live){let a=this.getMainFwdBufferInfo();if(!a||a.len<s.targetduration*2)return}if(!t.paused&&e){let a=this.hls.nextLoadLevel,l=e[a],u=this.fragLastKbps;u&&this.fragCurrent?i=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:i=0}else i=0;let o=this.getBufferedFrag(t.currentTime+i);if(o){let a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();let l=a.maxStartPTS?a.maxStartPTS:a.start,u=a.duration,d=Math.max(o.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(d,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){let e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case re.KEY_LOADING:case re.FRAG_LOADING:case re.FRAG_LOADING_WAITING_RETRY:case re.PARSING:case re.PARSED:this.state=re.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);let i=t.media;Ri(i,"playing",this.onMediaPlaying),Ri(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){let{media:i}=this;i&&(Hi(i,"playing",this.onMediaPlaying),Hi(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(I.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,r=!1;for(let s=0;s<t.levels.length;s++){let o=t.levels[s].audioCodec;o&&(i=i||o.indexOf("mp4a.40.2")!==-1,r=r||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=i&&r&&!cie(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){let{levels:i}=this;if(!i||this.state!==re.IDLE)return;let r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=re.WAITING_LEVEL)}onLevelLoaded(e,t){var i;let{levels:r,startFragRequested:s}=this,o=t.level,a=t.details,l=a.totalduration;if(!r){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);let u=t.levelInfo,d=this.fragCurrent;d&&(this.state===re.FRAG_LOADING||this.state===re.FRAG_LOADING_WAITING_RETRY)&&d.level!==t.level&&d.loader&&this.abortCurrentFrag();let f=0;if(a.live||(i=u.details)!=null&&i.live){var m;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;f=this.alignPlaylists(a,u.details,(m=this.levelLastLoaded)==null?void 0:m.details)}if(u.details=a,this.levelLastLoaded=u,s||this.setStartPosition(a,f),this.hls.trigger(I.LEVEL_UPDATED,{details:a,level:o}),this.state===re.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=re.IDLE}s&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){let{config:t,media:i}=this;if(!i)return;let r=this.hls.liveSyncPosition,s=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=s>=o-t.maxFragLookUpTolerance&&s<=a;if(r!==null&&i.duration>r&&(s<r||!l)){let d=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&i.readyState<4||s<a-d)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),i.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;let f=lt.bufferInfo(i,r,0);if(!((u=f.buffered)!=null&&u.length)){i.currentTime=r;return}if(f.start<=s){i.currentTime=r;return}let{nextStart:y}=lt.bufferedInfo(f.buffered,s,0);y&&(i.currentTime=y)}else i.currentTime=r}}_handleFragmentLoadProgress(e){var t;let i=e.frag,{part:r,payload:s}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}let a=o[i.level];if(!a){this.warn(`Level ${i.level} not found on progress`);return}let l=a.details;if(!l){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}let u=a.videoCodec,d=l.PTSKnown||!l.live,f=(t=i.initSegment)==null?void 0:t.data,m=this._getAudioCodec(a),y=this.transmuxer=this.transmuxer||new $_(this.hls,De.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),v=r?r.index:-1,E=v!==-1,T=new Wp(i.level,i.sn,i.stats.chunkCount,s.byteLength,v,E),C=this.initPTS[i.cc];y.push(s,f,m,u,i,r,l.totalduration,d,T,C)}onAudioTrackSwitching(e,t){let i=this.hls,r=this.altAudio!==0;if(D_(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;let o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.altAudio=0,this.fragmentTracker.removeAllFragments(),i.once(I.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(I.AUDIO_TRACK_SWITCHED,t)}),i.trigger(I.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(I.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){let i=D_(t.url,this.hls);if(i){let r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){let i=t.tracks,r,s,o=!1;for(let a in i){let l=i[a];if(l.id==="main"){if(s=a,r=l,a==="video"){let u=i[a];u&&(this.videoBuffer=u.buffer)}}else o=!0}o&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){let{frag:i,part:r}=t,s=i.type===De.MAIN;if(s){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===re.PARSED&&(this.state=re.IDLE);return}let a=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),In(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}let o=this.media;o&&(!this._hasEnoughToStart&&lt.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=re.ERROR;return}switch(t.details){case Q.FRAG_GAP:case Q.FRAG_PARSING_ERROR:case Q.FRAG_DECRYPT_ERROR:case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(De.MAIN,t);break;case Q.LEVEL_LOAD_ERROR:case Q.LEVEL_LOAD_TIMEOUT:case Q.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===re.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===mt.LEVEL&&(this.state=re.IDLE);break;case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Q.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Q.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=re.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Qt.AUDIO||!this.altAudio){let i=(t===Qt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,De.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){let{media:e}=this;if(!e)return;let t=e.currentTime,i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}let r=this.timelineOffset;r&&i&&(i+=r);let s=this.getLevelDetails(),o=lt.getBuffered(e),a=o.length?o.start(0):0,l=a-i,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<u||this.loadingParts&&l<2*(s?.partTarget||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),i+=l,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${a}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{let{hls:r}=this,s=i?.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=re.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;let o=s.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),r.trigger(I.FRAG_LOADED,i),s.bitrateTest=!1}).catch(i=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){let t=this.playlistType,{hls:i}=this,{remuxResult:r,chunkMeta:s}=e,o=this.getCurrentContext(s);if(!o){this.resetWhenMissingContext(s);return}let{frag:a,part:l,level:u}=o,{video:d,text:f,id3:m,initSegment:y}=r,{details:v}=u,E=this.altAudio?void 0:r.audio;if(this.fragContextChanged(a)){this.fragmentTracker.removeFragment(a);return}if(this.state=re.PARSING,y){let T=y.tracks;if(T){let V=a.initSegment||a;if(this.unhandledEncryptionError(y,a))return;this._bufferInitSegment(u,T,V,s),i.trigger(I.FRAG_PARSING_INIT_SEGMENT,{frag:V,id:t,tracks:T})}let C=y.initPTS,D=y.timescale,P=this.initPTS[a.cc];if(Ie(C)&&(!P||P.baseTime!==C||P.timescale!==D)){let V=y.trackId;this.initPTS[a.cc]={baseTime:C,timescale:D,trackId:V},i.trigger(I.INIT_PTS_FOUND,{frag:a,id:t,initPTS:C,timescale:D,trackId:V})}}if(d&&v){E&&d.type==="audiovideo"&&this.logMuxedErr(a);let T=v.fragments[a.sn-1-v.startSN],C=a.sn===v.startSN,D=!T||a.cc>T.cc;if(r.independent!==!1){let{startPTS:P,endPTS:V,startDTS:G,endDTS:H}=d;if(l)l.elementaryStreams[d.type]={startPTS:P,endPTS:V,startDTS:G,endDTS:H};else if(d.firstKeyFrame&&d.independent&&s.id===1&&!D&&(this.couldBacktrack=!0),d.dropped&&d.independent){let A=this.getMainFwdBufferInfo(),x=(A?A.end:this.getLoadPosition())+this.config.maxBufferHole,R=d.firstKeyFramePTS?d.firstKeyFramePTS:P;if(!C&&x<R-this.config.maxBufferHole&&!D){this.backtrack(a);return}else D&&(a.gap=!0);a.setElementaryStreamInfo(d.type,a.start,V,a.start,H,!0)}else C&&P-(v.appliedTimelineOffset||0)>b_&&(a.gap=!0);a.setElementaryStreamInfo(d.type,P,V,G,H),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(d,a,l,s,C||D)}else if(C||D)a.gap=!0;else{this.backtrack(a);return}}if(E){let{startPTS:T,endPTS:C,startDTS:D,endDTS:P}=E;l&&(l.elementaryStreams[Qt.AUDIO]={startPTS:T,endPTS:C,startDTS:D,endDTS:P}),a.setElementaryStreamInfo(Qt.AUDIO,T,C,D,P),this.bufferFragmentData(E,a,l,s)}if(v&&m!=null&&m.samples.length){let T={id:t,frag:a,details:v,samples:m.samples};i.trigger(I.FRAG_PARSING_METADATA,T)}if(v&&f){let T={id:t,frag:a,details:v,samples:f.samples};i.trigger(I.FRAG_PARSING_USERDATA,T)}}logMuxedErr(e){this.warn(`${In(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,r){if(this.state!==re.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));let{audio:s,video:o,audiovideo:a}=t;if(s){let u=e.audioCodec,d=y_(s.codec,u);d==="mp4a"&&(d="mp4a.40.5");let f=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){d&&(d.indexOf("mp4a.40.5")!==-1?d="mp4a.40.2":d="mp4a.40.5");let m=s.metadata;m&&"channelCount"in m&&(m.channelCount||1)!==1&&f.indexOf("firefox")===-1&&(d="mp4a.40.5")}d&&d.indexOf("mp4a.40.5")!==-1&&f.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(d="mp4a.40.2",this.log(`Android: force audio codec to ${d}`)),u&&u!==d&&this.log(`Swapping manifest audio codec "${u}" for "${d}"`),s.levelCodec=d,s.id=De.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${d||""}/${u||""}/${s.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=De.MAIN;let u=o.codec;if(u?.length===4)switch(u){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${o.codec!==u?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);let l=Object.keys(t);if(l.length){if(this.hls.trigger(I.BUFFER_CODECS,t),!this.hls)return;l.forEach(u=>{let f=t[u].initSegment;f!=null&&f.byteLength&&this.hls.trigger(I.BUFFER_APPENDING,{type:u,data:f,frag:i,part:null,chunkMeta:r,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){let e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,De.MAIN)}get maxBufferLength(){let{levels:e,level:t}=this,i=e?.[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=re.IDLE}checkFragmentChanged(){let e=this.media,t=null;if(e&&e.readyState>1&&e.seeking===!1){let i=e.currentTime;if(lt.isBuffered(e,i)?t=this.getAppendedFrag(i):lt.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;let r=this.fragPlaying,s=t.level;(!r||t.sn!==r.sn||r.level!==s)&&(this.fragPlaying=t,this.hls.trigger(I.FRAG_CHANGED,{frag:t}),(!r||r.level!==s)&&this.hls.trigger(I.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){let e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;let t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Ie(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;let t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Ie(t)){let i=this.getLevelDetails(),r=this.currentFrag||(i?Gc(null,i.fragments,t):null);if(r){let s=r.programDateTime;if(s!==null){let o=s+(t-r.start)*1e3;return new Date(o)}}}return null}get currentLevel(){let e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){let e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}},WD=class extends qi{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(let i in this.keyIdToKeyInfo){let r=this.keyIdToKeyInfo[i].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(let e in this.keyIdToKeyInfo){let t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(let e in this.keyIdToKeyInfo){let t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=Q.KEY_LOAD_ERROR,i,r,s){return new us({type:Ne.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:i,networkDetails:r})}loadClear(e,t,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,s=t.length;r<s;r++){let o=t[r];if(e.cc<=o.cc&&(!In(e)||!In(o)||e.sn<o.sn)||!i&&r==s-1)return this.emeController.selectKeySystemFormat(o).then(a=>{if(!this.emeController)return;o.setKeyFormat(a);let l=__(a);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){let r=Vp(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,r;t&&e.setKeyFormat(t);let s=e.decryptdata;if(!s){let u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,u))}let o=s.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let a=AA(s),l=this.keyIdToKeyInfo[a];if((i=l)!=null&&i.decryptdata.key)return s.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(r=l)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(d=>{let{keyInfo:f}=d;return s.key=f.decryptdata.key,{frag:e,keyInfo:f}})}switch(this.log(`${this.keyIdToKeyInfo[a]?"Rel":"L"}oading${s.keyId?" keyId: "+ri(s.keyId):""} URI: ${s.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){let i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&(r=t.initSegment)!=null&&r.data){let o=bJ(t.initSegment.data);if(o.length){let a=o[0];a.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${ri(a)}`),th.setKeyIdForUri(e.decryptdata.uri,a)):(a=th.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${ri(a)}`)),e.decryptdata.keyId=a}}if(!e.decryptdata.keyId&&!In(t))return Promise.resolve(i);let s=this.emeController.loadKey(i);return(e.keyLoadPromise=s.then(o=>(e.mediaKeySessionContext=o,i))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(i)}loadKeyHTTP(e,t){let i=this.config,r=i.loader,s=new r(i);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((o,a)=>{let l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=i.keyLoadPolicy.default,d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(m,y,v,E)=>{let{frag:T,keyInfo:C}=v,D=AA(C.decryptdata);if(!T.decryptdata||C!==this.keyIdToKeyInfo[D])return a(this.createKeyLoadError(T,Q.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),E));C.decryptdata.key=T.decryptdata.key=new Uint8Array(m.data),T.keyLoader=null,C.loader=null,o({frag:T,keyInfo:C})},onError:(m,y,v,E)=>{this.resetLoader(y),a(this.createKeyLoadError(t,Q.KEY_LOAD_ERROR,new Error(`HTTP Error ${m.code} loading key ${m.text}`),v,zt({url:l.url,data:void 0},m)))},onTimeout:(m,y,v)=>{this.resetLoader(y),a(this.createKeyLoadError(t,Q.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),v))},onAbort:(m,y,v)=>{this.resetLoader(y),a(this.createKeyLoadError(t,Q.INTERNAL_ABORTED,new Error("key loading aborted"),v))}};s.load(l,d,f)})}resetLoader(e){let{frag:t,keyInfo:i,url:r}=e,s=i.loader;t.keyLoader===s&&(t.keyLoader=null,i.loader=null);let o=AA(i.decryptdata)||r;delete this.keyIdToKeyInfo[o],s&&s.destroy()}};function AA(n){if(n.keyFormat!==si.FAIRPLAY){let e=n.keyId;if(e)return ri(e)}return n.uri}function sU(n){let{type:e}=n;switch(e){case mt.AUDIO_TRACK:return De.AUDIO;case mt.SUBTITLE_TRACK:return De.SUBTITLE;default:return De.MAIN}}function DA(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}var KD=class{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){let{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(I.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){let{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(I.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){let t=this.hls.config,i=t.pLoader,r=t.loader,s=i||r,o=new s(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(let e in this.loaders){let t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){let{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:mt.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){let{id:i,level:r,pathwayId:s,url:o,deliveryDirectives:a,levelInfo:l}=t;this.load({id:i,level:r,pathwayId:s,responseType:"text",type:mt.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,t){let{id:i,groupId:r,url:s,deliveryDirectives:o,track:a}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:mt.AUDIO_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){let{id:i,groupId:r,url:s,deliveryDirectives:o,track:a}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:mt.SUBTITLE_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){let i=this.loaders[mt.LEVEL];if(i){let r=i.context;r&&!t.levels.some(s=>s===r.levelOrTrack)&&(i.abort(),delete this.loaders[mt.LEVEL])}}load(e){var t;let i=this.hls.config,r=this.getInternalLoader(e);if(r){let u=this.hls.logger,d=r.context;if(d&&d.levelOrTrack===e.levelOrTrack&&(d.url===e.url||d.deliveryDirectives&&!e.deliveryDirectives)){d.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${d.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let s;if(e.type===mt.MANIFEST?s=i.manifestLoadPolicy.default:s=Wt({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),Ie((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===mt.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===mt.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===mt.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){let d=u.partTarget,f=u.targetduration;if(d&&f){let m=Math.max(d*3,f*.8)*1e3;s=Wt({},s,{maxTimeToFirstByteMs:Math.min(m,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(m,s.maxTimeToFirstByteMs)})}}}let o=s.errorRetry||s.timeoutRetry||{},a={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(u,d,f,m)=>{let y=this.getInternalLoader(f);this.resetInternalLoader(f.type);let v=u.data;d.parsing.start=performance.now(),Bc.isMediaPlaylist(v)||f.type!==mt.MANIFEST?this.handleTrackOrLevelPlaylist(u,d,f,m||null,y):this.handleMasterPlaylist(u,d,f,m)},onError:(u,d,f,m)=>{this.handleNetworkError(d,f,!1,u,m)},onTimeout:(u,d,f)=>{this.handleNetworkError(d,f,!0,void 0,u)}};r.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;let{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,r){let s=this.hls,o=e.data,a=DA(e,i),l=Bc.parseMasterPlaylist(o,a);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,i,l.playlistParsingError,r,t);return}let{contentSteering:u,levels:d,sessionData:f,sessionKeys:m,startTimeOffset:y,variableList:v}=l;this.variableList=v,d.forEach(D=>{let{unknownCodecs:P}=D;if(P){let{preferManagedMediaSource:V}=this.hls.config,{audioCodec:G,videoCodec:H}=D;for(let A=P.length;A--;){let x=P[A];zp(x,"audio",V)?(D.audioCodec=G=G?`${G},${x}`:x,eh.audio[G.substring(0,4)]=2,P.splice(A,1)):zp(x,"video",V)&&(D.videoCodec=H=H?`${H},${x}`:x,eh.video[H.substring(0,4)]=2,P.splice(A,1))}}});let{AUDIO:E=[],SUBTITLES:T,"CLOSED-CAPTIONS":C}=Bc.parseMasterPlaylistMedia(o,a,l);E.length&&!E.some(P=>!P.url)&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),E.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new hn({}),bitrate:0,url:""})),s.trigger(I.MANIFEST_LOADED,{levels:d,audioTracks:E,subtitles:T,captions:C,contentSteering:u,url:a,stats:t,networkDetails:r,sessionData:f,sessionKeys:m,startTimeOffset:y,variableList:v})}handleTrackOrLevelPlaylist(e,t,i,r,s){let o=this.hls,{id:a,level:l,type:u}=i,d=DA(e,i),f=Ie(l)?l:Ie(a)?a:0,m=sU(i),y=Bc.parseLevelPlaylist(e.data,d,f,m,0,this.variableList);if(u===mt.MANIFEST){let v={attrs:new hn({}),bitrate:0,details:y,name:"",url:d};y.requestScheduled=t.loading.start+LU(y,0),o.trigger(I.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:d,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=y,this.handlePlaylistLoaded(y,e,t,i,r,s)}handleManifestParsingError(e,t,i,r,s){this.hls.trigger(I.ERROR,{type:Ne.NETWORK_ERROR,details:Q.MANIFEST_PARSING_ERROR,fatal:t.type===mt.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:r,stats:s})}handleNetworkError(e,t,i=!1,r,s){let o=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===mt.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===mt.AUDIO_TRACK||e.type===mt.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);let a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=Q.UNKNOWN,u=!1,d=this.getInternalLoader(e);switch(e.type){case mt.MANIFEST:l=i?Q.MANIFEST_LOAD_TIMEOUT:Q.MANIFEST_LOAD_ERROR,u=!0;break;case mt.LEVEL:l=i?Q.LEVEL_LOAD_TIMEOUT:Q.LEVEL_LOAD_ERROR,u=!1;break;case mt.AUDIO_TRACK:l=i?Q.AUDIO_TRACK_LOAD_TIMEOUT:Q.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case mt.SUBTITLE_TRACK:l=i?Q.SUBTITLE_TRACK_LOAD_TIMEOUT:Q.SUBTITLE_LOAD_ERROR,u=!1;break}d&&this.resetInternalLoader(e.type);let f={type:Ne.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:d,context:e,error:a,networkDetails:t,stats:s};if(r){let m=t?.url||e.url;f.response=zt({url:m,data:void 0},r)}this.hls.trigger(I.ERROR,f)}handlePlaylistLoaded(e,t,i,r,s,o){let a=this.hls,{type:l,level:u,levelOrTrack:d,id:f,groupId:m,deliveryDirectives:y}=r,v=DA(t,r),E=sU(r),T=typeof r.level=="number"&&E===De.MAIN?u:void 0,C=e.playlistParsingError;if(C){if(this.hls.logger.warn(`${C} ${e.url}`),!a.config.ignorePlaylistParsingErrors){a.trigger(I.ERROR,{type:Ne.NETWORK_ERROR,details:Q.LEVEL_PARSING_ERROR,fatal:!1,url:v,error:C,reason:C.message,response:t,context:r,level:T,parent:E,networkDetails:s,stats:i});return}e.playlistParsingError=null}if(!e.fragments.length){let D=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(I.ERROR,{type:Ne.NETWORK_ERROR,details:Q.LEVEL_EMPTY_ERROR,fatal:!1,url:v,error:D,reason:D.message,response:t,context:r,level:T,parent:E,networkDetails:s,stats:i});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case mt.MANIFEST:case mt.LEVEL:if(T){if(!d)T=0;else if(d!==a.levels[T]){let D=a.levels.indexOf(d);D>-1&&(T=D)}}a.trigger(I.LEVEL_LOADED,{details:e,levelInfo:d||a.levels[0],level:T||0,id:f||0,stats:i,networkDetails:s,deliveryDirectives:y,withoutMultiVariant:l===mt.MANIFEST});break;case mt.AUDIO_TRACK:a.trigger(I.AUDIO_TRACK_LOADED,{details:e,track:d,id:f||0,groupId:m||"",stats:i,networkDetails:s,deliveryDirectives:y});break;case mt.SUBTITLE_TRACK:a.trigger(I.SUBTITLE_TRACK_LOADED,{details:e,track:d,id:f||0,groupId:m||"",stats:i,networkDetails:s,deliveryDirectives:y});break}}},ml=(()=>{class n{static get version(){return Yp}static isMSESupported(){return x$()}static isSupported(){return lie()}static getMediaSource(){return fl()}static get Events(){return I}static get MetadataSchema(){return yr}static get ErrorTypes(){return Ne}static get ErrorDetails(){return Q}static get DefaultConfig(){return n.defaultConfig?n.defaultConfig:eie}static set DefaultConfig(t){n.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new n1,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;let i=this.logger=hJ(t.debug||!1,"Hls instance",t.assetPlayerId),r=this.config=nie(n.DefaultConfig,t,i);this.userConfig=t,r.progressive&&iie(r,i);let{abrController:s,bufferController:o,capLevelController:a,errorController:l,fpsController:u}=r,d=new l(this),f=this.abrController=new s(this),m=new BA(this),y=r.interstitialsController,v=y?this.interstitialsController=new y(this,n):null,E=this.bufferController=new o(this,m),T=this.capLevelController=new a(this),C=new u(this),D=new KD(this),P=r.contentSteeringController,V=P?new P(this):null,G=this.levelController=new HD(this,V),H=new GD(this),A=new WD(this.config,this.logger),x=this.streamController=new qD(this,m,A),R=this.gapController=new $D(this,m);T.setStreamController(x),C.setStreamController(x);let M=[D,G,x];v&&M.splice(1,0,v),V&&M.splice(1,0,V),this.networkControllers=M;let F=[f,E,R,T,C,H,m];this.audioTrackController=this.createController(r.audioTrackController,M);let j=r.audioStreamController;j&&M.push(this.audioStreamController=new j(this,m,A)),this.subtitleTrackController=this.createController(r.subtitleTrackController,M);let B=r.subtitleStreamController;B&&M.push(this.subtititleStreamController=new B(this,m,A)),this.createController(r.timelineController,F),A.emeController=this.emeController=this.createController(r.emeController,F),this.cmcdController=this.createController(r.cmcdController,F),this.latencyController=this.createController(zD,F),this.coreComponents=F,M.push(d);let ge=d.onErrorOut;typeof ge=="function"&&this.on(I.ERROR,ge,d),this.on(I.MANIFEST_LOADED,D.onManifestLoaded,D)}createController(t,i){if(t){let r=new t(this);return i&&i.push(r),r}return null}on(t,i,r=this){this._emitter.on(t,i,r)}once(t,i,r=this){this._emitter.once(t,i,r)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,i,r=this,s){this._emitter.off(t,i,r,s)}listeners(t){return this._emitter.listeners(t)}emit(t,i,r){return this._emitter.emit(t,i,r)}trigger(t,i){if(this.config.debug)return this.emit(t,t,i);try{return this.emit(t,t,i)}catch(r){if(this.logger.error("An internal error happened while handling event "+t+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;let s=t===I.ERROR;this.trigger(I.ERROR,{type:Ne.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,fatal:s,event:t,error:r}),this.triggeringException=!1}}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){this.logger.log("destroy"),this.trigger(I.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(i=>i.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(i=>i.destroy()),this.coreComponents.length=0;let t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){if(!t||"media"in t&&!t.media){let o=new Error(`attachMedia failed: invalid argument (${t})`);this.trigger(I.ERROR,{type:Ne.OTHER_ERROR,details:Q.ATTACH_MEDIA_ERROR,fatal:!0,error:o});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());let i="media"in t,r=i?t.media:t,s=i?t:{media:r};this._media=r,this.trigger(I.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(I.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;let t=this.bufferController.transferMedia();return this.trigger(I.MEDIA_DETACHING,{transferMedia:t}),t}loadSource(t){this.stopLoad();let i=this.media,r=this._url,s=this._url=YD.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),i&&r&&(r!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(i)),this.trigger(I.MANIFEST_LOADING,{url:t})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(t=-1,i){this.logger.log(`startLoad(${t+(i?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(t,i),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let t=0;t<this.networkControllers.length&&(this.networkControllers[t].stopLoad(),!(this.started||!this.networkControllers));t++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(t=>{t.resumeBuffering&&t.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(t=>{t.pauseBuffering&&t.pauseBuffering()}))}get inFlightFragments(){let t={[De.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(t[De.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(t[De.SUBTITLE]=this.subtititleStreamController.inFlightFrag),t}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");let t=this._media,i=t?.currentTime;this.detachMedia(),t&&(this.attachMedia(t),i&&this.startLoad(i))}removeLevel(t){this.levelController.removeLevel(t)}get sessionId(){let t=this._sessionId;return t||(t=this._sessionId=wne()),t}get levels(){let t=this.levelController.levels;return t||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){this.logger.log(`set currentLevel:${t}`),this.levelController.manualLevel=t,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){this.logger.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){this.logger.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){this.logger.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){let t=this.levelController.startLevel;return t===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:t}set startLevel(t){this.logger.log(`set startLevel:${t}`),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){let i=!!t;i!==this.config.capLevelToPlayerSize&&(i?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=i)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){let{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}set bandwidthEstimate(t){this.abrController.resetEstimator(t)}get abrEwmaDefaultEstimate(){let{bwEstimator:t}=this.abrController;return t?t.defaultEstimate:NaN}get ttfbEstimate(){let{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(this.logger.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){zJ(t)&&this._maxHdcpLevel!==t&&(this._maxHdcpLevel=t,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){let{levels:t,config:{minAutoBitrate:i}}=this;if(!t)return 0;let r=t.length;for(let s=0;s<r;s++)if(t[s].maxBitrate>=i)return s;return 0}get maxAutoLevel(){let{levels:t,autoLevelCapping:i,maxHdcpLevel:r}=this,s;if(i===-1&&t!=null&&t.length?s=t.length-1:s=i,r)for(let o=s;o--;){let a=t[o].attrs["HDCP-LEVEL"];if(a&&a<=r)return o}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(t){this.abrController.nextAutoLevel=t}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(t){var i;return((i=this.audioTrackController)==null?void 0:i.setAudioOption(t))||null}setSubtitleOption(t){var i;return((i=this.subtitleTrackController)==null?void 0:i.setSubtitleOption(t))||null}get allAudioTracks(){let t=this.audioTrackController;return t?t.allAudioTracks:[]}get audioTracks(){let t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){let t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){let i=this.audioTrackController;i&&(i.audioTrack=t)}get allSubtitleTracks(){let t=this.subtitleTrackController;return t?t.allSubtitleTracks:[]}get subtitleTracks(){let t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){let t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){let i=this.subtitleTrackController;i&&(i.subtitleTrack=t)}get subtitleDisplay(){let t=this.subtitleTrackController;return t?t.subtitleDisplay:!1}set subtitleDisplay(t){let i=this.subtitleTrackController;i&&(i.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(t){this.latencyController.targetLatency=t}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(t){this.levelController.pathwayPriority=t}get bufferedToEnd(){var t;return!!((t=this.bufferController)!=null&&t.bufferedToEnd)}get interstitialsManager(){var t;return((t=this.interstitialsController)==null?void 0:t.interstitialsManager)||null}getMediaDecodingInfo(t,i=this.allAudioTracks){let r=TU(i);return _U(t,r,navigator.mediaCapabilities)}}return n.defaultConfig=void 0,n})();var die=["videoEl"];function hie(n,e){if(n&1){let t=Et();N(0,"video",11,0),he("click",function(r){xe(t);let s=ve();return Ae(s.onVideoTap(r))}),$()}if(n&2){let t=ve();Qe("video-ready",t.isVideoReady),ce("muted",!t.active||t.isMuted)("preload",t.priority==="high"?"auto":"metadata")("poster",t.displayPoster,Jr)}}function fie(n,e){n&1&&(N(0,"div",12)(1,"div",13),ae(2,"div",14)(3,"div",15),$(),N(4,"div",16),ae(5,"div",17)(6,"div",17)(7,"div",17)(8,"div",17),$()())}function pie(n,e){n&1&&(N(0,"div",18),Re(),N(1,"svg",19),ae(2,"path",20),$()())}function mie(n,e){n&1&&(Re(),N(0,"svg",24),ae(1,"path",25),$())}function gie(n,e){n&1&&(Re(),N(0,"svg",24),ae(1,"path",26),$())}function yie(n,e){if(n&1&&(N(0,"div",21)(1,"div",22),Ve(2,mie,2,0,"svg",23)(3,gie,2,0,"svg",23),$()()),n&2){let t=ve();W(2),ce("ngIf",t.isMuted),W(),ce("ngIf",!t.isMuted)}}function vie(n,e){if(n&1&&(N(0,"span",56),ee(1),$()),n&2){let t=ve(2);W(),ut(t.displayLikes)}}function _ie(n,e){if(n&1){let t=Et();N(0,"button",57),he("click",function(r){xe(t);let s=ve(2);return Ae(s.onDelete(r))}),Re(),N(1,"svg",58),ae(2,"path",59)(3,"line",60)(4,"line",61),$()()}}function Eie(n,e){if(n&1){let t=Et();N(0,"div",27)(1,"div",28)(2,"div",29)(3,"div",30)(4,"h3",31),ee(5),$()(),N(6,"p",32),he("click",function(){xe(t);let r=ve();return Ae(r.openGoogleMaps())}),Re(),N(7,"svg",33),ae(8,"path",34)(9,"circle",35),$(),ee(10),N(11,"svg",36),ae(12,"polyline",37),$()(),Be(),N(13,"div",38)(14,"span",39),ee(15),$(),N(16,"span",40),ee(17),$()()()(),N(18,"div",41)(19,"button",42),he("click",function(){xe(t);let r=ve();return Ae(r.toggleLike())}),Re(),N(20,"svg",43),ae(21,"path",44),$(),Ve(22,vie,2,1,"span",45),$(),Be(),N(23,"button",46),he("click",function(){xe(t);let r=ve();return Ae(r.bookmark())}),Re(),N(24,"svg",43),ae(25,"path",47),$()(),Be(),N(26,"button",48),he("click",function(){xe(t);let r=ve();return Ae(r.shareApp())}),Re(),N(27,"svg",49),ae(28,"circle",50)(29,"circle",51)(30,"circle",52)(31,"line",53)(32,"line",54),$()(),Ve(33,_ie,5,0,"button",55),$()()}if(n&2){let t=ve();W(5),ut(t.displayTitle),W(5),Mt(" ",t.displayVendor," "),W(5),Mt("\u20B9",t.displayPrice,""),W(2),Mt("",t.displayDistance," away"),W(2),Qe("liked",t.displayIsLiked),W(),xo("fill",t.displayIsLiked?"currentColor":"none"),W(2),ce("ngIf",t.displayLikes>0),W(),Qe("bookmarked",t.displayIsBookmarked),W(),xo("fill",t.displayIsBookmarked?"currentColor":"none"),W(9),ce("ngIf",t.canDelete)}}function Tie(n,e){if(n&1&&(N(0,"div",62),Re(),N(1,"svg",63),ae(2,"path",64)(3,"circle",65),$(),Be(),N(4,"span",66),ee(5),$()()),n&2){let t=ve();W(5),ut(t.formatViewCount(t.displayViewCount))}}var tm=class n{constructor(e,t,i){this.router=t;this.cdr=i;this.isBrowser=Jw(e)}reel;src="";poster="";title="";vendor="";price="";distance="";active=!1;relativeIndex=0;priority="low";swipeDeltaY=0;isSwiping=!1;likes=0;viewCount=0;isLiked=!1;isBookmarked=!1;liked=new tt;bookmarked=new tt;shared=new tt;deleted=new tt;canDelete=!1;videoEl;lastTapTime=0;showLikeAnimation=!1;isProgressBarVisible=!1;progressBarHideTimeout;singleTapTimeout;hls=null;isBrowser=!1;currentInitSrc="";get displaySrc(){let e=this.reel?.videoUrl||this.src;return e&&e.includes("videos.bengaluru-swada.com")&&(e=e.replace("https://videos.bengaluru-swada.com","https://r2-video-uploader.bengaluru-swada.workers.dev")),e}get displayPoster(){return this.reel?.thumbnailUrl||this.poster}get displayTitle(){return this.reel?.title||this.title}get displayVendor(){return this.reel?.vendor||this.vendor}get displayPrice(){return this.reel?.price||this.price}get displayDistance(){return this.reel?.distance||this.distance}get displayLikes(){return this.reel?.likes||this.likes}get displayViewCount(){return this.reel?.viewCount||this.viewCount}get displayIsLiked(){return this.reel?this.reel.isLiked||!1:this.isLiked}get displayIsBookmarked(){return this.reel?this.reel.isBookmarked||!1:this.isBookmarked}isLoading=!0;isVideoInitialized=!1;isVideoReady=!1;hasError=!1;progress=0;isSeeking=!1;isMuted=!0;muteChanged=new tt;showMuteIcon=!1;progressInterval;goToProfile(e){e.stopPropagation(),this.router.navigate(["/profile"])}ngOnChanges(e){if(this.isBrowser){if(e.reel||e.src){let t=this.displaySrc;console.log("[VideoCard] Source Changed. ID:",this.reel?.id,"Src:",t,"Poster:",this.displayPoster);let i=e.reel?.previousValue?.videoUrl||e.src?.previousValue;t!==i&&(this.isVideoReady=!1,this.hasError=!1,this.initVideo())}e.priority&&this.updateHlsPriority(),e.active&&(this.active?this.play():this.pause()),this.videoEl?.nativeElement&&(this.videoEl.nativeElement.muted=!this.active||this.isMuted)}}ngOnDestroy(){this.destroyHls(),this.progressInterval&&clearInterval(this.progressInterval),this.progressBarHideTimeout&&clearTimeout(this.progressBarHideTimeout)}ngAfterViewInit(){this.isBrowser&&setTimeout(()=>{this.isVideoInitialized=!0,this.cdr.detectChanges(),console.log("[VideoCard] ngAfterViewInit (Delayed)",this.reel?.id),this.initVideo(),this.setupNativeListeners(),setTimeout(()=>{!this.hls&&(this.priority==="high"||this.priority==="auto")&&(console.warn("[VideoCard] Safety Retry Init for",this.reel?.id),this.initVideo())},500)},50)}initVideo(){let e=this.videoEl?.nativeElement,t=this.displaySrc;if(!e){console.warn("[VideoCard] initVideo skipped: No video element for",this.reel?.id);return}if(!t){console.warn("[VideoCard] initVideo skipped: No src available for",this.reel?.id),this.isLoading=!1;return}if(this.isLoading=this.priority==="high",console.log("[VideoCard] InitVideo V2 for:",this.reel?.id,"Idx:",this.relativeIndex,"Priority:",this.priority),this.priority==="low"){this.isLoading=!1;return}if(this.hls&&this.currentInitSrc===t){console.log("[VideoCard] Skipping HLS init (already active for src)"),this.updateHlsPriority();return}this.destroyHls(),this.currentInitSrc=t;let i=t.includes("?")?`${t}&t=${Date.now()}`:`${t}?t=${Date.now()}`;if(console.log("[VideoCard] Loading Source:",i),!t.endsWith(".m3u8"))throw new Error("[VideoCard] MP4 playback is forbidden");if(ml.isSupported()){let r={debug:!1,enableWorker:!0,startLevel:0,autoStartLoad:!0,maxBufferLength:6,maxMaxBufferLength:12,backBufferLength:3,startFragPrefetch:!0,fragLoadingTimeOut:2e3,fragLoadingMaxRetry:3};this.hls=new ml(r),this.hls.attachMedia(e),this.hls.on(ml.Events.MEDIA_ATTACHED,()=>{this.hls?.loadSource(i)}),this.hls.on(ml.Events.MANIFEST_PARSED,()=>{this.updateHlsPriority()}),this.hls.on(ml.Events.ERROR,(s,o)=>{if(o.fatal)switch(o.type){case ml.ErrorTypes.NETWORK_ERROR:this.hls?.startLoad();break;case ml.ErrorTypes.MEDIA_ERROR:this.hls?.recoverMediaError();break;default:this.destroyHls();break}})}else e.canPlayType("application/vnd.apple.mpegurl")==="probably"&&(e.src=i)}updateHlsPriority(){if(!this.hls&&(this.priority==="high"||this.priority==="auto")){this.initVideo();return}if(this.hls)switch(this.priority){case"high":this.hls.startLoad(0),this.videoEl?.nativeElement.play().catch(e=>console.warn("[VideoCard] Autoplay blocked?",e));break;case"auto":this.hls.startLoad(0),this.videoEl?.nativeElement.pause();break;case"low":this.destroyHls(),this.videoEl?.nativeElement&&(this.videoEl.nativeElement.src="",this.videoEl.nativeElement.load());break}}destroyHls(){this.hls&&(this.hls.destroy(),this.hls=null)}setupNativeListeners(){let e=this.videoEl.nativeElement;["error","ended","timeupdate","waiting","playing","loadeddata"].forEach(i=>{e.addEventListener(i,()=>{i==="loadeddata"&&(this.isVideoReady=!0,this.cdr.detectChanges()),i==="timeupdate"&&(!this.isSeeking&&e.duration&&(this.progress=e.currentTime/e.duration*100),e.currentTime>.05&&!this.isVideoReady&&(this.isVideoReady=!0,this.cdr.detectChanges()),this.isLoading=!1),i==="waiting"&&(this.isLoading=!0),i==="playing"&&(this.isLoading=!1),i==="ended"&&(this.progress=0,this.play())})})}play(){let e=this.videoEl?.nativeElement;if(!e||!e.paused)return;this.videoEl.nativeElement.muted=!this.active||this.isMuted,this.hls&&this.hls.startLoad();let t=e.play();t!==void 0&&t.catch(i=>{console.warn("[VideoCard] Play failed:",i)})}pause(){this.videoEl?.nativeElement.pause()}resetVideo(){let e=this.videoEl?.nativeElement;e&&e.pause()}preload(){}bookmark(){this.reel||(this.isBookmarked=!this.isBookmarked),this.bookmarked.emit()}onDelete(e){e.stopPropagation(),this.deleted.emit()}openGoogleMaps(){if(this.isBrowser)if(this.reel?.latitude&&this.reel?.longitude){let{latitude:e,longitude:t}=this.reel,i=`https://www.google.com/maps?q=${e},${t}`;window.open(i,"_blank")}else{let e=this.displayVendor,t=this.displayTitle,r=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(`${e} ${t} Bangalore`)}`;window.open(r,"_blank")}}share(){this.shareApp()}toggleLike(){this.reel||(this.isLiked=!this.isLiked),this.liked.emit(),this.isLiked&&this.showLikeAnimationEffect()}toggleMute(){let e=this.videoEl?.nativeElement;if(e){e.paused&&e.play().catch(i=>console.error("[VideoCard] Error playing on tap:",i));let t=!this.isMuted;e.muted=!this.active||t,this.isMuted=t,this.muteChanged.emit(t),this.showMuteAnimation(),this.isProgressBarVisible=!0,this.progressBarHideTimeout&&clearTimeout(this.progressBarHideTimeout),this.progressBarHideTimeout=setTimeout(()=>{this.isProgressBarVisible=!1},2e3)}}showMuteAnimation(){this.showMuteIcon=!0,setTimeout(()=>{this.showMuteIcon=!1},1e3)}doubleTapLike(){this.isLiked?this.showLikeAnimationEffect():this.toggleLike()}onVideoTap(e){e.cancelable&&e.preventDefault();let t=new Date().getTime(),i=t-this.lastTapTime;i<300&&i>0?(this.singleTapTimeout&&(clearTimeout(this.singleTapTimeout),this.singleTapTimeout=void 0),this.doubleTapLike(),this.lastTapTime=0):(this.lastTapTime=t,this.singleTapTimeout=setTimeout(()=>{this.toggleMute(),this.singleTapTimeout=void 0},300))}showLikeAnimationEffect(){this.showLikeAnimation=!0,setTimeout(()=>{this.showLikeAnimation=!1},1e3)}formatViewCount(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}onProgressBarClick(e){e.stopPropagation(),this.seekToPosition(e)}onProgressBarTouchStart(e){this.isSeeking=!0,this.seekToPosition(e)}onProgressBarTouchMove(e){this.isSeeking&&this.seekToPosition(e)}onProgressBarTouchEnd(){this.isSeeking=!1}seekToPosition(e){let i=e.currentTarget.getBoundingClientRect(),r;if(e.type.indexOf("touch")===-1)r=e.clientX;else{let l=e.touches[0]||e.changedTouches[0];if(!l)return;r=l.clientX}let o=Math.max(0,Math.min(r-i.left,i.width))/i.width,a=this.videoEl?.nativeElement;a&&a.readyState>0&&(a.currentTime=o*a.duration,this.progress=o*100)}shareApp(){if(!this.isBrowser)return;this.shared.emit();let e={title:"Bengaluru Swada - Discover Street Food",text:"Check out this amazing street food discovery app! Find the best local food near you.",url:window.location.origin},t=window.navigator;t&&t.share?t.share(e).catch(i=>{console.log("Error sharing:",i),this.fallbackShare()}):this.fallbackShare()}fallbackShare(){let e=window.location.origin,t=`Check out Bengaluru Swada - Discover amazing street food near you! ${e}`,i=window.navigator;i&&i.clipboard?i.clipboard.writeText(t).then(()=>{window.alert("Link copied to clipboard! Share it with your friends.")}).catch(()=>{this.showShareOptions(e)}):this.showShareOptions(e)}showShareOptions(e){let t=encodeURIComponent("Check out Bengaluru Swada - Discover amazing street food!"),i=encodeURIComponent(e),r=`https://wa.me/?text=${t}%20${i}`;window.open(r,"_blank")}static \u0275fac=function(t){return new(t||n)(pe(Bi),pe(gt),pe(xi))};static \u0275cmp=_t({type:n,selectors:[["app-video-card"]],viewQuery:function(t,i){if(t&1&&Ui(die,5),t&2){let r;Si(r=Ci())&&(i.videoEl=r.first)}},inputs:{reel:"reel",src:"src",poster:"poster",title:"title",vendor:"vendor",price:"price",distance:"distance",active:"active",relativeIndex:"relativeIndex",priority:"priority",swipeDeltaY:"swipeDeltaY",isSwiping:"isSwiping",likes:"likes",viewCount:"viewCount",isLiked:"isLiked",isBookmarked:"isBookmarked",canDelete:"canDelete",isMuted:"isMuted"},outputs:{liked:"liked",bookmarked:"bookmarked",shared:"shared",deleted:"deleted",muteChanged:"muteChanged"},standalone:!0,features:[Dr,Tt],decls:10,vars:23,consts:[["videoEl",""],[1,"video-card"],["alt","Video Thumbnail",1,"video-thumbnail",3,"error","src"],["class","video-player","loop","","playsinline","","webkit-playsinline","","x-webkit-airplay","allow","disablePictureInPicture","",3,"video-ready","muted","preload","poster","click",4,"ngIf"],["class","skeleton-overlay",4,"ngIf"],["class","like-animation",4,"ngIf"],["class","mute-animation",4,"ngIf"],["class","video-overlay",4,"ngIf"],["class","view-count-badge",4,"ngIf"],[1,"progress-container",3,"click","touchstart","touchmove","touchend","mouseenter","mouseleave"],[1,"progress-bar"],["loop","","playsinline","","webkit-playsinline","","x-webkit-airplay","allow","disablePictureInPicture","",1,"video-player",3,"click","muted","preload","poster"],[1,"skeleton-overlay"],[1,"skeleton-info-group"],[1,"skeleton-line","title"],[1,"skeleton-line","vendor"],[1,"skeleton-action-group"],[1,"skeleton-circle"],[1,"like-animation"],["width","100","height","100","viewBox","0 0 24 24","fill","white"],["d","M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"],[1,"mute-animation"],[1,"mute-icon-bg"],["width","40","height","40","viewBox","0 0 24 24","fill","white",4,"ngIf"],["width","40","height","40","viewBox","0 0 24 24","fill","white"],["d","M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"],["d","M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"],[1,"video-overlay"],[1,"video-info"],[1,"food-details"],[1,"title-category-row"],[1,"dish-name"],[1,"vendor-name","clickable-vendor",3,"click"],["width","14","height","14","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"location-icon"],["d","M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"],["cx","12","cy","10","r","3"],["width","12","height","12","viewBox","0 0 24 24","fill","none","stroke","#2196F3","stroke-width","4",1,"arrow-icon"],["points","9 18 15 12 9 6"],[1,"price-distance"],[1,"price"],[1,"distance"],[1,"action-buttons"],[1,"action-btn","like-btn",3,"click"],["width","28","height","28","viewBox","0 0 24 24",1,"action-icon"],["d","M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["class","like-count",4,"ngIf"],[1,"action-btn","bookmark-btn",3,"click"],["d","M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"action-btn","share-btn",3,"click"],["width","28","height","28","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"action-icon","share-icon"],["cx","18","cy","5","r","3"],["cx","6","cy","12","r","3"],["cx","18","cy","19","r","3"],["x1","8.59","y1","13.51","x2","15.42","y2","17.49"],["x1","15.41","y1","6.51","x2","8.59","y2","10.49"],["class","action-btn delete-btn",3,"click",4,"ngIf"],[1,"like-count"],[1,"action-btn","delete-btn",3,"click"],["width","26","height","26","viewBox","0 0 24 24","fill","none","stroke","#ff4444","stroke-width","2",1,"action-icon"],["d","M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"],["x1","10","y1","11","x2","10","y2","17"],["x1","14","y1","11","x2","14","y2","17"],[1,"view-count-badge"],["width","15","height","15","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round"],["d","M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"],["cx","12","cy","12","r","3"],[1,"count-text"]],template:function(t,i){t&1&&(N(0,"div",1)(1,"img",2),he("error",function(){return i.hasError=!0}),$(),Ve(2,hie,2,5,"video",3)(3,fie,9,0,"div",4)(4,pie,3,0,"div",5)(5,yie,4,2,"div",6)(6,Eie,34,12,"div",7)(7,Tie,6,1,"div",8),N(8,"div",9),he("click",function(s){return i.onProgressBarClick(s)})("touchstart",function(s){return i.onProgressBarTouchStart(s)})("touchmove",function(s){return i.onProgressBarTouchMove(s)})("touchend",function(){return i.onProgressBarTouchEnd()})("mouseenter",function(){return i.isProgressBarVisible=!0})("mouseleave",function(){return i.isProgressBarVisible=!1}),ae(9,"div",10),$()()),t&2&&(Ii("transform",i.isSwiping?"translateY(calc("+i.relativeIndex*100+"% + "+i.swipeDeltaY+"px))":""),Qe("active",i.active)("prev",i.relativeIndex<0)("next",i.relativeIndex>0)("swiping",i.isSwiping),W(),Qe("hidden",i.isVideoReady||i.hasError),ce("src",i.displayPoster,Jr),W(),ce("ngIf",i.isVideoInitialized),W(),ce("ngIf",i.isLoading),W(),ce("ngIf",i.showLikeAnimation),W(),ce("ngIf",i.showMuteIcon),W(),ce("ngIf",!i.isLoading),W(),ce("ngIf",!i.isLoading&&i.displayViewCount>0),W(),Qe("visible",i.isProgressBarVisible),W(),Ii("width",i.progress,"%"))},dependencies:[Pt,qt],styles:['.video-card[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;transform:translateY(100%);transition:transform .4s cubic-bezier(.25,1,.5,1);background:#000;overflow:hidden;z-index:1}.video-card.swiping[_ngcontent-%COMP%]{transition:none!important}.video-card.prev[_ngcontent-%COMP%]{transform:translateY(-100%)}.video-card.next[_ngcontent-%COMP%]{transform:translateY(100%)}.video-card.active[_ngcontent-%COMP%]{transform:translateY(0);z-index:2}.view-count-badge[_ngcontent-%COMP%]{position:absolute;bottom:25px;right:20px;z-index:100;display:flex;align-items:center;gap:4px;padding:4px 10px;background:#000000d9;backdrop-filter:blur(12px) saturate(180%);-webkit-backdrop-filter:blur(12px) saturate(180%);border-radius:12px;border:.5px solid rgba(255,255,255,.15);color:#fff;font-size:.7rem;font-weight:500;pointer-events:none;box-shadow:0 4px 15px #0006;transition:all .3s ease}.view-count-badge[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:.9;stroke-width:2.2px;width:14px;height:14px;filter:drop-shadow(0 2px 4px rgba(0,0,0,.3))}.view-count-badge[_ngcontent-%COMP%]   .count-text[_ngcontent-%COMP%]{letter-spacing:.2px;text-shadow:0 2px 4px rgba(0,0,0,.3)}.profile-overlay-btn[_ngcontent-%COMP%]{position:absolute;top:calc(env(safe-area-inset-top,0px) + 12px);right:16px;z-index:25;width:44px;height:44px;display:flex;align-items:center;justify-content:center;background:#0009;border-radius:50%;border:1px solid rgba(255,255,255,.3);color:#fff;cursor:pointer;transition:all .3s cubic-bezier(.2,.8,.2,1);pointer-events:auto;box-shadow:0 8px 32px #0006}.profile-overlay-btn[_ngcontent-%COMP%]:active{transform:scale(.88);background:#ffffff40}.profile-overlay-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{filter:drop-shadow(0 2px 4px rgba(0,0,0,.3))}.video-thumbnail[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:0;opacity:1;transition:opacity .5s ease-out}.video-thumbnail.hidden[_ngcontent-%COMP%]{opacity:0}.video-player[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background:transparent;opacity:0;transition:opacity .3s ease-in;z-index:1}.video-player.video-ready[_ngcontent-%COMP%]{opacity:1}.video-player[_ngcontent-%COMP%]::-webkit-media-controls{display:none!important}.video-player[_ngcontent-%COMP%]::-webkit-media-controls-enclosure{display:none!important}.video-player[_ngcontent-%COMP%]::-webkit-media-controls-panel{display:none!important}.video-player[_ngcontent-%COMP%]:before{display:none!important}.progress-container[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;width:100%;height:3px;background-color:#fff3;z-index:95;cursor:pointer;transition:opacity .3s ease;opacity:1;pointer-events:auto;margin:0;padding:0}.progress-container[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{height:100%;background-color:#fff;width:0%;transition:width .1s linear;box-shadow:0 0 10px #ffffff80}.progress-container[_ngcontent-%COMP%]:hover, .progress-container[_ngcontent-%COMP%]:active{height:4px;background-color:#ffffff4d}.skeleton-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background:#121212;z-index:10;pointer-events:none}.skeleton-overlay[_ngcontent-%COMP%]   .skeleton-info-group[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:20px;width:80%;display:flex;flex-direction:column;gap:12px}.skeleton-overlay[_ngcontent-%COMP%]   .skeleton-info-group[_ngcontent-%COMP%]   .skeleton-line[_ngcontent-%COMP%]{height:14px;background:#ffffff1a;border-radius:4px;overflow:hidden;position:relative}.skeleton-overlay[_ngcontent-%COMP%]   .skeleton-info-group[_ngcontent-%COMP%]   .skeleton-line[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.05),transparent);transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 1.5s infinite}.skeleton-overlay[_ngcontent-%COMP%]   .skeleton-info-group[_ngcontent-%COMP%]   .skeleton-line.title[_ngcontent-%COMP%]{width:60%;height:16px}.skeleton-overlay[_ngcontent-%COMP%]   .skeleton-info-group[_ngcontent-%COMP%]   .skeleton-line.vendor[_ngcontent-%COMP%]{width:40%;height:12px}.skeleton-overlay[_ngcontent-%COMP%]   .skeleton-action-group[_ngcontent-%COMP%]{position:absolute;bottom:100px;right:16px;display:flex;flex-direction:column;gap:20px;align-items:center}.skeleton-overlay[_ngcontent-%COMP%]   .skeleton-action-group[_ngcontent-%COMP%]   .skeleton-circle[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;background:#ffffff1a;position:relative;overflow:hidden}.skeleton-overlay[_ngcontent-%COMP%]   .skeleton-action-group[_ngcontent-%COMP%]   .skeleton-circle[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.05),transparent);transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 1.5s infinite}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.video-overlay[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;width:100%;height:100%;padding:20px 20px 60px;background:transparent;display:flex;justify-content:space-between;align-items:flex-end;pointer-events:none!important;gap:16px}.video-info[_ngcontent-%COMP%]{flex:1;color:#fff;padding-right:0;padding-bottom:10px;pointer-events:auto;display:flex;flex-direction:column;gap:8px;z-index:5;max-width:80%}.food-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;align-items:flex-start}.title-category-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:2px}.dish-name[_ngcontent-%COMP%]{font-size:1.21rem;font-weight:700;line-height:1.1;margin:0;letter-spacing:-.5px;text-shadow:0 4px 12px rgba(0,0,0,.5);font-family:-apple-system,BlinkMacSystemFont,SF Pro Display,Segoe UI,Roboto,sans-serif}.vendor-name[_ngcontent-%COMP%]{font-size:.73rem;font-weight:500;color:#ffffffd9;margin:0;display:flex;align-items:center;gap:6px}.price-distance[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-top:6px}.price[_ngcontent-%COMP%], .distance[_ngcontent-%COMP%]{font-size:.7rem;font-weight:600;padding:6px 14px;border-radius:20px;backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);box-shadow:0 4px 12px #0003;border:.5px solid rgba(255,255,255,.2);letter-spacing:.3px;display:inline-flex;align-items:center;justify-content:center}.price[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;box-shadow:0 4px 12px var(--primary-shadow);border:none}.distance[_ngcontent-%COMP%]{background:#1e1e1e80;color:#fffffff2}.action-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;pointer-events:auto;padding-bottom:100px;padding-right:0;align-items:center;z-index:10}.action-btn[_ngcontent-%COMP%]{background:#14141473;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:.5px solid rgba(255,255,255,.15);border-radius:50%;width:48px;height:48px;display:flex;align-items:center;justify-content:center;color:#fff;cursor:pointer;transition:all .25s cubic-bezier(.2,.8,.2,1);box-shadow:0 4px 12px #0003;position:relative}.action-btn[_ngcontent-%COMP%]:active{transform:scale(.92);background:#28282899}.action-btn[_ngcontent-%COMP%]   .action-icon[_ngcontent-%COMP%]{width:24px;height:24px;filter:drop-shadow(0 2px 4px rgba(0,0,0,.1));stroke-width:2px}.like-btn.liked[_ngcontent-%COMP%]{background:#ff475733;border-color:#ff475766;color:#ff4757}.like-btn.liked[_ngcontent-%COMP%]   .action-icon[_ngcontent-%COMP%]{fill:#ff4757;stroke:#ff4757;animation:_ngcontent-%COMP%_pulse .4s cubic-bezier(.175,.885,.32,1.275)}.bookmark-btn.bookmarked[_ngcontent-%COMP%]{background:var(--primary-tint);border-color:var(--primary-shadow);color:var(--primary-color)}.bookmark-btn.bookmarked[_ngcontent-%COMP%]   .action-icon[_ngcontent-%COMP%]{fill:var(--primary-color);stroke:var(--primary-color)}.like-count[_ngcontent-%COMP%], .count-text[_ngcontent-%COMP%]{position:absolute;bottom:-18px;font-size:.75rem;font-weight:600;text-shadow:0 1px 2px rgba(0,0,0,.8);pointer-events:none;white-space:nowrap}.like-animation[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10;pointer-events:none;animation:_ngcontent-%COMP%_pop-in-out .8s cubic-bezier(.175,.885,.32,1.275) forwards}@keyframes _ngcontent-%COMP%_pop-in-out{0%{transform:translate(-50%,-50%) scale(0);opacity:0}20%{transform:translate(-50%,-50%) scale(1.2);opacity:1}40%{transform:translate(-50%,-50%) scale(.9);opacity:1}80%{transform:translate(-50%,-50%) scale(1);opacity:1}to{transform:translate(-50%,-50%) scale(1.5);opacity:0}}@keyframes _ngcontent-%COMP%_pulse{0%{transform:scale(1)}50%{transform:scale(1.2)}to{transform:scale(1)}}.mute-animation[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10;pointer-events:none;animation:_ngcontent-%COMP%_fade-in-out 1s ease-in-out forwards}.mute-icon-bg[_ngcontent-%COMP%]{background:#0009;border-radius:50%;padding:15px;display:flex;align-items:center;justify-content:center}@keyframes _ngcontent-%COMP%_fade-in-out{0%{opacity:0;transform:translate(-50%,-50%) scale(.8)}20%{opacity:1;transform:translate(-50%,-50%) scale(1)}80%{opacity:1;transform:translate(-50%,-50%) scale(1)}to{opacity:0;transform:translate(-50%,-50%) scale(.8)}}']})};var X_=class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=_t({type:n,selectors:[["app-video-feed-skeleton"]],standalone:!0,features:[Tt],decls:11,vars:0,consts:[[1,"skeleton-feed"],[1,"skeleton-card"],[1,"skeleton-overlay"],[1,"skeleton-info-group"],[1,"skeleton-line","title"],[1,"skeleton-line","vendor"],[1,"skeleton-action-group"],[1,"skeleton-circle"]],template:function(t,i){t&1&&(N(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),ae(4,"div",4)(5,"div",5),$(),N(6,"div",6),ae(7,"div",7)(8,"div",7)(9,"div",7)(10,"div",7),$()()()())},dependencies:[Pt],styles:['.skeleton-feed[_ngcontent-%COMP%]{width:100%;height:100%;background:#000;overflow:hidden}.skeleton-card[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;background:#121212}.skeleton-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background:#121212;z-index:10;pointer-events:none}.skeleton-info-group[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:20px;width:80%;display:flex;flex-direction:column;gap:12px}.skeleton-line[_ngcontent-%COMP%]{height:14px;background:#ffffff1a;border-radius:4px;overflow:hidden;position:relative}.skeleton-line[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.05),transparent);transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 1.5s infinite}.skeleton-line.title[_ngcontent-%COMP%]{width:60%;height:16px}.skeleton-line.vendor[_ngcontent-%COMP%]{width:40%;height:12px}.skeleton-action-group[_ngcontent-%COMP%]{position:absolute;bottom:100px;right:16px;display:flex;flex-direction:column;gap:20px;align-items:center}.skeleton-circle[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;background:#ffffff1a;position:relative;overflow:hidden}.skeleton-circle[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.05),transparent);transform:translate(-100%);animation:_ngcontent-%COMP%_shimmer 1.5s infinite}@keyframes _ngcontent-%COMP%_shimmer{to{transform:translate(100%)}}']})};var Wi=class n{constructor(e,t,i){this.firestore=e;this.http=t;this.auth=i}collectionName="reels";getTrendingReels(e=20){return U(this,null,function*(){try{let t=Ld(this.firestore,this.collectionName),i=Od(t,Wv("isPublic","==",!0),Dp("createdAt","desc"),qv(e*3)),s=(yield zv(i)).docs.map(u=>{let d=u.data();return d.videoUrl&&d.videoUrl.includes("videos.bengaluru-swada.com")&&(d.videoUrl=d.videoUrl.replace("https://videos.bengaluru-swada.com","https://r2-video-uploader.bengaluru-swada.workers.dev")),de({id:u.id},d)}),o=Date.now(),a=s.map(u=>{let d=u.viewCount||0,f=u.likes||0,m=u.bookmarkedBy?.length||0,y=d*1+f*3+m*5,v=u.createdAt.toDate().getTime(),E=Math.max(0,(o-v)/(1e3*60*60)),T=y/Math.pow(E+2,1.5);return qe(de({},u),{_score:T})});a.sort((u,d)=>d._score-u._score);let l=a.slice(0,e);return this.shuffleArray(l)}catch(t){return console.error("Error fetching trending:",t),[]}})}getNewArrivals(e=20){return U(this,null,function*(){return yield this.getReels(e)})}shuffleArray(e){for(let t=e.length-1;t>0;t--){let i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}getReels(e=10,t){return U(this,null,function*(){try{let i=Ld(this.firestore,this.collectionName),r=Od(i,Wv("isPublic","==",!0),Dp("createdAt","desc"),qv(e));return t&&(r=Od(r,xV(t))),(yield zv(r)).docs.map(o=>de({id:o.id},o.data()))}catch(i){return console.error("Error fetching reels:",i),[]}})}getReelsByUser(e){return U(this,null,function*(){try{let t=Ld(this.firestore,this.collectionName),i=Od(t,Wv("uploadedBy","==",e),Dp("createdAt","desc"));return(yield zv(i)).docs.map(s=>de({id:s.id},s.data()))}catch(t){return console.error("Error fetching user reels:",t),[]}})}getReelById(e){return U(this,null,function*(){try{let t=kc(this.firestore,this.collectionName,e),i=yield IV(t);return i.exists()?de({id:i.id},i.data()):null}catch(t){return console.error("Error fetching reel:",t),null}})}createReel(e){return U(this,null,function*(){try{let t=Ld(this.firestore,this.collectionName);return(yield wV(t,qe(de({},e),{isPublic:!0,createdAt:vn.now(),viewCount:0,likes:0,likedBy:[],bookmarkedBy:[]}))).id}catch(t){throw console.error("Error creating reel:",t),t}})}updateReel(e,t){return U(this,null,function*(){try{let i=kc(this.firestore,this.collectionName,e);yield Lc(i,t)}catch(i){throw console.error("Error updating reel:",i),i}})}deleteReel(e){return U(this,null,function*(){try{let t=yield this.getReelById(e);if(!t){console.warn("Reel not found, cannot delete");return}let i="";if(t.videoUrl)if(t.videoUrl.includes("bengaluru-swada.workers.dev")){let s="bengaluru-swada.workers.dev/",o=t.videoUrl.indexOf(s);o!==-1&&(i=t.videoUrl.substring(o+s.length))}else{let s=t.videoUrl.split("/");i=s[s.length-1]}if(i)try{yield va(this.deleteFromR2(i)),console.log(`Deleted ${i} from R2`)}catch(s){console.error("Failed to delete from R2, proceeding with DB delete:",s)}let r=kc(this.firestore,this.collectionName,e);yield bV(r),console.log("Deleted reel metadata from Firestore")}catch(t){throw console.error("Error deleting reel:",t),t}})}toggleLike(e,t,i){return U(this,null,function*(){try{let r=kc(this.firestore,this.collectionName,e);i?yield Lc(r,{likedBy:Qx(t),likes:Hv(-1)}):yield Lc(r,{likedBy:Zx(t),likes:Hv(1)})}catch(r){throw console.error("Error toggling like:",r),r}})}toggleBookmark(e,t,i){return U(this,null,function*(){try{let r=kc(this.firestore,this.collectionName,e);i?yield Lc(r,{bookmarkedBy:Qx(t)}):yield Lc(r,{bookmarkedBy:Zx(t)})}catch(r){throw console.error("Error toggling bookmark:",r),r}})}incrementViewCount(e){return U(this,null,function*(){try{let t=kc(this.firestore,this.collectionName,e);yield Lc(t,{viewCount:Hv(1)})}catch(t){console.error("Error incrementing view count:",t)}})}getReelsRealtime(e=10){return new rt(t=>{let i=Ld(this.firestore,this.collectionName),r=Od(i,Dp("createdAt","desc"),qv(e)),s=CV(r,o=>{let a=o.docs.map(l=>de({id:l.id},l.data()));t.next(a)},o=>{console.error("Error in realtime reels:",o),t.error(o)});return()=>s()})}getUploadUrl(e,t){return this.http.post(Pp.cloudflare.workerUrl,{fileName:e,contentType:t})}uploadToR2(e,t){return this.http.put(e,t,{headers:{"Content-Type":t.type},reportProgress:!0,observe:"events"})}deleteFromR2(e){return this.http.delete(`${Pp.cloudflare.workerUrl}/${e}`)}isLikedByUser(e,t){return e.likedBy?.includes(t)||!1}isBookmarkedByUser(e,t){return e.bookmarkedBy?.includes(t)||!1}static \u0275fac=function(t){return new(t||n)(Me(Mc),Me(sb),Me(jt))};static \u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})};var h1=function(n){return n.TOP_CENTER="TOP_CENTER",n.CENTER="CENTER",n.BOTTOM_CENTER="BOTTOM_CENTER",n}(h1||{});var f1=function(n){return n.BANNER="BANNER",n.FULL_BANNER="FULL_BANNER",n.LARGE_BANNER="LARGE_BANNER",n.MEDIUM_RECTANGLE="MEDIUM_RECTANGLE",n.LEADERBOARD="LEADERBOARD",n.ADAPTIVE_BANNER="ADAPTIVE_BANNER",n.SMART_BANNER="SMART_BANNER",n}(f1||{});var rh=function(n){return n.Loaded="interstitialAdLoaded",n.FailedToLoad="interstitialAdFailedToLoad",n.Showed="interstitialAdShowed",n.FailedToShow="interstitialAdFailedToShow",n.Dismissed="interstitialAdDismissed",n}(rh||{});var no=F1("AdMob",{web:()=>import("./chunk-TUFA6MSI.js").then(n=>new n.AdMobWeb)});var A$={production:!0,firebase:{apiKey:"AIzaSyA9H-CYGk2kEsfzKyFMA6cdPQRRQMf750M",authDomain:"bengaluru-swada-1ecca.firebaseapp.com",projectId:"bengaluru-swada-1ecca",storageBucket:"bengaluru-swada-1ecca.firebasestorage.app",messagingSenderId:"831575973864",appId:"1:831575973864:web:8ba5a2fa1e28b9e16bce5d",measurementId:"G-DEZTYKDN53"},cloudflare:{workerUrl:"https://r2-video-uploader.bengaluru-swada.workers.dev",cdnUrl:"https://r2-video-uploader.bengaluru-swada.workers.dev",bucketName:"bengaluru-swada-videos"}};var io=class n{IS_TESTING=!A$.production;BANNER_AD_ID="ca-app-pub-6062361574028519/4317365907";INTERSTITIAL_AD_ID="ca-app-pub-6062361574028519/8341722467";interstitialAdLoaded=!1;constructor(){this.initialize()}initialize(){return U(this,null,function*(){try{yield no.initialize({initializeForTesting:this.IS_TESTING}),console.log("AdMob initialized"),no.addListener(rh.Loaded,e=>{console.log("Interstitial ad loaded:",e),this.interstitialAdLoaded=!0}),no.addListener(rh.FailedToLoad,e=>{console.error("Interstitial ad failed to load:",e),this.interstitialAdLoaded=!1}),no.addListener(rh.Showed,()=>{console.log("Interstitial ad showed")}),no.addListener(rh.Dismissed,()=>{console.log("Interstitial ad dismissed"),this.loadInterstitial()}),this.loadInterstitial()}catch(e){console.error("AdMob initialization failed:",e)}})}showBanner(){return U(this,null,function*(){try{let e={adId:this.BANNER_AD_ID,adSize:f1.BANNER,position:h1.BOTTOM_CENTER,margin:0,isTesting:this.IS_TESTING};yield no.showBanner(e),console.log("Banner ad shown")}catch(e){console.error("Failed to show banner:",e)}})}hideBanner(){return U(this,null,function*(){try{yield no.hideBanner()}catch(e){console.error("Failed to hide banner:",e)}})}loadInterstitial(){return U(this,null,function*(){try{yield no.prepareInterstitial({adId:this.INTERSTITIAL_AD_ID,isTesting:this.IS_TESTING}),this.interstitialAdLoaded=!0,console.log("Interstitial ad loaded")}catch(e){console.error("Failed to load interstitial:",e),this.interstitialAdLoaded=!1}})}showInterstitial(){return U(this,null,function*(){if(!this.interstitialAdLoaded)return console.log("Interstitial not loaded yet"),!1;try{return yield no.showInterstitial(),this.interstitialAdLoaded=!1,!0}catch(e){return console.error("Failed to show interstitial:",e),this.interstitialAdLoaded=!1,!1}})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})};function wie(n,e){n&1&&ae(0,"app-video-feed-skeleton")}function bie(n,e){if(n&1){let t=Et();N(0,"div",17)(1,"div",18)(2,"h2"),ee(3,"No Reels Found"),$(),N(4,"p"),ee(5,"Be the first to share a tasty bite!"),$(),N(6,"div",19)(7,"button",20),he("click",function(){xe(t);let r=ve();return Ae(r.seedData())}),ee(8,"Seed Sample Data"),$(),N(9,"a",21),ee(10,"Upload Reel"),$()()()()}}function Iie(n,e){if(n&1){let t=Et();N(0,"app-video-card",24),he("muteChanged",function(r){xe(t);let s=ve(2);return Ae(s.onMuteChanged(r))})("deleted",function(){let r=xe(t).$implicit,s=ve(2);return Ae(s.onReelDeleted(r))})("liked",function(){let r=xe(t).index,s=ve(2);return Ae(s.onLike(r))})("bookmarked",function(){let r=xe(t).index,s=ve(2);return Ae(s.onBookmark(r))})("shared",function(){let r=xe(t).index,s=ve(2);return Ae(s.onShare(r))}),$()}if(n&2){let t=e.$implicit,i=e.index,r=ve(2);ce("reel",t)("active",i===r.currentIndex&&r.isActive)("relativeIndex",i-r.currentIndex)("priority",r.getPriority(i))("isMuted",r.isGlobalMuted)("canDelete",r.isOwner(t))("swipeDeltaY",r.swipeDeltaY)("isSwiping",r.isSwiping)}}function Sie(n,e){if(n&1&&(N(0,"div",22),Ve(1,Iie,1,8,"app-video-card",23),$()),n&2){let t=ve();W(),ce("ngForOf",t.reels)("ngForTrackBy",t.trackByReelId)}}var zc=class n{constructor(e,t,i,r,s,o,a){this.reelsService=e;this.auth=t;this.cdr=i;this.locationService=r;this.router=s;this.admobService=o;this.document=a}isActive=!0;activeTab="explore";isGlobalMuted=!0;reels=[];currentIndex=0;touchStartY=0;touchStartX=0;pullStartY=0;pullMoveY=0;isRefreshing=!1;swipeDeltaY=0;isSwiping=!1;hasTriggeredHaptic=!1;pullThreshold=80;swipeThresholdX=50;isLoading=!0;viewedReels=new Set;viewTrackingTimeout;adsViewed=0;INTERSTITIAL_THRESHOLD=7;cards;centerActiveTab(){setTimeout(()=>{let e=this.document.querySelector(".tab-item.active");e&&e.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})},100)}ngOnInit(){return U(this,null,function*(){yield this.loadReels(),this.admobService.showBanner()})}goToSearch(){this.router.navigate(["/search"])}goToProfile(){this.router.navigate(["/profile"])}ngAfterViewInit(){this.centerActiveTab()}ngOnChanges(e){e.isActive}onMuteChanged(e){this.isGlobalMuted=e}ngOnDestroy(){this.viewTrackingTimeout&&clearTimeout(this.viewTrackingTimeout),this.admobService.hideBanner()}reloadReelsForNewLocation(){return U(this,null,function*(){console.log("[VideoFeed] Reloading reels for new location...");let e=[...this.reels],t=yield Promise.all(e.map(i=>U(this,null,function*(){let r="-- km";if(i.latitude&&i.longitude)try{r=yield this.locationService.getDistanceFromUser(i.latitude,i.longitude)}catch(s){console.error("[VideoFeed] Error calculating distance:",s)}return qe(de({},i),{distance:r})})));this.reels=t,this.currentIndex=0,this.cdr.detectChanges()})}isOwner(e){return this.auth.currentUser?.uid===e.uploadedBy}onReelDeleted(e){return U(this,null,function*(){if(confirm("Are you sure you want to delete this reel permanently?"))try{yield this.reelsService.deleteReel(e.id),this.reels=this.reels.filter(t=>t.id!==e.id),this.currentIndex>=this.reels.length&&(this.currentIndex=Math.max(0,this.reels.length-1))}catch(t){console.error("Failed to delete reel:",t),alert("Failed to delete reel. Please try again.")}})}switchTab(e){return U(this,null,function*(){this.activeTab!==e&&(this.activeTab=e,this.reels=[],this.currentIndex=0,this.isLoading=!0,this.centerActiveTab(),yield this.loadReels())})}loadReels(){return U(this,null,function*(){console.log(`[VideoFeed] Loading ${this.activeTab} reels...`),this.isLoading=!0;try{let e=[];if(this.activeTab==="new")e=yield this.reelsService.getNewArrivals(20);else if(this.activeTab==="near")e=yield this.reelsService.getReels(50);else{e=yield this.reelsService.getReels(50);for(let r=e.length-1;r>0;r--){let s=Math.floor(Math.random()*(r+1));[e[r],e[s]]=[e[s],e[r]]}}console.log("[VideoFeed] Fetched reels:",e.length);let t=this.auth.currentUser;console.log("[VideoFeed] Current user:",t?.uid||"Not logged in");let i=yield Promise.all(e.map(r=>U(this,null,function*(){let s="-- km";if(r.latitude&&r.longitude)try{s=yield this.locationService.getDistanceFromUser(r.latitude,r.longitude)}catch(o){console.error("[VideoFeed] Error calculating distance:",o)}return qe(de({},r),{distance:s,isLiked:t?this.reelsService.isLikedByUser(r,t.uid):!1,isBookmarked:t?this.reelsService.isBookmarkedByUser(r,t.uid):!1})})));this.activeTab==="near"&&i.sort((r,s)=>{let o=parseFloat((r.distance||"9999").replace(/[^\d.]/g,""))||9999,a=parseFloat((s.distance||"9999").replace(/[^\d.]/g,""))||9999;return o-a}),this.reels=i,console.log("[VideoFeed] Final reels count:",this.reels.length)}catch(e){console.error("[VideoFeed] Error loading reels:",e)}finally{setTimeout(()=>{this.isLoading=!1,this.cdr.detectChanges(),this.reels.length>0&&this.trackView()},50)}})}trackView(){this.viewTrackingTimeout&&clearTimeout(this.viewTrackingTimeout);let e=this.reels[this.currentIndex];!e||!e.id||this.viewedReels.has(e.id)||(this.viewTrackingTimeout=window.setTimeout(()=>{e.id&&(this.reelsService.incrementViewCount(e.id),this.viewedReels.add(e.id),e.viewCount=(e.viewCount||0)+1,this.adsViewed++,this.adsViewed>=this.INTERSTITIAL_THRESHOLD&&(this.admobService.showInterstitial(),this.adsViewed=0))},3e3))}onTouchStart(e){this.touchStartY=e.touches[0].clientY,this.touchStartX=e.touches[0].clientX,this.currentIndex===0&&!this.isRefreshing&&(this.pullStartY=e.touches[0].clientY,this.hasTriggeredHaptic=!1),this.swipeDeltaY=0,this.isSwiping=!1}onTouchMove(e){let t=e.touches[0].clientY,i=t-this.touchStartY;if(this.currentIndex===0&&!this.isRefreshing&&this.pullStartY>0){let o=t-this.pullStartY;if(o>0){this.pullMoveY=o*.5,o>10&&e.cancelable&&e.preventDefault(),this.pullMoveY>=this.pullThreshold&&!this.hasTriggeredHaptic?(this.hasTriggeredHaptic=!0,navigator.vibrate&&navigator.vibrate(15)):this.pullMoveY<this.pullThreshold&&this.hasTriggeredHaptic&&(this.hasTriggeredHaptic=!1);return}}let r=e.touches[0].clientX-this.touchStartX;if(!this.isSwiping&&Math.abs(i)>10&&Math.abs(i)>Math.abs(r)&&(this.isSwiping=!0),this.isSwiping){let o=i;(this.currentIndex===0&&i>0||this.currentIndex===this.reels.length-1&&i<0)&&(o=i*.3),this.swipeDeltaY=o,e.cancelable&&e.preventDefault(),this.cdr.detectChanges()}}onTouchEnd(e){return U(this,null,function*(){let t=e.changedTouches[0].clientY,i=e.changedTouches[0].clientX,r=this.touchStartY-t,s=this.touchStartX-i;if(Math.abs(s)>this.swipeThresholdX&&Math.abs(s)>Math.abs(r)){s>0?this.activeTab==="explore"?this.switchTab("near"):this.activeTab==="near"&&this.switchTab("new"):this.activeTab==="new"?this.switchTab("near"):this.activeTab==="near"&&this.switchTab("explore");return}let o=100,a=Math.abs(r);this.isSwiping&&(r>o?this.next():r<-o&&this.pullMoveY<this.pullThreshold&&this.prev()),this.pullMoveY>=this.pullThreshold&&!this.isRefreshing&&(console.log("[VideoFeed] Refresh triggered!"),yield this.refresh()),this.pullStartY=0,this.pullMoveY=0,this.swipeDeltaY=0,this.isSwiping=!1,this.hasTriggeredHaptic=!1,this.cdr.detectChanges()})}scrollToTopAndRefresh(){return U(this,null,function*(){if(console.log("[VideoFeed] Animated scroll to top and refreshing..."),this.isGlobalMuted=!0,this.currentIndex>0){let e=this.currentIndex,t=Math.max(30,80-e*2);for(let i=e-1;i>=0;i--)this.currentIndex=i,this.cdr.detectChanges(),yield new Promise(r=>setTimeout(r,t))}yield this.refresh()})}refresh(){return U(this,null,function*(){this.isRefreshing=!0,navigator.vibrate&&navigator.vibrate(50);try{yield this.loadReels()}finally{setTimeout(()=>{this.isRefreshing=!1},500)}})}next(){this.currentIndex<this.reels.length-1&&(this.isGlobalMuted=!0,this.currentIndex++,this.trackView())}prev(){this.currentIndex>0&&(this.isGlobalMuted=!0,this.currentIndex--,this.trackView())}onLike(e){return U(this,null,function*(){let t=this.reels[e];if(!t||!t.id)return;let i=this.auth.currentUser;if(!i){console.warn("User must be logged in to like");return}let r=t.isLiked||!1;t.isLiked=!r,t.likes=(t.likes||0)+(r?-1:1);try{yield this.reelsService.toggleLike(t.id,i.uid,r)}catch(s){t.isLiked=r,t.likes=(t.likes||0)+(r?1:-1),console.error("Error toggling like:",s)}})}onBookmark(e){return U(this,null,function*(){let t=this.reels[e];if(!t||!t.id)return;let i=this.auth.currentUser;if(!i){console.warn("User must be logged in to bookmark");return}let r=t.isBookmarked||!1;t.isBookmarked=!r;try{yield this.reelsService.toggleBookmark(t.id,i.uid,r)}catch(s){t.isBookmarked=r,console.error("Error toggling bookmark:",s)}})}onShare(e){let t=this.reels[e];if(t)if(navigator.share)navigator.share({title:t.title,text:`Check out ${t.title} from ${t.vendor}!`,url:window.location.href}).catch(i=>console.log("Error sharing:",i));else{let i=`Check out ${t.title} from ${t.vendor}! \u20B9${t.price}`;navigator.clipboard.writeText(i).then(()=>console.log("Link copied to clipboard!")).catch(r=>console.error("Error copying:",r))}}seedData(){return U(this,null,function*(){this.isLoading=!0;let e=[{title:"Masala Dosa",vendor:"CTR",videoUrl:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",thumbnailUrl:"https://images.unsplash.com/photo-1668236543090-82eba5ee5976?q=80&w=2070&auto=format&fit=crop",price:120,categories:["South Indian","Breakfast"],latitude:12.9352,longitude:77.6245,uploadedBy:this.auth.currentUser?.uid||"system",cloudflareVideoId:"sample-id-1",duration:596,createdAt:vn.now(),viewCount:0,likes:0,likedBy:[],bookmarkedBy:[]},{title:"Filter Coffee",vendor:"Brahmins Coffee Bar",videoUrl:"https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8",thumbnailUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/11/Idli_Sambar.JPG/1200px-Idli_Sambar.JPG",price:80,categories:["South Indian","Beverages"],latitude:12.9716,longitude:77.6412,uploadedBy:this.auth.currentUser?.uid||"system",cloudflareVideoId:"sample-id-2",duration:600,createdAt:vn.now(),viewCount:0,likes:0,likedBy:[],bookmarkedBy:[]}];try{for(let t of e)yield this.reelsService.createReel(t);yield this.loadReels()}catch(t){console.error("Error seeding data:",t)}finally{this.isLoading=!1}})}navigateToReel(e){if(console.log(`[VideoFeed] Attempting to navigate to reel: ${e}`),console.log(`[VideoFeed] Total reels loaded: ${this.reels.length}`),this.reels.length===0){console.warn(`[VideoFeed] No reels loaded yet, cannot navigate to ${e}`);return}let t=this.reels.findIndex(i=>i.id===e);t!==-1?(console.log(`[VideoFeed] Found reel at index ${t}, navigating...`),this.isGlobalMuted=!0,this.currentIndex=t,setTimeout(()=>{this.trackView()},100),console.log(`[VideoFeed] Successfully navigated to reel: ${e}`)):(console.warn(`[VideoFeed] Reel not found in loaded reels: ${e}`),console.log("[VideoFeed] Available reel IDs:",this.reels.map(i=>i.id)))}getPriority(e){let t=Math.abs(e-this.currentIndex);return t===0?"high":t<=2?"auto":"low"}getTotalViews(){let e=this.reels.reduce((t,i)=>t+(i.viewCount||0),0);return e>=1e3?`${(e/1e3).toFixed(1)}k`:e.toString()}trackByReelId(e,t){return t.id||e.toString()}static \u0275fac=function(t){return new(t||n)(pe(Wi),pe(jt),pe(xi),pe(Gi),pe(gt),pe(io),pe(yn))};static \u0275cmp=_t({type:n,selectors:[["app-video-feed"]],viewQuery:function(t,i){if(t&1&&Ui(tm,5),t&2){let r;Si(r=Ci())&&(i.cards=r)}},inputs:{isActive:"isActive"},standalone:!0,features:[Dr,Tt],decls:24,vars:15,consts:[[1,"video-feed",3,"touchstart","touchmove","touchend"],[1,"feed-header"],[1,"header-icon-btn",3,"click"],["width","22","height","22","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["cx","11","cy","11","r","8"],["d","M21 21l-4.35-4.35"],[1,"header-tabs"],[1,"tab-item",3,"click"],["d","M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"],["cx","12","cy","7","r","4"],[1,"refresh-indicator"],[1,"spinner-container"],["viewBox","0 0 50 50",1,"instagram-spinner"],["cx","25","cy","25","r","20","fill","none","stroke-width","4",1,"path"],[4,"ngIf"],["class","empty-state",4,"ngIf"],["class","reels-container",4,"ngIf"],[1,"empty-state"],[1,"empty-content"],[1,"button-group"],[1,"seed-btn",3,"click"],["routerLink","/upload-reel",1,"upload-btn"],[1,"reels-container"],[3,"reel","active","relativeIndex","priority","isMuted","canDelete","swipeDeltaY","isSwiping","muteChanged","deleted","liked","bookmarked","shared",4,"ngFor","ngForOf","ngForTrackBy"],[3,"muteChanged","deleted","liked","bookmarked","shared","reel","active","relativeIndex","priority","isMuted","canDelete","swipeDeltaY","isSwiping"]],template:function(t,i){t&1&&(N(0,"div",0),he("touchstart",function(s){return i.onTouchStart(s)})("touchmove",function(s){return i.onTouchMove(s)})("touchend",function(s){return i.onTouchEnd(s)}),N(1,"div",1)(2,"button",2),he("click",function(){return i.goToSearch()}),Re(),N(3,"svg",3),ae(4,"circle",4)(5,"path",5),$()(),Be(),N(6,"div",6)(7,"button",7),he("click",function(){return i.switchTab("explore")}),ee(8," Explore "),$(),N(9,"button",7),he("click",function(){return i.switchTab("near")}),ee(10," Near You "),$(),N(11,"button",7),he("click",function(){return i.switchTab("new")}),ee(12," New Arrivals "),$()(),N(13,"button",2),he("click",function(){return i.goToProfile()}),Re(),N(14,"svg",3),ae(15,"path",8)(16,"circle",9),$()()(),Be(),N(17,"div",10)(18,"div",11),Re(),N(19,"svg",12),ae(20,"circle",13),$()()(),Ve(21,wie,1,0,"app-video-feed-skeleton",14)(22,bie,11,0,"div",15)(23,Sie,2,2,"div",16),$()),t&2&&(W(7),Qe("active",i.activeTab==="explore"),W(2),Qe("active",i.activeTab==="near"),W(2),Qe("active",i.activeTab==="new"),W(6),Ii("transform","translateY("+(i.isRefreshing?70:i.pullMoveY)+"px)"),Qe("refreshing",i.isRefreshing)("visible",i.pullMoveY>10),W(4),ce("ngIf",i.isLoading),W(),ce("ngIf",!i.isLoading&&i.reels.length===0),W(),ce("ngIf",!i.isLoading&&i.reels.length>0))},dependencies:[Pt,Hn,qt,tm,J0,oO,X_],styles:['.video-feed[_ngcontent-%COMP%]{flex:1;position:relative;overflow:hidden;scroll-snap-type:y mandatory;-webkit-overflow-scrolling:touch;height:100%;background:#000}.feed-header[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:calc(70px + env(safe-area-inset-top,0px));z-index:50;display:grid;grid-template-columns:60px 1fr 60px;align-items:center;padding:env(safe-area-inset-top,0px) 12px 0}.header-icon-btn[_ngcontent-%COMP%]{background:#ffffff26;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);width:44px;height:44px;min-width:44px;min-height:44px;flex-shrink:0;border-radius:50%;justify-self:center;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;box-shadow:0 4px 12px #0000001a}.header-icon-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{stroke:#fff}.header-icon-btn[_ngcontent-%COMP%]:active{transform:scale(.9);background:#ffffff40}.header-tabs[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px;overflow-x:auto;scrollbar-width:none;-ms-overflow-style:none;padding:10px 30%;scroll-snap-type:x mandatory;scroll-behavior:smooth;mask-image:linear-gradient(to right,transparent,black 40%,black 60%,transparent);-webkit-mask-image:linear-gradient(to right,transparent,black 40%,black 60%,transparent)}.header-tabs[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.header-tabs[_ngcontent-%COMP%]   .tab-item[_ngcontent-%COMP%]{background:none;border:none;font-size:.9rem;font-weight:500;color:#fff6;cursor:pointer;transition:all .3s cubic-bezier(.4,0,.2,1);text-shadow:0 1px 4px rgba(0,0,0,.5);padding:4px 0;position:relative;white-space:nowrap;flex-shrink:0;scroll-snap-align:center}.header-tabs[_ngcontent-%COMP%]   .tab-item.active[_ngcontent-%COMP%]{color:#fff;font-size:1.15rem;font-weight:700;opacity:1}.header-tabs[_ngcontent-%COMP%]   .tab-item.active[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-8px;left:50%;transform:translate(-50%);width:20px;height:2.5px;background:#fff;border-radius:2px;box-shadow:0 0 10px #ffffff80}.loading-container[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#1c1c1e;z-index:10;background:#000}.simple-orange-loader[_ngcontent-%COMP%]{width:48px;height:48px;border:3px solid rgba(255,107,53,.1);border-top:3px solid var(--primary-color);border-radius:50%;animation:_ngcontent-%COMP%_simple-spin .8s cubic-bezier(.5,.1,.5,.9) infinite;box-shadow:0 0 15px #ff6b351a}@keyframes _ngcontent-%COMP%_simple-spin{to{transform:rotate(360deg)}}.empty-content[_ngcontent-%COMP%]{text-align:center;padding:2rem}.empty-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:.5rem;color:var(--primary-color)}.empty-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#aaa;margin-bottom:2rem}.button-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;width:100%;max-width:250px}.seed-btn[_ngcontent-%COMP%], .upload-btn[_ngcontent-%COMP%]{padding:.8rem 1.5rem;border-radius:25px;font-weight:600;text-align:center;text-decoration:none;cursor:pointer;transition:all .2s;border:none;font-size:1rem}.seed-btn[_ngcontent-%COMP%]{background:#ffffff1a;color:#fff;border:1px solid rgba(255,255,255,.2)}.seed-btn[_ngcontent-%COMP%]:hover{background:#fff3}.upload-btn[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff}.upload-btn[_ngcontent-%COMP%]:hover{background:var(--primary-active);transform:translateY(-2px)}.refresh-indicator[_ngcontent-%COMP%]{position:absolute;top:-60px;left:0;width:100%;height:60px;display:flex;align-items:center;justify-content:center;z-index:100;pointer-events:none;opacity:0;transition:transform .15s linear,opacity .2s ease}.refresh-indicator.visible[_ngcontent-%COMP%]{opacity:1}.refresh-indicator.refreshing[_ngcontent-%COMP%]{transition:transform .4s cubic-bezier(.175,.885,.32,1.275),opacity .2s}.refresh-indicator.refreshing[_ngcontent-%COMP%]   .instagram-spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_rotate 2s linear infinite}.refresh-indicator.refreshing[_ngcontent-%COMP%]   .instagram-spinner[_ngcontent-%COMP%]   .path[_ngcontent-%COMP%]{stroke:#fff;stroke-linecap:round;animation:_ngcontent-%COMP%_dash 1.5s ease-in-out infinite}.refresh-indicator[_ngcontent-%COMP%]   .spinner-container[_ngcontent-%COMP%]{width:40px;height:40px;background:transparent;border-radius:50%;display:flex;align-items:center;justify-content:center;position:relative}.refresh-indicator[_ngcontent-%COMP%]   .instagram-spinner[_ngcontent-%COMP%]{width:24px;height:24px;z-index:2}.refresh-indicator[_ngcontent-%COMP%]   .instagram-spinner[_ngcontent-%COMP%]   .path[_ngcontent-%COMP%]{stroke:#fff;stroke-dasharray:1,200;stroke-dashoffset:0}@keyframes _ngcontent-%COMP%_rotate{to{transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_dash{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:89,200;stroke-dashoffset:-35px}to{stroke-dasharray:89,200;stroke-dashoffset:-124px}}']})};var gl=class n{selectedReelId=new mn(null);activeTab=new mn("feed");selectedReelId$=this.selectedReelId.asObservable();activeTab$=this.activeTab.asObservable();selectReel(e){console.log("[NavigationService] Setting selected reel:",e),this.selectedReelId.next(e)}switchToTab(e){console.log("[NavigationService] Switching to tab:",e),this.activeTab.next(e)}clearSelection(){this.selectedReelId.next(null)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})};function Cie(n,e){n&1&&(N(0,"div",6)(1,"h1"),ee(2,"Favorites"),$(),N(3,"p",7),ee(4,"Your curated collection of tastes"),$()())}function xie(n,e){n&1&&(N(0,"div",8),ae(1,"div",9),N(2,"p"),ee(3,"Loading favorites..."),$()())}function Aie(n,e){n&1&&(N(0,"div",10),Re(),N(1,"svg",11),ae(2,"path",12),$(),Be(),N(3,"h2"),ee(4,"No Favorites Yet"),$(),N(5,"p"),ee(6,"Bookmark your favorite reels to see them here"),$()())}function Die(n,e){if(n&1){let t=Et();N(0,"div",15),he("click",function(){let r=xe(t).$implicit,s=ve(2);return Ae(s.playReel(r))}),N(1,"div",16)(2,"video",17,0),he("loadeddata",function(){let r=xe(t).$implicit,s=ve(2);return Ae(s.onThumbLoad(r.id))})("loadedmetadata",function(){xe(t);let r=nc(3);return Ae(r.currentTime=.1)}),$(),N(4,"div",18),ee(5),$()(),N(6,"div",19)(7,"div",20)(8,"h3",21),ee(9),$()(),N(10,"p",22),ee(11),$(),N(12,"div",23)(13,"span",24),ee(14),$()()()()}if(n&2){let t=e.$implicit,i=ve(2);W(2),Ii("opacity",i.loadedThumbs.has(t.id)?1:0),ce("src",t.videoUrl,Jr),W(3),ut(t.distanceStr),W(4),ut(t.title),W(2),ut(t.vendor),W(3),Mt("\u20B9",t.price,"")}}function Pie(n,e){if(n&1&&(N(0,"div",13),Ve(1,Die,15,7,"div",14),$()),n&2){let t=ve();W(),ce("ngForOf",t.bookmarkedReels)}}var ro=class n{constructor(e,t,i,r,s,o){this.reelsService=e;this.auth=t;this.router=i;this.cdr=r;this.navigationService=s;this.locationService=o}showHeader=!0;bookmarkedReels=[];isLoading=!0;loadedThumbs=new Set;ngOnInit(){return U(this,null,function*(){yield this.loadBookmarkedReels()})}loadBookmarkedReels(){return U(this,null,function*(){console.log("[Favorites] Starting to load bookmarked reels..."),this.isLoading=!0,this.cdr.detectChanges();try{let e=this.auth.currentUser;if(console.log("[Favorites] Current user:",e?.uid||"Not logged in"),!e){this.bookmarkedReels=[],console.log("[Favorites] No user logged in, clearing bookmarks");return}console.log("[Favorites] Fetching all reels...");let t=yield this.reelsService.getReels(100);console.log("[Favorites] Fetched reels count:",t.length);let i=t.filter(r=>this.reelsService.isBookmarkedByUser(r,e.uid));this.bookmarkedReels=yield Promise.all(i.map(r=>U(this,null,function*(){let s="-- km";if(r.latitude&&r.longitude)try{let o=yield this.locationService.getUserLocation();s=this.locationService.calculateDistance(o.latitude,o.longitude,r.latitude,r.longitude).toFixed(1)+" km"}catch(o){console.warn("[Favorites] Error calculating distance for reel:",r.id,o)}return qe(de({},r),{distanceStr:s})}))),console.log("[Favorites] Bookmarked reels count:",this.bookmarkedReels.length)}catch(e){console.error("[Favorites] Error loading bookmarked reels:",e)}finally{this.isLoading=!1,this.cdr.detectChanges(),console.log("[Favorites] Loading complete. isLoading:",this.isLoading)}})}playReel(e){console.log("[Favorites] Playing reel:",e.id,e.title),this.navigationService.selectReel(e.id),this.router.navigate(["/main-app"])}onThumbLoad(e){this.loadedThumbs.add(e),this.cdr.detectChanges()}static \u0275fac=function(t){return new(t||n)(pe(Wi),pe(jt),pe(gt),pe(xi),pe(gl),pe(Gi))};static \u0275cmp=_t({type:n,selectors:[["app-favorites"]],inputs:{showHeader:"showHeader"},standalone:!0,features:[Tt],decls:5,vars:4,consts:[["videoThumb",""],[1,"favorites-container"],["class","hero-header",4,"ngIf"],["class","loading-state",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","results-grid",4,"ngIf"],[1,"hero-header"],[1,"subtitle"],[1,"loading-state"],[1,"spinner"],[1,"empty-state"],["width","80","height","80","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z","stroke","currentColor","stroke-width","2","fill","none"],[1,"results-grid"],["class","food-card",3,"click",4,"ngFor","ngForOf"],[1,"food-card",3,"click"],[1,"card-image"],["muted","","playsinline","","preload","metadata",3,"loadeddata","loadedmetadata","src"],[1,"distance-badge"],[1,"card-details"],[1,"header-row"],[1,"dish-name"],[1,"vendor-name"],[1,"price-row"],[1,"price"]],template:function(t,i){t&1&&(N(0,"div",1),Ve(1,Cie,5,0,"div",2)(2,xie,4,0,"div",3)(3,Aie,7,0,"div",4)(4,Pie,2,1,"div",5),$()),t&2&&(W(),ce("ngIf",i.showHeader),W(),ce("ngIf",i.isLoading),W(),ce("ngIf",!i.isLoading&&i.bookmarkedReels.length===0),W(),ce("ngIf",!i.isLoading&&i.bookmarkedReels.length>0))},dependencies:[Pt,Hn,qt],styles:[".favorites-container[_ngcontent-%COMP%]{height:100%;overflow-y:auto;background:#fff;padding-bottom:100px;-webkit-overflow-scrolling:touch}.hero-header[_ngcontent-%COMP%]{padding:24px 20px 32px;background:#fff;display:flex;flex-direction:column;align-items:center;text-align:center;border-bottom:1px solid rgba(0,0,0,.05)}.hero-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:34px;font-weight:800;margin:0 0 8px;color:#1c1c1e;letter-spacing:-.5px}.hero-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:17px;color:#8e8e93;margin:0;font-weight:400;max-width:280px;line-height:1.4}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:60px 20px;color:#8e8e93;gap:12px}.loading-state[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid #e5e5ea;border-top-color:var(--primary-color);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:15px;font-weight:500}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:80px 40px;color:#8e8e93}.empty-state[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{margin-bottom:20px;opacity:.5;color:#8e8e93}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#1c1c1e;margin:0 0 8px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:15px;font-weight:400;margin:0;color:#8e8e93}.results-grid[_ngcontent-%COMP%]{padding:20px;display:grid;grid-template-columns:repeat(2,1fr);gap:16px}.food-card[_ngcontent-%COMP%]{position:relative;border-radius:20px;overflow:hidden;cursor:pointer;aspect-ratio:3/4;background:#fff;box-shadow:0 4px 12px #00000014;transition:transform .2s}.food-card[_ngcontent-%COMP%]:active{transform:scale(.96)}.food-card[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;background:#121212}.food-card[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block;transition:opacity .4s ease;z-index:2}.food-card[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]   .distance-badge[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:#fffffff2;padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;color:#1c1c1e;z-index:3;pointer-events:none;box-shadow:0 2px 8px #0000001a}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;width:100%;padding:50px 14px 14px;background:linear-gradient(to top,rgba(0,0,0,.8) 0%,rgba(0,0,0,.4) 50%,transparent 100%);z-index:3;display:flex;flex-direction:column;gap:4px}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .dish-name[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:#fff;margin:0;line-height:1.2;text-shadow:0 2px 8px rgba(0,0,0,.5);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .vendor-name[_ngcontent-%COMP%]{font-size:12px;color:#ffffffe6;font-weight:500;margin-bottom:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .price-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .price-row[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-size:13px;font-weight:700;color:#fff;background:var(--primary-color);padding:4px 12px;border-radius:12px;box-shadow:0 2px 8px var(--primary-shadow)}"]})};var yl=a3(P$());function Rie(n,e){n&1&&(N(0,"span"),ee(1,"Search"),$())}function Mie(n,e){n&1&&(N(0,"span"),ee(1,"..."),$())}function kie(n,e){if(n&1){let t=Et();N(0,"div",20),he("click",function(){let r=xe(t).$implicit,s=ve(2);return Ae(s.selectSearchResult(r))}),ee(1),$()}if(n&2){let t=e.$implicit;W(),Mt(" ",t.display_name," ")}}function Lie(n,e){if(n&1&&(N(0,"div",18),Ve(1,kie,2,1,"div",19),$()),n&2){let t=ve();W(),ce("ngForOf",t.searchResults)}}var tE=class n{locationSelected=new tt;cancel=new tt;map;marker;searchQuery="";searchResults=[];isSearching=!1;selectedLat=12.9716;selectedLng=77.5946;constructor(){}ngOnInit(){}ngAfterViewInit(){this.initMap()}ngOnDestroy(){this.map&&this.map.remove()}initMap(){this.map=yl.map("map").setView([this.selectedLat,this.selectedLng],13),yl.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xA9 OpenStreetMap contributors"}).addTo(this.map),this.addMarker(this.selectedLat,this.selectedLng),this.map.on("click",e=>{this.updateLocation(e.latlng.lat,e.latlng.lng)}),setTimeout(()=>{this.map?.invalidateSize()},100)}addMarker(e,t){if(this.marker)this.marker.setLatLng([e,t]);else{let i=yl.divIcon({className:"custom-pin",html:`<svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="#ff4757" stroke="white" stroke-width="2"/>
               </svg>`,iconSize:[30,30],iconAnchor:[15,30]});this.marker=yl.marker([e,t],{icon:i,draggable:!0}).addTo(this.map),this.marker.on("dragend",()=>{let r=this.marker.getLatLng();this.updateLocation(r.lat,r.lng,!1)})}}updateLocation(e,t,i=!1){this.selectedLat=e,this.selectedLng=t,this.marker?this.marker.setLatLng([e,t]):this.addMarker(e,t),i&&this.map&&this.map.panTo([e,t])}searchLocation(){return U(this,null,function*(){if(this.searchQuery.trim()){this.isSearching=!0,this.searchResults=[];try{let t=yield(yield fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(this.searchQuery)}`)).json();this.searchResults=t}catch(e){console.error("Error searching location:",e)}finally{this.isSearching=!1}}})}selectSearchResult(e){let t=parseFloat(e.lat),i=parseFloat(e.lon);this.updateLocation(t,i,!0),this.searchResults=[],this.searchQuery=e.display_name.split(",")[0]}confirmSelection(){this.locationSelected.emit({lat:this.selectedLat,lng:this.selectedLng})}onCancel(){this.cancel.emit()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=_t({type:n,selectors:[["app-location-picker"]],outputs:{locationSelected:"locationSelected",cancel:"cancel"},standalone:!0,features:[Tt],decls:27,vars:13,consts:[[1,"picker-overlay"],[1,"picker-container"],[1,"picker-header"],[1,"close-btn",3,"click"],["width","24","height","24","viewBox","0 0 24 24","fill","none"],["d","M18 6L6 18M6 6l12 12","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"search-bar"],["type","text","placeholder","Search for a place...",3,"ngModelChange","keyup.enter","ngModel"],[1,"search-btn",3,"click","disabled"],[4,"ngIf"],["class","search-results",4,"ngIf"],[1,"map-container"],["id","map"],[1,"picker-footer"],[1,"coords"],[1,"actions"],[1,"cancel-btn",3,"click"],[1,"confirm-btn",3,"click"],[1,"search-results"],["class","result-item",3,"click",4,"ngFor","ngForOf"],[1,"result-item",3,"click"]],template:function(t,i){t&1&&(N(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3"),ee(4,"Pick Location"),$(),N(5,"button",3),he("click",function(){return i.onCancel()}),Re(),N(6,"svg",4),ae(7,"path",5),$()()(),Be(),N(8,"div",6)(9,"input",7),ii("ngModelChange",function(s){return di(i.searchQuery,s)||(i.searchQuery=s),s}),he("keyup.enter",function(){return i.searchLocation()}),$(),N(10,"button",8),he("click",function(){return i.searchLocation()}),Ve(11,Rie,2,0,"span",9)(12,Mie,2,0,"span",9),$()(),Ve(13,Lie,2,1,"div",10),N(14,"div",11),ae(15,"div",12),$(),N(16,"div",13)(17,"div",14)(18,"small"),ee(19),Xh(20,"number"),Xh(21,"number"),$()(),N(22,"div",15)(23,"button",16),he("click",function(){return i.onCancel()}),ee(24,"Cancel"),$(),N(25,"button",17),he("click",function(){return i.confirmSelection()}),ee(26,"Confirm Location"),$()()()()()),t&2&&(W(9),ni("ngModel",i.searchQuery),W(),ce("disabled",i.isSearching),W(),ce("ngIf",!i.isSearching),W(),ce("ngIf",i.isSearching),W(),ce("ngIf",i.searchResults.length>0),W(6),Vw("",Jh(20,7,i.selectedLat,"1.4-4"),", ",Jh(21,10,i.selectedLng,"1.4-4"),""))},dependencies:[Pt,Hn,qt,Xk,ji,$i,Fr,pr],styles:[".picker-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000c;z-index:2000;display:flex;align-items:center;justify-content:center;padding:20px}.picker-container[_ngcontent-%COMP%]{background:#1a1a1a;width:100%;max-width:500px;height:80vh;border-radius:12px;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 4px 20px #00000080}.picker-header[_ngcontent-%COMP%]{padding:15px 20px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,.1)}.picker-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#fff;font-size:1.1rem}.picker-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;padding:5px;cursor:pointer}.search-bar[_ngcontent-%COMP%]{padding:15px;display:flex;gap:10px}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;background:#333;border:1px solid #444;border-radius:8px;padding:10px 15px;color:#fff;font-size:.95rem}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-color)}.search-bar[_ngcontent-%COMP%]   .search-btn[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;border:none;border-radius:8px;padding:0 20px;font-weight:600;cursor:pointer}.search-bar[_ngcontent-%COMP%]   .search-btn[_ngcontent-%COMP%]:disabled{opacity:.7}.search-results[_ngcontent-%COMP%]{background:#2a2a2a;max-height:150px;overflow-y:auto;border-bottom:1px solid #444}.search-results[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]{padding:12px 15px;color:#ddd;border-bottom:1px solid #333;cursor:pointer;font-size:.9rem}.search-results[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]:hover{background:#333}.map-container[_ngcontent-%COMP%]{flex:1;position:relative;background:#eee}.map-container[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:100%;height:100%}.picker-footer[_ngcontent-%COMP%]{padding:15px 20px;background:#1a1a1a;display:flex;justify-content:space-between;align-items:center;border-top:1px solid rgba(255,255,255,.1)}.picker-footer[_ngcontent-%COMP%]   .coords[_ngcontent-%COMP%]{color:#888;font-family:monospace}.picker-footer[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:10px}.picker-footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-weight:600;cursor:pointer;border:none}.picker-footer[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]{background:#333;color:#fff}.picker-footer[_ngcontent-%COMP%]   .confirm-btn[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff}"]})};function Oie(n,e){if(n&1){let t=Et();N(0,"div",39)(1,"div",40),Re(),N(2,"svg",41),ae(3,"polygon",42)(4,"rect",43),$()(),Be(),N(5,"div",44)(6,"p",45),ee(7),$(),N(8,"p",46),ee(9),$()(),N(10,"button",47),he("click",function(){xe(t);let r=ve();return Ae(r.removeFile())}),Re(),N(11,"svg",48),ae(12,"line",6)(13,"line",7),$()()()}if(n&2){let t=ve();W(7),ut(t.selectedFile.name),W(2),Mt("",(t.selectedFile.size/(1024*1024)).toFixed(1)," MB")}}function Nie(n,e){if(n&1){let t=Et();N(0,"label",49)(1,"input",50),he("change",function(r){xe(t);let s=ve();return Ae(s.onFileSelected(r))}),$(),N(2,"div",51),Re(),N(3,"svg",52),ae(4,"path",53)(5,"polyline",54)(6,"line",55),$()(),Be(),N(7,"span",56),ee(8,"Select Video for Reel"),$(),N(9,"span",57),ee(10,"MP4, MOV (Max 100MB)"),$()()}}function Fie(n,e){if(n&1){let t=Et();N(0,"div",58),ee(1),N(2,"span",59),he("click",function(){let r=xe(t).index,s=ve();return Ae(s.removeTag(r))}),ee(3,"\xD7"),$()()}if(n&2){let t=e.$implicit;W(),Mt(" ",t," ")}}function Vie(n,e){if(n&1&&(N(0,"div",60)(1,"div",61),ee(2),$(),N(3,"div",61),ee(4),$()()),n&2){let t=ve();W(2),ut(t.latitude||0),W(2),ut(t.longitude||0)}}function Bie(n,e){if(n&1&&(N(0,"div",62),ee(1),$()),n&2){let t=ve();W(),ut(t.uploadError)}}function Uie(n,e){n&1&&(N(0,"div",63),ee(1,"Upload Successful!"),$())}function $ie(n,e){if(n&1&&(N(0,"div",64)(1,"div",65),ae(2,"div",66),$(),N(3,"span",67),ee(4),$()()),n&2){let t=ve();W(2),Ii("width",t.isTranscoding?t.transcodeProgress:t.uploadProgress,"%"),W(2),ut(t.isTranscoding?"Optimizing Video...":"Uploading...")}}function jie(n,e){if(n&1){let t=Et();N(0,"app-location-picker",68),he("locationSelected",function(r){xe(t);let s=ve();return Ae(s.onLocationSelected(r))})("cancel",function(){xe(t);let r=ve();return Ae(r.closeLocationPicker())}),$()}}var Hc=class n{constructor(e,t,i,r,s){this.reelsService=e;this.auth=t;this.router=i;this.locationService=r;this.location=s}title="";vendor="";price=null;categories=[];tagInput="";latitude=null;longitude=null;uploadComplete=new tt;canceled=new tt;selectedFile=null;videoPreviewUrl=null;isUploading=!1;isTranscoding=!1;uploadProgress=0;transcodeProgress=0;uploadError=null;uploadSuccess=!1;transcodeIframe=null;transcodeResolver=null;transcodeRejecter=null;isTranscoderReady=!1;maxFileSize=200*1024*1024;acceptedFormats=["video/mp4","video/quicktime","video/webm"];ngOnInit(){this.resetForm()}goBack(){this.location.back()}onFileSelected(e){let t=e.target;if(t.files&&t.files.length>0){let i=t.files[0];this.validateAndSetFile(i)}}validateAndSetFile(e){if(this.uploadError=null,!this.acceptedFormats.includes(e.type)){this.uploadError="Please select a valid video file (MP4, MOV, or WebM)";return}if(e.size>this.maxFileSize){this.uploadError=`File size must be less than ${this.maxFileSize/(1024*1024)}MB`;return}this.selectedFile=e,this.createVideoPreview(e)}createVideoPreview(e){this.videoPreviewUrl&&URL.revokeObjectURL(this.videoPreviewUrl),this.videoPreviewUrl=URL.createObjectURL(e)}removeFile(){this.videoPreviewUrl&&URL.revokeObjectURL(this.videoPreviewUrl),this.selectedFile=null,this.videoPreviewUrl=null,this.uploadError=null}resetForm(){this.removeFile(),this.title="",this.vendor="",this.price=null,this.categories=[],this.tagInput="",this.uploadProgress=0,this.uploadSuccess=!1,this.isUploading=!1,this.latitude=null,this.longitude=null}hasChanges(){return!!(this.selectedFile||this.title||this.vendor||this.price||this.categories.length>0||this.latitude||this.longitude)&&!this.uploadSuccess}isFormValid(){return!!(this.selectedFile&&this.title.trim()&&this.vendor.trim()&&this.price!==null&&this.price>0&&this.categories.length>0&&this.latitude!==null&&this.longitude!==null)}handleTagInput(){if(this.tagInput.includes(",")){let e=this.tagInput.split(",").map(t=>t.trim()).filter(t=>t!==""&&!this.categories.includes(t));e.length>0&&(this.categories=[...this.categories,...e]),this.tagInput=""}}removeTag(e){this.categories.splice(e,1)}showLocationPicker=!1;getCurrentLocation(){return U(this,null,function*(){try{let e=yield this.locationService.getUserLocation();this.latitude=e.latitude,this.longitude=e.longitude}catch(e){console.error("Error getting location:",e),this.uploadError="Failed to get current location. Please enter coordinates manually."}})}openLocationPicker(){this.showLocationPicker=!0}onLocationSelected(e){this.latitude=e.lat,this.longitude=e.lng,this.showLocationPicker=!1}closeLocationPicker(){this.showLocationPicker=!1}initTranscodeIframe(){return this.transcodeIframe?Promise.resolve():new Promise(e=>{this.transcodeIframe=document.createElement("iframe"),this.transcodeIframe.style.display="none",this.transcodeIframe.src="assets/transcoder/index.html",window.addEventListener("message",t=>{let i=t.data;if(!(!i||typeof i!="object"))switch(i.type){case"READY":this.isTranscoderReady=!0,e();break;case"PROGRESS":this.transcodeProgress=Math.round(i.progress*100);break;case"LOG":console.log("[Iframe Transcoder LOG]",i.message);break;case"COMPLETE":this.transcodeResolver&&(this.transcodeResolver({playlist:i.playlist,segments:i.segments}),this.transcodeResolver=null);break;case"ERROR":this.transcodeRejecter&&(this.transcodeRejecter(new Error(i.message)),this.transcodeRejecter=null);break}}),document.body.appendChild(this.transcodeIframe)})}transcodeToHls(e){return U(this,null,function*(){return console.log("[Upload] Starting transcoding process..."),yield this.initTranscodeIframe(),console.log("[Upload] Iframe initialized, sending file to transcode..."),new Promise((t,i)=>{this.transcodeResolver=t,this.transcodeRejecter=i,console.log("[Upload] Posting message to iframe:",{type:"TRANSCODE",fileName:e.name,fileSize:e.size,fileType:e.type}),this.transcodeIframe?.contentWindow?.postMessage({type:"TRANSCODE",file:e,name:e.name},"*")})})}uploadReel(){return U(this,null,function*(){if(!this.isFormValid()||!this.selectedFile){this.uploadError="Please fill in all fields and select a video";return}let t=this.auth.currentUser?.uid||"test-user-id";this.isUploading=!0,this.isTranscoding=!0,this.uploadError=null,this.uploadProgress=0,this.transcodeProgress=0,this.uploadSuccess=!1;try{let i=yield this.transcodeToHls(this.selectedFile);this.isTranscoding=!1;let r=Date.now(),s=`videos/${t}/${r}/`;for(let u=0;u<i.segments.length;u++){let d=i.segments[u],f=`${s}${d.name}`,m=yield va(this.reelsService.getUploadUrl(f,d.blob.type));yield va(this.reelsService.uploadToR2(m.uploadUrl,d.blob)),this.uploadProgress=Math.round((u+1)/(i.segments.length+1)*100)}let o=`${s}index.m3u8`,a=yield va(this.reelsService.getUploadUrl(o,i.playlist.type));yield va(this.reelsService.uploadToR2(a.uploadUrl,i.playlist)),this.uploadProgress=100;let l=`https://r2-video-uploader.bengaluru-swada.workers.dev/${o}`;yield this.reelsService.createReel({cloudflareVideoId:"",videoUrl:l,thumbnailUrl:"",duration:0,title:this.title.trim(),vendor:this.vendor.trim(),price:this.price,categories:this.categories,latitude:this.latitude,longitude:this.longitude,uploadedBy:t,createdAt:null,viewCount:0,likes:0,likedBy:[],bookmarkedBy:[],isPublic:!0}),this.uploadSuccess=!0,this.isUploading=!1,this.uploadComplete.emit(),setTimeout(()=>{this.resetForm(),this.router.navigate(["/main-app"])},1500)}catch(i){console.error("Upload flow error:",i),this.uploadError=i instanceof Error?i.message:"Unknown error occurred during processing.",this.isUploading=!1,this.isTranscoding=!1}})}cancel(){this.canceled.emit(),this.resetForm(),this.router.navigate(["/main-app"])}ngOnDestroy(){this.videoPreviewUrl&&URL.revokeObjectURL(this.videoPreviewUrl)}static \u0275fac=function(t){return new(t||n)(pe(Wi),pe(jt),pe(gt),pe(Gi),pe(Fa))};static \u0275cmp=_t({type:n,selectors:[["app-upload-reel"]],outputs:{uploadComplete:"uploadComplete",canceled:"canceled"},standalone:!0,features:[Tt],decls:62,vars:22,consts:[["emptyState",""],[1,"ios-upload-layout"],[1,"upload-header"],[1,"header-left"],[1,"close-glass-btn",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"page-title"],[1,"header-right"],[1,"scroll-content"],[1,"video-hero-section"],["class","video-preview-card",4,"ngIf","ngIfElse"],[1,"form-wrapper"],[1,"input-group"],["type","text","placeholder","e.g. Masala Dosa",3,"ngModelChange","ngModel","disabled"],[1,"tags-row"],["class","tag-pill",4,"ngFor","ngForOf"],["type","text","placeholder","Add category (e.g. Spicy)...",1,"secondary-input",3,"ngModelChange","input","ngModel","disabled"],["type","text","placeholder","e.g. CTR",3,"ngModelChange","ngModel","disabled"],["type","number","placeholder","0",3,"ngModelChange","ngModel","disabled"],[1,"location-grid"],[1,"location-tile",3,"click"],[1,"tile-icon","orange"],["width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"],["cx","12","cy","9","r","2.5"],[1,"tile-icon","blue"],["points","1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"],["x1","8","y1","2","x2","8","y2","18"],["x1","16","y1","6","x2","16","y2","22"],["class","coords-row",4,"ngIf"],[2,"height","200px"],[1,"submit-bar"],["class","status-toast error",4,"ngIf"],["class","status-toast success",4,"ngIf"],["class","progress-area",4,"ngIf"],[1,"primary-btn",3,"click","disabled"],[3,"locationSelected","cancel",4,"ngIf"],[1,"video-preview-card"],[1,"file-icon-badge"],["width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","white","stroke-width","2"],["points","23 7 16 12 23 17 23 7"],["x","1","y","5","width","15","height","14","rx","2","ry","2"],[1,"file-info"],[1,"filename"],[1,"filesize"],[1,"remove-btn",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],[1,"upload-placeholder"],["type","file","accept","video/mp4,video/quicktime,video/webm","hidden","",3,"change"],[1,"icon-circle"],["width","32","height","32","viewBox","0 0 24 24","fill","none","stroke","#10B981","stroke-width","2"],["d","M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"],["points","17 8 12 3 7 8"],["x1","12","y1","3","x2","12","y2","15"],[1,"upload-label"],[1,"upload-sub"],[1,"tag-pill"],[1,"remove-x",3,"click"],[1,"coords-row"],[1,"coord-pill"],[1,"status-toast","error"],[1,"status-toast","success"],[1,"progress-area"],[1,"progress-track"],[1,"progress-bar"],[1,"progress-label"],[3,"locationSelected","cancel"]],template:function(t,i){if(t&1){let r=Et();N(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),he("click",function(){return xe(r),Ae(i.goBack())}),Re(),N(4,"svg",5),ae(5,"line",6)(6,"line",7),$()()(),Be(),N(7,"h1",8),ee(8,"New Reel"),$(),ae(9,"div",9),$(),N(10,"div",10)(11,"div",11),Ve(12,Oie,14,2,"div",12)(13,Nie,11,0,"ng-template",null,0,c0),$(),N(15,"div",13)(16,"div",14)(17,"label"),ee(18,"Dish Name"),$(),N(19,"input",15),ii("ngModelChange",function(o){return xe(r),di(i.title,o)||(i.title=o),Ae(o)}),$()(),N(20,"div",14)(21,"label"),ee(22,"Categories"),$(),N(23,"div",16),Ve(24,Fie,4,1,"div",17),$(),N(25,"input",18),ii("ngModelChange",function(o){return xe(r),di(i.tagInput,o)||(i.tagInput=o),Ae(o)}),he("input",function(){return xe(r),Ae(i.handleTagInput())}),$()(),N(26,"div",14)(27,"label"),ee(28,"Vendor Name"),$(),N(29,"input",19),ii("ngModelChange",function(o){return xe(r),di(i.vendor,o)||(i.vendor=o),Ae(o)}),$()(),N(30,"div",14)(31,"label"),ee(32,"Price (\u20B9)"),$(),N(33,"input",20),ii("ngModelChange",function(o){return xe(r),di(i.price,o)||(i.price=o),Ae(o)}),$()(),N(34,"div",14)(35,"label"),ee(36,"Store Location"),$(),N(37,"div",21)(38,"div",22),he("click",function(){return xe(r),Ae(i.getCurrentLocation())}),N(39,"div",23),Re(),N(40,"svg",24),ae(41,"path",25)(42,"circle",26),$()(),Be(),N(43,"span"),ee(44,"Current Location"),$()(),N(45,"div",22),he("click",function(){return xe(r),Ae(i.openLocationPicker())}),N(46,"div",27),Re(),N(47,"svg",24),ae(48,"polygon",28)(49,"line",29)(50,"line",30),$()(),Be(),N(51,"span"),ee(52,"Pick on Map"),$()()(),Ve(53,Vie,5,2,"div",31),$()(),ae(54,"div",32),$(),N(55,"div",33),Ve(56,Bie,2,1,"div",34)(57,Uie,2,0,"div",35)(58,$ie,5,3,"div",36),N(59,"button",37),he("click",function(){return xe(r),Ae(i.uploadReel())}),ee(60),$()(),Ve(61,jie,1,0,"app-location-picker",38),$()}if(t&2){let r=nc(14);W(12),ce("ngIf",i.selectedFile)("ngIfElse",r),W(7),ni("ngModel",i.title),ce("disabled",i.isUploading),W(5),ce("ngForOf",i.categories),W(),ni("ngModel",i.tagInput),ce("disabled",i.isUploading),W(4),ni("ngModel",i.vendor),ce("disabled",i.isUploading),W(4),ni("ngModel",i.price),ce("disabled",i.isUploading),W(5),Qe("disabled",i.isUploading),W(7),Qe("disabled",i.isUploading),W(8),ce("ngIf",i.latitude||i.longitude),W(3),ce("ngIf",i.uploadError),W(),ce("ngIf",i.uploadSuccess),W(),ce("ngIf",i.isUploading||i.isTranscoding),W(),ce("disabled",!i.isFormValid()||i.isUploading),W(),Mt(" ",i.isUploading?"Processing...":"Upload Reel"," "),W(),ce("ngIf",i.showLocationPicker)}},dependencies:[Pt,Hn,qt,ji,$i,oA,Fr,pr,tE],styles:["[_nghost-%COMP%]{display:block;height:100vh;font-family:-apple-system,BlinkMacSystemFont,SF Pro Display,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#fff}.ios-upload-layout[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;position:relative;background:#fff}.upload-header[_ngcontent-%COMP%]{height:60px;display:flex;align-items:center;justify-content:space-between;padding:0 20px;border-bottom:1px solid rgba(0,0,0,.05);background:#ffffffe6;backdrop-filter:blur(10px);position:sticky;top:0;z-index:10}.close-glass-btn[_ngcontent-%COMP%]{background:#fff;border:1px solid rgba(0,0,0,.08);width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s cubic-bezier(.2,.8,.2,1);color:#000;box-shadow:0 4px 12px #0000001f}.close-glass-btn[_ngcontent-%COMP%]:active{transform:scale(.92);background:#f5f5f5}.page-title[_ngcontent-%COMP%]{font-size:17px;font-weight:700;color:#000;margin:0;letter-spacing:-.3px}.scroll-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:24px}.video-hero-section[_ngcontent-%COMP%]{margin-bottom:32px}.upload-placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;background:var(--primary-tint);border:2px dashed var(--primary-shadow);border-radius:20px;cursor:pointer;transition:all .2s}.upload-placeholder[_ngcontent-%COMP%]:active{background:var(--primary-shadow-sm);transform:scale(.98)}.upload-placeholder[_ngcontent-%COMP%]   .icon-circle[_ngcontent-%COMP%]{width:64px;height:64px;display:flex;align-items:center;justify-content:center;background:#fff;border-radius:50%;margin-bottom:16px;box-shadow:0 4px 12px var(--primary-shadow-xs)}.upload-placeholder[_ngcontent-%COMP%]   .upload-label[_ngcontent-%COMP%]{font-size:17px;font-weight:600;color:var(--primary-color);margin-bottom:4px}.upload-placeholder[_ngcontent-%COMP%]   .upload-sub[_ngcontent-%COMP%]{font-size:13px;color:#98989d}.video-preview-card[_ngcontent-%COMP%]{height:80px;background:#1c1c1e;border-radius:16px;padding:12px;display:flex;align-items:center;gap:16px;box-shadow:0 8px 24px #0000001a}.video-preview-card[_ngcontent-%COMP%]   .file-icon-badge[_ngcontent-%COMP%]{width:48px;height:48px;background:#3a3a3c;border-radius:10px;display:flex;align-items:center;justify-content:center}.video-preview-card[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]{flex:1;overflow:hidden}.video-preview-card[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]   .filename[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:500;margin:0 0 2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.video-preview-card[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]   .filesize[_ngcontent-%COMP%]{color:#8e8e93;font-size:13px;margin:0}.video-preview-card[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]{background:#ffffff1a;border:none;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--primary-color);cursor:pointer}.form-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.input-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:13px;font-weight:600;color:#8e8e93;text-transform:uppercase;letter-spacing:.5px;padding-left:4px}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:#f2f2f7;border:none;border-radius:16px;padding:16px;font-size:17px;color:#1c1c1e;font-weight:500;outline:none;transition:background .2s}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{background:#e5e5ea}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#c7c7cc}.input-group[_ngcontent-%COMP%]   .tags-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:8px}.input-group[_ngcontent-%COMP%]   .tag-pill[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;padding:6px 12px;border-radius:100px;font-size:14px;font-weight:600;display:flex;align-items:center;gap:6px}.input-group[_ngcontent-%COMP%]   .tag-pill[_ngcontent-%COMP%]   .remove-x[_ngcontent-%COMP%]{font-size:16px;opacity:.7;cursor:pointer}.input-group[_ngcontent-%COMP%]   .secondary-input[_ngcontent-%COMP%]{background:transparent;padding:8px 0;font-size:15px;border-bottom:1px solid #E5E5EA;border-radius:0}.input-group[_ngcontent-%COMP%]   .secondary-input[_ngcontent-%COMP%]:focus{background:transparent;border-bottom-color:var(--primary-color)}.location-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px}.location-tile[_ngcontent-%COMP%]{background:#f2f2f7;border-radius:16px;padding:16px;display:flex;flex-direction:column;align-items:center;gap:10px;cursor:pointer;transition:all .2s}.location-tile[_ngcontent-%COMP%]   .tile-icon[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center}.location-tile[_ngcontent-%COMP%]   .tile-icon.orange[_ngcontent-%COMP%]{background:var(--primary-tint);color:var(--primary-color)}.location-tile[_ngcontent-%COMP%]   .tile-icon.blue[_ngcontent-%COMP%]{background:#e5f1ff;color:#007aff}.location-tile[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:13px;font-weight:600;color:#1c1c1e}.location-tile[_ngcontent-%COMP%]:active{transform:scale(.96);background:#e5e5ea}.coords-row[_ngcontent-%COMP%]{display:flex;gap:8px}.coords-row[_ngcontent-%COMP%]   .coord-pill[_ngcontent-%COMP%]{background:#f9f9f9;border:1px solid #E5E5EA;padding:6px 10px;border-radius:8px;font-size:12px;color:#8e8e93;font-family:monospace}.submit-bar[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;background:#ffffffe6;backdrop-filter:blur(20px);padding:16px 24px 10px;border-top:1px solid rgba(0,0,0,.05);display:flex;flex-direction:column;gap:12px;z-index:20}.primary-btn[_ngcontent-%COMP%]{width:100%;height:56px;background:var(--primary-color);color:#fff;font-size:17px;font-weight:600;border:none;border-radius:16px;cursor:pointer;box-shadow:0 8px 20px var(--primary-shadow);transition:all .2s}.primary-btn[_ngcontent-%COMP%]:disabled{background:#e5e5ea;color:#8e8e93;box-shadow:none;cursor:not-allowed}.primary-btn[_ngcontent-%COMP%]:active:not(:disabled){transform:scale(.96)}.status-toast[_ngcontent-%COMP%]{text-align:center;font-size:13px;font-weight:600;padding:8px;border-radius:8px}.status-toast.error[_ngcontent-%COMP%]{background:#fee;color:var(--primary-color)}.status-toast.success[_ngcontent-%COMP%]{background:#e0fbe4;color:#34c759}.progress-area[_ngcontent-%COMP%]{width:100%}.progress-area[_ngcontent-%COMP%]   .progress-track[_ngcontent-%COMP%]{height:4px;background:#e5e5ea;border-radius:2px;overflow:hidden;margin-bottom:6px}.progress-area[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{height:100%;background:#34c759;transition:width .3s}.progress-area[_ngcontent-%COMP%]   .progress-label[_ngcontent-%COMP%]{font-size:12px;color:#8e8e93;text-align:center;display:block}"]})};function Gie(n,e){if(n&1){let t=Et();N(0,"div",40),he("click",function(){let r=xe(t).$implicit,s=ve(2);return Ae(s.selectLocation(r))}),N(1,"div",41),Re(),N(2,"svg",42),ae(3,"path",11),$()(),Be(),N(4,"div",43)(5,"div",44),ee(6),$(),N(7,"div",45),ee(8),$()(),Re(),N(9,"svg",46),ae(10,"path",47),$()()}if(n&2){let t=e.$implicit;W(6),ut(t.name),W(2),Mt("Pincode: ",t.pincode,"")}}function zie(n,e){n&1&&(N(0,"div",48),Re(),N(1,"svg",49),ae(2,"circle",34)(3,"path",35),$(),Be(),N(4,"p"),ee(5,"No locations found"),$(),N(6,"span"),ee(7,"Try searching for a different area"),$()())}function Hie(n,e){if(n&1){let t=Et();N(0,"div",26),he("click",function(){xe(t);let r=ve();return Ae(r.closeLocationModal())}),N(1,"div",27),he("click",function(r){return xe(t),Ae(r.stopPropagation())}),N(2,"div",28)(3,"h2"),ee(4,"Select Location"),$(),N(5,"button",29),he("click",function(){xe(t);let r=ve();return Ae(r.closeLocationModal())}),Re(),N(6,"svg",30),ae(7,"path",31),$()()(),Be(),N(8,"div",32),Re(),N(9,"svg",33),ae(10,"circle",34)(11,"path",35),$(),Be(),N(12,"input",36),ii("ngModelChange",function(r){xe(t);let s=ve();return di(s.locationSearchQuery,r)||(s.locationSearchQuery=r),Ae(r)}),$()(),N(13,"div",37),Ve(14,Gie,11,2,"div",38)(15,zie,8,0,"div",39),$()()()}if(n&2){let t=ve();W(12),ni("ngModel",t.locationSearchQuery),W(2),ce("ngForOf",t.filteredLocations),W(),ce("ngIf",t.filteredLocations.length===0)}}function qie(n,e){n&1&&(N(0,"span",56),ee(1,"\u2713"),$())}function Wie(n,e){if(n&1){let t=Et();N(0,"button",54),he("click",function(){let r=xe(t).$implicit,s=ve(2);return Ae(s.selectSort(r))}),Ve(1,qie,2,0,"span",55),ee(2),$()}if(n&2){let t=e.$implicit,i=ve(2);Qe("active",i.selectedSort===t),W(),ce("ngIf",i.selectedSort===t),W(),Mt(" ",t," ")}}function Kie(n,e){if(n&1){let t=Et();N(0,"button",54),he("click",function(){let r=xe(t).$implicit,s=ve(2);return Ae(s.selectDistance(r))}),ee(1),$()}if(n&2){let t=e.$implicit,i=ve(2);Qe("active",i.selectedDistance===t),W(),Mt(" ",t.label," ")}}function Yie(n,e){if(n&1){let t=Et();N(0,"button",54),he("click",function(){let r=xe(t).$implicit,s=ve(2);return Ae(s.selectPrice(r))}),ee(1),$()}if(n&2){let t=e.$implicit,i=ve(2);Qe("active",i.selectedPriceRange===t),W(),Mt(" ",t.label," ")}}function Qie(n,e){if(n&1&&(N(0,"div",50)(1,"div",51),Ve(2,Wie,3,4,"button",52),ae(3,"div",53),Ve(4,Kie,2,3,"button",52),$(),N(5,"div",51),Ve(6,Yie,2,3,"button",52),$()()),n&2){let t=ve();W(2),ce("ngForOf",t.sortOptions),W(2),ce("ngForOf",t.distances),W(2),ce("ngForOf",t.priceRanges)}}function Zie(n,e){n&1&&(N(0,"div",57),ae(1,"div",58),$())}function Xie(n,e){n&1&&(N(0,"div")(1,"p"),ee(2,"Search for your favorite food or browse categories!"),$()())}function Jie(n,e){n&1&&(N(0,"p"),ee(1,"No tasty bites found matching your search."),$())}function ere(n,e){if(n&1&&(N(0,"div",59),Ve(1,Xie,3,0,"div",60)(2,Jie,2,0,"ng-template",null,0,c0),$()),n&2){let t=nc(3),i=ve();W(),ce("ngIf",i.reels.length===0)("ngIfElse",t)}}function tre(n,e){if(n&1){let t=Et();N(0,"div",61),he("click",function(){let r=xe(t).$implicit,s=ve();return Ae(s.openReel(r))}),N(1,"div",62)(2,"video",63,1),he("loadeddata",function(){let r=xe(t).$implicit,s=ve();return Ae(s.onThumbLoad(r.id))})("loadedmetadata",function(){xe(t);let r=nc(3);return Ae(r.currentTime=.1)}),$(),N(4,"div",64),ee(5),$()(),N(6,"div",65)(7,"div",66)(8,"h3",67),ee(9),$()(),N(10,"p",68),ee(11),$(),N(12,"div",69)(13,"span",70),ee(14),$()()()()}if(n&2){let t=e.$implicit,i=ve();W(2),Ii("opacity",i.loadedThumbs.has(t.id)?1:0),ce("src",t.videoUrl,Jr),W(3),ut(t.distanceStr),W(4),ut(t.title),W(2),ut(t.vendor),W(3),Mt("\u20B9",t.price,"")}}var qc=class n{constructor(e,t,i,r,s){this.reelsService=e;this.locationService=t;this.navigationService=i;this.admobService=r;this.router=s}searchQuery="";reels=[];filteredReels=[];isLoading=!1;loadedThumbs=new Set;locationName="Koramangala, Bangalore";showLocationModal=!1;locationSearchQuery="";categories=["All","South Indian","North Indian","Street Food","Desserts","Beverages"];selectedCategory="All";priceRanges=[{label:"All",min:0,max:1/0},{label:"\u20B90-30",min:0,max:30},{label:"\u20B931-60",min:31,max:60},{label:"\u20B961-100",min:61,max:100},{label:"\u20B9100+",min:101,max:1/0}];selectedPriceRange=this.priceRanges[0];distances=[{label:"All",max:1/0},{label:"< 1 km",max:1},{label:"1-3 km",max:3},{label:"3-5 km",max:5},{label:"5+ km",max:1/0}];selectedDistance=this.distances[0];sortOptions=["Nearest First","Price: Low to High","Price: High to Low"];selectedSort="Nearest First";ngOnInit(){return U(this,null,function*(){this.locationService.currentLocation$.subscribe(e=>{e&&(this.locationName=`${e.name}, Bangalore`,this.reels.length>0&&this.loadReels())});try{let e=yield this.locationService.getUserLocation();this.locationName=this.locationService.getAreaName(e.latitude,e.longitude)+", Bangalore"}catch(e){console.warn("Could not get initial location name",e)}this.admobService.showBanner()})}loadReels(){return U(this,null,function*(){this.isLoading=!0;try{let e=yield this.reelsService.getReels(50);this.reels=yield Promise.all(e.map(t=>U(this,null,function*(){let i=1/0,r="-- km";if(t.latitude&&t.longitude)try{let s=yield this.locationService.getUserLocation();i=this.locationService.calculateDistance(s.latitude,s.longitude,t.latitude,t.longitude),r=i.toFixed(1)+" km"}catch(s){console.error("Error calculating distance",s)}return qe(de({},t),{distanceVal:i,distanceStr:r,rating:(4+Math.random()).toFixed(1)})})))}catch(e){console.error("Error loading reels for search:",e)}finally{this.isLoading=!1}})}hasSearchMatches=!1;applyFilters(){return U(this,null,function*(){if(!this.searchQuery.trim()){this.filteredReels=[],this.hasSearchMatches=!1;return}this.reels.length===0&&!this.isLoading&&(yield this.loadReels());let e=this.reels;if(this.searchQuery.trim()){let t=this.searchQuery.toLowerCase();e=e.filter(i=>i.title?.toLowerCase().includes(t)||i.vendor?.toLowerCase().includes(t))}if(this.hasSearchMatches=e.length>0,this.selectedCategory!=="All"&&(e=e.filter(t=>t.categories&&Array.isArray(t.categories)&&t.categories.includes(this.selectedCategory))),e=e.filter(t=>{let i=Number(t.price);return i>=this.selectedPriceRange.min&&i<=this.selectedPriceRange.max}),this.selectedDistance.label!=="All")if(this.selectedDistance.label==="5+ km")e=e.filter(t=>t.distanceVal>5&&t.distanceVal!==1/0);else if(this.selectedDistance.label==="< 1 km")e=e.filter(t=>t.distanceVal<1);else{let t=this.selectedDistance.max,i=this.distances[this.distances.indexOf(this.selectedDistance)-1]?.max||0;this.selectedDistance.label==="1-3 km"?e=e.filter(r=>r.distanceVal>=1&&r.distanceVal<=3):this.selectedDistance.label==="3-5 km"&&(e=e.filter(r=>r.distanceVal>=3&&r.distanceVal<=5))}this.selectedSort==="Nearest First"?e.sort((t,i)=>t.distanceVal-i.distanceVal):this.selectedSort==="Price: Low to High"?e.sort((t,i)=>Number(t.price)-Number(i.price)):this.selectedSort==="Price: High to Low"&&e.sort((t,i)=>Number(i.price)-Number(t.price)),this.filteredReels=e})}selectCategory(e){this.selectedCategory=e,this.applyFilters()}selectPrice(e){this.selectedPriceRange=e,this.applyFilters()}selectDistance(e){this.selectedDistance=e,this.applyFilters()}selectSort(e){this.selectedSort=e,this.applyFilters()}openReel(e){console.log("[Search] Opening reel:",e.id),this.navigationService.selectReel(e.id)}openLocationModal(){this.showLocationModal=!0,this.locationSearchQuery=""}closeLocationModal(){this.showLocationModal=!1,this.locationSearchQuery=""}selectLocation(e){this.locationService.updateLocation(e.name,e.lat,e.lng),this.closeLocationModal()}get filteredLocations(){let e=this.locationSearchQuery.toLowerCase().trim();return e?this.locationService.AREAS.filter(t=>t.name.toLowerCase().includes(e)||t.pincode.includes(e)):this.locationService.AREAS}reset(){this.searchQuery="",this.reels=[],this.filteredReels=[],this.isLoading=!1,this.selectedCategory="All",this.selectedPriceRange=this.priceRanges[0],this.selectedDistance=this.distances[0],this.selectedSort="Nearest First"}goBack(){this.router.navigate(["/main-app"])}onThumbLoad(e){this.loadedThumbs.add(e)}ngOnDestroy(){this.admobService.hideBanner()}static \u0275fac=function(t){return new(t||n)(pe(Wi),pe(Gi),pe(gl),pe(io),pe(gt))};static \u0275cmp=_t({type:n,selectors:[["app-search"]],standalone:!0,features:[Tt],decls:25,vars:7,consts:[["noResults",""],["videoThumb",""],[1,"search-container"],[1,"search-header"],[1,"header-top"],[1,"close-glass-btn",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"location-context",3,"click"],["width","16","height","16","viewBox","0 0 24 24","fill","none",1,"location-pin"],["d","M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z","fill","currentColor"],[1,"location-text"],["width","12","height","12","viewBox","0 0 24 24","fill","none",1,"chevron-down"],["d","M6 9l6 6 6-6","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"search-bar"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"search-icon"],["cx","11","cy","11","r","8"],["x1","21","y1","21","x2","16.65","y2","16.65"],["type","text","placeholder","Search dosa, vada pav, biryani...",3,"ngModelChange","ngModel"],["class","modal-overlay",3,"click",4,"ngIf"],["class","filters-compact",4,"ngIf"],[1,"results-grid"],["class","loading-spinner",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","food-card",3,"click",4,"ngFor","ngForOf"],[1,"modal-overlay",3,"click"],[1,"location-modal",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],["width","24","height","24","viewBox","0 0 24 24","fill","none"],["d","M18 6L6 18M6 6l12 12","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"modal-search-box"],["width","20","height","20","viewBox","0 0 24 24","fill","none",1,"search-icon"],["cx","11","cy","11","r","8","stroke","currentColor","stroke-width","2"],["d","M21 21l-4.35-4.35","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["type","text","placeholder","Search for a location...",1,"search-input",3,"ngModelChange","ngModel"],[1,"locations-list"],["class","location-item",3,"click",4,"ngFor","ngForOf"],["class","no-results",4,"ngIf"],[1,"location-item",3,"click"],[1,"location-icon"],["width","20","height","20","viewBox","0 0 24 24","fill","none"],[1,"location-info"],[1,"location-name"],[1,"location-area"],["width","20","height","20","viewBox","0 0 24 24","fill","none",1,"chevron-right"],["d","M9 18l6-6-6-6","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"no-results"],["width","48","height","48","viewBox","0 0 24 24","fill","none"],[1,"filters-compact"],[1,"filter-row"],["class","chip",3,"active","click",4,"ngFor","ngForOf"],[1,"vertical-divider"],[1,"chip",3,"click"],["class","check",4,"ngIf"],[1,"check"],[1,"loading-spinner"],[1,"spinner"],[1,"empty-state"],[4,"ngIf","ngIfElse"],[1,"food-card",3,"click"],[1,"card-image"],["muted","","playsinline","","preload","metadata",3,"loadeddata","loadedmetadata","src"],[1,"distance-badge"],[1,"card-details"],[1,"header-row"],[1,"dish-name"],[1,"vendor-name"],[1,"price-row"],[1,"price"]],template:function(t,i){t&1&&(N(0,"div",2)(1,"div",3)(2,"div",4)(3,"button",5),he("click",function(){return i.goBack()}),Re(),N(4,"svg",6),ae(5,"line",7)(6,"line",8),$()(),Be(),N(7,"div",9),he("click",function(){return i.openLocationModal()}),Re(),N(8,"svg",10),ae(9,"path",11),$(),Be(),N(10,"span",12),ee(11),$(),Re(),N(12,"svg",13),ae(13,"path",14),$()()(),Be(),N(14,"div",15),Re(),N(15,"svg",16),ae(16,"circle",17)(17,"line",18),$(),Be(),N(18,"input",19),ii("ngModelChange",function(s){return di(i.searchQuery,s)||(i.searchQuery=s),s}),he("ngModelChange",function(){return i.applyFilters()}),$()()(),Ve(19,Hie,16,3,"div",20)(20,Qie,7,3,"div",21),N(21,"div",22),Ve(22,Zie,2,0,"div",23)(23,ere,4,2,"div",24)(24,tre,15,7,"div",25),$()()),t&2&&(W(11),ut(i.locationName),W(7),ni("ngModel",i.searchQuery),W(),ce("ngIf",i.showLocationModal),W(),ce("ngIf",i.hasSearchMatches),W(2),ce("ngIf",i.isLoading),W(),ce("ngIf",!i.isLoading&&i.filteredReels.length===0),W(),ce("ngForOf",i.filteredReels))},dependencies:[Pt,Hn,qt,ji,$i,Fr,pr],styles:['[_nghost-%COMP%]{display:block;height:100%;width:100%;overflow:hidden}.search-container[_ngcontent-%COMP%]{height:100%;overflow-y:auto;background:#f8f8f8;padding-bottom:100px;color:#1c1c1e;-webkit-overflow-scrolling:touch}.search-header[_ngcontent-%COMP%]{padding:12px 16px;background:#fff;position:sticky;top:0;z-index:20;display:flex;flex-direction:column;gap:12px;border-bottom:1px solid rgba(0,0,0,.05);box-shadow:0 2px 8px #0000000a}.header-top[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.close-glass-btn[_ngcontent-%COMP%]{background:#fff;border:1px solid rgba(0,0,0,.08);width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s cubic-bezier(.2,.8,.2,1);color:#000;box-shadow:0 4px 12px #0000001f}.close-glass-btn[_ngcontent-%COMP%]:active{transform:scale(.92);background:#f5f5f5}.location-context[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:var(--primary-color);font-size:14px;font-weight:600;cursor:pointer;width:fit-content;padding:6px 12px;background:var(--primary-shadow-xs);border-radius:16px}.location-context[_ngcontent-%COMP%]   .location-text[_ngcontent-%COMP%]{color:#1c1c1e}.location-context[_ngcontent-%COMP%]   .chevron-down[_ngcontent-%COMP%]{color:#8e8e93}.search-bar[_ngcontent-%COMP%]{display:flex;align-items:center;background:#f2f2f7;border-radius:20px;padding:12px 16px;border:2px solid transparent;transition:all .3s cubic-bezier(.2,.8,.2,1)}.search-bar[_ngcontent-%COMP%]:focus-within{background:#fff;border-color:var(--primary-color);box-shadow:0 4px 20px var(--primary-shadow-sm)}.search-bar[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{color:#8e8e93;margin-right:12px}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:transparent;border:none;color:#1c1c1e;font-size:16px;width:100%;outline:none;font-weight:500}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#aeaeae}.filters-compact[_ngcontent-%COMP%]{padding:12px 20px;display:flex;flex-direction:column;gap:12px;background:#fff;position:sticky;top:100px;z-index:19;border-bottom:1px solid rgba(0,0,0,.05)}.filter-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;overflow-x:auto;white-space:nowrap;scrollbar-width:none;padding-bottom:4px}.filter-row[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.vertical-divider[_ngcontent-%COMP%]{width:1px;height:24px;background:#0000001a;margin:0 6px;flex-shrink:0}.chip[_ngcontent-%COMP%]{background:#f2f2f7;color:#1c1c1e;border:1px solid rgba(0,0,0,.05);padding:8px 18px;border-radius:20px;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:6px}.chip[_ngcontent-%COMP%]:hover{background:#e5e5ea}.chip.active[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;border-color:var(--primary-color);box-shadow:0 2px 8px var(--primary-shadow)}.results-grid[_ngcontent-%COMP%]{padding:20px;display:grid;grid-template-columns:repeat(2,1fr);gap:16px}.food-card[_ngcontent-%COMP%]{position:relative;border-radius:20px;overflow:hidden;cursor:pointer;aspect-ratio:3/4;background:#fff;box-shadow:0 4px 12px #00000014;transition:transform .2s}.food-card[_ngcontent-%COMP%]:active{transform:scale(.96)}.food-card[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;background:#121212}.food-card[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block;transition:opacity .4s ease;z-index:2}.food-card[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]   .distance-badge[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:#fffffff2;padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;color:#1c1c1e;z-index:3;pointer-events:none;box-shadow:0 2px 8px #0000001a}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;width:100%;padding:50px 14px 14px;background:linear-gradient(to top,rgba(0,0,0,.8) 0%,rgba(0,0,0,.4) 50%,transparent 100%);z-index:3;display:flex;flex-direction:column;gap:4px}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .dish-name[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:#fff;margin:0;line-height:1.2;text-shadow:0 2px 8px rgba(0,0,0,.5);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .vendor-name[_ngcontent-%COMP%]{font-size:12px;color:#ffffffe6;font-weight:500;margin-bottom:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .price-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .price-row[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-size:13px;font-weight:700;color:#fff;background:var(--primary-color);padding:4px 12px;border-radius:12px;box-shadow:0 2px 8px var(--primary-shadow)}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0006;backdrop-filter:blur(8px);z-index:1000;display:flex;align-items:flex-end}.location-modal[_ngcontent-%COMP%]{background:#fff;width:100%;max-height:85vh;border-radius:32px 32px 0 0;display:flex;flex-direction:column;box-shadow:0 -10px 40px #0000001a}.location-modal[_ngcontent-%COMP%]:before{content:"";width:40px;height:5px;background:#e5e5ea;border-radius:10px;margin:12px auto 0}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:24px;border-bottom:1px solid #f2f2f7}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:700;margin:0}.modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:#f2f2f7;border:none;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer}.modal-search-box[_ngcontent-%COMP%]{padding:20px;position:relative}.modal-search-box[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{position:absolute;left:35px;top:50%;transform:translateY(-50%);color:#8e8e93}.modal-search-box[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{width:100%;padding:14px 14px 14px 44px;background:#f2f2f7;border:none;border-radius:14px;font-size:16px}.locations-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:0 16px 32px}.location-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:14px;border-bottom:1px solid #f2f2f7;cursor:pointer}.location-item[_ngcontent-%COMP%]   .location-icon[_ngcontent-%COMP%]{width:40px;height:40px;background:#f2f2f7;border-radius:12px;display:flex;align-items:center;justify-content:center;color:var(--primary-color)}.location-item[_ngcontent-%COMP%]   .location-info[_ngcontent-%COMP%]{flex:1}.location-item[_ngcontent-%COMP%]   .location-info[_ngcontent-%COMP%]   .location-name[_ngcontent-%COMP%]{font-weight:600;font-size:16px}.location-item[_ngcontent-%COMP%]   .location-info[_ngcontent-%COMP%]   .location-area[_ngcontent-%COMP%]{font-size:12px;color:#8e8e93}.loading-spinner[_ngcontent-%COMP%]{grid-column:1/-1;display:flex;justify-content:center;padding:40px}.spinner[_ngcontent-%COMP%]{width:30px;height:30px;border:3px solid #e5e5ea;border-top-color:var(--primary-color);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.empty-state[_ngcontent-%COMP%]{grid-column:1/-1;text-align:center;padding:60px 20px;color:#8e8e93}']})};function nre(n,e){n&1&&(N(0,"div",7),ae(1,"div",8),$())}function ire(n,e){if(n&1&&(N(0,"div",12)(1,"div",13),ee(2),$(),N(3,"div",14)(4,"div",15),ae(5,"video",16),$(),N(6,"div",17)(7,"h3"),ee(8),$(),N(9,"p",18),ee(10),$(),N(11,"div",19)(12,"span"),ee(13),$(),N(14,"span"),ee(15),$()()()()()),n&2){let t=e.$implicit,i=e.index;W(2),Mt("#",i+1,""),W(3),ce("src",t.videoUrl,Jr),W(3),ut(t.title),W(2),ut(t.vendor),W(3),Mt("\u{1F441}\uFE0F ",t.viewCount||0,""),W(2),Mt("\u2764\uFE0F ",t.likes||0,"")}}function rre(n,e){n&1&&(N(0,"div",20)(1,"p"),ee(2,"No trending reels yet!"),$()())}function sre(n,e){if(n&1&&(N(0,"div",9),Ve(1,ire,16,6,"div",10)(2,rre,3,0,"div",11),$()),n&2){let t=ve();W(),ce("ngForOf",t.trendingReels),W(),ce("ngIf",!t.isLoading&&t.trendingReels.length===0)}}function ore(n,e){if(n&1&&(N(0,"div",12)(1,"div",21),ee(2,"\u{1F195}"),$(),N(3,"div",14)(4,"div",15),ae(5,"video",16),$(),N(6,"div",17)(7,"h3"),ee(8),$(),N(9,"p",18),ee(10),$(),N(11,"div",19)(12,"span"),ee(13),Xh(14,"date"),$()()()()()),n&2){let t=e.$implicit;W(5),ce("src",t.videoUrl,Jr),W(3),ut(t.title),W(2),ut(t.vendor),W(3),Mt("\u{1F4C5} ",Jh(14,4,t.createdAt==null?null:t.createdAt.toDate(),"shortDate"),"")}}function are(n,e){n&1&&(N(0,"div",20)(1,"p"),ee(2,"No new arrivals yet!"),$()())}function lre(n,e){if(n&1&&(N(0,"div",9),Ve(1,ore,15,7,"div",10)(2,are,3,0,"div",11),$()),n&2){let t=ve();W(),ce("ngForOf",t.newArrivalsReels),W(),ce("ngIf",!t.isLoading&&t.newArrivalsReels.length===0)}}var sh=class n{constructor(e){this.reelsService=e}trendingReels=[];newArrivalsReels=[];activeTab="trending";isLoading=!0;touchStartX=0;touchEndX=0;ngOnInit(){return U(this,null,function*(){yield this.loadTrending()})}loadTrending(){return U(this,null,function*(){this.isLoading=!0;try{let e=yield this.reelsService.getReels(50);this.trendingReels=[...e].sort((t,i)=>(i.viewCount||0)-(t.viewCount||0)).slice(0,10),this.newArrivalsReels=[...e].sort((t,i)=>{let r=t.createdAt?.toDate?t.createdAt.toDate().getTime():0;return(i.createdAt?.toDate?i.createdAt.toDate().getTime():0)-r}).slice(0,10)}catch(e){console.error("Error loading trending:",e)}finally{this.isLoading=!1}})}switchTab(e){this.activeTab=e,window.scrollTo({top:0,behavior:"smooth"})}onTouchStart(e){this.touchStartX=e.changedTouches[0].screenX}onTouchEnd(e){this.touchEndX=e.changedTouches[0].screenX,this.handleSwipe()}handleSwipe(){this.touchStartX-this.touchEndX>50&&this.activeTab==="trending"&&this.switchTab("new"),this.touchEndX-this.touchStartX>50&&this.activeTab==="new"&&this.switchTab("trending")}static \u0275fac=function(t){return new(t||n)(pe(Wi))};static \u0275cmp=_t({type:n,selectors:[["app-trending"]],standalone:!0,features:[Tt],decls:13,vars:9,consts:[[1,"trending-page"],[1,"tabs-header"],[1,"tab",3,"click"],[1,"slider"],[1,"content-container",3,"touchstart","touchend"],["class","loading-spinner",4,"ngIf"],["class","reels-list",4,"ngIf"],[1,"loading-spinner"],[1,"spinner"],[1,"reels-list"],["class","ranking-item",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[1,"ranking-item"],[1,"rank"],[1,"reel-card"],[1,"thumbnail"],["muted","","loop","","playsinline","",3,"src"],[1,"info"],[1,"vendor"],[1,"stats"],[1,"empty-state"],[1,"rank","new"]],template:function(t,i){t&1&&(N(0,"div",0)(1,"div",1)(2,"div",2),he("click",function(){return i.switchTab("trending")}),N(3,"span"),ee(4,"Trending \u{1F525}"),$()(),N(5,"div",2),he("click",function(){return i.switchTab("new")}),N(6,"span"),ee(7,"New Arrivals \u2728"),$()(),ae(8,"div",3),$(),N(9,"div",4),he("touchstart",function(s){return i.onTouchStart(s)})("touchend",function(s){return i.onTouchEnd(s)}),Ve(10,nre,2,0,"div",5)(11,sre,3,2,"div",6)(12,lre,3,2,"div",6),$()()),t&2&&(W(2),Qe("active",i.activeTab==="trending"),W(3),Qe("active",i.activeTab==="new"),W(3),Qe("right",i.activeTab==="new"),W(2),ce("ngIf",i.isLoading),W(),ce("ngIf",!i.isLoading&&i.activeTab==="trending"),W(),ce("ngIf",!i.isLoading&&i.activeTab==="new"))},dependencies:[Pt,Hn,qt,Zk],styles:[".trending-page[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;background:var(--bg-color);color:var(--text-main)}.tabs-header[_ngcontent-%COMP%]{display:flex;position:relative;background:#ffffffe6;padding-top:max(12px,env(safe-area-inset-top));border-bottom:1px solid rgba(0,0,0,.05);z-index:10;backdrop-filter:blur(10px)}.tabs-header[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]{flex:1;text-align:center;padding:16px 0;font-weight:600;font-size:15px;color:var(--text-secondary);cursor:pointer;transition:color .3s}.tabs-header[_ngcontent-%COMP%]   .tab.active[_ngcontent-%COMP%]{color:var(--primary-color)}.tabs-header[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;width:50%;height:2px;background:var(--primary-color);transition:transform .3s ease}.tabs-header[_ngcontent-%COMP%]   .slider.right[_ngcontent-%COMP%]{transform:translate(100%)}.content-container[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding-bottom:80px;min-height:0;background:var(--bg-secondary)}.reels-list[_ngcontent-%COMP%]{padding:16px;display:flex;flex-direction:column;gap:16px}.ranking-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;background:var(--bg-color);border-radius:16px;padding:12px;box-shadow:0 2px 8px #0000000a;transition:transform .2s}.ranking-item[_ngcontent-%COMP%]:active{transform:scale(.98)}.ranking-item[_ngcontent-%COMP%]   .rank[_ngcontent-%COMP%]{font-size:24px;font-weight:900;color:var(--primary-color);min-width:40px;text-align:center;font-style:italic}.ranking-item[_ngcontent-%COMP%]   .rank.new[_ngcontent-%COMP%]{font-size:20px}.ranking-item[_ngcontent-%COMP%]   .reel-card[_ngcontent-%COMP%]{flex:1;display:flex;gap:12px}.ranking-item[_ngcontent-%COMP%]   .reel-card[_ngcontent-%COMP%]   .thumbnail[_ngcontent-%COMP%]{width:80px;height:120px;border-radius:12px;overflow:hidden;background:var(--bg-tertiary);position:relative}.ranking-item[_ngcontent-%COMP%]   .reel-card[_ngcontent-%COMP%]   .thumbnail[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.ranking-item[_ngcontent-%COMP%]   .reel-card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:center}.ranking-item[_ngcontent-%COMP%]   .reel-card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 4px;font-size:16px;font-weight:600;color:var(--text-main);line-height:1.3}.ranking-item[_ngcontent-%COMP%]   .reel-card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .vendor[_ngcontent-%COMP%]{margin:0 0 8px;font-size:14px;color:var(--text-secondary)}.ranking-item[_ngcontent-%COMP%]   .reel-card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]{display:flex;gap:12px;font-size:12px;color:var(--text-secondary);font-weight:500}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:40px}.loading-spinner[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:30px;height:30px;border:3px solid var(--bg-tertiary);border-top-color:var(--primary-color);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px;color:var(--text-secondary)}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})};var R$={terms:{title:"Terms and Conditions",lastUpdated:"January 2026",sections:[{title:"1. Acceptance of Terms",content:"By accessing or using Bengaluru Swada, you agree to be bound by these Terms and Conditions. If you do not agree to all of these terms, do not use the application."},{title:"2. Description of Service",content:'Bengaluru Swada is a food discovery platform that allows users to view, upload, and interact with short-form video "reels" showing food items and vendors in Bengaluru. We provide location-aware features to help you find the best tastes nearby.'},{title:"3. User-Generated Content",content:"You are solely responsible for the reels you upload. By uploading content, you grant Bengaluru Swada a non-exclusive, royalty-free, worldwide license to use, display, and distribute your content within the app. Content must not be illegal, offensive, or infringe on third-party rights."},{title:"4. Vendor Information",content:"Prices, locations, and availability of food items shown in reels are provided for reference only. Bengaluru Swada does not guarantee the accuracy of vendor information and is not responsible for transactions between you and any third-party vendor."},{title:"5. Limitation of Liability",content:'Bengaluru Swada is provided "as is" without any warranties. We are not liable for any damages arising from your use of the app or consumption of food items featured on the platform.'}]},privacy:{title:"Privacy Policy",lastUpdated:"January 2026",sections:[{title:"1. Information We Collect",content:"We collect your phone number for authentication via Firebase. We also collect location data (with your permission) to calculate distances to food vendors. When you upload a reel, we store the video and associated metadata."},{title:"2. How We Use Information",content:"Your data is used to personalize your feed, enable social interactions (likes, bookmarks), and improve our local discovery algorithms. We do not sell your personal data to third parties."},{title:"3. Data Storage",content:"Your information is securely stored using Google Firebase and Cloudflare R2. We implement industry-standard security measures to protect your data."},{title:"4. Device Permissions",content:"The app requests access to your Camera and Microphone to record reels, and Location services to show you nearby food options. You can revoke these permissions at any time through your device settings."},{title:"5. Changes to Policy",content:"We may update this Privacy Policy from time to time. We will notify you of any significant changes by posting the new policy within the app."}]},help:{title:"Help & Support",sections:[{title:"How to upload a Reel?",content:'Tap the "+" icon in the top right of your Profile or the "Upload" button on the explore page. Select a video from your gallery, add a title, vendor name, and price to share your discovery!'},{title:"Distance Accuracy",content:`The "km away" feature depends on your device's GPS accuracy and the location data provided by the reel uploader. Ensure location permissions are enabled for the best experience.`},{title:"Reporting Content",content:"If you encounter inappropriate content, please contact our support team. We aim for a community that celebrates the best tastes of Bengaluru respectfully."},{title:"Contact Support",content:"Have questions or feedback? Reach out to us at: support@bengaluru-swada.com"}]}};function cre(n,e){if(n&1&&(N(0,"p",13),ee(1),$()),n&2){let t=ve();W(),Mt("Last updated: ",t.content==null?null:t.content.lastUpdated,"")}}function ure(n,e){if(n&1&&(N(0,"div",14)(1,"h3",15),ee(2),$(),N(3,"p",16),ee(4),$()()),n&2){let t=e.$implicit;W(2),ut(t.title),W(2),ut(t.content)}}var nE=class n{visible=!1;set type(e){this.content=e?R$[e]:null}close=new tt;content=null;static \u0275fac=function(t){return new(t||n)};static \u0275cmp=_t({type:n,selectors:[["app-legal-view"]],inputs:{visible:"visible",type:"type"},outputs:{close:"close"},standalone:!0,features:[Tt],decls:15,vars:5,consts:[[1,"legal-overlay"],[1,"legal-container"],[1,"legal-header"],[1,"legal-title"],[1,"close-btn",3,"click"],["width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2.5"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"legal-content"],["class","last-updated",4,"ngIf"],["class","legal-section",4,"ngFor","ngForOf"],[1,"legal-footer"],[1,"done-btn",3,"click"],[1,"last-updated"],[1,"legal-section"],[1,"section-title"],[1,"section-text"]],template:function(t,i){t&1&&(N(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),ee(4),$(),N(5,"button",4),he("click",function(){return i.close.emit()}),Re(),N(6,"svg",5),ae(7,"line",6)(8,"line",7),$()()(),Be(),N(9,"div",8),Ve(10,cre,2,1,"p",9)(11,ure,5,2,"div",10),$(),N(12,"div",11)(13,"button",12),he("click",function(){return i.close.emit()}),ee(14,"Done"),$()()()()),t&2&&(Qe("visible",i.visible),W(4),ut(i.content==null?null:i.content.title),W(6),ce("ngIf",i.content==null?null:i.content.lastUpdated),W(),ce("ngForOf",i.content==null?null:i.content.sections))},dependencies:[Pt,Hn,qt],styles:[".legal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0006;backdrop-filter:blur(8px);z-index:2000;display:flex;align-items:flex-end;visibility:hidden;opacity:0;transition:all .4s cubic-bezier(.4,0,.2,1)}.legal-overlay.visible[_ngcontent-%COMP%]{visibility:visible;opacity:1}.legal-overlay.visible[_ngcontent-%COMP%]   .legal-container[_ngcontent-%COMP%]{transform:translateY(0)}.legal-container[_ngcontent-%COMP%]{width:100%;height:90vh;background:#fff;border-radius:30px 30px 0 0;display:flex;flex-direction:column;transform:translateY(100%);transition:transform .4s cubic-bezier(.4,0,.2,1);box-shadow:0 -10px 40px #00000026}.legal-header[_ngcontent-%COMP%]{padding:24px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #F2F2F7}.legal-title[_ngcontent-%COMP%]{font-size:20px;font-weight:700;margin:0;color:#1c1c1e}.close-btn[_ngcontent-%COMP%]{background:#f2f2f7;border:none;width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#8e8e93;cursor:pointer}.legal-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:24px}.legal-content[_ngcontent-%COMP%]   .last-updated[_ngcontent-%COMP%]{font-size:13px;color:#8e8e93;margin-bottom:24px;font-weight:500;text-transform:uppercase;letter-spacing:.05em}.legal-section[_ngcontent-%COMP%]{margin-bottom:32px}.legal-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:17px;font-weight:700;color:#1c1c1e;margin:0 0 12px}.legal-section[_ngcontent-%COMP%]   .section-text[_ngcontent-%COMP%]{font-size:15px;line-height:1.6;color:#48484a;margin:0}.legal-footer[_ngcontent-%COMP%]{padding:20px 24px calc(20px + env(safe-area-inset-bottom,0px));border-top:1px solid #F2F2F7}.done-btn[_ngcontent-%COMP%]{width:100%;height:54px;background:#10b981;color:#fff;border:none;border-radius:16px;font-size:17px;font-weight:600;cursor:pointer}.done-btn[_ngcontent-%COMP%]:active{opacity:.8;transform:scale(.98)}"]})};function dre(n,e){n&1&&(N(0,"div",25),ae(1,"app-favorites",26),$()),n&2&&(W(),ce("showHeader",!1))}function hre(n,e){if(n&1){let t=Et();N(0,"div",27)(1,"div",28)(2,"div",29),he("click",function(){xe(t);let r=ve();return Ae(r.activeLegalTab="terms")}),N(3,"div",30),Re(),N(4,"svg",31),ae(5,"path",32)(6,"polyline",33),$()(),Be(),N(7,"span",34),ee(8,"Terms and Conditions"),$(),Re(),N(9,"svg",35),ae(10,"path",36),$()(),Be(),N(11,"div",29),he("click",function(){xe(t);let r=ve();return Ae(r.activeLegalTab="privacy")}),N(12,"div",30),Re(),N(13,"svg",31),ae(14,"path",37),$()(),Be(),N(15,"span",34),ee(16,"Privacy Policy"),$(),Re(),N(17,"svg",35),ae(18,"path",36),$()(),Be(),N(19,"div",29),he("click",function(){xe(t);let r=ve();return Ae(r.activeLegalTab="help")}),N(20,"div",30),Re(),N(21,"svg",31),ae(22,"circle",38)(23,"path",39)(24,"line",40),$()(),Be(),N(25,"span",34),ee(26,"Help & Support"),$(),Re(),N(27,"svg",35),ae(28,"path",36),$()(),Be(),N(29,"div",41),he("click",function(){xe(t);let r=ve();return Ae(r.logout())}),N(30,"div",42),Re(),N(31,"svg",31),ae(32,"path",43)(33,"polyline",44)(34,"line",45),$()(),Be(),N(35,"span",46),ee(36,"Logout"),$(),Re(),N(37,"svg",35),ae(38,"path",36),$()()()()}}var Wc=class n{constructor(e,t,i,r){this.auth=e;this.router=t;this.reelsService=i;this.admobService=r;let s=this.auth.currentUser;if(s){if(this.userEmail=s.email,s.phoneNumber){let o=s.phoneNumber.replace(/\D/g,""),a=o.length===12&&o.startsWith("91")?o.substring(2):o;a.length===10?this.userPhoneNumber=`+91 ${a.substring(0,5)}-${a.substring(5)}`:this.userPhoneNumber=s.phoneNumber}else this.userPhoneNumber=null;s.displayName&&(this.fullName=s.displayName,this.userName=s.displayName.toLowerCase().replace(/\s+/g,"_"))}}favoritesComponent;userEmail=null;userPhoneNumber=null;userName="";fullName="";activeTab="bookmarks";activeLegalTab=null;userReels=[];isLoadingReels=!1;stats={posts:0,followers:"1.2k",following:248};touchstartX=0;touchendX=0;ngOnInit(){this.refresh(),this.admobService.showBanner()}refresh(){return U(this,null,function*(){let e=this.auth.currentUser;if(e&&(this.userEmail=e.email,e.displayName&&(this.fullName=e.displayName,this.userName=e.displayName.toLowerCase().replace(/\s+/g,"_")),e.phoneNumber)){let t=e.phoneNumber.replace(/\D/g,""),i=t.length===12&&t.startsWith("91")?t.substring(2):t;i.length===10?this.userPhoneNumber=`+91 ${i.substring(0,5)}-${i.substring(5)}`:this.userPhoneNumber=e.phoneNumber}yield this.loadUserReels(),this.activeTab==="bookmarks"&&this.reloadFavorites()})}loadUserReels(){return U(this,null,function*(){let e=this.auth.currentUser;if(!e){console.warn("[Profile] No user found for loading reels");return}this.isLoadingReels=!0;try{console.log("[Profile] Loading reels for user:",e.uid),this.userReels=yield this.reelsService.getReelsByUser(e.uid),console.log("[Profile] Loaded user reels:",this.userReels.length)}catch(t){console.error("[Profile] Error loading user reels:",t)}finally{this.isLoadingReels=!1}})}switchTab(e){this.activeTab=e,e==="bookmarks"&&setTimeout(()=>this.reloadFavorites(),100)}goToUpload(){this.router.navigate(["/upload-reel"])}logout(){return U(this,null,function*(){try{yield this.auth.signOut(),this.router.navigate(["/"])}catch(e){console.error("Error signing out:",e)}})}reloadFavorites(){this.favoritesComponent&&this.favoritesComponent.loadBookmarkedReels()}goBack(){this.router.navigate(["/main-app"])}handleTouchStart(e){this.touchstartX=e.changedTouches[0].screenX}handleTouchEnd(e){this.touchendX=e.changedTouches[0].screenX,this.handleSwipeGesture()}handleSwipeGesture(){let t=this.touchendX-this.touchstartX;Math.abs(t)>50&&(t<0?this.activeTab==="bookmarks"&&this.switchTab("settings"):this.activeTab==="settings"&&this.switchTab("bookmarks"))}ngOnDestroy(){this.admobService.hideBanner()}static \u0275fac=function(t){return new(t||n)(pe(jt),pe(gt),pe(Wi),pe(io))};static \u0275cmp=_t({type:n,selectors:[["app-profile"]],viewQuery:function(t,i){if(t&1&&Ui(ro,5),t&2){let r;Si(r=Ci())&&(i.favoritesComponent=r.first)}},standalone:!0,features:[Tt],decls:33,vars:10,consts:[[1,"profile-container"],[1,"profile-header"],[1,"close-glass-btn",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"page-title"],["title","Upload Reel",1,"upload-icon-btn",3,"click"],["width","22","height","22","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"],[1,"profile-content"],[1,"tabs-section",3,"touchstart","touchend"],[1,"tabs-header"],[1,"tab-btn",3,"click"],["width","22","height","22","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"],["cx","12","cy","12","r","3"],["d","M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"],[1,"tab-indicator"],[1,"tab-content"],["class","bookmarks-view",4,"ngIf"],["class","settings-view",4,"ngIf"],[1,"footer-text"],[3,"close","visible","type"],[1,"bookmarks-view"],[3,"showHeader"],[1,"settings-view"],[1,"settings-list"],[1,"settings-item",3,"click"],[1,"settings-icon","green"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"],["points","14 2 14 8 20 8"],[1,"settings-label"],["width","20","height","20","viewBox","0 0 24 24","fill","none",1,"chevron"],["d","M9 18l6-6-6-6","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["d","M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"],["cx","12","cy","12","r","10"],["d","M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"],["x1","12","y1","17","x2","12.01","y2","17"],[1,"settings-item","logout-item",3,"click"],[1,"settings-icon","logout"],["d","M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"],["points","16 17 21 12 16 7"],["x1","21","y1","12","x2","9","y2","12"],[1,"settings-label","logout-label"]],template:function(t,i){t&1&&(N(0,"div",0)(1,"div",1)(2,"button",2),he("click",function(){return i.goBack()}),Re(),N(3,"svg",3),ae(4,"line",4)(5,"line",5),$()(),Be(),N(6,"h1",6),ee(7,"Profile"),$(),N(8,"button",7),he("click",function(){return i.goToUpload()}),Re(),N(9,"svg",8),ae(10,"line",9)(11,"line",10),$()()(),Be(),N(12,"div",11)(13,"div",12),he("touchstart",function(s){return i.handleTouchStart(s)})("touchend",function(s){return i.handleTouchEnd(s)}),N(14,"div",13)(15,"button",14),he("click",function(){return i.switchTab("bookmarks")}),Re(),N(16,"svg",15),ae(17,"path",16),$(),Be(),N(18,"span"),ee(19,"Bookmarked"),$()(),N(20,"button",14),he("click",function(){return i.switchTab("settings")}),Re(),N(21,"svg",15),ae(22,"circle",17)(23,"path",18),$(),Be(),N(24,"span"),ee(25,"Settings"),$()(),ae(26,"div",19),$(),N(27,"div",20),Ve(28,dre,2,1,"div",21)(29,hre,39,0,"div",22),$()(),N(30,"p",23),ee(31,"Bengaluru Swada \u2022 v1.0.6"),$()(),N(32,"app-legal-view",24),he("close",function(){return i.activeLegalTab=null}),$()()),t&2&&(W(15),Qe("active",i.activeTab==="bookmarks"),W(5),Qe("active",i.activeTab==="settings"),W(6),Ii("left",i.activeTab==="bookmarks"?"calc(25% - 30px)":"calc(75% - 30px)"),W(2),ce("ngIf",i.activeTab==="bookmarks"),W(),ce("ngIf",i.activeTab==="settings"),W(3),ce("visible",!!i.activeLegalTab)("type",i.activeLegalTab))},dependencies:[Pt,qt,ro,J0,nE],styles:["[_nghost-%COMP%]{display:block;height:100vh;font-family:-apple-system,BlinkMacSystemFont,SF Pro Display,sans-serif;overflow:hidden}.profile-container[_ngcontent-%COMP%]{height:100%;background:#f8f8f8;display:flex;flex-direction:column;overflow:hidden}.profile-header[_ngcontent-%COMP%]{padding:calc(env(safe-area-inset-top,0px) + 12px) 20px 12px;background:#fff;display:flex;justify-content:space-between;align-items:center;position:relative;border-bottom:1px solid rgba(0,0,0,.05);z-index:10}.profile-header[_ngcontent-%COMP%]   .close-glass-btn[_ngcontent-%COMP%]{background:#fff;border:1px solid rgba(0,0,0,.08);width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s cubic-bezier(.2,.8,.2,1);color:#000;box-shadow:0 4px 12px #0000001f}.profile-header[_ngcontent-%COMP%]   .close-glass-btn[_ngcontent-%COMP%]:active{transform:scale(.92);background:#f5f5f5}.profile-header[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{position:absolute;left:50%;transform:translate(-50%);font-size:1.15rem;font-weight:800;letter-spacing:-.6px;color:#000;margin:0}.profile-header[_ngcontent-%COMP%]   .upload-icon-btn[_ngcontent-%COMP%]{background:#10b981;border:none;color:#fff;width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s cubic-bezier(.2,.8,.2,1);box-shadow:0 4px 12px #10b98140}.profile-header[_ngcontent-%COMP%]   .upload-icon-btn[_ngcontent-%COMP%]:active{transform:scale(.9);background:#059669}.profile-header[_ngcontent-%COMP%]   .upload-icon-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{stroke-width:3px}.profile-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-bottom:100px}.tabs-section[_ngcontent-%COMP%]{background:#fff}.tabs-header[_ngcontent-%COMP%]{display:flex;position:relative;border-bottom:1px solid rgba(0,0,0,.08)}.tabs-header[_ngcontent-%COMP%]   .tab-btn[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;padding:16px 12px;background:none;border:none;color:#9ca3af;cursor:pointer;transition:all .3s ease;position:relative}.tabs-header[_ngcontent-%COMP%]   .tab-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.8rem;font-weight:600}.tabs-header[_ngcontent-%COMP%]   .tab-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:.5;transition:all .3s ease}.tabs-header[_ngcontent-%COMP%]   .tab-btn.active[_ngcontent-%COMP%]{color:#10b981}.tabs-header[_ngcontent-%COMP%]   .tab-btn.active[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:1;stroke:#10b981}.tabs-header[_ngcontent-%COMP%]   .tab-indicator[_ngcontent-%COMP%]{position:absolute;bottom:0;width:60px;height:3px;background:#10b981;border-radius:3px 3px 0 0;transition:left .4s cubic-bezier(.4,0,.2,1)}.tab-content[_ngcontent-%COMP%]{min-height:400px;position:relative}.tab-content[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.settings-view[_ngcontent-%COMP%]{padding:20px}.settings-list[_ngcontent-%COMP%]{background:#fff;border-radius:16px;overflow:hidden;box-shadow:0 2px 8px #0000000a}.settings-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:16px 20px;cursor:pointer;transition:background .2s;border-bottom:1px solid rgba(0,0,0,.05)}.settings-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.settings-item[_ngcontent-%COMP%]:active{background:#f9fafb}.settings-item[_ngcontent-%COMP%]   .settings-icon[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-right:16px;color:#fff}.settings-item[_ngcontent-%COMP%]   .settings-icon.green[_ngcontent-%COMP%]{background:#10b981}.settings-item[_ngcontent-%COMP%]   .settings-label[_ngcontent-%COMP%]{flex:1;font-size:1rem;font-weight:600;color:#1c1c1e}.settings-item[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{color:#9ca3af}.settings-item.logout-item[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.05);margin-top:8px;padding-top:20px}.settings-icon.logout[_ngcontent-%COMP%]{background:#fee2e2!important;color:#ef4444!important}.logout-label[_ngcontent-%COMP%]{color:#ef4444!important}.footer-text[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#9ca3af;font-size:.8rem;font-weight:500;margin:0}"]})};function fre(n,e){if(n&1){let t=Et();N(0,"button",10),he("click",function(){xe(t);let r=ve();return Ae(r.onCancel())}),ee(1),$()}if(n&2){let t=ve();W(),Mt(" ",t.secondText," ")}}var iE=class n{message="By going outside all your changes will be lost.";confirmText="Discard Changes";secondText="Stay Here";showCancel=!0;confirm=new tt;cancel=new tt;onConfirm(){this.confirm.emit()}onCancel(){this.cancel.emit()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=_t({type:n,selectors:[["app-confirmation-modal"]],inputs:{message:"message",confirmText:"confirmText",secondText:"secondText",showCancel:"showCancel"},outputs:{confirm:"confirm",cancel:"cancel"},standalone:!0,features:[Tt],decls:15,vars:4,consts:[[1,"modal-overlay",3,"click"],[1,"modal-container",3,"click"],[1,"modal-icon"],["width","40","height","40","viewBox","0 0 24 24","fill","none"],["d","M12 9V14M12 17.01L12.01 16.998","stroke","#ff6b35","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z","stroke","#ff6b35","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"modal-content"],[1,"modal-actions"],[1,"confirm-btn",3,"click"],["class","cancel-btn",3,"click",4,"ngIf"],[1,"cancel-btn",3,"click"]],template:function(t,i){t&1&&(N(0,"div",0),he("click",function(){return i.onCancel()}),N(1,"div",1),he("click",function(s){return s.stopPropagation()}),N(2,"div",2),Re(),N(3,"svg",3),ae(4,"path",4)(5,"path",5),$()(),Be(),N(6,"div",6)(7,"h3"),ee(8,"Unsaved Changes"),$(),N(9,"p"),ee(10),$()(),N(11,"div",7)(12,"button",8),he("click",function(){return i.onConfirm()}),ee(13),$(),Ve(14,fre,2,1,"button",9),$()()()),t&2&&(ce("@fadeInOut",void 0),W(10),ut(i.message),W(3),Mt(" ",i.confirmText," "),W(),ce("ngIf",i.showCancel))},dependencies:[Pt,qt],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000000d9;backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;z-index:9999;padding:20px;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.modal-container[_ngcontent-%COMP%]{background:#1e1e1ecc;backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,.1);border-radius:28px;padding:32px;width:100%;max-width:380px;text-align:center;box-shadow:0 25px 50px -12px #00000080;animation:_ngcontent-%COMP%_slideUp .3s cubic-bezier(.34,1.56,.64,1)}.modal-icon[_ngcontent-%COMP%]{width:64px;height:64px;background:#ff6b351a;border-radius:20px;display:flex;align-items:center;justify-content:center;margin:0 auto 20px}.modal-content[_ngcontent-%COMP%]{margin-bottom:28px}.modal-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;font-size:20px;font-weight:700;margin:0 0 10px}.modal-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#aaa;font-size:15px;line-height:1.6;margin:0}.modal-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.modal-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:16px;border-radius:16px;font-size:16px;font-weight:600;cursor:pointer;transition:all .2s ease;border:none}.modal-actions[_ngcontent-%COMP%]   .confirm-btn[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;box-shadow:0 4px 12px var(--primary-shadow)}.modal-actions[_ngcontent-%COMP%]   .confirm-btn[_ngcontent-%COMP%]:hover{background:var(--primary-active);transform:translateY(-2px);box-shadow:0 6px 16px #ff3b3066}.modal-actions[_ngcontent-%COMP%]   .confirm-btn[_ngcontent-%COMP%]:active{transform:scale(.98)}.modal-actions[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]{background:#ffffff0d;color:#ddd;border:1px solid rgba(255,255,255,.1)}.modal-actions[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#fff}.modal-actions[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]:active{transform:scale(.98)}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}"]})};function pre(n,e){if(n&1){let t=Et();N(0,"app-confirmation-modal",6),he("confirm",function(){xe(t);let r=ve();return Ae(r.onConfirmLeave())})("cancel",function(){xe(t);let r=ve();return Ae(r.onCancelLeave())}),$()}}var rE=class n{constructor(e,t,i,r){this.router=e;this.locationService=t;this.navigationService=i;this.auth=r;let s=this.router.getCurrentNavigation();if(s?.extras?.state){let o=s.extras.state;if(o.location&&(this.location=`${o.location}, Bangalore`),o.latitude&&o.longitude&&this.locationService.setUserLocation(o.latitude,o.longitude),o.openFeed&&o.reelId){this.activeTab="feed";let a=o.reelId,l=(u=0)=>{setTimeout(()=>{this.videoFeedComponent&&this.videoFeedComponent.reels&&this.videoFeedComponent.reels.length>0?(console.log("[MainApp] Video feed loaded, navigating to reel:",a),this.videoFeedComponent.navigateToReel(a)):u<10?(console.log("[MainApp] Waiting for video feed to load... attempt",u+1),l(u+1)):console.error("[MainApp] Failed to navigate to reel - video feed did not load")},500)};l()}}}location="Koramangala, Bangalore";navigate=new tt;activeTab="feed";showProfileMenu=!1;showConfirmModal=!1;pendingTab=null;favoritesComponent;profileComponent;videoFeedComponent;uploadReelComponent;searchComponent;ngOnInit(){return U(this,null,function*(){if(this.location==="Koramangala, Bangalore")try{let e=yield this.locationService.getUserLocation(),t=this.locationService.findNearestArea(e.latitude,e.longitude);this.location=`${t}, Bangalore`}catch(e){console.error("Error getting location:",e)}this.locationService.currentLocation$.subscribe(e=>{e&&(this.location=`${e.name}, Bangalore`,this.videoFeedComponent&&this.activeTab==="feed"&&this.videoFeedComponent.reloadReelsForNewLocation())}),this.navigationService.activeTab$.subscribe(e=>{e&&this.select(e)}),this.navigationService.selectedReelId$.subscribe(e=>{if(e){console.log("[MainApp] Received reel selection:",e),this.activeTab="feed";let t=(i=0)=>{setTimeout(()=>{this.videoFeedComponent&&this.videoFeedComponent.reels&&this.videoFeedComponent.reels.length>0?(console.log("[MainApp] Navigating to reel:",e),this.videoFeedComponent.navigateToReel(e),this.navigationService.clearSelection()):i<15?(console.log("[MainApp] Waiting for reels... attempt",i+1),t(i+1)):console.error("[MainApp] Failed to navigate - reels not loaded")},400)};t()}})})}select(e){if(this.activeTab===e){e==="feed"&&this.videoFeedComponent&&this.videoFeedComponent.scrollToTopAndRefresh();return}if(this.activeTab==="upload"&&e!=="upload"&&this.uploadReelComponent?.hasChanges()){this.pendingTab=e,this.showConfirmModal=!0;return}this.executeTabChange(e)}executeTabChange(e){this.activeTab==="search"&&e!=="search"&&this.searchComponent&&this.searchComponent.reset(),this.activeTab=e,this.navigate.emit(e),e==="profile"&&this.profileComponent&&this.profileComponent.refresh(),e==="favorites"&&this.favoritesComponent&&this.favoritesComponent.loadBookmarkedReels()}onConfirmLeave(){this.showConfirmModal=!1,this.pendingTab&&(this.uploadReelComponent.resetForm(),this.executeTabChange(this.pendingTab),this.pendingTab=null)}onCancelLeave(){this.showConfirmModal=!1,this.pendingTab=null}goToUpload(){this.select("upload")}logout(){return U(this,null,function*(){try{yield this.auth.signOut(),this.router.navigate(["/"])}catch(e){console.error("Error signing out:",e)}})}toggleProfileMenu(){this.showProfileMenu=!this.showProfileMenu}static \u0275fac=function(t){return new(t||n)(pe(gt),pe(Gi),pe(gl),pe(jt))};static \u0275cmp=_t({type:n,selectors:[["app-main-app"]],viewQuery:function(t,i){if(t&1&&(Ui(ro,5),Ui(Wc,5),Ui(zc,5),Ui(Hc,5),Ui(qc,5)),t&2){let r;Si(r=Ci())&&(i.favoritesComponent=r.first),Si(r=Ci())&&(i.profileComponent=r.first),Si(r=Ci())&&(i.videoFeedComponent=r.first),Si(r=Ci())&&(i.uploadReelComponent=r.first),Si(r=Ci())&&(i.searchComponent=r.first)}},outputs:{navigate:"navigate"},standalone:!0,features:[Tt],decls:11,vars:14,consts:[[1,"main-app"],[1,"nav-left"],[1,"nav-right"],[3,"isActive"],[3,"uploadComplete","canceled"],["message","By going outside all your changes will be lost.","confirmText","Discard Changes","secondText","Stay Here",3,"confirm","cancel",4,"ngIf"],["message","By going outside all your changes will be lost.","confirmText","Discard Changes","secondText","Stay Here",3,"confirm","cancel"]],template:function(t,i){t&1&&(N(0,"div",0)(1,"div"),ae(2,"div",1)(3,"div",2),$(),ae(4,"app-video-feed",3)(5,"app-search")(6,"app-trending")(7,"app-profile")(8,"app-favorites"),N(9,"app-upload-reel",4),he("uploadComplete",function(){return i.select("feed")})("canceled",function(){return i.select("feed")}),$(),Ve(10,pre,1,0,"app-confirmation-modal",5),$()),t&2&&(W(4),Qe("hidden",i.activeTab!=="feed"),ce("isActive",i.activeTab==="feed"),W(),Qe("hidden",i.activeTab!=="search"),W(),Qe("hidden",i.activeTab!=="trending"),W(),Qe("hidden",i.activeTab!=="profile"),W(),Qe("hidden",i.activeTab!=="favorites"),W(),Qe("hidden",i.activeTab!=="upload"),W(),ce("ngIf",i.showConfirmModal))},dependencies:[Pt,qt,zc,ro,Hc,qc,sh,Wc,iE,ji],styles:['.main-app[_ngcontent-%COMP%]{position:fixed;inset:0;height:100vh;height:100dvh;display:flex;flex-direction:column;background:#000;font-family:Poppins,-apple-system,BlinkMacSystemFont,SF Pro Display,sans-serif;overflow:hidden}app-video-feed[_ngcontent-%COMP%], app-search[_ngcontent-%COMP%], app-trending[_ngcontent-%COMP%], app-profile[_ngcontent-%COMP%], app-favorites[_ngcontent-%COMP%], app-upload-reel[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;transition:transform .35s cubic-bezier(.4,0,.2,1),opacity .25s ease-in-out;transform-origin:center;will-change:transform,opacity}app-video-feed.hidden[_ngcontent-%COMP%], app-search.hidden[_ngcontent-%COMP%], app-trending.hidden[_ngcontent-%COMP%], app-profile.hidden[_ngcontent-%COMP%], app-favorites.hidden[_ngcontent-%COMP%], app-upload-reel.hidden[_ngcontent-%COMP%]{pointer-events:none;transform:scale(.95);opacity:0}app-video-feed[_ngcontent-%COMP%]:not(.hidden), app-search[_ngcontent-%COMP%]:not(.hidden), app-trending[_ngcontent-%COMP%]:not(.hidden), app-profile[_ngcontent-%COMP%]:not(.hidden), app-favorites[_ngcontent-%COMP%]:not(.hidden), app-upload-reel[_ngcontent-%COMP%]:not(.hidden){pointer-events:auto;transform:scale(1);opacity:1}.top-nav[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;z-index:10;display:flex;justify-content:space-between;padding:1rem;padding-top:max(1rem,env(safe-area-inset-top));background:linear-gradient(to bottom,rgba(0,0,0,.8) 0%,transparent 100%)}.profile-container-bottom[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center}.bottom-nav[_ngcontent-%COMP%]{position:fixed;bottom:max(20px,env(safe-area-inset-bottom));left:50%;transform:translate(-50%);width:auto;min-width:320px;max-width:90%;display:flex;justify-content:space-evenly;align-items:center;padding:12px 24px;background:#161616a6;backdrop-filter:blur(40px) saturate(160%);-webkit-backdrop-filter:blur(40px) saturate(160%);border-radius:35px;border:1px solid rgba(255,255,255,.12);box-shadow:0 20px 50px #00000080,0 0 0 1px #0003;z-index:100;transition:all .3s cubic-bezier(.4,0,.2,1)}.bottom-nav-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#fff6;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .35s cubic-bezier(.4,0,.2,1);padding:10px;position:relative;border-radius:50%;width:48px;height:48px}.bottom-nav-btn[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]{width:26px;height:26px;transition:all .35s cubic-bezier(.4,0,.2,1);filter:drop-shadow(0 2px 4px rgba(0,0,0,.2))}.bottom-nav-btn.active[_ngcontent-%COMP%]{color:#fff;background:#ffffff26;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);box-shadow:inset 0 1px 1px #fff3,inset 0 -1px 1px #0000001a,0 2px 8px #0000004d}.bottom-nav-btn.active[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]{transform:scale(1.08);filter:drop-shadow(0 2px 4px rgba(0,0,0,.3))}.bottom-nav-btn[_ngcontent-%COMP%]:hover:not(.active){color:#fffc;background:#ffffff0d}.bottom-nav-btn[_ngcontent-%COMP%]:active{transform:scale(.94)}.nav-icon[_ngcontent-%COMP%]{width:24px;height:24px;color:inherit;transition:all .3s}.bottom-nav-btn.active[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]{stroke-width:2.5px}.bottom-nav-btn.active[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]:has(path[d*="M3 9.5"])   path[_ngcontent-%COMP%]{fill:currentColor}.bottom-nav-btn.active[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]:has(path[d*="19 21l-7-5"])   path[_ngcontent-%COMP%]{fill:currentColor}.bottom-nav-btn.active[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]:has(path[d*="M20 21C20"])   path[_ngcontent-%COMP%], .bottom-nav-btn.active[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]:has(path[d*="M20 21C20"])   circle[_ngcontent-%COMP%]{stroke-width:2.5px}@media (min-width: 768px){.location-modal[_ngcontent-%COMP%]{max-width:500px;margin:0 auto;border-radius:24px;max-height:70vh}.modal-overlay[_ngcontent-%COMP%]{align-items:center}}']})};var ta=()=>{let n=ue(jt),e=ue(gt);return Hy(n).pipe(We(t=>t?!0:(e.navigate(["/phone-input"]),!1)))};var m1=()=>{let n=ue(jt),e=ue(gt);return Hy(n).pipe(We(t=>t?(console.log("[NoAuthGuard] User is authenticated, redirecting to main-app"),e.createUrlTree(["/main-app"])):!0))};var M$=[{path:"",component:Kv},{path:"phone-input",component:e_,canActivate:[as,m1]},{path:"otp",component:t_,canActivate:[as,m1]},{path:"location-permission",component:n_,canActivate:[ta,as]},{path:"main-app",component:rE,canActivate:[ta,as]},{path:"video-feed",component:zc,canActivate:[ta,as]},{path:"upload-reel",component:Hc,canActivate:[ta,as]},{path:"search",component:qc,canActivate:[ta,as]},{path:"profile",component:Wc,canActivate:[ta,as]},{path:"trending",component:sh,canActivate:[ta,as]},{path:"favorites",component:ro,canActivate:[ta,as]}];var k$={providers:[lO(M$),uL(),jO(),yN(()=>vN(Pp.firebase)),pF(()=>mF()),TV(()=>SV()),Oc]};var sE=class n{constructor(e){this.admobService=e}static \u0275fac=function(t){return new(t||n)(pe(io))};static \u0275cmp=_t({type:n,selectors:[["app-root"]],standalone:!0,features:[Tt],decls:1,vars:0,template:function(t,i){t&1&&ae(0,"router-outlet")},dependencies:[zb]})};yL(sE,k$).catch(n=>console.error(n));
