var i3=Object.create;var lE=Object.defineProperty,r3=Object.defineProperties,s3=Object.getOwnPropertyDescriptor,o3=Object.getOwnPropertyDescriptors,a3=Object.getOwnPropertyNames,Pm=Object.getOwnPropertySymbols,k1=Object.getPrototypeOf,cE=Object.prototype.hasOwnProperty,L1=Object.prototype.propertyIsEnumerable,l3=Reflect.get;var M1=(n,e,t)=>e in n?lE(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ue=(n,e)=>{for(var t in e||={})cE.call(e,t)&&M1(n,t,e[t]);if(Pm)for(var t of Pm(e))L1.call(e,t)&&M1(n,t,e[t]);return n},Ye=(n,e)=>r3(n,o3(e));var uE=(n,e)=>{var t={};for(var i in n)cE.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&Pm)for(var i of Pm(n))e.indexOf(i)<0&&L1.call(n,i)&&(t[i]=n[i]);return t};var c3=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var u3=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of a3(e))!cE.call(n,r)&&r!==t&&lE(n,r,{get:()=>e[r],enumerable:!(i=s3(e,r))||i.enumerable});return n};var d3=(n,e,t)=>(t=n!=null?i3(k1(n)):{},u3(e||!n||!n.__esModule?lE(t,"default",{value:n,enumerable:!0}):t,n));var ua=(n,e,t)=>l3(k1(n),t,e);var U=(n,e,t)=>new Promise((i,r)=>{var s=l=>{try{a(t.next(l))}catch(u){r(u)}},o=l=>{try{a(t.throw(l))}catch(u){r(u)}},a=l=>l.done?i(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(n,e)).next())});var A$=c3((W_,x$)=>{"use strict";(function(n,e){typeof W_=="object"&&typeof x$<"u"?e(W_):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.leaflet={}))})(W_,function(n){"use strict";var e="1.9.4";function t(c){var h,g,_,I;for(g=1,_=arguments.length;g<_;g++){I=arguments[g];for(h in I)c[h]=I[h]}return c}var i=Object.create||function(){function c(){}return function(h){return c.prototype=h,new c}}();function r(c,h){var g=Array.prototype.slice;if(c.bind)return c.bind.apply(c,g.call(arguments,1));var _=g.call(arguments,2);return function(){return c.apply(h,_.length?_.concat(g.call(arguments)):arguments)}}var s=0;function o(c){return"_leaflet_id"in c||(c._leaflet_id=++s),c._leaflet_id}function a(c,h,g){var _,I,k,z;return z=function(){_=!1,I&&(k.apply(g,I),I=!1)},k=function(){_?I=arguments:(c.apply(g,arguments),setTimeout(z,h),_=!0)},k}function l(c,h,g){var _=h[1],I=h[0],k=_-I;return c===_&&g?c:((c-I)%k+k)%k+I}function u(){return!1}function d(c,h){if(h===!1)return c;var g=Math.pow(10,h===void 0?6:h);return Math.round(c*g)/g}function f(c){return c.trim?c.trim():c.replace(/^\s+|\s+$/g,"")}function m(c){return f(c).split(/\s+/)}function y(c,h){Object.prototype.hasOwnProperty.call(c,"options")||(c.options=c.options?i(c.options):{});for(var g in h)c.options[g]=h[g];return c.options}function v(c,h,g){var _=[];for(var I in c)_.push(encodeURIComponent(g?I.toUpperCase():I)+"="+encodeURIComponent(c[I]));return(!h||h.indexOf("?")===-1?"?":"&")+_.join("&")}var E=/\{ *([\w_ -]+) *\}/g;function T(c,h){return c.replace(E,function(g,_){var I=h[_];if(I===void 0)throw new Error("No value provided for variable "+g);return typeof I=="function"&&(I=I(h)),I})}var C=Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"};function D(c,h){for(var g=0;g<c.length;g++)if(c[g]===h)return g;return-1}var P="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function V(c){return window["webkit"+c]||window["moz"+c]||window["ms"+c]}var G=0;function H(c){var h=+new Date,g=Math.max(0,16-(h-G));return G=h+g,window.setTimeout(c,g)}var A=window.requestAnimationFrame||V("RequestAnimationFrame")||H,x=window.cancelAnimationFrame||V("CancelAnimationFrame")||V("CancelRequestAnimationFrame")||function(c){window.clearTimeout(c)};function R(c,h,g){if(g&&A===H)c.call(h);else return A.call(window,r(c,h))}function M(c){c&&x.call(window,c)}var F={__proto__:null,extend:t,create:i,bind:r,get lastId(){return s},stamp:o,throttle:a,wrapNum:l,falseFn:u,formatNum:d,trim:f,splitWords:m,setOptions:y,getParamString:v,template:T,isArray:C,indexOf:D,emptyImageUrl:P,requestFn:A,cancelFn:x,requestAnimFrame:R,cancelAnimFrame:M};function j(){}j.extend=function(c){var h=function(){y(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},g=h.__super__=this.prototype,_=i(g);_.constructor=h,h.prototype=_;for(var I in this)Object.prototype.hasOwnProperty.call(this,I)&&I!=="prototype"&&I!=="__super__"&&(h[I]=this[I]);return c.statics&&t(h,c.statics),c.includes&&(B(c.includes),t.apply(null,[_].concat(c.includes))),t(_,c),delete _.statics,delete _.includes,_.options&&(_.options=g.options?i(g.options):{},t(_.options,c.options)),_._initHooks=[],_.callInitHooks=function(){if(!this._initHooksCalled){g.callInitHooks&&g.callInitHooks.call(this),this._initHooksCalled=!0;for(var k=0,z=_._initHooks.length;k<z;k++)_._initHooks[k].call(this)}},h},j.include=function(c){var h=this.prototype.options;return t(this.prototype,c),c.options&&(this.prototype.options=h,this.mergeOptions(c.options)),this},j.mergeOptions=function(c){return t(this.prototype.options,c),this},j.addInitHook=function(c){var h=Array.prototype.slice.call(arguments,1),g=typeof c=="function"?c:function(){this[c].apply(this,h)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(g),this};function B(c){if(!(typeof L>"u"||!L||!L.Mixin)){c=C(c)?c:[c];for(var h=0;h<c.length;h++)c[h]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var pe={on:function(c,h,g){if(typeof c=="object")for(var _ in c)this._on(_,c[_],h);else{c=m(c);for(var I=0,k=c.length;I<k;I++)this._on(c[I],h,g)}return this},off:function(c,h,g){if(!arguments.length)delete this._events;else if(typeof c=="object")for(var _ in c)this._off(_,c[_],h);else{c=m(c);for(var I=arguments.length===1,k=0,z=c.length;k<z;k++)I?this._off(c[k]):this._off(c[k],h,g)}return this},_on:function(c,h,g,_){if(typeof h!="function"){console.warn("wrong listener type: "+typeof h);return}if(this._listens(c,h,g)===!1){g===this&&(g=void 0);var I={fn:h,ctx:g};_&&(I.once=!0),this._events=this._events||{},this._events[c]=this._events[c]||[],this._events[c].push(I)}},_off:function(c,h,g){var _,I,k;if(this._events&&(_=this._events[c],!!_)){if(arguments.length===1){if(this._firingCount)for(I=0,k=_.length;I<k;I++)_[I].fn=u;delete this._events[c];return}if(typeof h!="function"){console.warn("wrong listener type: "+typeof h);return}var z=this._listens(c,h,g);if(z!==!1){var Z=_[z];this._firingCount&&(Z.fn=u,this._events[c]=_=_.slice()),_.splice(z,1)}}},fire:function(c,h,g){if(!this.listens(c,g))return this;var _=t({},h,{type:c,target:this,sourceTarget:h&&h.sourceTarget||this});if(this._events){var I=this._events[c];if(I){this._firingCount=this._firingCount+1||1;for(var k=0,z=I.length;k<z;k++){var Z=I[k],J=Z.fn;Z.once&&this.off(c,J,Z.ctx),J.call(Z.ctx||this,_)}this._firingCount--}}return g&&this._propagateEvent(_),this},listens:function(c,h,g,_){typeof c!="string"&&console.warn('"string" type argument expected');var I=h;typeof h!="function"&&(_=!!h,I=void 0,g=void 0);var k=this._events&&this._events[c];if(k&&k.length&&this._listens(c,I,g)!==!1)return!0;if(_){for(var z in this._eventParents)if(this._eventParents[z].listens(c,h,g,_))return!0}return!1},_listens:function(c,h,g){if(!this._events)return!1;var _=this._events[c]||[];if(!h)return!!_.length;g===this&&(g=void 0);for(var I=0,k=_.length;I<k;I++)if(_[I].fn===h&&_[I].ctx===g)return I;return!1},once:function(c,h,g){if(typeof c=="object")for(var _ in c)this._on(_,c[_],h,!0);else{c=m(c);for(var I=0,k=c.length;I<k;I++)this._on(c[I],h,g,!0)}return this},addEventParent:function(c){return this._eventParents=this._eventParents||{},this._eventParents[o(c)]=c,this},removeEventParent:function(c){return this._eventParents&&delete this._eventParents[o(c)],this},_propagateEvent:function(c){for(var h in this._eventParents)this._eventParents[h].fire(c.type,t({layer:c.target,propagatedFrom:c.target},c),!0)}};pe.addEventListener=pe.on,pe.removeEventListener=pe.clearAllEventListeners=pe.off,pe.addOneTimeEventListener=pe.once,pe.fireEvent=pe.fire,pe.hasEventListeners=pe.listens;var Ee=j.extend(pe);function q(c,h,g){this.x=g?Math.round(c):c,this.y=g?Math.round(h):h}var te=Math.trunc||function(c){return c>0?Math.floor(c):Math.ceil(c)};q.prototype={clone:function(){return new q(this.x,this.y)},add:function(c){return this.clone()._add(W(c))},_add:function(c){return this.x+=c.x,this.y+=c.y,this},subtract:function(c){return this.clone()._subtract(W(c))},_subtract:function(c){return this.x-=c.x,this.y-=c.y,this},divideBy:function(c){return this.clone()._divideBy(c)},_divideBy:function(c){return this.x/=c,this.y/=c,this},multiplyBy:function(c){return this.clone()._multiplyBy(c)},_multiplyBy:function(c){return this.x*=c,this.y*=c,this},scaleBy:function(c){return new q(this.x*c.x,this.y*c.y)},unscaleBy:function(c){return new q(this.x/c.x,this.y/c.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=te(this.x),this.y=te(this.y),this},distanceTo:function(c){c=W(c);var h=c.x-this.x,g=c.y-this.y;return Math.sqrt(h*h+g*g)},equals:function(c){return c=W(c),c.x===this.x&&c.y===this.y},contains:function(c){return c=W(c),Math.abs(c.x)<=Math.abs(this.x)&&Math.abs(c.y)<=Math.abs(this.y)},toString:function(){return"Point("+d(this.x)+", "+d(this.y)+")"}};function W(c,h,g){return c instanceof q?c:C(c)?new q(c[0],c[1]):c==null?c:typeof c=="object"&&"x"in c&&"y"in c?new q(c.x,c.y):new q(c,h,g)}function ne(c,h){if(c)for(var g=h?[c,h]:c,_=0,I=g.length;_<I;_++)this.extend(g[_])}ne.prototype={extend:function(c){var h,g;if(!c)return this;if(c instanceof q||typeof c[0]=="number"||"x"in c)h=g=W(c);else if(c=ye(c),h=c.min,g=c.max,!h||!g)return this;return!this.min&&!this.max?(this.min=h.clone(),this.max=g.clone()):(this.min.x=Math.min(h.x,this.min.x),this.max.x=Math.max(g.x,this.max.x),this.min.y=Math.min(h.y,this.min.y),this.max.y=Math.max(g.y,this.max.y)),this},getCenter:function(c){return W((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,c)},getBottomLeft:function(){return W(this.min.x,this.max.y)},getTopRight:function(){return W(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(c){var h,g;return typeof c[0]=="number"||c instanceof q?c=W(c):c=ye(c),c instanceof ne?(h=c.min,g=c.max):h=g=c,h.x>=this.min.x&&g.x<=this.max.x&&h.y>=this.min.y&&g.y<=this.max.y},intersects:function(c){c=ye(c);var h=this.min,g=this.max,_=c.min,I=c.max,k=I.x>=h.x&&_.x<=g.x,z=I.y>=h.y&&_.y<=g.y;return k&&z},overlaps:function(c){c=ye(c);var h=this.min,g=this.max,_=c.min,I=c.max,k=I.x>h.x&&_.x<g.x,z=I.y>h.y&&_.y<g.y;return k&&z},isValid:function(){return!!(this.min&&this.max)},pad:function(c){var h=this.min,g=this.max,_=Math.abs(h.x-g.x)*c,I=Math.abs(h.y-g.y)*c;return ye(W(h.x-_,h.y-I),W(g.x+_,g.y+I))},equals:function(c){return c?(c=ye(c),this.min.equals(c.getTopLeft())&&this.max.equals(c.getBottomRight())):!1}};function ye(c,h){return!c||c instanceof ne?c:new ne(c,h)}function oe(c,h){if(c)for(var g=h?[c,h]:c,_=0,I=g.length;_<I;_++)this.extend(g[_])}oe.prototype={extend:function(c){var h=this._southWest,g=this._northEast,_,I;if(c instanceof de)_=c,I=c;else if(c instanceof oe){if(_=c._southWest,I=c._northEast,!_||!I)return this}else return c?this.extend(he(c)||ie(c)):this;return!h&&!g?(this._southWest=new de(_.lat,_.lng),this._northEast=new de(I.lat,I.lng)):(h.lat=Math.min(_.lat,h.lat),h.lng=Math.min(_.lng,h.lng),g.lat=Math.max(I.lat,g.lat),g.lng=Math.max(I.lng,g.lng)),this},pad:function(c){var h=this._southWest,g=this._northEast,_=Math.abs(h.lat-g.lat)*c,I=Math.abs(h.lng-g.lng)*c;return new oe(new de(h.lat-_,h.lng-I),new de(g.lat+_,g.lng+I))},getCenter:function(){return new de((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new de(this.getNorth(),this.getWest())},getSouthEast:function(){return new de(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(c){typeof c[0]=="number"||c instanceof de||"lat"in c?c=he(c):c=ie(c);var h=this._southWest,g=this._northEast,_,I;return c instanceof oe?(_=c.getSouthWest(),I=c.getNorthEast()):_=I=c,_.lat>=h.lat&&I.lat<=g.lat&&_.lng>=h.lng&&I.lng<=g.lng},intersects:function(c){c=ie(c);var h=this._southWest,g=this._northEast,_=c.getSouthWest(),I=c.getNorthEast(),k=I.lat>=h.lat&&_.lat<=g.lat,z=I.lng>=h.lng&&_.lng<=g.lng;return k&&z},overlaps:function(c){c=ie(c);var h=this._southWest,g=this._northEast,_=c.getSouthWest(),I=c.getNorthEast(),k=I.lat>h.lat&&_.lat<g.lat,z=I.lng>h.lng&&_.lng<g.lng;return k&&z},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(c,h){return c?(c=ie(c),this._southWest.equals(c.getSouthWest(),h)&&this._northEast.equals(c.getNorthEast(),h)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ie(c,h){return c instanceof oe?c:new oe(c,h)}function de(c,h,g){if(isNaN(c)||isNaN(h))throw new Error("Invalid LatLng object: ("+c+", "+h+")");this.lat=+c,this.lng=+h,g!==void 0&&(this.alt=+g)}de.prototype={equals:function(c,h){if(!c)return!1;c=he(c);var g=Math.max(Math.abs(this.lat-c.lat),Math.abs(this.lng-c.lng));return g<=(h===void 0?1e-9:h)},toString:function(c){return"LatLng("+d(this.lat,c)+", "+d(this.lng,c)+")"},distanceTo:function(c){return je.distance(this,he(c))},wrap:function(){return je.wrapLatLng(this)},toBounds:function(c){var h=180*c/40075017,g=h/Math.cos(Math.PI/180*this.lat);return ie([this.lat-h,this.lng-g],[this.lat+h,this.lng+g])},clone:function(){return new de(this.lat,this.lng,this.alt)}};function he(c,h,g){return c instanceof de?c:C(c)&&typeof c[0]!="object"?c.length===3?new de(c[0],c[1],c[2]):c.length===2?new de(c[0],c[1]):null:c==null?c:typeof c=="object"&&"lat"in c?new de(c.lat,"lng"in c?c.lng:c.lon,c.alt):h===void 0?null:new de(c,h,g)}var Ne={latLngToPoint:function(c,h){var g=this.projection.project(c),_=this.scale(h);return this.transformation._transform(g,_)},pointToLatLng:function(c,h){var g=this.scale(h),_=this.transformation.untransform(c,g);return this.projection.unproject(_)},project:function(c){return this.projection.project(c)},unproject:function(c){return this.projection.unproject(c)},scale:function(c){return 256*Math.pow(2,c)},zoom:function(c){return Math.log(c/256)/Math.LN2},getProjectedBounds:function(c){if(this.infinite)return null;var h=this.projection.bounds,g=this.scale(c),_=this.transformation.transform(h.min,g),I=this.transformation.transform(h.max,g);return new ne(_,I)},infinite:!1,wrapLatLng:function(c){var h=this.wrapLng?l(c.lng,this.wrapLng,!0):c.lng,g=this.wrapLat?l(c.lat,this.wrapLat,!0):c.lat,_=c.alt;return new de(g,h,_)},wrapLatLngBounds:function(c){var h=c.getCenter(),g=this.wrapLatLng(h),_=h.lat-g.lat,I=h.lng-g.lng;if(_===0&&I===0)return c;var k=c.getSouthWest(),z=c.getNorthEast(),Z=new de(k.lat-_,k.lng-I),J=new de(z.lat-_,z.lng-I);return new oe(Z,J)}},je=t({},Ne,{wrapLng:[-180,180],R:6371e3,distance:function(c,h){var g=Math.PI/180,_=c.lat*g,I=h.lat*g,k=Math.sin((h.lat-c.lat)*g/2),z=Math.sin((h.lng-c.lng)*g/2),Z=k*k+Math.cos(_)*Math.cos(I)*z*z,J=2*Math.atan2(Math.sqrt(Z),Math.sqrt(1-Z));return this.R*J}}),Je=6378137,Mt={R:Je,MAX_LATITUDE:85.0511287798,project:function(c){var h=Math.PI/180,g=this.MAX_LATITUDE,_=Math.max(Math.min(g,c.lat),-g),I=Math.sin(_*h);return new q(this.R*c.lng*h,this.R*Math.log((1+I)/(1-I))/2)},unproject:function(c){var h=180/Math.PI;return new de((2*Math.atan(Math.exp(c.y/this.R))-Math.PI/2)*h,c.x*h/this.R)},bounds:function(){var c=Je*Math.PI;return new ne([-c,-c],[c,c])}()};function kt(c,h,g,_){if(C(c)){this._a=c[0],this._b=c[1],this._c=c[2],this._d=c[3];return}this._a=c,this._b=h,this._c=g,this._d=_}kt.prototype={transform:function(c,h){return this._transform(c.clone(),h)},_transform:function(c,h){return h=h||1,c.x=h*(this._a*c.x+this._b),c.y=h*(this._c*c.y+this._d),c},untransform:function(c,h){return h=h||1,new q((c.x/h-this._b)/this._a,(c.y/h-this._d)/this._c)}};function Zt(c,h,g,_){return new kt(c,h,g,_)}var bn=t({},je,{code:"EPSG:3857",projection:Mt,transformation:function(){var c=.5/(Math.PI*Mt.R);return Zt(c,.5,-c,.5)}()}),hl=t({},bn,{code:"EPSG:900913"});function as(c){return document.createElementNS("http://www.w3.org/2000/svg",c)}function ls(c,h){var g="",_,I,k,z,Z,J;for(_=0,k=c.length;_<k;_++){for(Z=c[_],I=0,z=Z.length;I<z;I++)J=Z[I],g+=(I?"L":"M")+J.x+" "+J.y;g+=h?Re.svg?"z":"x":""}return g||"M0 0"}var Xo=document.documentElement.style,at="ActiveXObject"in window,_n=at&&!document.addEventListener,Jn="msLaunchUri"in navigator&&!("documentMode"in document),xi=zi("webkit"),ei=zi("android"),Gi=zi("android 2")||zi("android 3"),gr=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),jc=ei&&zi("Google")&&gr<537&&!("AudioNode"in window),yr=!!window.opera,eo=!Jn&&zi("chrome"),vr=zi("gecko")&&!xi&&!yr&&!at,En=!eo&&zi("safari"),Sn=zi("phantom"),cs="OTransition"in Xo,fl=navigator.platform.indexOf("Win")===0,Vr=at&&"transition"in Xo,Zd="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Gi,Jo="MozPerspective"in Xo,Zp=!window.L_DISABLE_3D&&(Vr||Zd||Jo)&&!cs&&!Sn,ea=typeof orientation<"u"||zi("mobile"),Xd=ea&&xi,eE=ea&&Zd,Xp=!window.PointerEvent&&window.MSPointerEvent,Gc=!!(window.PointerEvent||Xp),Jd="ontouchstart"in window||!!window.TouchEvent,Jp=!window.L_NO_TOUCH&&(Jd||Gc),pl=ea&&yr,eh=ea&&vr,th=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,to=function(){var c=!1;try{var h=Object.defineProperty({},"passive",{get:function(){c=!0}});window.addEventListener("testPassiveEventSupport",u,h),window.removeEventListener("testPassiveEventSupport",u,h)}catch{}return c}(),em=function(){return!!document.createElement("canvas").getContext}(),ta=!!(document.createElementNS&&as("svg").createSVGRect),tm=!!ta&&function(){var c=document.createElement("div");return c.innerHTML="<svg/>",(c.firstChild&&c.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),ml=!ta&&function(){try{var c=document.createElement("div");c.innerHTML='<v:shape adj="1"/>';var h=c.firstChild;return h.style.behavior="url(#default#VML)",h&&typeof h.adj=="object"}catch{return!1}}(),nm=navigator.platform.indexOf("Mac")===0,ti=navigator.platform.indexOf("Linux")===0;function zi(c){return navigator.userAgent.toLowerCase().indexOf(c)>=0}var Re={ie:at,ielt9:_n,edge:Jn,webkit:xi,android:ei,android23:Gi,androidStock:jc,opera:yr,chrome:eo,gecko:vr,safari:En,phantom:Sn,opera12:cs,win:fl,ie3d:Vr,webkit3d:Zd,gecko3d:Jo,any3d:Zp,mobile:ea,mobileWebkit:Xd,mobileWebkit3d:eE,msPointer:Xp,pointer:Gc,touch:Jp,touchNative:Jd,mobileOpera:pl,mobileGecko:eh,retina:th,passiveEvents:to,canvas:em,svg:ta,vml:ml,inlineSvg:tm,mac:nm,linux:ti},na=Re.msPointer?"MSPointerDown":"pointerdown",im=Re.msPointer?"MSPointerMove":"pointermove",rm=Re.msPointer?"MSPointerUp":"pointerup",no=Re.msPointer?"MSPointerCancel":"pointercancel",nh={touchstart:na,touchmove:im,touchend:rm,touchcancel:no},sm={touchstart:am,touchmove:ia,touchend:ia,touchcancel:ia},Br={},ih=!1;function rh(c,h,g){return h==="touchstart"&&oh(),sm[h]?(g=sm[h].bind(this,g),c.addEventListener(nh[h],g,!1),g):(console.warn("wrong event specified:",h),u)}function zc(c,h,g){if(!nh[h]){console.warn("wrong event specified:",h);return}c.removeEventListener(nh[h],g,!1)}function us(c){Br[c.pointerId]=c}function om(c){Br[c.pointerId]&&(Br[c.pointerId]=c)}function sh(c){delete Br[c.pointerId]}function oh(){ih||(document.addEventListener(na,us,!0),document.addEventListener(im,om,!0),document.addEventListener(rm,sh,!0),document.addEventListener(no,sh,!0),ih=!0)}function ia(c,h){if(h.pointerType!==(h.MSPOINTER_TYPE_MOUSE||"mouse")){h.touches=[];for(var g in Br)h.touches.push(Br[g]);h.changedTouches=[h],c(h)}}function am(c,h){h.MSPOINTER_TYPE_TOUCH&&h.pointerType===h.MSPOINTER_TYPE_TOUCH&&dn(h),ia(c,h)}function lm(c){var h={},g,_;for(_ in c)g=c[_],h[_]=g&&g.bind?g.bind(c):g;return c=h,h.type="dblclick",h.detail=2,h.isTrusted=!1,h._simulated=!0,h}var tE=200;function Hc(c,h){c.addEventListener("dblclick",h);var g=0,_;function I(k){if(k.detail!==1){_=k.detail;return}if(!(k.pointerType==="mouse"||k.sourceCapabilities&&!k.sourceCapabilities.firesTouchEvents)){var z=mh(k);if(!(z.some(function(J){return J instanceof HTMLLabelElement&&J.attributes.for})&&!z.some(function(J){return J instanceof HTMLInputElement||J instanceof HTMLSelectElement}))){var Z=Date.now();Z-g<=tE?(_++,_===2&&h(lm(k))):_=1,g=Z}}}return c.addEventListener("click",I),{dblclick:h,simDblclick:I}}function cm(c,h){c.removeEventListener("dblclick",h.dblclick),c.removeEventListener("click",h.simDblclick)}var gl=_r(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Ur=_r(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ds=Ur==="webkitTransition"||Ur==="OTransition"?Ur+"End":"transitionend";function qc(c){return typeof c=="string"?document.getElementById(c):c}function yl(c,h){var g=c.style[h]||c.currentStyle&&c.currentStyle[h];if((!g||g==="auto")&&document.defaultView){var _=document.defaultView.getComputedStyle(c,null);g=_?_[h]:null}return g==="auto"?null:g}function Et(c,h,g){var _=document.createElement(c);return _.className=h||"",g&&g.appendChild(_),_}function Xt(c){var h=c.parentNode;h&&h.removeChild(c)}function vl(c){for(;c.firstChild;)c.removeChild(c.firstChild)}function hs(c){var h=c.parentNode;h&&h.lastChild!==c&&h.appendChild(c)}function fs(c){var h=c.parentNode;h&&h.firstChild!==c&&h.insertBefore(c,h.firstChild)}function Wc(c,h){if(c.classList!==void 0)return c.classList.contains(h);var g=_l(c);return g.length>0&&new RegExp("(^|\\s)"+h+"(\\s|$)").test(g)}function Ze(c,h){if(c.classList!==void 0)for(var g=m(h),_=0,I=g.length;_<I;_++)c.classList.add(g[_]);else if(!Wc(c,h)){var k=_l(c);ah(c,(k?k+" ":"")+h)}}function un(c,h){c.classList!==void 0?c.classList.remove(h):ah(c,f((" "+_l(c)+" ").replace(" "+h+" "," ")))}function ah(c,h){c.className.baseVal===void 0?c.className=h:c.className.baseVal=h}function _l(c){return c.correspondingElement&&(c=c.correspondingElement),c.className.baseVal===void 0?c.className:c.className.baseVal}function mi(c,h){"opacity"in c.style?c.style.opacity=h:"filter"in c.style&&nE(c,h)}function nE(c,h){var g=!1,_="DXImageTransform.Microsoft.Alpha";try{g=c.filters.item(_)}catch{if(h===1)return}h=Math.round(h*100),g?(g.Enabled=h!==100,g.Opacity=h):c.style.filter+=" progid:"+_+"(opacity="+h+")"}function _r(c){for(var h=document.documentElement.style,g=0;g<c.length;g++)if(c[g]in h)return c[g];return!1}function ni(c,h,g){var _=h||new q(0,0);c.style[gl]=(Re.ie3d?"translate("+_.x+"px,"+_.y+"px)":"translate3d("+_.x+"px,"+_.y+"px,0)")+(g?" scale("+g+")":"")}function rn(c,h){c._leaflet_pos=h,Re.any3d?ni(c,h):(c.style.left=h.x+"px",c.style.top=h.y+"px")}function Er(c){return c._leaflet_pos||new q(0,0)}var ra,Lt,sa;if("onselectstart"in document)ra=function(){Ke(window,"selectstart",dn)},Lt=function(){Bt(window,"selectstart",dn)};else{var $r=_r(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ra=function(){if($r){var c=document.documentElement.style;sa=c[$r],c[$r]="none"}},Lt=function(){$r&&(document.documentElement.style[$r]=sa,sa=void 0)}}function io(){Ke(window,"dragstart",dn)}function lh(){Bt(window,"dragstart",dn)}var El,ch;function uh(c){for(;c.tabIndex===-1;)c=c.parentNode;c.style&&(Kc(),El=c,ch=c.style.outlineStyle,c.style.outlineStyle="none",Ke(window,"keydown",Kc))}function Kc(){El&&(El.style.outlineStyle=ch,El=void 0,ch=void 0,Bt(window,"keydown",Kc))}function um(c){do c=c.parentNode;while((!c.offsetWidth||!c.offsetHeight)&&c!==document.body);return c}function ro(c){var h=c.getBoundingClientRect();return{x:h.width/c.offsetWidth||1,y:h.height/c.offsetHeight||1,boundingClientRect:h}}var ps={__proto__:null,TRANSFORM:gl,TRANSITION:Ur,TRANSITION_END:ds,get:qc,getStyle:yl,create:Et,remove:Xt,empty:vl,toFront:hs,toBack:fs,hasClass:Wc,addClass:Ze,removeClass:un,setClass:ah,getClass:_l,setOpacity:mi,testProp:_r,setTransform:ni,setPosition:rn,getPosition:Er,get disableTextSelection(){return ra},get enableTextSelection(){return Lt},disableImageDrag:io,enableImageDrag:lh,preventOutline:uh,restoreOutline:Kc,getSizedParentNode:um,getScale:ro};function Ke(c,h,g,_){if(h&&typeof h=="object")for(var I in h)hh(c,I,h[I],g);else{h=m(h);for(var k=0,z=h.length;k<z;k++)hh(c,h[k],g,_)}return this}var Hi="_leaflet_events";function Bt(c,h,g,_){if(arguments.length===1)so(c),delete c[Hi];else if(h&&typeof h=="object")for(var I in h)fh(c,I,h[I],g);else if(h=m(h),arguments.length===2)so(c,function(Z){return D(h,Z)!==-1});else for(var k=0,z=h.length;k<z;k++)fh(c,h[k],g,_);return this}function so(c,h){for(var g in c[Hi]){var _=g.split(/\d/)[0];(!h||h(_))&&fh(c,_,null,null,g)}}var dh={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function hh(c,h,g,_){var I=h+o(g)+(_?"_"+o(_):"");if(c[Hi]&&c[Hi][I])return this;var k=function(Z){return g.call(_||c,Z||window.event)},z=k;!Re.touchNative&&Re.pointer&&h.indexOf("touch")===0?k=rh(c,h,k):Re.touch&&h==="dblclick"?k=Hc(c,k):"addEventListener"in c?h==="touchstart"||h==="touchmove"||h==="wheel"||h==="mousewheel"?c.addEventListener(dh[h]||h,k,Re.passiveEvents?{passive:!1}:!1):h==="mouseenter"||h==="mouseleave"?(k=function(Z){Z=Z||window.event,Il(c,Z)&&z(Z)},c.addEventListener(dh[h],k,!1)):c.addEventListener(h,z,!1):c.attachEvent("on"+h,k),c[Hi]=c[Hi]||{},c[Hi][I]=k}function fh(c,h,g,_,I){I=I||h+o(g)+(_?"_"+o(_):"");var k=c[Hi]&&c[Hi][I];if(!k)return this;!Re.touchNative&&Re.pointer&&h.indexOf("touch")===0?zc(c,h,k):Re.touch&&h==="dblclick"?cm(c,k):"removeEventListener"in c?c.removeEventListener(dh[h]||h,k,!1):c.detachEvent("on"+h,k),c[Hi][I]=null}function ai(c){return c.stopPropagation?c.stopPropagation():c.originalEvent?c.originalEvent._stopped=!0:c.cancelBubble=!0,this}function ph(c){return hh(c,"wheel",ai),this}function Tl(c){return Ke(c,"mousedown touchstart dblclick contextmenu",ai),c._leaflet_disable_click=!0,this}function dn(c){return c.preventDefault?c.preventDefault():c.returnValue=!1,this}function Tr(c){return dn(c),ai(c),this}function mh(c){if(c.composedPath)return c.composedPath();for(var h=[],g=c.target;g;)h.push(g),g=g.parentNode;return h}function oa(c,h){if(!h)return new q(c.clientX,c.clientY);var g=ro(h),_=g.boundingClientRect;return new q((c.clientX-_.left)/g.x-h.clientLeft,(c.clientY-_.top)/g.y-h.clientTop)}var wl=Re.linux&&Re.chrome?window.devicePixelRatio:Re.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function gh(c){return Re.edge?c.wheelDeltaY/2:c.deltaY&&c.deltaMode===0?-c.deltaY/wl:c.deltaY&&c.deltaMode===1?-c.deltaY*20:c.deltaY&&c.deltaMode===2?-c.deltaY*60:c.deltaX||c.deltaZ?0:c.wheelDelta?(c.wheelDeltaY||c.wheelDelta)/2:c.detail&&Math.abs(c.detail)<32765?-c.detail*20:c.detail?c.detail/-32765*60:0}function Il(c,h){var g=h.relatedTarget;if(!g)return!0;try{for(;g&&g!==c;)g=g.parentNode}catch{return!1}return g!==c}var on={__proto__:null,on:Ke,off:Bt,stopPropagation:ai,disableScrollPropagation:ph,disableClickPropagation:Tl,preventDefault:dn,stop:Tr,getPropagationPath:mh,getMousePosition:oa,getWheelDelta:gh,isExternalTarget:Il,addListener:Ke,removeListener:Bt},dm=Ee.extend({run:function(c,h,g,_){this.stop(),this._el=c,this._inProgress=!0,this._duration=g||.25,this._easeOutPower=1/Math.max(_||.5,.2),this._startPos=Er(c),this._offset=h.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=R(this._animate,this),this._step()},_step:function(c){var h=+new Date-this._startTime,g=this._duration*1e3;h<g?this._runFrame(this._easeOut(h/g),c):(this._runFrame(1),this._complete())},_runFrame:function(c,h){var g=this._startPos.add(this._offset.multiplyBy(c));h&&g._round(),rn(this._el,g),this.fire("step")},_complete:function(){M(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(c){return 1-Math.pow(1-c,this._easeOutPower)}}),gt=Ee.extend({options:{crs:bn,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(c,h){h=y(this,h),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(c),this._initLayout(),this._onResize=r(this._onResize,this),this._initEvents(),h.maxBounds&&this.setMaxBounds(h.maxBounds),h.zoom!==void 0&&(this._zoom=this._limitZoom(h.zoom)),h.center&&h.zoom!==void 0&&this.setView(he(h.center),h.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Ur&&Re.any3d&&!Re.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Ke(this._proxy,ds,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(c,h,g){if(h=h===void 0?this._zoom:this._limitZoom(h),c=this._limitCenter(he(c),h,this.options.maxBounds),g=g||{},this._stop(),this._loaded&&!g.reset&&g!==!0){g.animate!==void 0&&(g.zoom=t({animate:g.animate},g.zoom),g.pan=t({animate:g.animate,duration:g.duration},g.pan));var _=this._zoom!==h?this._tryAnimatedZoom&&this._tryAnimatedZoom(c,h,g.zoom):this._tryAnimatedPan(c,g.pan);if(_)return clearTimeout(this._sizeTimer),this}return this._resetView(c,h,g.pan&&g.pan.noMoveStart),this},setZoom:function(c,h){return this._loaded?this.setView(this.getCenter(),c,{zoom:h}):(this._zoom=c,this)},zoomIn:function(c,h){return c=c||(Re.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+c,h)},zoomOut:function(c,h){return c=c||(Re.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-c,h)},setZoomAround:function(c,h,g){var _=this.getZoomScale(h),I=this.getSize().divideBy(2),k=c instanceof q?c:this.latLngToContainerPoint(c),z=k.subtract(I).multiplyBy(1-1/_),Z=this.containerPointToLatLng(I.add(z));return this.setView(Z,h,{zoom:g})},_getBoundsCenterZoom:function(c,h){h=h||{},c=c.getBounds?c.getBounds():ie(c);var g=W(h.paddingTopLeft||h.padding||[0,0]),_=W(h.paddingBottomRight||h.padding||[0,0]),I=this.getBoundsZoom(c,!1,g.add(_));if(I=typeof h.maxZoom=="number"?Math.min(h.maxZoom,I):I,I===1/0)return{center:c.getCenter(),zoom:I};var k=_.subtract(g).divideBy(2),z=this.project(c.getSouthWest(),I),Z=this.project(c.getNorthEast(),I),J=this.unproject(z.add(Z).divideBy(2).add(k),I);return{center:J,zoom:I}},fitBounds:function(c,h){if(c=ie(c),!c.isValid())throw new Error("Bounds are not valid.");var g=this._getBoundsCenterZoom(c,h);return this.setView(g.center,g.zoom,h)},fitWorld:function(c){return this.fitBounds([[-90,-180],[90,180]],c)},panTo:function(c,h){return this.setView(c,this._zoom,{pan:h})},panBy:function(c,h){if(c=W(c).round(),h=h||{},!c.x&&!c.y)return this.fire("moveend");if(h.animate!==!0&&!this.getSize().contains(c))return this._resetView(this.unproject(this.project(this.getCenter()).add(c)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new dm,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),h.noMoveStart||this.fire("movestart"),h.animate!==!1){Ze(this._mapPane,"leaflet-pan-anim");var g=this._getMapPanePos().subtract(c).round();this._panAnim.run(this._mapPane,g,h.duration||.25,h.easeLinearity)}else this._rawPanBy(c),this.fire("move").fire("moveend");return this},flyTo:function(c,h,g){if(g=g||{},g.animate===!1||!Re.any3d)return this.setView(c,h,g);this._stop();var _=this.project(this.getCenter()),I=this.project(c),k=this.getSize(),z=this._zoom;c=he(c),h=h===void 0?z:h;var Z=Math.max(k.x,k.y),J=Z*this.getZoomScale(z,h),ae=I.distanceTo(_)||1,be=1.42,$e=be*be;function ft(Cn){var Dm=Cn?-1:1,J$=Cn?J:Z,e3=J*J-Z*Z+Dm*$e*$e*ae*ae,t3=2*J$*$e*ae,aE=e3/t3,R1=Math.sqrt(aE*aE+1)-aE,n3=R1<1e-9?-18:Math.log(R1);return n3}function yi(Cn){return(Math.exp(Cn)-Math.exp(-Cn))/2}function zn(Cn){return(Math.exp(Cn)+Math.exp(-Cn))/2}function wr(Cn){return yi(Cn)/zn(Cn)}var Di=ft(0);function ou(Cn){return Z*(zn(Di)/zn(Di+be*Cn))}function Y$(Cn){return Z*(zn(Di)*wr(Di+be*Cn)-yi(Di))/$e}function Q$(Cn){return 1-Math.pow(1-Cn,1.5)}var Z$=Date.now(),D1=(ft(1)-Di)/be,X$=g.duration?1e3*g.duration:1e3*D1*.8;function P1(){var Cn=(Date.now()-Z$)/X$,Dm=Q$(Cn)*D1;Cn<=1?(this._flyToFrame=R(P1,this),this._move(this.unproject(_.add(I.subtract(_).multiplyBy(Y$(Dm)/ae)),z),this.getScaleZoom(Z/ou(Dm),z),{flyTo:!0})):this._move(c,h)._moveEnd(!0)}return this._moveStart(!0,g.noMoveStart),P1.call(this),this},flyToBounds:function(c,h){var g=this._getBoundsCenterZoom(c,h);return this.flyTo(g.center,g.zoom,h)},setMaxBounds:function(c){return c=ie(c),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),c.isValid()?(this.options.maxBounds=c,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(c){var h=this.options.minZoom;return this.options.minZoom=c,this._loaded&&h!==c&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(c):this},setMaxZoom:function(c){var h=this.options.maxZoom;return this.options.maxZoom=c,this._loaded&&h!==c&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(c):this},panInsideBounds:function(c,h){this._enforcingBounds=!0;var g=this.getCenter(),_=this._limitCenter(g,this._zoom,ie(c));return g.equals(_)||this.panTo(_,h),this._enforcingBounds=!1,this},panInside:function(c,h){h=h||{};var g=W(h.paddingTopLeft||h.padding||[0,0]),_=W(h.paddingBottomRight||h.padding||[0,0]),I=this.project(this.getCenter()),k=this.project(c),z=this.getPixelBounds(),Z=ye([z.min.add(g),z.max.subtract(_)]),J=Z.getSize();if(!Z.contains(k)){this._enforcingBounds=!0;var ae=k.subtract(Z.getCenter()),be=Z.extend(k).getSize().subtract(J);I.x+=ae.x<0?-be.x:be.x,I.y+=ae.y<0?-be.y:be.y,this.panTo(this.unproject(I),h),this._enforcingBounds=!1}return this},invalidateSize:function(c){if(!this._loaded)return this;c=t({animate:!1,pan:!0},c===!0?{animate:!0}:c);var h=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var g=this.getSize(),_=h.divideBy(2).round(),I=g.divideBy(2).round(),k=_.subtract(I);return!k.x&&!k.y?this:(c.animate&&c.pan?this.panBy(k):(c.pan&&this._rawPanBy(k),this.fire("move"),c.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(r(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:h,newSize:g}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(c){if(c=this._locateOptions=t({timeout:1e4,watch:!1},c),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var h=r(this._handleGeolocationResponse,this),g=r(this._handleGeolocationError,this);return c.watch?this._locationWatchId=navigator.geolocation.watchPosition(h,g,c):navigator.geolocation.getCurrentPosition(h,g,c),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(c){if(this._container._leaflet_id){var h=c.code,g=c.message||(h===1?"permission denied":h===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:h,message:"Geolocation error: "+g+"."})}},_handleGeolocationResponse:function(c){if(this._container._leaflet_id){var h=c.coords.latitude,g=c.coords.longitude,_=new de(h,g),I=_.toBounds(c.coords.accuracy*2),k=this._locateOptions;if(k.setView){var z=this.getBoundsZoom(I);this.setView(_,k.maxZoom?Math.min(z,k.maxZoom):z)}var Z={latlng:_,bounds:I,timestamp:c.timestamp};for(var J in c.coords)typeof c.coords[J]=="number"&&(Z[J]=c.coords[J]);this.fire("locationfound",Z)}},addHandler:function(c,h){if(!h)return this;var g=this[c]=new h(this);return this._handlers.push(g),this.options[c]&&g.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Xt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(M(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var c;for(c in this._layers)this._layers[c].remove();for(c in this._panes)Xt(this._panes[c]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(c,h){var g="leaflet-pane"+(c?" leaflet-"+c.replace("Pane","")+"-pane":""),_=Et("div",g,h||this._mapPane);return c&&(this._panes[c]=_),_},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var c=this.getPixelBounds(),h=this.unproject(c.getBottomLeft()),g=this.unproject(c.getTopRight());return new oe(h,g)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(c,h,g){c=ie(c),g=W(g||[0,0]);var _=this.getZoom()||0,I=this.getMinZoom(),k=this.getMaxZoom(),z=c.getNorthWest(),Z=c.getSouthEast(),J=this.getSize().subtract(g),ae=ye(this.project(Z,_),this.project(z,_)).getSize(),be=Re.any3d?this.options.zoomSnap:1,$e=J.x/ae.x,ft=J.y/ae.y,yi=h?Math.max($e,ft):Math.min($e,ft);return _=this.getScaleZoom(yi,_),be&&(_=Math.round(_/(be/100))*(be/100),_=h?Math.ceil(_/be)*be:Math.floor(_/be)*be),Math.max(I,Math.min(k,_))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new q(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(c,h){var g=this._getTopLeftPoint(c,h);return new ne(g,g.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(c){return this.options.crs.getProjectedBounds(c===void 0?this.getZoom():c)},getPane:function(c){return typeof c=="string"?this._panes[c]:c},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(c,h){var g=this.options.crs;return h=h===void 0?this._zoom:h,g.scale(c)/g.scale(h)},getScaleZoom:function(c,h){var g=this.options.crs;h=h===void 0?this._zoom:h;var _=g.zoom(c*g.scale(h));return isNaN(_)?1/0:_},project:function(c,h){return h=h===void 0?this._zoom:h,this.options.crs.latLngToPoint(he(c),h)},unproject:function(c,h){return h=h===void 0?this._zoom:h,this.options.crs.pointToLatLng(W(c),h)},layerPointToLatLng:function(c){var h=W(c).add(this.getPixelOrigin());return this.unproject(h)},latLngToLayerPoint:function(c){var h=this.project(he(c))._round();return h._subtract(this.getPixelOrigin())},wrapLatLng:function(c){return this.options.crs.wrapLatLng(he(c))},wrapLatLngBounds:function(c){return this.options.crs.wrapLatLngBounds(ie(c))},distance:function(c,h){return this.options.crs.distance(he(c),he(h))},containerPointToLayerPoint:function(c){return W(c).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(c){return W(c).add(this._getMapPanePos())},containerPointToLatLng:function(c){var h=this.containerPointToLayerPoint(W(c));return this.layerPointToLatLng(h)},latLngToContainerPoint:function(c){return this.layerPointToContainerPoint(this.latLngToLayerPoint(he(c)))},mouseEventToContainerPoint:function(c){return oa(c,this._container)},mouseEventToLayerPoint:function(c){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(c))},mouseEventToLatLng:function(c){return this.layerPointToLatLng(this.mouseEventToLayerPoint(c))},_initContainer:function(c){var h=this._container=qc(c);if(h){if(h._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Ke(h,"scroll",this._onScroll,this),this._containerId=o(h)},_initLayout:function(){var c=this._container;this._fadeAnimated=this.options.fadeAnimation&&Re.any3d,Ze(c,"leaflet-container"+(Re.touch?" leaflet-touch":"")+(Re.retina?" leaflet-retina":"")+(Re.ielt9?" leaflet-oldie":"")+(Re.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var h=yl(c,"position");h!=="absolute"&&h!=="relative"&&h!=="fixed"&&h!=="sticky"&&(c.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var c=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),rn(this._mapPane,new q(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Ze(c.markerPane,"leaflet-zoom-hide"),Ze(c.shadowPane,"leaflet-zoom-hide"))},_resetView:function(c,h,g){rn(this._mapPane,new q(0,0));var _=!this._loaded;this._loaded=!0,h=this._limitZoom(h),this.fire("viewprereset");var I=this._zoom!==h;this._moveStart(I,g)._move(c,h)._moveEnd(I),this.fire("viewreset"),_&&this.fire("load")},_moveStart:function(c,h){return c&&this.fire("zoomstart"),h||this.fire("movestart"),this},_move:function(c,h,g,_){h===void 0&&(h=this._zoom);var I=this._zoom!==h;return this._zoom=h,this._lastCenter=c,this._pixelOrigin=this._getNewPixelOrigin(c),_?g&&g.pinch&&this.fire("zoom",g):((I||g&&g.pinch)&&this.fire("zoom",g),this.fire("move",g)),this},_moveEnd:function(c){return c&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return M(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(c){rn(this._mapPane,this._getMapPanePos().subtract(c))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(c){this._targets={},this._targets[o(this._container)]=this;var h=c?Bt:Ke;h(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&h(window,"resize",this._onResize,this),Re.any3d&&this.options.transform3DLimit&&(c?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){M(this._resizeRequest),this._resizeRequest=R(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var c=this._getMapPanePos();Math.max(Math.abs(c.x),Math.abs(c.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(c,h){for(var g=[],_,I=h==="mouseout"||h==="mouseover",k=c.target||c.srcElement,z=!1;k;){if(_=this._targets[o(k)],_&&(h==="click"||h==="preclick")&&this._draggableMoved(_)){z=!0;break}if(_&&_.listens(h,!0)&&(I&&!Il(k,c)||(g.push(_),I))||k===this._container)break;k=k.parentNode}return!g.length&&!z&&!I&&this.listens(h,!0)&&(g=[this]),g},_isClickDisabled:function(c){for(;c&&c!==this._container;){if(c._leaflet_disable_click)return!0;c=c.parentNode}},_handleDOMEvent:function(c){var h=c.target||c.srcElement;if(!(!this._loaded||h._leaflet_disable_events||c.type==="click"&&this._isClickDisabled(h))){var g=c.type;g==="mousedown"&&uh(h),this._fireDOMEvent(c,g)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(c,h,g){if(c.type==="click"){var _=t({},c);_.type="preclick",this._fireDOMEvent(_,_.type,g)}var I=this._findEventTargets(c,h);if(g){for(var k=[],z=0;z<g.length;z++)g[z].listens(h,!0)&&k.push(g[z]);I=k.concat(I)}if(I.length){h==="contextmenu"&&dn(c);var Z=I[0],J={originalEvent:c};if(c.type!=="keypress"&&c.type!=="keydown"&&c.type!=="keyup"){var ae=Z.getLatLng&&(!Z._radius||Z._radius<=10);J.containerPoint=ae?this.latLngToContainerPoint(Z.getLatLng()):this.mouseEventToContainerPoint(c),J.layerPoint=this.containerPointToLayerPoint(J.containerPoint),J.latlng=ae?Z.getLatLng():this.layerPointToLatLng(J.layerPoint)}for(z=0;z<I.length;z++)if(I[z].fire(h,J,!0),J.originalEvent._stopped||I[z].options.bubblingMouseEvents===!1&&D(this._mouseEvents,h)!==-1)return}},_draggableMoved:function(c){return c=c.dragging&&c.dragging.enabled()?c:this,c.dragging&&c.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var c=0,h=this._handlers.length;c<h;c++)this._handlers[c].disable()},whenReady:function(c,h){return this._loaded?c.call(h||this,{target:this}):this.on("load",c,h),this},_getMapPanePos:function(){return Er(this._mapPane)||new q(0,0)},_moved:function(){var c=this._getMapPanePos();return c&&!c.equals([0,0])},_getTopLeftPoint:function(c,h){var g=c&&h!==void 0?this._getNewPixelOrigin(c,h):this.getPixelOrigin();return g.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(c,h){var g=this.getSize()._divideBy(2);return this.project(c,h)._subtract(g)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(c,h,g){var _=this._getNewPixelOrigin(g,h);return this.project(c,h)._subtract(_)},_latLngBoundsToNewLayerBounds:function(c,h,g){var _=this._getNewPixelOrigin(g,h);return ye([this.project(c.getSouthWest(),h)._subtract(_),this.project(c.getNorthWest(),h)._subtract(_),this.project(c.getSouthEast(),h)._subtract(_),this.project(c.getNorthEast(),h)._subtract(_)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(c){return this.latLngToLayerPoint(c).subtract(this._getCenterLayerPoint())},_limitCenter:function(c,h,g){if(!g)return c;var _=this.project(c,h),I=this.getSize().divideBy(2),k=new ne(_.subtract(I),_.add(I)),z=this._getBoundsOffset(k,g,h);return Math.abs(z.x)<=1&&Math.abs(z.y)<=1?c:this.unproject(_.add(z),h)},_limitOffset:function(c,h){if(!h)return c;var g=this.getPixelBounds(),_=new ne(g.min.add(c),g.max.add(c));return c.add(this._getBoundsOffset(_,h))},_getBoundsOffset:function(c,h,g){var _=ye(this.project(h.getNorthEast(),g),this.project(h.getSouthWest(),g)),I=_.min.subtract(c.min),k=_.max.subtract(c.max),z=this._rebound(I.x,-k.x),Z=this._rebound(I.y,-k.y);return new q(z,Z)},_rebound:function(c,h){return c+h>0?Math.round(c-h)/2:Math.max(0,Math.ceil(c))-Math.max(0,Math.floor(h))},_limitZoom:function(c){var h=this.getMinZoom(),g=this.getMaxZoom(),_=Re.any3d?this.options.zoomSnap:1;return _&&(c=Math.round(c/_)*_),Math.max(h,Math.min(g,c))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){un(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(c,h){var g=this._getCenterOffset(c)._trunc();return(h&&h.animate)!==!0&&!this.getSize().contains(g)?!1:(this.panBy(g,h),!0)},_createAnimProxy:function(){var c=this._proxy=Et("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(c),this.on("zoomanim",function(h){var g=gl,_=this._proxy.style[g];ni(this._proxy,this.project(h.center,h.zoom),this.getZoomScale(h.zoom,1)),_===this._proxy.style[g]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Xt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var c=this.getCenter(),h=this.getZoom();ni(this._proxy,this.project(c,h),this.getZoomScale(h,1))},_catchTransitionEnd:function(c){this._animatingZoom&&c.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(c,h,g){if(this._animatingZoom)return!0;if(g=g||{},!this._zoomAnimated||g.animate===!1||this._nothingToAnimate()||Math.abs(h-this._zoom)>this.options.zoomAnimationThreshold)return!1;var _=this.getZoomScale(h),I=this._getCenterOffset(c)._divideBy(1-1/_);return g.animate!==!0&&!this.getSize().contains(I)?!1:(R(function(){this._moveStart(!0,g.noMoveStart||!1)._animateZoom(c,h,!0)},this),!0)},_animateZoom:function(c,h,g,_){this._mapPane&&(g&&(this._animatingZoom=!0,this._animateToCenter=c,this._animateToZoom=h,Ze(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:c,zoom:h,noUpdate:_}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(r(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&un(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function hm(c,h){return new gt(c,h)}var Ai=j.extend({options:{position:"topright"},initialize:function(c){y(this,c)},getPosition:function(){return this.options.position},setPosition:function(c){var h=this._map;return h&&h.removeControl(this),this.options.position=c,h&&h.addControl(this),this},getContainer:function(){return this._container},addTo:function(c){this.remove(),this._map=c;var h=this._container=this.onAdd(c),g=this.getPosition(),_=c._controlCorners[g];return Ze(h,"leaflet-control"),g.indexOf("bottom")!==-1?_.insertBefore(h,_.firstChild):_.appendChild(h),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Xt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(c){this._map&&c&&c.screenX>0&&c.screenY>0&&this._map.getContainer().focus()}}),aa=function(c){return new Ai(c)};gt.include({addControl:function(c){return c.addTo(this),this},removeControl:function(c){return c.remove(),this},_initControlPos:function(){var c=this._controlCorners={},h="leaflet-",g=this._controlContainer=Et("div",h+"control-container",this._container);function _(I,k){var z=h+I+" "+h+k;c[I+k]=Et("div",z,g)}_("top","left"),_("top","right"),_("bottom","left"),_("bottom","right")},_clearControlPos:function(){for(var c in this._controlCorners)Xt(this._controlCorners[c]);Xt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var bl=Ai.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(c,h,g,_){return g<_?-1:_<g?1:0}},initialize:function(c,h,g){y(this,g),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var _ in c)this._addLayer(c[_],_);for(_ in h)this._addLayer(h[_],_,!0)},onAdd:function(c){this._initLayout(),this._update(),this._map=c,c.on("zoomend",this._checkDisabledLayers,this);for(var h=0;h<this._layers.length;h++)this._layers[h].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(c){return Ai.prototype.addTo.call(this,c),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var c=0;c<this._layers.length;c++)this._layers[c].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(c,h){return this._addLayer(c,h),this._map?this._update():this},addOverlay:function(c,h){return this._addLayer(c,h,!0),this._map?this._update():this},removeLayer:function(c){c.off("add remove",this._onLayerChange,this);var h=this._getLayer(o(c));return h&&this._layers.splice(this._layers.indexOf(h),1),this._map?this._update():this},expand:function(){Ze(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var c=this._map.getSize().y-(this._container.offsetTop+50);return c<this._section.clientHeight?(Ze(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=c+"px"):un(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return un(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var c="leaflet-control-layers",h=this._container=Et("div",c),g=this.options.collapsed;h.setAttribute("aria-haspopup",!0),Tl(h),ph(h);var _=this._section=Et("section",c+"-list");g&&(this._map.on("click",this.collapse,this),Ke(h,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var I=this._layersLink=Et("a",c+"-toggle",h);I.href="#",I.title="Layers",I.setAttribute("role","button"),Ke(I,{keydown:function(k){k.keyCode===13&&this._expandSafely()},click:function(k){dn(k),this._expandSafely()}},this),g||this.expand(),this._baseLayersList=Et("div",c+"-base",_),this._separator=Et("div",c+"-separator",_),this._overlaysList=Et("div",c+"-overlays",_),h.appendChild(_)},_getLayer:function(c){for(var h=0;h<this._layers.length;h++)if(this._layers[h]&&o(this._layers[h].layer)===c)return this._layers[h]},_addLayer:function(c,h,g){this._map&&c.on("add remove",this._onLayerChange,this),this._layers.push({layer:c,name:h,overlay:g}),this.options.sortLayers&&this._layers.sort(r(function(_,I){return this.options.sortFunction(_.layer,I.layer,_.name,I.name)},this)),this.options.autoZIndex&&c.setZIndex&&(this._lastZIndex++,c.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;vl(this._baseLayersList),vl(this._overlaysList),this._layerControlInputs=[];var c,h,g,_,I=0;for(g=0;g<this._layers.length;g++)_=this._layers[g],this._addItem(_),h=h||_.overlay,c=c||!_.overlay,I+=_.overlay?0:1;return this.options.hideSingleBase&&(c=c&&I>1,this._baseLayersList.style.display=c?"":"none"),this._separator.style.display=h&&c?"":"none",this},_onLayerChange:function(c){this._handlingClick||this._update();var h=this._getLayer(o(c.target)),g=h.overlay?c.type==="add"?"overlayadd":"overlayremove":c.type==="add"?"baselayerchange":null;g&&this._map.fire(g,h)},_createRadioElement:function(c,h){var g='<input type="radio" class="leaflet-control-layers-selector" name="'+c+'"'+(h?' checked="checked"':"")+"/>",_=document.createElement("div");return _.innerHTML=g,_.firstChild},_addItem:function(c){var h=document.createElement("label"),g=this._map.hasLayer(c.layer),_;c.overlay?(_=document.createElement("input"),_.type="checkbox",_.className="leaflet-control-layers-selector",_.defaultChecked=g):_=this._createRadioElement("leaflet-base-layers_"+o(this),g),this._layerControlInputs.push(_),_.layerId=o(c.layer),Ke(_,"click",this._onInputClick,this);var I=document.createElement("span");I.innerHTML=" "+c.name;var k=document.createElement("span");h.appendChild(k),k.appendChild(_),k.appendChild(I);var z=c.overlay?this._overlaysList:this._baseLayersList;return z.appendChild(h),this._checkDisabledLayers(),h},_onInputClick:function(){if(!this._preventClick){var c=this._layerControlInputs,h,g,_=[],I=[];this._handlingClick=!0;for(var k=c.length-1;k>=0;k--)h=c[k],g=this._getLayer(h.layerId).layer,h.checked?_.push(g):h.checked||I.push(g);for(k=0;k<I.length;k++)this._map.hasLayer(I[k])&&this._map.removeLayer(I[k]);for(k=0;k<_.length;k++)this._map.hasLayer(_[k])||this._map.addLayer(_[k]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var c=this._layerControlInputs,h,g,_=this._map.getZoom(),I=c.length-1;I>=0;I--)h=c[I],g=this._getLayer(h.layerId).layer,h.disabled=g.options.minZoom!==void 0&&_<g.options.minZoom||g.options.maxZoom!==void 0&&_>g.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var c=this._section;this._preventClick=!0,Ke(c,"click",dn),this.expand();var h=this;setTimeout(function(){Bt(c,"click",dn),h._preventClick=!1})}}),fm=function(c,h,g){return new bl(c,h,g)},qi=Ai.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(c){var h="leaflet-control-zoom",g=Et("div",h+" leaflet-bar"),_=this.options;return this._zoomInButton=this._createButton(_.zoomInText,_.zoomInTitle,h+"-in",g,this._zoomIn),this._zoomOutButton=this._createButton(_.zoomOutText,_.zoomOutTitle,h+"-out",g,this._zoomOut),this._updateDisabled(),c.on("zoomend zoomlevelschange",this._updateDisabled,this),g},onRemove:function(c){c.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(c){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(c.shiftKey?3:1))},_zoomOut:function(c){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(c.shiftKey?3:1))},_createButton:function(c,h,g,_,I){var k=Et("a",g,_);return k.innerHTML=c,k.href="#",k.title=h,k.setAttribute("role","button"),k.setAttribute("aria-label",h),Tl(k),Ke(k,"click",Tr),Ke(k,"click",I,this),Ke(k,"click",this._refocusOnMap,this),k},_updateDisabled:function(){var c=this._map,h="leaflet-disabled";un(this._zoomInButton,h),un(this._zoomOutButton,h),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||c._zoom===c.getMinZoom())&&(Ze(this._zoomOutButton,h),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||c._zoom===c.getMaxZoom())&&(Ze(this._zoomInButton,h),this._zoomInButton.setAttribute("aria-disabled","true"))}});gt.mergeOptions({zoomControl:!0}),gt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new qi,this.addControl(this.zoomControl))});var pm=function(c){return new qi(c)},mm=Ai.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(c){var h="leaflet-control-scale",g=Et("div",h),_=this.options;return this._addScales(_,h+"-line",g),c.on(_.updateWhenIdle?"moveend":"move",this._update,this),c.whenReady(this._update,this),g},onRemove:function(c){c.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(c,h,g){c.metric&&(this._mScale=Et("div",h,g)),c.imperial&&(this._iScale=Et("div",h,g))},_update:function(){var c=this._map,h=c.getSize().y/2,g=c.distance(c.containerPointToLatLng([0,h]),c.containerPointToLatLng([this.options.maxWidth,h]));this._updateScales(g)},_updateScales:function(c){this.options.metric&&c&&this._updateMetric(c),this.options.imperial&&c&&this._updateImperial(c)},_updateMetric:function(c){var h=this._getRoundNum(c),g=h<1e3?h+" m":h/1e3+" km";this._updateScale(this._mScale,g,h/c)},_updateImperial:function(c){var h=c*3.2808399,g,_,I;h>5280?(g=h/5280,_=this._getRoundNum(g),this._updateScale(this._iScale,_+" mi",_/g)):(I=this._getRoundNum(h),this._updateScale(this._iScale,I+" ft",I/h))},_updateScale:function(c,h,g){c.style.width=Math.round(this.options.maxWidth*g)+"px",c.innerHTML=h},_getRoundNum:function(c){var h=Math.pow(10,(Math.floor(c)+"").length-1),g=c/h;return g=g>=10?10:g>=5?5:g>=3?3:g>=2?2:1,h*g}}),Sl=function(c){return new mm(c)},gm='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Cl=Ai.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Re.inlineSvg?gm+" ":"")+"Leaflet</a>"},initialize:function(c){y(this,c),this._attributions={}},onAdd:function(c){c.attributionControl=this,this._container=Et("div","leaflet-control-attribution"),Tl(this._container);for(var h in c._layers)c._layers[h].getAttribution&&this.addAttribution(c._layers[h].getAttribution());return this._update(),c.on("layeradd",this._addAttribution,this),this._container},onRemove:function(c){c.off("layeradd",this._addAttribution,this)},_addAttribution:function(c){c.layer.getAttribution&&(this.addAttribution(c.layer.getAttribution()),c.layer.once("remove",function(){this.removeAttribution(c.layer.getAttribution())},this))},setPrefix:function(c){return this.options.prefix=c,this._update(),this},addAttribution:function(c){return c?(this._attributions[c]||(this._attributions[c]=0),this._attributions[c]++,this._update(),this):this},removeAttribution:function(c){return c?(this._attributions[c]&&(this._attributions[c]--,this._update()),this):this},_update:function(){if(this._map){var c=[];for(var h in this._attributions)this._attributions[h]&&c.push(h);var g=[];this.options.prefix&&g.push(this.options.prefix),c.length&&g.push(c.join(", ")),this._container.innerHTML=g.join(' <span aria-hidden="true">|</span> ')}}});gt.mergeOptions({attributionControl:!0}),gt.addInitHook(function(){this.options.attributionControl&&new Cl().addTo(this)});var Yc=function(c){return new Cl(c)};Ai.Layers=bl,Ai.Zoom=qi,Ai.Scale=mm,Ai.Attribution=Cl,aa.layers=fm,aa.zoom=pm,aa.scale=Sl,aa.attribution=Yc;var Wi=j.extend({initialize:function(c){this._map=c},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Wi.addTo=function(c,h){return c.addHandler(h,this),this};var Qc={Events:pe},ym=Re.touch?"touchstart mousedown":"mousedown",jr=Ee.extend({options:{clickTolerance:3},initialize:function(c,h,g,_){y(this,_),this._element=c,this._dragStartTarget=h||c,this._preventOutline=g},enable:function(){this._enabled||(Ke(this._dragStartTarget,ym,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(jr._dragging===this&&this.finishDrag(!0),Bt(this._dragStartTarget,ym,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(c){if(this._enabled&&(this._moved=!1,!Wc(this._element,"leaflet-zoom-anim"))){if(c.touches&&c.touches.length!==1){jr._dragging===this&&this.finishDrag();return}if(!(jr._dragging||c.shiftKey||c.which!==1&&c.button!==1&&!c.touches)&&(jr._dragging=this,this._preventOutline&&uh(this._element),io(),ra(),!this._moving)){this.fire("down");var h=c.touches?c.touches[0]:c,g=um(this._element);this._startPoint=new q(h.clientX,h.clientY),this._startPos=Er(this._element),this._parentScale=ro(g);var _=c.type==="mousedown";Ke(document,_?"mousemove":"touchmove",this._onMove,this),Ke(document,_?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(c){if(this._enabled){if(c.touches&&c.touches.length>1){this._moved=!0;return}var h=c.touches&&c.touches.length===1?c.touches[0]:c,g=new q(h.clientX,h.clientY)._subtract(this._startPoint);!g.x&&!g.y||Math.abs(g.x)+Math.abs(g.y)<this.options.clickTolerance||(g.x/=this._parentScale.x,g.y/=this._parentScale.y,dn(c),this._moved||(this.fire("dragstart"),this._moved=!0,Ze(document.body,"leaflet-dragging"),this._lastTarget=c.target||c.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Ze(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(g),this._moving=!0,this._lastEvent=c,this._updatePosition())}},_updatePosition:function(){var c={originalEvent:this._lastEvent};this.fire("predrag",c),rn(this._element,this._newPos),this.fire("drag",c)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(c){un(document.body,"leaflet-dragging"),this._lastTarget&&(un(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Bt(document,"mousemove touchmove",this._onMove,this),Bt(document,"mouseup touchend touchcancel",this._onUp,this),lh(),Lt();var h=this._moved&&this._moving;this._moving=!1,jr._dragging=!1,h&&this.fire("dragend",{noInertia:c,distance:this._newPos.distanceTo(this._startPos)})}});function la(c,h,g){var _,I=[1,4,2,8],k,z,Z,J,ae,be,$e,ft;for(k=0,be=c.length;k<be;k++)c[k]._code=ms(c[k],h);for(Z=0;Z<4;Z++){for($e=I[Z],_=[],k=0,be=c.length,z=be-1;k<be;z=k++)J=c[k],ae=c[z],J._code&$e?ae._code&$e||(ft=xl(ae,J,$e,h,g),ft._code=ms(ft,h),_.push(ft)):(ae._code&$e&&(ft=xl(ae,J,$e,h,g),ft._code=ms(ft,h),_.push(ft)),_.push(J));c=_}return c}function yh(c,h){var g,_,I,k,z,Z,J,ae,be;if(!c||c.length===0)throw new Error("latlngs not passed");gi(c)||(console.warn("latlngs are not flat! Only the first ring will be used"),c=c[0]);var $e=he([0,0]),ft=ie(c),yi=ft.getNorthWest().distanceTo(ft.getSouthWest())*ft.getNorthEast().distanceTo(ft.getNorthWest());yi<1700&&($e=Zc(c));var zn=c.length,wr=[];for(g=0;g<zn;g++){var Di=he(c[g]);wr.push(h.project(he([Di.lat-$e.lat,Di.lng-$e.lng])))}for(Z=J=ae=0,g=0,_=zn-1;g<zn;_=g++)I=wr[g],k=wr[_],z=I.y*k.x-k.y*I.x,J+=(I.x+k.x)*z,ae+=(I.y+k.y)*z,Z+=z*3;Z===0?be=wr[0]:be=[J/Z,ae/Z];var ou=h.unproject(W(be));return he([ou.lat+$e.lat,ou.lng+$e.lng])}function Zc(c){for(var h=0,g=0,_=0,I=0;I<c.length;I++){var k=he(c[I]);h+=k.lat,g+=k.lng,_++}return he([h/_,g/_])}var vh={__proto__:null,clipPolygon:la,polygonCenter:yh,centroid:Zc};function Xc(c,h){if(!h||!c.length)return c.slice();var g=h*h;return c=oo(c,g),c=vm(c,g),c}function _h(c,h,g){return Math.sqrt(On(c,h,g,!0))}function Jc(c,h,g){return On(c,h,g)}function vm(c,h){var g=c.length,_=typeof Uint8Array<"u"?Uint8Array:Array,I=new _(g);I[0]=I[g-1]=1,eu(c,I,h,0,g-1);var k,z=[];for(k=0;k<g;k++)I[k]&&z.push(c[k]);return z}function eu(c,h,g,_,I){var k=0,z,Z,J;for(Z=_+1;Z<=I-1;Z++)J=On(c[Z],c[_],c[I],!0),J>k&&(z=Z,k=J);k>g&&(h[z]=1,eu(c,h,g,_,z),eu(c,h,g,z,I))}function oo(c,h){for(var g=[c[0]],_=1,I=0,k=c.length;_<k;_++)tu(c[_],c[I])>h&&(g.push(c[_]),I=_);return I<k-1&&g.push(c[k-1]),g}var Eh;function Th(c,h,g,_,I){var k=_?Eh:ms(c,g),z=ms(h,g),Z,J,ae;for(Eh=z;;){if(!(k|z))return[c,h];if(k&z)return!1;Z=k||z,J=xl(c,h,Z,g,I),ae=ms(J,g),Z===k?(c=J,k=ae):(h=J,z=ae)}}function xl(c,h,g,_,I){var k=h.x-c.x,z=h.y-c.y,Z=_.min,J=_.max,ae,be;return g&8?(ae=c.x+k*(J.y-c.y)/z,be=J.y):g&4?(ae=c.x+k*(Z.y-c.y)/z,be=Z.y):g&2?(ae=J.x,be=c.y+z*(J.x-c.x)/k):g&1&&(ae=Z.x,be=c.y+z*(Z.x-c.x)/k),new q(ae,be,I)}function ms(c,h){var g=0;return c.x<h.min.x?g|=1:c.x>h.max.x&&(g|=2),c.y<h.min.y?g|=4:c.y>h.max.y&&(g|=8),g}function tu(c,h){var g=h.x-c.x,_=h.y-c.y;return g*g+_*_}function On(c,h,g,_){var I=h.x,k=h.y,z=g.x-I,Z=g.y-k,J=z*z+Z*Z,ae;return J>0&&(ae=((c.x-I)*z+(c.y-k)*Z)/J,ae>1?(I=g.x,k=g.y):ae>0&&(I+=z*ae,k+=Z*ae)),z=c.x-I,Z=c.y-k,_?z*z+Z*Z:new q(I,k)}function gi(c){return!C(c[0])||typeof c[0][0]!="object"&&typeof c[0][0]<"u"}function wh(c){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),gi(c)}function ao(c,h){var g,_,I,k,z,Z,J,ae;if(!c||c.length===0)throw new Error("latlngs not passed");gi(c)||(console.warn("latlngs are not flat! Only the first ring will be used"),c=c[0]);var be=he([0,0]),$e=ie(c),ft=$e.getNorthWest().distanceTo($e.getSouthWest())*$e.getNorthEast().distanceTo($e.getNorthWest());ft<1700&&(be=Zc(c));var yi=c.length,zn=[];for(g=0;g<yi;g++){var wr=he(c[g]);zn.push(h.project(he([wr.lat-be.lat,wr.lng-be.lng])))}for(g=0,_=0;g<yi-1;g++)_+=zn[g].distanceTo(zn[g+1])/2;if(_===0)ae=zn[0];else for(g=0,k=0;g<yi-1;g++)if(z=zn[g],Z=zn[g+1],I=z.distanceTo(Z),k+=I,k>_){J=(k-_)/I,ae=[Z.x-J*(Z.x-z.x),Z.y-J*(Z.y-z.y)];break}var Di=h.unproject(W(ae));return he([Di.lat+be.lat,Di.lng+be.lng])}var p={__proto__:null,simplify:Xc,pointToSegmentDistance:_h,closestPointOnSegment:Jc,clipSegment:Th,_getEdgeIntersection:xl,_getBitCode:ms,_sqClosestPointOnSegment:On,isFlat:gi,_flat:wh,polylineCenter:ao},w={project:function(c){return new q(c.lng,c.lat)},unproject:function(c){return new de(c.y,c.x)},bounds:new ne([-180,-90],[180,90])},S={R:6378137,R_MINOR:6356752314245179e-9,bounds:new ne([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(c){var h=Math.PI/180,g=this.R,_=c.lat*h,I=this.R_MINOR/g,k=Math.sqrt(1-I*I),z=k*Math.sin(_),Z=Math.tan(Math.PI/4-_/2)/Math.pow((1-z)/(1+z),k/2);return _=-g*Math.log(Math.max(Z,1e-10)),new q(c.lng*h*g,_)},unproject:function(c){for(var h=180/Math.PI,g=this.R,_=this.R_MINOR/g,I=Math.sqrt(1-_*_),k=Math.exp(-c.y/g),z=Math.PI/2-2*Math.atan(k),Z=0,J=.1,ae;Z<15&&Math.abs(J)>1e-7;Z++)ae=I*Math.sin(z),ae=Math.pow((1-ae)/(1+ae),I/2),J=Math.PI/2-2*Math.atan(k*ae)-z,z+=J;return new de(z*h,c.x*h/g)}},O={__proto__:null,LonLat:w,Mercator:S,SphericalMercator:Mt},Y=t({},je,{code:"EPSG:3395",projection:S,transformation:function(){var c=.5/(Math.PI*S.R);return Zt(c,.5,-c,.5)}()}),ee=t({},je,{code:"EPSG:4326",projection:w,transformation:Zt(1/180,1,-1/180,.5)}),_e=t({},Ne,{projection:w,transformation:Zt(1,0,-1,0),scale:function(c){return Math.pow(2,c)},zoom:function(c){return Math.log(c)/Math.LN2},distance:function(c,h){var g=h.lng-c.lng,_=h.lat-c.lat;return Math.sqrt(g*g+_*_)},infinite:!0});Ne.Earth=je,Ne.EPSG3395=Y,Ne.EPSG3857=bn,Ne.EPSG900913=hl,Ne.EPSG4326=ee,Ne.Simple=_e;var ut=Ee.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(c){return c.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(c){return c&&c.removeLayer(this),this},getPane:function(c){return this._map.getPane(c?this.options[c]||c:this.options.pane)},addInteractiveTarget:function(c){return this._map._targets[o(c)]=this,this},removeInteractiveTarget:function(c){return delete this._map._targets[o(c)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(c){var h=c.target;if(h.hasLayer(this)){if(this._map=h,this._zoomAnimated=h._zoomAnimated,this.getEvents){var g=this.getEvents();h.on(g,this),this.once("remove",function(){h.off(g,this)},this)}this.onAdd(h),this.fire("add"),h.fire("layeradd",{layer:this})}}});gt.include({addLayer:function(c){if(!c._layerAdd)throw new Error("The provided object is not a Layer.");var h=o(c);return this._layers[h]?this:(this._layers[h]=c,c._mapToAdd=this,c.beforeAdd&&c.beforeAdd(this),this.whenReady(c._layerAdd,c),this)},removeLayer:function(c){var h=o(c);return this._layers[h]?(this._loaded&&c.onRemove(this),delete this._layers[h],this._loaded&&(this.fire("layerremove",{layer:c}),c.fire("remove")),c._map=c._mapToAdd=null,this):this},hasLayer:function(c){return o(c)in this._layers},eachLayer:function(c,h){for(var g in this._layers)c.call(h,this._layers[g]);return this},_addLayers:function(c){c=c?C(c)?c:[c]:[];for(var h=0,g=c.length;h<g;h++)this.addLayer(c[h])},_addZoomLimit:function(c){(!isNaN(c.options.maxZoom)||!isNaN(c.options.minZoom))&&(this._zoomBoundLayers[o(c)]=c,this._updateZoomLevels())},_removeZoomLimit:function(c){var h=o(c);this._zoomBoundLayers[h]&&(delete this._zoomBoundLayers[h],this._updateZoomLevels())},_updateZoomLevels:function(){var c=1/0,h=-1/0,g=this._getZoomSpan();for(var _ in this._zoomBoundLayers){var I=this._zoomBoundLayers[_].options;c=I.minZoom===void 0?c:Math.min(c,I.minZoom),h=I.maxZoom===void 0?h:Math.max(h,I.maxZoom)}this._layersMaxZoom=h===-1/0?void 0:h,this._layersMinZoom=c===1/0?void 0:c,g!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var an=ut.extend({initialize:function(c,h){y(this,h),this._layers={};var g,_;if(c)for(g=0,_=c.length;g<_;g++)this.addLayer(c[g])},addLayer:function(c){var h=this.getLayerId(c);return this._layers[h]=c,this._map&&this._map.addLayer(c),this},removeLayer:function(c){var h=c in this._layers?c:this.getLayerId(c);return this._map&&this._layers[h]&&this._map.removeLayer(this._layers[h]),delete this._layers[h],this},hasLayer:function(c){var h=typeof c=="number"?c:this.getLayerId(c);return h in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(c){var h=Array.prototype.slice.call(arguments,1),g,_;for(g in this._layers)_=this._layers[g],_[c]&&_[c].apply(_,h);return this},onAdd:function(c){this.eachLayer(c.addLayer,c)},onRemove:function(c){this.eachLayer(c.removeLayer,c)},eachLayer:function(c,h){for(var g in this._layers)c.call(h,this._layers[g]);return this},getLayer:function(c){return this._layers[c]},getLayers:function(){var c=[];return this.eachLayer(c.push,c),c},setZIndex:function(c){return this.invoke("setZIndex",c)},getLayerId:function(c){return o(c)}}),wt=function(c,h){return new an(c,h)},Jt=an.extend({addLayer:function(c){return this.hasLayer(c)?this:(c.addEventParent(this),an.prototype.addLayer.call(this,c),this.fire("layeradd",{layer:c}))},removeLayer:function(c){return this.hasLayer(c)?(c in this._layers&&(c=this._layers[c]),c.removeEventParent(this),an.prototype.removeLayer.call(this,c),this.fire("layerremove",{layer:c})):this},setStyle:function(c){return this.invoke("setStyle",c)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var c=new oe;for(var h in this._layers){var g=this._layers[h];c.extend(g.getBounds?g.getBounds():g.getLatLng())}return c}}),Gn=function(c,h){return new Jt(c,h)},Ki=j.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(c){y(this,c)},createIcon:function(c){return this._createIcon("icon",c)},createShadow:function(c){return this._createIcon("shadow",c)},_createIcon:function(c,h){var g=this._getIconUrl(c);if(!g){if(c==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var _=this._createImg(g,h&&h.tagName==="IMG"?h:null);return this._setIconStyles(_,c),(this.options.crossOrigin||this.options.crossOrigin==="")&&(_.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),_},_setIconStyles:function(c,h){var g=this.options,_=g[h+"Size"];typeof _=="number"&&(_=[_,_]);var I=W(_),k=W(h==="shadow"&&g.shadowAnchor||g.iconAnchor||I&&I.divideBy(2,!0));c.className="leaflet-marker-"+h+" "+(g.className||""),k&&(c.style.marginLeft=-k.x+"px",c.style.marginTop=-k.y+"px"),I&&(c.style.width=I.x+"px",c.style.height=I.y+"px")},_createImg:function(c,h){return h=h||document.createElement("img"),h.src=c,h},_getIconUrl:function(c){return Re.retina&&this.options[c+"RetinaUrl"]||this.options[c+"Url"]}});function Yi(c){return new Ki(c)}var gs=Ki.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(c){return typeof gs.imagePath!="string"&&(gs.imagePath=this._detectIconPath()),(this.options.imagePath||gs.imagePath)+Ki.prototype._getIconUrl.call(this,c)},_stripUrl:function(c){var h=function(g,_,I){var k=_.exec(g);return k&&k[I]};return c=h(c,/^url\((['"])?(.+)\1\)$/,2),c&&h(c,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var c=Et("div","leaflet-default-icon-path",document.body),h=yl(c,"background-image")||yl(c,"backgroundImage");if(document.body.removeChild(c),h=this._stripUrl(h),h)return h;var g=document.querySelector('link[href$="leaflet.css"]');return g?g.href.substring(0,g.href.length-11-1):""}}),nu=Wi.extend({initialize:function(c){this._marker=c},addHooks:function(){var c=this._marker._icon;this._draggable||(this._draggable=new jr(c,c,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Ze(c,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&un(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(c){var h=this._marker,g=h._map,_=this._marker.options.autoPanSpeed,I=this._marker.options.autoPanPadding,k=Er(h._icon),z=g.getPixelBounds(),Z=g.getPixelOrigin(),J=ye(z.min._subtract(Z).add(I),z.max._subtract(Z).subtract(I));if(!J.contains(k)){var ae=W((Math.max(J.max.x,k.x)-J.max.x)/(z.max.x-J.max.x)-(Math.min(J.min.x,k.x)-J.min.x)/(z.min.x-J.min.x),(Math.max(J.max.y,k.y)-J.max.y)/(z.max.y-J.max.y)-(Math.min(J.min.y,k.y)-J.min.y)/(z.min.y-J.min.y)).multiplyBy(_);g.panBy(ae,{animate:!1}),this._draggable._newPos._add(ae),this._draggable._startPos._add(ae),rn(h._icon,this._draggable._newPos),this._onDrag(c),this._panRequest=R(this._adjustPan.bind(this,c))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(c){this._marker.options.autoPan&&(M(this._panRequest),this._panRequest=R(this._adjustPan.bind(this,c)))},_onDrag:function(c){var h=this._marker,g=h._shadow,_=Er(h._icon),I=h._map.layerPointToLatLng(_);g&&rn(g,_),h._latlng=I,c.latlng=I,c.oldLatLng=this._oldLatLng,h.fire("move",c).fire("drag",c)},_onDragEnd:function(c){M(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",c)}}),_m=ut.extend({options:{icon:new gs,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(c,h){y(this,h),this._latlng=he(c)},onAdd:function(c){this._zoomAnimated=this._zoomAnimated&&c.options.markerZoomAnimation,this._zoomAnimated&&c.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(c){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&c.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(c){var h=this._latlng;return this._latlng=he(c),this.update(),this.fire("move",{oldLatLng:h,latlng:this._latlng})},setZIndexOffset:function(c){return this.options.zIndexOffset=c,this.update()},getIcon:function(){return this.options.icon},setIcon:function(c){return this.options.icon=c,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var c=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(c)}return this},_initIcon:function(){var c=this.options,h="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),g=c.icon.createIcon(this._icon),_=!1;g!==this._icon&&(this._icon&&this._removeIcon(),_=!0,c.title&&(g.title=c.title),g.tagName==="IMG"&&(g.alt=c.alt||"")),Ze(g,h),c.keyboard&&(g.tabIndex="0",g.setAttribute("role","button")),this._icon=g,c.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ke(g,"focus",this._panOnFocus,this);var I=c.icon.createShadow(this._shadow),k=!1;I!==this._shadow&&(this._removeShadow(),k=!0),I&&(Ze(I,h),I.alt=""),this._shadow=I,c.opacity<1&&this._updateOpacity(),_&&this.getPane().appendChild(this._icon),this._initInteraction(),I&&k&&this.getPane(c.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Bt(this._icon,"focus",this._panOnFocus,this),Xt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Xt(this._shadow),this._shadow=null},_setPos:function(c){this._icon&&rn(this._icon,c),this._shadow&&rn(this._shadow,c),this._zIndex=c.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(c){this._icon&&(this._icon.style.zIndex=this._zIndex+c)},_animateZoom:function(c){var h=this._map._latLngToNewLayerPoint(this._latlng,c.zoom,c.center).round();this._setPos(h)},_initInteraction:function(){if(this.options.interactive&&(Ze(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),nu)){var c=this.options.draggable;this.dragging&&(c=this.dragging.enabled(),this.dragging.disable()),this.dragging=new nu(this),c&&this.dragging.enable()}},setOpacity:function(c){return this.options.opacity=c,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var c=this.options.opacity;this._icon&&mi(this._icon,c),this._shadow&&mi(this._shadow,c)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var c=this._map;if(c){var h=this.options.icon.options,g=h.iconSize?W(h.iconSize):W(0,0),_=h.iconAnchor?W(h.iconAnchor):W(0,0);c.panInside(this._latlng,{paddingTopLeft:_,paddingBottomRight:g.subtract(_)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function R$(c,h){return new _m(c,h)}var ca=ut.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(c){this._renderer=c.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(c){return y(this,c),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&c&&Object.prototype.hasOwnProperty.call(c,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Em=ca.extend({options:{fill:!0,radius:10},initialize:function(c,h){y(this,h),this._latlng=he(c),this._radius=this.options.radius},setLatLng:function(c){var h=this._latlng;return this._latlng=he(c),this.redraw(),this.fire("move",{oldLatLng:h,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(c){return this.options.radius=this._radius=c,this.redraw()},getRadius:function(){return this._radius},setStyle:function(c){var h=c&&c.radius||this._radius;return ca.prototype.setStyle.call(this,c),this.setRadius(h),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var c=this._radius,h=this._radiusY||c,g=this._clickTolerance(),_=[c+g,h+g];this._pxBounds=new ne(this._point.subtract(_),this._point.add(_))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(c){return c.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function M$(c,h){return new Em(c,h)}var iE=Em.extend({initialize:function(c,h,g){if(typeof h=="number"&&(h=t({},g,{radius:h})),y(this,h),this._latlng=he(c),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(c){return this._mRadius=c,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var c=[this._radius,this._radiusY||this._radius];return new oe(this._map.layerPointToLatLng(this._point.subtract(c)),this._map.layerPointToLatLng(this._point.add(c)))},setStyle:ca.prototype.setStyle,_project:function(){var c=this._latlng.lng,h=this._latlng.lat,g=this._map,_=g.options.crs;if(_.distance===je.distance){var I=Math.PI/180,k=this._mRadius/je.R/I,z=g.project([h+k,c]),Z=g.project([h-k,c]),J=z.add(Z).divideBy(2),ae=g.unproject(J).lat,be=Math.acos((Math.cos(k*I)-Math.sin(h*I)*Math.sin(ae*I))/(Math.cos(h*I)*Math.cos(ae*I)))/I;(isNaN(be)||be===0)&&(be=k/Math.cos(Math.PI/180*h)),this._point=J.subtract(g.getPixelOrigin()),this._radius=isNaN(be)?0:J.x-g.project([ae,c-be]).x,this._radiusY=J.y-z.y}else{var $e=_.unproject(_.project(this._latlng).subtract([this._mRadius,0]));this._point=g.latLngToLayerPoint(this._latlng),this._radius=this._point.x-g.latLngToLayerPoint($e).x}this._updateBounds()}});function k$(c,h,g){return new iE(c,h,g)}var lo=ca.extend({options:{smoothFactor:1,noClip:!1},initialize:function(c,h){y(this,h),this._setLatLngs(c)},getLatLngs:function(){return this._latlngs},setLatLngs:function(c){return this._setLatLngs(c),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(c){for(var h=1/0,g=null,_=On,I,k,z=0,Z=this._parts.length;z<Z;z++)for(var J=this._parts[z],ae=1,be=J.length;ae<be;ae++){I=J[ae-1],k=J[ae];var $e=_(c,I,k,!0);$e<h&&(h=$e,g=_(c,I,k))}return g&&(g.distance=Math.sqrt(h)),g},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ao(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(c,h){return h=h||this._defaultShape(),c=he(c),h.push(c),this._bounds.extend(c),this.redraw()},_setLatLngs:function(c){this._bounds=new oe,this._latlngs=this._convertLatLngs(c)},_defaultShape:function(){return gi(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(c){for(var h=[],g=gi(c),_=0,I=c.length;_<I;_++)g?(h[_]=he(c[_]),this._bounds.extend(h[_])):h[_]=this._convertLatLngs(c[_]);return h},_project:function(){var c=new ne;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,c),this._bounds.isValid()&&c.isValid()&&(this._rawPxBounds=c,this._updateBounds())},_updateBounds:function(){var c=this._clickTolerance(),h=new q(c,c);this._rawPxBounds&&(this._pxBounds=new ne([this._rawPxBounds.min.subtract(h),this._rawPxBounds.max.add(h)]))},_projectLatlngs:function(c,h,g){var _=c[0]instanceof de,I=c.length,k,z;if(_){for(z=[],k=0;k<I;k++)z[k]=this._map.latLngToLayerPoint(c[k]),g.extend(z[k]);h.push(z)}else for(k=0;k<I;k++)this._projectLatlngs(c[k],h,g)},_clipPoints:function(){var c=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(c))){if(this.options.noClip){this._parts=this._rings;return}var h=this._parts,g,_,I,k,z,Z,J;for(g=0,I=0,k=this._rings.length;g<k;g++)for(J=this._rings[g],_=0,z=J.length;_<z-1;_++)Z=Th(J[_],J[_+1],c,_,!0),Z&&(h[I]=h[I]||[],h[I].push(Z[0]),(Z[1]!==J[_+1]||_===z-2)&&(h[I].push(Z[1]),I++))}},_simplifyPoints:function(){for(var c=this._parts,h=this.options.smoothFactor,g=0,_=c.length;g<_;g++)c[g]=Xc(c[g],h)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(c,h){var g,_,I,k,z,Z,J=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(c))return!1;for(g=0,k=this._parts.length;g<k;g++)for(Z=this._parts[g],_=0,z=Z.length,I=z-1;_<z;I=_++)if(!(!h&&_===0)&&_h(c,Z[I],Z[_])<=J)return!0;return!1}});function L$(c,h){return new lo(c,h)}lo._flat=wh;var iu=lo.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return yh(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(c){var h=lo.prototype._convertLatLngs.call(this,c),g=h.length;return g>=2&&h[0]instanceof de&&h[0].equals(h[g-1])&&h.pop(),h},_setLatLngs:function(c){lo.prototype._setLatLngs.call(this,c),gi(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return gi(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var c=this._renderer._bounds,h=this.options.weight,g=new q(h,h);if(c=new ne(c.min.subtract(g),c.max.add(g)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(c))){if(this.options.noClip){this._parts=this._rings;return}for(var _=0,I=this._rings.length,k;_<I;_++)k=la(this._rings[_],c,!0),k.length&&this._parts.push(k)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(c){var h=!1,g,_,I,k,z,Z,J,ae;if(!this._pxBounds||!this._pxBounds.contains(c))return!1;for(k=0,J=this._parts.length;k<J;k++)for(g=this._parts[k],z=0,ae=g.length,Z=ae-1;z<ae;Z=z++)_=g[z],I=g[Z],_.y>c.y!=I.y>c.y&&c.x<(I.x-_.x)*(c.y-_.y)/(I.y-_.y)+_.x&&(h=!h);return h||lo.prototype._containsPoint.call(this,c,!0)}});function O$(c,h){return new iu(c,h)}var co=Jt.extend({initialize:function(c,h){y(this,h),this._layers={},c&&this.addData(c)},addData:function(c){var h=C(c)?c:c.features,g,_,I;if(h){for(g=0,_=h.length;g<_;g++)I=h[g],(I.geometries||I.geometry||I.features||I.coordinates)&&this.addData(I);return this}var k=this.options;if(k.filter&&!k.filter(c))return this;var z=Tm(c,k);return z?(z.feature=bm(c),z.defaultOptions=z.options,this.resetStyle(z),k.onEachFeature&&k.onEachFeature(c,z),this.addLayer(z)):this},resetStyle:function(c){return c===void 0?this.eachLayer(this.resetStyle,this):(c.options=t({},c.defaultOptions),this._setLayerStyle(c,this.options.style),this)},setStyle:function(c){return this.eachLayer(function(h){this._setLayerStyle(h,c)},this)},_setLayerStyle:function(c,h){c.setStyle&&(typeof h=="function"&&(h=h(c.feature)),c.setStyle(h))}});function Tm(c,h){var g=c.type==="Feature"?c.geometry:c,_=g?g.coordinates:null,I=[],k=h&&h.pointToLayer,z=h&&h.coordsToLatLng||rE,Z,J,ae,be;if(!_&&!g)return null;switch(g.type){case"Point":return Z=z(_),d1(k,c,Z,h);case"MultiPoint":for(ae=0,be=_.length;ae<be;ae++)Z=z(_[ae]),I.push(d1(k,c,Z,h));return new Jt(I);case"LineString":case"MultiLineString":return J=wm(_,g.type==="LineString"?0:1,z),new lo(J,h);case"Polygon":case"MultiPolygon":return J=wm(_,g.type==="Polygon"?1:2,z),new iu(J,h);case"GeometryCollection":for(ae=0,be=g.geometries.length;ae<be;ae++){var $e=Tm({geometry:g.geometries[ae],type:"Feature",properties:c.properties},h);$e&&I.push($e)}return new Jt(I);case"FeatureCollection":for(ae=0,be=g.features.length;ae<be;ae++){var ft=Tm(g.features[ae],h);ft&&I.push(ft)}return new Jt(I);default:throw new Error("Invalid GeoJSON object.")}}function d1(c,h,g,_){return c?c(h,g):new _m(g,_&&_.markersInheritOptions&&_)}function rE(c){return new de(c[1],c[0],c[2])}function wm(c,h,g){for(var _=[],I=0,k=c.length,z;I<k;I++)z=h?wm(c[I],h-1,g):(g||rE)(c[I]),_.push(z);return _}function sE(c,h){return c=he(c),c.alt!==void 0?[d(c.lng,h),d(c.lat,h),d(c.alt,h)]:[d(c.lng,h),d(c.lat,h)]}function Im(c,h,g,_){for(var I=[],k=0,z=c.length;k<z;k++)I.push(h?Im(c[k],gi(c[k])?0:h-1,g,_):sE(c[k],_));return!h&&g&&I.length>0&&I.push(I[0].slice()),I}function ru(c,h){return c.feature?t({},c.feature,{geometry:h}):bm(h)}function bm(c){return c.type==="Feature"||c.type==="FeatureCollection"?c:{type:"Feature",properties:{},geometry:c}}var oE={toGeoJSON:function(c){return ru(this,{type:"Point",coordinates:sE(this.getLatLng(),c)})}};_m.include(oE),iE.include(oE),Em.include(oE),lo.include({toGeoJSON:function(c){var h=!gi(this._latlngs),g=Im(this._latlngs,h?1:0,!1,c);return ru(this,{type:(h?"Multi":"")+"LineString",coordinates:g})}}),iu.include({toGeoJSON:function(c){var h=!gi(this._latlngs),g=h&&!gi(this._latlngs[0]),_=Im(this._latlngs,g?2:h?1:0,!0,c);return h||(_=[_]),ru(this,{type:(g?"Multi":"")+"Polygon",coordinates:_})}}),an.include({toMultiPoint:function(c){var h=[];return this.eachLayer(function(g){h.push(g.toGeoJSON(c).geometry.coordinates)}),ru(this,{type:"MultiPoint",coordinates:h})},toGeoJSON:function(c){var h=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(h==="MultiPoint")return this.toMultiPoint(c);var g=h==="GeometryCollection",_=[];return this.eachLayer(function(I){if(I.toGeoJSON){var k=I.toGeoJSON(c);if(g)_.push(k.geometry);else{var z=bm(k);z.type==="FeatureCollection"?_.push.apply(_,z.features):_.push(z)}}}),g?ru(this,{geometries:_,type:"GeometryCollection"}):{type:"FeatureCollection",features:_}}});function h1(c,h){return new co(c,h)}var N$=h1,Sm=ut.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(c,h,g){this._url=c,this._bounds=ie(h),y(this,g)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Ze(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Xt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(c){return this.options.opacity=c,this._image&&this._updateOpacity(),this},setStyle:function(c){return c.opacity&&this.setOpacity(c.opacity),this},bringToFront:function(){return this._map&&hs(this._image),this},bringToBack:function(){return this._map&&fs(this._image),this},setUrl:function(c){return this._url=c,this._image&&(this._image.src=c),this},setBounds:function(c){return this._bounds=ie(c),this._map&&this._reset(),this},getEvents:function(){var c={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(c.zoomanim=this._animateZoom),c},setZIndex:function(c){return this.options.zIndex=c,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var c=this._url.tagName==="IMG",h=this._image=c?this._url:Et("img");if(Ze(h,"leaflet-image-layer"),this._zoomAnimated&&Ze(h,"leaflet-zoom-animated"),this.options.className&&Ze(h,this.options.className),h.onselectstart=u,h.onmousemove=u,h.onload=r(this.fire,this,"load"),h.onerror=r(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(h.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),c){this._url=h.src;return}h.src=this._url,h.alt=this.options.alt},_animateZoom:function(c){var h=this._map.getZoomScale(c.zoom),g=this._map._latLngBoundsToNewLayerBounds(this._bounds,c.zoom,c.center).min;ni(this._image,g,h)},_reset:function(){var c=this._image,h=new ne(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),g=h.getSize();rn(c,h.min),c.style.width=g.x+"px",c.style.height=g.y+"px"},_updateOpacity:function(){mi(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var c=this.options.errorOverlayUrl;c&&this._url!==c&&(this._url=c,this._image.src=c)},getCenter:function(){return this._bounds.getCenter()}}),F$=function(c,h,g){return new Sm(c,h,g)},f1=Sm.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var c=this._url.tagName==="VIDEO",h=this._image=c?this._url:Et("video");if(Ze(h,"leaflet-image-layer"),this._zoomAnimated&&Ze(h,"leaflet-zoom-animated"),this.options.className&&Ze(h,this.options.className),h.onselectstart=u,h.onmousemove=u,h.onloadeddata=r(this.fire,this,"load"),c){for(var g=h.getElementsByTagName("source"),_=[],I=0;I<g.length;I++)_.push(g[I].src);this._url=g.length>0?_:[h.src];return}C(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(h.style,"objectFit")&&(h.style.objectFit="fill"),h.autoplay=!!this.options.autoplay,h.loop=!!this.options.loop,h.muted=!!this.options.muted,h.playsInline=!!this.options.playsInline;for(var k=0;k<this._url.length;k++){var z=Et("source");z.src=this._url[k],h.appendChild(z)}}});function V$(c,h,g){return new f1(c,h,g)}var p1=Sm.extend({_initImage:function(){var c=this._image=this._url;Ze(c,"leaflet-image-layer"),this._zoomAnimated&&Ze(c,"leaflet-zoom-animated"),this.options.className&&Ze(c,this.options.className),c.onselectstart=u,c.onmousemove=u}});function B$(c,h,g){return new p1(c,h,g)}var ys=ut.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(c,h){c&&(c instanceof de||C(c))?(this._latlng=he(c),y(this,h)):(y(this,c),this._source=h),this.options.content&&(this._content=this.options.content)},openOn:function(c){return c=arguments.length?c:this._source._map,c.hasLayer(this)||c.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(c){return this._map?this.close():(arguments.length?this._source=c:c=this._source,this._prepareOpen(),this.openOn(c._map)),this},onAdd:function(c){this._zoomAnimated=c._zoomAnimated,this._container||this._initLayout(),c._fadeAnimated&&mi(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),c._fadeAnimated&&mi(this._container,1),this.bringToFront(),this.options.interactive&&(Ze(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(c){c._fadeAnimated?(mi(this._container,0),this._removeTimeout=setTimeout(r(Xt,void 0,this._container),200)):Xt(this._container),this.options.interactive&&(un(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(c){return this._latlng=he(c),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(c){return this._content=c,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var c={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(c.zoomanim=this._animateZoom),c},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&hs(this._container),this},bringToBack:function(){return this._map&&fs(this._container),this},_prepareOpen:function(c){var h=this._source;if(!h._map)return!1;if(h instanceof Jt){h=null;var g=this._source._layers;for(var _ in g)if(g[_]._map){h=g[_];break}if(!h)return!1;this._source=h}if(!c)if(h.getCenter)c=h.getCenter();else if(h.getLatLng)c=h.getLatLng();else if(h.getBounds)c=h.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(c),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var c=this._contentNode,h=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof h=="string")c.innerHTML=h;else{for(;c.hasChildNodes();)c.removeChild(c.firstChild);c.appendChild(h)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var c=this._map.latLngToLayerPoint(this._latlng),h=W(this.options.offset),g=this._getAnchor();this._zoomAnimated?rn(this._container,c.add(g)):h=h.add(c).add(g);var _=this._containerBottom=-h.y,I=this._containerLeft=-Math.round(this._containerWidth/2)+h.x;this._container.style.bottom=_+"px",this._container.style.left=I+"px"}},_getAnchor:function(){return[0,0]}});gt.include({_initOverlay:function(c,h,g,_){var I=h;return I instanceof c||(I=new c(_).setContent(h)),g&&I.setLatLng(g),I}}),ut.include({_initOverlay:function(c,h,g,_){var I=g;return I instanceof c?(y(I,_),I._source=this):(I=h&&!_?h:new c(_,this),I.setContent(g)),I}});var Cm=ys.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(c){return c=arguments.length?c:this._source._map,!c.hasLayer(this)&&c._popup&&c._popup.options.autoClose&&c.removeLayer(c._popup),c._popup=this,ys.prototype.openOn.call(this,c)},onAdd:function(c){ys.prototype.onAdd.call(this,c),c.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof ca||this._source.on("preclick",ai))},onRemove:function(c){ys.prototype.onRemove.call(this,c),c.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof ca||this._source.off("preclick",ai))},getEvents:function(){var c=ys.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(c.preclick=this.close),this.options.keepInView&&(c.moveend=this._adjustPan),c},_initLayout:function(){var c="leaflet-popup",h=this._container=Et("div",c+" "+(this.options.className||"")+" leaflet-zoom-animated"),g=this._wrapper=Et("div",c+"-content-wrapper",h);if(this._contentNode=Et("div",c+"-content",g),Tl(h),ph(this._contentNode),Ke(h,"contextmenu",ai),this._tipContainer=Et("div",c+"-tip-container",h),this._tip=Et("div",c+"-tip",this._tipContainer),this.options.closeButton){var _=this._closeButton=Et("a",c+"-close-button",h);_.setAttribute("role","button"),_.setAttribute("aria-label","Close popup"),_.href="#close",_.innerHTML='<span aria-hidden="true">&#215;</span>',Ke(_,"click",function(I){dn(I),this.close()},this)}},_updateLayout:function(){var c=this._contentNode,h=c.style;h.width="",h.whiteSpace="nowrap";var g=c.offsetWidth;g=Math.min(g,this.options.maxWidth),g=Math.max(g,this.options.minWidth),h.width=g+1+"px",h.whiteSpace="",h.height="";var _=c.offsetHeight,I=this.options.maxHeight,k="leaflet-popup-scrolled";I&&_>I?(h.height=I+"px",Ze(c,k)):un(c,k),this._containerWidth=this._container.offsetWidth},_animateZoom:function(c){var h=this._map._latLngToNewLayerPoint(this._latlng,c.zoom,c.center),g=this._getAnchor();rn(this._container,h.add(g))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var c=this._map,h=parseInt(yl(this._container,"marginBottom"),10)||0,g=this._container.offsetHeight+h,_=this._containerWidth,I=new q(this._containerLeft,-g-this._containerBottom);I._add(Er(this._container));var k=c.layerPointToContainerPoint(I),z=W(this.options.autoPanPadding),Z=W(this.options.autoPanPaddingTopLeft||z),J=W(this.options.autoPanPaddingBottomRight||z),ae=c.getSize(),be=0,$e=0;k.x+_+J.x>ae.x&&(be=k.x+_-ae.x+J.x),k.x-be-Z.x<0&&(be=k.x-Z.x),k.y+g+J.y>ae.y&&($e=k.y+g-ae.y+J.y),k.y-$e-Z.y<0&&($e=k.y-Z.y),(be||$e)&&(this.options.keepInView&&(this._autopanning=!0),c.fire("autopanstart").panBy([be,$e]))}},_getAnchor:function(){return W(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),U$=function(c,h){return new Cm(c,h)};gt.mergeOptions({closePopupOnClick:!0}),gt.include({openPopup:function(c,h,g){return this._initOverlay(Cm,c,h,g).openOn(this),this},closePopup:function(c){return c=arguments.length?c:this._popup,c&&c.close(),this}}),ut.include({bindPopup:function(c,h){return this._popup=this._initOverlay(Cm,this._popup,c,h),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(c){return this._popup&&(this instanceof Jt||(this._popup._source=this),this._popup._prepareOpen(c||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(c){return this._popup&&this._popup.setContent(c),this},getPopup:function(){return this._popup},_openPopup:function(c){if(!(!this._popup||!this._map)){Tr(c);var h=c.layer||c.target;if(this._popup._source===h&&!(h instanceof ca)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(c.latlng);return}this._popup._source=h,this.openPopup(c.latlng)}},_movePopup:function(c){this._popup.setLatLng(c.latlng)},_onKeyPress:function(c){c.originalEvent.keyCode===13&&this._openPopup(c)}});var xm=ys.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(c){ys.prototype.onAdd.call(this,c),this.setOpacity(this.options.opacity),c.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(c){ys.prototype.onRemove.call(this,c),c.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var c=ys.prototype.getEvents.call(this);return this.options.permanent||(c.preclick=this.close),c},_initLayout:function(){var c="leaflet-tooltip",h=c+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Et("div",h),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+o(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(c){var h,g,_=this._map,I=this._container,k=_.latLngToContainerPoint(_.getCenter()),z=_.layerPointToContainerPoint(c),Z=this.options.direction,J=I.offsetWidth,ae=I.offsetHeight,be=W(this.options.offset),$e=this._getAnchor();Z==="top"?(h=J/2,g=ae):Z==="bottom"?(h=J/2,g=0):Z==="center"?(h=J/2,g=ae/2):Z==="right"?(h=0,g=ae/2):Z==="left"?(h=J,g=ae/2):z.x<k.x?(Z="right",h=0,g=ae/2):(Z="left",h=J+(be.x+$e.x)*2,g=ae/2),c=c.subtract(W(h,g,!0)).add(be).add($e),un(I,"leaflet-tooltip-right"),un(I,"leaflet-tooltip-left"),un(I,"leaflet-tooltip-top"),un(I,"leaflet-tooltip-bottom"),Ze(I,"leaflet-tooltip-"+Z),rn(I,c)},_updatePosition:function(){var c=this._map.latLngToLayerPoint(this._latlng);this._setPosition(c)},setOpacity:function(c){this.options.opacity=c,this._container&&mi(this._container,c)},_animateZoom:function(c){var h=this._map._latLngToNewLayerPoint(this._latlng,c.zoom,c.center);this._setPosition(h)},_getAnchor:function(){return W(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),$$=function(c,h){return new xm(c,h)};gt.include({openTooltip:function(c,h,g){return this._initOverlay(xm,c,h,g).openOn(this),this},closeTooltip:function(c){return c.close(),this}}),ut.include({bindTooltip:function(c,h){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(xm,this._tooltip,c,h),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(c){if(!(!c&&this._tooltipHandlersAdded)){var h=c?"off":"on",g={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?g.add=this._openTooltip:(g.mouseover=this._openTooltip,g.mouseout=this.closeTooltip,g.click=this._openTooltip,this._map?this._addFocusListeners():g.add=this._addFocusListeners),this._tooltip.options.sticky&&(g.mousemove=this._moveTooltip),this[h](g),this._tooltipHandlersAdded=!c}},openTooltip:function(c){return this._tooltip&&(this instanceof Jt||(this._tooltip._source=this),this._tooltip._prepareOpen(c)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(c){return this._tooltip&&this._tooltip.setContent(c),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(c){var h=typeof c.getElement=="function"&&c.getElement();h&&(Ke(h,"focus",function(){this._tooltip._source=c,this.openTooltip()},this),Ke(h,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(c){var h=typeof c.getElement=="function"&&c.getElement();h&&h.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(c){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var h=this;this._map.once("moveend",function(){h._openOnceFlag=!1,h._openTooltip(c)});return}this._tooltip._source=c.layer||c.target,this.openTooltip(this._tooltip.options.sticky?c.latlng:void 0)}},_moveTooltip:function(c){var h=c.latlng,g,_;this._tooltip.options.sticky&&c.originalEvent&&(g=this._map.mouseEventToContainerPoint(c.originalEvent),_=this._map.containerPointToLayerPoint(g),h=this._map.layerPointToLatLng(_)),this._tooltip.setLatLng(h)}});var m1=Ki.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(c){var h=c&&c.tagName==="DIV"?c:document.createElement("div"),g=this.options;if(g.html instanceof Element?(vl(h),h.appendChild(g.html)):h.innerHTML=g.html!==!1?g.html:"",g.bgPos){var _=W(g.bgPos);h.style.backgroundPosition=-_.x+"px "+-_.y+"px"}return this._setIconStyles(h,"icon"),h},createShadow:function(){return null}});function j$(c){return new m1(c)}Ki.Default=gs;var Ih=ut.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Re.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(c){y(this,c)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(c){c._addZoomLimit(this)},onRemove:function(c){this._removeAllTiles(),Xt(this._container),c._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(hs(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(fs(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(c){return this.options.opacity=c,this._updateOpacity(),this},setZIndex:function(c){return this.options.zIndex=c,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var c=this._clampZoom(this._map.getZoom());c!==this._tileZoom&&(this._tileZoom=c,this._updateLevels()),this._update()}return this},getEvents:function(){var c={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=a(this._onMoveEnd,this.options.updateInterval,this)),c.move=this._onMove),this._zoomAnimated&&(c.zoomanim=this._animateZoom),c},createTile:function(){return document.createElement("div")},getTileSize:function(){var c=this.options.tileSize;return c instanceof q?c:new q(c,c)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(c){for(var h=this.getPane().children,g=-c(-1/0,1/0),_=0,I=h.length,k;_<I;_++)k=h[_].style.zIndex,h[_]!==this._container&&k&&(g=c(g,+k));isFinite(g)&&(this.options.zIndex=g+c(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Re.ielt9){mi(this._container,this.options.opacity);var c=+new Date,h=!1,g=!1;for(var _ in this._tiles){var I=this._tiles[_];if(!(!I.current||!I.loaded)){var k=Math.min(1,(c-I.loaded)/200);mi(I.el,k),k<1?h=!0:(I.active?g=!0:this._onOpaqueTile(I),I.active=!0)}}g&&!this._noPrune&&this._pruneTiles(),h&&(M(this._fadeFrame),this._fadeFrame=R(this._updateOpacity,this))}},_onOpaqueTile:u,_initContainer:function(){this._container||(this._container=Et("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var c=this._tileZoom,h=this.options.maxZoom;if(c!==void 0){for(var g in this._levels)g=Number(g),this._levels[g].el.children.length||g===c?(this._levels[g].el.style.zIndex=h-Math.abs(c-g),this._onUpdateLevel(g)):(Xt(this._levels[g].el),this._removeTilesAtZoom(g),this._onRemoveLevel(g),delete this._levels[g]);var _=this._levels[c],I=this._map;return _||(_=this._levels[c]={},_.el=Et("div","leaflet-tile-container leaflet-zoom-animated",this._container),_.el.style.zIndex=h,_.origin=I.project(I.unproject(I.getPixelOrigin()),c).round(),_.zoom=c,this._setZoomTransform(_,I.getCenter(),I.getZoom()),u(_.el.offsetWidth),this._onCreateLevel(_)),this._level=_,_}},_onUpdateLevel:u,_onRemoveLevel:u,_onCreateLevel:u,_pruneTiles:function(){if(this._map){var c,h,g=this._map.getZoom();if(g>this.options.maxZoom||g<this.options.minZoom){this._removeAllTiles();return}for(c in this._tiles)h=this._tiles[c],h.retain=h.current;for(c in this._tiles)if(h=this._tiles[c],h.current&&!h.active){var _=h.coords;this._retainParent(_.x,_.y,_.z,_.z-5)||this._retainChildren(_.x,_.y,_.z,_.z+2)}for(c in this._tiles)this._tiles[c].retain||this._removeTile(c)}},_removeTilesAtZoom:function(c){for(var h in this._tiles)this._tiles[h].coords.z===c&&this._removeTile(h)},_removeAllTiles:function(){for(var c in this._tiles)this._removeTile(c)},_invalidateAll:function(){for(var c in this._levels)Xt(this._levels[c].el),this._onRemoveLevel(Number(c)),delete this._levels[c];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(c,h,g,_){var I=Math.floor(c/2),k=Math.floor(h/2),z=g-1,Z=new q(+I,+k);Z.z=+z;var J=this._tileCoordsToKey(Z),ae=this._tiles[J];return ae&&ae.active?(ae.retain=!0,!0):(ae&&ae.loaded&&(ae.retain=!0),z>_?this._retainParent(I,k,z,_):!1)},_retainChildren:function(c,h,g,_){for(var I=2*c;I<2*c+2;I++)for(var k=2*h;k<2*h+2;k++){var z=new q(I,k);z.z=g+1;var Z=this._tileCoordsToKey(z),J=this._tiles[Z];if(J&&J.active){J.retain=!0;continue}else J&&J.loaded&&(J.retain=!0);g+1<_&&this._retainChildren(I,k,g+1,_)}},_resetView:function(c){var h=c&&(c.pinch||c.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),h,h)},_animateZoom:function(c){this._setView(c.center,c.zoom,!0,c.noUpdate)},_clampZoom:function(c){var h=this.options;return h.minNativeZoom!==void 0&&c<h.minNativeZoom?h.minNativeZoom:h.maxNativeZoom!==void 0&&h.maxNativeZoom<c?h.maxNativeZoom:c},_setView:function(c,h,g,_){var I=Math.round(h);this.options.maxZoom!==void 0&&I>this.options.maxZoom||this.options.minZoom!==void 0&&I<this.options.minZoom?I=void 0:I=this._clampZoom(I);var k=this.options.updateWhenZooming&&I!==this._tileZoom;(!_||k)&&(this._tileZoom=I,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),I!==void 0&&this._update(c),g||this._pruneTiles(),this._noPrune=!!g),this._setZoomTransforms(c,h)},_setZoomTransforms:function(c,h){for(var g in this._levels)this._setZoomTransform(this._levels[g],c,h)},_setZoomTransform:function(c,h,g){var _=this._map.getZoomScale(g,c.zoom),I=c.origin.multiplyBy(_).subtract(this._map._getNewPixelOrigin(h,g)).round();Re.any3d?ni(c.el,I,_):rn(c.el,I)},_resetGrid:function(){var c=this._map,h=c.options.crs,g=this._tileSize=this.getTileSize(),_=this._tileZoom,I=this._map.getPixelWorldBounds(this._tileZoom);I&&(this._globalTileRange=this._pxBoundsToTileRange(I)),this._wrapX=h.wrapLng&&!this.options.noWrap&&[Math.floor(c.project([0,h.wrapLng[0]],_).x/g.x),Math.ceil(c.project([0,h.wrapLng[1]],_).x/g.y)],this._wrapY=h.wrapLat&&!this.options.noWrap&&[Math.floor(c.project([h.wrapLat[0],0],_).y/g.x),Math.ceil(c.project([h.wrapLat[1],0],_).y/g.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(c){var h=this._map,g=h._animatingZoom?Math.max(h._animateToZoom,h.getZoom()):h.getZoom(),_=h.getZoomScale(g,this._tileZoom),I=h.project(c,this._tileZoom).floor(),k=h.getSize().divideBy(_*2);return new ne(I.subtract(k),I.add(k))},_update:function(c){var h=this._map;if(h){var g=this._clampZoom(h.getZoom());if(c===void 0&&(c=h.getCenter()),this._tileZoom!==void 0){var _=this._getTiledPixelBounds(c),I=this._pxBoundsToTileRange(_),k=I.getCenter(),z=[],Z=this.options.keepBuffer,J=new ne(I.getBottomLeft().subtract([Z,-Z]),I.getTopRight().add([Z,-Z]));if(!(isFinite(I.min.x)&&isFinite(I.min.y)&&isFinite(I.max.x)&&isFinite(I.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var ae in this._tiles){var be=this._tiles[ae].coords;(be.z!==this._tileZoom||!J.contains(new q(be.x,be.y)))&&(this._tiles[ae].current=!1)}if(Math.abs(g-this._tileZoom)>1){this._setView(c,g);return}for(var $e=I.min.y;$e<=I.max.y;$e++)for(var ft=I.min.x;ft<=I.max.x;ft++){var yi=new q(ft,$e);if(yi.z=this._tileZoom,!!this._isValidTile(yi)){var zn=this._tiles[this._tileCoordsToKey(yi)];zn?zn.current=!0:z.push(yi)}}if(z.sort(function(Di,ou){return Di.distanceTo(k)-ou.distanceTo(k)}),z.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var wr=document.createDocumentFragment();for(ft=0;ft<z.length;ft++)this._addTile(z[ft],wr);this._level.el.appendChild(wr)}}}},_isValidTile:function(c){var h=this._map.options.crs;if(!h.infinite){var g=this._globalTileRange;if(!h.wrapLng&&(c.x<g.min.x||c.x>g.max.x)||!h.wrapLat&&(c.y<g.min.y||c.y>g.max.y))return!1}if(!this.options.bounds)return!0;var _=this._tileCoordsToBounds(c);return ie(this.options.bounds).overlaps(_)},_keyToBounds:function(c){return this._tileCoordsToBounds(this._keyToTileCoords(c))},_tileCoordsToNwSe:function(c){var h=this._map,g=this.getTileSize(),_=c.scaleBy(g),I=_.add(g),k=h.unproject(_,c.z),z=h.unproject(I,c.z);return[k,z]},_tileCoordsToBounds:function(c){var h=this._tileCoordsToNwSe(c),g=new oe(h[0],h[1]);return this.options.noWrap||(g=this._map.wrapLatLngBounds(g)),g},_tileCoordsToKey:function(c){return c.x+":"+c.y+":"+c.z},_keyToTileCoords:function(c){var h=c.split(":"),g=new q(+h[0],+h[1]);return g.z=+h[2],g},_removeTile:function(c){var h=this._tiles[c];h&&(Xt(h.el),delete this._tiles[c],this.fire("tileunload",{tile:h.el,coords:this._keyToTileCoords(c)}))},_initTile:function(c){Ze(c,"leaflet-tile");var h=this.getTileSize();c.style.width=h.x+"px",c.style.height=h.y+"px",c.onselectstart=u,c.onmousemove=u,Re.ielt9&&this.options.opacity<1&&mi(c,this.options.opacity)},_addTile:function(c,h){var g=this._getTilePos(c),_=this._tileCoordsToKey(c),I=this.createTile(this._wrapCoords(c),r(this._tileReady,this,c));this._initTile(I),this.createTile.length<2&&R(r(this._tileReady,this,c,null,I)),rn(I,g),this._tiles[_]={el:I,coords:c,current:!0},h.appendChild(I),this.fire("tileloadstart",{tile:I,coords:c})},_tileReady:function(c,h,g){h&&this.fire("tileerror",{error:h,tile:g,coords:c});var _=this._tileCoordsToKey(c);g=this._tiles[_],g&&(g.loaded=+new Date,this._map._fadeAnimated?(mi(g.el,0),M(this._fadeFrame),this._fadeFrame=R(this._updateOpacity,this)):(g.active=!0,this._pruneTiles()),h||(Ze(g.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:g.el,coords:c})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Re.ielt9||!this._map._fadeAnimated?R(this._pruneTiles,this):setTimeout(r(this._pruneTiles,this),250)))},_getTilePos:function(c){return c.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(c){var h=new q(this._wrapX?l(c.x,this._wrapX):c.x,this._wrapY?l(c.y,this._wrapY):c.y);return h.z=c.z,h},_pxBoundsToTileRange:function(c){var h=this.getTileSize();return new ne(c.min.unscaleBy(h).floor(),c.max.unscaleBy(h).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var c in this._tiles)if(!this._tiles[c].loaded)return!1;return!0}});function G$(c){return new Ih(c)}var su=Ih.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(c,h){this._url=c,h=y(this,h),h.detectRetina&&Re.retina&&h.maxZoom>0?(h.tileSize=Math.floor(h.tileSize/2),h.zoomReverse?(h.zoomOffset--,h.minZoom=Math.min(h.maxZoom,h.minZoom+1)):(h.zoomOffset++,h.maxZoom=Math.max(h.minZoom,h.maxZoom-1)),h.minZoom=Math.max(0,h.minZoom)):h.zoomReverse?h.minZoom=Math.min(h.maxZoom,h.minZoom):h.maxZoom=Math.max(h.minZoom,h.maxZoom),typeof h.subdomains=="string"&&(h.subdomains=h.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(c,h){return this._url===c&&h===void 0&&(h=!0),this._url=c,h||this.redraw(),this},createTile:function(c,h){var g=document.createElement("img");return Ke(g,"load",r(this._tileOnLoad,this,h,g)),Ke(g,"error",r(this._tileOnError,this,h,g)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(g.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(g.referrerPolicy=this.options.referrerPolicy),g.alt="",g.src=this.getTileUrl(c),g},getTileUrl:function(c){var h={r:Re.retina?"@2x":"",s:this._getSubdomain(c),x:c.x,y:c.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var g=this._globalTileRange.max.y-c.y;this.options.tms&&(h.y=g),h["-y"]=g}return T(this._url,t(h,this.options))},_tileOnLoad:function(c,h){Re.ielt9?setTimeout(r(c,this,null,h),0):c(null,h)},_tileOnError:function(c,h,g){var _=this.options.errorTileUrl;_&&h.getAttribute("src")!==_&&(h.src=_),c(g,h)},_onTileRemove:function(c){c.tile.onload=null},_getZoomForUrl:function(){var c=this._tileZoom,h=this.options.maxZoom,g=this.options.zoomReverse,_=this.options.zoomOffset;return g&&(c=h-c),c+_},_getSubdomain:function(c){var h=Math.abs(c.x+c.y)%this.options.subdomains.length;return this.options.subdomains[h]},_abortLoading:function(){var c,h;for(c in this._tiles)if(this._tiles[c].coords.z!==this._tileZoom&&(h=this._tiles[c].el,h.onload=u,h.onerror=u,!h.complete)){h.src=P;var g=this._tiles[c].coords;Xt(h),delete this._tiles[c],this.fire("tileabort",{tile:h,coords:g})}},_removeTile:function(c){var h=this._tiles[c];if(h)return h.el.setAttribute("src",P),Ih.prototype._removeTile.call(this,c)},_tileReady:function(c,h,g){if(!(!this._map||g&&g.getAttribute("src")===P))return Ih.prototype._tileReady.call(this,c,h,g)}});function g1(c,h){return new su(c,h)}var y1=su.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(c,h){this._url=c;var g=t({},this.defaultWmsParams);for(var _ in h)_ in this.options||(g[_]=h[_]);h=y(this,h);var I=h.detectRetina&&Re.retina?2:1,k=this.getTileSize();g.width=k.x*I,g.height=k.y*I,this.wmsParams=g},onAdd:function(c){this._crs=this.options.crs||c.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var h=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[h]=this._crs.code,su.prototype.onAdd.call(this,c)},getTileUrl:function(c){var h=this._tileCoordsToNwSe(c),g=this._crs,_=ye(g.project(h[0]),g.project(h[1])),I=_.min,k=_.max,z=(this._wmsVersion>=1.3&&this._crs===ee?[I.y,I.x,k.y,k.x]:[I.x,I.y,k.x,k.y]).join(","),Z=su.prototype.getTileUrl.call(this,c);return Z+v(this.wmsParams,Z,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+z},setParams:function(c,h){return t(this.wmsParams,c),h||this.redraw(),this}});function z$(c,h){return new y1(c,h)}su.WMS=y1,g1.wms=z$;var uo=ut.extend({options:{padding:.1},initialize:function(c){y(this,c),o(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Ze(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var c={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(c.zoomanim=this._onAnimZoom),c},_onAnimZoom:function(c){this._updateTransform(c.center,c.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(c,h){var g=this._map.getZoomScale(h,this._zoom),_=this._map.getSize().multiplyBy(.5+this.options.padding),I=this._map.project(this._center,h),k=_.multiplyBy(-g).add(I).subtract(this._map._getNewPixelOrigin(c,h));Re.any3d?ni(this._container,k,g):rn(this._container,k)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var c in this._layers)this._layers[c]._reset()},_onZoomEnd:function(){for(var c in this._layers)this._layers[c]._project()},_updatePaths:function(){for(var c in this._layers)this._layers[c]._update()},_update:function(){var c=this.options.padding,h=this._map.getSize(),g=this._map.containerPointToLayerPoint(h.multiplyBy(-c)).round();this._bounds=new ne(g,g.add(h.multiplyBy(1+c*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),v1=uo.extend({options:{tolerance:0},getEvents:function(){var c=uo.prototype.getEvents.call(this);return c.viewprereset=this._onViewPreReset,c},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){uo.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var c=this._container=document.createElement("canvas");Ke(c,"mousemove",this._onMouseMove,this),Ke(c,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Ke(c,"mouseout",this._handleMouseOut,this),c._leaflet_disable_events=!0,this._ctx=c.getContext("2d")},_destroyContainer:function(){M(this._redrawRequest),delete this._ctx,Xt(this._container),Bt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var c;this._redrawBounds=null;for(var h in this._layers)c=this._layers[h],c._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){uo.prototype._update.call(this);var c=this._bounds,h=this._container,g=c.getSize(),_=Re.retina?2:1;rn(h,c.min),h.width=_*g.x,h.height=_*g.y,h.style.width=g.x+"px",h.style.height=g.y+"px",Re.retina&&this._ctx.scale(2,2),this._ctx.translate(-c.min.x,-c.min.y),this.fire("update")}},_reset:function(){uo.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(c){this._updateDashArray(c),this._layers[o(c)]=c;var h=c._order={layer:c,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=h),this._drawLast=h,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(c){this._requestRedraw(c)},_removePath:function(c){var h=c._order,g=h.next,_=h.prev;g?g.prev=_:this._drawLast=_,_?_.next=g:this._drawFirst=g,delete c._order,delete this._layers[o(c)],this._requestRedraw(c)},_updatePath:function(c){this._extendRedrawBounds(c),c._project(),c._update(),this._requestRedraw(c)},_updateStyle:function(c){this._updateDashArray(c),this._requestRedraw(c)},_updateDashArray:function(c){if(typeof c.options.dashArray=="string"){var h=c.options.dashArray.split(/[, ]+/),g=[],_,I;for(I=0;I<h.length;I++){if(_=Number(h[I]),isNaN(_))return;g.push(_)}c.options._dashArray=g}else c.options._dashArray=c.options.dashArray},_requestRedraw:function(c){this._map&&(this._extendRedrawBounds(c),this._redrawRequest=this._redrawRequest||R(this._redraw,this))},_extendRedrawBounds:function(c){if(c._pxBounds){var h=(c.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ne,this._redrawBounds.extend(c._pxBounds.min.subtract([h,h])),this._redrawBounds.extend(c._pxBounds.max.add([h,h]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var c=this._redrawBounds;if(c){var h=c.getSize();this._ctx.clearRect(c.min.x,c.min.y,h.x,h.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var c,h=this._redrawBounds;if(this._ctx.save(),h){var g=h.getSize();this._ctx.beginPath(),this._ctx.rect(h.min.x,h.min.y,g.x,g.y),this._ctx.clip()}this._drawing=!0;for(var _=this._drawFirst;_;_=_.next)c=_.layer,(!h||c._pxBounds&&c._pxBounds.intersects(h))&&c._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(c,h){if(this._drawing){var g,_,I,k,z=c._parts,Z=z.length,J=this._ctx;if(Z){for(J.beginPath(),g=0;g<Z;g++){for(_=0,I=z[g].length;_<I;_++)k=z[g][_],J[_?"lineTo":"moveTo"](k.x,k.y);h&&J.closePath()}this._fillStroke(J,c)}}},_updateCircle:function(c){if(!(!this._drawing||c._empty())){var h=c._point,g=this._ctx,_=Math.max(Math.round(c._radius),1),I=(Math.max(Math.round(c._radiusY),1)||_)/_;I!==1&&(g.save(),g.scale(1,I)),g.beginPath(),g.arc(h.x,h.y/I,_,0,Math.PI*2,!1),I!==1&&g.restore(),this._fillStroke(g,c)}},_fillStroke:function(c,h){var g=h.options;g.fill&&(c.globalAlpha=g.fillOpacity,c.fillStyle=g.fillColor||g.color,c.fill(g.fillRule||"evenodd")),g.stroke&&g.weight!==0&&(c.setLineDash&&c.setLineDash(h.options&&h.options._dashArray||[]),c.globalAlpha=g.opacity,c.lineWidth=g.weight,c.strokeStyle=g.color,c.lineCap=g.lineCap,c.lineJoin=g.lineJoin,c.stroke())},_onClick:function(c){for(var h=this._map.mouseEventToLayerPoint(c),g,_,I=this._drawFirst;I;I=I.next)g=I.layer,g.options.interactive&&g._containsPoint(h)&&(!(c.type==="click"||c.type==="preclick")||!this._map._draggableMoved(g))&&(_=g);this._fireEvent(_?[_]:!1,c)},_onMouseMove:function(c){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var h=this._map.mouseEventToLayerPoint(c);this._handleMouseHover(c,h)}},_handleMouseOut:function(c){var h=this._hoveredLayer;h&&(un(this._container,"leaflet-interactive"),this._fireEvent([h],c,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(c,h){if(!this._mouseHoverThrottled){for(var g,_,I=this._drawFirst;I;I=I.next)g=I.layer,g.options.interactive&&g._containsPoint(h)&&(_=g);_!==this._hoveredLayer&&(this._handleMouseOut(c),_&&(Ze(this._container,"leaflet-interactive"),this._fireEvent([_],c,"mouseover"),this._hoveredLayer=_)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,c),this._mouseHoverThrottled=!0,setTimeout(r(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(c,h,g){this._map._fireDOMEvent(h,g||h.type,c)},_bringToFront:function(c){var h=c._order;if(h){var g=h.next,_=h.prev;if(g)g.prev=_;else return;_?_.next=g:g&&(this._drawFirst=g),h.prev=this._drawLast,this._drawLast.next=h,h.next=null,this._drawLast=h,this._requestRedraw(c)}},_bringToBack:function(c){var h=c._order;if(h){var g=h.next,_=h.prev;if(_)_.next=g;else return;g?g.prev=_:_&&(this._drawLast=_),h.prev=null,h.next=this._drawFirst,this._drawFirst.prev=h,this._drawFirst=h,this._requestRedraw(c)}}});function _1(c){return Re.canvas?new v1(c):null}var bh=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(c){return document.createElement("<lvml:"+c+' class="lvml">')}}catch{}return function(c){return document.createElement("<"+c+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),H$={_initContainer:function(){this._container=Et("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(uo.prototype._update.call(this),this.fire("update"))},_initPath:function(c){var h=c._container=bh("shape");Ze(h,"leaflet-vml-shape "+(this.options.className||"")),h.coordsize="1 1",c._path=bh("path"),h.appendChild(c._path),this._updateStyle(c),this._layers[o(c)]=c},_addPath:function(c){var h=c._container;this._container.appendChild(h),c.options.interactive&&c.addInteractiveTarget(h)},_removePath:function(c){var h=c._container;Xt(h),c.removeInteractiveTarget(h),delete this._layers[o(c)]},_updateStyle:function(c){var h=c._stroke,g=c._fill,_=c.options,I=c._container;I.stroked=!!_.stroke,I.filled=!!_.fill,_.stroke?(h||(h=c._stroke=bh("stroke")),I.appendChild(h),h.weight=_.weight+"px",h.color=_.color,h.opacity=_.opacity,_.dashArray?h.dashStyle=C(_.dashArray)?_.dashArray.join(" "):_.dashArray.replace(/( *, *)/g," "):h.dashStyle="",h.endcap=_.lineCap.replace("butt","flat"),h.joinstyle=_.lineJoin):h&&(I.removeChild(h),c._stroke=null),_.fill?(g||(g=c._fill=bh("fill")),I.appendChild(g),g.color=_.fillColor||_.color,g.opacity=_.fillOpacity):g&&(I.removeChild(g),c._fill=null)},_updateCircle:function(c){var h=c._point.round(),g=Math.round(c._radius),_=Math.round(c._radiusY||g);this._setPath(c,c._empty()?"M0 0":"AL "+h.x+","+h.y+" "+g+","+_+" 0,"+65535*360)},_setPath:function(c,h){c._path.v=h},_bringToFront:function(c){hs(c._container)},_bringToBack:function(c){fs(c._container)}},Am=Re.vml?bh:as,Sh=uo.extend({_initContainer:function(){this._container=Am("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Am("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Xt(this._container),Bt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){uo.prototype._update.call(this);var c=this._bounds,h=c.getSize(),g=this._container;(!this._svgSize||!this._svgSize.equals(h))&&(this._svgSize=h,g.setAttribute("width",h.x),g.setAttribute("height",h.y)),rn(g,c.min),g.setAttribute("viewBox",[c.min.x,c.min.y,h.x,h.y].join(" ")),this.fire("update")}},_initPath:function(c){var h=c._path=Am("path");c.options.className&&Ze(h,c.options.className),c.options.interactive&&Ze(h,"leaflet-interactive"),this._updateStyle(c),this._layers[o(c)]=c},_addPath:function(c){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(c._path),c.addInteractiveTarget(c._path)},_removePath:function(c){Xt(c._path),c.removeInteractiveTarget(c._path),delete this._layers[o(c)]},_updatePath:function(c){c._project(),c._update()},_updateStyle:function(c){var h=c._path,g=c.options;h&&(g.stroke?(h.setAttribute("stroke",g.color),h.setAttribute("stroke-opacity",g.opacity),h.setAttribute("stroke-width",g.weight),h.setAttribute("stroke-linecap",g.lineCap),h.setAttribute("stroke-linejoin",g.lineJoin),g.dashArray?h.setAttribute("stroke-dasharray",g.dashArray):h.removeAttribute("stroke-dasharray"),g.dashOffset?h.setAttribute("stroke-dashoffset",g.dashOffset):h.removeAttribute("stroke-dashoffset")):h.setAttribute("stroke","none"),g.fill?(h.setAttribute("fill",g.fillColor||g.color),h.setAttribute("fill-opacity",g.fillOpacity),h.setAttribute("fill-rule",g.fillRule||"evenodd")):h.setAttribute("fill","none"))},_updatePoly:function(c,h){this._setPath(c,ls(c._parts,h))},_updateCircle:function(c){var h=c._point,g=Math.max(Math.round(c._radius),1),_=Math.max(Math.round(c._radiusY),1)||g,I="a"+g+","+_+" 0 1,0 ",k=c._empty()?"M0 0":"M"+(h.x-g)+","+h.y+I+g*2+",0 "+I+-g*2+",0 ";this._setPath(c,k)},_setPath:function(c,h){c._path.setAttribute("d",h)},_bringToFront:function(c){hs(c._path)},_bringToBack:function(c){fs(c._path)}});Re.vml&&Sh.include(H$);function E1(c){return Re.svg||Re.vml?new Sh(c):null}gt.include({getRenderer:function(c){var h=c.options.renderer||this._getPaneRenderer(c.options.pane)||this.options.renderer||this._renderer;return h||(h=this._renderer=this._createRenderer()),this.hasLayer(h)||this.addLayer(h),h},_getPaneRenderer:function(c){if(c==="overlayPane"||c===void 0)return!1;var h=this._paneRenderers[c];return h===void 0&&(h=this._createRenderer({pane:c}),this._paneRenderers[c]=h),h},_createRenderer:function(c){return this.options.preferCanvas&&_1(c)||E1(c)}});var T1=iu.extend({initialize:function(c,h){iu.prototype.initialize.call(this,this._boundsToLatLngs(c),h)},setBounds:function(c){return this.setLatLngs(this._boundsToLatLngs(c))},_boundsToLatLngs:function(c){return c=ie(c),[c.getSouthWest(),c.getNorthWest(),c.getNorthEast(),c.getSouthEast()]}});function q$(c,h){return new T1(c,h)}Sh.create=Am,Sh.pointsToPath=ls,co.geometryToLayer=Tm,co.coordsToLatLng=rE,co.coordsToLatLngs=wm,co.latLngToCoords=sE,co.latLngsToCoords=Im,co.getFeature=ru,co.asFeature=bm,gt.mergeOptions({boxZoom:!0});var w1=Wi.extend({initialize:function(c){this._map=c,this._container=c._container,this._pane=c._panes.overlayPane,this._resetStateTimeout=0,c.on("unload",this._destroy,this)},addHooks:function(){Ke(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Bt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Xt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(c){if(!c.shiftKey||c.which!==1&&c.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),ra(),io(),this._startPoint=this._map.mouseEventToContainerPoint(c),Ke(document,{contextmenu:Tr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(c){this._moved||(this._moved=!0,this._box=Et("div","leaflet-zoom-box",this._container),Ze(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(c);var h=new ne(this._point,this._startPoint),g=h.getSize();rn(this._box,h.min),this._box.style.width=g.x+"px",this._box.style.height=g.y+"px"},_finish:function(){this._moved&&(Xt(this._box),un(this._container,"leaflet-crosshair")),Lt(),lh(),Bt(document,{contextmenu:Tr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(c){if(!(c.which!==1&&c.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(r(this._resetState,this),0);var h=new oe(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(h).fire("boxzoomend",{boxZoomBounds:h})}},_onKeyDown:function(c){c.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});gt.addInitHook("addHandler","boxZoom",w1),gt.mergeOptions({doubleClickZoom:!0});var I1=Wi.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(c){var h=this._map,g=h.getZoom(),_=h.options.zoomDelta,I=c.originalEvent.shiftKey?g-_:g+_;h.options.doubleClickZoom==="center"?h.setZoom(I):h.setZoomAround(c.containerPoint,I)}});gt.addInitHook("addHandler","doubleClickZoom",I1),gt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var b1=Wi.extend({addHooks:function(){if(!this._draggable){var c=this._map;this._draggable=new jr(c._mapPane,c._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),c.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),c.on("zoomend",this._onZoomEnd,this),c.whenReady(this._onZoomEnd,this))}Ze(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){un(this._map._container,"leaflet-grab"),un(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var c=this._map;if(c._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var h=ie(this._map.options.maxBounds);this._offsetLimit=ye(this._map.latLngToContainerPoint(h.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(h.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;c.fire("movestart").fire("dragstart"),c.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(c){if(this._map.options.inertia){var h=this._lastTime=+new Date,g=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(g),this._times.push(h),this._prunePositions(h)}this._map.fire("move",c).fire("drag",c)},_prunePositions:function(c){for(;this._positions.length>1&&c-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var c=this._map.getSize().divideBy(2),h=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=h.subtract(c).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(c,h){return c-(c-h)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var c=this._draggable._newPos.subtract(this._draggable._startPos),h=this._offsetLimit;c.x<h.min.x&&(c.x=this._viscousLimit(c.x,h.min.x)),c.y<h.min.y&&(c.y=this._viscousLimit(c.y,h.min.y)),c.x>h.max.x&&(c.x=this._viscousLimit(c.x,h.max.x)),c.y>h.max.y&&(c.y=this._viscousLimit(c.y,h.max.y)),this._draggable._newPos=this._draggable._startPos.add(c)}},_onPreDragWrap:function(){var c=this._worldWidth,h=Math.round(c/2),g=this._initialWorldOffset,_=this._draggable._newPos.x,I=(_-h+g)%c+h-g,k=(_+h+g)%c-h-g,z=Math.abs(I+g)<Math.abs(k+g)?I:k;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=z},_onDragEnd:function(c){var h=this._map,g=h.options,_=!g.inertia||c.noInertia||this._times.length<2;if(h.fire("dragend",c),_)h.fire("moveend");else{this._prunePositions(+new Date);var I=this._lastPos.subtract(this._positions[0]),k=(this._lastTime-this._times[0])/1e3,z=g.easeLinearity,Z=I.multiplyBy(z/k),J=Z.distanceTo([0,0]),ae=Math.min(g.inertiaMaxSpeed,J),be=Z.multiplyBy(ae/J),$e=ae/(g.inertiaDeceleration*z),ft=be.multiplyBy(-$e/2).round();!ft.x&&!ft.y?h.fire("moveend"):(ft=h._limitOffset(ft,h.options.maxBounds),R(function(){h.panBy(ft,{duration:$e,easeLinearity:z,noMoveStart:!0,animate:!0})}))}}});gt.addInitHook("addHandler","dragging",b1),gt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var S1=Wi.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(c){this._map=c,this._setPanDelta(c.options.keyboardPanDelta),this._setZoomDelta(c.options.zoomDelta)},addHooks:function(){var c=this._map._container;c.tabIndex<=0&&(c.tabIndex="0"),Ke(c,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Bt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var c=document.body,h=document.documentElement,g=c.scrollTop||h.scrollTop,_=c.scrollLeft||h.scrollLeft;this._map._container.focus(),window.scrollTo(_,g)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(c){var h=this._panKeys={},g=this.keyCodes,_,I;for(_=0,I=g.left.length;_<I;_++)h[g.left[_]]=[-1*c,0];for(_=0,I=g.right.length;_<I;_++)h[g.right[_]]=[c,0];for(_=0,I=g.down.length;_<I;_++)h[g.down[_]]=[0,c];for(_=0,I=g.up.length;_<I;_++)h[g.up[_]]=[0,-1*c]},_setZoomDelta:function(c){var h=this._zoomKeys={},g=this.keyCodes,_,I;for(_=0,I=g.zoomIn.length;_<I;_++)h[g.zoomIn[_]]=c;for(_=0,I=g.zoomOut.length;_<I;_++)h[g.zoomOut[_]]=-c},_addHooks:function(){Ke(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Bt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(c){if(!(c.altKey||c.ctrlKey||c.metaKey)){var h=c.keyCode,g=this._map,_;if(h in this._panKeys){if(!g._panAnim||!g._panAnim._inProgress)if(_=this._panKeys[h],c.shiftKey&&(_=W(_).multiplyBy(3)),g.options.maxBounds&&(_=g._limitOffset(W(_),g.options.maxBounds)),g.options.worldCopyJump){var I=g.wrapLatLng(g.unproject(g.project(g.getCenter()).add(_)));g.panTo(I)}else g.panBy(_)}else if(h in this._zoomKeys)g.setZoom(g.getZoom()+(c.shiftKey?3:1)*this._zoomKeys[h]);else if(h===27&&g._popup&&g._popup.options.closeOnEscapeKey)g.closePopup();else return;Tr(c)}}});gt.addInitHook("addHandler","keyboard",S1),gt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var C1=Wi.extend({addHooks:function(){Ke(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Bt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(c){var h=gh(c),g=this._map.options.wheelDebounceTime;this._delta+=h,this._lastMousePos=this._map.mouseEventToContainerPoint(c),this._startTime||(this._startTime=+new Date);var _=Math.max(g-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(r(this._performZoom,this),_),Tr(c)},_performZoom:function(){var c=this._map,h=c.getZoom(),g=this._map.options.zoomSnap||0;c._stop();var _=this._delta/(this._map.options.wheelPxPerZoomLevel*4),I=4*Math.log(2/(1+Math.exp(-Math.abs(_))))/Math.LN2,k=g?Math.ceil(I/g)*g:I,z=c._limitZoom(h+(this._delta>0?k:-k))-h;this._delta=0,this._startTime=null,z&&(c.options.scrollWheelZoom==="center"?c.setZoom(h+z):c.setZoomAround(this._lastMousePos,h+z))}});gt.addInitHook("addHandler","scrollWheelZoom",C1);var W$=600;gt.mergeOptions({tapHold:Re.touchNative&&Re.safari&&Re.mobile,tapTolerance:15});var x1=Wi.extend({addHooks:function(){Ke(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Bt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(c){if(clearTimeout(this._holdTimeout),c.touches.length===1){var h=c.touches[0];this._startPos=this._newPos=new q(h.clientX,h.clientY),this._holdTimeout=setTimeout(r(function(){this._cancel(),this._isTapValid()&&(Ke(document,"touchend",dn),Ke(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",h))},this),W$),Ke(document,"touchend touchcancel contextmenu",this._cancel,this),Ke(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function c(){Bt(document,"touchend",dn),Bt(document,"touchend touchcancel",c)},_cancel:function(){clearTimeout(this._holdTimeout),Bt(document,"touchend touchcancel contextmenu",this._cancel,this),Bt(document,"touchmove",this._onMove,this)},_onMove:function(c){var h=c.touches[0];this._newPos=new q(h.clientX,h.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(c,h){var g=new MouseEvent(c,{bubbles:!0,cancelable:!0,view:window,screenX:h.screenX,screenY:h.screenY,clientX:h.clientX,clientY:h.clientY});g._simulated=!0,h.target.dispatchEvent(g)}});gt.addInitHook("addHandler","tapHold",x1),gt.mergeOptions({touchZoom:Re.touch,bounceAtZoomLimits:!0});var A1=Wi.extend({addHooks:function(){Ze(this._map._container,"leaflet-touch-zoom"),Ke(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){un(this._map._container,"leaflet-touch-zoom"),Bt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(c){var h=this._map;if(!(!c.touches||c.touches.length!==2||h._animatingZoom||this._zooming)){var g=h.mouseEventToContainerPoint(c.touches[0]),_=h.mouseEventToContainerPoint(c.touches[1]);this._centerPoint=h.getSize()._divideBy(2),this._startLatLng=h.containerPointToLatLng(this._centerPoint),h.options.touchZoom!=="center"&&(this._pinchStartLatLng=h.containerPointToLatLng(g.add(_)._divideBy(2))),this._startDist=g.distanceTo(_),this._startZoom=h.getZoom(),this._moved=!1,this._zooming=!0,h._stop(),Ke(document,"touchmove",this._onTouchMove,this),Ke(document,"touchend touchcancel",this._onTouchEnd,this),dn(c)}},_onTouchMove:function(c){if(!(!c.touches||c.touches.length!==2||!this._zooming)){var h=this._map,g=h.mouseEventToContainerPoint(c.touches[0]),_=h.mouseEventToContainerPoint(c.touches[1]),I=g.distanceTo(_)/this._startDist;if(this._zoom=h.getScaleZoom(I,this._startZoom),!h.options.bounceAtZoomLimits&&(this._zoom<h.getMinZoom()&&I<1||this._zoom>h.getMaxZoom()&&I>1)&&(this._zoom=h._limitZoom(this._zoom)),h.options.touchZoom==="center"){if(this._center=this._startLatLng,I===1)return}else{var k=g._add(_)._divideBy(2)._subtract(this._centerPoint);if(I===1&&k.x===0&&k.y===0)return;this._center=h.unproject(h.project(this._pinchStartLatLng,this._zoom).subtract(k),this._zoom)}this._moved||(h._moveStart(!0,!1),this._moved=!0),M(this._animRequest);var z=r(h._move,h,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=R(z,this,!0),dn(c)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,M(this._animRequest),Bt(document,"touchmove",this._onTouchMove,this),Bt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});gt.addInitHook("addHandler","touchZoom",A1),gt.BoxZoom=w1,gt.DoubleClickZoom=I1,gt.Drag=b1,gt.Keyboard=S1,gt.ScrollWheelZoom=C1,gt.TapHold=x1,gt.TouchZoom=A1,n.Bounds=ne,n.Browser=Re,n.CRS=Ne,n.Canvas=v1,n.Circle=iE,n.CircleMarker=Em,n.Class=j,n.Control=Ai,n.DivIcon=m1,n.DivOverlay=ys,n.DomEvent=on,n.DomUtil=ps,n.Draggable=jr,n.Evented=Ee,n.FeatureGroup=Jt,n.GeoJSON=co,n.GridLayer=Ih,n.Handler=Wi,n.Icon=Ki,n.ImageOverlay=Sm,n.LatLng=de,n.LatLngBounds=oe,n.Layer=ut,n.LayerGroup=an,n.LineUtil=p,n.Map=gt,n.Marker=_m,n.Mixin=Qc,n.Path=ca,n.Point=q,n.PolyUtil=vh,n.Polygon=iu,n.Polyline=lo,n.Popup=Cm,n.PosAnimation=dm,n.Projection=O,n.Rectangle=T1,n.Renderer=uo,n.SVG=Sh,n.SVGOverlay=p1,n.TileLayer=su,n.Tooltip=xm,n.Transformation=kt,n.Util=F,n.VideoOverlay=f1,n.bind=r,n.bounds=ye,n.canvas=_1,n.circle=k$,n.circleMarker=M$,n.control=aa,n.divIcon=j$,n.extend=t,n.featureGroup=Gn,n.geoJSON=h1,n.geoJson=N$,n.gridLayer=G$,n.icon=Yi,n.imageOverlay=F$,n.latLng=he,n.latLngBounds=ie,n.layerGroup=wt,n.map=hm,n.marker=R$,n.point=W,n.polygon=O$,n.polyline=L$,n.popup=U$,n.rectangle=q$,n.setOptions=y,n.stamp=o,n.svg=E1,n.svgOverlay=B$,n.tileLayer=g1,n.tooltip=$$,n.transformation=Zt,n.version=e,n.videoOverlay=V$;var K$=window.L;n.noConflict=function(){return window.L=K$,this},window.L=n})});function O1(n,e){return Object.is(n,e)}var Nn=null,Rm=!1,Mm=1,ho=Symbol("SIGNAL");function St(n){let e=Nn;return Nn=n,e}function N1(){return Nn}var xh={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function fE(n){if(Rm)throw new Error("");if(Nn===null)return;Nn.consumerOnSignalRead(n);let e=Nn.nextProducerIndex++;if(Nm(Nn),e<Nn.producerNode.length&&Nn.producerNode[e]!==n&&Ch(Nn)){let t=Nn.producerNode[e];Om(t,Nn.producerIndexOfThis[e])}Nn.producerNode[e]!==n&&(Nn.producerNode[e]=n,Nn.producerIndexOfThis[e]=Ch(Nn)?U1(n,Nn,e):0),Nn.producerLastReadVersion[e]=n.version}function h3(){Mm++}function F1(n){if(!(Ch(n)&&!n.dirty)&&!(!n.dirty&&n.lastCleanEpoch===Mm)){if(!n.producerMustRecompute(n)&&!mE(n)){n.dirty=!1,n.lastCleanEpoch=Mm;return}n.producerRecomputeValue(n),n.dirty=!1,n.lastCleanEpoch=Mm}}function V1(n){if(n.liveConsumerNode===void 0)return;let e=Rm;Rm=!0;try{for(let t of n.liveConsumerNode)t.dirty||f3(t)}finally{Rm=e}}function B1(){return Nn?.consumerAllowSignalWrites!==!1}function f3(n){n.dirty=!0,V1(n),n.consumerMarkedDirty?.(n)}function Lm(n){return n&&(n.nextProducerIndex=0),St(n)}function pE(n,e){if(St(e),!(!n||n.producerNode===void 0||n.producerIndexOfThis===void 0||n.producerLastReadVersion===void 0)){if(Ch(n))for(let t=n.nextProducerIndex;t<n.producerNode.length;t++)Om(n.producerNode[t],n.producerIndexOfThis[t]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function mE(n){Nm(n);for(let e=0;e<n.producerNode.length;e++){let t=n.producerNode[e],i=n.producerLastReadVersion[e];if(i!==t.version||(F1(t),i!==t.version))return!0}return!1}function gE(n){if(Nm(n),Ch(n))for(let e=0;e<n.producerNode.length;e++)Om(n.producerNode[e],n.producerIndexOfThis[e]);n.producerNode.length=n.producerLastReadVersion.length=n.producerIndexOfThis.length=0,n.liveConsumerNode&&(n.liveConsumerNode.length=n.liveConsumerIndexOfThis.length=0)}function U1(n,e,t){if($1(n),n.liveConsumerNode.length===0&&j1(n))for(let i=0;i<n.producerNode.length;i++)n.producerIndexOfThis[i]=U1(n.producerNode[i],n,i);return n.liveConsumerIndexOfThis.push(t),n.liveConsumerNode.push(e)-1}function Om(n,e){if($1(n),n.liveConsumerNode.length===1&&j1(n))for(let i=0;i<n.producerNode.length;i++)Om(n.producerNode[i],n.producerIndexOfThis[i]);let t=n.liveConsumerNode.length-1;if(n.liveConsumerNode[e]=n.liveConsumerNode[t],n.liveConsumerIndexOfThis[e]=n.liveConsumerIndexOfThis[t],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,e<n.liveConsumerNode.length){let i=n.liveConsumerIndexOfThis[e],r=n.liveConsumerNode[e];Nm(r),r.producerIndexOfThis[i]=e}}function Ch(n){return n.consumerIsAlwaysLive||(n?.liveConsumerNode?.length??0)>0}function Nm(n){n.producerNode??=[],n.producerIndexOfThis??=[],n.producerLastReadVersion??=[]}function $1(n){n.liveConsumerNode??=[],n.liveConsumerIndexOfThis??=[]}function j1(n){return n.producerNode!==void 0}function G1(n){let e=Object.create(p3);e.computation=n;let t=()=>{if(F1(e),fE(e),e.value===km)throw e.error;return e.value};return t[ho]=e,t}var dE=Symbol("UNSET"),hE=Symbol("COMPUTING"),km=Symbol("ERRORED"),p3=Ye(ue({},xh),{value:dE,dirty:!0,error:null,equal:O1,producerMustRecompute(n){return n.value===dE||n.value===hE},producerRecomputeValue(n){if(n.value===hE)throw new Error("Detected cycle in computations.");let e=n.value;n.value=hE;let t=Lm(n),i;try{i=n.computation()}catch(r){i=km,n.error=r}finally{pE(n,t)}if(e!==dE&&e!==km&&i!==km&&n.equal(e,i)){n.value=e;return}n.value=i,n.version++}});function m3(){throw new Error}var z1=m3;function H1(){z1()}function q1(n){z1=n}var g3=null;function W1(n){let e=Object.create(Y1);e.value=n;let t=()=>(fE(e),e.value);return t[ho]=e,t}function yE(n,e){B1()||H1(),n.equal(n.value,e)||(n.value=e,y3(n))}function K1(n,e){B1()||H1(),yE(n,e(n.value))}var Y1=Ye(ue({},xh),{equal:O1,value:void 0});function y3(n){n.version++,h3(),V1(n),g3?.()}function Xe(n){return typeof n=="function"}function au(n){let t=n(i=>{Error.call(i),i.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Fm=au(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:
${t.map((i,r)=>`${r+1}) ${i.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=t});function Al(n,e){if(n){let t=n.indexOf(e);0<=t&&n.splice(t,1)}}var pn=class n{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(let s of t)s.remove(this);else t.remove(this);let{initialTeardown:i}=this;if(Xe(i))try{i()}catch(s){e=s instanceof Fm?s.errors:[s]}let{_finalizers:r}=this;if(r){this._finalizers=null;for(let s of r)try{Q1(s)}catch(o){e=e??[],o instanceof Fm?e=[...e,...o.errors]:e.push(o)}}if(e)throw new Fm(e)}}add(e){var t;if(e&&e!==this)if(this.closed)Q1(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}}_hasParent(e){let{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){let{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){let{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&Al(t,e)}remove(e){let{_finalizers:t}=this;t&&Al(t,e),e instanceof n&&e._removeParent(this)}};pn.EMPTY=(()=>{let n=new pn;return n.closed=!0,n})();var vE=pn.EMPTY;function Vm(n){return n instanceof pn||n&&"closed"in n&&Xe(n.remove)&&Xe(n.add)&&Xe(n.unsubscribe)}function Q1(n){Xe(n)?n():n.unsubscribe()}var Gr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var lu={setTimeout(n,e,...t){let{delegate:i}=lu;return i?.setTimeout?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){let{delegate:e}=lu;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function Bm(n){lu.setTimeout(()=>{let{onUnhandledError:e}=Gr;if(e)e(n);else throw n})}function Ah(){}var Z1=_E("C",void 0,void 0);function X1(n){return _E("E",void 0,n)}function J1(n){return _E("N",n,void 0)}function _E(n,e,t){return{kind:n,value:e,error:t}}var Dl=null;function cu(n){if(Gr.useDeprecatedSynchronousErrorHandling){let e=!Dl;if(e&&(Dl={errorThrown:!1,error:null}),n(),e){let{errorThrown:t,error:i}=Dl;if(Dl=null,t)throw i}}else n()}function eP(n){Gr.useDeprecatedSynchronousErrorHandling&&Dl&&(Dl.errorThrown=!0,Dl.error=n)}var Pl=class extends pn{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Vm(e)&&e.add(this)):this.destination=E3}static create(e,t,i){return new uu(e,t,i)}next(e){this.isStopped?TE(J1(e),this):this._next(e)}error(e){this.isStopped?TE(X1(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?TE(Z1,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},v3=Function.prototype.bind;function EE(n,e){return v3.call(n,e)}var wE=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){Um(i)}}error(e){let{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){Um(i)}else Um(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){Um(t)}}},uu=class extends Pl{constructor(e,t,i){super();let r;if(Xe(e)||!e)r={next:e??void 0,error:t??void 0,complete:i??void 0};else{let s;this&&Gr.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&EE(e.next,s),error:e.error&&EE(e.error,s),complete:e.complete&&EE(e.complete,s)}):r=e}this.destination=new wE(r)}};function Um(n){Gr.useDeprecatedSynchronousErrorHandling?eP(n):Bm(n)}function _3(n){throw n}function TE(n,e){let{onStoppedNotification:t}=Gr;t&&lu.setTimeout(()=>t(n,e))}var E3={closed:!0,next:Ah,error:_3,complete:Ah};var du=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Qi(n){return n}function IE(...n){return bE(n)}function bE(n){return n.length===0?Qi:n.length===1?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}}var nt=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){let i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,r){let s=w3(t)?t:new uu(t,i,r);return cu(()=>{let{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return i=tP(i),new i((r,s)=>{let o=new uu({next:a=>{try{t(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:r});this.subscribe(o)})}_subscribe(t){var i;return(i=this.source)===null||i===void 0?void 0:i.subscribe(t)}[du](){return this}pipe(...t){return bE(t)(this)}toPromise(t){return t=tP(t),new t((i,r)=>{let s;this.subscribe(o=>s=o,o=>r(o),()=>i(s))})}}return n.create=e=>new n(e),n})();function tP(n){var e;return(e=n??Gr.Promise)!==null&&e!==void 0?e:Promise}function T3(n){return n&&Xe(n.next)&&Xe(n.error)&&Xe(n.complete)}function w3(n){return n&&n instanceof Pl||T3(n)&&Vm(n)}function SE(n){return Xe(n?.lift)}function It(n){return e=>{if(SE(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function yt(n,e,t,i,r){return new CE(n,e,t,i,r)}var CE=class extends Pl{constructor(e,t,i,r,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(l){e.error(l)}}:super._next,this._error=r?function(a){try{r(a)}catch(l){e.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:t}=this;super.unsubscribe(),!t&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};function hu(){return It((n,e)=>{let t=null;n._refCount++;let i=yt(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount){t=null;return}let r=n._connection,s=t;t=null,r&&(!s||r===s)&&r.unsubscribe(),e.unsubscribe()});n.subscribe(i),i.closed||(t=n.connect())})}var fu=class extends nt{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,SE(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){let e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new pn;let t=this.getSubject();e.add(this.source.subscribe(yt(t,void 0,()=>{this._teardown(),t.complete()},i=>{this._teardown(),t.error(i)},()=>this._teardown()))),e.closed&&(this._connection=null,e=pn.EMPTY)}return e}refCount(){return hu()(this)}};var nP=au(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Hn=(()=>{class n extends nt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){let i=new $m(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new nP}next(t){cu(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let i of this.currentObservers)i.next(t)}})}error(t){cu(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;let{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){cu(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){let{hasError:i,isStopped:r,observers:s}=this;return i||r?vE:(this.currentObservers=null,s.push(t),new pn(()=>{this.currentObservers=null,Al(s,t)}))}_checkFinalizedStatuses(t){let{hasError:i,thrownError:r,isStopped:s}=this;i?t.error(r):s&&t.complete()}asObservable(){let t=new nt;return t.source=this,t}}return n.create=(e,t)=>new $m(e,t),n})(),$m=class extends Hn{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.next)===null||i===void 0||i.call(t,e)}error(e){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.error)===null||i===void 0||i.call(t,e)}complete(){var e,t;(t=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||t===void 0||t.call(e)}_subscribe(e){var t,i;return(i=(t=this.source)===null||t===void 0?void 0:t.subscribe(e))!==null&&i!==void 0?i:vE}};var Tn=class extends Hn{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){let{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}};var xE={now(){return(xE.delegate||Date).now()},delegate:void 0};var jm=class extends pn{constructor(e,t){super()}schedule(e,t=0){return this}};var Dh={setInterval(n,e,...t){let{delegate:i}=Dh;return i?.setInterval?i.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){let{delegate:e}=Dh;return(e?.clearInterval||clearInterval)(n)},delegate:void 0};var pu=class extends jm{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var i;if(this.closed)return this;this.state=e;let r=this.id,s=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(s,r,t)),this.pending=!0,this.delay=t,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(s,this.id,t),this}requestAsyncId(e,t,i=0){return Dh.setInterval(e.flush.bind(e,this),i)}recycleAsyncId(e,t,i=0){if(i!=null&&this.delay===i&&this.pending===!1)return t;t!=null&&Dh.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let i=this._execute(e,t);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let i=!1,r;try{this.work(e)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){let{id:e,scheduler:t}=this,{actions:i}=t;this.work=this.state=this.scheduler=null,this.pending=!1,Al(i,this),e!=null&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}};var mu=class n{constructor(e,t=n.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,i){return new this.schedulerActionCtor(this,e).schedule(i,t)}};mu.now=xE.now;var gu=class extends mu{constructor(e,t=mu.now){super(e,t),this.actions=[],this._active=!1}flush(e){let{actions:t}=this;if(this._active){t.push(e);return}let i;this._active=!0;do if(i=e.execute(e.state,e.delay))break;while(e=t.shift());if(this._active=!1,i){for(;e=t.shift();)e.unsubscribe();throw i}}};var AE=new gu(pu);var Gm=class extends pu{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,i=0){return i!=null&&i>0||i==null&&this.delay>0?super.requestAsyncId(e,t,i):(e.flush(this),0)}};var zm=class extends gu{};var DE=new zm(Gm);var Zi=new nt(n=>n.complete());function iP(n){return n&&Xe(n.schedule)}function rP(n){return n[n.length-1]}function Hm(n){return Xe(rP(n))?n.pop():void 0}function da(n){return iP(rP(n))?n.pop():void 0}function PE(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t}function oP(n,e,t,i){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(d){try{u(i.next(d))}catch(f){o(f)}}function l(d){try{u(i.throw(d))}catch(f){o(f)}}function u(d){d.done?s(d.value):r(d.value).then(a,l)}u((i=i.apply(n,e||[])).next())})}function sP(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Rl(n){return this instanceof Rl?(this.v=n,this):new Rl(n)}function aP(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),r,s=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),r[Symbol.asyncIterator]=function(){return this},r;function o(y){return function(v){return Promise.resolve(v).then(y,f)}}function a(y,v){i[y]&&(r[y]=function(E){return new Promise(function(T,C){s.push([y,E,T,C])>1||l(y,E)})},v&&(r[y]=v(r[y])))}function l(y,v){try{u(i[y](v))}catch(E){m(s[0][3],E)}}function u(y){y.value instanceof Rl?Promise.resolve(y.value.v).then(d,f):m(s[0][2],y)}function d(y){l("next",y)}function f(y){l("throw",y)}function m(y,v){y(v),s.shift(),s.length&&l(s[0][0],s[0][1])}}function lP(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof sP=="function"?sP(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(o){return new Promise(function(a,l){o=n[s](o),r(a,l,o.done,o.value)})}}function r(s,o,a,l){Promise.resolve(l).then(function(u){s({value:u,done:a})},o)}}var qm=n=>n&&typeof n.length=="number"&&typeof n!="function";function Wm(n){return Xe(n?.then)}function Km(n){return Xe(n[du])}function Ym(n){return Symbol.asyncIterator&&Xe(n?.[Symbol.asyncIterator])}function Qm(n){return new TypeError(`You provided ${n!==null&&typeof n=="object"?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function I3(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Zm=I3();function Xm(n){return Xe(n?.[Zm])}function Jm(n){return aP(this,arguments,function*(){let t=n.getReader();try{for(;;){let{value:i,done:r}=yield Rl(t.read());if(r)return yield Rl(void 0);yield yield Rl(i)}}finally{t.releaseLock()}})}function eg(n){return Xe(n?.getReader)}function xn(n){if(n instanceof nt)return n;if(n!=null){if(Km(n))return b3(n);if(qm(n))return S3(n);if(Wm(n))return C3(n);if(Ym(n))return cP(n);if(Xm(n))return x3(n);if(eg(n))return A3(n)}throw Qm(n)}function b3(n){return new nt(e=>{let t=n[du]();if(Xe(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function S3(n){return new nt(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function C3(n){return new nt(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,Bm)})}function x3(n){return new nt(e=>{for(let t of n)if(e.next(t),e.closed)return;e.complete()})}function cP(n){return new nt(e=>{D3(n,e).catch(t=>e.error(t))})}function A3(n){return cP(Jm(n))}function D3(n,e){var t,i,r,s;return oP(this,void 0,void 0,function*(){try{for(t=lP(n);i=yield t.next(),!i.done;){let o=i.value;if(e.next(o),e.closed)return}}catch(o){r={error:o}}finally{try{i&&!i.done&&(s=t.return)&&(yield s.call(t))}finally{if(r)throw r.error}}e.complete()})}function Pi(n,e,t,i=0,r=!1){let s=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function ha(n,e=0){return It((t,i)=>{t.subscribe(yt(i,r=>Pi(i,n,()=>i.next(r),e),()=>Pi(i,n,()=>i.complete(),e),r=>Pi(i,n,()=>i.error(r),e)))})}function fa(n,e=0){return It((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function uP(n,e){return xn(n).pipe(fa(e),ha(e))}function dP(n,e){return xn(n).pipe(fa(e),ha(e))}function hP(n,e){return new nt(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}function fP(n,e){return new nt(t=>{let i;return Pi(t,e,()=>{i=n[Zm](),Pi(t,e,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(o){t.error(o);return}s?t.complete():t.next(r)},0,!0)}),()=>Xe(i?.return)&&i.return()})}function tg(n,e){if(!n)throw new Error("Iterable cannot be null");return new nt(t=>{Pi(t,e,()=>{let i=n[Symbol.asyncIterator]();Pi(t,e,()=>{i.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function pP(n,e){return tg(Jm(n),e)}function mP(n,e){if(n!=null){if(Km(n))return uP(n,e);if(qm(n))return hP(n,e);if(Wm(n))return dP(n,e);if(Ym(n))return tg(n,e);if(Xm(n))return fP(n,e);if(eg(n))return pP(n,e)}throw Qm(n)}function en(n,e){return e?mP(n,e):xn(n)}function Ue(...n){let e=da(n);return en(n,e)}function yu(n,e){let t=Xe(n)?n:()=>n,i=r=>r.error(t());return new nt(e?r=>e.schedule(i,0,r):i)}function RE(n){return!!n&&(n instanceof nt||Xe(n.lift)&&Xe(n.subscribe))}var zr=au(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function pa(n,e){let t=typeof e=="object";return new Promise((i,r)=>{let s=!1,o;n.subscribe({next:a=>{o=a,s=!0},error:r,complete:()=>{s?i(o):t?i(e.defaultValue):r(new zr)}})})}function qe(n,e){return It((t,i)=>{let r=0;t.subscribe(yt(i,s=>{i.next(n.call(e,s,r++))}))})}var{isArray:P3}=Array;function R3(n,e){return P3(e)?n(...e):n(e)}function ng(n){return qe(e=>R3(n,e))}var{isArray:M3}=Array,{getPrototypeOf:k3,prototype:L3,keys:O3}=Object;function ig(n){if(n.length===1){let e=n[0];if(M3(e))return{args:e,keys:null};if(N3(e)){let t=O3(e);return{args:t.map(i=>e[i]),keys:t}}}return{args:n,keys:null}}function N3(n){return n&&typeof n=="object"&&k3(n)===L3}function rg(n,e){return n.reduce((t,i,r)=>(t[i]=e[r],t),{})}function Ph(...n){let e=da(n),t=Hm(n),{args:i,keys:r}=ig(n);if(i.length===0)return en([],e);let s=new nt(F3(i,e,r?o=>rg(r,o):Qi));return t?s.pipe(ng(t)):s}function F3(n,e,t=Qi){return i=>{gP(e,()=>{let{length:r}=n,s=new Array(r),o=r,a=r;for(let l=0;l<r;l++)gP(e,()=>{let u=en(n[l],e),d=!1;u.subscribe(yt(i,f=>{s[l]=f,d||(d=!0,a--),a||i.next(t(s.slice()))},()=>{--o||i.complete()}))},i)},i)}}function gP(n,e,t){n?Pi(t,n,e):e()}function yP(n,e,t,i,r,s,o,a){let l=[],u=0,d=0,f=!1,m=()=>{f&&!l.length&&!u&&e.complete()},y=E=>u<i?v(E):l.push(E),v=E=>{s&&e.next(E),u++;let T=!1;xn(t(E,d++)).subscribe(yt(e,C=>{r?.(C),s?y(C):e.next(C)},()=>{T=!0},void 0,()=>{if(T)try{for(u--;l.length&&u<i;){let C=l.shift();o?Pi(e,o,()=>v(C)):v(C)}m()}catch(C){e.error(C)}}))};return n.subscribe(yt(e,y,()=>{f=!0,m()})),()=>{a?.()}}function An(n,e,t=1/0){return Xe(e)?An((i,r)=>qe((s,o)=>e(i,s,r,o))(xn(n(i,r))),t):(typeof e=="number"&&(t=e),It((i,r)=>yP(i,r,n,t)))}function vu(n=1/0){return An(Qi,n)}function vP(){return vu(1)}function _u(...n){return vP()(en(n,da(n)))}function sg(n){return new nt(e=>{xn(n()).subscribe(e)})}function ME(...n){let e=Hm(n),{args:t,keys:i}=ig(n),r=new nt(s=>{let{length:o}=t;if(!o){s.complete();return}let a=new Array(o),l=o,u=o;for(let d=0;d<o;d++){let f=!1;xn(t[d]).subscribe(yt(s,m=>{f||(f=!0,u--),a[d]=m},()=>l--,void 0,()=>{(!l||!f)&&(u||s.next(i?rg(i,a):a),s.complete())}))}});return e?r.pipe(ng(e)):r}function Ri(n,e){return It((t,i)=>{let r=0;t.subscribe(yt(i,s=>n.call(e,s,r++)&&i.next(s)))})}function ma(n){return It((e,t)=>{let i=null,r=!1,s;i=e.subscribe(yt(t,void 0,void 0,o=>{s=xn(n(o,ma(n)(e))),i?(i.unsubscribe(),i=null,s.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(t))})}function _P(n,e,t,i,r){return(s,o)=>{let a=t,l=e,u=0;s.subscribe(yt(o,d=>{let f=u++;l=a?n(l,d,f):(a=!0,d),i&&o.next(l)},r&&(()=>{a&&o.next(l),o.complete()})))}}function fo(n,e){return Xe(e)?An(n,e,1):An(n,1)}function ga(n){return It((e,t)=>{let i=!1;e.subscribe(yt(t,r=>{i=!0,t.next(r)},()=>{i||t.next(n),t.complete()}))})}function po(n){return n<=0?()=>Zi:It((e,t)=>{let i=0;e.subscribe(yt(t,r=>{++i<=n&&(t.next(r),n<=i&&t.complete())}))})}function kE(n){return qe(()=>n)}function og(n=V3){return It((e,t)=>{let i=!1;e.subscribe(yt(t,r=>{i=!0,t.next(r)},()=>i?t.complete():t.error(n())))})}function V3(){return new zr}function Ml(n){return It((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}function vs(n,e){let t=arguments.length>=2;return i=>i.pipe(n?Ri((r,s)=>n(r,s,i)):Qi,po(1),t?ga(e):og(()=>new zr))}function Eu(n){return n<=0?()=>Zi:It((e,t)=>{let i=[];e.subscribe(yt(t,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(let r of i)t.next(r);t.complete()},void 0,()=>{i=null}))})}function LE(n,e){let t=arguments.length>=2;return i=>i.pipe(n?Ri((r,s)=>n(r,s,i)):Qi,Eu(1),t?ga(e):og(()=>new zr))}function OE(n,e){return It(_P(n,e,arguments.length>=2,!0))}function NE(...n){let e=da(n);return It((t,i)=>{(e?_u(n,t,e):_u(n,t)).subscribe(i)})}function Mi(n,e){return It((t,i)=>{let r=null,s=0,o=!1,a=()=>o&&!r&&i.complete();t.subscribe(yt(i,l=>{r?.unsubscribe();let u=0,d=s++;xn(n(l,d)).subscribe(r=yt(i,f=>i.next(e?e(l,f,d,u++):f),()=>{r=null,a()}))},()=>{o=!0,a()}))})}function FE(n){return It((e,t)=>{xn(n).subscribe(yt(t,()=>t.complete(),Ah)),!t.closed&&e.subscribe(t)})}function Dn(n,e,t){let i=Xe(n)||e||t?{next:n,error:e,complete:t}:n;return i?It((r,s)=>{var o;(o=i.subscribe)===null||o===void 0||o.call(i);let a=!0;r.subscribe(yt(s,l=>{var u;(u=i.next)===null||u===void 0||u.call(i,l),s.next(l)},()=>{var l;a=!1,(l=i.complete)===null||l===void 0||l.call(i),s.complete()},l=>{var u;a=!1,(u=i.error)===null||u===void 0||u.call(i,l),s.error(l)},()=>{var l,u;a&&((l=i.unsubscribe)===null||l===void 0||l.call(i)),(u=i.finalize)===null||u===void 0||u.call(i)}))}):Qi}var sR="https://g.co/ng/security#xss",me=class extends Error{constructor(e,t){super(jg(e,t)),this.code=e}};function jg(n,e){return`${`NG0${Math.abs(n)}`}${e?": "+e:""}`}function Bh(n){return{toString:n}.toString()}var ag="__parameters__";function B3(n){return function(...t){if(n){let i=n(...t);for(let r in i)this[r]=i[r]}}}function oR(n,e,t){return Bh(()=>{let i=B3(e);function r(...s){if(this instanceof r)return i.apply(this,s),this;let o=new r(...s);return a.annotation=o,a;function a(l,u,d){let f=l.hasOwnProperty(ag)?l[ag]:Object.defineProperty(l,ag,{value:[]})[ag];for(;f.length<=d;)f.push(null);return(f[d]=f[d]||[]).push(o),l}}return t&&(r.prototype=Object.create(t.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}var Ll=globalThis;function Ht(n){for(let e in n)if(n[e]===Ht)return e;throw Error("Could not find renamed property on target object.")}function U3(n,e){for(let t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function _i(n){if(typeof n=="string")return n;if(Array.isArray(n))return"["+n.map(_i).join(", ")+"]";if(n==null)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;let e=n.toString();if(e==null)return""+e;let t=e.indexOf(`
`);return t===-1?e:e.substring(0,t)}function EP(n,e){return n==null||n===""?e===null?"":e:e==null||e===""?n:n+" "+e}var $3=Ht({__forward_ref__:Ht});function _o(n){return n.__forward_ref__=_o,n.toString=function(){return _i(this())},n}function vi(n){return aR(n)?n():n}function aR(n){return typeof n=="function"&&n.hasOwnProperty($3)&&n.__forward_ref__===_o}function Se(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Ss(n){return{providers:n.providers||[],imports:n.imports||[]}}function Gg(n){return TP(n,cR)||TP(n,uR)}function lR(n){return Gg(n)!==null}function TP(n,e){return n.hasOwnProperty(e)?n[e]:null}function j3(n){let e=n&&(n[cR]||n[uR]);return e||null}function wP(n){return n&&(n.hasOwnProperty(IP)||n.hasOwnProperty(G3))?n[IP]:null}var cR=Ht({\u0275prov:Ht}),IP=Ht({\u0275inj:Ht}),uR=Ht({ngInjectableDef:Ht}),G3=Ht({ngInjectorDef:Ht}),Pe=class{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof t=="number"?this.__NG_ELEMENT_ID__=t:t!==void 0&&(this.\u0275prov=Se({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function dR(n){return n&&!!n.\u0275providers}var z3=Ht({\u0275cmp:Ht}),H3=Ht({\u0275dir:Ht}),q3=Ht({\u0275pipe:Ht}),W3=Ht({\u0275mod:Ht}),vg=Ht({\u0275fac:Ht}),Mh=Ht({__NG_ELEMENT_ID__:Ht}),bP=Ht({__NG_ENV_ID__:Ht});function xu(n){return typeof n=="string"?n:n==null?"":String(n)}function K3(n){return typeof n=="function"?n.name||n.toString():typeof n=="object"&&n!=null&&typeof n.type=="function"?n.type.name||n.type.toString():xu(n)}function Y3(n,e){let t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new me(-200,n)}function YT(n,e){throw new me(-201,!1)}var dt=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(dt||{}),XE;function hR(){return XE}function ki(n){let e=XE;return XE=n,e}function fR(n,e,t){let i=Gg(n);if(i&&i.providedIn=="root")return i.value===void 0?i.value=i.factory():i.value;if(t&dt.Optional)return null;if(e!==void 0)return e;YT(n,"Injector")}var Q3={},kh=Q3,JE="__NG_DI_FLAG__",_g="ngTempTokenPath",Z3="ngTokenPath",X3=/\n/gm,J3="\u0275",SP="__source",Su;function e5(){return Su}function ya(n){let e=Su;return Su=n,e}function t5(n,e=dt.Default){if(Su===void 0)throw new me(-203,!1);return Su===null?fR(n,void 0,e):Su.get(n,e&dt.Optional?null:void 0,e)}function Me(n,e=dt.Default){return(hR()||t5)(vi(n),e)}function le(n,e=dt.Default){return Me(n,zg(e))}function zg(n){return typeof n>"u"||typeof n=="number"?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function eT(n){let e=[];for(let t=0;t<n.length;t++){let i=vi(n[t]);if(Array.isArray(i)){if(i.length===0)throw new me(900,!1);let r,s=dt.Default;for(let o=0;o<i.length;o++){let a=i[o],l=n5(a);typeof l=="number"?l===-1?r=a.token:s|=l:r=a}e.push(Me(r,s))}else e.push(Me(i))}return e}function pR(n,e){return n[JE]=e,n.prototype[JE]=e,n}function n5(n){return n[JE]}function i5(n,e,t,i){let r=n[_g];throw e[SP]&&r.unshift(e[SP]),n.message=r5(`
`+n.message,r,t,i),n[Z3]=r,n[_g]=null,n}function r5(n,e,t,i=null){n=n&&n.charAt(0)===`
`&&n.charAt(1)==J3?n.slice(2):n;let r=_i(e);if(Array.isArray(e))r=e.map(_i).join(" -> ");else if(typeof e=="object"){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+(typeof a=="string"?JSON.stringify(a):_i(a)))}r=`{${s.join(", ")}}`}return`${t}${i?"("+i+")":""}[${r}]: ${n.replace(X3,`
  `)}`}var ci=pR(oR("Optional"),8);var QT=pR(oR("SkipSelf"),4);function Nl(n,e){let t=n.hasOwnProperty(vg);return t?n[vg]:null}function s5(n,e,t){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=e[i];if(t&&(r=t(r),s=t(s)),s!==r)return!1}return!0}function o5(n){return n.flat(Number.POSITIVE_INFINITY)}function ZT(n,e){n.forEach(t=>Array.isArray(t)?ZT(t,e):e(t))}function mR(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Eg(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function a5(n,e,t,i){let r=n.length;if(r==e)n.push(t,i);else if(r===1)n.push(i,n[0]),n[0]=t;else{for(r--,n.push(n[r-1],n[r]);r>e;){let s=r-2;n[r]=n[s],r--}n[e]=t,n[e+1]=i}}function l5(n,e,t){let i=Uh(n,e);return i>=0?n[i|1]=t:(i=~i,a5(n,i,e,t)),i}function VE(n,e){let t=Uh(n,e);if(t>=0)return n[t|1]}function Uh(n,e){return c5(n,e,1)}function c5(n,e,t){let i=0,r=n.length>>t;for(;r!==i;){let s=i+(r-i>>1),o=n[s<<t];if(e===o)return s<<t;o>e?r=s:i=s+1}return~(r<<t)}var Au={},Ir=[],Du=new Pe(""),gR=new Pe("",-1),yR=new Pe(""),Tg=class{get(e,t=kh){if(t===kh){let i=new Error(`NullInjectorError: No provider for ${_i(e)}!`);throw i.name="NullInjectorError",i}return t}},vR=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(vR||{}),Ts=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(Ts||{}),Ea=function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n}(Ea||{});function u5(n,e,t){let i=n.length;for(;;){let r=n.indexOf(e,t);if(r===-1)return r;if(r===0||n.charCodeAt(r-1)<=32){let s=e.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}t=r+1}}function tT(n,e,t){let i=0;for(;i<t.length;){let r=t[i];if(typeof r=="number"){if(r!==0)break;i++;let s=t[i++],o=t[i++],a=t[i++];n.setAttribute(e,o,a,s)}else{let s=r,o=t[++i];d5(s)?n.setProperty(e,s,o):n.setAttribute(e,s,o),i++}}return i}function _R(n){return n===3||n===4||n===6}function d5(n){return n.charCodeAt(0)===64}function Lh(n,e){if(!(e===null||e.length===0))if(n===null||n.length===0)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){let r=e[i];typeof r=="number"?t=r:t===0||(t===-1||t===2?CP(n,t,r,null,e[++i]):CP(n,t,r,null,null))}}return n}function CP(n,e,t,i,r){let s=0,o=n.length;if(e===-1)o=-1;else for(;s<n.length;){let a=n[s++];if(typeof a=="number"){if(a===e){o=-1;break}else if(a>e){o=s-1;break}}}for(;s<n.length;){let a=n[s];if(typeof a=="number")break;if(a===t){if(i===null){r!==null&&(n[s+1]=r);return}else if(i===n[s+1]){n[s+2]=r;return}}s++,i!==null&&s++,r!==null&&s++}o!==-1&&(n.splice(o,0,e),s=o+1),n.splice(s++,0,t),i!==null&&n.splice(s++,0,i),r!==null&&n.splice(s++,0,r)}var ER="ng-template";function h5(n,e,t,i){let r=0;if(i){for(;r<e.length&&typeof e[r]=="string";r+=2)if(e[r]==="class"&&u5(e[r+1].toLowerCase(),t,0)!==-1)return!0}else if(XT(n))return!1;if(r=e.indexOf(1,r),r>-1){let s;for(;++r<e.length&&typeof(s=e[r])=="string";)if(s.toLowerCase()===t)return!0}return!1}function XT(n){return n.type===4&&n.value!==ER}function f5(n,e,t){let i=n.type===4&&!t?ER:n.value;return e===i}function p5(n,e,t){let i=4,r=n.attrs,s=r!==null?y5(r):0,o=!1;for(let a=0;a<e.length;a++){let l=e[a];if(typeof l=="number"){if(!o&&!Hr(i)&&!Hr(l))return!1;if(o&&Hr(l))continue;o=!1,i=l|i&1;continue}if(!o)if(i&4){if(i=2|i&1,l!==""&&!f5(n,l,t)||l===""&&e.length===1){if(Hr(i))return!1;o=!0}}else if(i&8){if(r===null||!h5(n,r,l,t)){if(Hr(i))return!1;o=!0}}else{let u=e[++a],d=m5(l,r,XT(n),t);if(d===-1){if(Hr(i))return!1;o=!0;continue}if(u!==""){let f;if(d>s?f="":f=r[d+1].toLowerCase(),i&2&&u!==f){if(Hr(i))return!1;o=!0}}}}return Hr(i)||o}function Hr(n){return(n&1)===0}function m5(n,e,t,i){if(e===null)return-1;let r=0;if(i||!t){let s=!1;for(;r<e.length;){let o=e[r];if(o===n)return r;if(o===3||o===6)s=!0;else if(o===1||o===2){let a=e[++r];for(;typeof a=="string";)a=e[++r];continue}else{if(o===4)break;if(o===0){r+=4;continue}}r+=s?1:2}return-1}else return v5(e,n)}function g5(n,e,t=!1){for(let i=0;i<e.length;i++)if(p5(n,e[i],t))return!0;return!1}function y5(n){for(let e=0;e<n.length;e++){let t=n[e];if(_R(t))return e}return n.length}function v5(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){let i=n[t];if(typeof i=="number")return-1;if(i===e)return t;t++}return-1}function xP(n,e){return n?":not("+e.trim()+")":e}function _5(n){let e=n[0],t=1,i=2,r="",s=!1;for(;t<n.length;){let o=n[t];if(typeof o=="string")if(i&2){let a=n[++t];r+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else i&8?r+="."+o:i&4&&(r+=" "+o);else r!==""&&!Hr(o)&&(e+=xP(s,r),r=""),i=o,s=s||!Hr(i);t++}return r!==""&&(e+=xP(s,r)),e}function E5(n){return n.map(_5).join(",")}function T5(n){let e=[],t=[],i=1,r=2;for(;i<n.length;){let s=n[i];if(typeof s=="string")r===2?s!==""&&e.push(s,n[++i]):r===8&&t.push(s);else{if(!Hr(r))break;r=s}i++}return{attrs:e,classes:t}}function Dt(n){return Bh(()=>{let e=SR(n),t=Ye(ue({},e),{decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===vR.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Ts.Emulated,styles:n.styles||Ir,_:null,schemas:n.schemas||null,tView:null,id:""});CR(t);let i=n.dependencies;return t.directiveDefs=DP(i,!1),t.pipeDefs=DP(i,!0),t.id=b5(t),t})}function w5(n){return Ta(n)||TR(n)}function I5(n){return n!==null}function Cs(n){return Bh(()=>({type:n.type,bootstrap:n.bootstrap||Ir,declarations:n.declarations||Ir,imports:n.imports||Ir,exports:n.exports||Ir,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function AP(n,e){if(n==null)return Au;let t={};for(let i in n)if(n.hasOwnProperty(i)){let r=n[i],s,o,a=Ea.None;Array.isArray(r)?(a=r[0],s=r[1],o=r[2]??s):(s=r,o=r),e?(t[s]=a!==Ea.None?[i,a]:i,e[s]=o):t[s]=i}return t}function ri(n){return Bh(()=>{let e=SR(n);return CR(e),e})}function JT(n){return{type:n.type,name:n.name,factory:null,pure:n.pure!==!1,standalone:n.standalone===!0,onDestroy:n.type.prototype.ngOnDestroy||null}}function Ta(n){return n[z3]||null}function TR(n){return n[H3]||null}function wR(n){return n[q3]||null}function IR(n){let e=Ta(n)||TR(n)||wR(n);return e!==null?e.standalone:!1}function bR(n,e){let t=n[W3]||null;if(!t&&e===!0)throw new Error(`Type ${_i(n)} does not have '\u0275mod' property.`);return t}function SR(n){let e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputTransforms:null,inputConfig:n.inputs||Au,exportAs:n.exportAs||null,standalone:n.standalone===!0,signals:n.signals===!0,selectors:n.selectors||Ir,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:AP(n.inputs,e),outputs:AP(n.outputs),debugInfo:null}}function CR(n){n.features?.forEach(e=>e(n))}function DP(n,e){if(!n)return null;let t=e?wR:w5;return()=>(typeof n=="function"?n():n).map(i=>t(i)).filter(I5)}function b5(n){let e=0,t=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery].join("|");for(let r of t)e=Math.imul(31,e)+r.charCodeAt(0)<<0;return e+=2147483648,"c"+e}function Yr(n){return{\u0275providers:n}}function S5(...n){return{\u0275providers:xR(!0,n),\u0275fromNgModule:!0}}function xR(n,...e){let t=[],i=new Set,r,s=o=>{t.push(o)};return ZT(e,o=>{let a=o;nT(a,s,[],i)&&(r||=[],r.push(a))}),r!==void 0&&AR(r,s),t}function AR(n,e){for(let t=0;t<n.length;t++){let{ngModule:i,providers:r}=n[t];ew(r,s=>{e(s,i)})}}function nT(n,e,t,i){if(n=vi(n),!n)return!1;let r=null,s=wP(n),o=!s&&Ta(n);if(!s&&!o){let l=n.ngModule;if(s=wP(l),s)r=l;else return!1}else{if(o&&!o.standalone)return!1;r=n}let a=i.has(r);if(o){if(a)return!1;if(i.add(r),o.dependencies){let l=typeof o.dependencies=="function"?o.dependencies():o.dependencies;for(let u of l)nT(u,e,t,i)}}else if(s){if(s.imports!=null&&!a){i.add(r);let u;try{ZT(s.imports,d=>{nT(d,e,t,i)&&(u||=[],u.push(d))})}finally{}u!==void 0&&AR(u,e)}if(!a){let u=Nl(r)||(()=>new r);e({provide:r,useFactory:u,deps:Ir},r),e({provide:yR,useValue:r,multi:!0},r),e({provide:Du,useValue:()=>Me(r),multi:!0},r)}let l=s.providers;if(l!=null&&!a){let u=n;ew(l,d=>{e(d,u)})}}else return!1;return r!==n&&n.providers!==void 0}function ew(n,e){for(let t of n)dR(t)&&(t=t.\u0275providers),Array.isArray(t)?ew(t,e):e(t)}var C5=Ht({provide:String,useValue:Ht});function DR(n){return n!==null&&typeof n=="object"&&C5 in n}function x5(n){return!!(n&&n.useExisting)}function A5(n){return!!(n&&n.useFactory)}function Pu(n){return typeof n=="function"}function D5(n){return!!n.useClass}var Hg=new Pe(""),hg={},P5={},BE;function tw(){return BE===void 0&&(BE=new Tg),BE}var Ei=class{},Oh=class extends Ei{get destroyed(){return this._destroyed}constructor(e,t,i,r){super(),this.parent=t,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,rT(e,o=>this.processProvider(o)),this.records.set(gR,Tu(void 0,this)),r.has("environment")&&this.records.set(Ei,Tu(void 0,this));let s=this.records.get(Hg);s!=null&&typeof s.value=="string"&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(yR,Ir,dt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let e=St(null);try{for(let i of this._ngOnDestroyHooks)i.ngOnDestroy();let t=this._onDestroyHooks;this._onDestroyHooks=[];for(let i of t)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),St(e)}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();let t=ya(this),i=ki(void 0),r;try{return e()}finally{ya(t),ki(i)}}get(e,t=kh,i=dt.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(bP))return e[bP](this);i=zg(i);let r,s=ya(this),o=ki(void 0);try{if(!(i&dt.SkipSelf)){let l=this.records.get(e);if(l===void 0){let u=O5(e)&&Gg(e);u&&this.injectableDefInScope(u)?l=Tu(iT(e),hg):l=null,this.records.set(e,l)}if(l!=null)return this.hydrate(e,l)}let a=i&dt.Self?tw():this.parent;return t=i&dt.Optional&&t===kh?null:t,a.get(e,t)}catch(a){if(a.name==="NullInjectorError"){if((a[_g]=a[_g]||[]).unshift(_i(e)),s)throw a;return i5(a,e,"R3InjectorError",this.source)}else throw a}finally{ki(o),ya(s)}}resolveInjectorInitializers(){let e=St(null),t=ya(this),i=ki(void 0),r;try{let s=this.get(Du,Ir,dt.Self);for(let o of s)o()}finally{ya(t),ki(i),St(e)}}toString(){let e=[],t=this.records;for(let i of t.keys())e.push(_i(i));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new me(205,!1)}processProvider(e){e=vi(e);let t=Pu(e)?e:vi(e&&e.provide),i=M5(e);if(!Pu(e)&&e.multi===!0){let r=this.records.get(t);r||(r=Tu(void 0,hg,!0),r.factory=()=>eT(r.multi),this.records.set(t,r)),t=e,r.multi.push(e)}this.records.set(t,i)}hydrate(e,t){let i=St(null);try{return t.value===hg&&(t.value=P5,t.value=t.factory()),typeof t.value=="object"&&t.value&&L5(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{St(i)}}injectableDefInScope(e){if(!e.providedIn)return!1;let t=vi(e.providedIn);return typeof t=="string"?t==="any"||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){let t=this._onDestroyHooks.indexOf(e);t!==-1&&this._onDestroyHooks.splice(t,1)}};function iT(n){let e=Gg(n),t=e!==null?e.factory:Nl(n);if(t!==null)return t;if(n instanceof Pe)throw new me(204,!1);if(n instanceof Function)return R5(n);throw new me(204,!1)}function R5(n){if(n.length>0)throw new me(204,!1);let t=j3(n);return t!==null?()=>t.factory(n):()=>new n}function M5(n){if(DR(n))return Tu(void 0,n.useValue);{let e=PR(n);return Tu(e,hg)}}function PR(n,e,t){let i;if(Pu(n)){let r=vi(n);return Nl(r)||iT(r)}else if(DR(n))i=()=>vi(n.useValue);else if(A5(n))i=()=>n.useFactory(...eT(n.deps||[]));else if(x5(n))i=()=>Me(vi(n.useExisting));else{let r=vi(n&&(n.useClass||n.provide));if(k5(n))i=()=>new r(...eT(n.deps));else return Nl(r)||iT(r)}return i}function Tu(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function k5(n){return!!n.deps}function L5(n){return n!==null&&typeof n=="object"&&typeof n.ngOnDestroy=="function"}function O5(n){return typeof n=="function"||typeof n=="object"&&n instanceof Pe}function rT(n,e){for(let t of n)Array.isArray(t)?rT(t,e):t&&dR(t)?rT(t.\u0275providers,e):e(t)}function Sr(n,e){n instanceof Oh&&n.assertNotDestroyed();let t,i=ya(n),r=ki(void 0);try{return e()}finally{ya(i),ki(r)}}function RR(){return hR()!==void 0||e5()!=null}function N5(n){if(!RR())throw new me(-203,!1)}function F5(n){return typeof n=="function"}var Eo=0,it=1,We=2,li=3,qr=4,Qr=5,wg=6,Ig=7,Wr=8,Ru=9,ws=10,Fn=11,Nh=12,PP=13,Fu=14,Is=15,Fl=16,wu=17,mo=18,qg=19,MR=20,va=21,UE=22,br=23,Kr=25,kR=1;var Vl=7,bg=8,Mu=9,Xi=10,Sg=function(n){return n[n.None=0]="None",n[n.HasTransplantedViews=2]="HasTransplantedViews",n}(Sg||{});function _a(n){return Array.isArray(n)&&typeof n[kR]=="object"}function To(n){return Array.isArray(n)&&n[kR]===!0}function LR(n){return(n.flags&4)!==0}function Wg(n){return n.componentOffset>-1}function nw(n){return(n.flags&1)===1}function wa(n){return!!n.template}function sT(n){return(n[We]&512)!==0}var oT=class{constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}};function OR(n,e,t,i){e!==null?e.applyValueToInputSignal(e,i):n[t]=i}function Cr(){return NR}function NR(n){return n.type.prototype.ngOnChanges&&(n.setInput=B5),V5}Cr.ngInherit=!0;function V5(){let n=VR(this),e=n?.current;if(e){let t=n.previous;if(t===Au)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function B5(n,e,t,i,r){let s=this.declaredInputs[i],o=VR(n)||U5(n,{previous:Au,current:null}),a=o.current||(o.current={}),l=o.previous,u=l[s];a[s]=new oT(u&&u.currentValue,t,l===Au),OR(n,e,r,t)}var FR="__ngSimpleChanges__";function VR(n){return n[FR]||null}function U5(n,e){return n[FR]=e}var RP=null;var _s=function(n,e,t){RP?.(n,e,t)},BR="svg",$5="math";function bs(n){for(;Array.isArray(n);)n=n[Eo];return n}function UR(n,e){return bs(e[n])}function xr(n,e){return bs(e[n.index])}function $R(n,e){return n.data[e]}function jR(n,e){return n[e]}function Sa(n,e){let t=e[n];return _a(t)?t:t[Eo]}function j5(n){return(n[We]&4)===4}function iw(n){return(n[We]&128)===128}function G5(n){return To(n[li])}function Cg(n,e){return e==null?null:n[e]}function GR(n){n[wu]=0}function zR(n){n[We]&1024||(n[We]|=1024,iw(n)&&Yg(n))}function z5(n,e){for(;n>0;)e=e[Fu],n--;return e}function Kg(n){return!!(n[We]&9216||n[br]?.dirty)}function aT(n){n[ws].changeDetectionScheduler?.notify(8),n[We]&64&&(n[We]|=1024),Kg(n)&&Yg(n)}function Yg(n){n[ws].changeDetectionScheduler?.notify(0);let e=Bl(n);for(;e!==null&&!(e[We]&8192||(e[We]|=8192,!iw(e)));)e=Bl(e)}function HR(n,e){if((n[We]&256)===256)throw new me(911,!1);n[va]===null&&(n[va]=[]),n[va].push(e)}function H5(n,e){if(n[va]===null)return;let t=n[va].indexOf(e);t!==-1&&n[va].splice(t,1)}function Bl(n){let e=n[li];return To(e)?e[li]:e}var et={lFrame:nM(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var qR=!1;function q5(){return et.lFrame.elementDepthCount}function W5(){et.lFrame.elementDepthCount++}function K5(){et.lFrame.elementDepthCount--}function WR(){return et.bindingsEnabled}function Y5(){return et.skipHydrationRootTNode!==null}function Q5(n){return et.skipHydrationRootTNode===n}function Z5(){et.skipHydrationRootTNode=null}function At(){return et.lFrame.lView}function ui(){return et.lFrame.tView}function xe(n){return et.lFrame.contextLView=n,n[Wr]}function Ae(n){return et.lFrame.contextLView=null,n}function Ti(){let n=KR();for(;n!==null&&n.type===64;)n=n.parent;return n}function KR(){return et.lFrame.currentTNode}function X5(){let n=et.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}function $h(n,e){let t=et.lFrame;t.currentTNode=n,t.isParent=e}function YR(){return et.lFrame.isParent}function J5(){et.lFrame.isParent=!1}function e4(){return et.lFrame.contextLView}function QR(){return qR}function MP(n){qR=n}function ZR(){let n=et.lFrame,e=n.bindingRootIndex;return e===-1&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function t4(){return et.lFrame.bindingIndex}function n4(n){return et.lFrame.bindingIndex=n}function Qg(){return et.lFrame.bindingIndex++}function XR(n){let e=et.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}function i4(){return et.lFrame.inI18n}function r4(n,e){let t=et.lFrame;t.bindingIndex=t.bindingRootIndex=n,lT(e)}function s4(){return et.lFrame.currentDirectiveIndex}function lT(n){et.lFrame.currentDirectiveIndex=n}function o4(n){let e=et.lFrame.currentDirectiveIndex;return e===-1?null:n[e]}function JR(){return et.lFrame.currentQueryIndex}function rw(n){et.lFrame.currentQueryIndex=n}function a4(n){let e=n[it];return e.type===2?e.declTNode:e.type===1?n[Qr]:null}function eM(n,e,t){if(t&dt.SkipSelf){let r=e,s=n;for(;r=r.parent,r===null&&!(t&dt.Host);)if(r=a4(s),r===null||(s=s[Fu],r.type&10))break;if(r===null)return!1;e=r,n=s}let i=et.lFrame=tM();return i.currentTNode=e,i.lView=n,!0}function sw(n){let e=tM(),t=n[it];et.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function tM(){let n=et.lFrame,e=n===null?null:n.child;return e===null?nM(n):e}function nM(n){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return n!==null&&(n.child=e),e}function iM(){let n=et.lFrame;return et.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}var rM=iM;function ow(){let n=iM();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function l4(n){return(et.lFrame.contextLView=z5(n,et.lFrame.contextLView))[Wr]}function Kl(){return et.lFrame.selectedIndex}function Ul(n){et.lFrame.selectedIndex=n}function aw(){let n=et.lFrame;return $R(n.tView,n.selectedIndex)}function Fe(){et.lFrame.currentNamespace=BR}function Ge(){c4()}function c4(){et.lFrame.currentNamespace=null}function u4(){return et.lFrame.currentNamespace}var sM=!0;function lw(){return sM}function cw(n){sM=n}function d4(n,e,t){let{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=e.type.prototype;if(i){let o=NR(e);(t.preOrderHooks??=[]).push(n,o),(t.preOrderCheckHooks??=[]).push(n,o)}r&&(t.preOrderHooks??=[]).push(0-n,r),s&&((t.preOrderHooks??=[]).push(n,s),(t.preOrderCheckHooks??=[]).push(n,s))}function uw(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){let s=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:u,ngOnDestroy:d}=s;o&&(n.contentHooks??=[]).push(-t,o),a&&((n.contentHooks??=[]).push(t,a),(n.contentCheckHooks??=[]).push(t,a)),l&&(n.viewHooks??=[]).push(-t,l),u&&((n.viewHooks??=[]).push(t,u),(n.viewCheckHooks??=[]).push(t,u)),d!=null&&(n.destroyHooks??=[]).push(t,d)}}function fg(n,e,t){oM(n,e,3,t)}function pg(n,e,t,i){(n[We]&3)===t&&oM(n,e,t,i)}function $E(n,e){let t=n[We];(t&3)===e&&(t&=16383,t+=1,n[We]=t)}function oM(n,e,t,i){let r=i!==void 0?n[wu]&65535:0,s=i??-1,o=e.length-1,a=0;for(let l=r;l<o;l++)if(typeof e[l+1]=="number"){if(a=e[l],i!=null&&a>=i)break}else e[l]<0&&(n[wu]+=65536),(a<s||s==-1)&&(h4(n,t,e,l),n[wu]=(n[wu]&4294901760)+l+2),l++}function kP(n,e){_s(4,n,e);let t=St(null);try{e.call(n)}finally{St(t),_s(5,n,e)}}function h4(n,e,t,i){let r=t[i]<0,s=t[i+1],o=r?-t[i]:t[i],a=n[o];r?n[We]>>14<n[wu]>>16&&(n[We]&3)===e&&(n[We]+=16384,kP(a,s)):kP(a,s)}var Cu=-1,$l=class{constructor(e,t,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=i}};function f4(n){return n instanceof $l}function p4(n){return(n.flags&8)!==0}function m4(n){return(n.flags&16)!==0}var jE={},cT=class{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,i){i=zg(i);let r=this.injector.get(e,jE,i);return r!==jE||t===jE?r:this.parentInjector.get(e,t,i)}};function aM(n){return n!==Cu}function xg(n){return n&32767}function g4(n){return n>>16}function Ag(n,e){let t=g4(n),i=e;for(;t>0;)i=i[Fu],t--;return i}var uT=!0;function Dg(n){let e=uT;return uT=n,e}var y4=256,lM=y4-1,cM=5,v4=0,Es={};function _4(n,e,t){let i;typeof t=="string"?i=t.charCodeAt(0)||0:t.hasOwnProperty(Mh)&&(i=t[Mh]),i==null&&(i=t[Mh]=v4++);let r=i&lM,s=1<<r;e.data[n+(r>>cM)]|=s}function Pg(n,e){let t=uM(n,e);if(t!==-1)return t;let i=e[it];i.firstCreatePass&&(n.injectorIndex=e.length,GE(i.data,n),GE(e,null),GE(i.blueprint,null));let r=dw(n,e),s=n.injectorIndex;if(aM(r)){let o=xg(r),a=Ag(r,e),l=a[it].data;for(let u=0;u<8;u++)e[s+u]=a[o+u]|l[o+u]}return e[s+8]=r,s}function GE(n,e){n.push(0,0,0,0,0,0,0,0,e)}function uM(n,e){return n.injectorIndex===-1||n.parent&&n.parent.injectorIndex===n.injectorIndex||e[n.injectorIndex+8]===null?-1:n.injectorIndex}function dw(n,e){if(n.parent&&n.parent.injectorIndex!==-1)return n.parent.injectorIndex;let t=0,i=null,r=e;for(;r!==null;){if(i=mM(r),i===null)return Cu;if(t++,r=r[Fu],i.injectorIndex!==-1)return i.injectorIndex|t<<16}return Cu}function dT(n,e,t){_4(n,e,t)}function E4(n,e){if(e==="class")return n.classes;if(e==="style")return n.styles;let t=n.attrs;if(t){let i=t.length,r=0;for(;r<i;){let s=t[r];if(_R(s))break;if(s===0)r=r+2;else if(typeof s=="number")for(r++;r<i&&typeof t[r]=="string";)r++;else{if(s===e)return t[r+1];r=r+2}}}return null}function dM(n,e,t){if(t&dt.Optional||n!==void 0)return n;YT(e,"NodeInjector")}function hM(n,e,t,i){if(t&dt.Optional&&i===void 0&&(i=null),!(t&(dt.Self|dt.Host))){let r=n[Ru],s=ki(void 0);try{return r?r.get(e,i,t&dt.Optional):fR(e,i,t&dt.Optional)}finally{ki(s)}}return dM(i,e,t)}function fM(n,e,t,i=dt.Default,r){if(n!==null){if(e[We]&2048&&!(i&dt.Self)){let o=b4(n,e,t,i,Es);if(o!==Es)return o}let s=pM(n,e,t,i,Es);if(s!==Es)return s}return hM(e,t,i,r)}function pM(n,e,t,i,r){let s=w4(t);if(typeof s=="function"){if(!eM(e,n,i))return i&dt.Host?dM(r,t,i):hM(e,t,i,r);try{let o;if(o=s(i),o==null&&!(i&dt.Optional))YT(t);else return o}finally{rM()}}else if(typeof s=="number"){let o=null,a=uM(n,e),l=Cu,u=i&dt.Host?e[Is][Qr]:null;for((a===-1||i&dt.SkipSelf)&&(l=a===-1?dw(n,e):e[a+8],l===Cu||!OP(i,!1)?a=-1:(o=e[it],a=xg(l),e=Ag(l,e)));a!==-1;){let d=e[it];if(LP(s,a,d.data)){let f=T4(a,e,t,o,i,u);if(f!==Es)return f}l=e[a+8],l!==Cu&&OP(i,e[it].data[a+8]===u)&&LP(s,a,e)?(o=d,a=xg(l),e=Ag(l,e)):a=-1}}return r}function T4(n,e,t,i,r,s){let o=e[it],a=o.data[n+8],l=i==null?Wg(a)&&uT:i!=o&&(a.type&3)!==0,u=r&dt.Host&&s===a,d=mg(a,o,t,l,u);return d!==null?jl(e,o,d,a):Es}function mg(n,e,t,i,r){let s=n.providerIndexes,o=e.data,a=s&1048575,l=n.directiveStart,u=n.directiveEnd,d=s>>20,f=i?a:a+d,m=r?a+d:u;for(let y=f;y<m;y++){let v=o[y];if(y<l&&t===v||y>=l&&v.type===t)return y}if(r){let y=o[l];if(y&&wa(y)&&y.type===t)return l}return null}function jl(n,e,t,i){let r=n[t],s=e.data;if(f4(r)){let o=r;o.resolving&&Y3(K3(s[t]));let a=Dg(o.canSeeViewProviders);o.resolving=!0;let l,u=o.injectImpl?ki(o.injectImpl):null,d=eM(n,i,dt.Default);try{r=n[t]=o.factory(void 0,s,n,i),e.firstCreatePass&&t>=i.directiveStart&&d4(t,s[t],e)}finally{u!==null&&ki(u),Dg(a),o.resolving=!1,rM()}}return r}function w4(n){if(typeof n=="string")return n.charCodeAt(0)||0;let e=n.hasOwnProperty(Mh)?n[Mh]:void 0;return typeof e=="number"?e>=0?e&lM:I4:e}function LP(n,e,t){let i=1<<n;return!!(t[e+(n>>cM)]&i)}function OP(n,e){return!(n&dt.Self)&&!(n&dt.Host&&e)}var Ol=class{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return fM(this._tNode,this._lView,e,zg(i),t)}};function I4(){return new Ol(Ti(),At())}function wo(n){return Bh(()=>{let e=n.prototype.constructor,t=e[vg]||hT(e),i=Object.prototype,r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){let s=r[vg]||hT(r);if(s&&s!==t)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function hT(n){return aR(n)?()=>{let e=hT(vi(n));return e&&e()}:Nl(n)}function b4(n,e,t,i,r){let s=n,o=e;for(;s!==null&&o!==null&&o[We]&2048&&!(o[We]&512);){let a=pM(s,o,t,i|dt.Self,Es);if(a!==Es)return a;let l=s.parent;if(!l){let u=o[MR];if(u){let d=u.get(t,Es,i);if(d!==Es)return d}l=mM(o),o=o[Fu]}s=l}return r}function mM(n){let e=n[it],t=e.type;return t===2?e.declTNode:t===1?n[Qr]:null}function hw(n){return E4(Ti(),n)}function NP(n,e=null,t=null,i){let r=gM(n,e,t,i);return r.resolveInjectorInitializers(),r}function gM(n,e=null,t=null,i,r=new Set){let s=[t||Ir,S5(n)];return i=i||(typeof n=="object"?void 0:_i(n)),new Oh(s,e||tw(),i||null,r)}var ii=class n{static{this.THROW_IF_NOT_FOUND=kh}static{this.NULL=new Tg}static create(e,t){if(Array.isArray(e))return NP({name:""},t,e,"");{let i=e.name??"";return NP({name:i},e.parent,e.providers,i)}}static{this.\u0275prov=Se({token:n,providedIn:"any",factory:()=>Me(gR)})}static{this.__NG_ELEMENT_ID__=-1}};var S4=new Pe("");S4.__NG_ELEMENT_ID__=n=>{let e=Ti();if(e===null)throw new me(204,!1);if(e.type&2)return e.value;if(n&dt.Optional)return null;throw new me(204,!1)};var C4="ngOriginalError";function zE(n){return n[C4]}var yM=!0,fw=(()=>{class n{static{this.__NG_ELEMENT_ID__=x4}static{this.__NG_ENV_ID__=t=>t}}return n})(),fT=class extends fw{constructor(e){super(),this._lView=e}onDestroy(e){return HR(this._lView,e),()=>H5(this._lView,e)}};function x4(){return new fT(At())}var Ca=(()=>{class n{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Tn(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static{this.\u0275prov=Se({token:n,providedIn:"root",factory:()=>new n})}}return n})();var pT=class extends Hn{constructor(e=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=e,RR()&&(this.destroyRef=le(fw,{optional:!0})??void 0,this.pendingTasks=le(Ca,{optional:!0})??void 0)}emit(e){let t=St(null);try{super.next(e)}finally{St(t)}}subscribe(e,t,i){let r=e,s=t||(()=>null),o=i;if(e&&typeof e=="object"){let l=e;r=l.next?.bind(l),s=l.error?.bind(l),o=l.complete?.bind(l)}this.__isAsync&&(s=this.wrapInTimeout(s),r&&(r=this.wrapInTimeout(r)),o&&(o=this.wrapInTimeout(o)));let a=super.subscribe({next:r,error:s,complete:o});return e instanceof pn&&e.add(a),a}wrapInTimeout(e){return t=>{let i=this.pendingTasks?.add();setTimeout(()=>{e(t),i!==void 0&&this.pendingTasks?.remove(i)})}}},lt=pT;function Rg(...n){}function vM(n){let e,t;function i(){n=Rg;try{t!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(t),e!==void 0&&clearTimeout(e)}catch{}}return e=setTimeout(()=>{n(),i()}),typeof requestAnimationFrame=="function"&&(t=requestAnimationFrame(()=>{n(),i()})),()=>i()}function FP(n){return queueMicrotask(()=>n()),()=>{n=Rg}}var pw="isAngularZone",Mg=pw+"_ID",A4=0,Ct=class n{constructor(e){this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new lt(!1),this.onMicrotaskEmpty=new lt(!1),this.onStable=new lt(!1),this.onError=new lt(!1);let{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:r=!1,scheduleInRootZone:s=yM}=e;if(typeof Zone>"u")throw new me(908,!1);Zone.assertZonePatched();let o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&i,o.shouldCoalesceRunChangeDetection=r,o.callbackScheduled=!1,o.scheduleInRootZone=s,R4(o)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(pw)===!0}static assertInAngularZone(){if(!n.isInAngularZone())throw new me(909,!1)}static assertNotInAngularZone(){if(n.isInAngularZone())throw new me(909,!1)}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,r){let s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+r,e,D4,Rg,Rg);try{return s.runTask(o,t,i)}finally{s.cancelTask(o)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}},D4={};function mw(n){if(n._nesting==0&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function P4(n){if(n.isCheckStableRunning||n.callbackScheduled)return;n.callbackScheduled=!0;function e(){vM(()=>{n.callbackScheduled=!1,mT(n),n.isCheckStableRunning=!0,mw(n),n.isCheckStableRunning=!1})}n.scheduleInRootZone?Zone.root.run(()=>{e()}):n._outer.run(()=>{e()}),mT(n)}function R4(n){let e=()=>{P4(n)},t=A4++;n._inner=n._inner.fork({name:"angular",properties:{[pw]:!0,[Mg]:t,[Mg+t]:!0},onInvokeTask:(i,r,s,o,a,l)=>{if(M4(l))return i.invokeTask(s,o,a,l);try{return VP(n),i.invokeTask(s,o,a,l)}finally{(n.shouldCoalesceEventChangeDetection&&o.type==="eventTask"||n.shouldCoalesceRunChangeDetection)&&e(),BP(n)}},onInvoke:(i,r,s,o,a,l,u)=>{try{return VP(n),i.invoke(s,o,a,l,u)}finally{n.shouldCoalesceRunChangeDetection&&!n.callbackScheduled&&!k4(l)&&e(),BP(n)}},onHasTask:(i,r,s,o)=>{i.hasTask(s,o),r===s&&(o.change=="microTask"?(n._hasPendingMicrotasks=o.microTask,mT(n),mw(n)):o.change=="macroTask"&&(n.hasPendingMacrotasks=o.macroTask))},onHandleError:(i,r,s,o)=>(i.handleError(s,o),n.runOutsideAngular(()=>n.onError.emit(o)),!1)})}function mT(n){n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&n.callbackScheduled===!0?n.hasPendingMicrotasks=!0:n.hasPendingMicrotasks=!1}function VP(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function BP(n){n._nesting--,mw(n)}var gT=class{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new lt,this.onMicrotaskEmpty=new lt,this.onStable=new lt,this.onError=new lt}run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,r){return e.apply(t,i)}};function M4(n){return _M(n,"__ignore_ng_zone__")}function k4(n){return _M(n,"__scheduler_tick__")}function _M(n,e){return!Array.isArray(n)||n.length!==1?!1:n[0]?.data?.[e]===!0}var go=class{constructor(){this._console=console}handleError(e){let t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&zE(e);for(;t&&zE(t);)t=zE(t);return t||null}},L4=new Pe("",{providedIn:"root",factory:()=>{let n=le(Ct),e=le(go);return t=>n.runOutsideAngular(()=>e.handleError(t))}});function O4(){return Vu(Ti(),At())}function Vu(n,e){return new Zr(xr(n,e))}var Zr=(()=>{class n{constructor(t){this.nativeElement=t}static{this.__NG_ELEMENT_ID__=O4}}return n})();function N4(n){return n instanceof Zr?n.nativeElement:n}function F4(){return this._results[Symbol.iterator]()}var yT=class n{get changes(){return this._changes??=new lt}constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let t=n.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=F4)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){this.dirty=!1;let i=o5(e);(this._changesDetected=!s5(this._results,i,t))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(e){this._onDirty=e}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function EM(n){return(n.flags&128)===128}var TM=new Map,V4=0;function B4(){return V4++}function U4(n){TM.set(n[qg],n)}function vT(n){TM.delete(n[qg])}var UP="__ngContext__";function Gl(n,e){_a(e)?(n[UP]=e[qg],U4(e)):n[UP]=e}function wM(n){return bM(n[Nh])}function IM(n){return bM(n[qr])}function bM(n){for(;n!==null&&!To(n);)n=n[qr];return n}var _T;function SM(n){_T=n}function $4(){if(_T!==void 0)return _T;if(typeof document<"u")return document;throw new me(210,!1)}var gw=new Pe("",{providedIn:"root",factory:()=>j4}),j4="ng",yw=new Pe(""),Li=new Pe("",{providedIn:"platform",factory:()=>"unknown"});var vw=new Pe(""),_w=new Pe("",{providedIn:"root",factory:()=>$4().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var G4="h",z4="b";var H4=()=>null;function Ew(n,e,t=!1){return H4(n,e,t)}var CM=!1,q4=new Pe("",{providedIn:"root",factory:()=>CM});var lg;function W4(){if(lg===void 0&&(lg=null,Ll.trustedTypes))try{lg=Ll.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return lg}function $P(n){return W4()?.createScriptURL(n)||n}var kg=class{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${sR})`}};function jh(n){return n instanceof kg?n.changingThisBreaksApplicationSecurity:n}function Tw(n,e){let t=K4(n);if(t!=null&&t!==e){if(t==="ResourceURL"&&e==="URL")return!0;throw new Error(`Required a safe ${e}, got a ${t} (see ${sR})`)}return t===e}function K4(n){return n instanceof kg&&n.getTypeName()||null}var Y4=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function xM(n){return n=String(n),n.match(Y4)?n:"unsafe:"+n}var Zg=function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n}(Zg||{});function xa(n){let e=DM();return e?e.sanitize(Zg.URL,n)||"":Tw(n,"URL")?jh(n):xM(xu(n))}function Q4(n){let e=DM();if(e)return $P(e.sanitize(Zg.RESOURCE_URL,n)||"");if(Tw(n,"ResourceURL"))return $P(jh(n));throw new me(904,!1)}function Z4(n,e){return e==="src"&&(n==="embed"||n==="frame"||n==="iframe"||n==="media"||n==="script")||e==="href"&&(n==="base"||n==="link")?Q4:xa}function AM(n,e,t){return Z4(e,t)(n)}function DM(){let n=At();return n&&n[ws].sanitizer}function PM(n){return n instanceof Function?n():n}function X4(n){return(n??le(ii)).get(Li)==="browser"}var yo=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(yo||{}),J4;function ww(n,e){return J4(n,e)}function Iu(n,e,t,i,r){if(i!=null){let s,o=!1;To(i)?s=i:_a(i)&&(o=!0,i=i[Eo]);let a=bs(i);n===0&&t!==null?r==null?OM(e,t,a):Lg(e,t,a,r||null,!0):n===1&&t!==null?Lg(e,t,a,r||null,!0):n===2?pj(e,a,o):n===3&&e.destroyNode(a),s!=null&&gj(e,n,s,t,r)}}function ej(n,e){return n.createText(e)}function tj(n,e,t){n.setValue(e,t)}function RM(n,e,t){return n.createElement(e,t)}function nj(n,e){MM(n,e),e[Eo]=null,e[Qr]=null}function ij(n,e,t,i,r,s){i[Eo]=r,i[Qr]=e,Xg(n,i,t,1,r,s)}function MM(n,e){e[ws].changeDetectionScheduler?.notify(9),Xg(n,e,e[Fn],2,null,null)}function rj(n){let e=n[Nh];if(!e)return HE(n[it],n);for(;e;){let t=null;if(_a(e))t=e[Nh];else{let i=e[Xi];i&&(t=i)}if(!t){for(;e&&!e[qr]&&e!==n;)_a(e)&&HE(e[it],e),e=e[li];e===null&&(e=n),_a(e)&&HE(e[it],e),t=e&&e[qr]}e=t}}function sj(n,e,t,i){let r=Xi+i,s=t.length;i>0&&(t[r-1][qr]=e),i<s-Xi?(e[qr]=t[r],mR(t,Xi+i,e)):(t.push(e),e[qr]=null),e[li]=t;let o=e[Fl];o!==null&&t!==o&&kM(o,e);let a=e[mo];a!==null&&a.insertView(n),aT(e),e[We]|=128}function kM(n,e){let t=n[Mu],i=e[li];if(_a(i))n[We]|=Sg.HasTransplantedViews;else{let r=i[li][Is];e[Is]!==r&&(n[We]|=Sg.HasTransplantedViews)}t===null?n[Mu]=[e]:t.push(e)}function Iw(n,e){let t=n[Mu],i=t.indexOf(e);t.splice(i,1)}function ET(n,e){if(n.length<=Xi)return;let t=Xi+e,i=n[t];if(i){let r=i[Fl];r!==null&&r!==n&&Iw(r,i),e>0&&(n[t-1][qr]=i[qr]);let s=Eg(n,Xi+e);nj(i[it],i);let o=s[mo];o!==null&&o.detachView(s[it]),i[li]=null,i[qr]=null,i[We]&=-129}return i}function LM(n,e){if(!(e[We]&256)){let t=e[Fn];t.destroyNode&&Xg(n,e,t,3,null,null),rj(e)}}function HE(n,e){if(e[We]&256)return;let t=St(null);try{e[We]&=-129,e[We]|=256,e[br]&&gE(e[br]),aj(n,e),oj(n,e),e[it].type===1&&e[Fn].destroy();let i=e[Fl];if(i!==null&&To(e[li])){i!==e[li]&&Iw(i,e);let r=e[mo];r!==null&&r.detachView(n)}vT(e)}finally{St(t)}}function oj(n,e){let t=n.cleanup,i=e[Ig];if(t!==null)for(let s=0;s<t.length-1;s+=2)if(typeof t[s]=="string"){let o=t[s+3];o>=0?i[o]():i[-o].unsubscribe(),s+=2}else{let o=i[t[s+1]];t[s].call(o)}i!==null&&(e[Ig]=null);let r=e[va];if(r!==null){e[va]=null;for(let s=0;s<r.length;s++){let o=r[s];o()}}}function aj(n,e){let t;if(n!=null&&(t=n.destroyHooks)!=null)for(let i=0;i<t.length;i+=2){let r=e[t[i]];if(!(r instanceof $l)){let s=t[i+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){let a=r[s[o]],l=s[o+1];_s(4,a,l);try{l.call(a)}finally{_s(5,a,l)}}else{_s(4,r,s);try{s.call(r)}finally{_s(5,r,s)}}}}}function lj(n,e,t){return cj(n,e.parent,t)}function cj(n,e,t){let i=e;for(;i!==null&&i.type&168;)e=i,i=e.parent;if(i===null)return t[Eo];{let{componentOffset:r}=i;if(r>-1){let{encapsulation:s}=n.data[i.directiveStart+r];if(s===Ts.None||s===Ts.Emulated)return null}return xr(i,t)}}function Lg(n,e,t,i,r){n.insertBefore(e,t,i,r)}function OM(n,e,t){n.appendChild(e,t)}function jP(n,e,t,i,r){i!==null?Lg(n,e,t,i,r):OM(n,e,t)}function NM(n,e){return n.parentNode(e)}function uj(n,e){return n.nextSibling(e)}function dj(n,e,t){return fj(n,e,t)}function hj(n,e,t){return n.type&40?xr(n,t):null}var fj=hj,GP;function bw(n,e,t,i){let r=lj(n,i,e),s=e[Fn],o=i.parent||e[Qr],a=dj(o,i,e);if(r!=null)if(Array.isArray(t))for(let l=0;l<t.length;l++)jP(s,r,t[l],a,!1);else jP(s,r,t,a,!1);GP!==void 0&&GP(s,i,e,t,r)}function Rh(n,e){if(e!==null){let t=e.type;if(t&3)return xr(e,n);if(t&4)return TT(-1,n[e.index]);if(t&8){let i=e.child;if(i!==null)return Rh(n,i);{let r=n[e.index];return To(r)?TT(-1,r):bs(r)}}else{if(t&128)return Rh(n,e.next);if(t&32)return ww(e,n)()||bs(n[e.index]);{let i=FM(n,e);if(i!==null){if(Array.isArray(i))return i[0];let r=Bl(n[Is]);return Rh(r,i)}else return Rh(n,e.next)}}}return null}function FM(n,e){if(e!==null){let i=n[Is][Qr],r=e.projection;return i.projection[r]}return null}function TT(n,e){let t=Xi+n+1;if(t<e.length){let i=e[t],r=i[it].firstChild;if(r!==null)return Rh(i,r)}return e[Vl]}function pj(n,e,t){n.removeChild(null,e,t)}function Sw(n,e,t,i,r,s,o){for(;t!=null;){if(t.type===128){t=t.next;continue}let a=i[t.index],l=t.type;if(o&&e===0&&(a&&Gl(bs(a),i),t.flags|=2),(t.flags&32)!==32)if(l&8)Sw(n,e,t.child,i,r,s,!1),Iu(e,n,r,a,s);else if(l&32){let u=ww(t,i),d;for(;d=u();)Iu(e,n,r,d,s);Iu(e,n,r,a,s)}else l&16?mj(n,e,i,t,r,s):Iu(e,n,r,a,s);t=o?t.projectionNext:t.next}}function Xg(n,e,t,i,r,s){Sw(t,i,n.firstChild,e,r,s,!1)}function mj(n,e,t,i,r,s){let o=t[Is],l=o[Qr].projection[i.projection];if(Array.isArray(l))for(let u=0;u<l.length;u++){let d=l[u];Iu(e,n,r,d,s)}else{let u=l,d=o[li];EM(i)&&(u.flags|=128),Sw(n,e,u,d,r,s,!0)}}function gj(n,e,t,i,r){let s=t[Vl],o=bs(t);s!==o&&Iu(e,n,i,s,r);for(let a=Xi;a<t.length;a++){let l=t[a];Xg(l[it],l,n,e,i,s)}}function yj(n,e,t,i,r){if(e)r?n.addClass(t,i):n.removeClass(t,i);else{let s=i.indexOf("-")===-1?void 0:yo.DashCase;r==null?n.removeStyle(t,i,s):(typeof r=="string"&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=yo.Important),n.setStyle(t,i,r,s))}}function vj(n,e,t){n.setAttribute(e,"style",t)}function VM(n,e,t){t===""?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function BM(n,e,t){let{mergedAttrs:i,classes:r,styles:s}=t;i!==null&&tT(n,e,i),r!==null&&VM(n,e,r),s!==null&&vj(n,e,s)}var xs={};function K(n=1){UM(ui(),At(),Kl()+n,!1)}function UM(n,e,t,i){if(!i)if((e[We]&3)===3){let s=n.preOrderCheckHooks;s!==null&&fg(e,s,t)}else{let s=n.preOrderHooks;s!==null&&pg(e,s,0,t)}Ul(t)}function Te(n,e=dt.Default){let t=At();if(t===null)return Me(n,e);let i=Ti();return fM(i,t,vi(n),e)}function $M(){let n="invalid";throw new Error(n)}function jM(n,e,t,i,r,s){let o=St(null);try{let a=null;r&Ea.SignalBased&&(a=e[i][ho]),a!==null&&a.transformFn!==void 0&&(s=a.transformFn(s)),r&Ea.HasDecoratorInputTransform&&(s=n.inputTransforms[i].call(e,s)),n.setInput!==null?n.setInput(e,a,s,t,i):OR(e,a,i,s)}finally{St(o)}}function _j(n,e){let t=n.hostBindingOpCodes;if(t!==null)try{for(let i=0;i<t.length;i++){let r=t[i];if(r<0)Ul(~r);else{let s=r,o=t[++i],a=t[++i];r4(o,s);let l=e[s];a(2,l)}}}finally{Ul(-1)}}function Jg(n,e,t,i,r,s,o,a,l,u,d){let f=e.blueprint.slice();return f[Eo]=r,f[We]=i|4|128|8|64,(u!==null||n&&n[We]&2048)&&(f[We]|=2048),GR(f),f[li]=f[Fu]=n,f[Wr]=t,f[ws]=o||n&&n[ws],f[Fn]=a||n&&n[Fn],f[Ru]=l||n&&n[Ru]||null,f[Qr]=s,f[qg]=B4(),f[wg]=d,f[MR]=u,f[Is]=e.type==2?n[Is]:f,f}function e0(n,e,t,i,r){let s=n.data[e];if(s===null)s=Ej(n,e,t,i,r),i4()&&(s.flags|=32);else if(s.type&64){s.type=t,s.value=i,s.attrs=r;let o=X5();s.injectorIndex=o===null?-1:o.injectorIndex}return $h(s,!0),s}function Ej(n,e,t,i,r){let s=KR(),o=YR(),a=o?s:s&&s.parent,l=n.data[e]=Cj(n,a,t,e,i,r);return n.firstChild===null&&(n.firstChild=l),s!==null&&(o?s.child==null&&l.parent!==null&&(s.child=l):s.next===null&&(s.next=l,l.prev=s)),l}function GM(n,e,t,i){if(t===0)return-1;let r=e.length;for(let s=0;s<t;s++)e.push(i),n.blueprint.push(i),n.data.push(null);return r}function zM(n,e,t,i,r){let s=Kl(),o=i&2;try{Ul(-1),o&&e.length>Kr&&UM(n,e,Kr,!1),_s(o?2:0,r),t(i,r)}finally{Ul(s),_s(o?3:1,r)}}function HM(n,e,t){if(LR(e)){let i=St(null);try{let r=e.directiveStart,s=e.directiveEnd;for(let o=r;o<s;o++){let a=n.data[o];if(a.contentQueries){let l=t[o];a.contentQueries(1,l,o)}}}finally{St(i)}}}function qM(n,e,t){WR()&&(Mj(n,e,t,xr(t,e)),(t.flags&64)===64&&XM(n,e,t))}function WM(n,e,t=xr){let i=e.localNames;if(i!==null){let r=e.index+1;for(let s=0;s<i.length;s+=2){let o=i[s+1],a=o===-1?t(e,n):n[o];n[r++]=a}}}function KM(n){let e=n.tView;return e===null||e.incompleteFirstPass?n.tView=Cw(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):e}function Cw(n,e,t,i,r,s,o,a,l,u,d){let f=Kr+i,m=f+r,y=Tj(f,m),v=typeof u=="function"?u():u;return y[it]={type:n,blueprint:y,template:t,queries:null,viewQuery:a,declTNode:e,data:y.slice().fill(null,f),bindingStartIndex:f,expandoStartIndex:m,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof s=="function"?s():s,pipeRegistry:typeof o=="function"?o():o,firstChild:null,schemas:l,consts:v,incompleteFirstPass:!1,ssrId:d}}function Tj(n,e){let t=[];for(let i=0;i<e;i++)t.push(i<n?null:xs);return t}function wj(n,e,t,i){let s=i.get(q4,CM)||t===Ts.ShadowDom,o=n.selectRootElement(e,s);return Ij(o),o}function Ij(n){bj(n)}var bj=()=>null;function Sj(n,e,t,i){let r=tk(e);r.push(t),n.firstCreatePass&&nk(n).push(i,r.length-1)}function Cj(n,e,t,i,r,s){let o=e?e.injectorIndex:-1,a=0;return Y5()&&(a|=128),{type:t,index:i,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function zP(n,e,t,i,r){for(let s in e){if(!e.hasOwnProperty(s))continue;let o=e[s];if(o===void 0)continue;i??={};let a,l=Ea.None;Array.isArray(o)?(a=o[0],l=o[1]):a=o;let u=s;if(r!==null){if(!r.hasOwnProperty(s))continue;u=r[s]}n===0?HP(i,t,u,a,l):HP(i,t,u,a)}return i}function HP(n,e,t,i,r){let s;n.hasOwnProperty(t)?(s=n[t]).push(e,i):s=n[t]=[e,i],r!==void 0&&s.push(r)}function xj(n,e,t){let i=e.directiveStart,r=e.directiveEnd,s=n.data,o=e.attrs,a=[],l=null,u=null;for(let d=i;d<r;d++){let f=s[d],m=t?t.get(f):null,y=m?m.inputs:null,v=m?m.outputs:null;l=zP(0,f.inputs,d,l,y),u=zP(1,f.outputs,d,u,v);let E=l!==null&&o!==null&&!XT(e)?Gj(l,d,o):null;a.push(E)}l!==null&&(l.hasOwnProperty("class")&&(e.flags|=8),l.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=l,e.outputs=u}function Aj(n){return n==="class"?"className":n==="for"?"htmlFor":n==="formaction"?"formAction":n==="innerHtml"?"innerHTML":n==="readonly"?"readOnly":n==="tabindex"?"tabIndex":n}function YM(n,e,t,i,r,s,o,a){let l=xr(e,t),u=e.inputs,d;!a&&u!=null&&(d=u[i])?(xw(n,t,d,i,r),Wg(e)&&Dj(t,e.index)):e.type&3?(i=Aj(i),r=o!=null?o(r,e.value||"",i):r,s.setProperty(l,i,r)):e.type&12}function Dj(n,e){let t=Sa(e,n);t[We]&16||(t[We]|=64)}function QM(n,e,t,i){if(WR()){let r=i===null?null:{"":-1},s=Lj(n,t),o,a;s===null?o=a=null:[o,a]=s,o!==null&&ZM(n,e,t,o,r,a),r&&Oj(t,i,r)}t.mergedAttrs=Lh(t.mergedAttrs,t.attrs)}function ZM(n,e,t,i,r,s){for(let u=0;u<i.length;u++)dT(Pg(t,e),n,i[u].type);Fj(t,n.data.length,i.length);for(let u=0;u<i.length;u++){let d=i[u];d.providersResolver&&d.providersResolver(d)}let o=!1,a=!1,l=GM(n,e,i.length,null);for(let u=0;u<i.length;u++){let d=i[u];t.mergedAttrs=Lh(t.mergedAttrs,d.hostAttrs),Vj(n,t,e,l,d),Nj(l,d,r),d.contentQueries!==null&&(t.flags|=4),(d.hostBindings!==null||d.hostAttrs!==null||d.hostVars!==0)&&(t.flags|=64);let f=d.type.prototype;!o&&(f.ngOnChanges||f.ngOnInit||f.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),o=!0),!a&&(f.ngOnChanges||f.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),a=!0),l++}xj(n,t,s)}function Pj(n,e,t,i,r){let s=r.hostBindings;if(s){let o=n.hostBindingOpCodes;o===null&&(o=n.hostBindingOpCodes=[]);let a=~e.index;Rj(o)!=a&&o.push(a),o.push(t,i,s)}}function Rj(n){let e=n.length;for(;e>0;){let t=n[--e];if(typeof t=="number"&&t<0)return t}return 0}function Mj(n,e,t,i){let r=t.directiveStart,s=t.directiveEnd;Wg(t)&&Bj(e,t,n.data[r+t.componentOffset]),n.firstCreatePass||Pg(t,e),Gl(i,e);let o=t.initialInputs;for(let a=r;a<s;a++){let l=n.data[a],u=jl(e,n,a,t);if(Gl(u,e),o!==null&&jj(e,a-r,u,l,t,o),wa(l)){let d=Sa(t.index,e);d[Wr]=jl(e,n,a,t)}}}function XM(n,e,t){let i=t.directiveStart,r=t.directiveEnd,s=t.index,o=s4();try{Ul(s);for(let a=i;a<r;a++){let l=n.data[a],u=e[a];lT(a),(l.hostBindings!==null||l.hostVars!==0||l.hostAttrs!==null)&&kj(l,u)}}finally{Ul(-1),lT(o)}}function kj(n,e){n.hostBindings!==null&&n.hostBindings(1,e)}function Lj(n,e){let t=n.directiveRegistry,i=null,r=null;if(t)for(let s=0;s<t.length;s++){let o=t[s];if(g5(e,o.selectors,!1))if(i||(i=[]),wa(o))if(o.findHostDirectiveDefs!==null){let a=[];r=r||new Map,o.findHostDirectiveDefs(o,a,r),i.unshift(...a,o);let l=a.length;wT(n,e,l)}else i.unshift(o),wT(n,e,0);else r=r||new Map,o.findHostDirectiveDefs?.(o,i,r),i.push(o)}return i===null?null:[i,r]}function wT(n,e,t){e.componentOffset=t,(n.components??=[]).push(e.index)}function Oj(n,e,t){if(e){let i=n.localNames=[];for(let r=0;r<e.length;r+=2){let s=t[e[r+1]];if(s==null)throw new me(-301,!1);i.push(e[r],s)}}}function Nj(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;wa(e)&&(t[""]=n)}}function Fj(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function Vj(n,e,t,i,r){n.data[i]=r;let s=r.factory||(r.factory=Nl(r.type,!0)),o=new $l(s,wa(r),Te);n.blueprint[i]=o,t[i]=o,Pj(n,e,i,GM(n,t,r.hostVars,xs),r)}function Bj(n,e,t){let i=xr(e,n),r=KM(t),s=n[ws].rendererFactory,o=16;t.signals?o=4096:t.onPush&&(o=64);let a=t0(n,Jg(n,r,null,o,i,e,null,s.createRenderer(i,t),null,null,null));n[e.index]=a}function Uj(n,e,t,i,r,s){let o=xr(n,e);$j(e[Fn],o,s,n.value,t,i,r)}function $j(n,e,t,i,r,s,o){if(s==null)n.removeAttribute(e,r,t);else{let a=o==null?xu(s):o(s,i||"",r);n.setAttribute(e,r,a,t)}}function jj(n,e,t,i,r,s){let o=s[e];if(o!==null)for(let a=0;a<o.length;){let l=o[a++],u=o[a++],d=o[a++],f=o[a++];jM(i,t,l,u,d,f)}}function Gj(n,e,t){let i=null,r=0;for(;r<t.length;){let s=t[r];if(s===0){r+=4;continue}else if(s===5){r+=2;continue}if(typeof s=="number")break;if(n.hasOwnProperty(s)){i===null&&(i=[]);let o=n[s];for(let a=0;a<o.length;a+=3)if(o[a]===e){i.push(s,o[a+1],o[a+2],t[r+1]);break}}r+=2}return i}function JM(n,e,t,i){return[n,!0,0,e,null,i,null,t,null,null]}function ek(n,e){let t=n.contentQueries;if(t!==null){let i=St(null);try{for(let r=0;r<t.length;r+=2){let s=t[r],o=t[r+1];if(o!==-1){let a=n.data[o];rw(s),a.contentQueries(2,e[o],o)}}}finally{St(i)}}}function t0(n,e){return n[Nh]?n[PP][qr]=e:n[Nh]=e,n[PP]=e,e}function IT(n,e,t){rw(0);let i=St(null);try{e(n,t)}finally{St(i)}}function tk(n){return n[Ig]??=[]}function nk(n){return n.cleanup??=[]}function ik(n,e){let t=n[Ru],i=t?t.get(go,null):null;i&&i.handleError(e)}function xw(n,e,t,i,r){for(let s=0;s<t.length;){let o=t[s++],a=t[s++],l=t[s++],u=e[o],d=n.data[o];jM(d,u,i,a,l,r)}}function rk(n,e,t){let i=UR(e,n);tj(n[Fn],i,t)}function zj(n,e){let t=Sa(e,n),i=t[it];Hj(i,t);let r=t[Eo];r!==null&&t[wg]===null&&(t[wg]=Ew(r,t[Ru])),Aw(i,t,t[Wr])}function Hj(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])}function Aw(n,e,t){sw(e);try{let i=n.viewQuery;i!==null&&IT(1,i,t);let r=n.template;r!==null&&zM(n,e,r,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),e[mo]?.finishViewCreation(n),n.staticContentQueries&&ek(n,e),n.staticViewQueries&&IT(2,n.viewQuery,t);let s=n.components;s!==null&&qj(e,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[We]&=-5,ow()}}function qj(n,e){for(let t=0;t<e.length;t++)zj(n,e[t])}function Wj(n,e,t,i){let r=St(null);try{let s=e.tView,a=n[We]&4096?4096:16,l=Jg(n,s,t,a,null,e,null,null,i?.injector??null,i?.embeddedViewInjector??null,i?.dehydratedView??null),u=n[e.index];l[Fl]=u;let d=n[mo];return d!==null&&(l[mo]=d.createEmbeddedView(s)),Aw(s,l,t),l}finally{St(r)}}function qP(n,e){return!e||e.firstChild===null||EM(n)}function Kj(n,e,t,i=!0){let r=e[it];if(sj(r,e,n,t),i){let o=TT(t,n),a=e[Fn],l=NM(a,n[Vl]);l!==null&&ij(r,n[Qr],a,e,l,o)}let s=e[wg];s!==null&&s.firstChild!==null&&(s.firstChild=null)}function Og(n,e,t,i,r=!1){for(;t!==null;){if(t.type===128){t=r?t.projectionNext:t.next;continue}let s=e[t.index];s!==null&&i.push(bs(s)),To(s)&&Yj(s,i);let o=t.type;if(o&8)Og(n,e,t.child,i);else if(o&32){let a=ww(t,e),l;for(;l=a();)i.push(l)}else if(o&16){let a=FM(e,t);if(Array.isArray(a))i.push(...a);else{let l=Bl(e[Is]);Og(l[it],l,a,i,!0)}}t=r?t.projectionNext:t.next}return i}function Yj(n,e){for(let t=Xi;t<n.length;t++){let i=n[t],r=i[it].firstChild;r!==null&&Og(i[it],i,r,e)}n[Vl]!==n[Eo]&&e.push(n[Vl])}var sk=[];function Qj(n){return n[br]??Zj(n)}function Zj(n){let e=sk.pop()??Object.create(Jj);return e.lView=n,e}function Xj(n){n.lView[br]!==n&&(n.lView=null,sk.push(n))}var Jj=Ye(ue({},xh),{consumerIsAlwaysLive:!0,consumerMarkedDirty:n=>{Yg(n.lView)},consumerOnSignalRead(){this.lView[br]=this}});function e6(n){let e=n[br]??Object.create(t6);return e.lView=n,e}var t6=Ye(ue({},xh),{consumerIsAlwaysLive:!0,consumerMarkedDirty:n=>{let e=Bl(n.lView);for(;e&&!ok(e[it]);)e=Bl(e);e&&zR(e)},consumerOnSignalRead(){this.lView[br]=this}});function ok(n){return n.type!==2}var n6=100;function ak(n,e=!0,t=0){let i=n[ws],r=i.rendererFactory,s=!1;s||r.begin?.();try{i6(n,t)}catch(o){throw e&&ik(n,o),o}finally{s||(r.end?.(),i.inlineEffectRunner?.flush())}}function i6(n,e){let t=QR();try{MP(!0),bT(n,e);let i=0;for(;Kg(n);){if(i===n6)throw new me(103,!1);i++,bT(n,1)}}finally{MP(t)}}function r6(n,e,t,i){let r=e[We];if((r&256)===256)return;let s=!1,o=!1;!s&&e[ws].inlineEffectRunner?.flush(),sw(e);let a=!0,l=null,u=null;s||(ok(n)?(u=Qj(e),l=Lm(u)):N1()===null?(a=!1,u=e6(e),l=Lm(u)):e[br]&&(gE(e[br]),e[br]=null));try{GR(e),n4(n.bindingStartIndex),t!==null&&zM(n,e,t,2,i);let d=(r&3)===3;if(!s)if(d){let y=n.preOrderCheckHooks;y!==null&&fg(e,y,null)}else{let y=n.preOrderHooks;y!==null&&pg(e,y,0,null),$E(e,0)}if(o||s6(e),lk(e,0),n.contentQueries!==null&&ek(n,e),!s)if(d){let y=n.contentCheckHooks;y!==null&&fg(e,y)}else{let y=n.contentHooks;y!==null&&pg(e,y,1),$E(e,1)}_j(n,e);let f=n.components;f!==null&&uk(e,f,0);let m=n.viewQuery;if(m!==null&&IT(2,m,i),!s)if(d){let y=n.viewCheckHooks;y!==null&&fg(e,y)}else{let y=n.viewHooks;y!==null&&pg(e,y,2),$E(e,2)}if(n.firstUpdatePass===!0&&(n.firstUpdatePass=!1),e[UE]){for(let y of e[UE])y();e[UE]=null}s||(e[We]&=-73)}catch(d){throw s||Yg(e),d}finally{u!==null&&(pE(u,l),a&&Xj(u)),ow()}}function lk(n,e){for(let t=wM(n);t!==null;t=IM(t))for(let i=Xi;i<t.length;i++){let r=t[i];ck(r,e)}}function s6(n){for(let e=wM(n);e!==null;e=IM(e)){if(!(e[We]&Sg.HasTransplantedViews))continue;let t=e[Mu];for(let i=0;i<t.length;i++){let r=t[i];zR(r)}}}function o6(n,e,t){let i=Sa(e,n);ck(i,t)}function ck(n,e){iw(n)&&bT(n,e)}function bT(n,e){let i=n[it],r=n[We],s=n[br],o=!!(e===0&&r&16);if(o||=!!(r&64&&e===0),o||=!!(r&1024),o||=!!(s?.dirty&&mE(s)),o||=!1,s&&(s.dirty=!1),n[We]&=-9217,o)r6(i,n,i.template,n[Wr]);else if(r&8192){lk(n,1);let a=i.components;a!==null&&uk(n,a,1)}}function uk(n,e,t){for(let i=0;i<e.length;i++)o6(n,e[i],t)}function Dw(n,e){let t=QR()?64:1088;for(n[ws].changeDetectionScheduler?.notify(e);n;){n[We]|=t;let i=Bl(n);if(sT(n)&&!i)return n;n=i}return null}var zl=class{get rootNodes(){let e=this._lView,t=e[it];return Og(t,e,t.firstChild,[])}constructor(e,t,i=!0){this._lView=e,this._cdRefInjectingView=t,this.notifyErrorHandler=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Wr]}set context(e){this._lView[Wr]=e}get destroyed(){return(this._lView[We]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[li];if(To(e)){let t=e[bg],i=t?t.indexOf(this):-1;i>-1&&(ET(e,i),Eg(t,i))}this._attachedToViewContainer=!1}LM(this._lView[it],this._lView)}onDestroy(e){HR(this._lView,e)}markForCheck(){Dw(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[We]&=-129}reattach(){aT(this._lView),this._lView[We]|=128}detectChanges(){this._lView[We]|=1024,ak(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new me(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let e=sT(this._lView),t=this._lView[Fl];t!==null&&!e&&Iw(t,this._lView),MM(this._lView[it],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new me(902,!1);this._appRef=e;let t=sT(this._lView),i=this._lView[Fl];i!==null&&!t&&kM(i,this._lView),aT(this._lView)}},Hl=(()=>{class n{static{this.__NG_ELEMENT_ID__=c6}}return n})(),a6=Hl,l6=class extends a6{constructor(e,t,i){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,t){return this.createEmbeddedViewImpl(e,t)}createEmbeddedViewImpl(e,t,i){let r=Wj(this._declarationLView,this._declarationTContainer,e,{embeddedViewInjector:t,dehydratedView:i});return new zl(r)}};function c6(){return n0(Ti(),At())}function n0(n,e){return n.type&4?new l6(e,n,Vu(n,e)):null}var Oue=new RegExp(`^(\\d+)*(${z4}|${G4})*(.*)`);var u6=()=>null;function WP(n,e){return u6(n,e)}var ku=class{},Pw=new Pe("",{providedIn:"root",factory:()=>!1});var dk=new Pe(""),hk=new Pe(""),ST=class{},Ng=class{};function d6(n){let e=Error(`No component factory found for ${_i(n)}.`);return e[h6]=n,e}var h6="ngComponent";var CT=class{resolveComponentFactory(e){throw d6(e)}},Lu=class{static{this.NULL=new CT}},Ia=class{},Yl=(()=>{class n{constructor(){this.destroyNode=null}static{this.__NG_ELEMENT_ID__=()=>f6()}}return n})();function f6(){let n=At(),e=Ti(),t=Sa(e.index,n);return(_a(t)?t:n)[Fn]}var p6=(()=>{class n{static{this.\u0275prov=Se({token:n,providedIn:"root",factory:()=>null})}}return n})();function xT(n,e,t){let i=t?n.styles:null,r=t?n.classes:null,s=0;if(e!==null)for(let o=0;o<e.length;o++){let a=e[o];if(typeof a=="number")s=a;else if(s==1)r=EP(r,a);else if(s==2){let l=a,u=e[++o];i=EP(i,l+": "+u+";")}}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=r:n.classesWithoutHost=r}var Fg=class extends Lu{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let t=Ta(e);return new Ou(t,this.ngModule)}};function KP(n,e){let t=[];for(let i in n){if(!n.hasOwnProperty(i))continue;let r=n[i];if(r===void 0)continue;let s=Array.isArray(r),o=s?r[0]:r,a=s?r[1]:Ea.None;e?t.push({propName:o,templateName:i,isSignal:(a&Ea.SignalBased)!==0}):t.push({propName:o,templateName:i})}return t}function m6(n){let e=n.toLowerCase();return e==="svg"?BR:e==="math"?$5:null}var Ou=class extends Ng{get inputs(){let e=this.componentDef,t=e.inputTransforms,i=KP(e.inputs,!0);if(t!==null)for(let r of i)t.hasOwnProperty(r.propName)&&(r.transform=t[r.propName]);return i}get outputs(){return KP(this.componentDef.outputs,!1)}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=E5(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}create(e,t,i,r){let s=St(null);try{r=r||this.ngModule;let o=r instanceof Ei?r:r?.injector;o&&this.componentDef.getStandaloneInjector!==null&&(o=this.componentDef.getStandaloneInjector(o)||o);let a=o?new cT(e,o):e,l=a.get(Ia,null);if(l===null)throw new me(407,!1);let u=a.get(p6,null),d=a.get(ku,null),f={rendererFactory:l,sanitizer:u,inlineEffectRunner:null,changeDetectionScheduler:d},m=l.createRenderer(null,this.componentDef),y=this.componentDef.selectors[0][0]||"div",v=i?wj(m,i,this.componentDef.encapsulation,a):RM(m,y,m6(y)),E=512;this.componentDef.signals?E|=4096:this.componentDef.onPush||(E|=16);let T=null;v!==null&&(T=Ew(v,a,!0));let C=Cw(0,null,null,1,0,null,null,null,null,null,null),D=Jg(null,C,null,E,null,null,f,m,a,null,T);sw(D);let P,V,G=null;try{let H=this.componentDef,A,x=null;H.findHostDirectiveDefs?(A=[],x=new Map,H.findHostDirectiveDefs(H,A,x),A.push(H)):A=[H];let R=g6(D,v);G=y6(R,v,H,A,D,f,m),V=$R(C,Kr),v&&E6(m,H,v,i),t!==void 0&&T6(V,this.ngContentSelectors,t),P=_6(G,H,A,x,D,[w6]),Aw(C,D,null)}catch(H){throw G!==null&&vT(G),vT(D),H}finally{ow()}return new AT(this.componentType,P,Vu(V,D),D,V)}finally{St(s)}}},AT=class extends ST{constructor(e,t,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new zl(r,void 0,!1),this.componentType=e}setInput(e,t){let i=this._tNode.inputs,r;if(i!==null&&(r=i[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;let s=this._rootLView;xw(s[it],s,r,e,t),this.previousInputValues.set(e,t);let o=Sa(this._tNode.index,s);Dw(o,1)}}get injector(){return new Ol(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function g6(n,e){let t=n[it],i=Kr;return n[i]=e,e0(t,i,2,"#host",null)}function y6(n,e,t,i,r,s,o){let a=r[it];v6(i,n,e,o);let l=null;e!==null&&(l=Ew(e,r[Ru]));let u=s.rendererFactory.createRenderer(e,t),d=16;t.signals?d=4096:t.onPush&&(d=64);let f=Jg(r,KM(t),null,d,r[n.index],n,s,u,null,null,l);return a.firstCreatePass&&wT(a,n,i.length-1),t0(r,f),r[n.index]=f}function v6(n,e,t,i){for(let r of n)e.mergedAttrs=Lh(e.mergedAttrs,r.hostAttrs);e.mergedAttrs!==null&&(xT(e,e.mergedAttrs,!0),t!==null&&BM(i,t,e))}function _6(n,e,t,i,r,s){let o=Ti(),a=r[it],l=xr(o,r);ZM(a,r,o,t,null,i);for(let d=0;d<t.length;d++){let f=o.directiveStart+d,m=jl(r,a,f,o);Gl(m,r)}XM(a,r,o),l&&Gl(l,r);let u=jl(r,a,o.directiveStart+o.componentOffset,o);if(n[Wr]=r[Wr]=u,s!==null)for(let d of s)d(u,e);return HM(a,o,r),u}function E6(n,e,t,i){if(i)tT(n,t,["ng-version","18.2.14"]);else{let{attrs:r,classes:s}=T5(e.selectors[0]);r&&tT(n,t,r),s&&s.length>0&&VM(n,t,s.join(" "))}}function T6(n,e,t){let i=n.projection=[];for(let r=0;r<e.length;r++){let s=t[r];i.push(s!=null?Array.from(s):null)}}function w6(){let n=Ti();uw(At()[it],n)}var Aa=(()=>{class n{static{this.__NG_ELEMENT_ID__=I6}}return n})();function I6(){let n=Ti();return pk(n,At())}var b6=Aa,fk=class extends b6{constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return Vu(this._hostTNode,this._hostLView)}get injector(){return new Ol(this._hostTNode,this._hostLView)}get parentInjector(){let e=dw(this._hostTNode,this._hostLView);if(aM(e)){let t=Ag(e,this._hostLView),i=xg(e),r=t[it].data[i+8];return new Ol(r,t)}else return new Ol(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let t=YP(this._lContainer);return t!==null&&t[e]||null}get length(){return this._lContainer.length-Xi}createEmbeddedView(e,t,i){let r,s;typeof i=="number"?r=i:i!=null&&(r=i.index,s=i.injector);let o=WP(this._lContainer,e.ssrId),a=e.createEmbeddedViewImpl(t||{},s,o);return this.insertImpl(a,r,qP(this._hostTNode,o)),a}createComponent(e,t,i,r,s){let o=e&&!F5(e),a;if(o)a=t;else{let v=t||{};a=v.index,i=v.injector,r=v.projectableNodes,s=v.environmentInjector||v.ngModuleRef}let l=o?e:new Ou(Ta(e)),u=i||this.parentInjector;if(!s&&l.ngModule==null){let E=(o?u:this.parentInjector).get(Ei,null);E&&(s=E)}let d=Ta(l.componentType??{}),f=WP(this._lContainer,d?.id??null),m=f?.firstChild??null,y=l.create(u,r,m,s);return this.insertImpl(y.hostView,a,qP(this._hostTNode,f)),y}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,i){let r=e._lView;if(G5(r)){let a=this.indexOf(e);if(a!==-1)this.detach(a);else{let l=r[li],u=new fk(l,l[Qr],l[li]);u.detach(u.indexOf(e))}}let s=this._adjustIndex(t),o=this._lContainer;return Kj(o,r,s,i),e.attachToViewContainerRef(),mR(qE(o),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){let t=YP(this._lContainer);return t!==null?t.indexOf(e):-1}remove(e){let t=this._adjustIndex(e,-1),i=ET(this._lContainer,t);i&&(Eg(qE(this._lContainer),t),LM(i[it],i))}detach(e){let t=this._adjustIndex(e,-1),i=ET(this._lContainer,t);return i&&Eg(qE(this._lContainer),t)!=null?new zl(i):null}_adjustIndex(e,t=0){return e??this.length+t}};function YP(n){return n[bg]}function qE(n){return n[bg]||(n[bg]=[])}function pk(n,e){let t,i=e[n.index];return To(i)?t=i:(t=JM(i,e,null,n),e[n.index]=t,t0(e,t)),C6(t,e,n,i),new fk(t,n,e)}function S6(n,e){let t=n[Fn],i=t.createComment(""),r=xr(e,n),s=NM(t,r);return Lg(t,s,i,uj(t,r),!1),i}var C6=D6,x6=()=>!1;function A6(n,e,t){return x6(n,e,t)}function D6(n,e,t,i){if(n[Vl])return;let r;t.type&8?r=bs(i):r=S6(e,t),n[Vl]=r}var DT=class n{constructor(e){this.queryList=e,this.matches=null}clone(){return new n(this.queryList)}setDirty(){this.queryList.setDirty()}},PT=class n{constructor(e=[]){this.queries=e}createEmbeddedView(e){let t=e.queries;if(t!==null){let i=e.contentQueries!==null?e.contentQueries[0]:t.length,r=[];for(let s=0;s<i;s++){let o=t.getByIndex(s),a=this.queries[o.indexInDeclarationView];r.push(a.clone())}return new n(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}finishViewCreation(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)Rw(e,t).matches!==null&&this.queries[t].setDirty()}},RT=class{constructor(e,t,i=null){this.flags=t,this.read=i,typeof e=="string"?this.predicate=F6(e):this.predicate=e}},MT=class n{constructor(e=[]){this.queries=e}elementStart(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let i=0;i<this.length;i++){let r=t!==null?t.length:0,s=this.getByIndex(i).embeddedTView(e,r);s&&(s.indexInDeclarationView=i,t!==null?t.push(s):t=[s])}return t!==null?new n(t):null}template(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}},kT=class n{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new n(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let t=this._declarationNodeIndex,i=e.parent;for(;i!==null&&i.type&8&&i.index!==t;)i=i.parent;return t===(i!==null?i.index:-1)}return this._appliesToNextNode}matchTNode(e,t){let i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){let s=i[r];this.matchTNodeWithReadOption(e,t,P6(t,s)),this.matchTNodeWithReadOption(e,t,mg(t,e,s,!1,!1))}else i===Hl?t.type&4&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,mg(t,e,i,!1,!1))}matchTNodeWithReadOption(e,t,i){if(i!==null){let r=this.metadata.read;if(r!==null)if(r===Zr||r===Aa||r===Hl&&t.type&4)this.addMatch(t.index,-2);else{let s=mg(t,e,r,!1,!1);s!==null&&this.addMatch(t.index,s)}else this.addMatch(t.index,i)}}addMatch(e,t){this.matches===null?this.matches=[e,t]:this.matches.push(e,t)}};function P6(n,e){let t=n.localNames;if(t!==null){for(let i=0;i<t.length;i+=2)if(t[i]===e)return t[i+1]}return null}function R6(n,e){return n.type&11?Vu(n,e):n.type&4?n0(n,e):null}function M6(n,e,t,i){return t===-1?R6(e,n):t===-2?k6(n,e,i):jl(n,n[it],t,e)}function k6(n,e,t){if(t===Zr)return Vu(e,n);if(t===Hl)return n0(e,n);if(t===Aa)return pk(e,n)}function mk(n,e,t,i){let r=e[mo].queries[i];if(r.matches===null){let s=n.data,o=t.matches,a=[];for(let l=0;o!==null&&l<o.length;l+=2){let u=o[l];if(u<0)a.push(null);else{let d=s[u];a.push(M6(e,d,o[l+1],t.metadata.read))}}r.matches=a}return r.matches}function LT(n,e,t,i){let r=n.queries.getByIndex(t),s=r.matches;if(s!==null){let o=mk(n,e,r,t);for(let a=0;a<s.length;a+=2){let l=s[a];if(l>0)i.push(o[a/2]);else{let u=s[a+1],d=e[-l];for(let f=Xi;f<d.length;f++){let m=d[f];m[Fl]===m[li]&&LT(m[it],m,u,i)}if(d[Mu]!==null){let f=d[Mu];for(let m=0;m<f.length;m++){let y=f[m];LT(y[it],y,u,i)}}}}}return i}function L6(n,e){return n[mo].queries[e].queryList}function O6(n,e,t){let i=new yT((t&4)===4);return Sj(n,e,i,i.destroy),(e[mo]??=new PT).queries.push(new DT(i))-1}function N6(n,e,t){let i=ui();return i.firstCreatePass&&(V6(i,new RT(n,e,t),-1),(e&2)===2&&(i.staticViewQueries=!0)),O6(i,At(),e)}function F6(n){return n.split(",").map(e=>e.trim())}function V6(n,e,t){n.queries===null&&(n.queries=new MT),n.queries.track(new kT(e,t))}function Rw(n,e){return n.queries.getByIndex(e)}function B6(n,e){let t=n[it],i=Rw(t,e);return i.crossesNgTemplate?LT(t,n,e,[]):mk(t,n,i,e)}var QP=new Set;function Da(n){QP.has(n)||(QP.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}function U6(n){return typeof n=="function"&&n[ho]!==void 0}function i0(n,e){Da("NgSignals");let t=W1(n),i=t[ho];return e?.equal&&(i.equal=e.equal),t.set=r=>yE(i,r),t.update=r=>K1(i,r),t.asReadonly=$6.bind(t),t}function $6(){let n=this[ho];if(n.readonlyFn===void 0){let e=()=>this();e[ho]=n,n.readonlyFn=e}return n.readonlyFn}function gk(n){return U6(n)&&typeof n.set=="function"}function j6(n){return Object.getPrototypeOf(n.prototype).constructor}function As(n){let e=j6(n.type),t=!0,i=[n];for(;e;){let r;if(wa(n))r=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new me(903,!1);r=e.\u0275dir}if(r){if(t){i.push(r);let o=n;o.inputs=cg(n.inputs),o.inputTransforms=cg(n.inputTransforms),o.declaredInputs=cg(n.declaredInputs),o.outputs=cg(n.outputs);let a=r.hostBindings;a&&W6(n,a);let l=r.viewQuery,u=r.contentQueries;if(l&&H6(n,l),u&&q6(n,u),G6(n,r),U3(n.outputs,r.outputs),wa(r)&&r.data.animation){let d=n.data;d.animation=(d.animation||[]).concat(r.data.animation)}}let s=r.features;if(s)for(let o=0;o<s.length;o++){let a=s[o];a&&a.ngInherit&&a(n),a===As&&(t=!1)}}e=Object.getPrototypeOf(e)}z6(i)}function G6(n,e){for(let t in e.inputs){if(!e.inputs.hasOwnProperty(t)||n.inputs.hasOwnProperty(t))continue;let i=e.inputs[t];if(i!==void 0&&(n.inputs[t]=i,n.declaredInputs[t]=e.declaredInputs[t],e.inputTransforms!==null)){let r=Array.isArray(i)?i[0]:i;if(!e.inputTransforms.hasOwnProperty(r))continue;n.inputTransforms??={},n.inputTransforms[r]=e.inputTransforms[r]}}}function z6(n){let e=0,t=null;for(let i=n.length-1;i>=0;i--){let r=n[i];r.hostVars=e+=r.hostVars,r.hostAttrs=Lh(r.hostAttrs,t=Lh(t,r.hostAttrs))}}function cg(n){return n===Au?{}:n===Ir?[]:n}function H6(n,e){let t=n.viewQuery;t?n.viewQuery=(i,r)=>{e(i,r),t(i,r)}:n.viewQuery=e}function q6(n,e){let t=n.contentQueries;t?n.contentQueries=(i,r,s)=>{e(i,r,s),t(i,r,s)}:n.contentQueries=e}function W6(n,e){let t=n.hostBindings;t?n.hostBindings=(i,r)=>{e(i,r),t(i,r)}:n.hostBindings=e}function Mw(n){let e=n.inputConfig,t={};for(let i in e)if(e.hasOwnProperty(i)){let r=e[i];Array.isArray(r)&&r[3]&&(t[i]=r[3])}n.inputTransforms=t}var ba=class{},Fh=class{};var OT=class extends ba{constructor(e,t,i,r=!0){super(),this.ngModuleType=e,this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Fg(this);let s=bR(e);this._bootstrapComponents=PM(s.bootstrap),this._r3Injector=gM(e,t,[{provide:ba,useValue:this},{provide:Lu,useValue:this.componentFactoryResolver},...i],_i(e),new Set(["environment"])),r&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},NT=class extends Fh{constructor(e){super(),this.moduleType=e}create(e){return new OT(this.moduleType,e,[])}};var Vg=class extends ba{constructor(e){super(),this.componentFactoryResolver=new Fg(this),this.instance=null;let t=new Oh([...e.providers,{provide:ba,useValue:this},{provide:Lu,useValue:this.componentFactoryResolver}],e.parent||tw(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function r0(n,e,t=null){return new Vg({providers:n,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}function yk(n){return Y6(n)?Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n:!1}function K6(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{let t=n[Symbol.iterator](),i;for(;!(i=t.next()).done;)e(i.value)}}function Y6(n){return n!==null&&(typeof n=="function"||typeof n=="object")}function vk(n,e,t){return n[e]=t}function Q6(n,e){return n[e]}function ql(n,e,t){let i=n[e];return Object.is(i,t)?!1:(n[e]=t,!0)}function _k(n,e,t,i){let r=ql(n,e,t);return ql(n,e+1,i)||r}function Z6(n){return(n.flags&32)===32}function X6(n,e,t,i,r,s,o,a,l){let u=e.consts,d=e0(e,n,4,o||null,a||null);QM(e,t,d,Cg(u,l)),uw(e,d);let f=d.tView=Cw(2,d,i,r,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,u,null);return e.queries!==null&&(e.queries.template(e,d),f.queries=e.queries.embeddedTView(d)),d}function J6(n,e,t,i,r,s,o,a,l,u){let d=t+Kr,f=e.firstCreatePass?X6(d,e,n,i,r,s,o,a,l):e.data[d];$h(f,!1);let m=e8(e,n,f,t);lw()&&bw(e,n,m,f),Gl(m,n);let y=JM(m,n,m,f);return n[d]=y,t0(n,y),A6(y,f,n),nw(f)&&qM(e,n,f),l!=null&&WM(n,f,u),f}function Be(n,e,t,i,r,s,o,a){let l=At(),u=ui(),d=Cg(u.consts,s);return J6(l,u,n,e,t,i,r,d,o,a),Be}var e8=t8;function t8(n,e,t,i){return cw(!0),e[Fn].createComment("")}var bu=function(n){return n[n.EarlyRead=0]="EarlyRead",n[n.Write=1]="Write",n[n.MixedReadWrite=2]="MixedReadWrite",n[n.Read=3]="Read",n}(bu||{}),Ek=(()=>{class n{constructor(){this.impl=null}execute(){this.impl?.execute()}static{this.\u0275prov=Se({token:n,providedIn:"root",factory:()=>new n})}}return n})(),FT=class n{constructor(){this.ngZone=le(Ct),this.scheduler=le(ku),this.errorHandler=le(go,{optional:!0}),this.sequences=new Set,this.deferredRegistrations=new Set,this.executing=!1}static{this.PHASES=[bu.EarlyRead,bu.Write,bu.MixedReadWrite,bu.Read]}execute(){this.executing=!0;for(let e of n.PHASES)for(let t of this.sequences)if(!(t.erroredOrDestroyed||!t.hooks[e]))try{t.pipelinedValue=this.ngZone.runOutsideAngular(()=>t.hooks[e](t.pipelinedValue))}catch(i){t.erroredOrDestroyed=!0,this.errorHandler?.handleError(i)}this.executing=!1;for(let e of this.sequences)e.afterRun(),e.once&&(this.sequences.delete(e),e.destroy());for(let e of this.deferredRegistrations)this.sequences.add(e);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear()}register(e){this.executing?this.deferredRegistrations.add(e):(this.sequences.add(e),this.scheduler.notify(6))}unregister(e){this.executing&&this.sequences.has(e)?(e.erroredOrDestroyed=!0,e.pipelinedValue=void 0,e.once=!0):(this.sequences.delete(e),this.deferredRegistrations.delete(e))}static{this.\u0275prov=Se({token:n,providedIn:"root",factory:()=>new n})}},VT=class{constructor(e,t,i,r){this.impl=e,this.hooks=t,this.once=i,this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.unregisterOnDestroy=r?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.()}};function kw(n,e){!e?.injector&&N5(kw);let t=e?.injector??le(ii);return X4(t)?(Da("NgAfterNextRender"),i8(n,t,e,!0)):r8}function n8(n,e){if(n instanceof Function){let t=[void 0,void 0,void 0,void 0];return t[e]=n,t}else return[n.earlyRead,n.write,n.mixedReadWrite,n.read]}function i8(n,e,t,i){let r=e.get(Ek);r.impl??=e.get(FT);let s=t?.phase??bu.MixedReadWrite,o=t?.manualCleanup!==!0?e.get(fw):null,a=new VT(r.impl,n8(n,s),i,o);return r.impl.register(a),a}var r8={destroy(){}};function Ds(n,e,t,i){let r=At(),s=Qg();if(ql(r,s,e)){let o=ui(),a=aw();Uj(a,r,n,e,t,i)}return Ds}function s8(n,e,t,i){return ql(n,Qg(),t)?e+xu(t)+i:xs}function o8(n,e,t,i,r,s){let o=t4(),a=_k(n,o,t,r);return XR(2),a?e+xu(t)+i+xu(r)+s:xs}function ug(n,e){return n<<17|e<<2}function Wl(n){return n>>17&32767}function a8(n){return(n&2)==2}function l8(n,e){return n&131071|e<<17}function BT(n){return n|2}function Nu(n){return(n&131068)>>2}function WE(n,e){return n&-131069|e<<2}function c8(n){return(n&1)===1}function UT(n){return n|1}function u8(n,e,t,i,r,s){let o=s?e.classBindings:e.styleBindings,a=Wl(o),l=Nu(o);n[i]=t;let u=!1,d;if(Array.isArray(t)){let f=t;d=f[1],(d===null||Uh(f,d)>0)&&(u=!0)}else d=t;if(r)if(l!==0){let m=Wl(n[a+1]);n[i+1]=ug(m,a),m!==0&&(n[m+1]=WE(n[m+1],i)),n[a+1]=l8(n[a+1],i)}else n[i+1]=ug(a,0),a!==0&&(n[a+1]=WE(n[a+1],i)),a=i;else n[i+1]=ug(l,0),a===0?a=i:n[l+1]=WE(n[l+1],i),l=i;u&&(n[i+1]=BT(n[i+1])),ZP(n,d,i,!0),ZP(n,d,i,!1),d8(e,d,n,i,s),o=ug(a,l),s?e.classBindings=o:e.styleBindings=o}function d8(n,e,t,i,r){let s=r?n.residualClasses:n.residualStyles;s!=null&&typeof e=="string"&&Uh(s,e)>=0&&(t[i+1]=UT(t[i+1]))}function ZP(n,e,t,i){let r=n[t+1],s=e===null,o=i?Wl(r):Nu(r),a=!1;for(;o!==0&&(a===!1||s);){let l=n[o],u=n[o+1];h8(l,e)&&(a=!0,n[o+1]=i?UT(u):BT(u)),o=i?Wl(u):Nu(u)}a&&(n[t+1]=i?BT(r):UT(r))}function h8(n,e){return n===null||e==null||(Array.isArray(n)?n[1]:n)===e?!0:Array.isArray(n)&&typeof e=="string"?Uh(n,e)>=0:!1}function ce(n,e,t){let i=At(),r=Qg();if(ql(i,r,e)){let s=ui(),o=aw();YM(s,o,i,n,e,i[Fn],t,!1)}return ce}function XP(n,e,t,i,r){let s=e.inputs,o=r?"class":"style";xw(n,t,s[o],o,i)}function Io(n,e,t){return Tk(n,e,t,!1),Io}function ct(n,e){return Tk(n,e,null,!0),ct}function Tk(n,e,t,i){let r=At(),s=ui(),o=XR(2);if(s.firstUpdatePass&&p8(s,n,o,i),e!==xs&&ql(r,o,e)){let a=s.data[Kl()];_8(s,a,r,r[Fn],n,r[o+1]=E8(e,t),i,o)}}function f8(n,e){return e>=n.expandoStartIndex}function p8(n,e,t,i){let r=n.data;if(r[t+1]===null){let s=r[Kl()],o=f8(n,t);T8(s,i)&&e===null&&!o&&(e=!1),e=m8(r,s,e,i),u8(r,s,e,t,o,i)}}function m8(n,e,t,i){let r=o4(n),s=i?e.residualClasses:e.residualStyles;if(r===null)(i?e.classBindings:e.styleBindings)===0&&(t=KE(null,n,e,t,i),t=Vh(t,e.attrs,i),s=null);else{let o=e.directiveStylingLast;if(o===-1||n[o]!==r)if(t=KE(r,n,e,t,i),s===null){let l=g8(n,e,i);l!==void 0&&Array.isArray(l)&&(l=KE(null,n,e,l[1],i),l=Vh(l,e.attrs,i),y8(n,e,i,l))}else s=v8(n,e,i)}return s!==void 0&&(i?e.residualClasses=s:e.residualStyles=s),t}function g8(n,e,t){let i=t?e.classBindings:e.styleBindings;if(Nu(i)!==0)return n[Wl(i)]}function y8(n,e,t,i){let r=t?e.classBindings:e.styleBindings;n[Wl(r)]=i}function v8(n,e,t){let i,r=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<r;s++){let o=n[s].hostAttrs;i=Vh(i,o,t)}return Vh(i,e.attrs,t)}function KE(n,e,t,i,r){let s=null,o=t.directiveEnd,a=t.directiveStylingLast;for(a===-1?a=t.directiveStart:a++;a<o&&(s=e[a],i=Vh(i,s.hostAttrs,r),s!==n);)a++;return n!==null&&(t.directiveStylingLast=a),i}function Vh(n,e,t){let i=t?1:2,r=-1;if(e!==null)for(let s=0;s<e.length;s++){let o=e[s];typeof o=="number"?r=o:r===i&&(Array.isArray(n)||(n=n===void 0?[]:["",n]),l5(n,o,t?!0:e[++s]))}return n===void 0?null:n}function _8(n,e,t,i,r,s,o,a){if(!(e.type&3))return;let l=n.data,u=l[a+1],d=c8(u)?JP(l,e,t,r,Nu(u),o):void 0;if(!Bg(d)){Bg(s)||a8(u)&&(s=JP(l,null,t,r,a,o));let f=UR(Kl(),t);yj(i,o,f,r,s)}}function JP(n,e,t,i,r,s){let o=e===null,a;for(;r>0;){let l=n[r],u=Array.isArray(l),d=u?l[1]:l,f=d===null,m=t[r+1];m===xs&&(m=f?Ir:void 0);let y=f?VE(m,i):d===i?m:void 0;if(u&&!Bg(y)&&(y=VE(l,i)),Bg(y)&&(a=y,o))return a;let v=n[r+1];r=o?Wl(v):Nu(v)}if(e!==null){let l=s?e.residualClasses:e.residualStyles;l!=null&&(a=VE(l,i))}return a}function Bg(n){return n!==void 0}function E8(n,e){return n==null||n===""||(typeof e=="string"?n=n+e:typeof n=="object"&&(n=_i(jh(n)))),n}function T8(n,e){return(n.flags&(e?8:16))!==0}function w8(n,e,t,i,r,s){let o=e.consts,a=Cg(o,r),l=e0(e,n,2,i,a);return QM(e,t,l,Cg(o,s)),l.attrs!==null&&xT(l,l.attrs,!1),l.mergedAttrs!==null&&xT(l,l.mergedAttrs,!0),e.queries!==null&&e.queries.elementStart(e,l),l}function N(n,e,t,i){let r=At(),s=ui(),o=Kr+n,a=r[Fn],l=s.firstCreatePass?w8(o,s,r,e,t,i):s.data[o],u=I8(s,r,l,a,e,n);r[o]=u;let d=nw(l);return $h(l,!0),BM(a,u,l),!Z6(l)&&lw()&&bw(s,r,u,l),q5()===0&&Gl(u,r),W5(),d&&(qM(s,r,l),HM(s,l,r)),i!==null&&WM(r,l),N}function $(){let n=Ti();YR()?J5():(n=n.parent,$h(n,!1));let e=n;Q5(e)&&Z5(),K5();let t=ui();return t.firstCreatePass&&(uw(t,n),LR(n)&&t.queries.elementEnd(n)),e.classesWithoutHost!=null&&p4(e)&&XP(t,e,At(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&m4(e)&&XP(t,e,At(),e.stylesWithoutHost,!1),$}function fe(n,e,t,i){return N(n,e,t,i),$(),fe}var I8=(n,e,t,i,r,s)=>(cw(!0),RM(i,r,u4()));function Tt(){return At()}var kl=void 0;function b8(n){let e=n,t=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return t===1&&i===0?1:5}var S8=["en",[["a","p"],["AM","PM"],kl],[["AM","PM"],kl,kl],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],kl,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],kl,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",kl,"{1} 'at' {0}",kl],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",b8],YE={};function Ji(n){let e=C8(n),t=eR(e);if(t)return t;let i=e.split("-")[0];if(t=eR(i),t)return t;if(i==="en")return S8;throw new me(701,!1)}function eR(n){return n in YE||(YE[n]=Ll.ng&&Ll.ng.common&&Ll.ng.common.locales&&Ll.ng.common.locales[n]),YE[n]}var mn=function(n){return n[n.LocaleId=0]="LocaleId",n[n.DayPeriodsFormat=1]="DayPeriodsFormat",n[n.DayPeriodsStandalone=2]="DayPeriodsStandalone",n[n.DaysFormat=3]="DaysFormat",n[n.DaysStandalone=4]="DaysStandalone",n[n.MonthsFormat=5]="MonthsFormat",n[n.MonthsStandalone=6]="MonthsStandalone",n[n.Eras=7]="Eras",n[n.FirstDayOfWeek=8]="FirstDayOfWeek",n[n.WeekendRange=9]="WeekendRange",n[n.DateFormat=10]="DateFormat",n[n.TimeFormat=11]="TimeFormat",n[n.DateTimeFormat=12]="DateTimeFormat",n[n.NumberSymbols=13]="NumberSymbols",n[n.NumberFormats=14]="NumberFormats",n[n.CurrencyCode=15]="CurrencyCode",n[n.CurrencySymbol=16]="CurrencySymbol",n[n.CurrencyName=17]="CurrencyName",n[n.Currencies=18]="Currencies",n[n.Directionality=19]="Directionality",n[n.PluralCase=20]="PluralCase",n[n.ExtraData=21]="ExtraData",n}(mn||{});function C8(n){return n.toLowerCase().replace(/_/g,"-")}var Ug="en-US";var x8=Ug;function A8(n){typeof n=="string"&&(x8=n.toLowerCase().replace(/_/g,"-"))}var D8=(n,e,t)=>{};function ve(n,e,t,i){let r=At(),s=ui(),o=Ti();return wk(s,r,r[Fn],o,n,e,i),ve}function P8(n,e,t,i){let r=n.cleanup;if(r!=null)for(let s=0;s<r.length-1;s+=2){let o=r[s];if(o===t&&r[s+1]===i){let a=e[Ig],l=r[s+2];return a.length>l?a[l]:null}typeof o=="string"&&(s+=2)}return null}function wk(n,e,t,i,r,s,o){let a=nw(i),u=n.firstCreatePass&&nk(n),d=e[Wr],f=tk(e),m=!0;if(i.type&3||o){let E=xr(i,e),T=o?o(E):E,C=f.length,D=o?V=>o(bs(V[i.index])):i.index,P=null;if(!o&&a&&(P=P8(n,e,r,i.index)),P!==null){let V=P.__ngLastListenerFn__||P;V.__ngNextListenerFn__=s,P.__ngLastListenerFn__=s,m=!1}else{s=nR(i,e,d,s),D8(E,r,s);let V=t.listen(T,r,s);f.push(s,V),u&&u.push(r,D,C,C+1)}}else s=nR(i,e,d,s);let y=i.outputs,v;if(m&&y!==null&&(v=y[r])){let E=v.length;if(E)for(let T=0;T<E;T+=2){let C=v[T],D=v[T+1],G=e[C][D].subscribe(s),H=f.length;f.push(s,G),u&&u.push(r,i.index,H,-(H+1))}}}function tR(n,e,t,i){let r=St(null);try{return _s(6,e,t),t(i)!==!1}catch(s){return ik(n,s),!1}finally{_s(7,e,t),St(r)}}function nR(n,e,t,i){return function r(s){if(s===Function)return i;let o=n.componentOffset>-1?Sa(n.index,e):e;Dw(o,5);let a=tR(e,t,i,s),l=r.__ngNextListenerFn__;for(;l;)a=tR(e,t,l,s)&&a,l=l.__ngNextListenerFn__;return a}}function Ce(n=1){return l4(n)}function er(n,e,t){N6(n,e,t)}function Oi(n){let e=At(),t=ui(),i=JR();rw(i+1);let r=Rw(t,i);if(n.dirty&&j5(e)===((r.metadata.flags&2)===2)){if(r.matches===null)n.reset([]);else{let s=B6(e,i);n.reset(s,N4),n.notifyOnChanges()}return!0}return!1}function Ni(){return L6(At(),JR())}function R8(n,e,t,i){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=i}function Ql(n){let e=e4();return jR(e,Kr+n)}function X(n,e=""){let t=At(),i=ui(),r=n+Kr,s=i.firstCreatePass?e0(i,r,1,e,null):i.data[r],o=M8(i,t,s,e,n);t[r]=o,lw()&&bw(i,t,o,s),$h(s,!1)}var M8=(n,e,t,i,r)=>(cw(!0),ej(e[Fn],i));function Ot(n){return pt("",n,""),Ot}function pt(n,e,t){let i=At(),r=s8(i,n,e,t);return r!==xs&&rk(i,Kl(),r),pt}function Lw(n,e,t,i,r){let s=At(),o=o8(s,n,e,t,i,r);return o!==xs&&rk(s,Kl(),o),Lw}function Vn(n,e,t){gk(e)&&(e=e());let i=At(),r=Qg();if(ql(i,r,e)){let s=ui(),o=aw();YM(s,o,i,n,e,i[Fn],t,!1)}return Vn}function qn(n,e){let t=gk(n);return t&&n.set(e),t}function Bn(n,e){let t=At(),i=ui(),r=Ti();return wk(i,t,t[Fn],r,n,e),Bn}function k8(n,e,t){let i=ui();if(i.firstCreatePass){let r=wa(n);$T(t,i.data,i.blueprint,r,!0),$T(e,i.data,i.blueprint,r,!1)}}function $T(n,e,t,i,r){if(n=vi(n),Array.isArray(n))for(let s=0;s<n.length;s++)$T(n[s],e,t,i,r);else{let s=ui(),o=At(),a=Ti(),l=Pu(n)?n:vi(n.provide),u=PR(n),d=a.providerIndexes&1048575,f=a.directiveStart,m=a.providerIndexes>>20;if(Pu(n)||!n.multi){let y=new $l(u,r,Te),v=ZE(l,e,r?d:d+m,f);v===-1?(dT(Pg(a,o),s,l),QE(s,n,e.length),e.push(l),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),t.push(y),o.push(y)):(t[v]=y,o[v]=y)}else{let y=ZE(l,e,d+m,f),v=ZE(l,e,d,d+m),E=y>=0&&t[y],T=v>=0&&t[v];if(r&&!T||!r&&!E){dT(Pg(a,o),s,l);let C=N8(r?O8:L8,t.length,r,i,u);!r&&T&&(t[v].providerFactory=C),QE(s,n,e.length,0),e.push(l),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),t.push(C),o.push(C)}else{let C=Ik(t[r?v:y],u,!r&&i);QE(s,n,y>-1?y:v,C)}!r&&i&&T&&t[v].componentProviders++}}}function QE(n,e,t,i){let r=Pu(e),s=D5(e);if(r||s){let l=(s?vi(e.useClass):e).prototype.ngOnDestroy;if(l){let u=n.destroyHooks||(n.destroyHooks=[]);if(!r&&e.multi){let d=u.indexOf(t);d===-1?u.push(t,[i,l]):u[d+1].push(i,l)}else u.push(t,l)}}}function Ik(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function ZE(n,e,t,i){for(let r=t;r<i;r++)if(e[r]===n)return r;return-1}function L8(n,e,t,i){return jT(this.multi,[])}function O8(n,e,t,i){let r=this.multi,s;if(this.providerFactory){let o=this.providerFactory.componentProviders,a=jl(t,t[it],this.providerFactory.index,i);s=a.slice(0,o),jT(r,s);for(let l=o;l<a.length;l++)s.push(a[l])}else s=[],jT(r,s);return s}function jT(n,e){for(let t=0;t<n.length;t++){let i=n[t];e.push(i())}return e}function N8(n,e,t,i,r){let s=new $l(n,t,Te);return s.multi=[],s.index=e,s.componentProviders=0,Ik(s,r,i&&!t),s}function Zl(n,e=[]){return t=>{t.providersResolver=(i,r)=>k8(i,r?r(n):n,e)}}var F8=(()=>{class n{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){let i=xR(!1,t.type),r=i.length>0?r0([i],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,r)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(let t of this.cachedInjectors.values())t!==null&&t.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=Se({token:n,providedIn:"environment",factory:()=>new n(Me(Ei))})}}return n})();function Pt(n){Da("NgStandalone"),n.getStandaloneInjector=e=>e.get(F8).getOrCreateStandaloneInjector(n)}function bk(n,e,t){let i=ZR()+n,r=At();return r[i]===xs?vk(r,i,t?e.call(t):e()):Q6(r,i)}function V8(n,e){let t=n[e];return t===xs?void 0:t}function B8(n,e,t,i,r,s,o){let a=e+t;return _k(n,a,r,s)?vk(n,a+2,o?i.call(o,r,s):i(r,s)):V8(n,a+2)}function Gh(n,e){let t=ui(),i,r=n+Kr;t.firstCreatePass?(i=U8(e,t.pipeRegistry),t.data[r]=i,i.onDestroy&&(t.destroyHooks??=[]).push(r,i.onDestroy)):i=t.data[r];let s=i.factory||(i.factory=Nl(i.type,!0)),o,a=ki(Te);try{let l=Dg(!1),u=s();return Dg(l),R8(t,At(),r,u),u}finally{ki(a)}}function U8(n,e){if(e)for(let t=e.length-1;t>=0;t--){let i=e[t];if(n===i.name)return i}}function zh(n,e,t,i){let r=n+Kr,s=At(),o=jR(s,r);return $8(s,r)?B8(s,ZR(),e,o.transform,t,i,o):o.transform(t,i)}function $8(n,e){return n[it].data[e].pure}function s0(n,e){return n0(n,e)}var vo=class{constructor(e){this.full=e;let t=e.split(".");this.major=t[0],this.minor=t[1],this.patch=t.slice(2).join(".")}},Sk=new vo("18.2.14");var o0=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"platform"})}}return n})();var Ck=new Pe("");function Xl(n){return!!n&&typeof n.then=="function"}function xk(n){return!!n&&typeof n.subscribe=="function"}var a0=new Pe(""),Ak=(()=>{class n{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,i)=>{this.resolve=t,this.reject=i}),this.appInits=le(a0,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let t=[];for(let r of this.appInits){let s=r();if(Xl(s))t.push(s);else if(xk(s)){let o=new Promise((a,l)=>{s.subscribe({complete:a,error:l})});t.push(o)}}let i=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{i()}).catch(r=>{this.reject(r)}),t.length===0&&i(),this.initialized=!0}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Hh=new Pe("");function j8(){q1(()=>{throw new me(600,!1)})}function G8(n){return n.isBoundToModule}var z8=10;function H8(n,e,t){try{let i=t();return Xl(i)?i.catch(r=>{throw e.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>n.handleError(i)),i}}var Pa=(()=>{class n{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=le(L4),this.afterRenderManager=le(Ek),this.zonelessEnabled=le(Pw),this.dirtyFlags=0,this.deferredDirtyFlags=0,this.externalTestViews=new Set,this.beforeRender=new Hn,this.afterTick=new Hn,this.componentTypes=[],this.components=[],this.isStable=le(Ca).hasPendingTasks.pipe(qe(t=>!t)),this._injector=le(Ei)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}whenStable(){let t;return new Promise(i=>{t=this.isStable.subscribe({next:r=>{r&&i()}})}).finally(()=>{t.unsubscribe()})}get injector(){return this._injector}bootstrap(t,i){let r=t instanceof Ng;if(!this._injector.get(Ak).done){let m=!r&&IR(t),y=!1;throw new me(405,y)}let o;r?o=t:o=this._injector.get(Lu).resolveComponentFactory(t),this.componentTypes.push(o.componentType);let a=G8(o)?void 0:this._injector.get(ba),l=i||o.selector,u=o.create(ii.NULL,[],l,a),d=u.location.nativeElement,f=u.injector.get(Ck,null);return f?.registerApplication(d),u.onDestroy(()=>{this.detachView(u.hostView),gg(this.components,u),f?.unregisterApplication(d)}),this._loadComponent(u),u}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){if(this._runningTick)throw new me(101,!1);let t=St(null);try{this._runningTick=!0,this.synchronize()}catch(i){this.internalErrorHandler(i)}finally{this._runningTick=!1,St(t),this.afterTick.next()}}synchronize(){let t=null;this._injector.destroyed||(t=this._injector.get(Ia,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let i=0;for(;this.dirtyFlags!==0&&i++<z8;)this.synchronizeOnce(t)}synchronizeOnce(t){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,this.dirtyFlags&7){let i=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8,this.beforeRender.next(i);for(let{_lView:r,notifyErrorHandler:s}of this._views)q8(r,s,i,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&7)return}else t?.begin?.(),t?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:t})=>Kg(t))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(t){let i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){let i=t;gg(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);let i=this._injector.get(Hh,[]);[...this._bootstrapListeners,...i].forEach(r=>r(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>gg(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new me(406,!1);let t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function gg(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function q8(n,e,t,i){if(!t&&!Kg(n))return;ak(n,e,t&&!i?0:1)}var GT=class{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}},l0=(()=>{class n{compileModuleSync(t){return new NT(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){let i=this.compileModuleSync(t),r=bR(t),s=PM(r.declarations).reduce((o,a)=>{let l=Ta(a);return l&&o.push(new Ou(l)),o},[]);return new GT(i,s)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var W8=(()=>{class n{constructor(){this.zone=le(Ct),this.changeDetectionScheduler=le(ku),this.applicationRef=le(Pa)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function K8({ngZoneFactory:n,ignoreChangesOutsideZone:e,scheduleInRootZone:t}){return n??=()=>new Ct(Ye(ue({},Y8()),{scheduleInRootZone:t})),[{provide:Ct,useFactory:n},{provide:Du,multi:!0,useFactory:()=>{let i=le(W8,{optional:!0});return()=>i.initialize()}},{provide:Du,multi:!0,useFactory:()=>{let i=le(Q8);return()=>{i.initialize()}}},e===!0?{provide:dk,useValue:!0}:[],{provide:hk,useValue:t??yM}]}function Y8(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}var Q8=(()=>{class n{constructor(){this.subscription=new pn,this.initialized=!1,this.zone=le(Ct),this.pendingTasks=le(Ca)}initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Ct.assertNotInAngularZone(),queueMicrotask(()=>{t!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Ct.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Z8=(()=>{class n{constructor(){this.appRef=le(Pa),this.taskService=le(Ca),this.ngZone=le(Ct),this.zonelessEnabled=le(Pw),this.disableScheduling=le(dk,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new pn,this.angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Mg):null,this.scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(le(hk,{optional:!0})??!1),this.cancelScheduledCallback=null,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof gT||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&t===5)return;switch(t){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 7:{this.appRef.deferredDirtyFlags|=8;break}case 9:case 8:case 6:case 10:default:this.appRef.dirtyFlags|=8}if(!this.shouldScheduleTick())return;let i=this.useMicrotaskScheduler?FP:vM;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>i(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>i(()=>this.tick()))}shouldScheduleTick(){return!(this.disableScheduling||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Mg+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(i){throw this.taskService.remove(t),i}finally{this.cleanup()}this.useMicrotaskScheduler=!0,FP(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function X8(){return typeof $localize<"u"&&$localize.locale||Ug}var qh=new Pe("",{providedIn:"root",factory:()=>le(qh,dt.Optional|dt.SkipSelf)||X8()});var zT=new Pe("");function dg(n){return!n.moduleRef}function J8(n){let e=dg(n)?n.r3Injector:n.moduleRef.injector,t=e.get(Ct);return t.run(()=>{dg(n)?n.r3Injector.resolveInjectorInitializers():n.moduleRef.resolveInjectorInitializers();let i=e.get(go,null),r;if(t.runOutsideAngular(()=>{r=t.onError.subscribe({next:s=>{i.handleError(s)}})}),dg(n)){let s=()=>e.destroy(),o=n.platformInjector.get(zT);o.add(s),e.onDestroy(()=>{r.unsubscribe(),o.delete(s)})}else{let s=()=>n.moduleRef.destroy(),o=n.platformInjector.get(zT);o.add(s),n.moduleRef.onDestroy(()=>{gg(n.allPlatformModules,n.moduleRef),r.unsubscribe(),o.delete(s)})}return H8(i,t,()=>{let s=e.get(Ak);return s.runInitializers(),s.donePromise.then(()=>{let o=e.get(qh,Ug);if(A8(o||Ug),dg(n)){let a=e.get(Pa);return n.rootComponent!==void 0&&a.bootstrap(n.rootComponent),a}else return eG(n.moduleRef,n.allPlatformModules),n.moduleRef})})})}function eG(n,e){let t=n.injector.get(Pa);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(i=>t.bootstrap(i));else if(n.instance.ngDoBootstrap)n.instance.ngDoBootstrap(t);else throw new me(-403,!1);e.push(n)}var yg=null,Dk=new Pe("");function tG(n=[],e){return ii.create({name:e,providers:[{provide:Hg,useValue:"platform"},{provide:zT,useValue:new Set([()=>yg=null])},...n]})}function nG(n=[]){if(yg)return yg;let e=tG(n);return e.get(Dk,!1)||(yg=e),j8(),iG(e),e}function iG(n){n.get(yw,null)?.forEach(t=>t())}var tr=(()=>{class n{static{this.__NG_ELEMENT_ID__=rG}}return n})();function rG(n){return sG(Ti(),At(),(n&16)===16)}function sG(n,e,t){if(Wg(n)&&!t){let i=Sa(n.index,e);return new zl(i,i)}else if(n.type&175){let i=e[Is];return new zl(i,e)}return null}var HT=class{constructor(){}supports(e){return yk(e)}create(e){return new qT(e)}},oG=(n,e)=>e,qT=class{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||oG}forEachItem(e){let t;for(t=this._itHead;t!==null;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,i=this._removalsHead,r=0,s=null;for(;t||i;){let o=!i||t&&t.currentIndex<iR(i,r,s)?t:i,a=iR(o,r,s),l=o.currentIndex;if(o===i)r--,i=i._nextRemoved;else if(t=t._next,o.previousIndex==null)r++;else{s||(s=[]);let u=a-r,d=l-r;if(u!=d){for(let m=0;m<u;m++){let y=m<s.length?s[m]:s[m]=0,v=y+m;d<=v&&v<u&&(s[m]=y+1)}let f=o.previousIndex;s[f]=d-u}}a!==l&&e(o,a,l)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;t!==null;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;t!==null;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;t!==null;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;t!==null;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;t!==null;t=t._nextIdentityChange)e(t)}diff(e){if(e==null&&(e=[]),!yk(e))throw new me(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._itHead,i=!1,r,s,o;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)s=e[a],o=this._trackByFn(a,s),t===null||!Object.is(t.trackById,o)?(t=this._mismatch(t,s,o,a),i=!0):(i&&(t=this._verifyReinsertion(t,s,o,a)),Object.is(t.item,s)||this._addIdentityChange(t,s)),t=t._next}else r=0,K6(e,a=>{o=this._trackByFn(r,a),t===null||!Object.is(t.trackById,o)?(t=this._mismatch(t,a,o,r),i=!0):(i&&(t=this._verifyReinsertion(t,a,o,r)),Object.is(t.item,a)||this._addIdentityChange(t,a)),t=t._next,r++}),this.length=r;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;e!==null;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;e!==null;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;e!==null;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,i,r){let s;return e===null?s=this._itTail:(s=e._prev,this._remove(e)),e=this._unlinkedRecords===null?null:this._unlinkedRecords.get(i,null),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,s,r)):(e=this._linkedRecords===null?null:this._linkedRecords.get(i,r),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,s,r)):e=this._addAfter(new WT(t,i),s,r)),e}_verifyReinsertion(e,t,i,r){let s=this._unlinkedRecords===null?null:this._unlinkedRecords.get(i,null);return s!==null?e=this._reinsertAfter(s,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;e!==null;){let t=e._next;this._addToRemovals(this._unlink(e)),e=t}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,i){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(e);let r=e._prevRemoved,s=e._nextRemoved;return r===null?this._removalsHead=s:r._nextRemoved=s,s===null?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(e,t,i),this._addToMoves(e,i),e}_moveAfter(e,t,i){return this._unlink(e),this._insertAfter(e,t,i),this._addToMoves(e,i),e}_addAfter(e,t,i){return this._insertAfter(e,t,i),this._additionsTail===null?this._additionsTail=this._additionsHead=e:this._additionsTail=this._additionsTail._nextAdded=e,e}_insertAfter(e,t,i){let r=t===null?this._itHead:t._next;return e._next=r,e._prev=t,r===null?this._itTail=e:r._prev=e,t===null?this._itHead=e:t._next=e,this._linkedRecords===null&&(this._linkedRecords=new $g),this._linkedRecords.put(e),e.currentIndex=i,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){this._linkedRecords!==null&&this._linkedRecords.remove(e);let t=e._prev,i=e._next;return t===null?this._itHead=i:t._next=i,i===null?this._itTail=t:i._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail===null?this._movesTail=this._movesHead=e:this._movesTail=this._movesTail._nextMoved=e),e}_addToRemovals(e){return this._unlinkedRecords===null&&(this._unlinkedRecords=new $g),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=e:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=e,e}},WT=class{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},KT=class{constructor(){this._head=null,this._tail=null}add(e){this._head===null?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let i;for(i=this._head;i!==null;i=i._nextDup)if((t===null||t<=i.currentIndex)&&Object.is(i.trackById,e))return i;return null}remove(e){let t=e._prevDup,i=e._nextDup;return t===null?this._head=i:t._nextDup=i,i===null?this._tail=t:i._prevDup=t,this._head===null}},$g=class{constructor(){this.map=new Map}put(e){let t=e.trackById,i=this.map.get(t);i||(i=new KT,this.map.set(t,i)),i.add(e)}get(e,t){let i=e,r=this.map.get(i);return r?r.get(e,t):null}remove(e){let t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function iR(n,e,t){let i=n.previousIndex;if(i===null)return i;let r=0;return t&&i<t.length&&(r=t[i]),i+e+r}function rR(){return new Ow([new HT])}var Ow=(()=>{class n{static{this.\u0275prov=Se({token:n,providedIn:"root",factory:rR})}constructor(t){this.factories=t}static create(t,i){if(i!=null){let r=i.factories.slice();t=t.concat(r)}return new n(t)}static extend(t){return{provide:n,useFactory:i=>n.create(t,i||rR()),deps:[[n,new QT,new ci]]}}find(t){let i=this.factories.find(r=>r.supports(t));if(i!=null)return i;throw new me(901,!1)}}return n})();function Pk(n){let{rootComponent:e,appProviders:t,platformProviders:i,platformRef:r}=n;try{let s=r?.injector??nG(i);if(s.get(Dk,!1)===!0&&!n.platformRef)throw new me(401,!1);let o=[K8({}),{provide:ku,useExisting:Z8},...t||[]],a=new Vg({providers:o,parent:s,debugName:"",runEnvironmentInitializers:!1});return J8({r3Injector:a.injector,platformInjector:s,rootComponent:e})}catch(s){return Promise.reject(s)}}function Jl(n){return typeof n=="boolean"?n:n!=null&&n!=="false"}function c0(n,e){Da("NgSignals");let t=G1(n);return e?.equal&&(t[ho].equal=e.equal),t}function Ra(n){let e=St(null);try{return n()}finally{St(e)}}function Rk(n){let e=Ta(n);if(!e)return null;let t=new Ou(e);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return e.standalone},get isSignal(){return e.signals}}}var Vk=null;function Ao(){return Vk}function Bk(n){Vk??=n}var v0=class{};var Wn=new Pe(""),Hw=(()=>{class n{historyGo(t){throw new Error("")}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>le(lG),providedIn:"platform"})}}return n})(),Uk=new Pe(""),lG=(()=>{class n extends Hw{constructor(){super(),this._doc=le(Wn),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ao().getBaseHref(this._doc)}onPopState(t){let i=Ao().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",t,!1),()=>i.removeEventListener("popstate",t)}onHashChange(t){let i=Ao().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",t,!1),()=>i.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,i,r){this._history.pushState(t,i,r)}replaceState(t,i,r){this._history.replaceState(t,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>new n,providedIn:"platform"})}}return n})();function qw(n,e){if(n.length==0)return e;if(e.length==0)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,t==2?n+e.substring(1):t==1?n+e:n+"/"+e}function Mk(n){let e=n.match(/#|\?|$/),t=e&&e.index||n.length,i=t-(n[t-1]==="/"?1:0);return n.slice(0,i)+n.slice(t)}function So(n){return n&&n[0]!=="?"?"?"+n:n}var Do=(()=>{class n{historyGo(t){throw new Error("")}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>le(Ww),providedIn:"root"})}}return n})(),$k=new Pe(""),Ww=(()=>{class n extends Do{constructor(t,i){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??le(Wn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return qw(this._baseHref,t)}path(t=!1){let i=this._platformLocation.pathname+So(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${i}${r}`:i}pushState(t,i,r,s){let o=this.prepareExternalUrl(r+So(s));this._platformLocation.pushState(t,i,o)}replaceState(t,i,r,s){let o=this.prepareExternalUrl(r+So(s));this._platformLocation.replaceState(t,i,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static{this.\u0275fac=function(i){return new(i||n)(Me(Hw),Me($k,8))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),jk=(()=>{class n extends Do{constructor(t,i){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],i!=null&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let i=this._platformLocation.hash??"#";return i.length>0?i.substring(1):i}prepareExternalUrl(t){let i=qw(this._baseHref,t);return i.length>0?"#"+i:i}pushState(t,i,r,s){let o=this.prepareExternalUrl(r+So(s));o.length==0&&(o=this._platformLocation.pathname),this._platformLocation.pushState(t,i,o)}replaceState(t,i,r,s){let o=this.prepareExternalUrl(r+So(s));o.length==0&&(o=this._platformLocation.pathname),this._platformLocation.replaceState(t,i,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static{this.\u0275fac=function(i){return new(i||n)(Me(Hw),Me($k,8))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),Uu=(()=>{class n{constructor(t){this._subject=new lt,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;let i=this._locationStrategy.getBaseHref();this._basePath=dG(Mk(kk(i))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,i=""){return this.path()==this.normalize(t+So(i))}normalize(t){return n.stripTrailingSlash(uG(this._basePath,kk(t)))}prepareExternalUrl(t){return t&&t[0]!=="/"&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,i="",r=null){this._locationStrategy.pushState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+So(i)),r)}replaceState(t,i="",r=null){this._locationStrategy.replaceState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+So(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{let i=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(i,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",i){this._urlChangeListeners.forEach(r=>r(t,i))}subscribe(t,i,r){return this._subject.subscribe({next:t,error:i,complete:r})}static{this.normalizeQueryParams=So}static{this.joinWithSlash=qw}static{this.stripTrailingSlash=Mk}static{this.\u0275fac=function(i){return new(i||n)(Me(Do))}}static{this.\u0275prov=Se({token:n,factory:()=>cG(),providedIn:"root"})}}return n})();function cG(){return new Uu(Me(Do))}function uG(n,e){if(!n||!e.startsWith(n))return e;let t=e.substring(n.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function kk(n){return n.replace(/\/index.html$/,"")}function dG(n){if(new RegExp("^(https?:)?//").test(n)){let[,t]=n.split(/\/\/[^\/]+/);return t}return n}var Gk=function(n){return n[n.Decimal=0]="Decimal",n[n.Percent=1]="Percent",n[n.Currency=2]="Currency",n[n.Scientific=3]="Scientific",n}(Gk||{});var wi=function(n){return n[n.Format=0]="Format",n[n.Standalone=1]="Standalone",n}(wi||{}),Wt=function(n){return n[n.Narrow=0]="Narrow",n[n.Abbreviated=1]="Abbreviated",n[n.Wide=2]="Wide",n[n.Short=3]="Short",n}(Wt||{}),nr=function(n){return n[n.Short=0]="Short",n[n.Medium=1]="Medium",n[n.Long=2]="Long",n[n.Full=3]="Full",n}(nr||{}),ir={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function hG(n){return Ji(n)[mn.LocaleId]}function fG(n,e,t){let i=Ji(n),r=[i[mn.DayPeriodsFormat],i[mn.DayPeriodsStandalone]],s=Ar(r,e);return Ar(s,t)}function pG(n,e,t){let i=Ji(n),r=[i[mn.DaysFormat],i[mn.DaysStandalone]],s=Ar(r,e);return Ar(s,t)}function mG(n,e,t){let i=Ji(n),r=[i[mn.MonthsFormat],i[mn.MonthsStandalone]],s=Ar(r,e);return Ar(s,t)}function gG(n,e){let i=Ji(n)[mn.Eras];return Ar(i,e)}function u0(n,e){let t=Ji(n);return Ar(t[mn.DateFormat],e)}function d0(n,e){let t=Ji(n);return Ar(t[mn.TimeFormat],e)}function h0(n,e){let i=Ji(n)[mn.DateTimeFormat];return Ar(i,e)}function Co(n,e){let t=Ji(n),i=t[mn.NumberSymbols][e];if(typeof i>"u"){if(e===ir.CurrencyDecimal)return t[mn.NumberSymbols][ir.Decimal];if(e===ir.CurrencyGroup)return t[mn.NumberSymbols][ir.Group]}return i}function yG(n,e){return Ji(n)[mn.NumberFormats][e]}function zk(n){if(!n[mn.ExtraData])throw new Error(`Missing extra locale data for the locale "${n[mn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function vG(n){let e=Ji(n);return zk(e),(e[mn.ExtraData][2]||[]).map(i=>typeof i=="string"?Nw(i):[Nw(i[0]),Nw(i[1])])}function _G(n,e,t){let i=Ji(n);zk(i);let r=[i[mn.ExtraData][0],i[mn.ExtraData][1]],s=Ar(r,e)||[];return Ar(s,t)||[]}function Ar(n,e){for(let t=e;t>-1;t--)if(typeof n[t]<"u")return n[t];throw new Error("Locale data API: locale data undefined")}function Nw(n){let[e,t]=n.split(":");return{hours:+e,minutes:+t}}var EG=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,f0={},TG=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/,xo=function(n){return n[n.Short=0]="Short",n[n.ShortGMT=1]="ShortGMT",n[n.Long=2]="Long",n[n.Extended=3]="Extended",n}(xo||{}),Ft=function(n){return n[n.FullYear=0]="FullYear",n[n.Month=1]="Month",n[n.Date=2]="Date",n[n.Hours=3]="Hours",n[n.Minutes=4]="Minutes",n[n.Seconds=5]="Seconds",n[n.FractionalSeconds=6]="FractionalSeconds",n[n.Day=7]="Day",n}(Ft||{}),Nt=function(n){return n[n.DayPeriods=0]="DayPeriods",n[n.Days=1]="Days",n[n.Months=2]="Months",n[n.Eras=3]="Eras",n}(Nt||{});function wG(n,e,t,i){let r=RG(n);e=bo(t,e)||e;let o=[],a;for(;e;)if(a=TG.exec(e),a){o=o.concat(a.slice(1));let d=o.pop();if(!d)break;e=d}else{o.push(e);break}let l=r.getTimezoneOffset();i&&(l=qk(i,l),r=PG(r,i,!0));let u="";return o.forEach(d=>{let f=AG(d);u+=f?f(r,t,l):d==="''"?"'":d.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),u}function _0(n,e,t){let i=new Date(0);return i.setFullYear(n,e,t),i.setHours(0,0,0),i}function bo(n,e){let t=hG(n);if(f0[t]??={},f0[t][e])return f0[t][e];let i="";switch(e){case"shortDate":i=u0(n,nr.Short);break;case"mediumDate":i=u0(n,nr.Medium);break;case"longDate":i=u0(n,nr.Long);break;case"fullDate":i=u0(n,nr.Full);break;case"shortTime":i=d0(n,nr.Short);break;case"mediumTime":i=d0(n,nr.Medium);break;case"longTime":i=d0(n,nr.Long);break;case"fullTime":i=d0(n,nr.Full);break;case"short":let r=bo(n,"shortTime"),s=bo(n,"shortDate");i=p0(h0(n,nr.Short),[r,s]);break;case"medium":let o=bo(n,"mediumTime"),a=bo(n,"mediumDate");i=p0(h0(n,nr.Medium),[o,a]);break;case"long":let l=bo(n,"longTime"),u=bo(n,"longDate");i=p0(h0(n,nr.Long),[l,u]);break;case"full":let d=bo(n,"fullTime"),f=bo(n,"fullDate");i=p0(h0(n,nr.Full),[d,f]);break}return i&&(f0[t][e]=i),i}function p0(n,e){return e&&(n=n.replace(/\{([^}]+)}/g,function(t,i){return e!=null&&i in e?e[i]:t})),n}function Xr(n,e,t="-",i,r){let s="";(n<0||r&&n<=0)&&(r?n=-n+1:(n=-n,s=t));let o=String(n);for(;o.length<e;)o="0"+o;return i&&(o=o.slice(o.length-e)),s+o}function IG(n,e){return Xr(n,3).substring(0,e)}function Pn(n,e,t=0,i=!1,r=!1){return function(s,o){let a=bG(n,s);if((t>0||a>-t)&&(a+=t),n===Ft.Hours)a===0&&t===-12&&(a=12);else if(n===Ft.FractionalSeconds)return IG(a,e);let l=Co(o,ir.MinusSign);return Xr(a,e,l,i,r)}}function bG(n,e){switch(n){case Ft.FullYear:return e.getFullYear();case Ft.Month:return e.getMonth();case Ft.Date:return e.getDate();case Ft.Hours:return e.getHours();case Ft.Minutes:return e.getMinutes();case Ft.Seconds:return e.getSeconds();case Ft.FractionalSeconds:return e.getMilliseconds();case Ft.Day:return e.getDay();default:throw new Error(`Unknown DateType value "${n}".`)}}function tn(n,e,t=wi.Format,i=!1){return function(r,s){return SG(r,s,n,e,t,i)}}function SG(n,e,t,i,r,s){switch(t){case Nt.Months:return mG(e,r,i)[n.getMonth()];case Nt.Days:return pG(e,r,i)[n.getDay()];case Nt.DayPeriods:let o=n.getHours(),a=n.getMinutes();if(s){let u=vG(e),d=_G(e,r,i),f=u.findIndex(m=>{if(Array.isArray(m)){let[y,v]=m,E=o>=y.hours&&a>=y.minutes,T=o<v.hours||o===v.hours&&a<v.minutes;if(y.hours<v.hours){if(E&&T)return!0}else if(E||T)return!0}else if(m.hours===o&&m.minutes===a)return!0;return!1});if(f!==-1)return d[f]}return fG(e,r,i)[o<12?0:1];case Nt.Eras:return gG(e,i)[n.getFullYear()<=0?0:1];default:let l=t;throw new Error(`unexpected translation type ${l}`)}}function m0(n){return function(e,t,i){let r=-1*i,s=Co(t,ir.MinusSign),o=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case xo.Short:return(r>=0?"+":"")+Xr(o,2,s)+Xr(Math.abs(r%60),2,s);case xo.ShortGMT:return"GMT"+(r>=0?"+":"")+Xr(o,1,s);case xo.Long:return"GMT"+(r>=0?"+":"")+Xr(o,2,s)+":"+Xr(Math.abs(r%60),2,s);case xo.Extended:return i===0?"Z":(r>=0?"+":"")+Xr(o,2,s)+":"+Xr(Math.abs(r%60),2,s);default:throw new Error(`Unknown zone width "${n}"`)}}}var CG=0,y0=4;function xG(n){let e=_0(n,CG,1).getDay();return _0(n,0,1+(e<=y0?y0:y0+7)-e)}function Hk(n){let e=n.getDay(),t=e===0?-3:y0-e;return _0(n.getFullYear(),n.getMonth(),n.getDate()+t)}function Fw(n,e=!1){return function(t,i){let r;if(e){let s=new Date(t.getFullYear(),t.getMonth(),1).getDay()-1,o=t.getDate();r=1+Math.floor((o+s)/7)}else{let s=Hk(t),o=xG(s.getFullYear()),a=s.getTime()-o.getTime();r=1+Math.round(a/6048e5)}return Xr(r,n,Co(i,ir.MinusSign))}}function g0(n,e=!1){return function(t,i){let s=Hk(t).getFullYear();return Xr(s,n,Co(i,ir.MinusSign),e)}}var Vw={};function AG(n){if(Vw[n])return Vw[n];let e;switch(n){case"G":case"GG":case"GGG":e=tn(Nt.Eras,Wt.Abbreviated);break;case"GGGG":e=tn(Nt.Eras,Wt.Wide);break;case"GGGGG":e=tn(Nt.Eras,Wt.Narrow);break;case"y":e=Pn(Ft.FullYear,1,0,!1,!0);break;case"yy":e=Pn(Ft.FullYear,2,0,!0,!0);break;case"yyy":e=Pn(Ft.FullYear,3,0,!1,!0);break;case"yyyy":e=Pn(Ft.FullYear,4,0,!1,!0);break;case"Y":e=g0(1);break;case"YY":e=g0(2,!0);break;case"YYY":e=g0(3);break;case"YYYY":e=g0(4);break;case"M":case"L":e=Pn(Ft.Month,1,1);break;case"MM":case"LL":e=Pn(Ft.Month,2,1);break;case"MMM":e=tn(Nt.Months,Wt.Abbreviated);break;case"MMMM":e=tn(Nt.Months,Wt.Wide);break;case"MMMMM":e=tn(Nt.Months,Wt.Narrow);break;case"LLL":e=tn(Nt.Months,Wt.Abbreviated,wi.Standalone);break;case"LLLL":e=tn(Nt.Months,Wt.Wide,wi.Standalone);break;case"LLLLL":e=tn(Nt.Months,Wt.Narrow,wi.Standalone);break;case"w":e=Fw(1);break;case"ww":e=Fw(2);break;case"W":e=Fw(1,!0);break;case"d":e=Pn(Ft.Date,1);break;case"dd":e=Pn(Ft.Date,2);break;case"c":case"cc":e=Pn(Ft.Day,1);break;case"ccc":e=tn(Nt.Days,Wt.Abbreviated,wi.Standalone);break;case"cccc":e=tn(Nt.Days,Wt.Wide,wi.Standalone);break;case"ccccc":e=tn(Nt.Days,Wt.Narrow,wi.Standalone);break;case"cccccc":e=tn(Nt.Days,Wt.Short,wi.Standalone);break;case"E":case"EE":case"EEE":e=tn(Nt.Days,Wt.Abbreviated);break;case"EEEE":e=tn(Nt.Days,Wt.Wide);break;case"EEEEE":e=tn(Nt.Days,Wt.Narrow);break;case"EEEEEE":e=tn(Nt.Days,Wt.Short);break;case"a":case"aa":case"aaa":e=tn(Nt.DayPeriods,Wt.Abbreviated);break;case"aaaa":e=tn(Nt.DayPeriods,Wt.Wide);break;case"aaaaa":e=tn(Nt.DayPeriods,Wt.Narrow);break;case"b":case"bb":case"bbb":e=tn(Nt.DayPeriods,Wt.Abbreviated,wi.Standalone,!0);break;case"bbbb":e=tn(Nt.DayPeriods,Wt.Wide,wi.Standalone,!0);break;case"bbbbb":e=tn(Nt.DayPeriods,Wt.Narrow,wi.Standalone,!0);break;case"B":case"BB":case"BBB":e=tn(Nt.DayPeriods,Wt.Abbreviated,wi.Format,!0);break;case"BBBB":e=tn(Nt.DayPeriods,Wt.Wide,wi.Format,!0);break;case"BBBBB":e=tn(Nt.DayPeriods,Wt.Narrow,wi.Format,!0);break;case"h":e=Pn(Ft.Hours,1,-12);break;case"hh":e=Pn(Ft.Hours,2,-12);break;case"H":e=Pn(Ft.Hours,1);break;case"HH":e=Pn(Ft.Hours,2);break;case"m":e=Pn(Ft.Minutes,1);break;case"mm":e=Pn(Ft.Minutes,2);break;case"s":e=Pn(Ft.Seconds,1);break;case"ss":e=Pn(Ft.Seconds,2);break;case"S":e=Pn(Ft.FractionalSeconds,1);break;case"SS":e=Pn(Ft.FractionalSeconds,2);break;case"SSS":e=Pn(Ft.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":e=m0(xo.Short);break;case"ZZZZZ":e=m0(xo.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":e=m0(xo.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":e=m0(xo.Long);break;default:return null}return Vw[n]=e,e}function qk(n,e){n=n.replace(/:/g,"");let t=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(t)?e:t}function DG(n,e){return n=new Date(n.getTime()),n.setMinutes(n.getMinutes()+e),n}function PG(n,e,t){let i=t?-1:1,r=n.getTimezoneOffset(),s=qk(e,r);return DG(n,i*(s-r))}function RG(n){if(Lk(n))return n;if(typeof n=="number"&&!isNaN(n))return new Date(n);if(typeof n=="string"){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){let[r,s=1,o=1]=n.split("-").map(a=>+a);return _0(r,s-1,o)}let t=parseFloat(n);if(!isNaN(n-t))return new Date(t);let i;if(i=n.match(EG))return MG(i)}let e=new Date(n);if(!Lk(e))throw new Error(`Unable to convert "${n}" into a date`);return e}function MG(n){let e=new Date(0),t=0,i=0,r=n[8]?e.setUTCFullYear:e.setFullYear,s=n[8]?e.setUTCHours:e.setHours;n[9]&&(t=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(e,Number(n[1]),Number(n[2])-1,Number(n[3]));let o=Number(n[4]||0)-t,a=Number(n[5]||0)-i,l=Number(n[6]||0),u=Math.floor(parseFloat("0."+(n[7]||0))*1e3);return s.call(e,o,a,l,u),e}function Lk(n){return n instanceof Date&&!isNaN(n.valueOf())}var kG=/^(\d+)?\.((\d+)(-(\d+))?)?$/,Ok=22,E0=".",Wh="0",LG=";",OG=",",Bw="#";function NG(n,e,t,i,r,s,o=!1){let a="",l=!1;if(!isFinite(n))a=Co(t,ir.Infinity);else{let u=UG(n);o&&(u=BG(u));let d=e.minInt,f=e.minFrac,m=e.maxFrac;if(s){let D=s.match(kG);if(D===null)throw new Error(`${s} is not a valid digit info`);let P=D[1],V=D[3],G=D[5];P!=null&&(d=Uw(P)),V!=null&&(f=Uw(V)),G!=null?m=Uw(G):V!=null&&f>m&&(m=f)}$G(u,f,m);let y=u.digits,v=u.integerLen,E=u.exponent,T=[];for(l=y.every(D=>!D);v<d;v++)y.unshift(0);for(;v<0;v++)y.unshift(0);v>0?T=y.splice(v,y.length):(T=y,y=[0]);let C=[];for(y.length>=e.lgSize&&C.unshift(y.splice(-e.lgSize,y.length).join(""));y.length>e.gSize;)C.unshift(y.splice(-e.gSize,y.length).join(""));y.length&&C.unshift(y.join("")),a=C.join(Co(t,i)),T.length&&(a+=Co(t,r)+T.join("")),E&&(a+=Co(t,ir.Exponential)+"+"+E)}return n<0&&!l?a=e.negPre+a+e.negSuf:a=e.posPre+a+e.posSuf,a}function FG(n,e,t){let i=yG(e,Gk.Decimal),r=VG(i,Co(e,ir.MinusSign));return NG(n,r,e,ir.Group,ir.Decimal,t)}function VG(n,e="-"){let t={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},i=n.split(LG),r=i[0],s=i[1],o=r.indexOf(E0)!==-1?r.split(E0):[r.substring(0,r.lastIndexOf(Wh)+1),r.substring(r.lastIndexOf(Wh)+1)],a=o[0],l=o[1]||"";t.posPre=a.substring(0,a.indexOf(Bw));for(let d=0;d<l.length;d++){let f=l.charAt(d);f===Wh?t.minFrac=t.maxFrac=d+1:f===Bw?t.maxFrac=d+1:t.posSuf+=f}let u=a.split(OG);if(t.gSize=u[1]?u[1].length:0,t.lgSize=u[2]||u[1]?(u[2]||u[1]).length:0,s){let d=r.length-t.posPre.length-t.posSuf.length,f=s.indexOf(Bw);t.negPre=s.substring(0,f).replace(/'/g,""),t.negSuf=s.slice(f+d).replace(/'/g,"")}else t.negPre=e+t.posPre,t.negSuf=t.posSuf;return t}function BG(n){if(n.digits[0]===0)return n;let e=n.digits.length-n.integerLen;return n.exponent?n.exponent+=2:(e===0?n.digits.push(0,0):e===1&&n.digits.push(0),n.integerLen+=2),n}function UG(n){let e=Math.abs(n)+"",t=0,i,r,s,o,a;for((r=e.indexOf(E0))>-1&&(e=e.replace(E0,"")),(s=e.search(/e/i))>0?(r<0&&(r=s),r+=+e.slice(s+1),e=e.substring(0,s)):r<0&&(r=e.length),s=0;e.charAt(s)===Wh;s++);if(s===(a=e.length))i=[0],r=1;else{for(a--;e.charAt(a)===Wh;)a--;for(r-=s,i=[],o=0;s<=a;s++,o++)i[o]=Number(e.charAt(s))}return r>Ok&&(i=i.splice(0,Ok-1),t=r-1,r=1),{digits:i,exponent:t,integerLen:r}}function $G(n,e,t){if(e>t)throw new Error(`The minimum number of digits after fraction (${e}) is higher than the maximum (${t}).`);let i=n.digits,r=i.length-n.integerLen,s=Math.min(Math.max(e,r),t),o=s+n.integerLen,a=i[o];if(o>0){i.splice(Math.max(n.integerLen,o));for(let f=o;f<i.length;f++)i[f]=0}else{r=Math.max(0,r),n.integerLen=1,i.length=Math.max(1,o=s+1),i[0]=0;for(let f=1;f<o;f++)i[f]=0}if(a>=5)if(o-1<0){for(let f=0;f>o;f--)i.unshift(0),n.integerLen++;i.unshift(1),n.integerLen++}else i[o-1]++;for(;r<Math.max(0,s);r++)i.push(0);let l=s!==0,u=e+n.integerLen,d=i.reduceRight(function(f,m,y,v){return m=m+f,v[y]=m<10?m:m-10,l&&(v[y]===0&&y>=u?v.pop():l=!1),m>=10?1:0},0);d&&(i.unshift(d),n.integerLen++)}function Uw(n){let e=parseInt(n);if(isNaN(e))throw new Error("Invalid integer literal when parsing "+n);return e}function T0(n,e){e=encodeURIComponent(e);for(let t of n.split(";")){let i=t.indexOf("="),[r,s]=i==-1?[t,""]:[t.slice(0,i),t.slice(i+1)];if(r.trim()===e)return decodeURIComponent(s)}return null}var $w=class{constructor(e,t,i,r){this.$implicit=e,this.ngForOf=t,this.index=i,this.count=r}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},di=(()=>{class n{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,i,r){this._viewContainer=t,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let t=this._ngForOf;if(!this._differ&&t)if(0)try{}catch{}else this._differ=this._differs.find(t).create(this.ngForTrackBy)}if(this._differ){let t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){let i=this._viewContainer;t.forEachOperation((r,s,o)=>{if(r.previousIndex==null)i.createEmbeddedView(this._template,new $w(r.item,this._ngForOf,-1,-1),o===null?void 0:o);else if(o==null)i.remove(s===null?void 0:s);else if(s!==null){let a=i.get(s);i.move(a,o),Nk(a,r)}});for(let r=0,s=i.length;r<s;r++){let a=i.get(r).context;a.index=r,a.count=s,a.ngForOf=this._ngForOf}t.forEachIdentityChange(r=>{let s=i.get(r.currentIndex);Nk(s,r)})}static ngTemplateContextGuard(t,i){return!0}static{this.\u0275fac=function(i){return new(i||n)(Te(Aa),Te(Hl),Te(Ow))}}static{this.\u0275dir=ri({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}}return n})();function Nk(n,e){n.context.$implicit=e.item}var nn=(()=>{class n{constructor(t,i){this._viewContainer=t,this._context=new jw,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){Fk("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){Fk("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,i){return!0}static{this.\u0275fac=function(i){return new(i||n)(Te(Aa),Te(Hl))}}static{this.\u0275dir=ri({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}}return n})(),jw=class{constructor(){this.$implicit=null,this.ngIf=null}};function Fk(n,e){if(!!!(!e||e.createEmbeddedView))throw new Error(`${n} must be a TemplateRef, but received '${_i(e)}'.`)}function Wk(n,e){return new me(2100,!1)}var jG="mediumDate",GG=new Pe(""),zG=new Pe(""),Kk=(()=>{class n{constructor(t,i,r){this.locale=t,this.defaultTimezone=i,this.defaultOptions=r}transform(t,i,r,s){if(t==null||t===""||t!==t)return null;try{let o=i??this.defaultOptions?.dateFormat??jG,a=r??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return wG(t,o,s||this.locale,a)}catch(o){throw Wk(n,o.message)}}static{this.\u0275fac=function(i){return new(i||n)(Te(qh,16),Te(GG,24),Te(zG,24))}}static{this.\u0275pipe=JT({name:"date",type:n,pure:!0,standalone:!0})}}return n})();var Yk=(()=>{class n{constructor(t){this._locale=t}transform(t,i,r){if(!HG(t))return null;r||=this._locale;try{let s=qG(t);return FG(s,r,i)}catch(s){throw Wk(n,s.message)}}static{this.\u0275fac=function(i){return new(i||n)(Te(qh,16))}}static{this.\u0275pipe=JT({name:"number",type:n,pure:!0,standalone:!0})}}return n})();function HG(n){return!(n==null||n===""||n!==n)}function qG(n){if(typeof n=="string"&&!isNaN(Number(n)-parseFloat(n)))return Number(n);if(typeof n!="number")throw new Error(`${n} is not a number`);return n}var Ut=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=Cs({type:n})}static{this.\u0275inj=Ss({})}}return n})(),Kw="browser",WG="server";function Yw(n){return n===Kw}function w0(n){return n===WG}var Qk=(()=>{class n{static{this.\u0275prov=Se({token:n,providedIn:"root",factory:()=>Yw(le(Li))?new Gw(le(Wn),window):new zw})}}return n})(),Gw=class{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){Array.isArray(e)?this.offset=()=>e:this.offset=e}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(e){this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){let t=KG(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){this.window.history.scrollRestoration=e}scrollToElement(e){let t=e.getBoundingClientRect(),i=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}};function KG(n,e){let t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if(typeof n.createTreeWalker=="function"&&n.body&&typeof n.body.attachShadow=="function"){let i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT),r=i.currentNode;for(;r;){let s=r.shadowRoot;if(s){let o=s.getElementById(e)||s.querySelector(`[name="${e}"]`);if(o)return o}r=i.nextNode()}}return null}var zw=class{setOffset(e){}getScrollPosition(){return[0,0]}scrollToPosition(e){}scrollToAnchor(e){}setHistoryScrollRestoration(e){}},Bu=class{};var Yh=class{},b0=class{},Po=class n{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let i=t.indexOf(":");if(i>0){let r=t.slice(0,i),s=r.toLowerCase(),o=t.slice(i+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(o):this.headers.set(s,[o])}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,i)=>{this.setHeaderEntries(i,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,i])=>{this.setHeaderEntries(t,i)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new n;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let i=e.value;if(typeof i=="string"&&(i=[i]),i.length===0)return;this.maybeSetNormalizedName(e.name,t);let r=(e.op==="a"?this.headers.get(t):void 0)||[];r.push(...i),this.headers.set(t,r);break;case"d":let s=e.value;if(!s)this.headers.delete(t),this.normalizedNames.delete(t);else{let o=this.headers.get(t);if(!o)return;o=o.filter(a=>s.indexOf(a)===-1),o.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,o)}break}}setHeaderEntries(e,t){let i=(Array.isArray(t)?t:[t]).map(s=>s.toString()),r=e.toLowerCase();this.headers.set(r,i),this.maybeSetNormalizedName(e,r)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var Zw=class{encodeKey(e){return Zk(e)}encodeValue(e){return Zk(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}};function YG(n,e){let t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{let s=r.indexOf("="),[o,a]=s==-1?[e.decodeKey(r),""]:[e.decodeKey(r.slice(0,s)),e.decodeValue(r.slice(s+1))],l=t.get(o)||[];l.push(a),t.set(o,l)}),t}var QG=/%(\d[a-f0-9])/gi,ZG={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Zk(n){return encodeURIComponent(n).replace(QG,(e,t)=>ZG[t]??e)}function I0(n){return`${n}`}var ka=class n{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new Zw,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=YG(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{let i=e.fromObject[t],r=Array.isArray(i)?i.map(I0):[I0(i)];this.map.set(t,r)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){let t=[];return Object.keys(e).forEach(i=>{let r=e[i];Array.isArray(r)?r.forEach(s=>{t.push({param:i,value:s,op:"a"})}):t.push({param:i,value:r,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let t=this.encoder.encodeKey(e);return this.map.get(e).map(i=>t+"="+this.encoder.encodeValue(i)).join("&")}).filter(e=>e!=="").join("&")}clone(e){let t=new n({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let t=(e.op==="a"?this.map.get(e.param):void 0)||[];t.push(I0(e.value)),this.map.set(e.param,t);break;case"d":if(e.value!==void 0){let i=this.map.get(e.param)||[],r=i.indexOf(I0(e.value));r!==-1&&i.splice(r,1),i.length>0?this.map.set(e.param,i):this.map.delete(e.param)}else{this.map.delete(e.param);break}}}),this.cloneFrom=this.updates=null)}};var Xw=class{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}};function XG(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function Xk(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function Jk(n){return typeof Blob<"u"&&n instanceof Blob}function eL(n){return typeof FormData<"u"&&n instanceof FormData}function JG(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var Kh=class n{constructor(e,t,i,r){this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase();let s;if(XG(this.method)||r?(this.body=i!==void 0?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params),this.transferCache=s.transferCache),this.headers??=new Po,this.context??=new Xw,!this.params)this.params=new ka,this.urlWithParams=t;else{let o=this.params.toString();if(o.length===0)this.urlWithParams=t;else{let a=t.indexOf("?"),l=a===-1?"?":a<t.length-1?"&":"";this.urlWithParams=t+l+o}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||Xk(this.body)||Jk(this.body)||eL(this.body)||JG(this.body)?this.body:this.body instanceof ka?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||eL(this.body)?null:Jk(this.body)?this.body.type||null:Xk(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof ka?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(e={}){let t=e.method||this.method,i=e.url||this.url,r=e.responseType||this.responseType,s=e.transferCache??this.transferCache,o=e.body!==void 0?e.body:this.body,a=e.withCredentials??this.withCredentials,l=e.reportProgress??this.reportProgress,u=e.headers||this.headers,d=e.params||this.params,f=e.context??this.context;return e.setHeaders!==void 0&&(u=Object.keys(e.setHeaders).reduce((m,y)=>m.set(y,e.setHeaders[y]),u)),e.setParams&&(d=Object.keys(e.setParams).reduce((m,y)=>m.set(y,e.setParams[y]),d)),new n(t,i,o,{params:d,headers:u,context:f,reportProgress:l,responseType:r,withCredentials:a,transferCache:s})}},La=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(La||{}),Qh=class{constructor(e,t=200,i="OK"){this.headers=e.headers||new Po,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||i,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}},S0=class n extends Qh{constructor(e={}){super(e),this.type=La.ResponseHeader}clone(e={}){return new n({headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},Zh=class n extends Qh{constructor(e={}){super(e),this.type=La.Response,this.body=e.body!==void 0?e.body:null}clone(e={}){return new n({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},Ma=class extends Qh{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}},rL=200,ez=204;function Qw(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,transferCache:n.transferCache}}var tI=(()=>{class n{constructor(t){this.handler=t}request(t,i,r={}){let s;if(t instanceof Kh)s=t;else{let l;r.headers instanceof Po?l=r.headers:l=new Po(r.headers);let u;r.params&&(r.params instanceof ka?u=r.params:u=new ka({fromObject:r.params})),s=new Kh(t,i,r.body!==void 0?r.body:null,{headers:l,context:r.context,params:u,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache})}let o=Ue(s).pipe(fo(l=>this.handler.handle(l)));if(t instanceof Kh||r.observe==="events")return o;let a=o.pipe(Ri(l=>l instanceof Zh));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return a.pipe(qe(l=>{if(l.body!==null&&!(l.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return l.body}));case"blob":return a.pipe(qe(l=>{if(l.body!==null&&!(l.body instanceof Blob))throw new Error("Response is not a Blob.");return l.body}));case"text":return a.pipe(qe(l=>{if(l.body!==null&&typeof l.body!="string")throw new Error("Response is not a string.");return l.body}));case"json":default:return a.pipe(qe(l=>l.body))}case"response":return a;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(t,i={}){return this.request("DELETE",t,i)}get(t,i={}){return this.request("GET",t,i)}head(t,i={}){return this.request("HEAD",t,i)}jsonp(t,i){return this.request("JSONP",t,{params:new ka().append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,i={}){return this.request("OPTIONS",t,i)}patch(t,i,r={}){return this.request("PATCH",t,Qw(r,i))}post(t,i,r={}){return this.request("POST",t,Qw(r,i))}put(t,i,r={}){return this.request("PUT",t,Qw(r,i))}static{this.\u0275fac=function(i){return new(i||n)(Me(Yh))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),tz=/^\)\]\}',?\n/,nz="X-Request-URL";function tL(n){if(n.url)return n.url;let e=nz.toLocaleLowerCase();return n.headers.get(e)}var iz=(()=>{class n{constructor(){this.fetchImpl=le(Jw,{optional:!0})?.fetch??((...t)=>globalThis.fetch(...t)),this.ngZone=le(Ct)}handle(t){return new nt(i=>{let r=new AbortController;return this.doRequest(t,r.signal,i).then(eI,s=>i.error(new Ma({error:s}))),()=>r.abort()})}doRequest(t,i,r){return U(this,null,function*(){let s=this.createRequestInit(t),o;try{let y=this.ngZone.runOutsideAngular(()=>this.fetchImpl(t.urlWithParams,ue({signal:i},s)));rz(y),r.next({type:La.Sent}),o=yield y}catch(y){r.error(new Ma({error:y,status:y.status??0,statusText:y.statusText,url:t.urlWithParams,headers:y.headers}));return}let a=new Po(o.headers),l=o.statusText,u=tL(o)??t.urlWithParams,d=o.status,f=null;if(t.reportProgress&&r.next(new S0({headers:a,status:d,statusText:l,url:u})),o.body){let y=o.headers.get("content-length"),v=[],E=o.body.getReader(),T=0,C,D,P=typeof Zone<"u"&&Zone.current;yield this.ngZone.runOutsideAngular(()=>U(this,null,function*(){for(;;){let{done:G,value:H}=yield E.read();if(G)break;if(v.push(H),T+=H.length,t.reportProgress){D=t.responseType==="text"?(D??"")+(C??=new TextDecoder).decode(H,{stream:!0}):void 0;let A=()=>r.next({type:La.DownloadProgress,total:y?+y:void 0,loaded:T,partialText:D});P?P.run(A):A()}}}));let V=this.concatChunks(v,T);try{let G=o.headers.get("Content-Type")??"";f=this.parseBody(t,V,G)}catch(G){r.error(new Ma({error:G,headers:new Po(o.headers),status:o.status,statusText:o.statusText,url:tL(o)??t.urlWithParams}));return}}d===0&&(d=f?rL:0),d>=200&&d<300?(r.next(new Zh({body:f,headers:a,status:d,statusText:l,url:u})),r.complete()):r.error(new Ma({error:f,headers:a,status:d,statusText:l,url:u}))})}parseBody(t,i,r){switch(t.responseType){case"json":let s=new TextDecoder().decode(i).replace(tz,"");return s===""?null:JSON.parse(s);case"text":return new TextDecoder().decode(i);case"blob":return new Blob([i],{type:r});case"arraybuffer":return i.buffer}}createRequestInit(t){let i={},r=t.withCredentials?"include":void 0;if(t.headers.forEach((s,o)=>i[s]=o.join(",")),t.headers.has("Accept")||(i.Accept="application/json, text/plain, */*"),!t.headers.has("Content-Type")){let s=t.detectContentTypeHeader();s!==null&&(i["Content-Type"]=s)}return{body:t.serializeBody(),method:t.method,headers:i,credentials:r}}concatChunks(t,i){let r=new Uint8Array(i),s=0;for(let o of t)r.set(o,s),s+=o.length;return r}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),Jw=class{};function eI(){}function rz(n){n.then(eI,eI)}function sz(n,e){return e(n)}function oz(n,e,t){return(i,r)=>Sr(t,()=>e(i,s=>n(s,r)))}var sL=new Pe(""),az=new Pe(""),lz=new Pe("",{providedIn:"root",factory:()=>!0});var nL=(()=>{class n extends Yh{constructor(t,i){super(),this.backend=t,this.injector=i,this.chain=null,this.pendingTasks=le(Ca),this.contributeToStability=le(lz)}handle(t){if(this.chain===null){let i=Array.from(new Set([...this.injector.get(sL),...this.injector.get(az,[])]));this.chain=i.reduceRight((r,s)=>oz(r,s,this.injector),sz)}if(this.contributeToStability){let i=this.pendingTasks.add();return this.chain(t,r=>this.backend.handle(r)).pipe(Ml(()=>this.pendingTasks.remove(i)))}else return this.chain(t,i=>this.backend.handle(i))}static{this.\u0275fac=function(i){return new(i||n)(Me(b0),Me(Ei))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})();var cz=/^\)\]\}',?\n/;function uz(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}var iL=(()=>{class n{constructor(t){this.xhrFactory=t}handle(t){if(t.method==="JSONP")throw new me(-2800,!1);let i=this.xhrFactory;return(i.\u0275loadImpl?en(i.\u0275loadImpl()):Ue(null)).pipe(Mi(()=>new nt(s=>{let o=i.build();if(o.open(t.method,t.urlWithParams),t.withCredentials&&(o.withCredentials=!0),t.headers.forEach((E,T)=>o.setRequestHeader(E,T.join(","))),t.headers.has("Accept")||o.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){let E=t.detectContentTypeHeader();E!==null&&o.setRequestHeader("Content-Type",E)}if(t.responseType){let E=t.responseType.toLowerCase();o.responseType=E!=="json"?E:"text"}let a=t.serializeBody(),l=null,u=()=>{if(l!==null)return l;let E=o.statusText||"OK",T=new Po(o.getAllResponseHeaders()),C=uz(o)||t.url;return l=new S0({headers:T,status:o.status,statusText:E,url:C}),l},d=()=>{let{headers:E,status:T,statusText:C,url:D}=u(),P=null;T!==ez&&(P=typeof o.response>"u"?o.responseText:o.response),T===0&&(T=P?rL:0);let V=T>=200&&T<300;if(t.responseType==="json"&&typeof P=="string"){let G=P;P=P.replace(cz,"");try{P=P!==""?JSON.parse(P):null}catch(H){P=G,V&&(V=!1,P={error:H,text:P})}}V?(s.next(new Zh({body:P,headers:E,status:T,statusText:C,url:D||void 0})),s.complete()):s.error(new Ma({error:P,headers:E,status:T,statusText:C,url:D||void 0}))},f=E=>{let{url:T}=u(),C=new Ma({error:E,status:o.status||0,statusText:o.statusText||"Unknown Error",url:T||void 0});s.error(C)},m=!1,y=E=>{m||(s.next(u()),m=!0);let T={type:La.DownloadProgress,loaded:E.loaded};E.lengthComputable&&(T.total=E.total),t.responseType==="text"&&o.responseText&&(T.partialText=o.responseText),s.next(T)},v=E=>{let T={type:La.UploadProgress,loaded:E.loaded};E.lengthComputable&&(T.total=E.total),s.next(T)};return o.addEventListener("load",d),o.addEventListener("error",f),o.addEventListener("timeout",f),o.addEventListener("abort",f),t.reportProgress&&(o.addEventListener("progress",y),a!==null&&o.upload&&o.upload.addEventListener("progress",v)),o.send(a),s.next({type:La.Sent}),()=>{o.removeEventListener("error",f),o.removeEventListener("abort",f),o.removeEventListener("load",d),o.removeEventListener("timeout",f),t.reportProgress&&(o.removeEventListener("progress",y),a!==null&&o.upload&&o.upload.removeEventListener("progress",v)),o.readyState!==o.DONE&&o.abort()}})))}static{this.\u0275fac=function(i){return new(i||n)(Me(Bu))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),oL=new Pe(""),dz="XSRF-TOKEN",hz=new Pe("",{providedIn:"root",factory:()=>dz}),fz="X-XSRF-TOKEN",pz=new Pe("",{providedIn:"root",factory:()=>fz}),C0=class{},mz=(()=>{class n{constructor(t,i,r){this.doc=t,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=T0(t,this.cookieName),this.lastCookieString=t),this.lastToken}static{this.\u0275fac=function(i){return new(i||n)(Me(Wn),Me(Li),Me(hz))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})();function gz(n,e){let t=n.url.toLowerCase();if(!le(oL)||n.method==="GET"||n.method==="HEAD"||t.startsWith("http://")||t.startsWith("https://"))return e(n);let i=le(C0).getToken(),r=le(pz);return i!=null&&!n.headers.has(r)&&(n=n.clone({headers:n.headers.set(r,i)})),e(n)}function aL(...n){let e=[tI,iL,nL,{provide:Yh,useExisting:nL},{provide:b0,useFactory:()=>le(iz,{optional:!0})??le(iL)},{provide:sL,useValue:gz,multi:!0},{provide:oL,useValue:!0},{provide:C0,useClass:mz}];for(let t of n)e.push(...t.\u0275providers);return Yr(e)}var rI=class extends v0{constructor(){super(...arguments),this.supportsDOMEvents=!0}},sI=class n extends rI{static makeCurrent(){Bk(new n)}onAndCancel(e,t,i){return e.addEventListener(t,i),()=>{e.removeEventListener(t,i)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.remove()}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=vz();return t==null?null:_z(t)}resetBaseElement(){Xh=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return T0(document.cookie,e)}},Xh=null;function vz(){return Xh=Xh||document.querySelector("base"),Xh?Xh.getAttribute("href"):null}function _z(n){return new URL(n,document.baseURI).pathname}var Ez=(()=>{class n{build(){return new XMLHttpRequest}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),oI=new Pe(""),uL=(()=>{class n{constructor(t,i){this._zone=i,this._eventNameToPlugin=new Map,t.forEach(r=>{r.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,i,r){return this._findPluginFor(i).addEventListener(t,i,r)}getZone(){return this._zone}_findPluginFor(t){let i=this._eventNameToPlugin.get(t);if(i)return i;if(i=this._plugins.find(s=>s.supports(t)),!i)throw new me(5101,!1);return this._eventNameToPlugin.set(t,i),i}static{this.\u0275fac=function(i){return new(i||n)(Me(oI),Me(Ct))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),x0=class{constructor(e){this._doc=e}},nI="ng-app-id",dL=(()=>{class n{constructor(t,i,r,s={}){this.doc=t,this.appId=i,this.nonce=r,this.platformId=s,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=w0(s),this.resetHostNodes()}addStyles(t){for(let i of t)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(t){for(let i of t)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let t=this.styleNodesInDOM;t&&(t.forEach(i=>i.remove()),t.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(let i of this.getAllStyles())this.addStyleToHost(t,i)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(let i of this.hostNodes)this.addStyleToHost(i,t)}onStyleRemoved(t){let i=this.styleRef;i.get(t)?.elements?.forEach(r=>r.remove()),i.delete(t)}collectServerRenderedStyles(){let t=this.doc.head?.querySelectorAll(`style[${nI}="${this.appId}"]`);if(t?.length){let i=new Map;return t.forEach(r=>{r.textContent!=null&&i.set(r.textContent,r)}),i}return null}changeUsageCount(t,i){let r=this.styleRef;if(r.has(t)){let s=r.get(t);return s.usage+=i,s.usage}return r.set(t,{usage:i,elements:[]}),i}getStyleElement(t,i){let r=this.styleNodesInDOM,s=r?.get(i);if(s?.parentNode===t)return r.delete(i),s.removeAttribute(nI),s;{let o=this.doc.createElement("style");return this.nonce&&o.setAttribute("nonce",this.nonce),o.textContent=i,this.platformIsServer&&o.setAttribute(nI,this.appId),t.appendChild(o),o}}addStyleToHost(t,i){let r=this.getStyleElement(t,i),s=this.styleRef,o=s.get(i)?.elements;o?o.push(r):s.set(i,{elements:[r],usage:1})}resetHostNodes(){let t=this.hostNodes;t.clear(),t.add(this.doc.head)}static{this.\u0275fac=function(i){return new(i||n)(Me(Wn),Me(gw),Me(_w,8),Me(Li))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),iI={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},lI=/%COMP%/g,hL="%COMP%",Tz=`_nghost-${hL}`,wz=`_ngcontent-${hL}`,Iz=!0,bz=new Pe("",{providedIn:"root",factory:()=>Iz});function Sz(n){return wz.replace(lI,n)}function Cz(n){return Tz.replace(lI,n)}function fL(n,e){return e.map(t=>t.replace(lI,n))}var A0=(()=>{class n{constructor(t,i,r,s,o,a,l,u=null){this.eventManager=t,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=s,this.doc=o,this.platformId=a,this.ngZone=l,this.nonce=u,this.rendererByCompId=new Map,this.platformIsServer=w0(a),this.defaultRenderer=new Jh(t,o,l,this.platformIsServer)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===Ts.ShadowDom&&(i=Ye(ue({},i),{encapsulation:Ts.Emulated}));let r=this.getOrCreateRenderer(t,i);return r instanceof D0?r.applyToHost(t):r instanceof ef&&r.applyStyles(),r}getOrCreateRenderer(t,i){let r=this.rendererByCompId,s=r.get(i.id);if(!s){let o=this.doc,a=this.ngZone,l=this.eventManager,u=this.sharedStylesHost,d=this.removeStylesOnCompDestroy,f=this.platformIsServer;switch(i.encapsulation){case Ts.Emulated:s=new D0(l,u,i,this.appId,d,o,a,f);break;case Ts.ShadowDom:return new aI(l,u,t,i,o,a,this.nonce,f);default:s=new ef(l,u,i,d,o,a,f);break}r.set(i.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(i){return new(i||n)(Me(uL),Me(dL),Me(gw),Me(bz),Me(Wn),Me(Li),Me(Ct),Me(_w))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),Jh=class{constructor(e,t,i,r){this.eventManager=e,this.doc=t,this.ngZone=i,this.platformIsServer=r,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(iI[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(lL(e)?e.content:e).appendChild(t)}insertBefore(e,t,i){e&&(lL(e)?e.content:e).insertBefore(t,i)}removeChild(e,t){t.remove()}selectRootElement(e,t){let i=typeof e=="string"?this.doc.querySelector(e):e;if(!i)throw new me(-5104,!1);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,r){if(r){t=r+":"+t;let s=iI[r];s?e.setAttributeNS(s,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){let r=iI[i];r?e.removeAttributeNS(r,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,r){r&(yo.DashCase|yo.Important)?e.style.setProperty(t,i,r&yo.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&yo.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){e!=null&&(e[t]=i)}setValue(e,t){e.nodeValue=t}listen(e,t,i){if(typeof e=="string"&&(e=Ao().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(i))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function lL(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var aI=class extends Jh{constructor(e,t,i,r,s,o,a,l){super(e,s,o,l),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=fL(r.id,r.styles);for(let d of u){let f=document.createElement("style");a&&f.setAttribute("nonce",a),f.textContent=d,this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(null,t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},ef=class extends Jh{constructor(e,t,i,r,s,o,a,l){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=r,this.styles=l?fL(l,i.styles):i.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},D0=class extends ef{constructor(e,t,i,r,s,o,a,l){let u=r+"-"+i.id;super(e,t,i,s,o,a,l,u),this.contentAttr=Sz(u),this.hostAttr=Cz(u)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}},xz=(()=>{class n extends x0{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,r){return t.addEventListener(i,r,!1),()=>this.removeEventListener(t,i,r)}removeEventListener(t,i,r){return t.removeEventListener(i,r)}static{this.\u0275fac=function(i){return new(i||n)(Me(Wn))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),cL=["alt","control","meta","shift"],Az={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Dz={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},Pz=(()=>{class n extends x0{constructor(t){super(t)}supports(t){return n.parseEventName(t)!=null}addEventListener(t,i,r){let s=n.parseEventName(i),o=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ao().onAndCancel(t,s.domEventName,o))}static parseEventName(t){let i=t.toLowerCase().split("."),r=i.shift();if(i.length===0||!(r==="keydown"||r==="keyup"))return null;let s=n._normalizeKey(i.pop()),o="",a=i.indexOf("code");if(a>-1&&(i.splice(a,1),o="code."),cL.forEach(u=>{let d=i.indexOf(u);d>-1&&(i.splice(d,1),o+=u+".")}),o+=s,i.length!=0||s.length===0)return null;let l={};return l.domEventName=r,l.fullKey=o,l}static matchEventFullKeyCode(t,i){let r=Az[t.key]||t.key,s="";return i.indexOf("code.")>-1&&(r=t.code,s="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),cL.forEach(o=>{if(o!==r){let a=Dz[o];a(t)&&(s+=o+".")}}),s+=r,s===i)}static eventCallback(t,i,r){return s=>{n.matchEventFullKeyCode(s,t)&&r.runGuarded(()=>i(s))}}static _normalizeKey(t){return t==="esc"?"escape":t}static{this.\u0275fac=function(i){return new(i||n)(Me(Wn))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})();function pL(n,e,t){return Pk(ue({rootComponent:n,platformRef:t?.platformRef},Rz(e)))}function Rz(n){return{appProviders:[...Nz,...n?.providers??[]],platformProviders:Oz}}function Mz(){sI.makeCurrent()}function kz(){return new go}function Lz(){return SM(document),document}var Oz=[{provide:Li,useValue:Kw},{provide:yw,useValue:Mz,multi:!0},{provide:Wn,useFactory:Lz,deps:[]}];var Nz=[{provide:Hg,useValue:"root"},{provide:go,useFactory:kz,deps:[]},{provide:oI,useClass:xz,multi:!0,deps:[Wn,Ct,Li]},{provide:oI,useClass:Pz,multi:!0,deps:[Wn]},A0,dL,uL,{provide:Ia,useExisting:A0},{provide:Bu,useClass:Ez,deps:[]},[]];var mL=(()=>{class n{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static{this.\u0275fac=function(i){return new(i||n)(Me(Wn))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var rt="primary",gf=Symbol("RouteTitle"),fI=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function qu(n){return new fI(n)}function Vz(n,e,t){let i=t.path.split("/");if(i.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||i.length<n.length))return null;let r={};for(let s=0;s<i.length;s++){let o=i[s],a=n[s];if(o[0]===":")r[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function Bz(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!Ps(n[t],e[t]))return!1;return!0}function Ps(n,e){let t=n?pI(n):void 0,i=e?pI(e):void 0;if(!t||!i||t.length!=i.length)return!1;let r;for(let s=0;s<t.length;s++)if(r=t[s],!CL(n[r],e[r]))return!1;return!0}function pI(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function CL(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),i=[...e].sort();return t.every((r,s)=>i[s]===r)}else return n===e}function xL(n){return n.length>0?n[n.length-1]:null}function Fa(n){return RE(n)?n:Xl(n)?en(Promise.resolve(n)):Ue(n)}var Uz={exact:DL,subset:PL},AL={exact:$z,subset:jz,ignored:()=>!0};function gL(n,e,t){return Uz[t.paths](n.root,e.root,t.matrixParams)&&AL[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function $z(n,e){return Ps(n,e)}function DL(n,e,t){if(!tc(n.segments,e.segments)||!M0(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let i in e.children)if(!n.children[i]||!DL(n.children[i],e.children[i],t))return!1;return!0}function jz(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>CL(n[t],e[t]))}function PL(n,e,t){return RL(n,e,e.segments,t)}function RL(n,e,t,i){if(n.segments.length>t.length){let r=n.segments.slice(0,t.length);return!(!tc(r,t)||e.hasChildren()||!M0(r,t,i))}else if(n.segments.length===t.length){if(!tc(n.segments,t)||!M0(n.segments,t,i))return!1;for(let r in e.children)if(!n.children[r]||!PL(n.children[r],e.children[r],i))return!1;return!0}else{let r=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!tc(n.segments,r)||!M0(n.segments,r,i)||!n.children[rt]?!1:RL(n.children[rt],e,s,i)}}function M0(n,e,t){return e.every((i,r)=>AL[t](n[r].parameters,i.parameters))}var Mo=class{constructor(e=new Vt([],{}),t={},i=null){this.root=e,this.queryParams=t,this.fragment=i}get queryParamMap(){return this._queryParamMap??=qu(this.queryParams),this._queryParamMap}toString(){return Hz.serialize(this)}},Vt=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return k0(this)}},ec=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=qu(this.parameters),this._parameterMap}toString(){return kL(this)}};function Gz(n,e){return tc(n,e)&&n.every((t,i)=>Ps(t.parameters,e[i].parameters))}function tc(n,e){return n.length!==e.length?!1:n.every((t,i)=>t.path===e[i].path)}function zz(n,e){let t=[];return Object.entries(n.children).forEach(([i,r])=>{i===rt&&(t=t.concat(e(r,i)))}),Object.entries(n.children).forEach(([i,r])=>{i!==rt&&(t=t.concat(e(r,i)))}),t}var yf=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>new Wu,providedIn:"root"})}}return n})(),Wu=class{parse(e){let t=new gI(e);return new Mo(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${tf(e.root,!0)}`,i=Kz(e.queryParams),r=typeof e.fragment=="string"?`#${qz(e.fragment)}`:"";return`${t}${i}${r}`}},Hz=new Wu;function k0(n){return n.segments.map(e=>kL(e)).join("/")}function tf(n,e){if(!n.hasChildren())return k0(n);if(e){let t=n.children[rt]?tf(n.children[rt],!1):"",i=[];return Object.entries(n.children).forEach(([r,s])=>{r!==rt&&i.push(`${r}:${tf(s,!1)}`)}),i.length>0?`${t}(${i.join("//")})`:t}else{let t=zz(n,(i,r)=>r===rt?[tf(n.children[rt],!1)]:[`${r}:${tf(i,!1)}`]);return Object.keys(n.children).length===1&&n.children[rt]!=null?`${k0(n)}/${t[0]}`:`${k0(n)}/(${t.join("//")})`}}function ML(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function P0(n){return ML(n).replace(/%3B/gi,";")}function qz(n){return encodeURI(n)}function mI(n){return ML(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function L0(n){return decodeURIComponent(n)}function yL(n){return L0(n.replace(/\+/g,"%20"))}function kL(n){return`${mI(n.path)}${Wz(n.parameters)}`}function Wz(n){return Object.entries(n).map(([e,t])=>`;${mI(e)}=${mI(t)}`).join("")}function Kz(n){let e=Object.entries(n).map(([t,i])=>Array.isArray(i)?i.map(r=>`${P0(t)}=${P0(r)}`).join("&"):`${P0(t)}=${P0(i)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var Yz=/^[^\/()?;#]+/;function cI(n){let e=n.match(Yz);return e?e[0]:""}var Qz=/^[^\/()?;=#]+/;function Zz(n){let e=n.match(Qz);return e?e[0]:""}var Xz=/^[^=?&#]+/;function Jz(n){let e=n.match(Xz);return e?e[0]:""}var eH=/^[^&#]+/;function tH(n){let e=n.match(eH);return e?e[0]:""}var gI=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Vt([],{}):new Vt([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(i[rt]=new Vt(e,t)),i}parseSegment(){let e=cI(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new me(4009,!1);return this.capture(e),new ec(L0(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=Zz(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){let r=cI(this.remaining);r&&(i=r,this.capture(i))}e[L0(t)]=L0(i)}parseQueryParam(e){let t=Jz(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){let o=tH(this.remaining);o&&(i=o,this.capture(i))}let r=yL(t),s=yL(i);if(e.hasOwnProperty(r)){let o=e[r];Array.isArray(o)||(o=[o],e[r]=o),o.push(s)}else e[r]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let i=cI(this.remaining),r=this.remaining[i.length];if(r!=="/"&&r!==")"&&r!==";")throw new me(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=rt);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[rt]:new Vt([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new me(4011,!1)}};function LL(n){return n.segments.length>0?new Vt([],{[rt]:n}):n}function OL(n){let e={};for(let[i,r]of Object.entries(n.children)){let s=OL(r);if(i===rt&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[i]=s)}let t=new Vt(n.segments,e);return nH(t)}function nH(n){if(n.numberOfChildren===1&&n.children[rt]){let e=n.children[rt];return new Vt(n.segments.concat(e.segments),e.children)}return n}function nc(n){return n instanceof Mo}function iH(n,e,t=null,i=null){let r=NL(n);return FL(r,e,t,i)}function NL(n){let e;function t(s){let o={};for(let l of s.children){let u=t(l);o[l.outlet]=u}let a=new Vt(s.url,o);return s===n&&(e=a),a}let i=t(n.root),r=LL(i);return e??r}function FL(n,e,t,i){let r=n;for(;r.parent;)r=r.parent;if(e.length===0)return uI(r,r,r,t,i);let s=rH(e);if(s.toRoot())return uI(r,r,new Vt([],{}),t,i);let o=sH(s,r,n),a=o.processChildren?sf(o.segmentGroup,o.index,s.commands):BL(o.segmentGroup,o.index,s.commands);return uI(r,o.segmentGroup,a,t,i)}function O0(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function lf(n){return typeof n=="object"&&n!=null&&n.outlets}function uI(n,e,t,i,r){let s={};i&&Object.entries(i).forEach(([l,u])=>{s[l]=Array.isArray(u)?u.map(d=>`${d}`):`${u}`});let o;n===e?o=t:o=VL(n,e,t);let a=LL(OL(o));return new Mo(a,s,r)}function VL(n,e,t){let i={};return Object.entries(n.children).forEach(([r,s])=>{s===e?i[r]=t:i[r]=VL(s,e,t)}),new Vt(n.segments,i)}var N0=class{constructor(e,t,i){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=i,e&&i.length>0&&O0(i[0]))throw new me(4003,!1);let r=i.find(lf);if(r&&r!==xL(i))throw new me(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function rH(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new N0(!0,0,n);let e=0,t=!1,i=n.reduce((r,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([l,u])=>{a[l]=typeof u=="string"?u.split("/"):u}),[...r,{outlets:a}]}if(s.segmentPath)return[...r,s.segmentPath]}return typeof s!="string"?[...r,s]:o===0?(s.split("/").forEach((a,l)=>{l==0&&a==="."||(l==0&&a===""?t=!0:a===".."?e++:a!=""&&r.push(a))}),r):[...r,s]},[]);return new N0(t,e,i)}var Gu=class{constructor(e,t,i){this.segmentGroup=e,this.processChildren=t,this.index=i}};function sH(n,e,t){if(n.isAbsolute)return new Gu(e,!0,0);if(!t)return new Gu(e,!1,NaN);if(t.parent===null)return new Gu(t,!0,0);let i=O0(n.commands[0])?0:1,r=t.segments.length-1+i;return oH(t,r,n.numberOfDoubleDots)}function oH(n,e,t){let i=n,r=e,s=t;for(;s>r;){if(s-=r,i=i.parent,!i)throw new me(4005,!1);r=i.segments.length}return new Gu(i,!1,r-s)}function aH(n){return lf(n[0])?n[0].outlets:{[rt]:n}}function BL(n,e,t){if(n??=new Vt([],{}),n.segments.length===0&&n.hasChildren())return sf(n,e,t);let i=lH(n,e,t),r=t.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){let s=new Vt(n.segments.slice(0,i.pathIndex),{});return s.children[rt]=new Vt(n.segments.slice(i.pathIndex),n.children),sf(s,0,r)}else return i.match&&r.length===0?new Vt(n.segments,{}):i.match&&!n.hasChildren()?yI(n,e,t):i.match?sf(n,0,r):yI(n,e,t)}function sf(n,e,t){if(t.length===0)return new Vt(n.segments,{});{let i=aH(t),r={};if(Object.keys(i).some(s=>s!==rt)&&n.children[rt]&&n.numberOfChildren===1&&n.children[rt].segments.length===0){let s=sf(n.children[rt],e,t);return new Vt(n.segments,s.children)}return Object.entries(i).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(r[s]=BL(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{i[s]===void 0&&(r[s]=o)}),new Vt(n.segments,r)}}function lH(n,e,t){let i=0,r=e,s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=t.length)return s;let o=n.segments[r],a=t[i];if(lf(a))break;let l=`${a}`,u=i<t.length-1?t[i+1]:null;if(r>0&&l===void 0)break;if(l&&u&&typeof u=="object"&&u.outlets===void 0){if(!_L(l,u,o))return s;i+=2}else{if(!_L(l,{},o))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}function yI(n,e,t){let i=n.segments.slice(0,e),r=0;for(;r<t.length;){let s=t[r];if(lf(s)){let l=cH(s.outlets);return new Vt(i,l)}if(r===0&&O0(t[0])){let l=n.segments[e];i.push(new ec(l.path,vL(t[0]))),r++;continue}let o=lf(s)?s.outlets[rt]:`${s}`,a=r<t.length-1?t[r+1]:null;o&&a&&O0(a)?(i.push(new ec(o,vL(a))),r+=2):(i.push(new ec(o,{})),r++)}return new Vt(i,{})}function cH(n){let e={};return Object.entries(n).forEach(([t,i])=>{typeof i=="string"&&(i=[i]),i!==null&&(e[t]=yI(new Vt([],{}),0,i))}),e}function vL(n){let e={};return Object.entries(n).forEach(([t,i])=>e[t]=`${i}`),e}function _L(n,e,t){return n==t.path&&Ps(e,t.parameters)}var of="imperative",Kn=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(Kn||{}),Dr=class{constructor(e,t){this.id=e,this.url=t}},Ku=class extends Dr{constructor(e,t,i="imperative",r=null){super(e,t),this.type=Kn.NavigationStart,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Rs=class extends Dr{constructor(e,t,i){super(e,t),this.urlAfterRedirects=i,this.type=Kn.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},sr=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(sr||{}),F0=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(F0||{}),Ro=class extends Dr{constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r,this.type=Kn.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Oa=class extends Dr{constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r,this.type=Kn.NavigationSkipped}},cf=class extends Dr{constructor(e,t,i,r){super(e,t),this.error=i,this.target=r,this.type=Kn.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},V0=class extends Dr{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=Kn.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},vI=class extends Dr{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=Kn.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},_I=class extends Dr{constructor(e,t,i,r,s){super(e,t),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=Kn.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},EI=class extends Dr{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=Kn.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},TI=class extends Dr{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=Kn.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},wI=class{constructor(e){this.route=e,this.type=Kn.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},II=class{constructor(e){this.route=e,this.type=Kn.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},bI=class{constructor(e){this.snapshot=e,this.type=Kn.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},SI=class{constructor(e){this.snapshot=e,this.type=Kn.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},CI=class{constructor(e){this.snapshot=e,this.type=Kn.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},xI=class{constructor(e){this.snapshot=e,this.type=Kn.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},B0=class{constructor(e,t,i){this.routerEvent=e,this.position=t,this.anchor=i,this.type=Kn.Scroll}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},uf=class{},Yu=class{constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}};function uH(n,e){return n.providers&&!n._injector&&(n._injector=r0(n.providers,e,`Route: ${n.path}`)),n._injector??e}function Jr(n){return n.outlet||rt}function dH(n,e){let t=n.filter(i=>Jr(i)===e);return t.push(...n.filter(i=>Jr(i)!==e)),t}function vf(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var AI=class{get injector(){return vf(this.route?.snapshot)??this.rootInjector}set injector(e){}constructor(e){this.rootInjector=e,this.outlet=null,this.route=null,this.children=new _f(this.rootInjector),this.attachRef=null}},_f=(()=>{class n{constructor(t){this.rootInjector=t,this.contexts=new Map}onChildOutletCreated(t,i){let r=this.getOrCreateContext(t);r.outlet=i,this.contexts.set(t,r)}onChildOutletDestroyed(t){let i=this.getContext(t);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let i=this.getContext(t);return i||(i=new AI(this.rootInjector),this.contexts.set(t,i)),i}getContext(t){return this.contexts.get(t)||null}static{this.\u0275fac=function(i){return new(i||n)(Me(Ei))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),U0=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=DI(e,this._root);return t?t.children.map(i=>i.value):[]}firstChild(e){let t=DI(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=PI(e,this._root);return t.length<2?[]:t[t.length-2].children.map(r=>r.value).filter(r=>r!==e)}pathFromRoot(e){return PI(e,this._root).map(t=>t.value)}};function DI(n,e){if(n===e.value)return e;for(let t of e.children){let i=DI(n,t);if(i)return i}return null}function PI(n,e){if(n===e.value)return[e];for(let t of e.children){let i=PI(n,t);if(i.length)return i.unshift(e),i}return[]}var rr=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function ju(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var $0=class extends U0{constructor(e,t){super(e),this.snapshot=t,BI(this,e)}toString(){return this.snapshot.toString()}};function UL(n){let e=hH(n),t=new Tn([new ec("",{})]),i=new Tn({}),r=new Tn({}),s=new Tn({}),o=new Tn(""),a=new Na(t,i,s,o,r,rt,n,e.root);return a.snapshot=e.root,new $0(new rr(a,[]),e)}function hH(n){let e={},t={},i={},r="",s=new zu([],e,i,r,t,rt,n,null,{});return new G0("",new rr(s,[]))}var Na=class{constructor(e,t,i,r,s,o,a,l){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(qe(u=>u[gf]))??Ue(void 0),this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(qe(e=>qu(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(qe(e=>qu(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function j0(n,e,t="emptyOnly"){let i,{routeConfig:r}=n;return e!==null&&(t==="always"||r?.path===""||!e.component&&!e.routeConfig?.loadComponent)?i={params:ue(ue({},e.params),n.params),data:ue(ue({},e.data),n.data),resolve:ue(ue(ue(ue({},n.data),e.data),r?.data),n._resolvedData)}:i={params:ue({},n.params),data:ue({},n.data),resolve:ue(ue({},n.data),n._resolvedData??{})},r&&jL(r)&&(i.resolve[gf]=r.title),i}var zu=class{get title(){return this.data?.[gf]}constructor(e,t,i,r,s,o,a,l,u){this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=o,this.component=a,this.routeConfig=l,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=qu(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=qu(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(i=>i.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},G0=class extends U0{constructor(e,t){super(t),this.url=e,BI(this,t)}toString(){return $L(this._root)}};function BI(n,e){e.value._routerState=n,e.children.forEach(t=>BI(n,t))}function $L(n){let e=n.children.length>0?` { ${n.children.map($L).join(", ")} } `:"";return`${n.value}${e}`}function dI(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,Ps(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),Ps(e.params,t.params)||n.paramsSubject.next(t.params),Bz(e.url,t.url)||n.urlSubject.next(t.url),Ps(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function RI(n,e){let t=Ps(n.params,e.params)&&Gz(n.url,e.url),i=!n.parent!=!e.parent;return t&&!i&&(!n.parent||RI(n.parent,e.parent))}function jL(n){return typeof n.title=="string"||n.title===null}var UI=(()=>{class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=rt,this.activateEvents=new lt,this.deactivateEvents=new lt,this.attachEvents=new lt,this.detachEvents=new lt,this.parentContexts=le(_f),this.location=le(Aa),this.changeDetector=le(tr),this.inputBinder=le(W0,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){let{firstChange:i,previousValue:r}=t.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new me(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new me(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new me(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,i){this.activated=t,this._activatedRoute=i,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,i){if(this.isActivated)throw new me(4013,!1);this._activatedRoute=t;let r=this.location,o=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new MI(t,a,r.injector);this.activated=r.createComponent(o,{index:r.length,injector:l,environmentInjector:i}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275dir=ri({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Cr]})}}return n})(),MI=class n{__ngOutletInjector(e){return new n(this.route,this.childContexts,e)}constructor(e,t,i){this.route=e,this.childContexts=t,this.parent=i}get(e,t){return e===Na?this.route:e===_f?this.childContexts:this.parent.get(e,t)}},W0=new Pe(""),EL=(()=>{class n{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){let{activatedRoute:i}=t,r=Ph([i.queryParams,i.params,i.data]).pipe(Mi(([s,o,a],l)=>(a=ue(ue(ue({},s),o),a),l===0?Ue(a):Promise.resolve(a)))).subscribe(s=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(t);return}let o=Rk(i.component);if(!o){this.unsubscribeFromRouteData(t);return}for(let{templateName:a}of o.inputs)t.activatedComponentRef.setInput(a,s[a])});this.outletDataSubscriptions.set(t,r)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})();function fH(n,e,t){let i=df(n,e._root,t?t._root:void 0);return new $0(i,e)}function df(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let i=t.value;i._futureSnapshot=e.value;let r=pH(n,e,t);return new rr(i,r)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>df(n,a)),o}}let i=mH(e.value),r=e.children.map(s=>df(n,s));return new rr(i,r)}}function pH(n,e,t){return e.children.map(i=>{for(let r of t.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return df(n,i,r);return df(n,i)})}function mH(n){return new Na(new Tn(n.url),new Tn(n.params),new Tn(n.queryParams),new Tn(n.fragment),new Tn(n.data),n.outlet,n.component,n)}var hf=class{constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}},GL="ngNavigationCancelingError";function z0(n,e){let{redirectTo:t,navigationBehaviorOptions:i}=nc(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,r=zL(!1,sr.Redirect);return r.url=t,r.navigationBehaviorOptions=i,r}function zL(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[GL]=!0,t.cancellationCode=e,t}function gH(n){return HL(n)&&nc(n.url)}function HL(n){return!!n&&n[GL]}var yH=(n,e,t,i)=>qe(r=>(new kI(e,r.targetRouterState,r.currentRouterState,t,i).activate(n),r)),kI=class{constructor(e,t,i,r,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,i,e),dI(this.futureState.root),this.activateChildRoutes(t,i,e)}deactivateChildRoutes(e,t,i){let r=ju(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,r[o],i),delete r[o]}),Object.values(r).forEach(s=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(e,t,i){let r=e.value,s=t?t.value:null;if(r===s)if(r.component){let o=i.getContext(r.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,i);else s&&this.deactivateRouteAndItsChildren(t,i)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,s=ju(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,r);if(i&&i.outlet){let o=i.outlet.detach(),a=i.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,s=ju(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(e,t,i){let r=ju(t);e.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new xI(s.value.snapshot))}),e.children.length&&this.forwardEvent(new SI(e.value.snapshot))}activateRoutes(e,t,i){let r=e.value,s=t?t.value:null;if(dI(r),r===s)if(r.component){let o=i.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,i);else if(r.component){let o=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){let a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),dI(a.route.value),this.activateChildRoutes(e,null,o.children)}else o.attachRef=null,o.route=r,o.outlet&&o.outlet.activateWith(r,o.injector),this.activateChildRoutes(e,null,o.children)}else this.activateChildRoutes(e,null,i)}},H0=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},Hu=class{constructor(e,t){this.component=e,this.route=t}};function vH(n,e,t){let i=n._root,r=e?e._root:null;return nf(i,r,t,[i.value])}function _H(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function Zu(n,e){let t=Symbol(),i=e.get(n,t);return i===t?typeof n=="function"&&!lR(n)?n:e.get(n):i}function nf(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let s=ju(e);return n.children.forEach(o=>{EH(o,s[o.value.outlet],t,i.concat([o.value]),r),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>af(a,t.getContext(o),r)),r}function EH(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let l=TH(o,s,s.routeConfig.runGuardsAndResolvers);l?r.canActivateChecks.push(new H0(i)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?nf(n,e,a?a.children:null,i,r):nf(n,e,t,i,r),l&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new Hu(a.outlet.component,o))}else o&&af(e,a,r),r.canActivateChecks.push(new H0(i)),s.component?nf(n,null,a?a.children:null,i,r):nf(n,null,t,i,r);return r}function TH(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!tc(n.url,e.url);case"pathParamsOrQueryParamsChange":return!tc(n.url,e.url)||!Ps(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!RI(n,e)||!Ps(n.queryParams,e.queryParams);case"paramsChange":default:return!RI(n,e)}}function af(n,e,t){let i=ju(n),r=n.value;Object.entries(i).forEach(([s,o])=>{r.component?e?af(o,e.children.getContext(s),t):af(o,null,t):af(o,e,t)}),r.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new Hu(e.outlet.component,r)):t.canDeactivateChecks.push(new Hu(null,r)):t.canDeactivateChecks.push(new Hu(null,r))}function Ef(n){return typeof n=="function"}function wH(n){return typeof n=="boolean"}function IH(n){return n&&Ef(n.canLoad)}function bH(n){return n&&Ef(n.canActivate)}function SH(n){return n&&Ef(n.canActivateChild)}function CH(n){return n&&Ef(n.canDeactivate)}function xH(n){return n&&Ef(n.canMatch)}function qL(n){return n instanceof zr||n?.name==="EmptyError"}var R0=Symbol("INITIAL_VALUE");function Qu(){return Mi(n=>Ph(n.map(e=>e.pipe(po(1),NE(R0)))).pipe(qe(e=>{for(let t of e)if(t!==!0){if(t===R0)return R0;if(t===!1||AH(t))return t}return!0}),Ri(e=>e!==R0),po(1)))}function AH(n){return nc(n)||n instanceof hf}function DH(n,e){return An(t=>{let{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?Ue(Ye(ue({},t),{guardsResult:!0})):PH(o,i,r,n).pipe(An(a=>a&&wH(a)?RH(i,s,n,e):Ue(a)),qe(a=>Ye(ue({},t),{guardsResult:a})))})}function PH(n,e,t,i){return en(n).pipe(An(r=>NH(r.component,r.route,t,e,i)),vs(r=>r!==!0,!0))}function RH(n,e,t,i){return en(e).pipe(fo(r=>_u(kH(r.route.parent,i),MH(r.route,i),OH(n,r.path,t),LH(n,r.route,t))),vs(r=>r!==!0,!0))}function MH(n,e){return n!==null&&e&&e(new CI(n)),Ue(!0)}function kH(n,e){return n!==null&&e&&e(new bI(n)),Ue(!0)}function LH(n,e,t){let i=e.routeConfig?e.routeConfig.canActivate:null;if(!i||i.length===0)return Ue(!0);let r=i.map(s=>sg(()=>{let o=vf(e)??t,a=Zu(s,o),l=bH(a)?a.canActivate(e,n):Sr(o,()=>a(e,n));return Fa(l).pipe(vs())}));return Ue(r).pipe(Qu())}function OH(n,e,t){let i=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>_H(o)).filter(o=>o!==null).map(o=>sg(()=>{let a=o.guards.map(l=>{let u=vf(o.node)??t,d=Zu(l,u),f=SH(d)?d.canActivateChild(i,n):Sr(u,()=>d(i,n));return Fa(f).pipe(vs())});return Ue(a).pipe(Qu())}));return Ue(s).pipe(Qu())}function NH(n,e,t,i,r){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return Ue(!0);let o=s.map(a=>{let l=vf(e)??r,u=Zu(a,l),d=CH(u)?u.canDeactivate(n,e,t,i):Sr(l,()=>u(n,e,t,i));return Fa(d).pipe(vs())});return Ue(o).pipe(Qu())}function FH(n,e,t,i){let r=e.canLoad;if(r===void 0||r.length===0)return Ue(!0);let s=r.map(o=>{let a=Zu(o,n),l=IH(a)?a.canLoad(e,t):Sr(n,()=>a(e,t));return Fa(l)});return Ue(s).pipe(Qu(),WL(i))}function WL(n){return IE(Dn(e=>{if(typeof e!="boolean")throw z0(n,e)}),qe(e=>e===!0))}function VH(n,e,t,i){let r=e.canMatch;if(!r||r.length===0)return Ue(!0);let s=r.map(o=>{let a=Zu(o,n),l=xH(a)?a.canMatch(e,t):Sr(n,()=>a(e,t));return Fa(l)});return Ue(s).pipe(Qu(),WL(i))}var ff=class{constructor(e){this.segmentGroup=e||null}},pf=class extends Error{constructor(e){super(),this.urlTree=e}};function $u(n){return yu(new ff(n))}function BH(n){return yu(new me(4e3,!1))}function UH(n){return yu(zL(!1,sr.GuardRejected))}var LI=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let i=[],r=t.root;for(;;){if(i=i.concat(r.segments),r.numberOfChildren===0)return Ue(i);if(r.numberOfChildren>1||!r.children[rt])return BH(`${e.redirectTo}`);r=r.children[rt]}}applyRedirectCommands(e,t,i,r,s){if(typeof t!="string"){let a=t,{queryParams:l,fragment:u,routeConfig:d,url:f,outlet:m,params:y,data:v,title:E}=r,T=Sr(s,()=>a({params:y,data:v,queryParams:l,fragment:u,routeConfig:d,url:f,outlet:m,title:E}));if(T instanceof Mo)throw new pf(T);t=T}let o=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,i);if(t[0]==="/")throw new pf(o);return o}applyRedirectCreateUrlTree(e,t,i,r){let s=this.createSegmentGroup(e,t.root,i,r);return new Mo(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let i={};return Object.entries(e).forEach(([r,s])=>{if(typeof s=="string"&&s[0]===":"){let a=s.substring(1);i[r]=t[a]}else i[r]=s}),i}createSegmentGroup(e,t,i,r){let s=this.createSegments(e,t.segments,i,r),o={};return Object.entries(t.children).forEach(([a,l])=>{o[a]=this.createSegmentGroup(e,l,i,r)}),new Vt(s,o)}createSegments(e,t,i,r){return t.map(s=>s.path[0]===":"?this.findPosParam(e,s,r):this.findOrReturn(s,i))}findPosParam(e,t,i){let r=i[t.path.substring(1)];if(!r)throw new me(4001,!1);return r}findOrReturn(e,t){let i=0;for(let r of t){if(r.path===e.path)return t.splice(i),r;i++}return e}},OI={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function $H(n,e,t,i,r){let s=KL(n,e,t);return s.matched?(i=uH(e,i),VH(i,e,t,r).pipe(qe(o=>o===!0?s:ue({},OI)))):Ue(s)}function KL(n,e,t){if(e.path==="**")return jH(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?ue({},OI):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let r=(e.matcher||Vz)(t,n,e);if(!r)return ue({},OI);let s={};Object.entries(r.posParams??{}).forEach(([a,l])=>{s[a]=l.path});let o=r.consumed.length>0?ue(ue({},s),r.consumed[r.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:r.consumed,remainingSegments:t.slice(r.consumed.length),parameters:o,positionalParamSegments:r.posParams??{}}}function jH(n){return{matched:!0,parameters:n.length>0?xL(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function TL(n,e,t,i){return t.length>0&&HH(n,t,i)?{segmentGroup:new Vt(e,zH(i,new Vt(t,n.children))),slicedSegments:[]}:t.length===0&&qH(n,t,i)?{segmentGroup:new Vt(n.segments,GH(n,t,i,n.children)),slicedSegments:t}:{segmentGroup:new Vt(n.segments,n.children),slicedSegments:t}}function GH(n,e,t,i){let r={};for(let s of t)if(K0(n,e,s)&&!i[Jr(s)]){let o=new Vt([],{});r[Jr(s)]=o}return ue(ue({},i),r)}function zH(n,e){let t={};t[rt]=e;for(let i of n)if(i.path===""&&Jr(i)!==rt){let r=new Vt([],{});t[Jr(i)]=r}return t}function HH(n,e,t){return t.some(i=>K0(n,e,i)&&Jr(i)!==rt)}function qH(n,e,t){return t.some(i=>K0(n,e,i))}function K0(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function WH(n,e,t){return e.length===0&&!n.children[t]}var NI=class{};function KH(n,e,t,i,r,s,o="emptyOnly"){return new FI(n,e,t,i,r,o,s).recognize()}var YH=31,FI=class{constructor(e,t,i,r,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=i,this.config=r,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new LI(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new me(4002,`'${e.segmentGroup}'`)}recognize(){let e=TL(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(qe(({children:t,rootSnapshot:i})=>{let r=new rr(i,t),s=new G0("",r),o=iH(i,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),{state:s,tree:o}}))}match(e){let t=new zu([],Object.freeze({}),Object.freeze(ue({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),rt,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,rt,t).pipe(qe(i=>({children:i,rootSnapshot:t})),ma(i=>{if(i instanceof pf)return this.urlTree=i.urlTree,this.match(i.urlTree.root);throw i instanceof ff?this.noMatchError(i):i}))}processSegmentGroup(e,t,i,r,s){return i.segments.length===0&&i.hasChildren()?this.processChildren(e,t,i,s):this.processSegment(e,t,i,i.segments,r,!0,s).pipe(qe(o=>o instanceof rr?[o]:[]))}processChildren(e,t,i,r){let s=[];for(let o of Object.keys(i.children))o==="primary"?s.unshift(o):s.push(o);return en(s).pipe(fo(o=>{let a=i.children[o],l=dH(t,o);return this.processSegmentGroup(e,l,a,o,r)}),OE((o,a)=>(o.push(...a),o)),ga(null),LE(),An(o=>{if(o===null)return $u(i);let a=YL(o);return QH(a),Ue(a)}))}processSegment(e,t,i,r,s,o,a){return en(t).pipe(fo(l=>this.processSegmentAgainstRoute(l._injector??e,t,l,i,r,s,o,a).pipe(ma(u=>{if(u instanceof ff)return Ue(null);throw u}))),vs(l=>!!l),ma(l=>{if(qL(l))return WH(i,r,s)?Ue(new NI):$u(i);throw l}))}processSegmentAgainstRoute(e,t,i,r,s,o,a,l){return Jr(i)!==o&&(o===rt||!K0(r,s,i))?$u(r):i.redirectTo===void 0?this.matchSegmentAgainstRoute(e,r,i,s,o,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,r,t,i,s,o,l):$u(r)}expandSegmentAgainstRouteUsingRedirect(e,t,i,r,s,o,a){let{matched:l,parameters:u,consumedSegments:d,positionalParamSegments:f,remainingSegments:m}=KL(t,r,s);if(!l)return $u(t);typeof r.redirectTo=="string"&&r.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>YH&&(this.allowRedirects=!1));let y=new zu(s,u,Object.freeze(ue({},this.urlTree.queryParams)),this.urlTree.fragment,wL(r),Jr(r),r.component??r._loadedComponent??null,r,IL(r)),v=j0(y,a,this.paramsInheritanceStrategy);y.params=Object.freeze(v.params),y.data=Object.freeze(v.data);let E=this.applyRedirects.applyRedirectCommands(d,r.redirectTo,f,y,e);return this.applyRedirects.lineralizeSegments(r,E).pipe(An(T=>this.processSegment(e,i,t,T.concat(m),o,!1,a)))}matchSegmentAgainstRoute(e,t,i,r,s,o){let a=$H(t,i,r,e,this.urlSerializer);return i.path==="**"&&(t.children={}),a.pipe(Mi(l=>l.matched?(e=i._injector??e,this.getChildConfig(e,i,r).pipe(Mi(({routes:u})=>{let d=i._loadedInjector??e,{parameters:f,consumedSegments:m,remainingSegments:y}=l,v=new zu(m,f,Object.freeze(ue({},this.urlTree.queryParams)),this.urlTree.fragment,wL(i),Jr(i),i.component??i._loadedComponent??null,i,IL(i)),E=j0(v,o,this.paramsInheritanceStrategy);v.params=Object.freeze(E.params),v.data=Object.freeze(E.data);let{segmentGroup:T,slicedSegments:C}=TL(t,m,y,u);if(C.length===0&&T.hasChildren())return this.processChildren(d,u,T,v).pipe(qe(P=>new rr(v,P)));if(u.length===0&&C.length===0)return Ue(new rr(v,[]));let D=Jr(i)===s;return this.processSegment(d,u,T,C,D?rt:s,!0,v).pipe(qe(P=>new rr(v,P instanceof rr?[P]:[])))}))):$u(t)))}getChildConfig(e,t,i){return t.children?Ue({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?Ue({routes:t._loadedRoutes,injector:t._loadedInjector}):FH(e,t,i,this.urlSerializer).pipe(An(r=>r?this.configLoader.loadChildren(e,t).pipe(Dn(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):UH(t))):Ue({routes:[],injector:e})}};function QH(n){n.sort((e,t)=>e.value.outlet===rt?-1:t.value.outlet===rt?1:e.value.outlet.localeCompare(t.value.outlet))}function ZH(n){let e=n.value.routeConfig;return e&&e.path===""}function YL(n){let e=[],t=new Set;for(let i of n){if(!ZH(i)){e.push(i);continue}let r=e.find(s=>i.value.routeConfig===s.value.routeConfig);r!==void 0?(r.children.push(...i.children),t.add(r)):e.push(i)}for(let i of t){let r=YL(i.children);e.push(new rr(i.value,r))}return e.filter(i=>!t.has(i))}function wL(n){return n.data||{}}function IL(n){return n.resolve||{}}function XH(n,e,t,i,r,s){return An(o=>KH(n,e,t,i,o.extractedUrl,r,s).pipe(qe(({state:a,tree:l})=>Ye(ue({},o),{targetSnapshot:a,urlAfterRedirects:l}))))}function JH(n,e){return An(t=>{let{targetSnapshot:i,guards:{canActivateChecks:r}}=t;if(!r.length)return Ue(t);let s=new Set(r.map(l=>l.route)),o=new Set;for(let l of s)if(!o.has(l))for(let u of QL(l))o.add(u);let a=0;return en(o).pipe(fo(l=>s.has(l)?e9(l,i,n,e):(l.data=j0(l,l.parent,n).resolve,Ue(void 0))),Dn(()=>a++),Eu(1),An(l=>a===o.size?Ue(t):Zi))})}function QL(n){let e=n.children.map(t=>QL(t)).flat();return[n,...e]}function e9(n,e,t,i){let r=n.routeConfig,s=n._resolve;return r?.title!==void 0&&!jL(r)&&(s[gf]=r.title),t9(s,n,e,i).pipe(qe(o=>(n._resolvedData=o,n.data=j0(n,n.parent,t).resolve,null)))}function t9(n,e,t,i){let r=pI(n);if(r.length===0)return Ue({});let s={};return en(r).pipe(An(o=>n9(n[o],e,t,i).pipe(vs(),Dn(a=>{if(a instanceof hf)throw z0(new Wu,a);s[o]=a}))),Eu(1),kE(s),ma(o=>qL(o)?Zi:yu(o)))}function n9(n,e,t,i){let r=vf(e)??i,s=Zu(n,r),o=s.resolve?s.resolve(e,t):Sr(r,()=>s(e,t));return Fa(o)}function hI(n){return Mi(e=>{let t=n(e);return t?en(t).pipe(qe(()=>e)):Ue(e)})}var ZL=(()=>{class n{buildTitle(t){let i,r=t.root;for(;r!==void 0;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(s=>s.outlet===rt);return i}getResolvedTitleForRoute(t){return t.data[gf]}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>le(i9),providedIn:"root"})}}return n})(),i9=(()=>{class n extends ZL{constructor(t){super(),this.title=t}updateTitle(t){let i=this.buildTitle(t);i!==void 0&&this.title.setTitle(i)}static{this.\u0275fac=function(i){return new(i||n)(Me(mL))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Tf=new Pe("",{providedIn:"root",factory:()=>({})}),r9=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=Dt({type:n,selectors:[["ng-component"]],standalone:!0,features:[Pt],decls:1,vars:0,template:function(i,r){i&1&&fe(0,"router-outlet")},dependencies:[UI],encapsulation:2})}}return n})();function $I(n){let e=n.children&&n.children.map($I),t=e?Ye(ue({},n),{children:e}):ue({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==rt&&(t.component=r9),t}var mf=new Pe(""),jI=(()=>{class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=le(l0)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return Ue(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);let i=Fa(t.loadComponent()).pipe(qe(XL),Dn(s=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=s}),Ml(()=>{this.componentLoaders.delete(t)})),r=new fu(i,()=>new Hn).pipe(hu());return this.componentLoaders.set(t,r),r}loadChildren(t,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Ue({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let s=s9(i,this.compiler,t,this.onLoadEndListener).pipe(Ml(()=>{this.childrenLoaders.delete(i)})),o=new fu(s,()=>new Hn).pipe(hu());return this.childrenLoaders.set(i,o),o}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function s9(n,e,t,i){return Fa(n.loadChildren()).pipe(qe(XL),An(r=>r instanceof Fh||Array.isArray(r)?Ue(r):en(e.compileModuleAsync(r))),qe(r=>{i&&i(n);let s,o,a=!1;return Array.isArray(r)?(o=r,a=!0):(s=r.create(t).injector,o=s.get(mf,[],{optional:!0,self:!0}).flat()),{routes:o.map($I),injector:s}}))}function o9(n){return n&&typeof n=="object"&&"default"in n}function XL(n){return o9(n)?n.default:n}var GI=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>le(a9),providedIn:"root"})}}return n})(),a9=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,i){return t}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),JL=new Pe(""),eO=new Pe("");function l9(n,e,t){let i=n.get(eO),r=n.get(Wn);return n.get(Ct).runOutsideAngular(()=>{if(!r.startViewTransition||i.skipNextTransition)return i.skipNextTransition=!1,new Promise(u=>setTimeout(u));let s,o=new Promise(u=>{s=u}),a=r.startViewTransition(()=>(s(),c9(n))),{onViewTransitionCreated:l}=i;return l&&Sr(n,()=>l({transition:a,from:e,to:t})),o})}function c9(n){return new Promise(e=>{kw({read:()=>setTimeout(e)},{injector:n})})}var u9=new Pe(""),zI=(()=>{class n{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Hn,this.transitionAbortSubject=new Hn,this.configLoader=le(jI),this.environmentInjector=le(Ei),this.urlSerializer=le(yf),this.rootContexts=le(_f),this.location=le(Uu),this.inputBindingEnabled=le(W0,{optional:!0})!==null,this.titleStrategy=le(ZL),this.options=le(Tf,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=le(GI),this.createViewTransition=le(JL,{optional:!0}),this.navigationErrorHandler=le(u9,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Ue(void 0),this.rootComponentType=null;let t=r=>this.events.next(new wI(r)),i=r=>this.events.next(new II(r));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=t}complete(){this.transitions?.complete()}handleNavigationRequest(t){let i=++this.navigationId;this.transitions?.next(Ye(ue(ue({},this.transitions.value),t),{id:i}))}setupNavigations(t,i,r){return this.transitions=new Tn({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:of,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ri(s=>s.id!==0),qe(s=>Ye(ue({},s),{extractedUrl:this.urlHandlingStrategy.extract(s.rawUrl)})),Mi(s=>{let o=!1,a=!1;return Ue(s).pipe(Mi(l=>{if(this.navigationId>s.id)return this.cancelNavigationTransition(s,"",sr.SupersededByNewNavigation),Zi;this.currentTransition=s,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,targetBrowserUrl:typeof l.extras.browserUrl=="string"?this.urlSerializer.parse(l.extras.browserUrl):l.extras.browserUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?Ye(ue({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let u=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),d=l.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!u&&d!=="reload"){let f="";return this.events.next(new Oa(l.id,this.urlSerializer.serialize(l.rawUrl),f,F0.IgnoredSameUrlNavigation)),l.resolve(!1),Zi}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return Ue(l).pipe(Mi(f=>{let m=this.transitions?.getValue();return this.events.next(new Ku(f.id,this.urlSerializer.serialize(f.extractedUrl),f.source,f.restoredState)),m!==this.transitions?.getValue()?Zi:Promise.resolve(f)}),XH(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),Dn(f=>{s.targetSnapshot=f.targetSnapshot,s.urlAfterRedirects=f.urlAfterRedirects,this.currentNavigation=Ye(ue({},this.currentNavigation),{finalUrl:f.urlAfterRedirects});let m=new V0(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(m)}));if(u&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:f,extractedUrl:m,source:y,restoredState:v,extras:E}=l,T=new Ku(f,this.urlSerializer.serialize(m),y,v);this.events.next(T);let C=UL(this.rootComponentType).snapshot;return this.currentTransition=s=Ye(ue({},l),{targetSnapshot:C,urlAfterRedirects:m,extras:Ye(ue({},E),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=m,Ue(s)}else{let f="";return this.events.next(new Oa(l.id,this.urlSerializer.serialize(l.extractedUrl),f,F0.IgnoredByUrlHandlingStrategy)),l.resolve(!1),Zi}}),Dn(l=>{let u=new vI(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(u)}),qe(l=>(this.currentTransition=s=Ye(ue({},l),{guards:vH(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),s)),DH(this.environmentInjector,l=>this.events.next(l)),Dn(l=>{if(s.guardsResult=l.guardsResult,l.guardsResult&&typeof l.guardsResult!="boolean")throw z0(this.urlSerializer,l.guardsResult);let u=new _I(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(u)}),Ri(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",sr.GuardRejected),!1)),hI(l=>{if(l.guards.canActivateChecks.length)return Ue(l).pipe(Dn(u=>{let d=new EI(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(d)}),Mi(u=>{let d=!1;return Ue(u).pipe(JH(this.paramsInheritanceStrategy,this.environmentInjector),Dn({next:()=>d=!0,complete:()=>{d||this.cancelNavigationTransition(u,"",sr.NoDataFromResolver)}}))}),Dn(u=>{let d=new TI(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(d)}))}),hI(l=>{let u=d=>{let f=[];d.routeConfig?.loadComponent&&!d.routeConfig._loadedComponent&&f.push(this.configLoader.loadComponent(d.routeConfig).pipe(Dn(m=>{d.component=m}),qe(()=>{})));for(let m of d.children)f.push(...u(m));return f};return Ph(u(l.targetSnapshot.root)).pipe(ga(null),po(1))}),hI(()=>this.afterPreactivation()),Mi(()=>{let{currentSnapshot:l,targetSnapshot:u}=s,d=this.createViewTransition?.(this.environmentInjector,l.root,u.root);return d?en(d).pipe(qe(()=>s)):Ue(s)}),qe(l=>{let u=fH(t.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=s=Ye(ue({},l),{targetRouterState:u}),this.currentNavigation.targetRouterState=u,s}),Dn(()=>{this.events.next(new uf)}),yH(this.rootContexts,t.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),po(1),Dn({next:l=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Rs(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{o=!0}}),FE(this.transitionAbortSubject.pipe(Dn(l=>{throw l}))),Ml(()=>{!o&&!a&&this.cancelNavigationTransition(s,"",sr.SupersededByNewNavigation),this.currentTransition?.id===s.id&&(this.currentNavigation=null,this.currentTransition=null)}),ma(l=>{if(a=!0,HL(l))this.events.next(new Ro(s.id,this.urlSerializer.serialize(s.extractedUrl),l.message,l.cancellationCode)),gH(l)?this.events.next(new Yu(l.url,l.navigationBehaviorOptions)):s.resolve(!1);else{let u=new cf(s.id,this.urlSerializer.serialize(s.extractedUrl),l,s.targetSnapshot??void 0);try{let d=Sr(this.environmentInjector,()=>this.navigationErrorHandler?.(u));if(d instanceof hf){let{message:f,cancellationCode:m}=z0(this.urlSerializer,d);this.events.next(new Ro(s.id,this.urlSerializer.serialize(s.extractedUrl),f,m)),this.events.next(new Yu(d.redirectTo,d.navigationBehaviorOptions))}else{this.events.next(u);let f=t.errorHandler(l);s.resolve(!!f)}}catch(d){this.options.resolveNavigationPromiseOnError?s.resolve(!1):s.reject(d)}}return Zi}))}))}cancelNavigationTransition(t,i,r){let s=new Ro(t.id,this.urlSerializer.serialize(t.extractedUrl),i,r);this.events.next(s),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),i=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return t.toString()!==i?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function d9(n){return n!==of}var h9=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>le(f9),providedIn:"root"})}}return n})(),VI=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},f9=(()=>{class n extends VI{static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=wo(n)))(r||n)}})()}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),tO=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:()=>le(p9),providedIn:"root"})}}return n})(),p9=(()=>{class n extends tO{constructor(){super(...arguments),this.location=le(Uu),this.urlSerializer=le(yf),this.options=le(Tf,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=le(GI),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Mo,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=UL(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(i=>{i.type==="popstate"&&t(i.url,i.state)})}handleRouterEvent(t,i){if(t instanceof Ku)this.stateMemento=this.createStateMemento();else if(t instanceof Oa)this.rawUrlTree=i.initialUrl;else if(t instanceof V0){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let r=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(i.targetBrowserUrl??r,i)}}else t instanceof uf?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&!i.extras.skipLocationChange&&this.setBrowserUrl(i.targetBrowserUrl??this.rawUrlTree,i)):t instanceof Ro&&(t.code===sr.GuardRejected||t.code===sr.NoDataFromResolver)?this.restoreHistory(i):t instanceof cf?this.restoreHistory(i,!0):t instanceof Rs&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,i){let r=t instanceof Mo?this.urlSerializer.serialize(t):t;if(this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl){let s=this.browserPageId,o=ue(ue({},i.extras.state),this.generateNgRouterState(i.id,s));this.location.replaceState(r,"",o)}else{let s=ue(ue({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(r,"",s)}}restoreHistory(t,i=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,s=this.currentPageId-r;s!==0?this.location.historyGo(s):this.currentUrlTree===t.finalUrl&&s===0&&(this.resetState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,i){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:i}:{navigationId:t}}static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=wo(n)))(r||n)}})()}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),rf=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(rf||{});function nO(n,e){n.events.pipe(Ri(t=>t instanceof Rs||t instanceof Ro||t instanceof cf||t instanceof Oa),qe(t=>t instanceof Rs||t instanceof Oa?rf.COMPLETE:(t instanceof Ro?t.code===sr.Redirect||t.code===sr.SupersededByNewNavigation:!1)?rf.REDIRECTING:rf.FAILED),Ri(t=>t!==rf.REDIRECTING),po(1)).subscribe(()=>{e()})}function m9(n){throw n}var g9={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},y9={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},xt=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=le(o0),this.stateManager=le(tO),this.options=le(Tf,{optional:!0})||{},this.pendingTasks=le(Ca),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=le(zI),this.urlSerializer=le(yf),this.location=le(Uu),this.urlHandlingStrategy=le(GI),this._events=new Hn,this.errorHandler=this.options.errorHandler||m9,this.navigated=!1,this.routeReuseStrategy=le(h9),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=le(mf,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!le(W0,{optional:!0}),this.eventsSubscription=new pn,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(i=>{try{let r=this.navigationTransitions.currentTransition,s=this.navigationTransitions.currentNavigation;if(r!==null&&s!==null){if(this.stateManager.handleRouterEvent(i,s),i instanceof Ro&&i.code!==sr.Redirect&&i.code!==sr.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof Rs)this.navigated=!0;else if(i instanceof Yu){let o=i.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),l=ue({browserUrl:r.extras.browserUrl,info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:r.extras.replaceUrl||this.urlUpdateStrategy==="eager"||d9(r.source)},o);this.scheduleNavigation(a,of,null,l,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}_9(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),of,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(t,"popstate",i)},0)})}navigateToSyncWithBrowser(t,i,r){let s={replaceUrl:!0},o=r?.navigationId?r:null;if(r){let l=ue({},r);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(s.state=l)}let a=this.parseUrl(t);this.scheduleNavigation(a,i,o,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map($I),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,i={}){let{relativeTo:r,queryParams:s,fragment:o,queryParamsHandling:a,preserveFragment:l}=i,u=l?this.currentUrlTree.fragment:o,d=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":d=ue(ue({},this.currentUrlTree.queryParams),s);break;case"preserve":d=this.currentUrlTree.queryParams;break;default:d=s||null}d!==null&&(d=this.removeEmptyProps(d));let f;try{let m=r?r.snapshot:this.routerState.snapshot.root;f=NL(m)}catch{(typeof t[0]!="string"||t[0][0]!=="/")&&(t=[]),f=this.currentUrlTree.root}return FL(f,t,d,u??null)}navigateByUrl(t,i={skipLocationChange:!1}){let r=nc(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,of,null,i)}navigate(t,i={skipLocationChange:!1}){return v9(t),this.navigateByUrl(this.createUrlTree(t,i),i)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,i){let r;if(i===!0?r=ue({},g9):i===!1?r=ue({},y9):r=i,nc(t))return gL(this.currentUrlTree,t,r);let s=this.parseUrl(t);return gL(this.currentUrlTree,s,r)}removeEmptyProps(t){return Object.entries(t).reduce((i,[r,s])=>(s!=null&&(i[r]=s),i),{})}scheduleNavigation(t,i,r,s,o){if(this.disposed)return Promise.resolve(!1);let a,l,u;o?(a=o.resolve,l=o.reject,u=o.promise):u=new Promise((f,m)=>{a=f,l=m});let d=this.pendingTasks.add();return nO(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(d))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:s,resolve:a,reject:l,promise:u,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),u.catch(f=>Promise.reject(f))}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function v9(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new me(4008,!1)}function _9(n){return!(n instanceof uf)&&!(n instanceof Yu)}var iO=(()=>{class n{constructor(t,i,r,s,o,a){this.router=t,this.route=i,this.tabIndexAttribute=r,this.renderer=s,this.el=o,this.locationStrategy=a,this.href=null,this.onChanges=new Hn,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1,this.routerLinkInput=null;let l=o.nativeElement.tagName?.toLowerCase();this.isAnchorElement=l==="a"||l==="area",this.isAnchorElement?this.subscription=t.events.subscribe(u=>{u instanceof Rs&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(t){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(t){t==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(nc(t)?this.routerLinkInput=t:this.routerLinkInput=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0"))}onClick(t,i,r,s,o){let a=this.urlTree;if(a===null||this.isAnchorElement&&(t!==0||i||r||s||o||typeof this.target=="string"&&this.target!="_self"))return!0;let l={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(a,l),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let t=this.urlTree;this.href=t!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(t)):null;let i=this.href===null?null:AM(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(t,i){let r=this.renderer,s=this.el.nativeElement;i!==null?r.setAttribute(s,t,i):r.removeAttribute(s,t)}get urlTree(){return this.routerLinkInput===null?null:nc(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static{this.\u0275fac=function(i){return new(i||n)(Te(xt),Te(Na),hw("tabindex"),Te(Yl),Te(Zr),Te(Do))}}static{this.\u0275dir=ri({type:n,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,r){i&1&&ve("click",function(o){return r.onClick(o.button,o.ctrlKey,o.shiftKey,o.altKey,o.metaKey)}),i&2&&Ds("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Jl],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Jl],replaceUrl:[2,"replaceUrl","replaceUrl",Jl],routerLink:"routerLink"},standalone:!0,features:[Mw,Cr]})}}return n})();var q0=class{};var E9=(()=>{class n{constructor(t,i,r,s,o){this.router=t,this.injector=r,this.preloadingStrategy=s,this.loader=o}setUpPreloading(){this.subscription=this.router.events.pipe(Ri(t=>t instanceof Rs),fo(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,i){let r=[];for(let s of i){s.providers&&!s._injector&&(s._injector=r0(s.providers,t,`Route: ${s.path}`));let o=s._injector??t,a=s._loadedInjector??o;(s.loadChildren&&!s._loadedRoutes&&s.canLoad===void 0||s.loadComponent&&!s._loadedComponent)&&r.push(this.preloadConfig(o,s)),(s.children||s._loadedRoutes)&&r.push(this.processRoutes(a,s.children??s._loadedRoutes))}return en(r).pipe(vu())}preloadConfig(t,i){return this.preloadingStrategy.preload(i,()=>{let r;i.loadChildren&&i.canLoad===void 0?r=this.loader.loadChildren(t,i):r=Ue(null);let s=r.pipe(An(o=>o===null?Ue(void 0):(i._loadedRoutes=o.routes,i._loadedInjector=o.injector,this.processRoutes(o.injector??t,o.routes))));if(i.loadComponent&&!i._loadedComponent){let o=this.loader.loadComponent(i);return en([s,o]).pipe(vu())}else return s})}static{this.\u0275fac=function(i){return new(i||n)(Me(xt),Me(l0),Me(Ei),Me(q0),Me(jI))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),rO=new Pe(""),T9=(()=>{class n{constructor(t,i,r,s,o={}){this.urlSerializer=t,this.transitions=i,this.viewportScroller=r,this.zone=s,this.options=o,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},o.scrollPositionRestoration||="disabled",o.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof Ku?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Rs?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof Oa&&t.code===F0.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof B0&&(t.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(t.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new B0(t,this.lastSource==="popstate"?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static{this.\u0275fac=function(i){$M()}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})();function sO(n,...e){return Yr([{provide:mf,multi:!0,useValue:n},[],{provide:Na,useFactory:oO,deps:[xt]},{provide:Hh,multi:!0,useFactory:aO},e.map(t=>t.\u0275providers)])}function oO(n){return n.routerState.root}function wf(n,e){return{\u0275kind:n,\u0275providers:e}}function aO(){let n=le(ii);return e=>{let t=n.get(Pa);if(e!==t.components[0])return;let i=n.get(xt),r=n.get(lO);n.get(HI)===1&&i.initialNavigation(),n.get(cO,null,dt.Optional)?.setUpPreloading(),n.get(rO,null,dt.Optional)?.init(),i.resetRootComponentType(t.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}var lO=new Pe("",{factory:()=>new Hn}),HI=new Pe("",{providedIn:"root",factory:()=>1});function w9(){return wf(2,[{provide:HI,useValue:0},{provide:a0,multi:!0,deps:[ii],useFactory:e=>{let t=e.get(Uk,Promise.resolve());return()=>t.then(()=>new Promise(i=>{let r=e.get(xt),s=e.get(lO);nO(r,()=>{i(!0)}),e.get(zI).afterPreactivation=()=>(i(!0),s.closed?Ue(void 0):s),r.initialNavigation()}))}}])}function I9(){return wf(3,[{provide:a0,multi:!0,useFactory:()=>{let e=le(xt);return()=>{e.setUpLocationChangeListener()}}},{provide:HI,useValue:2}])}var cO=new Pe("");function b9(n){return wf(0,[{provide:cO,useExisting:E9},{provide:q0,useExisting:n}])}function S9(){return wf(8,[EL,{provide:W0,useExisting:EL}])}function C9(n){let e=[{provide:JL,useValue:l9},{provide:eO,useValue:ue({skipNextTransition:!!n?.skipInitialTransition},n)}];return wf(9,e)}var bL=new Pe("ROUTER_FORROOT_GUARD"),x9=[Uu,{provide:yf,useClass:Wu},xt,_f,{provide:Na,useFactory:oO,deps:[xt]},jI,[]],uO=(()=>{class n{constructor(t){}static forRoot(t,i){return{ngModule:n,providers:[x9,[],{provide:mf,multi:!0,useValue:t},{provide:bL,useFactory:R9,deps:[[xt,new ci,new QT]]},{provide:Tf,useValue:i||{}},i?.useHash?D9():P9(),A9(),i?.preloadingStrategy?b9(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?M9(i):[],i?.bindToComponentInputs?S9().\u0275providers:[],i?.enableViewTransitions?C9().\u0275providers:[],k9()]}}static forChild(t){return{ngModule:n,providers:[{provide:mf,multi:!0,useValue:t}]}}static{this.\u0275fac=function(i){return new(i||n)(Me(bL,8))}}static{this.\u0275mod=Cs({type:n})}static{this.\u0275inj=Ss({})}}return n})();function A9(){return{provide:rO,useFactory:()=>{let n=le(Qk),e=le(Ct),t=le(Tf),i=le(zI),r=le(yf);return t.scrollOffset&&n.setOffset(t.scrollOffset),new T9(r,i,n,e,t)}}}function D9(){return{provide:Do,useClass:jk}}function P9(){return{provide:Do,useClass:Ww}}function R9(n){return"guarded"}function M9(n){return[n.initialNavigation==="disabled"?I9().\u0275providers:[],n.initialNavigation==="enabledBlocking"?w9().\u0275providers:[]]}var SL=new Pe("");function k9(){return[{provide:SL,useFactory:aO},{provide:Hh,multi:!0,useExisting:SL}]}var st=function(n){return n[n.State=0]="State",n[n.Transition=1]="Transition",n[n.Sequence=2]="Sequence",n[n.Group=3]="Group",n[n.Animate=4]="Animate",n[n.Keyframes=5]="Keyframes",n[n.Style=6]="Style",n[n.Trigger=7]="Trigger",n[n.Reference=8]="Reference",n[n.AnimateChild=9]="AnimateChild",n[n.AnimateRef=10]="AnimateRef",n[n.Query=11]="Query",n[n.Stagger=12]="Stagger",n}(st||{}),ks="*";function qI(n,e){return{type:st.Trigger,name:n,definitions:e,options:{}}}function bf(n,e=null){return{type:st.Animate,styles:e,timings:n}}function dO(n,e=null){return{type:st.Sequence,steps:n,options:e}}function Ls(n){return{type:st.Style,styles:n,offset:null}}function Sf(n,e,t=null){return{type:st.Transition,expr:n,animation:e,options:t}}var Va=class{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}},If=class{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,i=0,r=0,s=this.players.length;s==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++t==s&&this._onFinish()}),o.onDestroy(()=>{++i==s&&this._onDestroy()}),o.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((o,a)=>Math.max(o,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){let t=e*this.totalTime;this.players.forEach(i=>{let r=i.totalTime?Math.min(1,t/i.totalTime):1;i.setPosition(r)})}getPosition(){let e=this.players.reduce((t,i)=>t===null||i.totalTime>t.totalTime?i:t,null);return e!=null?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}},Y0="!";function hO(n){return new me(3e3,!1)}function L9(){return new me(3100,!1)}function O9(){return new me(3101,!1)}function N9(n){return new me(3001,!1)}function F9(n){return new me(3003,!1)}function V9(n){return new me(3004,!1)}function B9(n,e){return new me(3005,!1)}function U9(){return new me(3006,!1)}function $9(){return new me(3007,!1)}function j9(n,e){return new me(3008,!1)}function G9(n){return new me(3002,!1)}function z9(n,e,t,i,r){return new me(3010,!1)}function H9(){return new me(3011,!1)}function q9(){return new me(3012,!1)}function W9(){return new me(3200,!1)}function K9(){return new me(3202,!1)}function Y9(){return new me(3013,!1)}function Q9(n){return new me(3014,!1)}function Z9(n){return new me(3015,!1)}function X9(n){return new me(3016,!1)}function J9(n,e){return new me(3404,!1)}function e7(n){return new me(3502,!1)}function t7(n){return new me(3503,!1)}function n7(){return new me(3300,!1)}function i7(n){return new me(3504,!1)}function r7(n){return new me(3301,!1)}function s7(n,e){return new me(3302,!1)}function o7(n){return new me(3303,!1)}function a7(n,e){return new me(3400,!1)}function l7(n){return new me(3401,!1)}function c7(n){return new me(3402,!1)}function u7(n,e){return new me(3505,!1)}function Ba(n){switch(n.length){case 0:return new Va;case 1:return n[0];default:return new If(n)}}function CO(n,e,t=new Map,i=new Map){let r=[],s=[],o=-1,a=null;if(e.forEach(l=>{let u=l.get("offset"),d=u==o,f=d&&a||new Map;l.forEach((m,y)=>{let v=y,E=m;if(y!=="offset")switch(v=n.normalizePropertyName(v,r),E){case Y0:E=t.get(y);break;case ks:E=i.get(y);break;default:E=n.normalizeStyleValue(y,v,E,r);break}f.set(v,E)}),d||s.push(f),a=f,o=u}),r.length)throw e7(r);return s}function mb(n,e,t,i){switch(e){case"start":n.onStart(()=>i(t&&WI(t,"start",n)));break;case"done":n.onDone(()=>i(t&&WI(t,"done",n)));break;case"destroy":n.onDestroy(()=>i(t&&WI(t,"destroy",n)));break}}function WI(n,e,t){let i=t.totalTime,r=!!t.disabled,s=gb(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,i??n.totalTime,r),o=n._data;return o!=null&&(s._data=o),s}function gb(n,e,t,i,r="",s=0,o){return{element:n,triggerName:e,fromState:t,toState:i,phaseName:r,totalTime:s,disabled:!!o}}function ar(n,e,t){let i=n.get(e);return i||n.set(e,i=t),i}function fO(n){let e=n.indexOf(":"),t=n.substring(1,e),i=n.slice(e+1);return[t,i]}var d7=typeof document>"u"?null:document.documentElement;function yb(n){let e=n.parentNode||n.host||null;return e===d7?null:e}function h7(n){return n.substring(1,6)=="ebkit"}var ic=null,pO=!1;function f7(n){ic||(ic=p7()||{},pO=ic.style?"WebkitAppearance"in ic.style:!1);let e=!0;return ic.style&&!h7(n)&&(e=n in ic.style,!e&&pO&&(e="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in ic.style)),e}function p7(){return typeof document<"u"?document.body:null}function xO(n,e){for(;e;){if(e===n)return!0;e=yb(e)}return!1}function AO(n,e,t){if(t)return Array.from(n.querySelectorAll(e));let i=n.querySelector(e);return i?[i]:[]}var vb=(()=>{class n{validateStyleProperty(t){return f7(t)}containsElement(t,i){return xO(t,i)}getParentElement(t){return yb(t)}query(t,i,r){return AO(t,i,r)}computeStyle(t,i,r){return r||""}animate(t,i,r,s,o,a=[],l){return new Va(r,s)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})(),oc=class{static{this.NOOP=new vb}},ac=class{};var m7=1e3,DO="{{",g7="}}",PO="ng-enter",JI="ng-leave",Q0="ng-trigger",ty=".ng-trigger",mO="ng-animating",eb=".ng-animating";function ko(n){if(typeof n=="number")return n;let e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:tb(parseFloat(e[1]),e[2])}function tb(n,e){switch(e){case"s":return n*m7;default:return n}}function ny(n,e,t){return n.hasOwnProperty("duration")?n:y7(n,e,t)}function y7(n,e,t){let i=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,r,s=0,o="";if(typeof n=="string"){let a=n.match(i);if(a===null)return e.push(hO(n)),{duration:0,delay:0,easing:""};r=tb(parseFloat(a[1]),a[2]);let l=a[3];l!=null&&(s=tb(parseFloat(l),a[4]));let u=a[5];u&&(o=u)}else r=n;if(!t){let a=!1,l=e.length;r<0&&(e.push(L9()),a=!0),s<0&&(e.push(O9()),a=!0),a&&e.splice(l,0,hO(n))}return{duration:r,delay:s,easing:o}}function v7(n){return n.length?n[0]instanceof Map?n:n.map(e=>new Map(Object.entries(e))):[]}function Os(n,e,t){e.forEach((i,r)=>{let s=_b(r);t&&!t.has(r)&&t.set(r,n.style[s]),n.style[s]=i})}function sc(n,e){e.forEach((t,i)=>{let r=_b(i);n.style[r]=""})}function Cf(n){return Array.isArray(n)?n.length==1?n[0]:dO(n):n}function _7(n,e,t){let i=e.params||{},r=RO(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||t.push(N9(s))})}var nb=new RegExp(`${DO}\\s*(.+?)\\s*${g7}`,"g");function RO(n){let e=[];if(typeof n=="string"){let t;for(;t=nb.exec(n);)e.push(t[1]);nb.lastIndex=0}return e}function Af(n,e,t){let i=`${n}`,r=i.replace(nb,(s,o)=>{let a=e[o];return a==null&&(t.push(F9(o)),a=""),a.toString()});return r==i?n:r}var E7=/-+([a-z0-9])/g;function _b(n){return n.replace(E7,(...e)=>e[1].toUpperCase())}function T7(n,e){return n===0||e===0}function w7(n,e,t){if(t.size&&e.length){let i=e[0],r=[];if(t.forEach((s,o)=>{i.has(o)||r.push(o),i.set(o,s)}),r.length)for(let s=1;s<e.length;s++){let o=e[s];r.forEach(a=>o.set(a,Eb(n,a)))}}return e}function or(n,e,t){switch(e.type){case st.Trigger:return n.visitTrigger(e,t);case st.State:return n.visitState(e,t);case st.Transition:return n.visitTransition(e,t);case st.Sequence:return n.visitSequence(e,t);case st.Group:return n.visitGroup(e,t);case st.Animate:return n.visitAnimate(e,t);case st.Keyframes:return n.visitKeyframes(e,t);case st.Style:return n.visitStyle(e,t);case st.Reference:return n.visitReference(e,t);case st.AnimateChild:return n.visitAnimateChild(e,t);case st.AnimateRef:return n.visitAnimateRef(e,t);case st.Query:return n.visitQuery(e,t);case st.Stagger:return n.visitStagger(e,t);default:throw V9(e.type)}}function Eb(n,e){return window.getComputedStyle(n)[e]}var I7=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),iy=class extends ac{normalizePropertyName(e,t){return _b(e)}normalizeStyleValue(e,t,i,r){let s="",o=i.toString().trim();if(I7.has(t)&&i!==0&&i!=="0")if(typeof i=="number")s="px";else{let a=i.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&a[1].length==0&&r.push(B9(e,i))}return o+s}};var ry="*";function b7(n,e){let t=[];return typeof n=="string"?n.split(/\s*,\s*/).forEach(i=>S7(i,t,e)):t.push(n),t}function S7(n,e,t){if(n[0]==":"){let l=C7(n,t);if(typeof l=="function"){e.push(l);return}n=l}let i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(i==null||i.length<4)return t.push(Z9(n)),e;let r=i[1],s=i[2],o=i[3];e.push(gO(r,o));let a=r==ry&&o==ry;s[0]=="<"&&!a&&e.push(gO(o,r))}function C7(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,i)=>parseFloat(i)>parseFloat(t);case":decrement":return(t,i)=>parseFloat(i)<parseFloat(t);default:return e.push(X9(n)),"* => *"}}var Z0=new Set(["true","1"]),X0=new Set(["false","0"]);function gO(n,e){let t=Z0.has(n)||X0.has(n),i=Z0.has(e)||X0.has(e);return(r,s)=>{let o=n==ry||n==r,a=e==ry||e==s;return!o&&t&&typeof r=="boolean"&&(o=r?Z0.has(n):X0.has(n)),!a&&i&&typeof s=="boolean"&&(a=s?Z0.has(e):X0.has(e)),o&&a}}var MO=":self",x7=new RegExp(`s*${MO}s*,?`,"g");function kO(n,e,t,i){return new ib(n).build(e,t,i)}var yO="",ib=class{constructor(e){this._driver=e}build(e,t,i){let r=new rb(t);return this._resetContextStyleTimingState(r),or(this,Cf(e),r)}_resetContextStyleTimingState(e){e.currentQuerySelector=yO,e.collectedStyles=new Map,e.collectedStyles.set(yO,new Map),e.currentTime=0}visitTrigger(e,t){let i=t.queryCount=0,r=t.depCount=0,s=[],o=[];return e.name.charAt(0)=="@"&&t.errors.push(U9()),e.definitions.forEach(a=>{if(this._resetContextStyleTimingState(t),a.type==st.State){let l=a,u=l.name;u.toString().split(/\s*,\s*/).forEach(d=>{l.name=d,s.push(this.visitState(l,t))}),l.name=u}else if(a.type==st.Transition){let l=this.visitTransition(a,t);i+=l.queryCount,r+=l.depCount,o.push(l)}else t.errors.push($9())}),{type:st.Trigger,name:e.name,states:s,transitions:o,queryCount:i,depCount:r,options:null}}visitState(e,t){let i=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(i.containsDynamicStyles){let s=new Set,o=r||{};i.styles.forEach(a=>{a instanceof Map&&a.forEach(l=>{RO(l).forEach(u=>{o.hasOwnProperty(u)||s.add(u)})})}),s.size&&t.errors.push(j9(e.name,[...s.values()]))}return{type:st.State,name:e.name,style:i,options:r?{params:r}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;let i=or(this,Cf(e.animation),t),r=b7(e.expr,t.errors);return{type:st.Transition,matchers:r,animation:i,queryCount:t.queryCount,depCount:t.depCount,options:rc(e.options)}}visitSequence(e,t){return{type:st.Sequence,steps:e.steps.map(i=>or(this,i,t)),options:rc(e.options)}}visitGroup(e,t){let i=t.currentTime,r=0,s=e.steps.map(o=>{t.currentTime=i;let a=or(this,o,t);return r=Math.max(r,t.currentTime),a});return t.currentTime=r,{type:st.Group,steps:s,options:rc(e.options)}}visitAnimate(e,t){let i=R7(e.timings,t.errors);t.currentAnimateTimings=i;let r,s=e.styles?e.styles:Ls({});if(s.type==st.Keyframes)r=this.visitKeyframes(s,t);else{let o=e.styles,a=!1;if(!o){a=!0;let u={};i.easing&&(u.easing=i.easing),o=Ls(u)}t.currentTime+=i.duration+i.delay;let l=this.visitStyle(o,t);l.isEmptyStep=a,r=l}return t.currentAnimateTimings=null,{type:st.Animate,timings:i,style:r,options:null}}visitStyle(e,t){let i=this._makeStyleAst(e,t);return this._validateStyleAst(i,t),i}_makeStyleAst(e,t){let i=[],r=Array.isArray(e.styles)?e.styles:[e.styles];for(let a of r)typeof a=="string"?a===ks?i.push(a):t.errors.push(G9(a)):i.push(new Map(Object.entries(a)));let s=!1,o=null;return i.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(o=a.get("easing"),a.delete("easing")),!s)){for(let l of a.values())if(l.toString().indexOf(DO)>=0){s=!0;break}}}),{type:st.Style,styles:i,easing:o,offset:e.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(e,t){let i=t.currentAnimateTimings,r=t.currentTime,s=t.currentTime;i&&s>0&&(s-=i.duration+i.delay),e.styles.forEach(o=>{typeof o!="string"&&o.forEach((a,l)=>{let u=t.collectedStyles.get(t.currentQuerySelector),d=u.get(l),f=!0;d&&(s!=r&&s>=d.startTime&&r<=d.endTime&&(t.errors.push(z9(l,d.startTime,d.endTime,s,r)),f=!1),s=d.startTime),f&&u.set(l,{startTime:s,endTime:r}),t.options&&_7(a,t.options,t.errors)})})}visitKeyframes(e,t){let i={type:st.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(H9()),i;let r=1,s=0,o=[],a=!1,l=!1,u=0,d=e.steps.map(C=>{let D=this._makeStyleAst(C,t),P=D.offset!=null?D.offset:P7(D.styles),V=0;return P!=null&&(s++,V=D.offset=P),l=l||V<0||V>1,a=a||V<u,u=V,o.push(V),D});l&&t.errors.push(q9()),a&&t.errors.push(W9());let f=e.steps.length,m=0;s>0&&s<f?t.errors.push(K9()):s==0&&(m=r/(f-1));let y=f-1,v=t.currentTime,E=t.currentAnimateTimings,T=E.duration;return d.forEach((C,D)=>{let P=m>0?D==y?1:m*D:o[D],V=P*T;t.currentTime=v+E.delay+V,E.duration=V,this._validateStyleAst(C,t),C.offset=P,i.styles.push(C)}),i}visitReference(e,t){return{type:st.Reference,animation:or(this,Cf(e.animation),t),options:rc(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:st.AnimateChild,options:rc(e.options)}}visitAnimateRef(e,t){return{type:st.AnimateRef,animation:this.visitReference(e.animation,t),options:rc(e.options)}}visitQuery(e,t){let i=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;let[s,o]=A7(e.selector);t.currentQuerySelector=i.length?i+" "+s:s,ar(t.collectedStyles,t.currentQuerySelector,new Map);let a=or(this,Cf(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=i,{type:st.Query,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:o,animation:a,originalSelector:e.selector,options:rc(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(Y9());let i=e.timings==="full"?{duration:0,delay:0,easing:"full"}:ny(e.timings,t.errors,!0);return{type:st.Stagger,animation:or(this,Cf(e.animation),t),timings:i,options:null}}};function A7(n){let e=!!n.split(/\s*,\s*/).find(t=>t==MO);return e&&(n=n.replace(x7,"")),n=n.replace(/@\*/g,ty).replace(/@\w+/g,t=>ty+"-"+t.slice(1)).replace(/:animating/g,eb),[n,e]}function D7(n){return n?ue({},n):null}var rb=class{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function P7(n){if(typeof n=="string")return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(t instanceof Map&&t.has("offset")){let i=t;e=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){let t=n;e=parseFloat(t.get("offset")),t.delete("offset")}return e}function R7(n,e){if(n.hasOwnProperty("duration"))return n;if(typeof n=="number"){let s=ny(n,e).duration;return KI(s,0,"")}let t=n;if(t.split(/\s+/).some(s=>s.charAt(0)=="{"&&s.charAt(1)=="{")){let s=KI(0,0,"");return s.dynamic=!0,s.strValue=t,s}let r=ny(t,e);return KI(r.duration,r.delay,r.easing)}function rc(n){return n?(n=ue({},n),n.params&&(n.params=D7(n.params))):n={},n}function KI(n,e,t){return{duration:n,delay:e,easing:t}}function Tb(n,e,t,i,r,s,o=null,a=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:o,subTimeline:a}}var Df=class{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let i=this._map.get(e);i||this._map.set(e,i=[]),i.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}},M7=1,k7=":enter",L7=new RegExp(k7,"g"),O7=":leave",N7=new RegExp(O7,"g");function LO(n,e,t,i,r,s=new Map,o=new Map,a,l,u=[]){return new sb().buildKeyframes(n,e,t,i,r,s,o,a,l,u)}var sb=class{buildKeyframes(e,t,i,r,s,o,a,l,u,d=[]){u=u||new Df;let f=new ob(e,t,u,r,s,d,[]);f.options=l;let m=l.delay?ko(l.delay):0;f.currentTimeline.delayNextStep(m),f.currentTimeline.setStyles([o],null,f.errors,l),or(this,i,f);let y=f.timelines.filter(v=>v.containsAnimation());if(y.length&&a.size){let v;for(let E=y.length-1;E>=0;E--){let T=y[E];if(T.element===t){v=T;break}}v&&!v.allowOnlyTimelineStyles()&&v.setStyles([a],null,f.errors,l)}return y.length?y.map(v=>v.buildKeyframes()):[Tb(t,[],[],[],0,m,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){let i=t.subInstructions.get(t.element);if(i){let r=t.createSubContext(e.options),s=t.currentTimeline.currentTime,o=this._visitSubInstructions(i,r,r.options);s!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){let i=t.createSubContext(e.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,i),this.visitReference(e.animation,i),t.transformIntoNewTimeline(i.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,i){for(let r of e){let s=r?.delay;if(s){let o=typeof s=="number"?s:ko(Af(s,r?.params??{},t.errors));i.delayNextStep(o)}}}_visitSubInstructions(e,t,i){let s=t.currentTimeline.currentTime,o=i.duration!=null?ko(i.duration):null,a=i.delay!=null?ko(i.delay):null;return o!==0&&e.forEach(l=>{let u=t.appendInstructionToTimeline(l,o,a);s=Math.max(s,u.duration+u.delay)}),s}visitReference(e,t){t.updateOptions(e.options,!0),or(this,e.animation,t),t.previousNode=e}visitSequence(e,t){let i=t.subContextCount,r=t,s=e.options;if(s&&(s.params||s.delay)&&(r=t.createSubContext(s),r.transformIntoNewTimeline(),s.delay!=null)){r.previousNode.type==st.Style&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=sy);let o=ko(s.delay);r.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>or(this,o,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){let i=[],r=t.currentTimeline.currentTime,s=e.options&&e.options.delay?ko(e.options.delay):0;e.steps.forEach(o=>{let a=t.createSubContext(e.options);s&&a.delayNextStep(s),or(this,o,a),r=Math.max(r,a.currentTimeline.currentTime),i.push(a.currentTimeline)}),i.forEach(o=>t.currentTimeline.mergeTimelineCollectedStyles(o)),t.transformIntoNewTimeline(r),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){let i=e.strValue,r=t.params?Af(i,t.params,t.errors):i;return ny(r,t.errors)}else return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){let i=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;i.delay&&(t.incrementTime(i.delay),r.snapshotCurrentStyles());let s=e.style;s.type==st.Keyframes?this.visitKeyframes(s,t):(t.incrementTime(i.duration),this.visitStyle(s,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){let i=t.currentTimeline,r=t.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();let s=r&&r.easing||e.easing;e.isEmptyStep?i.applyEmptyStep(s):i.setStyles(e.styles,s,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){let i=t.currentAnimateTimings,r=t.currentTimeline.duration,s=i.duration,a=t.createSubContext().currentTimeline;a.easing=i.easing,e.styles.forEach(l=>{let u=l.offset||0;a.forwardTime(u*s),a.setStyles(l.styles,l.easing,t.errors,t.options),a.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(a),t.transformIntoNewTimeline(r+s),t.previousNode=e}visitQuery(e,t){let i=t.currentTimeline.currentTime,r=e.options||{},s=r.delay?ko(r.delay):0;s&&(t.previousNode.type===st.Style||i==0&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=sy);let o=i,a=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,t.errors);t.currentQueryTotal=a.length;let l=null;a.forEach((u,d)=>{t.currentQueryIndex=d;let f=t.createSubContext(e.options,u);s&&f.delayNextStep(s),u===t.element&&(l=f.currentTimeline),or(this,e.animation,f),f.currentTimeline.applyStylesToKeyframe();let m=f.currentTimeline.currentTime;o=Math.max(o,m)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),l&&(t.currentTimeline.mergeTimelineCollectedStyles(l),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){let i=t.parentContext,r=t.currentTimeline,s=e.timings,o=Math.abs(s.duration),a=o*(t.currentQueryTotal-1),l=o*t.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":l=a-l;break;case"full":l=i.currentStaggerTime;break}let d=t.currentTimeline;l&&d.delayNextStep(l);let f=d.currentTime;or(this,e.animation,t),t.previousNode=e,i.currentStaggerTime=r.currentTime-f+(r.startTime-i.currentTimeline.startTime)}},sy={},ob=class n{constructor(e,t,i,r,s,o,a,l){this._driver=e,this.element=t,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=o,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=sy,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=l||new oy(this._driver,t,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;let i=e,r=this.options;i.duration!=null&&(r.duration=ko(i.duration)),i.delay!=null&&(r.delay=ko(i.delay));let s=i.params;if(s){let o=r.params;o||(o=this.options.params={}),Object.keys(s).forEach(a=>{(!t||!o.hasOwnProperty(a))&&(o[a]=Af(s[a],o,this.errors))})}}_copyOptions(){let e={};if(this.options){let t=this.options.params;if(t){let i=e.params={};Object.keys(t).forEach(r=>{i[r]=t[r]})}}return e}createSubContext(e=null,t,i){let r=t||this.element,s=new n(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(e),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(e){return this.previousNode=sy,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,i){let r={duration:t??e.duration,delay:this.currentTimeline.currentTime+(i??0)+e.delay,easing:""},s=new ab(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,i,r,s,o){let a=[];if(r&&a.push(this.element),e.length>0){e=e.replace(L7,"."+this._enterClassName),e=e.replace(N7,"."+this._leaveClassName);let l=i!=1,u=this._driver.query(this.element,e,l);i!==0&&(u=i<0?u.slice(u.length+i,u.length):u.slice(0,i)),a.push(...u)}return!s&&a.length==0&&o.push(Q9(t)),a}},oy=class n{constructor(e,t,i,r){this._driver=e,this.element=t,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let t=this._keyframes.size===1&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new n(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=M7,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,i]of this._globalTimelineStyles)this._backFill.set(t,i||ks),this._currentKeyframe.set(t,ks);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,i,r){t&&this._previousKeyframe.set("easing",t);let s=r&&r.params||{},o=F7(e,this._globalTimelineStyles);for(let[a,l]of o){let u=Af(l,s,i);this._pendingStyles.set(a,u),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??ks),this._updateStyle(a,u)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,i)=>{let r=this._styleSummary.get(i);(!r||t.time>r.time)&&this._updateStyle(i,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,t=new Set,i=this._keyframes.size===1&&this.duration===0,r=[];this._keyframes.forEach((a,l)=>{let u=new Map([...this._backFill,...a]);u.forEach((d,f)=>{d===Y0?e.add(f):d===ks&&t.add(f)}),i||u.set("offset",l/this.duration),r.push(u)});let s=[...e.values()],o=[...t.values()];if(i){let a=r[0],l=new Map(a);a.set("offset",0),l.set("offset",1),r=[a,l]}return Tb(this.element,r,s,o,this.duration,this.startTime,this.easing,!1)}},ab=class extends oy{constructor(e,t,i,r,s,o,a=!1){super(e,t,o.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&t){let s=[],o=i+t,a=t/o,l=new Map(e[0]);l.set("offset",0),s.push(l);let u=new Map(e[0]);u.set("offset",vO(a)),s.push(u);let d=e.length-1;for(let f=1;f<=d;f++){let m=new Map(e[f]),y=m.get("offset"),v=t+y*i;m.set("offset",vO(v/o)),s.push(m)}i=o,t=0,r="",e=s}return Tb(this.element,e,this.preStyleProps,this.postStyleProps,i,t,r,!0)}};function vO(n,e=3){let t=Math.pow(10,e-1);return Math.round(n*t)/t}function F7(n,e){let t=new Map,i;return n.forEach(r=>{if(r==="*"){i??=e.keys();for(let s of i)t.set(s,ks)}else for(let[s,o]of r)t.set(s,o)}),t}function _O(n,e,t,i,r,s,o,a,l,u,d,f,m){return{type:0,element:n,triggerName:e,isRemovalTransition:r,fromState:t,fromStyles:s,toState:i,toStyles:o,timelines:a,queriedElements:l,preStyleProps:u,postStyleProps:d,totalTime:f,errors:m}}var YI={},ay=class{constructor(e,t,i){this._triggerName=e,this.ast=t,this._stateStyles=i}match(e,t,i,r){return V7(this.ast.matchers,e,t,i,r)}buildStyles(e,t,i){let r=this._stateStyles.get("*");return e!==void 0&&(r=this._stateStyles.get(e?.toString())||r),r?r.buildStyles(t,i):new Map}build(e,t,i,r,s,o,a,l,u,d){let f=[],m=this.ast.options&&this.ast.options.params||YI,y=a&&a.params||YI,v=this.buildStyles(i,y,f),E=l&&l.params||YI,T=this.buildStyles(r,E,f),C=new Set,D=new Map,P=new Map,V=r==="void",G={params:OO(E,m),delay:this.ast.options?.delay},H=d?[]:LO(e,t,this.ast.animation,s,o,v,T,G,u,f),A=0;return H.forEach(x=>{A=Math.max(x.duration+x.delay,A)}),f.length?_O(t,this._triggerName,i,r,V,v,T,[],[],D,P,A,f):(H.forEach(x=>{let R=x.element,M=ar(D,R,new Set);x.preStyleProps.forEach(j=>M.add(j));let F=ar(P,R,new Set);x.postStyleProps.forEach(j=>F.add(j)),R!==t&&C.add(R)}),_O(t,this._triggerName,i,r,V,v,T,H,[...C.values()],D,P,A))}};function V7(n,e,t,i,r){return n.some(s=>s(e,t,i,r))}function OO(n,e){let t=ue({},e);return Object.entries(n).forEach(([i,r])=>{r!=null&&(t[i]=r)}),t}var lb=class{constructor(e,t,i){this.styles=e,this.defaultParams=t,this.normalizer=i}buildStyles(e,t){let i=new Map,r=OO(e,this.defaultParams);return this.styles.styles.forEach(s=>{typeof s!="string"&&s.forEach((o,a)=>{o&&(o=Af(o,r,t));let l=this.normalizer.normalizePropertyName(a,t);o=this.normalizer.normalizeStyleValue(a,l,o,t),i.set(a,o)})}),i}};function B7(n,e,t){return new cb(n,e,t)}var cb=class{constructor(e,t,i){this.name=e,this.ast=t,this._normalizer=i,this.transitionFactories=[],this.states=new Map,t.states.forEach(r=>{let s=r.options&&r.options.params||{};this.states.set(r.name,new lb(r.style,s,i))}),EO(this.states,"true","1"),EO(this.states,"false","0"),t.transitions.forEach(r=>{this.transitionFactories.push(new ay(e,r,this.states))}),this.fallbackTransition=U7(e,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,i,r){return this.transitionFactories.find(o=>o.match(e,t,i,r))||null}matchStyles(e,t,i){return this.fallbackTransition.buildStyles(e,t,i)}};function U7(n,e,t){let i=[(o,a)=>!0],r={type:st.Sequence,steps:[],options:null},s={type:st.Transition,animation:r,matchers:i,options:null,queryCount:0,depCount:0};return new ay(n,s,e)}function EO(n,e,t){n.has(e)?n.has(t)||n.set(t,n.get(e)):n.has(t)&&n.set(e,n.get(t))}var $7=new Df,ub=class{constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){let i=[],r=[],s=kO(this._driver,t,i,r);if(i.length)throw t7(i);r.length&&void 0,this._animations.set(e,s)}_buildPlayer(e,t,i){let r=e.element,s=CO(this._normalizer,e.keyframes,t,i);return this._driver.animate(r,s,e.duration,e.delay,e.easing,[],!0)}create(e,t,i={}){let r=[],s=this._animations.get(e),o,a=new Map;if(s?(o=LO(this._driver,t,s,PO,JI,new Map,new Map,i,$7,r),o.forEach(d=>{let f=ar(a,d.element,new Map);d.postStyleProps.forEach(m=>f.set(m,null))})):(r.push(n7()),o=[]),r.length)throw i7(r);a.forEach((d,f)=>{d.forEach((m,y)=>{d.set(y,this._driver.computeStyle(f,y,ks))})});let l=o.map(d=>{let f=a.get(d.element);return this._buildPlayer(d,new Map,f)}),u=Ba(l);return this._playersById.set(e,u),u.onDestroy(()=>this.destroy(e)),this.players.push(u),u}destroy(e){let t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);let i=this.players.indexOf(t);i>=0&&this.players.splice(i,1)}_getPlayer(e){let t=this._playersById.get(e);if(!t)throw r7(e);return t}listen(e,t,i,r){let s=gb(t,"","","");return mb(this._getPlayer(e),i,s,r),()=>{}}command(e,t,i,r){if(i=="register"){this.register(e,r[0]);return}if(i=="create"){let o=r[0]||{};this.create(e,t,o);return}let s=this._getPlayer(e);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e);break}}},TO="ng-animate-queued",j7=".ng-animate-queued",QI="ng-animate-disabled",G7=".ng-animate-disabled",z7="ng-star-inserted",H7=".ng-star-inserted",q7=[],NO={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},W7={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},es="__ng_removed",Pf=class{get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;let i=e&&e.hasOwnProperty("value"),r=i?e.value:e;if(this.value=Y7(r),i){let s=e,{value:o}=s,a=uE(s,["value"]);this.options=a}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let t=e.params;if(t){let i=this.options.params;Object.keys(t).forEach(r=>{i[r]==null&&(i[r]=t[r])})}}},xf="void",ZI=new Pf(xf),db=class{constructor(e,t,i){this.id=e,this.hostElement=t,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,Pr(t,this._hostClassName)}listen(e,t,i,r){if(!this._triggers.has(t))throw s7(i,t);if(i==null||i.length==0)throw o7(t);if(!Q7(i))throw a7(i,t);let s=ar(this._elementListeners,e,[]),o={name:t,phase:i,callback:r};s.push(o);let a=ar(this._engine.statesByElement,e,new Map);return a.has(t)||(Pr(e,Q0),Pr(e,Q0+"-"+t),a.set(t,ZI)),()=>{this._engine.afterFlush(()=>{let l=s.indexOf(o);l>=0&&s.splice(l,1),this._triggers.has(t)||a.delete(t)})}}register(e,t){return this._triggers.has(e)?!1:(this._triggers.set(e,t),!0)}_getTrigger(e){let t=this._triggers.get(e);if(!t)throw l7(e);return t}trigger(e,t,i,r=!0){let s=this._getTrigger(t),o=new Rf(this.id,t,e),a=this._engine.statesByElement.get(e);a||(Pr(e,Q0),Pr(e,Q0+"-"+t),this._engine.statesByElement.set(e,a=new Map));let l=a.get(t),u=new Pf(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&l&&u.absorbOptions(l.options),a.set(t,u),l||(l=ZI),!(u.value===xf)&&l.value===u.value){if(!J7(l.params,u.params)){let E=[],T=s.matchStyles(l.value,l.params,E),C=s.matchStyles(u.value,u.params,E);E.length?this._engine.reportError(E):this._engine.afterFlush(()=>{sc(e,T),Os(e,C)})}return}let m=ar(this._engine.playersByElement,e,[]);m.forEach(E=>{E.namespaceId==this.id&&E.triggerName==t&&E.queued&&E.destroy()});let y=s.matchTransition(l.value,u.value,e,u.params),v=!1;if(!y){if(!r)return;y=s.fallbackTransition,v=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:y,fromState:l,toState:u,player:o,isFallbackTransition:v}),v||(Pr(e,TO),o.onStart(()=>{Xu(e,TO)})),o.onDone(()=>{let E=this.players.indexOf(o);E>=0&&this.players.splice(E,1);let T=this._engine.playersByElement.get(e);if(T){let C=T.indexOf(o);C>=0&&T.splice(C,1)}}),this.players.push(o),m.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,i)=>{this._elementListeners.set(i,t.filter(r=>r.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let t=this._engine.playersByElement.get(e);t&&(t.forEach(i=>i.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){let i=this._engine.driver.query(e,ty,!0);i.forEach(r=>{if(r[es])return;let s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(o=>o.triggerLeaveAnimation(r,t,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(e,t,i,r){let s=this._engine.statesByElement.get(e),o=new Map;if(s){let a=[];if(s.forEach((l,u)=>{if(o.set(u,l.value),this._triggers.has(u)){let d=this.trigger(e,u,xf,r);d&&a.push(d)}}),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,o),i&&Ba(a).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let t=this._elementListeners.get(e),i=this._engine.statesByElement.get(e);if(t&&i){let r=new Set;t.forEach(s=>{let o=s.name;if(r.has(o))return;r.add(o);let l=this._triggers.get(o).fallbackTransition,u=i.get(o)||ZI,d=new Pf(xf),f=new Rf(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:l,fromState:u,toState:d,player:f,isFallbackTransition:!0})})}}removeNode(e,t){let i=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let r=!1;if(i.totalAnimations){let s=i.players.length?i.playersByQueriedElement.get(e):[];if(s&&s.length)r=!0;else{let o=e;for(;o=o.parentNode;)if(i.statesByElement.get(o)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)i.markElementAsRemoved(this.id,e,!1,t);else{let s=e[es];(!s||s===NO)&&(i.afterFlush(()=>this.clearElementCache(e)),i.destroyInnerAnimations(e),i._onRemovalComplete(e,t))}}insertNode(e,t){Pr(e,this._hostClassName)}drainQueuedTransitions(e){let t=[];return this._queue.forEach(i=>{let r=i.player;if(r.destroyed)return;let s=i.element,o=this._elementListeners.get(s);o&&o.forEach(a=>{if(a.name==i.triggerName){let l=gb(s,i.triggerName,i.fromState.value,i.toState.value);l._data=e,mb(i.player,a.phase,l,a.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):t.push(i)}),this._queue=[],t.sort((i,r)=>{let s=i.transition.ast.depCount,o=r.transition.ast.depCount;return s==0||o==0?s-o:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},hb=class{_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,i){this.bodyNode=e,this.driver=t,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}get queuedPlayers(){let e=[];return this._namespaceList.forEach(t=>{t.players.forEach(i=>{i.queued&&e.push(i)})}),e}createNamespace(e,t){let i=new db(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(i,t):(this.newHostElements.set(t,i),this.collectEnterElement(t)),this._namespaceLookup[e]=i}_balanceNamespaceList(e,t){let i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let o=!1,a=this.driver.getParentElement(t);for(;a;){let l=r.get(a);if(l){let u=i.indexOf(l);i.splice(u+1,0,e),o=!0;break}a=this.driver.getParentElement(a)}o||i.unshift(e)}else i.push(e);return r.set(t,e),e}register(e,t){let i=this._namespaceLookup[e];return i||(i=this.createNamespace(e,t)),i}registerTrigger(e,t,i){let r=this._namespaceLookup[e];r&&r.register(t,i)&&this.totalAnimations++}destroy(e,t){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let i=this._fetchNamespace(e);this.namespacesByHostElement.delete(i.hostElement);let r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1),i.destroy(t),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let t=new Set,i=this.statesByElement.get(e);if(i){for(let r of i.values())if(r.namespaceId){let s=this._fetchNamespace(r.namespaceId);s&&t.add(s)}}return t}trigger(e,t,i,r){if(J0(t)){let s=this._fetchNamespace(e);if(s)return s.trigger(t,i,r),!0}return!1}insertNode(e,t,i,r){if(!J0(t))return;let s=t[es];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;let o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){let o=this._fetchNamespace(e);o&&o.insertNode(t,i)}r&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),Pr(e,QI)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),Xu(e,QI))}removeNode(e,t,i){if(J0(t)){let r=e?this._fetchNamespace(e):null;r?r.removeNode(t,i):this.markElementAsRemoved(e,t,!1,i);let s=this.namespacesByHostElement.get(t);s&&s.id!==e&&s.removeNode(t,i)}else this._onRemovalComplete(t,i)}markElementAsRemoved(e,t,i,r,s){this.collectedLeaveElements.push(t),t[es]={namespaceId:e,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(e,t,i,r,s){return J0(t)?this._fetchNamespace(e).listen(t,i,r,s):()=>{}}_buildInstruction(e,t,i,r,s){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,i,r,e.fromState.options,e.toState.options,t,s)}destroyInnerAnimations(e){let t=this.driver.query(e,ty,!0);t.forEach(i=>this.destroyActiveAnimationsForElement(i)),this.playersByQueriedElement.size!=0&&(t=this.driver.query(e,eb,!0),t.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(e){let t=this.playersByElement.get(e);t&&t.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(e){let t=this.playersByQueriedElement.get(e);t&&t.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Ba(this.players).onDone(()=>e());e()})}processLeaveNode(e){let t=e[es];if(t&&t.setForRemoval){if(e[es]=NO,t.namespaceId){this.destroyInnerAnimations(e);let i=this._fetchNamespace(t.namespaceId);i&&i.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(QI)&&this.markElementAsDisabled(e,!1),this.driver.query(e,G7,!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++){let r=this.collectedEnterElements[i];Pr(r,z7)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let i=[];try{t=this._flushAnimations(i,e)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++){let r=this.collectedLeaveElements[i];this.processLeaveNode(r)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){let i=this._whenQuietFns;this._whenQuietFns=[],t.length?Ba(t).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(e){throw c7(e)}_flushAnimations(e,t){let i=new Df,r=[],s=new Map,o=[],a=new Map,l=new Map,u=new Map,d=new Set;this.disabledNodes.forEach(q=>{d.add(q);let te=this.driver.query(q,j7,!0);for(let W=0;W<te.length;W++)d.add(te[W])});let f=this.bodyNode,m=Array.from(this.statesByElement.keys()),y=bO(m,this.collectedEnterElements),v=new Map,E=0;y.forEach((q,te)=>{let W=PO+E++;v.set(te,W),q.forEach(ne=>Pr(ne,W))});let T=[],C=new Set,D=new Set;for(let q=0;q<this.collectedLeaveElements.length;q++){let te=this.collectedLeaveElements[q],W=te[es];W&&W.setForRemoval&&(T.push(te),C.add(te),W.hasAnimation?this.driver.query(te,H7,!0).forEach(ne=>C.add(ne)):D.add(te))}let P=new Map,V=bO(m,Array.from(C));V.forEach((q,te)=>{let W=JI+E++;P.set(te,W),q.forEach(ne=>Pr(ne,W))}),e.push(()=>{y.forEach((q,te)=>{let W=v.get(te);q.forEach(ne=>Xu(ne,W))}),V.forEach((q,te)=>{let W=P.get(te);q.forEach(ne=>Xu(ne,W))}),T.forEach(q=>{this.processLeaveNode(q)})});let G=[],H=[];for(let q=this._namespaceList.length-1;q>=0;q--)this._namespaceList[q].drainQueuedTransitions(t).forEach(W=>{let ne=W.player,ye=W.element;if(G.push(ne),this.collectedEnterElements.length){let Je=ye[es];if(Je&&Je.setForMove){if(Je.previousTriggersValues&&Je.previousTriggersValues.has(W.triggerName)){let Mt=Je.previousTriggersValues.get(W.triggerName),kt=this.statesByElement.get(W.element);if(kt&&kt.has(W.triggerName)){let Zt=kt.get(W.triggerName);Zt.value=Mt,kt.set(W.triggerName,Zt)}}ne.destroy();return}}let oe=!f||!this.driver.containsElement(f,ye),ie=P.get(ye),de=v.get(ye),he=this._buildInstruction(W,i,de,ie,oe);if(he.errors&&he.errors.length){H.push(he);return}if(oe){ne.onStart(()=>sc(ye,he.fromStyles)),ne.onDestroy(()=>Os(ye,he.toStyles)),r.push(ne);return}if(W.isFallbackTransition){ne.onStart(()=>sc(ye,he.fromStyles)),ne.onDestroy(()=>Os(ye,he.toStyles)),r.push(ne);return}let Ne=[];he.timelines.forEach(Je=>{Je.stretchStartingKeyframe=!0,this.disabledNodes.has(Je.element)||Ne.push(Je)}),he.timelines=Ne,i.append(ye,he.timelines);let je={instruction:he,player:ne,element:ye};o.push(je),he.queriedElements.forEach(Je=>ar(a,Je,[]).push(ne)),he.preStyleProps.forEach((Je,Mt)=>{if(Je.size){let kt=l.get(Mt);kt||l.set(Mt,kt=new Set),Je.forEach((Zt,bn)=>kt.add(bn))}}),he.postStyleProps.forEach((Je,Mt)=>{let kt=u.get(Mt);kt||u.set(Mt,kt=new Set),Je.forEach((Zt,bn)=>kt.add(bn))})});if(H.length){let q=[];H.forEach(te=>{q.push(u7(te.triggerName,te.errors))}),G.forEach(te=>te.destroy()),this.reportError(q)}let A=new Map,x=new Map;o.forEach(q=>{let te=q.element;i.has(te)&&(x.set(te,te),this._beforeAnimationBuild(q.player.namespaceId,q.instruction,A))}),r.forEach(q=>{let te=q.element;this._getPreviousPlayers(te,!1,q.namespaceId,q.triggerName,null).forEach(ne=>{ar(A,te,[]).push(ne),ne.destroy()})});let R=T.filter(q=>SO(q,l,u)),M=new Map;IO(M,this.driver,D,u,ks).forEach(q=>{SO(q,l,u)&&R.push(q)});let j=new Map;y.forEach((q,te)=>{IO(j,this.driver,new Set(q),l,Y0)}),R.forEach(q=>{let te=M.get(q),W=j.get(q);M.set(q,new Map([...te?.entries()??[],...W?.entries()??[]]))});let B=[],pe=[],Ee={};o.forEach(q=>{let{element:te,player:W,instruction:ne}=q;if(i.has(te)){if(d.has(te)){W.onDestroy(()=>Os(te,ne.toStyles)),W.disabled=!0,W.overrideTotalTime(ne.totalTime),r.push(W);return}let ye=Ee;if(x.size>1){let ie=te,de=[];for(;ie=ie.parentNode;){let he=x.get(ie);if(he){ye=he;break}de.push(ie)}de.forEach(he=>x.set(he,ye))}let oe=this._buildAnimation(W.namespaceId,ne,A,s,j,M);if(W.setRealPlayer(oe),ye===Ee)B.push(W);else{let ie=this.playersByElement.get(ye);ie&&ie.length&&(W.parentPlayer=Ba(ie)),r.push(W)}}else sc(te,ne.fromStyles),W.onDestroy(()=>Os(te,ne.toStyles)),pe.push(W),d.has(te)&&r.push(W)}),pe.forEach(q=>{let te=s.get(q.element);if(te&&te.length){let W=Ba(te);q.setRealPlayer(W)}}),r.forEach(q=>{q.parentPlayer?q.syncPlayerEvents(q.parentPlayer):q.destroy()});for(let q=0;q<T.length;q++){let te=T[q],W=te[es];if(Xu(te,JI),W&&W.hasAnimation)continue;let ne=[];if(a.size){let oe=a.get(te);oe&&oe.length&&ne.push(...oe);let ie=this.driver.query(te,eb,!0);for(let de=0;de<ie.length;de++){let he=a.get(ie[de]);he&&he.length&&ne.push(...he)}}let ye=ne.filter(oe=>!oe.destroyed);ye.length?Z7(this,te,ye):this.processLeaveNode(te)}return T.length=0,B.forEach(q=>{this.players.push(q),q.onDone(()=>{q.destroy();let te=this.players.indexOf(q);this.players.splice(te,1)}),q.play()}),B}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,i,r,s){let o=[];if(t){let a=this.playersByQueriedElement.get(e);a&&(o=a)}else{let a=this.playersByElement.get(e);if(a){let l=!s||s==xf;a.forEach(u=>{u.queued||!l&&u.triggerName!=r||o.push(u)})}}return(i||r)&&(o=o.filter(a=>!(i&&i!=a.namespaceId||r&&r!=a.triggerName))),o}_beforeAnimationBuild(e,t,i){let r=t.triggerName,s=t.element,o=t.isRemovalTransition?void 0:e,a=t.isRemovalTransition?void 0:r;for(let l of t.timelines){let u=l.element,d=u!==s,f=ar(i,u,[]);this._getPreviousPlayers(u,d,o,a,t.toState).forEach(y=>{let v=y.getRealPlayer();v.beforeDestroy&&v.beforeDestroy(),y.destroy(),f.push(y)})}sc(s,t.fromStyles)}_buildAnimation(e,t,i,r,s,o){let a=t.triggerName,l=t.element,u=[],d=new Set,f=new Set,m=t.timelines.map(v=>{let E=v.element;d.add(E);let T=E[es];if(T&&T.removedBeforeQueried)return new Va(v.duration,v.delay);let C=E!==l,D=X7((i.get(E)||q7).map(A=>A.getRealPlayer())).filter(A=>{let x=A;return x.element?x.element===E:!1}),P=s.get(E),V=o.get(E),G=CO(this._normalizer,v.keyframes,P,V),H=this._buildPlayer(v,G,D);if(v.subTimeline&&r&&f.add(E),C){let A=new Rf(e,a,E);A.setRealPlayer(H),u.push(A)}return H});u.forEach(v=>{ar(this.playersByQueriedElement,v.element,[]).push(v),v.onDone(()=>K7(this.playersByQueriedElement,v.element,v))}),d.forEach(v=>Pr(v,mO));let y=Ba(m);return y.onDestroy(()=>{d.forEach(v=>Xu(v,mO)),Os(l,t.toStyles)}),f.forEach(v=>{ar(r,v,[]).push(y)}),y}_buildPlayer(e,t,i){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,i):new Va(e.duration,e.delay)}},Rf=class{constructor(e,t,i){this.namespaceId=e,this.triggerName=t,this.element=i,this._player=new Va,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,i)=>{t.forEach(r=>mb(e,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){ar(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let t=this._player;t.triggerCallback&&t.triggerCallback(e)}};function K7(n,e,t){let i=n.get(e);if(i){if(i.length){let r=i.indexOf(t);i.splice(r,1)}i.length==0&&n.delete(e)}return i}function Y7(n){return n??null}function J0(n){return n&&n.nodeType===1}function Q7(n){return n=="start"||n=="done"}function wO(n,e){let t=n.style.display;return n.style.display=e??"none",t}function IO(n,e,t,i,r){let s=[];t.forEach(l=>s.push(wO(l)));let o=[];i.forEach((l,u)=>{let d=new Map;l.forEach(f=>{let m=e.computeStyle(u,f,r);d.set(f,m),(!m||m.length==0)&&(u[es]=W7,o.push(u))}),n.set(u,d)});let a=0;return t.forEach(l=>wO(l,s[a++])),o}function bO(n,e){let t=new Map;if(n.forEach(a=>t.set(a,[])),e.length==0)return t;let i=1,r=new Set(e),s=new Map;function o(a){if(!a)return i;let l=s.get(a);if(l)return l;let u=a.parentNode;return t.has(u)?l=u:r.has(u)?l=i:l=o(u),s.set(a,l),l}return e.forEach(a=>{let l=o(a);l!==i&&t.get(l).push(a)}),t}function Pr(n,e){n.classList?.add(e)}function Xu(n,e){n.classList?.remove(e)}function Z7(n,e,t){Ba(t).onDone(()=>n.processLeaveNode(e))}function X7(n){let e=[];return FO(n,e),e}function FO(n,e){for(let t=0;t<n.length;t++){let i=n[t];i instanceof If?FO(i.players,e):e.push(i)}}function J7(n,e){let t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let r=0;r<t.length;r++){let s=t[r];if(!e.hasOwnProperty(s)||n[s]!==e[s])return!1}return!0}function SO(n,e,t){let i=t.get(n);if(!i)return!1;let r=e.get(n);return r?i.forEach(s=>r.add(s)):e.set(n,i),t.delete(n),!0}var Ju=class{constructor(e,t,i){this._driver=t,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new hb(e.body,t,i),this._timelineEngine=new ub(e.body,t,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(e,t,i,r,s){let o=e+"-"+r,a=this._triggerCache[o];if(!a){let l=[],u=[],d=kO(this._driver,s,l,u);if(l.length)throw J9(r,l);u.length&&void 0,a=B7(r,d,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(t,r,a)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,i,r){this._transitionEngine.insertNode(e,t,i,r)}onRemove(e,t,i){this._transitionEngine.removeNode(e,t,i)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,i,r){if(i.charAt(0)=="@"){let[s,o]=fO(i),a=r;this._timelineEngine.command(s,t,o,a)}else this._transitionEngine.trigger(e,t,i,r)}listen(e,t,i,r,s){if(i.charAt(0)=="@"){let[o,a]=fO(i);return this._timelineEngine.listen(o,t,a,s)}return this._transitionEngine.listen(e,t,i,r,s)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}};function eq(n,e){let t=null,i=null;return Array.isArray(e)&&e.length?(t=XI(e[0]),e.length>1&&(i=XI(e[e.length-1]))):e instanceof Map&&(t=XI(e)),t||i?new fb(n,t,i):null}var fb=class n{static{this.initialStylesByElement=new WeakMap}constructor(e,t,i){this._element=e,this._startStyles=t,this._endStyles=i,this._state=0;let r=n.initialStylesByElement.get(e);r||n.initialStylesByElement.set(e,r=new Map),this._initialStyles=r}start(){this._state<1&&(this._startStyles&&Os(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Os(this._element,this._initialStyles),this._endStyles&&(Os(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(sc(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(sc(this._element,this._endStyles),this._endStyles=null),Os(this._element,this._initialStyles),this._state=3)}};function XI(n){let e=null;return n.forEach((t,i)=>{tq(i)&&(e=e||new Map,e.set(i,t))}),e}function tq(n){return n==="display"||n==="position"}var ly=class{constructor(e,t,i,r){this.element=e,this.keyframes=t,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map;let t=()=>this._onFinish();this.domPlayer.addEventListener("finish",t),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",t)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){let t=[];return e.forEach(i=>{t.push(Object.fromEntries(i))}),t}_triggerWebAnimation(e,t,i){return e.animate(this._convertKeyframesToObject(t),i)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{r!=="offset"&&e.set(r,this._finished?i:Eb(this.element,r))}),this.currentSnapshot=e}triggerCallback(e){let t=e==="start"?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}},cy=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}containsElement(e,t){return xO(e,t)}getParentElement(e){return yb(e)}query(e,t,i){return AO(e,t,i)}computeStyle(e,t,i){return Eb(e,t)}animate(e,t,i,r,s,o=[]){let a=r==0?"both":"forwards",l={duration:i,delay:r,fill:a};s&&(l.easing=s);let u=new Map,d=o.filter(y=>y instanceof ly);T7(i,r)&&d.forEach(y=>{y.currentSnapshot.forEach((v,E)=>u.set(E,v))});let f=v7(t).map(y=>new Map(y));f=w7(e,f,u);let m=eq(e,f);return new ly(e,f,l,m)}};var ey="@",VO="@.disabled",uy=class{constructor(e,t,i,r){this.namespaceId=e,this.delegate=t,this.engine=i,this._onDestroy=r,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,i,r=!0){this.delegate.insertBefore(e,t,i),this.engine.onInsert(this.namespaceId,t,e,r)}removeChild(e,t,i){this.parentNode(t)&&this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,i,r){this.delegate.setAttribute(e,t,i,r)}removeAttribute(e,t,i){this.delegate.removeAttribute(e,t,i)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,i,r){this.delegate.setStyle(e,t,i,r)}removeStyle(e,t,i){this.delegate.removeStyle(e,t,i)}setProperty(e,t,i){t.charAt(0)==ey&&t==VO?this.disableAnimations(e,!!i):this.delegate.setProperty(e,t,i)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,i){return this.delegate.listen(e,t,i)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}},pb=class extends uy{constructor(e,t,i,r,s){super(t,i,r,s),this.factory=e,this.namespaceId=t}setProperty(e,t,i){t.charAt(0)==ey?t.charAt(1)=="."&&t==VO?(i=i===void 0?!0:!!i,this.disableAnimations(e,i)):this.engine.process(this.namespaceId,e,t.slice(1),i):this.delegate.setProperty(e,t,i)}listen(e,t,i){if(t.charAt(0)==ey){let r=nq(e),s=t.slice(1),o="";return s.charAt(0)!=ey&&([s,o]=iq(s)),this.engine.listen(this.namespaceId,r,s,o,a=>{let l=a._data||-1;this.factory.scheduleListenerCallback(l,i,a)})}return this.delegate.listen(e,t,i)}};function nq(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}function iq(n){let e=n.indexOf("."),t=n.substring(0,e),i=n.slice(e+1);return[t,i]}var dy=class{constructor(e,t,i){this.delegate=e,this.engine=t,this._zone=i,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,t.onRemovalComplete=(r,s)=>{s?.removeChild(null,r)}}createRenderer(e,t){let i="",r=this.delegate.createRenderer(e,t);if(!e||!t?.data?.animation){let u=this._rendererCache,d=u.get(r);if(!d){let f=()=>u.delete(r);d=new uy(i,r,this.engine,f),u.set(r,d)}return d}let s=t.id,o=t.id+"-"+this._currentId;this._currentId++,this.engine.register(o,e);let a=u=>{Array.isArray(u)?u.forEach(a):this.engine.registerTrigger(s,o,e,u.name,u)};return t.data.animation.forEach(a),new pb(this,o,r,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,i){if(e>=0&&e<this._microtaskId){this._zone.run(()=>t(i));return}let r=this._animationCallbacksBuffer;r.length==0&&queueMicrotask(()=>{this._zone.run(()=>{r.forEach(s=>{let[o,a]=s;o(a)}),this._animationCallbacksBuffer=[]})}),r.push([t,i])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var sq=(()=>{class n extends Ju{constructor(t,i,r){super(t,i,r)}ngOnDestroy(){this.flush()}static{this.\u0275fac=function(i){return new(i||n)(Me(Wn),Me(oc),Me(ac))}}static{this.\u0275prov=Se({token:n,factory:n.\u0275fac})}}return n})();function oq(){return new iy}function aq(n,e,t){return new dy(n,e,t)}var BO=[{provide:ac,useFactory:oq},{provide:Ju,useClass:sq},{provide:Ia,useFactory:aq,deps:[A0,Ju,Ct]}],lq=[{provide:oc,useFactory:()=>new cy},{provide:vw,useValue:"BrowserAnimations"},...BO],vhe=[{provide:oc,useClass:vb},{provide:vw,useValue:"NoopAnimations"},...BO];function UO(){return Da("NgEagerAnimations"),[...lq]}var jO=function(n){let e=[],t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},cq=function(n){let e=[],t=0,i=0;for(;t<n.length;){let r=n[t++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=n[t++];e[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){let s=n[t++],o=n[t++],a=n[t++],l=((r&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{let s=n[t++],o=n[t++];e[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|o&63)}}return e.join("")},GO={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){let s=n[r],o=r+1<n.length,a=o?n[r+1]:0,l=r+2<n.length,u=l?n[r+2]:0,d=s>>2,f=(s&3)<<4|a>>4,m=(a&15)<<2|u>>6,y=u&63;l||(y=64,o||(m=64)),i.push(t[d],t[f],t[m],t[y])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(jO(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):cq(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){let s=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;let u=r<n.length?t[n.charAt(r)]:64;++r;let f=r<n.length?t[n.charAt(r)]:64;if(++r,s==null||a==null||u==null||f==null)throw new Ib;let m=s<<2|a>>4;if(i.push(m),u!==64){let y=a<<4&240|u>>2;if(i.push(y),f!==64){let v=u<<6&192|f;i.push(v)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Ib=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},uq=function(n){let e=jO(n);return GO.encodeByteArray(e,!0)},Mf=function(n){return uq(n).replace(/\./g,"")},Sb=function(n){try{return GO.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function dq(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var hq=()=>dq().__FIREBASE_DEFAULTS__,fq=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},pq=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&Sb(n[1]);return e&&JSON.parse(e)},fy=()=>{try{return hq()||fq()||pq()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Cb=n=>{var e,t;return(t=(e=fy())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},zO=n=>{let e=Cb(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},xb=()=>{var n;return(n=fy())===null||n===void 0?void 0:n.config},Ab=n=>{var e;return(e=fy())===null||e===void 0?void 0:e[`_${n}`]};var hy=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}};function HO(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},i=e||"demo-project",r=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Mf(JSON.stringify(t)),Mf(JSON.stringify(o)),""].join(".")}function Yn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function qO(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Yn())}function mq(){var n;let e=(n=fy())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function WO(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function KO(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function YO(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function QO(){let n=Yn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function ZO(){return!mq()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Db(){try{return typeof indexedDB=="object"}catch{return!1}}function XO(){return new Promise((n,e)=>{try{let t=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var s;e(((s=r.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var gq="FirebaseError",lr=class n extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=gq,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Lo.prototype.create)}},Lo=class{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){let i=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],o=s?yq(s,i):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new lr(r,a,i)}};function yq(n,e){return n.replace(vq,(t,i)=>{let r=e[i];return r!=null?String(r):`<${i}?>`})}var vq=/\{\$([^}]+)}/g;function JO(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Oo(n,e){if(n===e)return!0;let t=Object.keys(n),i=Object.keys(e);for(let r of t){if(!i.includes(r))return!1;let s=n[r],o=e[r];if($O(s)&&$O(o)){if(!Oo(s,o))return!1}else if(s!==o)return!1}for(let r of i)if(!t.includes(r))return!1;return!0}function $O(n){return n!==null&&typeof n=="object"}function ed(n){let e=[];for(let[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function eN(n,e){let t=new bb(n,e);return t.subscribe.bind(t)}var bb=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let r;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");_q(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:i},r.next===void 0&&(r.next=wb),r.error===void 0&&(r.error=wb),r.complete===void 0&&(r.complete=wb);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function _q(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function wb(){}var Ehe=4*60*60*1e3;function wn(n){return n&&n._delegate?n._delegate:n}var Rr=class{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var lc="[DEFAULT]";var Pb=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let i=new hy;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let i=this.normalizeInstanceIdentifier(e?.identifier),r=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Tq(e))try{this.getOrInitializeService({instanceIdentifier:lc})}catch{}for(let[t,i]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=lc){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return U(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=lc){return this.instances.has(e)}getOptions(e=lc){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:i,options:t});for(let[s,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(s);i===a&&o.resolve(r)}return r}onInit(e,t){var i;let r=this.normalizeInstanceIdentifier(t),s=(i=this.onInitCallbacks.get(r))!==null&&i!==void 0?i:new Set;s.add(e),this.onInitCallbacks.set(r,s);let o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let i=this.onInitCallbacks.get(t);if(i)for(let r of i)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:Eq(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=lc){return this.component?this.component.multipleInstances?e:lc:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Eq(n){return n===lc?void 0:n}function Tq(n){return n.instantiationMode==="EAGER"}var py=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new Pb(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var wq=[],vt=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(vt||{}),Iq={debug:vt.DEBUG,verbose:vt.VERBOSE,info:vt.INFO,warn:vt.WARN,error:vt.ERROR,silent:vt.SILENT},bq=vt.INFO,Sq={[vt.DEBUG]:"log",[vt.VERBOSE]:"log",[vt.INFO]:"info",[vt.WARN]:"warn",[vt.ERROR]:"error"},Cq=(n,e,...t)=>{if(e<n.logLevel)return;let i=new Date().toISOString(),r=Sq[e];if(r)console[r](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Ua=class{constructor(e){this.name=e,this._logLevel=bq,this._logHandler=Cq,this._userLogHandler=null,wq.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in vt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Iq[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,vt.DEBUG,...e),this._logHandler(this,vt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,vt.VERBOSE,...e),this._logHandler(this,vt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,vt.INFO,...e),this._logHandler(this,vt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,vt.WARN,...e),this._logHandler(this,vt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,vt.ERROR,...e),this._logHandler(this,vt.ERROR,...e)}};var xq=(n,e)=>e.some(t=>n instanceof t),tN,nN;function Aq(){return tN||(tN=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Dq(){return nN||(nN=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var iN=new WeakMap,Mb=new WeakMap,rN=new WeakMap,Rb=new WeakMap,Lb=new WeakMap;function Pq(n){let e=new Promise((t,i)=>{let r=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(Ns(n.result)),r()},o=()=>{i(n.error),r()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&iN.set(t,n)}).catch(()=>{}),Lb.set(e,n),e}function Rq(n){if(Mb.has(n))return;let e=new Promise((t,i)=>{let r=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),r()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});Mb.set(n,e)}var kb={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Mb.get(n);if(e==="objectStoreNames")return n.objectStoreNames||rN.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ns(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function sN(n){kb=n(kb)}function Mq(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let i=n.call(my(this),e,...t);return rN.set(i,e.sort?e.sort():[e]),Ns(i)}:Dq().includes(n)?function(...e){return n.apply(my(this),e),Ns(iN.get(this))}:function(...e){return Ns(n.apply(my(this),e))}}function kq(n){return typeof n=="function"?Mq(n):(n instanceof IDBTransaction&&Rq(n),xq(n,Aq())?new Proxy(n,kb):n)}function Ns(n){if(n instanceof IDBRequest)return Pq(n);if(Rb.has(n))return Rb.get(n);let e=kq(n);return e!==n&&(Rb.set(n,e),Lb.set(e,n)),e}var my=n=>Lb.get(n);function aN(n,e,{blocked:t,upgrade:i,blocking:r,terminated:s}={}){let o=indexedDB.open(n,e),a=Ns(o);return i&&o.addEventListener("upgradeneeded",l=>{i(Ns(o.result),l.oldVersion,l.newVersion,Ns(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),r&&l.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}var Lq=["get","getKey","getAll","getAllKeys","count"],Oq=["put","add","delete","clear"],Ob=new Map;function oN(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ob.get(e))return Ob.get(e);let t=e.replace(/FromIndex$/,""),i=e!==t,r=Oq.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(r||Lq.includes(t)))return;let s=function(o,...a){return U(this,null,function*(){let l=this.transaction(o,r?"readwrite":"readonly"),u=l.store;return i&&(u=u.index(a.shift())),(yield Promise.all([u[t](...a),r&&l.done]))[0]})};return Ob.set(e,s),s}sN(n=>Ye(ue({},n),{get:(e,t,i)=>oN(e,t)||n.get(e,t,i),has:(e,t)=>!!oN(e,t)||n.has(e,t)}));var Fb=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Nq(t)){let i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}};function Nq(n){let e=n.getComponent();return e?.type==="VERSION"}var Vb="@firebase/app",lN="0.10.13";var No=new Ua("@firebase/app"),Fq="@firebase/app-compat",Vq="@firebase/analytics-compat",Bq="@firebase/analytics",Uq="@firebase/app-check-compat",$q="@firebase/app-check",jq="@firebase/auth",Gq="@firebase/auth-compat",zq="@firebase/database",Hq="@firebase/data-connect",qq="@firebase/database-compat",Wq="@firebase/functions",Kq="@firebase/functions-compat",Yq="@firebase/installations",Qq="@firebase/installations-compat",Zq="@firebase/messaging",Xq="@firebase/messaging-compat",Jq="@firebase/performance",eW="@firebase/performance-compat",tW="@firebase/remote-config",nW="@firebase/remote-config-compat",iW="@firebase/storage",rW="@firebase/storage-compat",sW="@firebase/firestore",oW="@firebase/vertexai-preview",aW="@firebase/firestore-compat",lW="firebase",cW="10.14.1";var Bb="[DEFAULT]",uW={[Vb]:"fire-core",[Fq]:"fire-core-compat",[Bq]:"fire-analytics",[Vq]:"fire-analytics-compat",[$q]:"fire-app-check",[Uq]:"fire-app-check-compat",[jq]:"fire-auth",[Gq]:"fire-auth-compat",[zq]:"fire-rtdb",[Hq]:"fire-data-connect",[qq]:"fire-rtdb-compat",[Wq]:"fire-fn",[Kq]:"fire-fn-compat",[Yq]:"fire-iid",[Qq]:"fire-iid-compat",[Zq]:"fire-fcm",[Xq]:"fire-fcm-compat",[Jq]:"fire-perf",[eW]:"fire-perf-compat",[tW]:"fire-rc",[nW]:"fire-rc-compat",[iW]:"fire-gcs",[rW]:"fire-gcs-compat",[sW]:"fire-fst",[aW]:"fire-fst-compat",[oW]:"fire-vertex","fire-js":"fire-js",[lW]:"fire-js-all"};var kf=new Map,dW=new Map,Ub=new Map;function cN(n,e){try{n.container.addComponent(e)}catch(t){No.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ja(n){let e=n.name;if(Ub.has(e))return No.debug(`There were multiple attempts to register component ${e}.`),!1;Ub.set(e,n);for(let t of kf.values())cN(t,n);for(let t of dW.values())cN(t,n);return!0}function Of(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Fs(n){return n.settings!==void 0}var hW={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},$a=new Lo("app","Firebase",hW);var $b=class{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Rr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw $a.create("app-deleted",{appName:this._name})}};var Ga=cW;function zb(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let i=Object.assign({name:Bb,automaticDataCollectionEnabled:!1},e),r=i.name;if(typeof r!="string"||!r)throw $a.create("bad-app-name",{appName:String(r)});if(t||(t=xb()),!t)throw $a.create("no-options");let s=kf.get(r);if(s){if(Oo(t,s.options)&&Oo(i,s.config))return s;throw $a.create("duplicate-app",{appName:r})}let o=new py(r);for(let l of Ub.values())o.addComponent(l);let a=new $b(t,i,o);return kf.set(r,a),a}function td(n=Bb){let e=kf.get(n);if(!e&&n===Bb&&xb())return zb();if(!e)throw $a.create("no-app",{appName:n});return e}function gy(){return Array.from(kf.values())}function Un(n,e,t){var i;let r=(i=uW[n])!==null&&i!==void 0?i:n;t&&(r+=`-${t}`);let s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),No.warn(a.join(" "));return}ja(new Rr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}var fW="firebase-heartbeat-database",pW=1,Lf="firebase-heartbeat-store",Nb=null;function fN(){return Nb||(Nb=aN(fW,pW,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Lf)}catch(t){console.warn(t)}}}}).catch(n=>{throw $a.create("idb-open",{originalErrorMessage:n.message})})),Nb}function mW(n){return U(this,null,function*(){try{let t=(yield fN()).transaction(Lf),i=yield t.objectStore(Lf).get(pN(n));return yield t.done,i}catch(e){if(e instanceof lr)No.warn(e.message);else{let t=$a.create("idb-get",{originalErrorMessage:e?.message});No.warn(t.message)}}})}function uN(n,e){return U(this,null,function*(){try{let i=(yield fN()).transaction(Lf,"readwrite");yield i.objectStore(Lf).put(e,pN(n)),yield i.done}catch(t){if(t instanceof lr)No.warn(t.message);else{let i=$a.create("idb-set",{originalErrorMessage:t?.message});No.warn(i.message)}}})}function pN(n){return`${n.name}!${n.options.appId}`}var gW=1024,yW=30*24*60*60*1e3,jb=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Gb(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}triggerHeartbeat(){return U(this,null,function*(){var e,t;try{let r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=dN();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{let a=new Date(o.date).valueOf();return Date.now()-a<=yW}),this._storage.overwrite(this._heartbeatsCache))}catch(i){No.warn(i)}})}getHeartbeatsHeader(){return U(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=dN(),{heartbeatsToSend:i,unsentEntries:r}=vW(this._heartbeatsCache.heartbeats),s=Mf(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return No.warn(t),""}})}};function dN(){return new Date().toISOString().substring(0,10)}function vW(n,e=gW){let t=[],i=n.slice();for(let r of n){let s=t.find(o=>o.agent===r.agent);if(s){if(s.dates.push(r.date),hN(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),hN(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}var Gb=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return U(this,null,function*(){return Db()?XO().then(()=>!0).catch(()=>!1):!1})}read(){return U(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield mW(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return U(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let r=yield this.read();return uN(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return U(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let r=yield this.read();return uN(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return})}};function hN(n){return Mf(JSON.stringify({version:2,heartbeats:n})).length}function _W(n){ja(new Rr("platform-logger",e=>new Fb(e),"PRIVATE")),ja(new Rr("heartbeat",e=>new jb(e),"PRIVATE")),Un(Vb,lN,n),Un(Vb,lN,"esm2017"),Un("fire-js","")}_W("");var EW="firebase",TW="10.14.1";Un(EW,TW,"app");var uc=new vo("ANGULARFIRE2_VERSION");function vy(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Nf=(n,e)=>{let t=e?[e]:gy(),i=[];return t.forEach(r=>{r.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},id=class{constructor(){return Nf(wW)}},wW="app-check";function nd(){}var yy=class{zone;delegate;constructor(e,t=DE){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,i){let r=this.zone,s=function(o){r.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,i)}},Hb=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let i=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",nd,{},nd,nd)),t.pipe(Dn({next:i,complete:i,error:i})).subscribe(e).add(i)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},rd=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new yy(Zone.current)),this.insideAngular=t.run(()=>new yy(Zone.current,AE)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(i){return new(i||n)(Me(Ct))};static \u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function _y(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function IW(n){return _y().ngZone.runOutsideAngular(()=>n())}function cc(n){return _y().ngZone.run(()=>n())}function bW(n){return SW(_y())(n)}function SW(n){return function(t){return t=t.lift(new Hb(n.ngZone)),t.pipe(fa(n.outsideAngular),ha(n.insideAngular))}}var CW=(n,e)=>function(){let i=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),cc(()=>n.apply(void 0,i))},sn=(n,e)=>function(){let t,i=arguments;for(let s=0;s<arguments.length;s++)typeof i[s]=="function"&&(e&&(t||=cc(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",nd,{},nd,nd))),i[s]=CW(i[s],t));let r=IW(()=>n.apply(this,i));if(!e)if(r instanceof nt){let s=_y();return r.pipe(fa(s.outsideAngular),ha(s.insideAngular))}else return cc(()=>r);return r instanceof nt?r.pipe(bW):r instanceof Promise?cc(()=>new Promise((s,o)=>r.then(a=>cc(()=>s(a)),a=>cc(()=>o(a))))):typeof r=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),r.apply(this,arguments)}:cc(()=>r)};var Fo=class{constructor(e){return e}},dc=class{constructor(){return gy()}};function xW(n){return n&&n.length===1?n[0]:new Fo(td())}var qb=new Pe("angularfire2._apps"),AW={provide:Fo,useFactory:xW,deps:[[new ci,qb]]},DW={provide:dc,deps:[[new ci,qb]]};function PW(n){return(e,t)=>{let i=t.get(Li);Un("angularfire",uc.full,"core"),Un("angularfire",uc.full,"app"),Un("angular",Sk.full,i.toString());let r=e.runOutsideAngular(()=>n(t));return new Fo(r)}}function mN(n,...e){return Yr([AW,DW,{provide:qb,useFactory:PW(n),multi:!0,deps:[Ct,ii,rd,...e]}])}var gN=sn(zb,!0);function MN(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var kN=MN,LN=new Lo("auth","Firebase",MN());var Sy=new Ua("@firebase/auth");function RW(n,...e){Sy.logLevel<=vt.WARN&&Sy.warn(`Auth (${Ga}): ${n}`,...e)}function Ty(n,...e){Sy.logLevel<=vt.ERROR&&Sy.error(`Auth (${Ga}): ${n}`,...e)}function qa(n,...e){throw vS(n,...e)}function Vs(n,...e){return vS(n,...e)}function ON(n,e,t){let i=Object.assign(Object.assign({},kN()),{[e]:t});return new Lo("auth","Firebase",i).create(e,{appName:n.name})}function Ha(n){return ON(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function vS(n,...e){if(typeof n!="string"){let t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return LN.create(n,...e)}function Le(n,e,...t){if(!n)throw vS(e,...t)}function Vo(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Ty(e),new Error(e)}function Wa(n,e){n||Vo(e)}function Zb(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function NN(){return yN()==="http:"||yN()==="https:"}function yN(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function MW(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(NN()||KO()||"connection"in navigator)?navigator.onLine:!0}function kW(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var hc=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Wa(t>e,"Short delay should be less than long delay!"),this.isMobile=qO()||YO()}get(){return MW()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function _S(n,e){Wa(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Cy=class{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Vo("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Vo("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Vo("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var LW={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var OW=new hc(3e4,6e4);function Uo(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function Bs(s,o,a,l){return U(this,arguments,function*(n,e,t,i,r={}){return FN(n,r,()=>U(this,null,function*(){let u={},d={};i&&(e==="GET"?d=i:u={body:JSON.stringify(i)});let f=ed(Object.assign({key:n.config.apiKey},d)).slice(1),m=yield n._getAdditionalHeaders();m["Content-Type"]="application/json",n.languageCode&&(m["X-Firebase-Locale"]=n.languageCode);let y=Object.assign({method:e,headers:m},u);return WO()||(y.referrerPolicy="no-referrer"),Cy.fetch()(VN(n,n.config.apiHost,t,f),y)}))})}function FN(n,e,t){return U(this,null,function*(){n._canInitEmulator=!1;let i=Object.assign(Object.assign({},LW),e);try{let r=new Xb(n),s=yield Promise.race([t(),r.promise]);r.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw Ff(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let a=s.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ff(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Ff(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Ff(n,"user-disabled",o);let d=i[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw ON(n,d,u);qa(n,d)}}catch(r){if(r instanceof lr)throw r;qa(n,"network-request-failed",{message:String(r)})}})}function Ny(s,o,a,l){return U(this,arguments,function*(n,e,t,i,r={}){let u=yield Bs(n,e,t,i,r);return"mfaPendingCredential"in u&&qa(n,"multi-factor-auth-required",{_serverResponse:u}),u})}function VN(n,e,t,i){let r=`${e}${t}?${i}`;return n.config.emulator?_S(n.config,r):`${n.config.apiScheme}://${r}`}var Xb=class{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Vs(this.auth,"network-request-failed")),OW.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}};function Ff(n,e,t){let i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);let r=Vs(n,e,i);return r.customData._tokenResponse=t,r}function vN(n){return n!==void 0&&n.getResponse!==void 0}function NW(n){return U(this,null,function*(){return(yield Bs(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})}function FW(n,e){return U(this,null,function*(){return Bs(n,"POST","/v1/accounts:delete",e)})}function BN(n,e){return U(this,null,function*(){return Bs(n,"POST","/v1/accounts:lookup",e)})}function Vf(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function ES(n,e=!1){return U(this,null,function*(){let t=wn(n),i=yield t.getIdToken(e),r=TS(i);Le(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");let s=typeof r.firebase=="object"?r.firebase:void 0,o=s?.sign_in_provider;return{claims:r,token:i,authTime:Vf(Wb(r.auth_time)),issuedAtTime:Vf(Wb(r.iat)),expirationTime:Vf(Wb(r.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function Wb(n){return Number(n)*1e3}function TS(n){let[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return Ty("JWT malformed, contained fewer than 3 sections"),null;try{let r=Sb(t);return r?JSON.parse(r):(Ty("Failed to decode base64 JWT payload"),null)}catch(r){return Ty("Caught error parsing JWT payload as JSON",r?.toString()),null}}function _N(n){let e=TS(n);return Le(e,"internal-error"),Le(typeof e.exp<"u","internal-error"),Le(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Uf(n,e,t=!1){return U(this,null,function*(){if(t)return e;try{return yield e}catch(i){throw i instanceof lr&&VW(i)&&n.auth.currentUser===n&&(yield n.auth.signOut()),i}})}function VW({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Jb=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;let r=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>U(this,null,function*(){yield this.iteration()}),t)}iteration(){return U(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var $f=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Vf(this.lastLoginAt),this.creationTime=Vf(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function xy(n){return U(this,null,function*(){var e;let t=n.auth,i=yield n.getIdToken(),r=yield Uf(n,BN(t,{idToken:i}));Le(r?.users.length,t,"internal-error");let s=r.users[0];n._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?UN(s.providerUserInfo):[],a=BW(n.providerData,o),l=n.isAnonymous,u=!(n.email&&s.passwordHash)&&!a?.length,d=l?u:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new $f(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,f)})}function wS(n){return U(this,null,function*(){let e=wn(n);yield xy(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function BW(n,e){return[...n.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}function UN(n){return n.map(e=>{var{providerId:t}=e,i=PE(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}function UW(n,e){return U(this,null,function*(){let t=yield FN(n,{},()=>U(this,null,function*(){let i=ed({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,o=VN(n,r,"/v1/token",`key=${s}`),a=yield n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Cy.fetch()(o,{method:"POST",headers:a,body:i})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function $W(n,e){return U(this,null,function*(){return Bs(n,"POST","/v2/accounts:revokeToken",Uo(n,e))})}var Bf=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Le(e.idToken,"internal-error"),Le(typeof e.idToken<"u","internal-error"),Le(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):_N(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Le(e.length!==0,"internal-error");let t=_N(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return U(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Le(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return U(this,null,function*(){let{accessToken:i,refreshToken:r,expiresIn:s}=yield UW(e,t);this.updateTokensAndExpiration(i,r,Number(s))})}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){let{refreshToken:i,accessToken:r,expirationTime:s}=t,o=new n;return i&&(Le(typeof i=="string","internal-error",{appName:e}),o.refreshToken=i),r&&(Le(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),s&&(Le(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return Vo("not implemented")}};function za(n,e){Le(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var sd=class n{constructor(e){var{uid:t,auth:i,stsTokenManager:r}=e,s=PE(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Jb(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new $f(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return U(this,null,function*(){let t=yield Uf(this,this.stsTokenManager.getToken(this.auth,e));return Le(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return ES(this,e)}reload(){return wS(this)}_assign(e){this!==e&&(Le(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Le(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return U(this,null,function*(){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&(yield xy(this)),yield this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)})}delete(){return U(this,null,function*(){if(Fs(this.auth.app))return Promise.reject(Ha(this.auth));let e=yield this.getIdToken();return yield Uf(this,FW(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,r,s,o,a,l,u,d;let f=(i=t.displayName)!==null&&i!==void 0?i:void 0,m=(r=t.email)!==null&&r!==void 0?r:void 0,y=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,v=(o=t.photoURL)!==null&&o!==void 0?o:void 0,E=(a=t.tenantId)!==null&&a!==void 0?a:void 0,T=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,C=(u=t.createdAt)!==null&&u!==void 0?u:void 0,D=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:P,emailVerified:V,isAnonymous:G,providerData:H,stsTokenManager:A}=t;Le(P&&A,e,"internal-error");let x=Bf.fromJSON(this.name,A);Le(typeof P=="string",e,"internal-error"),za(f,e.name),za(m,e.name),Le(typeof V=="boolean",e,"internal-error"),Le(typeof G=="boolean",e,"internal-error"),za(y,e.name),za(v,e.name),za(E,e.name),za(T,e.name),za(C,e.name),za(D,e.name);let R=new n({uid:P,auth:e,email:m,emailVerified:V,displayName:f,isAnonymous:G,photoURL:v,phoneNumber:y,tenantId:E,stsTokenManager:x,createdAt:C,lastLoginAt:D});return H&&Array.isArray(H)&&(R.providerData=H.map(M=>Object.assign({},M))),T&&(R._redirectEventId=T),R}static _fromIdTokenResponse(e,t,i=!1){return U(this,null,function*(){let r=new Bf;r.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:i});return yield xy(s),s})}static _fromGetAccountInfoResponse(e,t,i){return U(this,null,function*(){let r=t.users[0];Le(r.localId!==void 0,"internal-error");let s=r.providerUserInfo!==void 0?UN(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!s?.length,a=new Bf;a.updateFromIdToken(i);let l=new n({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new $f(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!s?.length};return Object.assign(l,u),l})}};var EN=new Map;function Bo(n){Wa(n instanceof Function,"Expected a class definition");let e=EN.get(n);return e?(Wa(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,EN.set(n,e),e)}var jW=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return U(this,null,function*(){return!0})}_set(t,i){return U(this,null,function*(){this.storage[t]=i})}_get(t){return U(this,null,function*(){let i=this.storage[t];return i===void 0?null:i})}_remove(t){return U(this,null,function*(){delete this.storage[t]})}_addListener(t,i){}_removeListener(t,i){}}return n.type="NONE",n})(),eS=jW;function wy(n,e,t){return`firebase:${n}:${e}:${t}`}var Ay=class n{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;let{config:r,name:s}=this.auth;this.fullUserKey=wy(this.userKey,r.apiKey,s),this.fullPersistenceKey=wy("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return U(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);return e?sd._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return U(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,i="authUser"){return U(this,null,function*(){if(!t.length)return new n(Bo(eS),e,i);let r=(yield Promise.all(t.map(u=>U(this,null,function*(){if(yield u._isAvailable())return u})))).filter(u=>u),s=r[0]||Bo(eS),o=wy(i,e.config.apiKey,e.name),a=null;for(let u of t)try{let d=yield u._get(o);if(d){let f=sd._fromJSON(e,d);u!==s&&(a=f),s=u;break}}catch{}let l=r.filter(u=>u._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new n(s,e,i):(s=l[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(t.map(u=>U(this,null,function*(){if(u!==s)try{yield u._remove(o)}catch{}}))),new n(s,e,i))})}};function TN(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(zN(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if($N(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(qN(e))return"Blackberry";if(WN(e))return"Webos";if(jN(e))return"Safari";if((e.includes("chrome/")||GN(e))&&!e.includes("edge/"))return"Chrome";if(HN(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if(i?.length===2)return i[1]}return"Other"}function $N(n=Yn()){return/firefox\//i.test(n)}function jN(n=Yn()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function GN(n=Yn()){return/crios\//i.test(n)}function zN(n=Yn()){return/iemobile/i.test(n)}function HN(n=Yn()){return/android/i.test(n)}function qN(n=Yn()){return/blackberry/i.test(n)}function WN(n=Yn()){return/webos/i.test(n)}function IS(n=Yn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function GW(n=Yn()){var e;return IS(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function zW(){return QO()&&document.documentMode===10}function KN(n=Yn()){return IS(n)||HN(n)||WN(n)||qN(n)||/windows phone/i.test(n)||zN(n)}function YN(n,e=[]){let t;switch(n){case"Browser":t=TN(Yn());break;case"Worker":t=`${TN(Yn())}-${n}`;break;default:t=n}let i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ga}/${i}`}var tS=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let i=s=>new Promise((o,a)=>{try{let l=e(s);o(l)}catch(l){a(l)}});i.onAbort=t,this.queue.push(i);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}runMiddleware(e){return U(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let i of this.queue)yield i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(let r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}})}};function HW(t){return U(this,arguments,function*(n,e={}){return Bs(n,"GET","/v2/passwordPolicy",Uo(n,e))})}var qW=6,nS=class{constructor(e){var t,i,r,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:qW,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(r=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&r!==void 0?r:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,r,s,o,a;let l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(i=l.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(r=l.containsLowercaseLetter)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsUppercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){let i=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let r=0;r<e.length;r++)i=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var iS=class{constructor(e,t,i,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Dy(this),this.idTokenSubscription=new Dy(this),this.beforeStateQueue=new tS(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=LN,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Bo(t)),this._initializationPromise=this.queue(()=>U(this,null,function*(){var i,r;if(!this._deleted&&(this.persistenceManager=yield Ay.create(this,e),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return U(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return U(this,null,function*(){try{let t=yield BN(this,{idToken:e}),i=yield sd._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return U(this,null,function*(){var t;if(Fs(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let i=yield this.assertedPersistence.getCurrentUser(),r=i,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=r?._redirectEventId,l=yield this.tryRedirectSignIn(e);(!o||o===a)&&l?.user&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(r)}catch(o){r=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Le(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(e){return U(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return U(this,null,function*(){try{yield xy(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=kW()}_delete(){return U(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return U(this,null,function*(){if(Fs(this.app))return Promise.reject(Ha(this));let t=e?wn(e):null;return t&&Le(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return U(this,null,function*(){if(!this._deleted)return e&&Le(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>U(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return U(this,null,function*(){return Fs(this.app)?Promise.reject(Ha(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Fs(this.app)?Promise.reject(Ha(this)):this.queue(()=>U(this,null,function*(){yield this.assertedPersistence.setPersistence(Bo(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return U(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return U(this,null,function*(){let e=yield HW(this),t=new nS(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Lo("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let i=this.onAuthStateChanged(()=>{i(),e()},t)}})}revokeAccessToken(e){return U(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),yield $W(this,i)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return U(this,null,function*(){let i=yield this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return U(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&Bo(e)||this._popupRedirectResolver;Le(t,this,"argument-error"),this.redirectPersistenceManager=yield Ay.create(this,[Bo(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return U(this,null,function*(){var t,i;return this._isInitialized&&(yield this.queue(()=>U(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return U(this,null,function*(){if(e===this.currentUser)return this.queue(()=>U(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,r){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Le(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let l=e.addObserver(t,i,r);return()=>{o=!0,l()}}else{let l=e.addObserver(t);return()=>{o=!0,l()}}}directlySetCurrentUser(e){return U(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Le(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=YN(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return U(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let i=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();i&&(t["X-Firebase-Client"]=i);let r=yield this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t})}_getAppCheckToken(){return U(this,null,function*(){var e;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&RW(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function od(n){return wn(n)}var Dy=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=eN(t=>this.observer=t)}get next(){return Le(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Fy={loadJS(){return U(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function WW(n){Fy=n}function QN(n){return Fy.loadJS(n)}function KW(){return Fy.recaptchaV2Script}function YW(){return Fy.gapiScript}function ZN(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function bS(n,e){let t=Of(n,"auth");if(t.isInitialized()){let r=t.getImmediate(),s=t.getOptions();if(Oo(s,e??{}))return r;qa(r,"already-initialized")}return t.initialize({options:e})}function QW(n,e){let t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(Bo);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}function SS(n,e,t){let i=od(n);Le(i._canInitEmulator,i,"emulator-config-failed"),Le(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");let r=!!t?.disableWarnings,s=XN(e),{host:o,port:a}=ZW(e),l=a===null?"":`:${a}`;i.config.emulator={url:`${s}//${o}${l}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||XW()}function XN(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function ZW(n){let e=XN(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let i=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let s=r[1];return{host:s,port:wN(i.substr(s.length+1))}}else{let[s,o]=i.split(":");return{host:s,port:wN(o)}}}function wN(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function XW(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var jf=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Vo("not implemented")}_getIdTokenResponse(e){return Vo("not implemented")}_linkToIdToken(e,t){return Vo("not implemented")}_getReauthenticationResolver(e){return Vo("not implemented")}};function Kb(n,e){return U(this,null,function*(){return Ny(n,"POST","/v1/accounts:signInWithIdp",Uo(n,e))})}function JW(n,e){return U(this,null,function*(){return Bs(n,"POST","/v1/accounts:sendVerificationCode",Uo(n,e))})}function eK(n,e){return U(this,null,function*(){return Ny(n,"POST","/v1/accounts:signInWithPhoneNumber",Uo(n,e))})}function tK(n,e){return U(this,null,function*(){let t=yield Ny(n,"POST","/v1/accounts:signInWithPhoneNumber",Uo(n,e));if(t.temporaryProof)throw Ff(n,"account-exists-with-different-credential",t);return t})}var nK={USER_NOT_FOUND:"user-not-found"};function iK(n,e){return U(this,null,function*(){let t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Ny(n,"POST","/v1/accounts:signInWithPhoneNumber",Uo(n,t),nK)})}var Py=class n extends jf{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new n({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new n({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return eK(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return tK(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return iK(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:i,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:i,code:r}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));let{verificationId:t,verificationCode:i,phoneNumber:r,temporaryProof:s}=e;return!i&&!t&&!r&&!s?null:new n({verificationId:t,verificationCode:i,phoneNumber:r,temporaryProof:s})}};var Ry=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var rS=class extends Ry{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};var Gf=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,i,r=!1){return U(this,null,function*(){let s=yield sd._fromIdTokenResponse(e,i,r),o=IN(i);return new n({user:s,providerId:o,_tokenResponse:i,operationType:t})})}static _forOperation(e,t,i){return U(this,null,function*(){yield e._updateTokensIfNecessary(i,!0);let r=IN(i);return new n({user:e,providerId:r,_tokenResponse:i,operationType:t})})}};function IN(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var sS=class n extends lr{constructor(e,t,i,r){var s;super(t.code,t.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,r){return new n(e,t,i,r)}};function JN(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?sS._fromErrorAndOperation(n,s,e,i):s})}function rK(n,e,t=!1){return U(this,null,function*(){let i=yield Uf(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return Gf._forOperation(n,"link",i)})}function sK(n,e,t=!1){return U(this,null,function*(){let{auth:i}=n;if(Fs(i.app))return Promise.reject(Ha(i));let r="reauthenticate";try{let s=yield Uf(n,JN(i,r,e,n),t);Le(s.idToken,i,"internal-error");let o=TS(s.idToken);Le(o,i,"internal-error");let{sub:a}=o;return Le(n.uid===a,i,"user-mismatch"),Gf._forOperation(n,r,s)}catch(s){throw s?.code==="auth/user-not-found"&&qa(i,"user-mismatch"),s}})}function eF(n,e,t=!1){return U(this,null,function*(){if(Fs(n.app))return Promise.reject(Ha(n));let i="signIn",r=yield JN(n,i,e),s=yield Gf._fromIdTokenResponse(n,i,r);return t||(yield n._updateCurrentUser(s.user)),s})}function CS(n,e){return U(this,null,function*(){return eF(od(n),e)})}function Vy(n,e,t,i){return wn(n).onIdTokenChanged(e,t,i)}function xS(n,e,t){return wn(n).beforeAuthStateChanged(e,t)}function Hf(n,e,t,i){return wn(n).onAuthStateChanged(e,t,i)}function oK(n,e){return Bs(n,"POST","/v2/accounts/mfaEnrollment:start",Uo(n,e))}var My="__sak";var ky=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(My,"1"),this.storage.removeItem(My),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var aK=1e3,lK=10,cK=(()=>{class n extends ky{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,i)=>this.onStorageEvent(t,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=KN(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let i of Object.keys(this.listeners)){let r=this.storage.getItem(i),s=this.localCache[i];r!==s&&t(i,s,r)}}onStorageEvent(t,i=!1){if(!t.key){this.forAllChangedKeys((a,l,u)=>{this.notifyListeners(a,u)});return}let r=t.key;i?this.detachListener():this.stopPolling();let s=()=>{let a=this.storage.getItem(r);!i&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);zW()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,lK):s()}notifyListeners(t,i){this.localCache[t]=i;let r=this.listeners[t];if(r)for(let s of Array.from(r))s(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,i,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:i,newValue:r}),!0)})},aK)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,i){return U(this,null,function*(){yield ua(n.prototype,this,"_set").call(this,t,i),this.localCache[t]=JSON.stringify(i)})}_get(t){return U(this,null,function*(){let i=yield ua(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(i),i})}_remove(t){return U(this,null,function*(){yield ua(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),tF=cK;var uK=(()=>{class n extends ky{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,i){}_removeListener(t,i){}}return n.type="SESSION",n})(),AS=uK;function dK(n){return Promise.all(n.map(e=>U(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var hK=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let i=this.receivers.find(s=>s.isListeningto(t));if(i)return i;let r=new n(t);return this.receivers.push(r),r}isListeningto(t){return this.eventTarget===t}handleEvent(t){return U(this,null,function*(){let i=t,{eventId:r,eventType:s,data:o}=i.data,a=this.handlersMap[s];if(!a?.size)return;i.ports[0].postMessage({status:"ack",eventId:r,eventType:s});let l=Array.from(a).map(d=>U(this,null,function*(){return d(i.origin,o)})),u=yield dK(l);i.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})})}_subscribe(t,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(i)}_unsubscribe(t,i){this.handlersMap[t]&&i&&this.handlersMap[t].delete(i),(!i||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function nF(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}var oS=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,i=50){return U(this,null,function*(){let r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,o;return new Promise((a,l)=>{let u=nF("",20);r.port1.start();let d=setTimeout(()=>{l(new Error("unsupported_event"))},i);o={messageChannel:r,onMessage(f){let m=f;if(m.data.eventId===u)switch(m.data.status){case"ack":clearTimeout(d),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(m.data.response);break;default:clearTimeout(d),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};function Rn(){return window}function fK(n){Rn().location.href=n}function DS(){return typeof Rn().WorkerGlobalScope<"u"&&typeof Rn().importScripts=="function"}function pK(){return U(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function mK(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function gK(){return DS()?self:null}var iF="firebaseLocalStorageDb",yK=1,Ly="firebaseLocalStorage",rF="fbase_key",fc=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function By(n,e){return n.transaction([Ly],e?"readwrite":"readonly").objectStore(Ly)}function vK(){let n=indexedDB.deleteDatabase(iF);return new fc(n).toPromise()}function aS(){let n=indexedDB.open(iF,yK);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let i=n.result;try{i.createObjectStore(Ly,{keyPath:rF})}catch(r){t(r)}}),n.addEventListener("success",()=>U(this,null,function*(){let i=n.result;i.objectStoreNames.contains(Ly)?e(i):(i.close(),yield vK(),e(yield aS()))}))})}function bN(n,e,t){return U(this,null,function*(){let i=By(n,!0).put({[rF]:e,value:t});return new fc(i).toPromise()})}function _K(n,e){return U(this,null,function*(){let t=By(n,!1).get(e),i=yield new fc(t).toPromise();return i===void 0?null:i.value})}function SN(n,e){let t=By(n,!0).delete(e);return new fc(t).toPromise()}var EK=800,TK=3,wK=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return U(this,null,function*(){return this.db?this.db:(this.db=yield aS(),this.db)})}_withRetries(t){return U(this,null,function*(){let i=0;for(;;)try{let r=yield this._openDb();return yield t(r)}catch(r){if(i++>TK)throw r;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return U(this,null,function*(){return DS()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return U(this,null,function*(){this.receiver=hK._getInstance(gK()),this.receiver._subscribe("keyChanged",(t,i)=>U(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(i.key)}})),this.receiver._subscribe("ping",(t,i)=>U(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return U(this,null,function*(){var t,i;if(this.activeServiceWorker=yield pK(),!this.activeServiceWorker)return;this.sender=new oS(this.activeServiceWorker);let r=yield this.sender._send("ping",{},800);r&&!((t=r[0])===null||t===void 0)&&t.fulfilled&&!((i=r[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return U(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||mK()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return U(this,null,function*(){try{if(!indexedDB)return!1;let t=yield aS();return yield bN(t,My,"1"),yield SN(t,My),!0}catch{}return!1})}_withPendingWrite(t){return U(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,i){return U(this,null,function*(){return this._withPendingWrite(()=>U(this,null,function*(){return yield this._withRetries(r=>bN(r,t,i)),this.localCache[t]=i,this.notifyServiceWorker(t)}))})}_get(t){return U(this,null,function*(){let i=yield this._withRetries(r=>_K(r,t));return this.localCache[t]=i,i})}_remove(t){return U(this,null,function*(){return this._withPendingWrite(()=>U(this,null,function*(){return yield this._withRetries(i=>SN(i,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return U(this,null,function*(){let t=yield this._withRetries(s=>{let o=By(s,!1).getAll();return new fc(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let i=[],r=new Set;if(t.length!==0)for(let{fbase_key:s,value:o}of t)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),i.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),i.push(s));return i})}notifyListeners(t,i){this.localCache[t]=i;let r=this.listeners[t];if(r)for(let s of Array.from(r))s(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>U(this,null,function*(){return this._poll()}),EK)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),sF=wK;function IK(n,e){return Bs(n,"POST","/v2/accounts/mfaSignIn:start",Uo(n,e))}var bK=500,SK=6e4,Ey=1e12,lS=class{constructor(e){this.auth=e,this.counter=Ey,this._widgets=new Map}render(e,t){let i=this.counter;return this._widgets.set(i,new cS(e,this.auth.name,t||{})),this.counter++,i}reset(e){var t;let i=e||Ey;(t=this._widgets.get(i))===null||t===void 0||t.delete(),this._widgets.delete(i)}getResponse(e){var t;let i=e||Ey;return((t=this._widgets.get(i))===null||t===void 0?void 0:t.getResponse())||""}execute(e){return U(this,null,function*(){var t;let i=e||Ey;return(t=this._widgets.get(i))===null||t===void 0||t.execute(),""})}},cS=class{constructor(e,t,i){this.params=i,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};let r=typeof e=="string"?document.getElementById(e):e;Le(r,"argument-error",{appName:t}),this.container=r,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=CK(50);let{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},SK)},bK))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}};function CK(n){let e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let i=0;i<n;i++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}var Yb=ZN("rcb"),xK=new hc(3e4,6e4),uS=class{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Rn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return Le(AK(t),e,"argument-error"),this.shouldResolveImmediately(t)&&vN(Rn().grecaptcha)?Promise.resolve(Rn().grecaptcha):new Promise((i,r)=>{let s=Rn().setTimeout(()=>{r(Vs(e,"network-request-failed"))},xK.get());Rn()[Yb]=()=>{Rn().clearTimeout(s),delete Rn()[Yb];let a=Rn().grecaptcha;if(!a||!vN(a)){r(Vs(e,"internal-error"));return}let l=a.render;a.render=(u,d)=>{let f=l(u,d);return this.counter++,f},this.hostLanguage=t,i(a)};let o=`${KW()}?${ed({onload:Yb,render:"explicit",hl:t})}`;QN(o).catch(()=>{clearTimeout(s),r(Vs(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Rn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}};function AK(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}var dS=class{load(e){return U(this,null,function*(){return new lS(e)})}clearedOneInstance(){}};var oF="recaptcha",DK={theme:"light",type:"image"},pc=class{constructor(e,t,i=Object.assign({},DK)){this.parameters=i,this.type=oF,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=od(e),this.isInvisible=this.parameters.size==="invisible",Le(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");let r=typeof t=="string"?document.getElementById(t):t;Le(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new dS:new uS,this.validateStartingState()}verify(){return U(this,null,function*(){this.assertNotDestroyed();let e=yield this.render(),t=this.getAssertedRecaptcha(),i=t.getResponse(e);return i||new Promise(r=>{let s=o=>{o&&(this.tokenChangeListeners.delete(s),r(o))};this.tokenChangeListeners.add(s),this.isInvisible&&t.execute(e)})})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Le(!this.parameters.sitekey,this.auth,"argument-error"),Le(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Le(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(i=>i(t)),typeof e=="function")e(t);else if(typeof e=="string"){let i=Rn()[e];typeof i=="function"&&i(t)}}}assertNotDestroyed(){Le(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){return U(this,null,function*(){if(yield this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){let t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId})}init(){return U(this,null,function*(){Le(NN()&&!DS(),this.auth,"internal-error"),yield PK(),this.recaptcha=yield this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);let e=yield NW(this.auth);Le(e,this.auth,"internal-error"),this.parameters.sitekey=e})}getAssertedRecaptcha(){return Le(this.recaptcha,this.auth,"internal-error"),this.recaptcha}};function PK(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}var hS=class{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){let t=Py._fromVerification(this.verificationId,e);return this.onConfirmation(t)}};function PS(n,e,t){return U(this,null,function*(){if(Fs(n.app))return Promise.reject(Ha(n));let i=od(n),r=yield RK(i,e,wn(t));return new hS(r,s=>CS(i,s))})}function RK(n,e,t){return U(this,null,function*(){var i;let r=yield t.verify();try{Le(typeof r=="string",n,"argument-error"),Le(t.type===oF,n,"argument-error");let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){let o=s.session;if("phoneNumber"in s)return Le(o.type==="enroll",n,"internal-error"),(yield oK(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:r}})).phoneSessionInfo.sessionInfo;{Le(o.type==="signin",n,"internal-error");let a=((i=s.multiFactorHint)===null||i===void 0?void 0:i.uid)||s.multiFactorUid;return Le(a,n,"missing-multi-factor-info"),(yield IK(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:r}})).phoneResponseInfo.sessionInfo}}else{let{sessionInfo:o}=yield JW(n,{phoneNumber:s.phoneNumber,recaptchaToken:r});return o}}finally{t._reset()}})}function MK(n,e){return e?Bo(e):(Le(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var zf=class extends jf{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Kb(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Kb(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Kb(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function kK(n){return eF(n.auth,new zf(n),n.bypassAuthState)}function LK(n){let{auth:e,user:t}=n;return Le(t,e,"internal-error"),sK(t,new zf(n),n.bypassAuthState)}function OK(n){return U(this,null,function*(){let{auth:e,user:t}=n;return Le(t,e,"internal-error"),rK(t,new zf(n),n.bypassAuthState)})}var fS=class{constructor(e,t,i,r,s=!1){this.auth=e,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>U(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}}))}onAuthEvent(e){return U(this,null,function*(){let{urlResponse:t,sessionId:i,postBody:r,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}let l={auth:this.auth,requestUri:t,sessionId:i,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(a)(l))}catch(u){this.reject(u)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return kK;case"linkViaPopup":case"linkViaRedirect":return OK;case"reauthViaPopup":case"reauthViaRedirect":return LK;default:qa(this.auth,"internal-error")}}resolve(e){Wa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Wa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var mfe=new hc(2e3,1e4);var NK="pendingRedirect",Iy=new Map,pS=class n extends fS{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}execute(){return U(this,null,function*(){let e=Iy.get(this.auth._key());if(!e){try{let i=(yield FK(this.resolver,this.auth))?yield ua(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Iy.set(this.auth._key(),e)}return this.bypassAuthState||Iy.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return U(this,null,function*(){if(e.type==="signInViaRedirect")return ua(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,ua(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return U(this,null,function*(){})}cleanUp(){}};function FK(n,e){return U(this,null,function*(){let t=UK(e),i=BK(n);if(!(yield i._isAvailable()))return!1;let r=(yield i._get(t))==="true";return yield i._remove(t),r})}function VK(n,e){Iy.set(n._key(),e)}function BK(n){return Bo(n._redirectPersistence)}function UK(n){return wy(NK,n.config.apiKey,n.name)}function $K(n,e,t=!1){return U(this,null,function*(){if(Fs(n.app))return Promise.reject(Ha(n));let i=od(n),r=MK(i,e),o=yield new pS(i,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield i._persistUserIfCurrent(o.user),yield i._setRedirectUser(null,e)),o})}var jK=10*60*1e3,mS=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!GK(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!aF(e)){let r=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(Vs(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=jK&&this.cachedEventUids.clear(),this.cachedEventUids.has(CN(e))}saveEventToCache(e){this.cachedEventUids.add(CN(e)),this.lastProcessedEventTime=Date.now()}};function CN(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function aF({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function GK(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return aF(n);default:return!1}}function zK(t){return U(this,arguments,function*(n,e={}){return Bs(n,"GET","/v1/projects",e)})}var HK=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,qK=/^https?/;function WK(n){return U(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield zK(n);for(let t of e)try{if(KK(t))return}catch{}qa(n,"unauthorized-domain")})}function KK(n){let e=Zb(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){let o=new URL(n);return o.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===i}if(!qK.test(t))return!1;if(HK.test(n))return i===n;let r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}var YK=new hc(3e4,6e4);function xN(){let n=Rn().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function QK(n){return new Promise((e,t)=>{var i,r,s;function o(){xN(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{xN(),t(Vs(n,"network-request-failed"))},timeout:YK.get()})}if(!((r=(i=Rn().gapi)===null||i===void 0?void 0:i.iframes)===null||r===void 0)&&r.Iframe)e(gapi.iframes.getContext());else if(!((s=Rn().gapi)===null||s===void 0)&&s.load)o();else{let a=ZN("iframefcb");return Rn()[a]=()=>{gapi.load?o():t(Vs(n,"network-request-failed"))},QN(`${YW()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw by=null,e})}var by=null;function ZK(n){return by=by||QK(n),by}var XK=new hc(5e3,15e3),JK="__/auth/iframe",eY="emulator/auth/iframe",tY={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},nY=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function iY(n){let e=n.config;Le(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?_S(e,eY):`https://${n.config.authDomain}/${JK}`,i={apiKey:e.apiKey,appName:n.name,v:Ga},r=nY.get(n.config.apiHost);r&&(i.eid=r);let s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${t}?${ed(i).slice(1)}`}function rY(n){return U(this,null,function*(){let e=yield ZK(n),t=Rn().gapi;return Le(t,n,"internal-error"),e.open({where:document.body,url:iY(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:tY,dontclear:!0},i=>new Promise((r,s)=>U(this,null,function*(){yield i.restyle({setHideOnLeave:!1});let o=Vs(n,"network-request-failed"),a=Rn().setTimeout(()=>{s(o)},XK.get());function l(){Rn().clearTimeout(a),r(i)}i.ping(l).then(l,()=>{s(o)})})))})}var sY={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},oY=500,aY=600,lY="_blank",cY="http://localhost",Oy=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function uY(n,e,t,i=oY,r=aY){let s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString(),a="",l=Object.assign(Object.assign({},sY),{width:i.toString(),height:r.toString(),top:s,left:o}),u=Yn().toLowerCase();t&&(a=GN(u)?lY:t),$N(u)&&(e=e||cY,l.scrollbars="yes");let d=Object.entries(l).reduce((m,[y,v])=>`${m}${y}=${v},`,"");if(GW(u)&&a!=="_self")return dY(e||"",a),new Oy(null);let f=window.open(e||"",a,d);Le(f,n,"popup-blocked");try{f.focus()}catch{}return new Oy(f)}function dY(n,e){let t=document.createElement("a");t.href=n,t.target=e;let i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}var hY="__/auth/handler",fY="emulator/auth/handler",pY=encodeURIComponent("fac");function AN(n,e,t,i,r,s){return U(this,null,function*(){Le(n.config.authDomain,n,"auth-domain-config-required"),Le(n.config.apiKey,n,"invalid-api-key");let o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:Ga,eventId:r};if(e instanceof Ry){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",JO(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[d,f]of Object.entries(s||{}))o[d]=f}if(e instanceof rS){let d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);let a=o;for(let d of Object.keys(a))a[d]===void 0&&delete a[d];let l=yield n._getAppCheckToken(),u=l?`#${pY}=${encodeURIComponent(l)}`:"";return`${mY(n)}?${ed(a).slice(1)}${u}`})}function mY({config:n}){return n.emulator?_S(n,fY):`https://${n.authDomain}/${hY}`}var Qb="webStorageSupport",gS=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=AS,this._completeRedirectFn=$K,this._overrideRedirectResult=VK}_openPopup(e,t,i,r){return U(this,null,function*(){var s;Wa((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let o=yield AN(e,t,i,Zb(),r);return uY(e,o,nF())})}_openRedirect(e,t,i,r){return U(this,null,function*(){yield this._originValidation(e);let s=yield AN(e,t,i,Zb(),r);return fK(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:r,promise:s}=this.eventManagers[t];return r?Promise.resolve(r):(Wa(s,"If manager is not set, promise should be"),s)}let i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}initAndGetManager(e){return U(this,null,function*(){let t=yield rY(e),i=new mS(e);return t.register("authEvent",r=>(Le(r?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Qb,{type:Qb},r=>{var s;let o=(s=r?.[0])===null||s===void 0?void 0:s[Qb];o!==void 0&&t(!!o),qa(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=WK(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return KN()||jN()||IS()}},lF=gS;var DN="@firebase/auth",PN="1.7.9";var yS=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return U(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Le(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function gY(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function yY(n){ja(new Rr("auth",(e,{options:t})=>{let i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;Le(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});let l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:YN(n)},u=new iS(i,r,s,l);return QW(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),ja(new Rr("auth-internal",e=>{let t=od(e.getProvider("auth").getImmediate());return(i=>new yS(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Un(DN,PN,gY(n)),Un(DN,PN,"esm2017")}var vY=5*60,_Y=Ab("authIdTokenMaxAge")||vY,RN=null,EY=n=>e=>U(void 0,null,function*(){let t=e&&(yield e.getIdTokenResult()),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>_Y)return;let r=t?.token;RN!==r&&(RN=r,yield fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});function RS(n=td()){let e=Of(n,"auth");if(e.isInitialized())return e.getImmediate();let t=bS(n,{popupRedirectResolver:lF,persistence:[sF,tF,AS]}),i=Ab("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(i,location.origin);if(location.origin===s.origin){let o=EY(s.toString());xS(t,o,()=>o(t.currentUser)),Vy(t,a=>o(a))}}let r=Cb("auth");return r&&SS(t,`http://${r}`),t}function TY(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}WW({loadJS(n){return new Promise((e,t)=>{let i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=r=>{let s=Vs("internal-error");s.customData=r,t(s)},i.type="text/javascript",i.charset="UTF-8",TY().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});yY("Browser");function uF(n){return new nt(function(e){var t=Hf(n,e.next.bind(e),e.error.bind(e),e.complete.bind(e));return{unsubscribe:t}})}var dF="auth",Kt=class{constructor(e){return e}},qf=class{constructor(){return Nf(dF)}};var MS=new Pe("angularfire2.auth-instances");function dQ(n,e){let t=vy(dF,n,e);return t&&new Kt(t)}function hQ(n){return(e,t)=>{let i=e.runOutsideAngular(()=>n(t));return new Kt(i)}}var fQ={provide:qf,deps:[[new ci,MS]]},pQ={provide:Kt,useFactory:dQ,deps:[[new ci,MS],Fo]};function hF(n,...e){return Un("angularfire",uc.full,"auth"),Yr([pQ,fQ,{provide:MS,useFactory:hQ(n),multi:!0,deps:[Ct,ii,rd,dc,[new ci,id],...e]}])}var Uy=sn(uF,!0);var fF=sn(RS,!0);var pF=sn(Hf,!0);var mF=sn(PS,!0);var gF=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},yF={};var Ka,kS;(function(){var n;function e(A,x){function R(){}R.prototype=x.prototype,A.D=x.prototype,A.prototype=new R,A.prototype.constructor=A,A.C=function(M,F,j){for(var B=Array(arguments.length-2),pe=2;pe<arguments.length;pe++)B[pe-2]=arguments[pe];return x.prototype[F].apply(M,B)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(A,x,R){R||(R=0);var M=Array(16);if(typeof x=="string")for(var F=0;16>F;++F)M[F]=x.charCodeAt(R++)|x.charCodeAt(R++)<<8|x.charCodeAt(R++)<<16|x.charCodeAt(R++)<<24;else for(F=0;16>F;++F)M[F]=x[R++]|x[R++]<<8|x[R++]<<16|x[R++]<<24;x=A.g[0],R=A.g[1],F=A.g[2];var j=A.g[3],B=x+(j^R&(F^j))+M[0]+3614090360&4294967295;x=R+(B<<7&4294967295|B>>>25),B=j+(F^x&(R^F))+M[1]+3905402710&4294967295,j=x+(B<<12&4294967295|B>>>20),B=F+(R^j&(x^R))+M[2]+606105819&4294967295,F=j+(B<<17&4294967295|B>>>15),B=R+(x^F&(j^x))+M[3]+3250441966&4294967295,R=F+(B<<22&4294967295|B>>>10),B=x+(j^R&(F^j))+M[4]+4118548399&4294967295,x=R+(B<<7&4294967295|B>>>25),B=j+(F^x&(R^F))+M[5]+1200080426&4294967295,j=x+(B<<12&4294967295|B>>>20),B=F+(R^j&(x^R))+M[6]+2821735955&4294967295,F=j+(B<<17&4294967295|B>>>15),B=R+(x^F&(j^x))+M[7]+4249261313&4294967295,R=F+(B<<22&4294967295|B>>>10),B=x+(j^R&(F^j))+M[8]+1770035416&4294967295,x=R+(B<<7&4294967295|B>>>25),B=j+(F^x&(R^F))+M[9]+2336552879&4294967295,j=x+(B<<12&4294967295|B>>>20),B=F+(R^j&(x^R))+M[10]+4294925233&4294967295,F=j+(B<<17&4294967295|B>>>15),B=R+(x^F&(j^x))+M[11]+2304563134&4294967295,R=F+(B<<22&4294967295|B>>>10),B=x+(j^R&(F^j))+M[12]+1804603682&4294967295,x=R+(B<<7&4294967295|B>>>25),B=j+(F^x&(R^F))+M[13]+4254626195&4294967295,j=x+(B<<12&4294967295|B>>>20),B=F+(R^j&(x^R))+M[14]+2792965006&4294967295,F=j+(B<<17&4294967295|B>>>15),B=R+(x^F&(j^x))+M[15]+1236535329&4294967295,R=F+(B<<22&4294967295|B>>>10),B=x+(F^j&(R^F))+M[1]+4129170786&4294967295,x=R+(B<<5&4294967295|B>>>27),B=j+(R^F&(x^R))+M[6]+3225465664&4294967295,j=x+(B<<9&4294967295|B>>>23),B=F+(x^R&(j^x))+M[11]+643717713&4294967295,F=j+(B<<14&4294967295|B>>>18),B=R+(j^x&(F^j))+M[0]+3921069994&4294967295,R=F+(B<<20&4294967295|B>>>12),B=x+(F^j&(R^F))+M[5]+3593408605&4294967295,x=R+(B<<5&4294967295|B>>>27),B=j+(R^F&(x^R))+M[10]+38016083&4294967295,j=x+(B<<9&4294967295|B>>>23),B=F+(x^R&(j^x))+M[15]+3634488961&4294967295,F=j+(B<<14&4294967295|B>>>18),B=R+(j^x&(F^j))+M[4]+3889429448&4294967295,R=F+(B<<20&4294967295|B>>>12),B=x+(F^j&(R^F))+M[9]+568446438&4294967295,x=R+(B<<5&4294967295|B>>>27),B=j+(R^F&(x^R))+M[14]+3275163606&4294967295,j=x+(B<<9&4294967295|B>>>23),B=F+(x^R&(j^x))+M[3]+4107603335&4294967295,F=j+(B<<14&4294967295|B>>>18),B=R+(j^x&(F^j))+M[8]+1163531501&4294967295,R=F+(B<<20&4294967295|B>>>12),B=x+(F^j&(R^F))+M[13]+2850285829&4294967295,x=R+(B<<5&4294967295|B>>>27),B=j+(R^F&(x^R))+M[2]+4243563512&4294967295,j=x+(B<<9&4294967295|B>>>23),B=F+(x^R&(j^x))+M[7]+1735328473&4294967295,F=j+(B<<14&4294967295|B>>>18),B=R+(j^x&(F^j))+M[12]+2368359562&4294967295,R=F+(B<<20&4294967295|B>>>12),B=x+(R^F^j)+M[5]+4294588738&4294967295,x=R+(B<<4&4294967295|B>>>28),B=j+(x^R^F)+M[8]+2272392833&4294967295,j=x+(B<<11&4294967295|B>>>21),B=F+(j^x^R)+M[11]+1839030562&4294967295,F=j+(B<<16&4294967295|B>>>16),B=R+(F^j^x)+M[14]+4259657740&4294967295,R=F+(B<<23&4294967295|B>>>9),B=x+(R^F^j)+M[1]+2763975236&4294967295,x=R+(B<<4&4294967295|B>>>28),B=j+(x^R^F)+M[4]+1272893353&4294967295,j=x+(B<<11&4294967295|B>>>21),B=F+(j^x^R)+M[7]+4139469664&4294967295,F=j+(B<<16&4294967295|B>>>16),B=R+(F^j^x)+M[10]+3200236656&4294967295,R=F+(B<<23&4294967295|B>>>9),B=x+(R^F^j)+M[13]+681279174&4294967295,x=R+(B<<4&4294967295|B>>>28),B=j+(x^R^F)+M[0]+3936430074&4294967295,j=x+(B<<11&4294967295|B>>>21),B=F+(j^x^R)+M[3]+3572445317&4294967295,F=j+(B<<16&4294967295|B>>>16),B=R+(F^j^x)+M[6]+76029189&4294967295,R=F+(B<<23&4294967295|B>>>9),B=x+(R^F^j)+M[9]+3654602809&4294967295,x=R+(B<<4&4294967295|B>>>28),B=j+(x^R^F)+M[12]+3873151461&4294967295,j=x+(B<<11&4294967295|B>>>21),B=F+(j^x^R)+M[15]+530742520&4294967295,F=j+(B<<16&4294967295|B>>>16),B=R+(F^j^x)+M[2]+3299628645&4294967295,R=F+(B<<23&4294967295|B>>>9),B=x+(F^(R|~j))+M[0]+4096336452&4294967295,x=R+(B<<6&4294967295|B>>>26),B=j+(R^(x|~F))+M[7]+1126891415&4294967295,j=x+(B<<10&4294967295|B>>>22),B=F+(x^(j|~R))+M[14]+2878612391&4294967295,F=j+(B<<15&4294967295|B>>>17),B=R+(j^(F|~x))+M[5]+4237533241&4294967295,R=F+(B<<21&4294967295|B>>>11),B=x+(F^(R|~j))+M[12]+1700485571&4294967295,x=R+(B<<6&4294967295|B>>>26),B=j+(R^(x|~F))+M[3]+2399980690&4294967295,j=x+(B<<10&4294967295|B>>>22),B=F+(x^(j|~R))+M[10]+4293915773&4294967295,F=j+(B<<15&4294967295|B>>>17),B=R+(j^(F|~x))+M[1]+2240044497&4294967295,R=F+(B<<21&4294967295|B>>>11),B=x+(F^(R|~j))+M[8]+1873313359&4294967295,x=R+(B<<6&4294967295|B>>>26),B=j+(R^(x|~F))+M[15]+4264355552&4294967295,j=x+(B<<10&4294967295|B>>>22),B=F+(x^(j|~R))+M[6]+2734768916&4294967295,F=j+(B<<15&4294967295|B>>>17),B=R+(j^(F|~x))+M[13]+1309151649&4294967295,R=F+(B<<21&4294967295|B>>>11),B=x+(F^(R|~j))+M[4]+4149444226&4294967295,x=R+(B<<6&4294967295|B>>>26),B=j+(R^(x|~F))+M[11]+3174756917&4294967295,j=x+(B<<10&4294967295|B>>>22),B=F+(x^(j|~R))+M[2]+718787259&4294967295,F=j+(B<<15&4294967295|B>>>17),B=R+(j^(F|~x))+M[9]+3951481745&4294967295,A.g[0]=A.g[0]+x&4294967295,A.g[1]=A.g[1]+(F+(B<<21&4294967295|B>>>11))&4294967295,A.g[2]=A.g[2]+F&4294967295,A.g[3]=A.g[3]+j&4294967295}i.prototype.u=function(A,x){x===void 0&&(x=A.length);for(var R=x-this.blockSize,M=this.B,F=this.h,j=0;j<x;){if(F==0)for(;j<=R;)r(this,A,j),j+=this.blockSize;if(typeof A=="string"){for(;j<x;)if(M[F++]=A.charCodeAt(j++),F==this.blockSize){r(this,M),F=0;break}}else for(;j<x;)if(M[F++]=A[j++],F==this.blockSize){r(this,M),F=0;break}}this.h=F,this.o+=x},i.prototype.v=function(){var A=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);A[0]=128;for(var x=1;x<A.length-8;++x)A[x]=0;var R=8*this.o;for(x=A.length-8;x<A.length;++x)A[x]=R&255,R/=256;for(this.u(A),A=Array(16),x=R=0;4>x;++x)for(var M=0;32>M;M+=8)A[R++]=this.g[x]>>>M&255;return A};function s(A,x){var R=a;return Object.prototype.hasOwnProperty.call(R,A)?R[A]:R[A]=x(A)}function o(A,x){this.h=x;for(var R=[],M=!0,F=A.length-1;0<=F;F--){var j=A[F]|0;M&&j==x||(R[F]=j,M=!1)}this.g=R}var a={};function l(A){return-128<=A&&128>A?s(A,function(x){return new o([x|0],0>x?-1:0)}):new o([A|0],0>A?-1:0)}function u(A){if(isNaN(A)||!isFinite(A))return f;if(0>A)return T(u(-A));for(var x=[],R=1,M=0;A>=R;M++)x[M]=A/R|0,R*=4294967296;return new o(x,0)}function d(A,x){if(A.length==0)throw Error("number format error: empty string");if(x=x||10,2>x||36<x)throw Error("radix out of range: "+x);if(A.charAt(0)=="-")return T(d(A.substring(1),x));if(0<=A.indexOf("-"))throw Error('number format error: interior "-" character');for(var R=u(Math.pow(x,8)),M=f,F=0;F<A.length;F+=8){var j=Math.min(8,A.length-F),B=parseInt(A.substring(F,F+j),x);8>j?(j=u(Math.pow(x,j)),M=M.j(j).add(u(B))):(M=M.j(R),M=M.add(u(B)))}return M}var f=l(0),m=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(E(this))return-T(this).m();for(var A=0,x=1,R=0;R<this.g.length;R++){var M=this.i(R);A+=(0<=M?M:4294967296+M)*x,x*=4294967296}return A},n.toString=function(A){if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(v(this))return"0";if(E(this))return"-"+T(this).toString(A);for(var x=u(Math.pow(A,6)),R=this,M="";;){var F=V(R,x).g;R=C(R,F.j(x));var j=((0<R.g.length?R.g[0]:R.h)>>>0).toString(A);if(R=F,v(R))return j+M;for(;6>j.length;)j="0"+j;M=j+M}},n.i=function(A){return 0>A?0:A<this.g.length?this.g[A]:this.h};function v(A){if(A.h!=0)return!1;for(var x=0;x<A.g.length;x++)if(A.g[x]!=0)return!1;return!0}function E(A){return A.h==-1}n.l=function(A){return A=C(this,A),E(A)?-1:v(A)?0:1};function T(A){for(var x=A.g.length,R=[],M=0;M<x;M++)R[M]=~A.g[M];return new o(R,~A.h).add(m)}n.abs=function(){return E(this)?T(this):this},n.add=function(A){for(var x=Math.max(this.g.length,A.g.length),R=[],M=0,F=0;F<=x;F++){var j=M+(this.i(F)&65535)+(A.i(F)&65535),B=(j>>>16)+(this.i(F)>>>16)+(A.i(F)>>>16);M=B>>>16,j&=65535,B&=65535,R[F]=B<<16|j}return new o(R,R[R.length-1]&-2147483648?-1:0)};function C(A,x){return A.add(T(x))}n.j=function(A){if(v(this)||v(A))return f;if(E(this))return E(A)?T(this).j(T(A)):T(T(this).j(A));if(E(A))return T(this.j(T(A)));if(0>this.l(y)&&0>A.l(y))return u(this.m()*A.m());for(var x=this.g.length+A.g.length,R=[],M=0;M<2*x;M++)R[M]=0;for(M=0;M<this.g.length;M++)for(var F=0;F<A.g.length;F++){var j=this.i(M)>>>16,B=this.i(M)&65535,pe=A.i(F)>>>16,Ee=A.i(F)&65535;R[2*M+2*F]+=B*Ee,D(R,2*M+2*F),R[2*M+2*F+1]+=j*Ee,D(R,2*M+2*F+1),R[2*M+2*F+1]+=B*pe,D(R,2*M+2*F+1),R[2*M+2*F+2]+=j*pe,D(R,2*M+2*F+2)}for(M=0;M<x;M++)R[M]=R[2*M+1]<<16|R[2*M];for(M=x;M<2*x;M++)R[M]=0;return new o(R,0)};function D(A,x){for(;(A[x]&65535)!=A[x];)A[x+1]+=A[x]>>>16,A[x]&=65535,x++}function P(A,x){this.g=A,this.h=x}function V(A,x){if(v(x))throw Error("division by zero");if(v(A))return new P(f,f);if(E(A))return x=V(T(A),x),new P(T(x.g),T(x.h));if(E(x))return x=V(A,T(x)),new P(T(x.g),x.h);if(30<A.g.length){if(E(A)||E(x))throw Error("slowDivide_ only works with positive integers.");for(var R=m,M=x;0>=M.l(A);)R=G(R),M=G(M);var F=H(R,1),j=H(M,1);for(M=H(M,2),R=H(R,2);!v(M);){var B=j.add(M);0>=B.l(A)&&(F=F.add(R),j=B),M=H(M,1),R=H(R,1)}return x=C(A,F.j(x)),new P(F,x)}for(F=f;0<=A.l(x);){for(R=Math.max(1,Math.floor(A.m()/x.m())),M=Math.ceil(Math.log(R)/Math.LN2),M=48>=M?1:Math.pow(2,M-48),j=u(R),B=j.j(x);E(B)||0<B.l(A);)R-=M,j=u(R),B=j.j(x);v(j)&&(j=m),F=F.add(j),A=C(A,B)}return new P(F,A)}n.A=function(A){return V(this,A).h},n.and=function(A){for(var x=Math.max(this.g.length,A.g.length),R=[],M=0;M<x;M++)R[M]=this.i(M)&A.i(M);return new o(R,this.h&A.h)},n.or=function(A){for(var x=Math.max(this.g.length,A.g.length),R=[],M=0;M<x;M++)R[M]=this.i(M)|A.i(M);return new o(R,this.h|A.h)},n.xor=function(A){for(var x=Math.max(this.g.length,A.g.length),R=[],M=0;M<x;M++)R[M]=this.i(M)^A.i(M);return new o(R,this.h^A.h)};function G(A){for(var x=A.g.length+1,R=[],M=0;M<x;M++)R[M]=A.i(M)<<1|A.i(M-1)>>>31;return new o(R,A.h)}function H(A,x){var R=x>>5;x%=32;for(var M=A.g.length-R,F=[],j=0;j<M;j++)F[j]=0<x?A.i(j+R)>>>x|A.i(j+R+1)<<32-x:A.i(j+R);return new o(F,A.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,kS=yF.Md5=i,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,Ka=yF.Integer=o}).apply(typeof gF<"u"?gF:typeof self<"u"?self:typeof window<"u"?window:{});var $y=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},jo={};var LS,mQ,ad,OS,Wf,jy,NS,FS,VS;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(p,w,S){return p==Array.prototype||p==Object.prototype||(p[w]=S.value),p};function t(p){p=[typeof globalThis=="object"&&globalThis,p,typeof window=="object"&&window,typeof self=="object"&&self,typeof $y=="object"&&$y];for(var w=0;w<p.length;++w){var S=p[w];if(S&&S.Math==Math)return S}throw Error("Cannot find global object")}var i=t(this);function r(p,w){if(w)e:{var S=i;p=p.split(".");for(var O=0;O<p.length-1;O++){var Y=p[O];if(!(Y in S))break e;S=S[Y]}p=p[p.length-1],O=S[p],w=w(O),w!=O&&w!=null&&e(S,p,{configurable:!0,writable:!0,value:w})}}function s(p,w){p instanceof String&&(p+="");var S=0,O=!1,Y={next:function(){if(!O&&S<p.length){var ee=S++;return{value:w(ee,p[ee]),done:!1}}return O=!0,{done:!0,value:void 0}}};return Y[Symbol.iterator]=function(){return Y},Y}r("Array.prototype.values",function(p){return p||function(){return s(this,function(w,S){return S})}});var o=o||{},a=this||self;function l(p){var w=typeof p;return w=w!="object"?w:p?Array.isArray(p)?"array":w:"null",w=="array"||w=="object"&&typeof p.length=="number"}function u(p){var w=typeof p;return w=="object"&&p!=null||w=="function"}function d(p,w,S){return p.call.apply(p.bind,arguments)}function f(p,w,S){if(!p)throw Error();if(2<arguments.length){var O=Array.prototype.slice.call(arguments,2);return function(){var Y=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Y,O),p.apply(w,Y)}}return function(){return p.apply(w,arguments)}}function m(p,w,S){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,m.apply(null,arguments)}function y(p,w){var S=Array.prototype.slice.call(arguments,1);return function(){var O=S.slice();return O.push.apply(O,arguments),p.apply(this,O)}}function v(p,w){function S(){}S.prototype=w.prototype,p.aa=w.prototype,p.prototype=new S,p.prototype.constructor=p,p.Qb=function(O,Y,ee){for(var _e=Array(arguments.length-2),ut=2;ut<arguments.length;ut++)_e[ut-2]=arguments[ut];return w.prototype[Y].apply(O,_e)}}function E(p){let w=p.length;if(0<w){let S=Array(w);for(let O=0;O<w;O++)S[O]=p[O];return S}return[]}function T(p,w){for(let S=1;S<arguments.length;S++){let O=arguments[S];if(l(O)){let Y=p.length||0,ee=O.length||0;p.length=Y+ee;for(let _e=0;_e<ee;_e++)p[Y+_e]=O[_e]}else p.push(O)}}class C{constructor(w,S){this.i=w,this.j=S,this.h=0,this.g=null}get(){let w;return 0<this.h?(this.h--,w=this.g,this.g=w.next,w.next=null):w=this.i(),w}}function D(p){return/^[\s\xa0]*$/.test(p)}function P(){var p=a.navigator;return p&&(p=p.userAgent)?p:""}function V(p){return V[" "](p),p}V[" "]=function(){};var G=P().indexOf("Gecko")!=-1&&!(P().toLowerCase().indexOf("webkit")!=-1&&P().indexOf("Edge")==-1)&&!(P().indexOf("Trident")!=-1||P().indexOf("MSIE")!=-1)&&P().indexOf("Edge")==-1;function H(p,w,S){for(let O in p)w.call(S,p[O],O,p)}function A(p,w){for(let S in p)w.call(void 0,p[S],S,p)}function x(p){let w={};for(let S in p)w[S]=p[S];return w}let R="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function M(p,w){let S,O;for(let Y=1;Y<arguments.length;Y++){O=arguments[Y];for(S in O)p[S]=O[S];for(let ee=0;ee<R.length;ee++)S=R[ee],Object.prototype.hasOwnProperty.call(O,S)&&(p[S]=O[S])}}function F(p){var w=1;p=p.split(":");let S=[];for(;0<w&&p.length;)S.push(p.shift()),w--;return p.length&&S.push(p.join(":")),S}function j(p){a.setTimeout(()=>{throw p},0)}function B(){var p=ne;let w=null;return p.g&&(w=p.g,p.g=p.g.next,p.g||(p.h=null),w.next=null),w}class pe{constructor(){this.h=this.g=null}add(w,S){let O=Ee.get();O.set(w,S),this.h?this.h.next=O:this.g=O,this.h=O}}var Ee=new C(()=>new q,p=>p.reset());class q{constructor(){this.next=this.g=this.h=null}set(w,S){this.h=w,this.g=S,this.next=null}reset(){this.next=this.g=this.h=null}}let te,W=!1,ne=new pe,ye=()=>{let p=a.Promise.resolve(void 0);te=()=>{p.then(oe)}};var oe=()=>{for(var p;p=B();){try{p.h.call(p.g)}catch(S){j(S)}var w=Ee;w.j(p),100>w.h&&(w.h++,p.next=w.g,w.g=p)}W=!1};function ie(){this.s=this.s,this.C=this.C}ie.prototype.s=!1,ie.prototype.ma=function(){this.s||(this.s=!0,this.N())},ie.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function de(p,w){this.type=p,this.g=this.target=w,this.defaultPrevented=!1}de.prototype.h=function(){this.defaultPrevented=!0};var he=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var p=!1,w=Object.defineProperty({},"passive",{get:function(){p=!0}});try{let S=()=>{};a.addEventListener("test",S,w),a.removeEventListener("test",S,w)}catch{}return p}();function Ne(p,w){if(de.call(this,p?p.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,p){var S=this.type=p.type,O=p.changedTouches&&p.changedTouches.length?p.changedTouches[0]:null;if(this.target=p.target||p.srcElement,this.g=w,w=p.relatedTarget){if(G){e:{try{V(w.nodeName);var Y=!0;break e}catch{}Y=!1}Y||(w=null)}}else S=="mouseover"?w=p.fromElement:S=="mouseout"&&(w=p.toElement);this.relatedTarget=w,O?(this.clientX=O.clientX!==void 0?O.clientX:O.pageX,this.clientY=O.clientY!==void 0?O.clientY:O.pageY,this.screenX=O.screenX||0,this.screenY=O.screenY||0):(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0),this.button=p.button,this.key=p.key||"",this.ctrlKey=p.ctrlKey,this.altKey=p.altKey,this.shiftKey=p.shiftKey,this.metaKey=p.metaKey,this.pointerId=p.pointerId||0,this.pointerType=typeof p.pointerType=="string"?p.pointerType:je[p.pointerType]||"",this.state=p.state,this.i=p,p.defaultPrevented&&Ne.aa.h.call(this)}}v(Ne,de);var je={2:"touch",3:"pen",4:"mouse"};Ne.prototype.h=function(){Ne.aa.h.call(this);var p=this.i;p.preventDefault?p.preventDefault():p.returnValue=!1};var Je="closure_listenable_"+(1e6*Math.random()|0),Mt=0;function kt(p,w,S,O,Y){this.listener=p,this.proxy=null,this.src=w,this.type=S,this.capture=!!O,this.ha=Y,this.key=++Mt,this.da=this.fa=!1}function Zt(p){p.da=!0,p.listener=null,p.proxy=null,p.src=null,p.ha=null}function bn(p){this.src=p,this.g={},this.h=0}bn.prototype.add=function(p,w,S,O,Y){var ee=p.toString();p=this.g[ee],p||(p=this.g[ee]=[],this.h++);var _e=as(p,w,O,Y);return-1<_e?(w=p[_e],S||(w.fa=!1)):(w=new kt(w,this.src,ee,!!O,Y),w.fa=S,p.push(w)),w};function hl(p,w){var S=w.type;if(S in p.g){var O=p.g[S],Y=Array.prototype.indexOf.call(O,w,void 0),ee;(ee=0<=Y)&&Array.prototype.splice.call(O,Y,1),ee&&(Zt(w),p.g[S].length==0&&(delete p.g[S],p.h--))}}function as(p,w,S,O){for(var Y=0;Y<p.length;++Y){var ee=p[Y];if(!ee.da&&ee.listener==w&&ee.capture==!!S&&ee.ha==O)return Y}return-1}var ls="closure_lm_"+(1e6*Math.random()|0),Xo={};function at(p,w,S,O,Y){if(O&&O.once)return xi(p,w,S,O,Y);if(Array.isArray(w)){for(var ee=0;ee<w.length;ee++)at(p,w[ee],S,O,Y);return null}return S=vr(S),p&&p[Je]?p.K(w,S,u(O)?!!O.capture:!!O,Y):_n(p,w,S,!1,O,Y)}function _n(p,w,S,O,Y,ee){if(!w)throw Error("Invalid event type");var _e=u(Y)?!!Y.capture:!!Y,ut=yr(p);if(ut||(p[ls]=ut=new bn(p)),S=ut.add(w,S,O,_e,ee),S.proxy)return S;if(O=Jn(),S.proxy=O,O.src=p,O.listener=S,p.addEventListener)he||(Y=_e),Y===void 0&&(Y=!1),p.addEventListener(w.toString(),O,Y);else if(p.attachEvent)p.attachEvent(gr(w.toString()),O);else if(p.addListener&&p.removeListener)p.addListener(O);else throw Error("addEventListener and attachEvent are unavailable.");return S}function Jn(){function p(S){return w.call(p.src,p.listener,S)}let w=jc;return p}function xi(p,w,S,O,Y){if(Array.isArray(w)){for(var ee=0;ee<w.length;ee++)xi(p,w[ee],S,O,Y);return null}return S=vr(S),p&&p[Je]?p.L(w,S,u(O)?!!O.capture:!!O,Y):_n(p,w,S,!0,O,Y)}function ei(p,w,S,O,Y){if(Array.isArray(w))for(var ee=0;ee<w.length;ee++)ei(p,w[ee],S,O,Y);else O=u(O)?!!O.capture:!!O,S=vr(S),p&&p[Je]?(p=p.i,w=String(w).toString(),w in p.g&&(ee=p.g[w],S=as(ee,S,O,Y),-1<S&&(Zt(ee[S]),Array.prototype.splice.call(ee,S,1),ee.length==0&&(delete p.g[w],p.h--)))):p&&(p=yr(p))&&(w=p.g[w.toString()],p=-1,w&&(p=as(w,S,O,Y)),(S=-1<p?w[p]:null)&&Gi(S))}function Gi(p){if(typeof p!="number"&&p&&!p.da){var w=p.src;if(w&&w[Je])hl(w.i,p);else{var S=p.type,O=p.proxy;w.removeEventListener?w.removeEventListener(S,O,p.capture):w.detachEvent?w.detachEvent(gr(S),O):w.addListener&&w.removeListener&&w.removeListener(O),(S=yr(w))?(hl(S,p),S.h==0&&(S.src=null,w[ls]=null)):Zt(p)}}}function gr(p){return p in Xo?Xo[p]:Xo[p]="on"+p}function jc(p,w){if(p.da)p=!0;else{w=new Ne(w,this);var S=p.listener,O=p.ha||p.src;p.fa&&Gi(p),p=S.call(O,w)}return p}function yr(p){return p=p[ls],p instanceof bn?p:null}var eo="__closure_events_fn_"+(1e9*Math.random()>>>0);function vr(p){return typeof p=="function"?p:(p[eo]||(p[eo]=function(w){return p.handleEvent(w)}),p[eo])}function En(){ie.call(this),this.i=new bn(this),this.M=this,this.F=null}v(En,ie),En.prototype[Je]=!0,En.prototype.removeEventListener=function(p,w,S,O){ei(this,p,w,S,O)};function Sn(p,w){var S,O=p.F;if(O)for(S=[];O;O=O.F)S.push(O);if(p=p.M,O=w.type||w,typeof w=="string")w=new de(w,p);else if(w instanceof de)w.target=w.target||p;else{var Y=w;w=new de(O,p),M(w,Y)}if(Y=!0,S)for(var ee=S.length-1;0<=ee;ee--){var _e=w.g=S[ee];Y=cs(_e,O,!0,w)&&Y}if(_e=w.g=p,Y=cs(_e,O,!0,w)&&Y,Y=cs(_e,O,!1,w)&&Y,S)for(ee=0;ee<S.length;ee++)_e=w.g=S[ee],Y=cs(_e,O,!1,w)&&Y}En.prototype.N=function(){if(En.aa.N.call(this),this.i){var p=this.i,w;for(w in p.g){for(var S=p.g[w],O=0;O<S.length;O++)Zt(S[O]);delete p.g[w],p.h--}}this.F=null},En.prototype.K=function(p,w,S,O){return this.i.add(String(p),w,!1,S,O)},En.prototype.L=function(p,w,S,O){return this.i.add(String(p),w,!0,S,O)};function cs(p,w,S,O){if(w=p.i.g[String(w)],!w)return!0;w=w.concat();for(var Y=!0,ee=0;ee<w.length;++ee){var _e=w[ee];if(_e&&!_e.da&&_e.capture==S){var ut=_e.listener,an=_e.ha||_e.src;_e.fa&&hl(p.i,_e),Y=ut.call(an,O)!==!1&&Y}}return Y&&!O.defaultPrevented}function fl(p,w,S){if(typeof p=="function")S&&(p=m(p,S));else if(p&&typeof p.handleEvent=="function")p=m(p.handleEvent,p);else throw Error("Invalid listener argument");return 2147483647<Number(w)?-1:a.setTimeout(p,w||0)}function Vr(p){p.g=fl(()=>{p.g=null,p.i&&(p.i=!1,Vr(p))},p.l);let w=p.h;p.h=null,p.m.apply(null,w)}class Zd extends ie{constructor(w,S){super(),this.m=w,this.l=S,this.h=null,this.i=!1,this.g=null}j(w){this.h=arguments,this.g?this.i=!0:Vr(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Jo(p){ie.call(this),this.h=p,this.g={}}v(Jo,ie);var Zp=[];function ea(p){H(p.g,function(w,S){this.g.hasOwnProperty(S)&&Gi(w)},p),p.g={}}Jo.prototype.N=function(){Jo.aa.N.call(this),ea(this)},Jo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Xd=a.JSON.stringify,eE=a.JSON.parse,Xp=class{stringify(p){return a.JSON.stringify(p,void 0)}parse(p){return a.JSON.parse(p,void 0)}};function Gc(){}Gc.prototype.h=null;function Jd(p){return p.h||(p.h=p.i())}function Jp(){}var pl={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eh(){de.call(this,"d")}v(eh,de);function th(){de.call(this,"c")}v(th,de);var to={},em=null;function ta(){return em=em||new En}to.La="serverreachability";function tm(p){de.call(this,to.La,p)}v(tm,de);function ml(p){let w=ta();Sn(w,new tm(w))}to.STAT_EVENT="statevent";function nm(p,w){de.call(this,to.STAT_EVENT,p),this.stat=w}v(nm,de);function ti(p){let w=ta();Sn(w,new nm(w,p))}to.Ma="timingevent";function zi(p,w){de.call(this,to.Ma,p),this.size=w}v(zi,de);function Re(p,w){if(typeof p!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){p()},w)}function na(){this.g=!0}na.prototype.xa=function(){this.g=!1};function im(p,w,S,O,Y,ee){p.info(function(){if(p.g)if(ee)for(var _e="",ut=ee.split("&"),an=0;an<ut.length;an++){var wt=ut[an].split("=");if(1<wt.length){var Jt=wt[0];wt=wt[1];var Gn=Jt.split("_");_e=2<=Gn.length&&Gn[1]=="type"?_e+(Jt+"="+wt+"&"):_e+(Jt+"=redacted&")}}else _e=null;else _e=ee;return"XMLHTTP REQ ("+O+") [attempt "+Y+"]: "+w+`
`+S+`
`+_e})}function rm(p,w,S,O,Y,ee,_e){p.info(function(){return"XMLHTTP RESP ("+O+") [ attempt "+Y+"]: "+w+`
`+S+`
`+ee+" "+_e})}function no(p,w,S,O){p.info(function(){return"XMLHTTP TEXT ("+w+"): "+sm(p,S)+(O?" "+O:"")})}function nh(p,w){p.info(function(){return"TIMEOUT: "+w})}na.prototype.info=function(){};function sm(p,w){if(!p.g)return w;if(!w)return null;try{var S=JSON.parse(w);if(S){for(p=0;p<S.length;p++)if(Array.isArray(S[p])){var O=S[p];if(!(2>O.length)){var Y=O[1];if(Array.isArray(Y)&&!(1>Y.length)){var ee=Y[0];if(ee!="noop"&&ee!="stop"&&ee!="close")for(var _e=1;_e<Y.length;_e++)Y[_e]=""}}}}return Xd(S)}catch{return w}}var Br={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ih={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},rh;function zc(){}v(zc,Gc),zc.prototype.g=function(){return new XMLHttpRequest},zc.prototype.i=function(){return{}},rh=new zc;function us(p,w,S,O){this.j=p,this.i=w,this.l=S,this.R=O||1,this.U=new Jo(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new om}function om(){this.i=null,this.g="",this.h=!1}var sh={},oh={};function ia(p,w,S){p.L=1,p.v=sa(ni(w)),p.m=S,p.P=!0,am(p,null)}function am(p,w){p.F=Date.now(),Hc(p),p.A=ni(p.v);var S=p.A,O=p.R;Array.isArray(O)||(O=[String(O)]),Bt(S.i,"t",O),p.C=0,S=p.j.J,p.h=new om,p.g=xl(p.j,S?w:null,!p.m),0<p.O&&(p.M=new Zd(m(p.Y,p,p.g),p.O)),w=p.U,S=p.g,O=p.ca;var Y="readystatechange";Array.isArray(Y)||(Y&&(Zp[0]=Y.toString()),Y=Zp);for(var ee=0;ee<Y.length;ee++){var _e=at(S,Y[ee],O||w.handleEvent,!1,w.h||w);if(!_e)break;w.g[_e.key]=_e}w=p.H?x(p.H):{},p.m?(p.u||(p.u="POST"),w["Content-Type"]="application/x-www-form-urlencoded",p.g.ea(p.A,p.u,p.m,w)):(p.u="GET",p.g.ea(p.A,p.u,null,w)),ml(),im(p.i,p.u,p.A,p.l,p.R,p.m)}us.prototype.ca=function(p){p=p.target;let w=this.M;w&&qi(p)==3?w.j():this.Y(p)},us.prototype.Y=function(p){try{if(p==this.g)e:{let Gn=qi(this.g);var w=this.g.Ba();let Ki=this.g.Z();if(!(3>Gn)&&(Gn!=3||this.g&&(this.h.h||this.g.oa()||pm(this.g)))){this.J||Gn!=4||w==7||(w==8||0>=Ki?ml(3):ml(2)),gl(this);var S=this.g.Z();this.X=S;t:if(lm(this)){var O=pm(this.g);p="";var Y=O.length,ee=qi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ds(this),Ur(this);var _e="";break t}this.h.i=new a.TextDecoder}for(w=0;w<Y;w++)this.h.h=!0,p+=this.h.i.decode(O[w],{stream:!(ee&&w==Y-1)});O.length=0,this.h.g+=p,this.C=0,_e=this.h.g}else _e=this.g.oa();if(this.o=S==200,rm(this.i,this.u,this.A,this.l,this.R,Gn,S),this.o){if(this.T&&!this.K){t:{if(this.g){var ut,an=this.g;if((ut=an.g?an.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(ut)){var wt=ut;break t}}wt=null}if(S=wt)no(this.i,this.l,S,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,qc(this,S);else{this.o=!1,this.s=3,ti(12),ds(this),Ur(this);break e}}if(this.P){S=!0;let Yi;for(;!this.J&&this.C<_e.length;)if(Yi=tE(this,_e),Yi==oh){Gn==4&&(this.s=4,ti(14),S=!1),no(this.i,this.l,null,"[Incomplete Response]");break}else if(Yi==sh){this.s=4,ti(15),no(this.i,this.l,_e,"[Invalid Chunk]"),S=!1;break}else no(this.i,this.l,Yi,null),qc(this,Yi);if(lm(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Gn!=4||_e.length!=0||this.h.h||(this.s=1,ti(16),S=!1),this.o=this.o&&S,!S)no(this.i,this.l,_e,"[Invalid Chunked Response]"),ds(this),Ur(this);else if(0<_e.length&&!this.W){this.W=!0;var Jt=this.j;Jt.g==this&&Jt.ba&&!Jt.M&&(Jt.j.info("Great, no buffering proxy detected. Bytes received: "+_e.length),Xc(Jt),Jt.M=!0,ti(11))}}else no(this.i,this.l,_e,null),qc(this,_e);Gn==4&&ds(this),this.o&&!this.J&&(Gn==4?vm(this.j,this):(this.o=!1,Hc(this)))}else mm(this.g),S==400&&0<_e.indexOf("Unknown SID")?(this.s=3,ti(12)):(this.s=0,ti(13)),ds(this),Ur(this)}}}catch{}finally{}};function lm(p){return p.g?p.u=="GET"&&p.L!=2&&p.j.Ca:!1}function tE(p,w){var S=p.C,O=w.indexOf(`
`,S);return O==-1?oh:(S=Number(w.substring(S,O)),isNaN(S)?sh:(O+=1,O+S>w.length?oh:(w=w.slice(O,O+S),p.C=O+S,w)))}us.prototype.cancel=function(){this.J=!0,ds(this)};function Hc(p){p.S=Date.now()+p.I,cm(p,p.I)}function cm(p,w){if(p.B!=null)throw Error("WatchDog timer not null");p.B=Re(m(p.ba,p),w)}function gl(p){p.B&&(a.clearTimeout(p.B),p.B=null)}us.prototype.ba=function(){this.B=null;let p=Date.now();0<=p-this.S?(nh(this.i,this.A),this.L!=2&&(ml(),ti(17)),ds(this),this.s=2,Ur(this)):cm(this,this.S-p)};function Ur(p){p.j.G==0||p.J||vm(p.j,p)}function ds(p){gl(p);var w=p.M;w&&typeof w.ma=="function"&&w.ma(),p.M=null,ea(p.U),p.g&&(w=p.g,p.g=null,w.abort(),w.ma())}function qc(p,w){try{var S=p.j;if(S.G!=0&&(S.g==p||hs(S.h,p))){if(!p.K&&hs(S.h,p)&&S.G==3){try{var O=S.Da.g.parse(w)}catch{O=null}if(Array.isArray(O)&&O.length==3){var Y=O;if(Y[0]==0){e:if(!S.u){if(S.g)if(S.g.F+3e3<p.F)Jc(S),Yc(S);else break e;vh(S),ti(18)}}else S.za=Y[1],0<S.za-S.T&&37500>Y[2]&&S.F&&S.v==0&&!S.C&&(S.C=Re(m(S.Za,S),6e3));if(1>=vl(S.h)&&S.ca){try{S.ca()}catch{}S.ca=void 0}}else oo(S,11)}else if((p.K||S.g==p)&&Jc(S),!D(w))for(Y=S.Da.g.parse(w),w=0;w<Y.length;w++){let wt=Y[w];if(S.T=wt[0],wt=wt[1],S.G==2)if(wt[0]=="c"){S.K=wt[1],S.ia=wt[2];let Jt=wt[3];Jt!=null&&(S.la=Jt,S.j.info("VER="+S.la));let Gn=wt[4];Gn!=null&&(S.Aa=Gn,S.j.info("SVER="+S.Aa));let Ki=wt[5];Ki!=null&&typeof Ki=="number"&&0<Ki&&(O=1.5*Ki,S.L=O,S.j.info("backChannelRequestTimeoutMs_="+O)),O=S;let Yi=p.g;if(Yi){let gs=Yi.g?Yi.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(gs){var ee=O.h;ee.g||gs.indexOf("spdy")==-1&&gs.indexOf("quic")==-1&&gs.indexOf("h2")==-1||(ee.j=ee.l,ee.g=new Set,ee.h&&(fs(ee,ee.h),ee.h=null))}if(O.D){let nu=Yi.g?Yi.g.getResponseHeader("X-HTTP-Session-Id"):null;nu&&(O.ya=nu,Lt(O.I,O.D,nu))}}S.G=3,S.l&&S.l.ua(),S.ba&&(S.R=Date.now()-p.F,S.j.info("Handshake RTT: "+S.R+"ms")),O=S;var _e=p;if(O.qa=Th(O,O.J?O.ia:null,O.W),_e.K){Wc(O.h,_e);var ut=_e,an=O.L;an&&(ut.I=an),ut.B&&(gl(ut),Hc(ut)),O.g=_e}else Zc(O);0<S.i.length&&Qc(S)}else wt[0]!="stop"&&wt[0]!="close"||oo(S,7);else S.G==3&&(wt[0]=="stop"||wt[0]=="close"?wt[0]=="stop"?oo(S,7):Cl(S):wt[0]!="noop"&&S.l&&S.l.ta(wt),S.v=0)}}ml(4)}catch{}}var yl=class{constructor(p,w){this.g=p,this.map=w}};function Et(p){this.l=p||10,a.PerformanceNavigationTiming?(p=a.performance.getEntriesByType("navigation"),p=0<p.length&&(p[0].nextHopProtocol=="hq"||p[0].nextHopProtocol=="h2")):p=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=p?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Xt(p){return p.h?!0:p.g?p.g.size>=p.j:!1}function vl(p){return p.h?1:p.g?p.g.size:0}function hs(p,w){return p.h?p.h==w:p.g?p.g.has(w):!1}function fs(p,w){p.g?p.g.add(w):p.h=w}function Wc(p,w){p.h&&p.h==w?p.h=null:p.g&&p.g.has(w)&&p.g.delete(w)}Et.prototype.cancel=function(){if(this.i=Ze(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let p of this.g.values())p.cancel();this.g.clear()}};function Ze(p){if(p.h!=null)return p.i.concat(p.h.D);if(p.g!=null&&p.g.size!==0){let w=p.i;for(let S of p.g.values())w=w.concat(S.D);return w}return E(p.i)}function un(p){if(p.V&&typeof p.V=="function")return p.V();if(typeof Map<"u"&&p instanceof Map||typeof Set<"u"&&p instanceof Set)return Array.from(p.values());if(typeof p=="string")return p.split("");if(l(p)){for(var w=[],S=p.length,O=0;O<S;O++)w.push(p[O]);return w}w=[],S=0;for(O in p)w[S++]=p[O];return w}function ah(p){if(p.na&&typeof p.na=="function")return p.na();if(!p.V||typeof p.V!="function"){if(typeof Map<"u"&&p instanceof Map)return Array.from(p.keys());if(!(typeof Set<"u"&&p instanceof Set)){if(l(p)||typeof p=="string"){var w=[];p=p.length;for(var S=0;S<p;S++)w.push(S);return w}w=[],S=0;for(let O in p)w[S++]=O;return w}}}function _l(p,w){if(p.forEach&&typeof p.forEach=="function")p.forEach(w,void 0);else if(l(p)||typeof p=="string")Array.prototype.forEach.call(p,w,void 0);else for(var S=ah(p),O=un(p),Y=O.length,ee=0;ee<Y;ee++)w.call(void 0,O[ee],S&&S[ee],p)}var mi=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function nE(p,w){if(p){p=p.split("&");for(var S=0;S<p.length;S++){var O=p[S].indexOf("="),Y=null;if(0<=O){var ee=p[S].substring(0,O);Y=p[S].substring(O+1)}else ee=p[S];w(ee,Y?decodeURIComponent(Y.replace(/\+/g," ")):"")}}}function _r(p){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,p instanceof _r){this.h=p.h,rn(this,p.j),this.o=p.o,this.g=p.g,Er(this,p.s),this.l=p.l;var w=p.i,S=new ro;S.i=w.i,w.g&&(S.g=new Map(w.g),S.h=w.h),ra(this,S),this.m=p.m}else p&&(w=String(p).match(mi))?(this.h=!1,rn(this,w[1]||"",!0),this.o=$r(w[2]||""),this.g=$r(w[3]||"",!0),Er(this,w[4]),this.l=$r(w[5]||"",!0),ra(this,w[6]||"",!0),this.m=$r(w[7]||"")):(this.h=!1,this.i=new ro(null,this.h))}_r.prototype.toString=function(){var p=[],w=this.j;w&&p.push(io(w,El,!0),":");var S=this.g;return(S||w=="file")&&(p.push("//"),(w=this.o)&&p.push(io(w,El,!0),"@"),p.push(encodeURIComponent(String(S)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),S=this.s,S!=null&&p.push(":",String(S))),(S=this.l)&&(this.g&&S.charAt(0)!="/"&&p.push("/"),p.push(io(S,S.charAt(0)=="/"?uh:ch,!0))),(S=this.i.toString())&&p.push("?",S),(S=this.m)&&p.push("#",io(S,um)),p.join("")};function ni(p){return new _r(p)}function rn(p,w,S){p.j=S?$r(w,!0):w,p.j&&(p.j=p.j.replace(/:$/,""))}function Er(p,w){if(w){if(w=Number(w),isNaN(w)||0>w)throw Error("Bad port number "+w);p.s=w}else p.s=null}function ra(p,w,S){w instanceof ro?(p.i=w,dh(p.i,p.h)):(S||(w=io(w,Kc)),p.i=new ro(w,p.h))}function Lt(p,w,S){p.i.set(w,S)}function sa(p){return Lt(p,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),p}function $r(p,w){return p?w?decodeURI(p.replace(/%25/g,"%2525")):decodeURIComponent(p):""}function io(p,w,S){return typeof p=="string"?(p=encodeURI(p).replace(w,lh),S&&(p=p.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p):null}function lh(p){return p=p.charCodeAt(0),"%"+(p>>4&15).toString(16)+(p&15).toString(16)}var El=/[#\/\?@]/g,ch=/[#\?:]/g,uh=/[#\?]/g,Kc=/[#\?@]/g,um=/#/g;function ro(p,w){this.h=this.g=null,this.i=p||null,this.j=!!w}function ps(p){p.g||(p.g=new Map,p.h=0,p.i&&nE(p.i,function(w,S){p.add(decodeURIComponent(w.replace(/\+/g," ")),S)}))}n=ro.prototype,n.add=function(p,w){ps(this),this.i=null,p=so(this,p);var S=this.g.get(p);return S||this.g.set(p,S=[]),S.push(w),this.h+=1,this};function Ke(p,w){ps(p),w=so(p,w),p.g.has(w)&&(p.i=null,p.h-=p.g.get(w).length,p.g.delete(w))}function Hi(p,w){return ps(p),w=so(p,w),p.g.has(w)}n.forEach=function(p,w){ps(this),this.g.forEach(function(S,O){S.forEach(function(Y){p.call(w,Y,O,this)},this)},this)},n.na=function(){ps(this);let p=Array.from(this.g.values()),w=Array.from(this.g.keys()),S=[];for(let O=0;O<w.length;O++){let Y=p[O];for(let ee=0;ee<Y.length;ee++)S.push(w[O])}return S},n.V=function(p){ps(this);let w=[];if(typeof p=="string")Hi(this,p)&&(w=w.concat(this.g.get(so(this,p))));else{p=Array.from(this.g.values());for(let S=0;S<p.length;S++)w=w.concat(p[S])}return w},n.set=function(p,w){return ps(this),this.i=null,p=so(this,p),Hi(this,p)&&(this.h-=this.g.get(p).length),this.g.set(p,[w]),this.h+=1,this},n.get=function(p,w){return p?(p=this.V(p),0<p.length?String(p[0]):w):w};function Bt(p,w,S){Ke(p,w),0<S.length&&(p.i=null,p.g.set(so(p,w),E(S)),p.h+=S.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let p=[],w=Array.from(this.g.keys());for(var S=0;S<w.length;S++){var O=w[S];let ee=encodeURIComponent(String(O)),_e=this.V(O);for(O=0;O<_e.length;O++){var Y=ee;_e[O]!==""&&(Y+="="+encodeURIComponent(String(_e[O]))),p.push(Y)}}return this.i=p.join("&")};function so(p,w){return w=String(w),p.j&&(w=w.toLowerCase()),w}function dh(p,w){w&&!p.j&&(ps(p),p.i=null,p.g.forEach(function(S,O){var Y=O.toLowerCase();O!=Y&&(Ke(this,O),Bt(this,Y,S))},p)),p.j=w}function hh(p,w){let S=new na;if(a.Image){let O=new Image;O.onload=y(ai,S,"TestLoadImage: loaded",!0,w,O),O.onerror=y(ai,S,"TestLoadImage: error",!1,w,O),O.onabort=y(ai,S,"TestLoadImage: abort",!1,w,O),O.ontimeout=y(ai,S,"TestLoadImage: timeout",!1,w,O),a.setTimeout(function(){O.ontimeout&&O.ontimeout()},1e4),O.src=p}else w(!1)}function fh(p,w){let S=new na,O=new AbortController,Y=setTimeout(()=>{O.abort(),ai(S,"TestPingServer: timeout",!1,w)},1e4);fetch(p,{signal:O.signal}).then(ee=>{clearTimeout(Y),ee.ok?ai(S,"TestPingServer: ok",!0,w):ai(S,"TestPingServer: server error",!1,w)}).catch(()=>{clearTimeout(Y),ai(S,"TestPingServer: error",!1,w)})}function ai(p,w,S,O,Y){try{Y&&(Y.onload=null,Y.onerror=null,Y.onabort=null,Y.ontimeout=null),O(S)}catch{}}function ph(){this.g=new Xp}function Tl(p,w,S){let O=S||"";try{_l(p,function(Y,ee){let _e=Y;u(Y)&&(_e=Xd(Y)),w.push(O+ee+"="+encodeURIComponent(_e))})}catch(Y){throw w.push(O+"type="+encodeURIComponent("_badmap")),Y}}function dn(p){this.l=p.Ub||null,this.j=p.eb||!1}v(dn,Gc),dn.prototype.g=function(){return new Tr(this.l,this.j)},dn.prototype.i=function(p){return function(){return p}}({});function Tr(p,w){En.call(this),this.D=p,this.o=w,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}v(Tr,En),n=Tr.prototype,n.open=function(p,w){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=p,this.A=w,this.readyState=1,wl(this)},n.send=function(p){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let w={headers:this.u,method:this.B,credentials:this.m,cache:void 0};p&&(w.body=p),(this.D||a).fetch(new Request(this.A,w)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,oa(this)),this.readyState=0},n.Sa=function(p){if(this.g&&(this.l=p,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=p.headers,this.readyState=2,wl(this)),this.g&&(this.readyState=3,wl(this),this.g)))if(this.responseType==="arraybuffer")p.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in p){if(this.j=p.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;mh(this)}else p.text().then(this.Ra.bind(this),this.ga.bind(this))};function mh(p){p.j.read().then(p.Pa.bind(p)).catch(p.ga.bind(p))}n.Pa=function(p){if(this.g){if(this.o&&p.value)this.response.push(p.value);else if(!this.o){var w=p.value?p.value:new Uint8Array(0);(w=this.v.decode(w,{stream:!p.done}))&&(this.response=this.responseText+=w)}p.done?oa(this):wl(this),this.readyState==3&&mh(this)}},n.Ra=function(p){this.g&&(this.response=this.responseText=p,oa(this))},n.Qa=function(p){this.g&&(this.response=p,oa(this))},n.ga=function(){this.g&&oa(this)};function oa(p){p.readyState=4,p.l=null,p.j=null,p.v=null,wl(p)}n.setRequestHeader=function(p,w){this.u.append(p,w)},n.getResponseHeader=function(p){return this.h&&this.h.get(p.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let p=[],w=this.h.entries();for(var S=w.next();!S.done;)S=S.value,p.push(S[0]+": "+S[1]),S=w.next();return p.join(`\r
`)};function wl(p){p.onreadystatechange&&p.onreadystatechange.call(p)}Object.defineProperty(Tr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(p){this.m=p?"include":"same-origin"}});function gh(p){let w="";return H(p,function(S,O){w+=O,w+=":",w+=S,w+=`\r
`}),w}function Il(p,w,S){e:{for(O in S){var O=!1;break e}O=!0}O||(S=gh(S),typeof p=="string"?S!=null&&encodeURIComponent(String(S)):Lt(p,w,S))}function on(p){En.call(this),this.headers=new Map,this.o=p||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}v(on,En);var dm=/^https?$/i,gt=["POST","PUT"];n=on.prototype,n.Ha=function(p){this.J=p},n.ea=function(p,w,S,O){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+p);w=w?w.toUpperCase():"GET",this.D=p,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():rh.g(),this.v=this.o?Jd(this.o):Jd(rh),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(w,String(p),!0),this.B=!1}catch(ee){hm(this,ee);return}if(p=S||"",S=new Map(this.headers),O)if(Object.getPrototypeOf(O)===Object.prototype)for(var Y in O)S.set(Y,O[Y]);else if(typeof O.keys=="function"&&typeof O.get=="function")for(let ee of O.keys())S.set(ee,O.get(ee));else throw Error("Unknown input type for opt_headers: "+String(O));O=Array.from(S.keys()).find(ee=>ee.toLowerCase()=="content-type"),Y=a.FormData&&p instanceof a.FormData,!(0<=Array.prototype.indexOf.call(gt,w,void 0))||O||Y||S.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[ee,_e]of S)this.g.setRequestHeader(ee,_e);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{fm(this),this.u=!0,this.g.send(p),this.u=!1}catch(ee){hm(this,ee)}};function hm(p,w){p.h=!1,p.g&&(p.j=!0,p.g.abort(),p.j=!1),p.l=w,p.m=5,Ai(p),bl(p)}function Ai(p){p.A||(p.A=!0,Sn(p,"complete"),Sn(p,"error"))}n.abort=function(p){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=p||7,Sn(this,"complete"),Sn(this,"abort"),bl(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),bl(this,!0)),on.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?aa(this):this.bb())},n.bb=function(){aa(this)};function aa(p){if(p.h&&typeof o<"u"&&(!p.v[1]||qi(p)!=4||p.Z()!=2)){if(p.u&&qi(p)==4)fl(p.Ea,0,p);else if(Sn(p,"readystatechange"),qi(p)==4){p.h=!1;try{let _e=p.Z();e:switch(_e){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var w=!0;break e;default:w=!1}var S;if(!(S=w)){var O;if(O=_e===0){var Y=String(p.D).match(mi)[1]||null;!Y&&a.self&&a.self.location&&(Y=a.self.location.protocol.slice(0,-1)),O=!dm.test(Y?Y.toLowerCase():"")}S=O}if(S)Sn(p,"complete"),Sn(p,"success");else{p.m=6;try{var ee=2<qi(p)?p.g.statusText:""}catch{ee=""}p.l=ee+" ["+p.Z()+"]",Ai(p)}}finally{bl(p)}}}}function bl(p,w){if(p.g){fm(p);let S=p.g,O=p.v[0]?()=>{}:null;p.g=null,p.v=null,w||Sn(p,"ready");try{S.onreadystatechange=O}catch{}}}function fm(p){p.I&&(a.clearTimeout(p.I),p.I=null)}n.isActive=function(){return!!this.g};function qi(p){return p.g?p.g.readyState:0}n.Z=function(){try{return 2<qi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(p){if(this.g){var w=this.g.responseText;return p&&w.indexOf(p)==0&&(w=w.substring(p.length)),eE(w)}};function pm(p){try{if(!p.g)return null;if("response"in p.g)return p.g.response;switch(p.H){case"":case"text":return p.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in p.g)return p.g.mozResponseArrayBuffer}return null}catch{return null}}function mm(p){let w={};p=(p.g&&2<=qi(p)&&p.g.getAllResponseHeaders()||"").split(`\r
`);for(let O=0;O<p.length;O++){if(D(p[O]))continue;var S=F(p[O]);let Y=S[0];if(S=S[1],typeof S!="string")continue;S=S.trim();let ee=w[Y]||[];w[Y]=ee,ee.push(S)}A(w,function(O){return O.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Sl(p,w,S){return S&&S.internalChannelParams&&S.internalChannelParams[p]||w}function gm(p){this.Aa=0,this.i=[],this.j=new na,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Sl("failFast",!1,p),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Sl("baseRetryDelayMs",5e3,p),this.cb=Sl("retryDelaySeedMs",1e4,p),this.Wa=Sl("forwardChannelMaxRetries",2,p),this.wa=Sl("forwardChannelRequestTimeoutMs",2e4,p),this.pa=p&&p.xmlHttpFactory||void 0,this.Xa=p&&p.Tb||void 0,this.Ca=p&&p.useFetchStreams||!1,this.L=void 0,this.J=p&&p.supportsCrossDomainXhr||!1,this.K="",this.h=new Et(p&&p.concurrentRequestLimit),this.Da=new ph,this.P=p&&p.fastHandshake||!1,this.O=p&&p.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=p&&p.Rb||!1,p&&p.xa&&this.j.xa(),p&&p.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&p&&p.detectBufferingProxy||!1,this.ja=void 0,p&&p.longPollingTimeout&&0<p.longPollingTimeout&&(this.ja=p.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=gm.prototype,n.la=8,n.G=1,n.connect=function(p,w,S,O){ti(0),this.W=p,this.H=w||{},S&&O!==void 0&&(this.H.OSID=S,this.H.OAID=O),this.F=this.X,this.I=Th(this,null,this.W),Qc(this)};function Cl(p){if(Wi(p),p.G==3){var w=p.U++,S=ni(p.I);if(Lt(S,"SID",p.K),Lt(S,"RID",w),Lt(S,"TYPE","terminate"),la(p,S),w=new us(p,p.j,w),w.L=2,w.v=sa(ni(S)),S=!1,a.navigator&&a.navigator.sendBeacon)try{S=a.navigator.sendBeacon(w.v.toString(),"")}catch{}!S&&a.Image&&(new Image().src=w.v,S=!0),S||(w.g=xl(w.j,null),w.g.ea(w.v)),w.F=Date.now(),Hc(w)}Eh(p)}function Yc(p){p.g&&(Xc(p),p.g.cancel(),p.g=null)}function Wi(p){Yc(p),p.u&&(a.clearTimeout(p.u),p.u=null),Jc(p),p.h.cancel(),p.s&&(typeof p.s=="number"&&a.clearTimeout(p.s),p.s=null)}function Qc(p){if(!Xt(p.h)&&!p.s){p.s=!0;var w=p.Ga;te||ye(),W||(te(),W=!0),ne.add(w,p),p.B=0}}function ym(p,w){return vl(p.h)>=p.h.j-(p.s?1:0)?!1:p.s?(p.i=w.D.concat(p.i),!0):p.G==1||p.G==2||p.B>=(p.Va?0:p.Wa)?!1:(p.s=Re(m(p.Ga,p,w),eu(p,p.B)),p.B++,!0)}n.Ga=function(p){if(this.s)if(this.s=null,this.G==1){if(!p){this.U=Math.floor(1e5*Math.random()),p=this.U++;let Y=new us(this,this.j,p),ee=this.o;if(this.S&&(ee?(ee=x(ee),M(ee,this.S)):ee=this.S),this.m!==null||this.O||(Y.H=ee,ee=null),this.P)e:{for(var w=0,S=0;S<this.i.length;S++){t:{var O=this.i[S];if("__data__"in O.map&&(O=O.map.__data__,typeof O=="string")){O=O.length;break t}O=void 0}if(O===void 0)break;if(w+=O,4096<w){w=S;break e}if(w===4096||S===this.i.length-1){w=S+1;break e}}w=1e3}else w=1e3;w=yh(this,Y,w),S=ni(this.I),Lt(S,"RID",p),Lt(S,"CVER",22),this.D&&Lt(S,"X-HTTP-Session-Id",this.D),la(this,S),ee&&(this.O?w="headers="+encodeURIComponent(String(gh(ee)))+"&"+w:this.m&&Il(S,this.m,ee)),fs(this.h,Y),this.Ua&&Lt(S,"TYPE","init"),this.P?(Lt(S,"$req",w),Lt(S,"SID","null"),Y.T=!0,ia(Y,S,null)):ia(Y,S,w),this.G=2}}else this.G==3&&(p?jr(this,p):this.i.length==0||Xt(this.h)||jr(this))};function jr(p,w){var S;w?S=w.l:S=p.U++;let O=ni(p.I);Lt(O,"SID",p.K),Lt(O,"RID",S),Lt(O,"AID",p.T),la(p,O),p.m&&p.o&&Il(O,p.m,p.o),S=new us(p,p.j,S,p.B+1),p.m===null&&(S.H=p.o),w&&(p.i=w.D.concat(p.i)),w=yh(p,S,1e3),S.I=Math.round(.5*p.wa)+Math.round(.5*p.wa*Math.random()),fs(p.h,S),ia(S,O,w)}function la(p,w){p.H&&H(p.H,function(S,O){Lt(w,O,S)}),p.l&&_l({},function(S,O){Lt(w,O,S)})}function yh(p,w,S){S=Math.min(p.i.length,S);var O=p.l?m(p.l.Na,p.l,p):null;e:{var Y=p.i;let ee=-1;for(;;){let _e=["count="+S];ee==-1?0<S?(ee=Y[0].g,_e.push("ofs="+ee)):ee=0:_e.push("ofs="+ee);let ut=!0;for(let an=0;an<S;an++){let wt=Y[an].g,Jt=Y[an].map;if(wt-=ee,0>wt)ee=Math.max(0,Y[an].g-100),ut=!1;else try{Tl(Jt,_e,"req"+wt+"_")}catch{O&&O(Jt)}}if(ut){O=_e.join("&");break e}}}return p=p.i.splice(0,S),w.D=p,O}function Zc(p){if(!p.g&&!p.u){p.Y=1;var w=p.Fa;te||ye(),W||(te(),W=!0),ne.add(w,p),p.v=0}}function vh(p){return p.g||p.u||3<=p.v?!1:(p.Y++,p.u=Re(m(p.Fa,p),eu(p,p.v)),p.v++,!0)}n.Fa=function(){if(this.u=null,_h(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var p=2*this.R;this.j.info("BP detection timer enabled: "+p),this.A=Re(m(this.ab,this),p)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ti(10),Yc(this),_h(this))};function Xc(p){p.A!=null&&(a.clearTimeout(p.A),p.A=null)}function _h(p){p.g=new us(p,p.j,"rpc",p.Y),p.m===null&&(p.g.H=p.o),p.g.O=0;var w=ni(p.qa);Lt(w,"RID","rpc"),Lt(w,"SID",p.K),Lt(w,"AID",p.T),Lt(w,"CI",p.F?"0":"1"),!p.F&&p.ja&&Lt(w,"TO",p.ja),Lt(w,"TYPE","xmlhttp"),la(p,w),p.m&&p.o&&Il(w,p.m,p.o),p.L&&(p.g.I=p.L);var S=p.g;p=p.ia,S.L=1,S.v=sa(ni(w)),S.m=null,S.P=!0,am(S,p)}n.Za=function(){this.C!=null&&(this.C=null,Yc(this),vh(this),ti(19))};function Jc(p){p.C!=null&&(a.clearTimeout(p.C),p.C=null)}function vm(p,w){var S=null;if(p.g==w){Jc(p),Xc(p),p.g=null;var O=2}else if(hs(p.h,w))S=w.D,Wc(p.h,w),O=1;else return;if(p.G!=0){if(w.o)if(O==1){S=w.m?w.m.length:0,w=Date.now()-w.F;var Y=p.B;O=ta(),Sn(O,new zi(O,S)),Qc(p)}else Zc(p);else if(Y=w.s,Y==3||Y==0&&0<w.X||!(O==1&&ym(p,w)||O==2&&vh(p)))switch(S&&0<S.length&&(w=p.h,w.i=w.i.concat(S)),Y){case 1:oo(p,5);break;case 4:oo(p,10);break;case 3:oo(p,6);break;default:oo(p,2)}}}function eu(p,w){let S=p.Ta+Math.floor(Math.random()*p.cb);return p.isActive()||(S*=2),S*w}function oo(p,w){if(p.j.info("Error code "+w),w==2){var S=m(p.fb,p),O=p.Xa;let Y=!O;O=new _r(O||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||rn(O,"https"),sa(O),Y?hh(O.toString(),S):fh(O.toString(),S)}else ti(2);p.G=0,p.l&&p.l.sa(w),Eh(p),Wi(p)}n.fb=function(p){p?(this.j.info("Successfully pinged google.com"),ti(2)):(this.j.info("Failed to ping google.com"),ti(1))};function Eh(p){if(p.G=0,p.ka=[],p.l){let w=Ze(p.h);(w.length!=0||p.i.length!=0)&&(T(p.ka,w),T(p.ka,p.i),p.h.i.length=0,E(p.i),p.i.length=0),p.l.ra()}}function Th(p,w,S){var O=S instanceof _r?ni(S):new _r(S);if(O.g!="")w&&(O.g=w+"."+O.g),Er(O,O.s);else{var Y=a.location;O=Y.protocol,w=w?w+"."+Y.hostname:Y.hostname,Y=+Y.port;var ee=new _r(null);O&&rn(ee,O),w&&(ee.g=w),Y&&Er(ee,Y),S&&(ee.l=S),O=ee}return S=p.D,w=p.ya,S&&w&&Lt(O,S,w),Lt(O,"VER",p.la),la(p,O),O}function xl(p,w,S){if(w&&!p.J)throw Error("Can't create secondary domain capable XhrIo object.");return w=p.Ca&&!p.pa?new on(new dn({eb:S})):new on(p.pa),w.Ha(p.J),w}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ms(){}n=ms.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function tu(){}tu.prototype.g=function(p,w){return new On(p,w)};function On(p,w){En.call(this),this.g=new gm(w),this.l=p,this.h=w&&w.messageUrlParams||null,p=w&&w.messageHeaders||null,w&&w.clientProtocolHeaderRequired&&(p?p["X-Client-Protocol"]="webchannel":p={"X-Client-Protocol":"webchannel"}),this.g.o=p,p=w&&w.initMessageHeaders||null,w&&w.messageContentType&&(p?p["X-WebChannel-Content-Type"]=w.messageContentType:p={"X-WebChannel-Content-Type":w.messageContentType}),w&&w.va&&(p?p["X-WebChannel-Client-Profile"]=w.va:p={"X-WebChannel-Client-Profile":w.va}),this.g.S=p,(p=w&&w.Sb)&&!D(p)&&(this.g.m=p),this.v=w&&w.supportsCrossDomainXhr||!1,this.u=w&&w.sendRawJson||!1,(w=w&&w.httpSessionIdParam)&&!D(w)&&(this.g.D=w,p=this.h,p!==null&&w in p&&(p=this.h,w in p&&delete p[w])),this.j=new ao(this)}v(On,En),On.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},On.prototype.close=function(){Cl(this.g)},On.prototype.o=function(p){var w=this.g;if(typeof p=="string"){var S={};S.__data__=p,p=S}else this.u&&(S={},S.__data__=Xd(p),p=S);w.i.push(new yl(w.Ya++,p)),w.G==3&&Qc(w)},On.prototype.N=function(){this.g.l=null,delete this.j,Cl(this.g),delete this.g,On.aa.N.call(this)};function gi(p){eh.call(this),p.__headers__&&(this.headers=p.__headers__,this.statusCode=p.__status__,delete p.__headers__,delete p.__status__);var w=p.__sm__;if(w){e:{for(let S in w){p=S;break e}p=void 0}(this.i=p)&&(p=this.i,w=w!==null&&p in w?w[p]:void 0),this.data=w}else this.data=p}v(gi,eh);function wh(){th.call(this),this.status=1}v(wh,th);function ao(p){this.g=p}v(ao,ms),ao.prototype.ua=function(){Sn(this.g,"a")},ao.prototype.ta=function(p){Sn(this.g,new gi(p))},ao.prototype.sa=function(p){Sn(this.g,new wh)},ao.prototype.ra=function(){Sn(this.g,"b")},tu.prototype.createWebChannel=tu.prototype.g,On.prototype.send=On.prototype.o,On.prototype.open=On.prototype.m,On.prototype.close=On.prototype.close,VS=jo.createWebChannelTransport=function(){return new tu},FS=jo.getStatEventTarget=function(){return ta()},NS=jo.Event=to,jy=jo.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Br.NO_ERROR=0,Br.TIMEOUT=8,Br.HTTP_ERROR=6,Wf=jo.ErrorCode=Br,ih.COMPLETE="complete",OS=jo.EventType=ih,Jp.EventType=pl,pl.OPEN="a",pl.CLOSE="b",pl.ERROR="c",pl.MESSAGE="d",En.prototype.listen=En.prototype.K,ad=jo.WebChannel=Jp,mQ=jo.FetchXmlHttpFactory=dn,on.prototype.listenOnce=on.prototype.L,on.prototype.getLastError=on.prototype.Ka,on.prototype.getLastErrorCode=on.prototype.Ba,on.prototype.getStatus=on.prototype.Z,on.prototype.getResponseJson=on.prototype.Oa,on.prototype.getResponseText=on.prototype.oa,on.prototype.send=on.prototype.ea,on.prototype.setWithCredentials=on.prototype.Ha,LS=jo.XhrIo=on}).apply(typeof $y<"u"?$y:typeof self<"u"?self:typeof window<"u"?window:{});var vF="@firebase/firestore";var Qn=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Qn.UNAUTHENTICATED=new Qn(null),Qn.GOOGLE_CREDENTIALS=new Qn("google-credentials-uid"),Qn.FIRST_PARTY=new Qn("first-party-uid"),Qn.MOCK_USER=new Qn("mock-user");var Cd="10.14.0";var vc=new Ua("@firebase/firestore");function Kf(){return vc.logLevel}function ke(n,...e){if(vc.logLevel<=vt.DEBUG){let t=e.map(Ix);vc.debug(`Firestore (${Cd}): ${n}`,...t)}}function zo(n,...e){if(vc.logLevel<=vt.ERROR){let t=e.map(Ix);vc.error(`Firestore (${Cd}): ${n}`,...t)}}function md(n,...e){if(vc.logLevel<=vt.WARN){let t=e.map(Ix);vc.warn(`Firestore (${Cd}): ${n}`,...t)}}function Ix(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function ze(n="Unexpected state"){let e=`FIRESTORE (${Cd}) INTERNAL ASSERTION FAILED: `+n;throw zo(e),new Error(e)}function $t(n,e){n||ze()}function Qe(n,e){return n}var se={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},we=class extends lr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ts=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Wy=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},GS=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Qn.UNAUTHENTICATED))}shutdown(){}},zS=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},HS=class{constructor(e){this.t=e,this.currentUser=Qn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){$t(this.o===void 0);let i=this.i,r=l=>this.i!==i?(i=this.i,t(l)):Promise.resolve(),s=new ts;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ts,e.enqueueRetryable(()=>r(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>U(this,null,function*(){yield l.promise,yield r(this.currentUser)}))},a=l=>{ke("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?a(l):(ke("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ts)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(ke("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?($t(typeof i.accessToken=="string"),new Wy(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return $t(e===null||typeof e=="string"),new Qn(e)}},qS=class{constructor(e,t,i){this.l=e,this.h=t,this.P=i,this.type="FirstParty",this.user=Qn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},WS=class{constructor(e,t,i){this.l=e,this.h=t,this.P=i}getToken(){return Promise.resolve(new qS(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Qn.FIRST_PARTY))}shutdown(){}invalidateToken(){}},KS=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},YS=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){$t(this.o===void 0);let i=s=>{s.error!=null&&ke("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,ke("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};let r=s=>{ke("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?r(s):ke("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?($t(typeof t.token=="string"),this.R=t.token,new KS(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function gQ(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}var Ky=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,i="";for(;i.length<20;){let r=gQ(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%e.length))}return i}};function Rt(n,e){return n<e?-1:n>e?1:0}function gd(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}var gn=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new we(se.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new we(se.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new we(se.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new we(se.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new n(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Rt(this.nanoseconds,e.nanoseconds):Rt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var tt=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new gn(0,0))}static max(){return new n(new gn(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Yy=class n{constructor(e,t,i){t===void 0?t=0:t>e.length&&ze(),i===void 0?i=e.length-t:i>e.length-t&&ze(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let i=Math.min(e.length,t.length);for(let r=0;r<i;r++){let s=e.get(r),o=t.get(r);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},cn=class n extends Yy{construct(e,t,i){return new n(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let i of e){if(i.indexOf("//")>=0)throw new we(se.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new n(t)}static emptyPath(){return new n([])}},yQ=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ur=class n extends Yy{construct(e,t,i){return new n(e,t,i)}static isValidIdentifier(e){return yQ.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],i="",r=0,s=()=>{if(i.length===0)throw new we(se.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""},o=!1;for(;r<e.length;){let a=e[r];if(a==="\\"){if(r+1===e.length)throw new we(se.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new we(se.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=l,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(i+=a,r++):(s(),r++)}if(s(),o)throw new we(se.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var Ve=class n{constructor(e){this.path=e}static fromPath(e){return new n(cn.fromString(e))}static fromName(e){return new n(cn.fromString(e).popFirst(5))}static empty(){return new n(cn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&cn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return cn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new cn(e.slice()))}};var QS=class{constructor(e,t,i,r){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=r}};QS.UNKNOWN_ID=-1;function vQ(n,e){let t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=tt.fromTimestamp(i===1e9?new gn(t+1,0):new gn(t,i));return new _c(r,Ve.empty(),e)}function _Q(n){return new _c(n.readTime,n.key,-1)}var _c=class n{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new n(tt.min(),Ve.empty(),-1)}static max(){return new n(tt.max(),Ve.empty(),-1)}};function EQ(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ve.comparator(n.documentKey,e.documentKey),t!==0?t:Rt(n.largestBatchId,e.largestBatchId))}var TQ="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ZS=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function gp(n){return U(this,null,function*(){if(n.code!==se.FAILED_PRECONDITION||n.message!==TQ)throw n;ke("LocalStore","Unexpectedly lost primary lease")})}var ge=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ze(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,i)=>{t(e)})}static reject(e){return new n((t,i)=>{i(e)})}static waitFor(e){return new n((t,i)=>{let r=0,s=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&t()},l=>i(l))}),o=!0,s===r&&t()})}static or(e){let t=n.resolve(!1);for(let i of e)t=t.next(r=>r?n.resolve(r):i());return t}static forEach(e,t){let i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new n((i,r)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let u=l;t(e[u]).next(d=>{o[u]=d,++a,a===s&&i(o)},d=>r(d))}})}static doWhile(e,t){return new n((i,r)=>{let s=()=>{e()===!0?t().next(()=>{s()},r):i()};s()})}};function wQ(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function yp(n){return n.name==="IndexedDbTransactionError"}var XF=(()=>{class n{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=r=>this.ie(r),this.se=r=>i.writeSequenceNumber(r))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function xv(n){return n==null}function Jf(n){return n===0&&1/n==-1/0}function IQ(n){return typeof n=="number"&&Number.isInteger(n)&&!Jf(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var bQ=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ype=[...bQ,"documentOverlays"],SQ=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],CQ=SQ,xQ=[...CQ,"indexConfiguration","indexState","indexEntries"];var vpe=[...xQ,"globals"];function _F(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function bc(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function JF(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var yn=class n{constructor(e,t){this.comparator=e,this.root=t||$s.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,$s.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,$s.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){let r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){let e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new dd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new dd(this.root,e,this.comparator,!1)}getReverseIterator(){return new dd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new dd(this.root,e,this.comparator,!0)}},dd=class{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},$s=class n{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=i??n.RED,this.left=r??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new n(e??this.key,t??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this,s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return n.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ze();let e=this.left.check();if(e!==this.right.check())throw ze();return e+(this.isRed()?0:1)}};$s.EMPTY=null,$s.RED=!0,$s.BLACK=!1;$s.EMPTY=new class{constructor(){this.size=0}get key(){throw ze()}get value(){throw ze()}get color(){throw ze()}get left(){throw ze()}get right(){throw ze()}copy(e,t,i,r,s){return this}insert(e,t,i){return new $s(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var fi=class n{constructor(e){this.comparator=e,this.data=new yn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){let i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){let r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Qy(this.data.getIterator())}getIteratorFrom(e){return new Qy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Qy=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Mr=class n{constructor(e){this.fields=e,e.sort(ur.comparator)}static empty(){return new n([])}unionWith(e){let t=new fi(ur.comparator);for(let i of this.fields)t=t.add(i);for(let i of e)t=t.add(i);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return gd(this.fields,e.fields,(t,i)=>t.isEqual(i))}};var Zy=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var pi=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Zy("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(r){let s="";for(let o=0;o<r.length;++o)s+=String.fromCharCode(r[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Rt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};pi.EMPTY_BYTE_STRING=new pi("");var AQ=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ho(n){if($t(!!n),typeof n=="string"){let e=0,t=AQ.exec(n);if($t(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}let i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ln(n.seconds),nanos:ln(n.nanos)}}function ln(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Qa(n){return typeof n=="string"?pi.fromBase64String(n):pi.fromUint8Array(n)}function Av(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function bx(n){let e=n.mapValue.fields.__previous_value__;return Av(e)?bx(e):e}function ep(n){let e=Ho(n.mapValue.fields.__local_write_time__.timestampValue);return new gn(e.seconds,e.nanos)}var XS=class{constructor(e,t,i,r,s,o,a,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u}},Xy=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Gy={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Ec(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Av(n)?4:t2(n)?9007199254740991:e2(n)?10:11:ze()}function zs(n,e){if(n===e)return!0;let t=Ec(n);if(t!==Ec(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ep(n).isEqual(ep(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;let o=Ho(r.timestampValue),a=Ho(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,s){return Qa(r.bytesValue).isEqual(Qa(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return ln(r.geoPointValue.latitude)===ln(s.geoPointValue.latitude)&&ln(r.geoPointValue.longitude)===ln(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return ln(r.integerValue)===ln(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){let o=ln(r.doubleValue),a=ln(s.doubleValue);return o===a?Jf(o)===Jf(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return gd(n.arrayValue.values||[],e.arrayValue.values||[],zs);case 10:case 11:return function(r,s){let o=r.mapValue.fields||{},a=s.mapValue.fields||{};if(_F(o)!==_F(a))return!1;for(let l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!zs(o[l],a[l])))return!1;return!0}(n,e);default:return ze()}}function tp(n,e){return(n.values||[]).find(t=>zs(t,e))!==void 0}function yd(n,e){if(n===e)return 0;let t=Ec(n),i=Ec(e);if(t!==i)return Rt(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return Rt(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=ln(s.integerValue||s.doubleValue),l=ln(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return EF(n.timestampValue,e.timestampValue);case 4:return EF(ep(n),ep(e));case 5:return Rt(n.stringValue,e.stringValue);case 6:return function(s,o){let a=Qa(s),l=Qa(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){let d=Rt(a[u],l[u]);if(d!==0)return d}return Rt(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=Rt(ln(s.latitude),ln(o.latitude));return a!==0?a:Rt(ln(s.longitude),ln(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return TF(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,l,u,d;let f=s.fields||{},m=o.fields||{},y=(a=f.value)===null||a===void 0?void 0:a.arrayValue,v=(l=m.value)===null||l===void 0?void 0:l.arrayValue,E=Rt(((u=y?.values)===null||u===void 0?void 0:u.length)||0,((d=v?.values)===null||d===void 0?void 0:d.length)||0);return E!==0?E:TF(y,v)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===Gy.mapValue&&o===Gy.mapValue)return 0;if(s===Gy.mapValue)return 1;if(o===Gy.mapValue)return-1;let a=s.fields||{},l=Object.keys(a),u=o.fields||{},d=Object.keys(u);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){let m=Rt(l[f],d[f]);if(m!==0)return m;let y=yd(a[l[f]],u[d[f]]);if(y!==0)return y}return Rt(l.length,d.length)}(n.mapValue,e.mapValue);default:throw ze()}}function EF(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Rt(n,e);let t=Ho(n),i=Ho(e),r=Rt(t.seconds,i.seconds);return r!==0?r:Rt(t.nanos,i.nanos)}function TF(n,e){let t=n.values||[],i=e.values||[];for(let r=0;r<t.length&&r<i.length;++r){let s=yd(t[r],i[r]);if(s)return s}return Rt(t.length,i.length)}function vd(n){return JS(n)}function JS(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let i=Ho(t);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Qa(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Ve.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let i="[",r=!0;for(let s of t.values||[])r?r=!1:i+=",",i+=JS(s);return i+"]"}(n.arrayValue):"mapValue"in n?function(t){let i=Object.keys(t.fields||{}).sort(),r="{",s=!0;for(let o of i)s?s=!1:r+=",",r+=`${o}:${JS(t.fields[o])}`;return r+"}"}(n.mapValue):ze()}function Jy(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function eC(n){return!!n&&"integerValue"in n}function Sx(n){return!!n&&"arrayValue"in n}function wF(n){return!!n&&"nullValue"in n}function IF(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Hy(n){return!!n&&"mapValue"in n}function e2(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Qf(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return bc(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=Qf(i)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Qf(n.arrayValue.values[t]);return e}return Object.assign({},n)}function t2(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var cr=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!Hy(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qf(t)}setAll(e){let t=ur.emptyPath(),i={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,i,r),i={},r=[],t=a.popLast()}o?i[a.lastSegment()]=Qf(o):r.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){let t=this.field(e.popLast());Hy(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return zs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];Hy(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){bc(t,(r,s)=>e[r]=s);for(let r of i)delete e[r]}clone(){return new n(Qf(this.value))}};function n2(n){let e=[];return bc(n.fields,(t,i)=>{let r=new ur([t]);if(Hy(i)){let s=n2(i.mapValue).fields;if(s.length===0)e.push(r);else for(let o of s)e.push(r.child(o))}else e.push(r)}),new Mr(e)}var ns=class n{constructor(e,t,i,r,s,o,a){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,tt.min(),tt.min(),tt.min(),cr.empty(),0)}static newFoundDocument(e,t,i,r){return new n(e,1,t,tt.min(),i,r,0)}static newNoDocument(e,t){return new n(e,2,t,tt.min(),tt.min(),cr.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,tt.min(),tt.min(),cr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(tt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=cr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=cr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=tt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Za=class{constructor(e,t){this.position=e,this.inclusive=t}};function bF(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){let s=e[r],o=n.position[r];if(s.field.isKeyField()?i=Ve.comparator(Ve.fromName(o.referenceValue),t.key):i=yd(o,t.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function SF(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!zs(n.position[t],e.position[t]))return!1;return!0}var Tc=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function DQ(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var ev=class{},Ln=class n extends ev{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new nC(e,t,i):t==="array-contains"?new sC(e,i):t==="in"?new oC(e,i):t==="not-in"?new aC(e,i):t==="array-contains-any"?new lC(e,i):new n(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new iC(e,i):new rC(e,i)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(yd(t,this.value)):t!==null&&Ec(this.value)===Ec(t)&&this.matchesComparison(yd(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ze()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},is=class n extends ev{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return i2(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function i2(n){return n.op==="and"}function r2(n){return PQ(n)&&i2(n)}function PQ(n){for(let e of n.filters)if(e instanceof is)return!1;return!0}function tC(n){if(n instanceof Ln)return n.field.canonicalString()+n.op.toString()+vd(n.value);if(r2(n))return n.filters.map(e=>tC(e)).join(",");{let e=n.filters.map(t=>tC(t)).join(",");return`${n.op}(${e})`}}function s2(n,e){return n instanceof Ln?function(i,r){return r instanceof Ln&&i.op===r.op&&i.field.isEqual(r.field)&&zs(i.value,r.value)}(n,e):n instanceof is?function(i,r){return r instanceof is&&i.op===r.op&&i.filters.length===r.filters.length?i.filters.reduce((s,o,a)=>s&&s2(o,r.filters[a]),!0):!1}(n,e):void ze()}function o2(n){return n instanceof Ln?function(t){return`${t.field.canonicalString()} ${t.op} ${vd(t.value)}`}(n):n instanceof is?function(t){return t.op.toString()+" {"+t.getFilters().map(o2).join(" ,")+"}"}(n):"Filter"}var nC=class extends Ln{constructor(e,t,i){super(e,t,i),this.key=Ve.fromName(i.referenceValue)}matches(e){let t=Ve.comparator(e.key,this.key);return this.matchesComparison(t)}},iC=class extends Ln{constructor(e,t){super(e,"in",t),this.keys=a2("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},rC=class extends Ln{constructor(e,t){super(e,"not-in",t),this.keys=a2("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function a2(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>Ve.fromName(i.referenceValue))}var sC=class extends Ln{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Sx(t)&&tp(t.arrayValue,this.value)}},oC=class extends Ln{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&tp(this.value.arrayValue,t)}},aC=class extends Ln{constructor(e,t){super(e,"not-in",t)}matches(e){if(tp(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!tp(this.value.arrayValue,t)}},lC=class extends Ln{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Sx(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>tp(this.value.arrayValue,i))}};var cC=class{constructor(e,t=null,i=[],r=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function CF(n,e=null,t=[],i=[],r=null,s=null,o=null){return new cC(n,e,t,i,r,s,o)}function Cx(n){let e=Qe(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>tC(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),xv(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>vd(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>vd(i)).join(",")),e.ue=t}return e.ue}function xx(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!DQ(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!s2(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!SF(n.startAt,e.startAt)&&SF(n.endAt,e.endAt)}function uC(n){return Ve.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var qo=class{constructor(e,t=null,i=[],r=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function RQ(n,e,t,i,r,s,o,a){return new qo(n,e,t,i,r,s,o,a)}function Dv(n){return new qo(n)}function xF(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Ax(n){return n.collectionGroup!==null}function hd(n){let e=Qe(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new fi(ur.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Tc(s,i))}),t.has(ur.keyField().canonicalString())||e.ce.push(new Tc(ur.keyField(),i))}return e.ce}function js(n){let e=Qe(n);return e.le||(e.le=MQ(e,hd(n))),e.le}function MQ(n,e){if(n.limitType==="F")return CF(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{let s=r.dir==="desc"?"asc":"desc";return new Tc(r.field,s)});let t=n.endAt?new Za(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new Za(n.startAt.position,n.startAt.inclusive):null;return CF(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function dC(n,e){let t=n.filters.concat([e]);return new qo(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function tv(n,e,t){return new qo(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Pv(n,e){return xx(js(n),js(e))&&n.limitType===e.limitType}function l2(n){return`${Cx(js(n))}|lt:${n.limitType}`}function ld(n){return`Query(target=${function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map(r=>o2(r)).join(", ")}]`),xv(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(r=>vd(r)).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(r=>vd(r)).join(",")),`Target(${i})`}(js(n))}; limitType=${n.limitType})`}function Rv(n,e){return e.isFoundDocument()&&function(i,r){let s=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):Ve.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)}(n,e)&&function(i,r){for(let s of hd(i))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(n,e)&&function(i,r){for(let s of i.filters)if(!s.matches(r))return!1;return!0}(n,e)&&function(i,r){return!(i.startAt&&!function(o,a,l){let u=bF(o,a,l);return o.inclusive?u<=0:u<0}(i.startAt,hd(i),r)||i.endAt&&!function(o,a,l){let u=bF(o,a,l);return o.inclusive?u>=0:u>0}(i.endAt,hd(i),r))}(n,e)}function kQ(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function c2(n){return(e,t)=>{let i=!1;for(let r of hd(n)){let s=LQ(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function LQ(n,e,t){let i=n.field.isKeyField()?Ve.comparator(e.key,t.key):function(s,o,a){let l=o.data.field(s),u=a.data.field(s);return l!==null&&u!==null?yd(l,u):ze()}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return ze()}}var Xa=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(let[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){bc(this.inner,(t,i)=>{for(let[r,s]of i)e(r,s)})}isEmpty(){return JF(this.inner)}size(){return this.innerSize}};var OQ=new yn(Ve.comparator);function Wo(){return OQ}var u2=new yn(Ve.comparator);function Yf(...n){let e=u2;for(let t of n)e=e.insert(t.key,t);return e}function d2(n){let e=u2;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function mc(){return Zf()}function h2(){return Zf()}function Zf(){return new Xa(n=>n.toString(),(n,e)=>n.isEqual(e))}var NQ=new yn(Ve.comparator),FQ=new fi(Ve.comparator);function _t(...n){let e=FQ;for(let t of n)e=e.add(t);return e}var VQ=new fi(Rt);function BQ(){return VQ}function Dx(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Jf(e)?"-0":e}}function f2(n){return{integerValue:""+n}}function p2(n,e){return IQ(e)?f2(e):Dx(n,e)}var _d=class{constructor(){this._=void 0}};function UQ(n,e,t){return n instanceof Ed?function(r,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&Av(s)&&(s=bx(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Ja?g2(n,e):n instanceof el?y2(n,e):function(r,s){let o=m2(r,s),a=AF(o)+AF(r.Pe);return eC(o)&&eC(r.Pe)?f2(a):Dx(r.serializer,a)}(n,e)}function $Q(n,e,t){return n instanceof Ja?g2(n,e):n instanceof el?y2(n,e):t}function m2(n,e){return n instanceof wc?function(i){return eC(i)||function(s){return!!s&&"doubleValue"in s}(i)}(e)?e:{integerValue:0}:null}var Ed=class extends _d{},Ja=class extends _d{constructor(e){super(),this.elements=e}};function g2(n,e){let t=v2(e);for(let i of n.elements)t.some(r=>zs(r,i))||t.push(i);return{arrayValue:{values:t}}}var el=class extends _d{constructor(e){super(),this.elements=e}};function y2(n,e){let t=v2(e);for(let i of n.elements)t=t.filter(r=>!zs(r,i));return{arrayValue:{values:t}}}var wc=class extends _d{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function AF(n){return ln(n.integerValue||n.doubleValue)}function v2(n){return Sx(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var np=class{constructor(e,t){this.field=e,this.transform=t}};function jQ(n,e){return n.field.isEqual(e.field)&&function(i,r){return i instanceof Ja&&r instanceof Ja||i instanceof el&&r instanceof el?gd(i.elements,r.elements,zs):i instanceof wc&&r instanceof wc?zs(i.Pe,r.Pe):i instanceof Ed&&r instanceof Ed}(n.transform,e.transform)}var hC=class{constructor(e,t){this.version=e,this.transformResults=t}},Go=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function qy(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Td=class{};function _2(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ip(n.key,Go.none()):new Ic(n.key,n.data,Go.none());{let t=n.data,i=cr.empty(),r=new fi(ur.comparator);for(let s of e.fields)if(!r.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?i.delete(s):i.set(s,o),r=r.add(s)}return new Hs(n.key,i,new Mr(r.toArray()),Go.none())}}function GQ(n,e,t){n instanceof Ic?function(r,s,o){let a=r.value.clone(),l=PF(r.fieldTransforms,s,o.transformResults);a.setAll(l),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Hs?function(r,s,o){if(!qy(r.precondition,s))return void s.convertToUnknownDocument(o.version);let a=PF(r.fieldTransforms,s,o.transformResults),l=s.data;l.setAll(E2(r)),l.setAll(a),s.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(r,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Xf(n,e,t,i){return n instanceof Ic?function(s,o,a,l){if(!qy(s.precondition,o))return a;let u=s.value.clone(),d=RF(s.fieldTransforms,l,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,i):n instanceof Hs?function(s,o,a,l){if(!qy(s.precondition,o))return a;let u=RF(s.fieldTransforms,l,o),d=o.data;return d.setAll(E2(s)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(f=>f.field))}(n,e,t,i):function(s,o,a){return qy(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function zQ(n,e){let t=null;for(let i of n.fieldTransforms){let r=e.data.field(i.field),s=m2(i.transform,r||null);s!=null&&(t===null&&(t=cr.empty()),t.set(i.field,s))}return t||null}function DF(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&gd(i,r,(s,o)=>jQ(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Ic=class extends Td{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}},Hs=class extends Td{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function E2(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let i=n.data.field(t);e.set(t,i)}}),e}function PF(n,e,t){let i=new Map;$t(n.length===t.length);for(let r=0;r<t.length;r++){let s=n[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,$Q(o,a,t[r]))}return i}function RF(n,e,t){let i=new Map;for(let r of n){let s=r.transform,o=t.data.field(r.field);i.set(r.field,UQ(s,o,e))}return i}var ip=class extends Td{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},fC=class extends Td{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var pC=class{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){let i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){let s=this.mutations[r];s.key.isEqual(e.key)&&GQ(s,e,i[r])}}applyToLocalView(e,t){for(let i of this.baseMutations)i.key.isEqual(e.key)&&(t=Xf(i,e,t,this.localWriteTime));for(let i of this.mutations)i.key.isEqual(e.key)&&(t=Xf(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let i=h2();return this.mutations.forEach(r=>{let s=e.get(r.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(r.key)?null:a;let l=_2(o,a);l!==null&&i.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(tt.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),_t())}isEqual(e){return this.batchId===e.batchId&&gd(this.mutations,e.mutations,(t,i)=>DF(t,i))&&gd(this.baseMutations,e.baseMutations,(t,i)=>DF(t,i))}},mC=class n{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){$t(e.mutations.length===i.length);let r=function(){return NQ}(),s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new n(e,t,i,r)}};var gC=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var yC=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Mn,bt;function HQ(n){switch(n){default:return ze();case se.CANCELLED:case se.UNKNOWN:case se.DEADLINE_EXCEEDED:case se.RESOURCE_EXHAUSTED:case se.INTERNAL:case se.UNAVAILABLE:case se.UNAUTHENTICATED:return!1;case se.INVALID_ARGUMENT:case se.NOT_FOUND:case se.ALREADY_EXISTS:case se.PERMISSION_DENIED:case se.FAILED_PRECONDITION:case se.ABORTED:case se.OUT_OF_RANGE:case se.UNIMPLEMENTED:case se.DATA_LOSS:return!0}}function T2(n){if(n===void 0)return zo("GRPC error has no .code"),se.UNKNOWN;switch(n){case Mn.OK:return se.OK;case Mn.CANCELLED:return se.CANCELLED;case Mn.UNKNOWN:return se.UNKNOWN;case Mn.DEADLINE_EXCEEDED:return se.DEADLINE_EXCEEDED;case Mn.RESOURCE_EXHAUSTED:return se.RESOURCE_EXHAUSTED;case Mn.INTERNAL:return se.INTERNAL;case Mn.UNAVAILABLE:return se.UNAVAILABLE;case Mn.UNAUTHENTICATED:return se.UNAUTHENTICATED;case Mn.INVALID_ARGUMENT:return se.INVALID_ARGUMENT;case Mn.NOT_FOUND:return se.NOT_FOUND;case Mn.ALREADY_EXISTS:return se.ALREADY_EXISTS;case Mn.PERMISSION_DENIED:return se.PERMISSION_DENIED;case Mn.FAILED_PRECONDITION:return se.FAILED_PRECONDITION;case Mn.ABORTED:return se.ABORTED;case Mn.OUT_OF_RANGE:return se.OUT_OF_RANGE;case Mn.UNIMPLEMENTED:return se.UNIMPLEMENTED;case Mn.DATA_LOSS:return se.DATA_LOSS;default:return ze()}}(bt=Mn||(Mn={}))[bt.OK=0]="OK",bt[bt.CANCELLED=1]="CANCELLED",bt[bt.UNKNOWN=2]="UNKNOWN",bt[bt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",bt[bt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",bt[bt.NOT_FOUND=5]="NOT_FOUND",bt[bt.ALREADY_EXISTS=6]="ALREADY_EXISTS",bt[bt.PERMISSION_DENIED=7]="PERMISSION_DENIED",bt[bt.UNAUTHENTICATED=16]="UNAUTHENTICATED",bt[bt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",bt[bt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",bt[bt.ABORTED=10]="ABORTED",bt[bt.OUT_OF_RANGE=11]="OUT_OF_RANGE",bt[bt.UNIMPLEMENTED=12]="UNIMPLEMENTED",bt[bt.INTERNAL=13]="INTERNAL",bt[bt.UNAVAILABLE=14]="UNAVAILABLE",bt[bt.DATA_LOSS=15]="DATA_LOSS";var MF=null;function qQ(){return new TextEncoder}var WQ=new Ka([4294967295,4294967295],0);function kF(n){let e=qQ().encode(n),t=new kS;return t.update(e),new Uint8Array(t.digest())}function LF(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Ka([t,i],0),new Ka([r,s],0)]}var vC=class n{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new gc(`Invalid padding: ${t}`);if(i<0)throw new gc(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new gc(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new gc(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Ka.fromNumber(this.Ie)}Ee(e,t,i){let r=e.add(t.multiply(Ka.fromNumber(i)));return r.compare(WQ)===1&&(r=new Ka([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=kF(e),[i,r]=LF(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(i,r,s);if(!this.de(o))return!1}return!0}static create(e,t,i){let r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,r,t);return i.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=kF(e),[i,r]=LF(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(i,r,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}},gc=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var nv=class n{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){let r=new Map;return r.set(e,rp.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new n(tt.min(),r,new yn(Rt),Wo(),_t())}},rp=class n{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new n(i,t,_t(),_t(),_t())}};var fd=class{constructor(e,t,i,r){this.Re=e,this.removedTargetIds=t,this.key=i,this.Ve=r}},iv=class{constructor(e,t){this.targetId=e,this.me=t}},rv=class{constructor(e,t,i=pi.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}},sv=class{constructor(){this.fe=0,this.ge=NF(),this.pe=pi.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=_t(),t=_t(),i=_t();return this.ge.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:ze()}}),new rp(this.pe,this.ye,e,t,i)}Ce(){this.we=!1,this.ge=NF()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,$t(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},_C=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=Wo(),this.qe=OF(),this.Qe=new yn(Rt)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let i=this.Ge(t);switch(e.state){case 0:this.ze(t)&&i.De(e.resumeToken);break;case 1:i.Oe(),i.Se||i.Ce(),i.De(e.resumeToken);break;case 2:i.Oe(),i.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(i.Ne(),i.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),i.De(e.resumeToken));break;default:ze()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((i,r)=>{this.ze(r)&&t(r)})}He(e){let t=e.targetId,i=e.me.count,r=this.Je(t);if(r){let s=r.target;if(uC(s))if(i===0){let o=new Ve(s.path);this.Ue(t,o,ns.newNoDocument(o,tt.min()))}else $t(i===1);else{let o=this.Ye(t);if(o!==i){let a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);let u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,u)}MF?.et(function(d,f,m,y,v){var E,T,C,D,P,V;let G={localCacheCount:d,existenceFilterCount:f.count,databaseId:m.database,projectId:m.projectId},H=f.unchangedNames;return H&&(G.bloomFilter={applied:v===0,hashCount:(E=H?.hashCount)!==null&&E!==void 0?E:0,bitmapLength:(D=(C=(T=H?.bits)===null||T===void 0?void 0:T.bitmap)===null||C===void 0?void 0:C.length)!==null&&D!==void 0?D:0,padding:(V=(P=H?.bits)===null||P===void 0?void 0:P.padding)!==null&&V!==void 0?V:0,mightContain:A=>{var x;return(x=y?.mightContain(A))!==null&&x!==void 0&&x}}),G}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=t,o,a;try{o=Qa(i).toUint8Array()}catch(l){if(l instanceof Zy)return md("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new vC(o,r,s)}catch(l){return md(l instanceof gc?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,i){return t.me.count===i-this.nt(e,t.targetId)?0:2}nt(e,t){let i=this.Le.getRemoteKeysForTarget(t),r=0;return i.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),r++)}),r}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&uC(a.target)){let l=new Ve(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,ns.newNoDocument(l,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let i=_t();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let u=this.Je(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(i=i.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let r=new nv(e,t,this.Qe,this.ke,i);return this.ke=Wo(),this.qe=OF(),this.Qe=new yn(Rt),r}$e(e,t){if(!this.ze(e))return;let i=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,i),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,i){if(!this.ze(e))return;let r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),i&&(this.ke=this.ke.insert(t,i))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new sv,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new fi(Rt),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||ke("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new sv),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function OF(){return new yn(Ve.comparator)}function NF(){return new yn(Ve.comparator)}var KQ={asc:"ASCENDING",desc:"DESCENDING"},YQ={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},QQ={and:"AND",or:"OR"},EC=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function TC(n,e){return n.useProto3Json||xv(e)?e:{value:e}}function ov(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function w2(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function ZQ(n,e){return ov(n,e.toTimestamp())}function Gs(n){return $t(!!n),tt.fromTimestamp(function(t){let i=Ho(t);return new gn(i.seconds,i.nanos)}(n))}function Px(n,e){return wC(n,e).canonicalString()}function wC(n,e){let t=function(r){return new cn(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function I2(n){let e=cn.fromString(n);return $t(A2(e)),e}function IC(n,e){return Px(n.databaseId,e.path)}function BS(n,e){let t=I2(e);if(t.get(1)!==n.databaseId.projectId)throw new we(se.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new we(se.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ve(S2(t))}function b2(n,e){return Px(n.databaseId,e)}function XQ(n){let e=I2(n);return e.length===4?cn.emptyPath():S2(e)}function bC(n){return new cn(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function S2(n){return $t(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function FF(n,e,t){return{name:IC(n,e),fields:t.value.mapValue.fields}}function JQ(n,e){let t;if("targetChange"in e){e.targetChange;let i=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:ze()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(u,d){return u.useProto3Json?($t(d===void 0||typeof d=="string"),pi.fromBase64String(d||"")):($t(d===void 0||d instanceof Buffer||d instanceof Uint8Array),pi.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){let d=u.code===void 0?se.UNKNOWN:T2(u.code);return new we(d,u.message||"")}(o);t=new rv(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;let i=e.documentChange;i.document,i.document.name,i.document.updateTime;let r=BS(n,i.document.name),s=Gs(i.document.updateTime),o=i.document.createTime?Gs(i.document.createTime):tt.min(),a=new cr({mapValue:{fields:i.document.fields}}),l=ns.newFoundDocument(r,s,o,a),u=i.targetIds||[],d=i.removedTargetIds||[];t=new fd(u,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;let i=e.documentDelete;i.document;let r=BS(n,i.document),s=i.readTime?Gs(i.readTime):tt.min(),o=ns.newNoDocument(r,s),a=i.removedTargetIds||[];t=new fd([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let i=e.documentRemove;i.document;let r=BS(n,i.document),s=i.removedTargetIds||[];t=new fd([],s,r,null)}else{if(!("filter"in e))return ze();{e.filter;let i=e.filter;i.targetId;let{count:r=0,unchangedNames:s}=i,o=new yC(r,s),a=i.targetId;t=new iv(a,o)}}return t}function eZ(n,e){let t;if(e instanceof Ic)t={update:FF(n,e.key,e.value)};else if(e instanceof ip)t={delete:IC(n,e.key)};else if(e instanceof Hs)t={update:FF(n,e.key,e.data),updateMask:cZ(e.fieldMask)};else{if(!(e instanceof fC))return ze();t={verify:IC(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(s,o){let a=o.transform;if(a instanceof Ed)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Ja)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof el)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof wc)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw ze()}(0,i))),e.precondition.isNone||(t.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:ZQ(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:ze()}(n,e.precondition)),t}function tZ(n,e){return n&&n.length>0?($t(e!==void 0),n.map(t=>function(r,s){let o=r.updateTime?Gs(r.updateTime):Gs(s);return o.isEqual(tt.min())&&(o=Gs(s)),new hC(o,r.transformResults||[])}(t,e))):[]}function nZ(n,e){return{documents:[b2(n,e.path)]}}function iZ(n,e){let t={structuredQuery:{}},i=e.path,r;e.collectionGroup!==null?(r=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=b2(n,r);let s=function(u){if(u.length!==0)return x2(is.create(u,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(u){if(u.length!==0)return u.map(d=>function(m){return{field:cd(m.field),direction:oZ(m.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=TC(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:t,parent:r}}function rZ(n){let e=XQ(n.parent),t=n.structuredQuery,i=t.from?t.from.length:0,r=null;if(i>0){$t(i===1);let d=t.from[0];d.allDescendants?r=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(f){let m=C2(f);return m instanceof is&&r2(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(m=>function(v){return new Tc(ud(v.field),function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,xv(m)?null:m}(t.limit));let l=null;t.startAt&&(l=function(f){let m=!!f.before,y=f.values||[];return new Za(y,m)}(t.startAt));let u=null;return t.endAt&&(u=function(f){let m=!f.before,y=f.values||[];return new Za(y,m)}(t.endAt)),RQ(e,r,o,s,a,"F",l,u)}function sZ(n,e){let t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ze()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function C2(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let i=ud(t.unaryFilter.field);return Ln.create(i,"==",{doubleValue:NaN});case"IS_NULL":let r=ud(t.unaryFilter.field);return Ln.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=ud(t.unaryFilter.field);return Ln.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=ud(t.unaryFilter.field);return Ln.create(o,"!=",{nullValue:"NULL_VALUE"});default:return ze()}}(n):n.fieldFilter!==void 0?function(t){return Ln.create(ud(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ze()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return is.create(t.compositeFilter.filters.map(i=>C2(i)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return ze()}}(t.compositeFilter.op))}(n):ze()}function oZ(n){return KQ[n]}function aZ(n){return YQ[n]}function lZ(n){return QQ[n]}function cd(n){return{fieldPath:n.canonicalString()}}function ud(n){return ur.fromServerFormat(n.fieldPath)}function x2(n){return n instanceof Ln?function(t){if(t.op==="=="){if(IF(t.value))return{unaryFilter:{field:cd(t.field),op:"IS_NAN"}};if(wF(t.value))return{unaryFilter:{field:cd(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(IF(t.value))return{unaryFilter:{field:cd(t.field),op:"IS_NOT_NAN"}};if(wF(t.value))return{unaryFilter:{field:cd(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:cd(t.field),op:aZ(t.op),value:t.value}}}(n):n instanceof is?function(t){let i=t.getFilters().map(r=>x2(r));return i.length===1?i[0]:{compositeFilter:{op:lZ(t.op),filters:i}}}(n):ze()}function cZ(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function A2(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var sp=class n{constructor(e,t,i,r,s=tt.min(),o=tt.min(),a=pi.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var SC=class{constructor(e){this.ct=e}};function uZ(n){let e=rZ({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?tv(e,e.limit,"L"):e}var av=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(ln(e.integerValue));else if("doubleValue"in e){let i=ln(e.doubleValue);isNaN(i)?this.dt(t,13):(this.dt(t,15),Jf(i)?t.At(0):t.At(i))}else if("timestampValue"in e){let i=e.timestampValue;this.dt(t,20),typeof i=="string"&&(i=Ho(i)),t.Rt(`${i.seconds||""}`),t.At(i.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Qa(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let i=e.geoPointValue;this.dt(t,45),t.At(i.latitude||0),t.At(i.longitude||0)}else"mapValue"in e?t2(e)?this.dt(t,Number.MAX_SAFE_INTEGER):e2(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):ze()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let i=e.fields||{};this.dt(t,55);for(let r of Object.keys(i))this.Vt(r,t),this.Tt(i[r],t)}wt(e,t){var i,r;let s=e.fields||{};this.dt(t,53);let o="value",a=((r=(i=s[o].arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.length)||0;this.dt(t,15),t.At(ln(a)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let i=e.values||[];this.dt(t,50);for(let r of i)this.Tt(r,t)}yt(e,t){this.dt(t,37),Ve.fromName(e).path.forEach(i=>{this.dt(t,60),this.Dt(i,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};av.vt=new av;var CC=class{constructor(){this.un=new xC}addToCollectionParentIndex(e,t){return this.un.add(t),ge.resolve()}getCollectionParents(e,t){return ge.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return ge.resolve()}deleteFieldIndex(e,t){return ge.resolve()}deleteAllFieldIndexes(e){return ge.resolve()}createTargetIndexes(e,t){return ge.resolve()}getDocumentsMatchingTarget(e,t){return ge.resolve(null)}getIndexType(e,t){return ge.resolve(0)}getFieldIndexes(e,t){return ge.resolve([])}getNextCollectionGroupToUpdate(e){return ge.resolve(null)}getMinOffset(e,t){return ge.resolve(_c.min())}getMinOffsetFromCollectionGroup(e,t){return ge.resolve(_c.min())}updateCollectionGroup(e,t,i){return ge.resolve()}updateIndexEntries(e,t){return ge.resolve()}},xC=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new fi(cn.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new fi(cn.comparator)).toArray()}};var Epe=new Uint8Array(0);var Us=class n{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Us.DEFAULT_COLLECTION_PERCENTILE=10,Us.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Us.DEFAULT=new Us(41943040,Us.DEFAULT_COLLECTION_PERCENTILE,Us.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Us.DISABLED=new Us(-1,0,0);var op=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var AC=class{constructor(){this.changes=new Xa(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ns.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let i=this.changes.get(t);return i!==void 0?ge.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var DC=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var PC=class{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&Xf(i.mutation,r,Mr.empty(),gn.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,_t()).next(()=>i))}getLocalViewOfDocuments(e,t,i=_t()){let r=mc();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let o=Yf();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let i=mc();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,_t()))}populateOverlays(e,t,i){let r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,i,r){let s=Wo(),o=Zf(),a=function(){return Zf()}();return t.forEach((l,u)=>{let d=i.get(u.key);r.has(u.key)&&(d===void 0||d.mutation instanceof Hs)?s=s.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),Xf(d.mutation,u,d.mutation.getFieldMask(),gn.now())):o.set(u.key,Mr.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((u,d)=>o.set(u,d)),t.forEach((u,d)=>{var f;return a.set(u,new DC(d,(f=o.get(u))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){let i=Zf(),r=new yn((o,a)=>o-a),s=_t();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let u=t.get(l);if(u===null)return;let d=i.get(l)||Mr.empty();d=a.applyToLocalView(u,d),i.set(l,d);let f=(r.get(a.batchId)||_t()).add(l);r=r.insert(a.batchId,f)})}).next(()=>{let o=[],a=r.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),u=l.key,d=l.value,f=h2();d.forEach(m=>{if(!s.has(m)){let y=_2(t.get(m),i.get(m));y!==null&&f.set(m,y),s=s.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return ge.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,r){return function(o){return Ve.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ax(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,r):this.getDocumentsMatchingCollectionQuery(e,t,i,r)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{let o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):ge.resolve(mc()),a=-1,l=s;return o.next(u=>ge.forEach(u,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),s.get(d)?ge.resolve():this.remoteDocumentCache.getEntry(e,d).next(m=>{l=l.insert(d,m)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,l,u,_t())).next(d=>({batchId:a,changes:d2(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ve(t)).next(i=>{let r=Yf();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i,r){let s=t.collectionGroup,o=Yf();return this.indexManager.getCollectionParents(e,s).next(a=>ge.forEach(a,l=>{let u=function(f,m){return new qo(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,i,r).next(d=>{d.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,r))).next(o=>{s.forEach((l,u)=>{let d=u.getKey();o.get(d)===null&&(o=o.insert(d,ns.newInvalidDocument(d)))});let a=Yf();return o.forEach((l,u)=>{let d=s.get(l);d!==void 0&&Xf(d.mutation,u,Mr.empty(),gn.now()),Rv(t,u)&&(a=a.insert(l,u))}),a})}};var RC=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return ge.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:Gs(r.createTime)}}(t)),ge.resolve()}getNamedQuery(e,t){return ge.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(r){return{name:r.name,query:uZ(r.bundledQuery),readTime:Gs(r.readTime)}}(t)),ge.resolve()}};var MC=class{constructor(){this.overlays=new yn(Ve.comparator),this.Ir=new Map}getOverlay(e,t){return ge.resolve(this.overlays.get(t))}getOverlays(e,t){let i=mc();return ge.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.ht(e,t,s)}),ge.resolve()}removeOverlaysForBatchId(e,t,i){let r=this.Ir.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(i)),ge.resolve()}getOverlaysForCollection(e,t,i){let r=mc(),s=t.length+1,o=new Ve(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&l.largestBatchId>i&&r.set(l.getKey(),l)}return ge.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new yn((u,d)=>u-d),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>i){let d=s.get(u.largestBatchId);d===null&&(d=mc(),s=s.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}let a=mc(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=r)););return ge.resolve(a)}ht(e,t,i){let r=this.overlays.get(i.key);if(r!==null){let o=this.Ir.get(r.largestBatchId).delete(i.key);this.Ir.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new gC(t,i));let s=this.Ir.get(t);s===void 0&&(s=_t(),this.Ir.set(t,s)),this.Ir.set(t,s.add(i.key))}};var kC=class{constructor(){this.sessionToken=pi.EMPTY_BYTE_STRING}getSessionToken(e){return ge.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ge.resolve()}};var ap=class{constructor(){this.Tr=new fi(kn.Er),this.dr=new fi(kn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let i=new kn(e,t);this.Tr=this.Tr.add(i),this.dr=this.dr.add(i)}Rr(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.Vr(new kn(e,t))}mr(e,t){e.forEach(i=>this.removeReference(i,t))}gr(e){let t=new Ve(new cn([])),i=new kn(t,e),r=new kn(t,e+1),s=[];return this.dr.forEachInRange([i,r],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new Ve(new cn([])),i=new kn(t,e),r=new kn(t,e+1),s=_t();return this.dr.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new kn(e,0),i=this.Tr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}},kn=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Ve.comparator(e.key,t.key)||Rt(e.wr,t.wr)}static Ar(e,t){return Rt(e.wr,t.wr)||Ve.comparator(e.key,t.key)}};var LC=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new fi(kn.Er)}checkEmpty(e){return ge.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new pC(s,t,i,r);this.mutationQueue.push(o);for(let a of r)this.br=this.br.add(new kn(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return ge.resolve(o)}lookupMutationBatch(e,t){return ge.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=this.vr(i),s=r<0?0:r;return ge.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return ge.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return ge.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let i=new kn(t,0),r=new kn(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([i,r],o=>{let a=this.Dr(o.wr);s.push(a)}),ge.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new fi(Rt);return t.forEach(r=>{let s=new kn(r,0),o=new kn(r,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],a=>{i=i.add(a.wr)})}),ge.resolve(this.Cr(i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=i;Ve.isDocumentKey(s)||(s=s.child(""));let o=new kn(new Ve(s),0),a=new fi(Rt);return this.br.forEachWhile(l=>{let u=l.key.path;return!!i.isPrefixOf(u)&&(u.length===r&&(a=a.add(l.wr)),!0)},o),ge.resolve(this.Cr(a))}Cr(e){let t=[];return e.forEach(i=>{let r=this.Dr(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){$t(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let i=this.br;return ge.forEach(t.mutations,r=>{let s=new kn(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.br=i})}On(e){}containsKey(e,t){let i=new kn(t,0),r=this.br.firstAfterOrEqual(i);return ge.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ge.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var OC=class{constructor(e){this.Mr=e,this.docs=function(){return new yn(Ve.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let i=t.key,r=this.docs.get(i),s=r?r.size:0,o=this.Mr(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let i=this.docs.get(t);return ge.resolve(i?i.document.mutableCopy():ns.newInvalidDocument(t))}getEntries(e,t){let i=Wo();return t.forEach(r=>{let s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():ns.newInvalidDocument(r))}),ge.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let s=Wo(),o=t.path,a=new Ve(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:u,value:{document:d}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||EQ(_Q(d),i)<=0||(r.has(d.key)||Rv(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return ge.resolve(s)}getAllFromCollectionGroup(e,t,i,r){ze()}Or(e,t){return ge.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new NC(this)}getSize(e){return ge.resolve(this.size)}},NC=class extends AC{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(i)}),ge.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var FC=class{constructor(e){this.persistence=e,this.Nr=new Xa(t=>Cx(t),xx),this.lastRemoteSnapshotVersion=tt.min(),this.highestTargetId=0,this.Lr=0,this.Br=new ap,this.targetCount=0,this.kr=op.Bn()}forEachTarget(e,t){return this.Nr.forEach((i,r)=>t(r)),ge.resolve()}getLastRemoteSnapshotVersion(e){return ge.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ge.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),ge.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.Lr&&(this.Lr=t),ge.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new op(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,ge.resolve()}updateTargetData(e,t){return this.Kn(t),ge.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,ge.resolve()}removeTargets(e,t,i){let r=0,s=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),ge.waitFor(s).next(()=>r)}getTargetCount(e){return ge.resolve(this.targetCount)}getTargetData(e,t){let i=this.Nr.get(t)||null;return ge.resolve(i)}addMatchingKeys(e,t,i){return this.Br.Rr(t,i),ge.resolve()}removeMatchingKeys(e,t,i){this.Br.mr(t,i);let r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),ge.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),ge.resolve()}getMatchingKeysForTargetId(e,t){let i=this.Br.yr(t);return ge.resolve(i)}containsKey(e,t){return ge.resolve(this.Br.containsKey(t))}};var VC=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new XF(0),this.Kr=!1,this.Kr=!0,this.$r=new kC,this.referenceDelegate=e(this),this.Ur=new FC(this),this.indexManager=new CC,this.remoteDocumentCache=function(r){return new OC(r)}(i=>this.referenceDelegate.Wr(i)),this.serializer=new SC(t),this.Gr=new RC(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new MC,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.qr[e.toKey()];return i||(i=new LC(t,this.referenceDelegate),this.qr[e.toKey()]=i),i}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,i){ke("MemoryPersistence","Starting transaction:",e);let r=new BC(this.Qr.next());return this.referenceDelegate.zr(),i(r).next(s=>this.referenceDelegate.jr(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Hr(e,t){return ge.or(Object.values(this.qr).map(i=>()=>i.containsKey(e,t)))}},BC=class extends ZS{constructor(e){super(),this.currentSequenceNumber=e}},UC=class n{constructor(e){this.persistence=e,this.Jr=new ap,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw ze()}addReference(e,t,i){return this.Jr.addReference(i,t),this.Xr.delete(i.toString()),ge.resolve()}removeReference(e,t,i){return this.Jr.removeReference(i,t),this.Xr.add(i.toString()),ge.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),ge.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(r=>this.Xr.add(r.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.Xr.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ge.forEach(this.Xr,i=>{let r=Ve.fromPath(i);return this.ei(e,r).next(s=>{s||t.removeEntry(r,tt.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(i=>{i?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return ge.or([()=>ge.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var $C=class n{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.$i=i,this.Ui=r}static Wi(e,t){let i=_t(),r=_t();for(let s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new n(e,t.fromCache,i,r)}};var jC=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var GC=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return ZO()?8:wQ(Yn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,i,r){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,r,i).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new jC;return this.Xi(e,t,o).next(a=>{if(s.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>s.result)}es(e,t,i,r){return i.documentReadCount<this.ji?(Kf()<=vt.DEBUG&&ke("QueryEngine","SDK will not create cache indexes for query:",ld(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),ge.resolve()):(Kf()<=vt.DEBUG&&ke("QueryEngine","Query:",ld(t),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.Hi*r?(Kf()<=vt.DEBUG&&ke("QueryEngine","The SDK decides to create cache indexes for query:",ld(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,js(t))):ge.resolve())}Yi(e,t){if(xF(t))return ge.resolve(null);let i=js(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=tv(t,null,"F"),i=js(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{let o=_t(...s);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(l=>{let u=this.ts(t,a);return this.ns(t,u,o,l.readTime)?this.Yi(e,tv(t,null,"F")):this.rs(e,u,t,l)}))})))}Zi(e,t,i,r){return xF(t)||r.isEqual(tt.min())?ge.resolve(null):this.Ji.getDocuments(e,i).next(s=>{let o=this.ts(t,s);return this.ns(t,o,i,r)?ge.resolve(null):(Kf()<=vt.DEBUG&&ke("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ld(t)),this.rs(e,o,t,vQ(r,-1)).next(a=>a))})}ts(e,t){let i=new fi(c2(e));return t.forEach((r,s)=>{Rv(e,s)&&(i=i.add(s))}),i}ns(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Xi(e,t,i){return Kf()<=vt.DEBUG&&ke("QueryEngine","Using full collection scan to execute query:",ld(t)),this.Ji.getDocumentsMatchingQuery(e,t,_c.min(),i)}rs(e,t,i,r){return this.Ji.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var zC=class{constructor(e,t,i,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new yn(Rt),this._s=new Xa(s=>Cx(s),xx),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(i)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new PC(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function dZ(n,e,t,i){return new zC(n,e,t,i)}function D2(n,e){return U(this,null,function*(){let t=Qe(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,t.ls(e),t.mutationQueue.getAllMutationBatches(i))).next(s=>{let o=[],a=[],l=_t();for(let u of r){o.push(u.batchId);for(let d of u.mutations)l=l.add(d.key)}for(let u of s){a.push(u.batchId);for(let d of u.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(i,l).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:a}))})})})}function hZ(n,e){let t=Qe(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{let r=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,u,d){let f=u.batch,m=f.keys(),y=ge.resolve();return m.forEach(v=>{y=y.next(()=>d.getEntry(l,v)).next(E=>{let T=u.docVersions.get(v);$t(T!==null),E.version.compareTo(T)<0&&(f.applyToRemoteDocument(E,u),E.isValidDocument()&&(E.setReadTime(u.commitVersion),d.addEntry(E)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(a){let l=_t();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function P2(n){let e=Qe(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function fZ(n,e){let t=Qe(n),i=e.snapshotVersion,r=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});r=t.os;let a=[];e.targetChanges.forEach((d,f)=>{let m=r.get(f);if(!m)return;a.push(t.Ur.removeMatchingKeys(s,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(s,d.addedDocuments,f)));let y=m.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(pi.EMPTY_BYTE_STRING,tt.min()).withLastLimboFreeSnapshotVersion(tt.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,i)),r=r.insert(f,y),function(E,T,C){return E.resumeToken.approximateByteSize()===0||T.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=3e8?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0}(m,y,d)&&a.push(t.Ur.updateTargetData(s,y))});let l=Wo(),u=_t();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(pZ(s,o,e.documentUpdates).next(d=>{l=d.Ps,u=d.Is})),!i.isEqual(tt.min())){let d=t.Ur.getLastRemoteSnapshotVersion(s).next(f=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(d)}return ge.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,u)).next(()=>l)}).then(s=>(t.os=r,s))}function pZ(n,e,t){let i=_t(),r=_t();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let o=Wo();return t.forEach((a,l)=>{let u=s.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(tt.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):ke("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{Ps:o,Is:r}})}function mZ(n,e){let t=Qe(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function gZ(n,e){let t=Qe(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.Ur.getTargetData(i,e).next(s=>s?(r=s,ge.resolve(r)):t.Ur.allocateTargetId(i).next(o=>(r=new sp(e,o,"TargetPurposeListen",i.currentSequenceNumber),t.Ur.addTargetData(i,r).next(()=>r))))}).then(i=>{let r=t.os.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.os=t.os.insert(i.targetId,i),t._s.set(e,i.targetId)),i})}function HC(n,e,t){return U(this,null,function*(){let i=Qe(n),r=i.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!yp(o))throw o;ke("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}i.os=i.os.remove(e),i._s.delete(r.target)})}function VF(n,e,t){let i=Qe(n),r=tt.min(),s=_t();return i.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,d){let f=Qe(l),m=f._s.get(d);return m!==void 0?ge.resolve(f.os.get(m)):f.Ur.getTargetData(u,d)}(i,o,js(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>i.ss.getDocumentsMatchingQuery(o,e,t?r:tt.min(),t?s:_t())).next(a=>(yZ(i,kQ(e),a),{documents:a,Ts:s})))}function yZ(n,e,t){let i=n.us.get(e)||tt.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.us.set(e,i)}var lv=class{constructor(){this.activeTargetIds=BQ()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var qC=class{constructor(){this.so=new lv,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,i){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new lv,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var WC=class{_o(e){}shutdown(){}};var cv=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){ke("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){ke("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var zy=null;function US(){return zy===null?zy=function(){return 268435456+Math.round(2147483648*Math.random())}():zy++,"0x"+zy.toString(16)}var vZ={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var KC=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var hi="WebChannelConnection",YC=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let i=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=i+"://"+t.host,this.vo=`projects/${r}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${s}`}get Fo(){return!1}Mo(t,i,r,s,o){let a=US(),l=this.xo(t,i.toUriEncodedString());ke("RestConnection",`Sending RPC '${t}' ${a}:`,l,r);let u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,s,o),this.No(t,l,u,r).then(d=>(ke("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw md("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",r),d})}Lo(t,i,r,s,o,a){return this.Mo(t,i,r,s,o)}Oo(t,i,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Cd}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((s,o)=>t[o]=s),r&&r.headers.forEach((s,o)=>t[o]=s)}xo(t,i){let r=vZ[t];return`${this.Do}/v1/${i}:${r}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,i,r){let s=US();return new Promise((o,a)=>{let l=new LS;l.setWithCredentials(!0),l.listenOnce(OS.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Wf.NO_ERROR:let d=l.getResponseJson();ke(hi,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(d)),o(d);break;case Wf.TIMEOUT:ke(hi,`RPC '${e}' ${s} timed out`),a(new we(se.DEADLINE_EXCEEDED,"Request time out"));break;case Wf.HTTP_ERROR:let f=l.getStatus();if(ke(hi,`RPC '${e}' ${s} failed with status:`,f,"response text:",l.getResponseText()),f>0){let m=l.getResponseJson();Array.isArray(m)&&(m=m[0]);let y=m?.error;if(y&&y.status&&y.message){let v=function(T){let C=T.toLowerCase().replace(/_/g,"-");return Object.values(se).indexOf(C)>=0?C:se.UNKNOWN}(y.status);a(new we(v,y.message))}else a(new we(se.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new we(se.UNAVAILABLE,"Connection failed."));break;default:ze()}}finally{ke(hi,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(r);ke(hi,`RPC '${e}' ${s} sending request:`,r),l.send(t,"POST",u,i,15)})}Bo(e,t,i){let r=US(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=VS(),a=FS(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,i),l.encodeInitMessageHeaders=!0;let d=s.join("");ke(hi,`Creating RPC '${e}' stream ${r}: ${d}`,l);let f=o.createWebChannel(d,l),m=!1,y=!1,v=new KC({Io:T=>{y?ke(hi,`Not sending because RPC '${e}' stream ${r} is closed:`,T):(m||(ke(hi,`Opening RPC '${e}' stream ${r} transport.`),f.open(),m=!0),ke(hi,`RPC '${e}' stream ${r} sending:`,T),f.send(T))},To:()=>f.close()}),E=(T,C,D)=>{T.listen(C,P=>{try{D(P)}catch(V){setTimeout(()=>{throw V},0)}})};return E(f,ad.EventType.OPEN,()=>{y||(ke(hi,`RPC '${e}' stream ${r} transport opened.`),v.yo())}),E(f,ad.EventType.CLOSE,()=>{y||(y=!0,ke(hi,`RPC '${e}' stream ${r} transport closed`),v.So())}),E(f,ad.EventType.ERROR,T=>{y||(y=!0,md(hi,`RPC '${e}' stream ${r} transport errored:`,T),v.So(new we(se.UNAVAILABLE,"The operation could not be completed")))}),E(f,ad.EventType.MESSAGE,T=>{var C;if(!y){let D=T.data[0];$t(!!D);let P=D,V=P.error||((C=P[0])===null||C===void 0?void 0:C.error);if(V){ke(hi,`RPC '${e}' stream ${r} received error:`,V);let G=V.status,H=function(R){let M=Mn[R];if(M!==void 0)return T2(M)}(G),A=V.message;H===void 0&&(H=se.INTERNAL,A="Unknown error status: "+G+" with message "+V.message),y=!0,v.So(new we(H,A)),f.close()}else ke(hi,`RPC '${e}' stream ${r} received:`,D),v.bo(D)}}),E(a,NS.STAT_EVENT,T=>{T.stat===jy.PROXY?ke(hi,`RPC '${e}' stream ${r} detected buffering proxy`):T.stat===jy.NOPROXY&&ke(hi,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{v.wo()},0),v}};function $S(){return typeof document<"u"?document:null}function Mv(n){return new EC(n,!0)}var uv=class{constructor(e,t,i=1e3,r=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=i,this.qo=r,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),i=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-i);r>0&&ke("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var dv=class{constructor(e,t,i,r,s,o,a,l){this.ui=e,this.Ho=i,this.Jo=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new uv(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return U(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return U(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return U(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===se.RESOURCE_EXHAUSTED?(zo(t.toString()),zo("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===se.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.Yo===t&&this.P_(i,r)},i=>{e(()=>{let r=new we(se.UNKNOWN,"Fetching auth token failed: "+i.message);return this.I_(r)})})}P_(e,t){let i=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{i(()=>this.listener.Eo())}),this.stream.Ro(()=>{i(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(r=>{i(()=>this.I_(r))}),this.stream.onMessage(r=>{i(()=>++this.e_==1?this.E_(r):this.onNext(r))})}i_(){this.state=5,this.t_.Go(()=>U(this,null,function*(){this.state=0,this.start()}))}I_(e){return ke("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(ke("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},QC=class extends dv{constructor(e,t,i,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=JQ(this.serializer,e),i=function(s){if(!("targetChange"in s))return tt.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?tt.min():o.readTime?Gs(o.readTime):tt.min()}(e);return this.listener.d_(t,i)}A_(e){let t={};t.database=bC(this.serializer),t.addTarget=function(s,o){let a,l=o.target;if(a=uC(l)?{documents:nZ(s,l)}:{query:iZ(s,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=w2(s,o.resumeToken);let u=TC(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(tt.min())>0){a.readTime=ov(s,o.snapshotVersion.toTimestamp());let u=TC(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);let i=sZ(this.serializer,e);i&&(t.labels=i),this.a_(t)}R_(e){let t={};t.database=bC(this.serializer),t.removeTarget=e,this.a_(t)}},ZC=class extends dv{constructor(e,t,i,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return $t(!!e.streamToken),this.lastStreamToken=e.streamToken,$t(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){$t(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=tZ(e.writeResults,e.commitTime),i=Gs(e.commitTime);return this.listener.g_(i,t)}p_(){let e={};e.database=bC(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(i=>eZ(this.serializer,i))};this.a_(t)}};var XC=class extends class{}{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new we(se.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,i,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,wC(t,i),r,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===se.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new we(se.UNKNOWN,s.toString())})}Lo(e,t,i,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,wC(t,i),r,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===se.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new we(se.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},JC=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(zo(t),this.D_=!1):ke("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var ex=class{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{i.enqueueAndForget(()=>U(this,null,function*(){Sc(this)&&(ke("RemoteStore","Restarting streams for network reachability change."),yield function(l){return U(this,null,function*(){let u=Qe(l);u.L_.add(4),yield vp(u),u.q_.set("Unknown"),u.L_.delete(4),yield kv(u)})}(this))}))}),this.q_=new JC(i,r)}};function kv(n){return U(this,null,function*(){if(Sc(n))for(let e of n.B_)yield e(!0)})}function vp(n){return U(this,null,function*(){for(let e of n.B_)yield e(!1)})}function R2(n,e){let t=Qe(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Lx(t)?kx(t):xd(t).r_()&&Mx(t,e))}function Rx(n,e){let t=Qe(n),i=xd(t);t.N_.delete(e),i.r_()&&M2(t,e),t.N_.size===0&&(i.r_()?i.o_():Sc(t)&&t.q_.set("Unknown"))}function Mx(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(tt.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}xd(n).A_(e)}function M2(n,e){n.Q_.xe(e),xd(n).R_(e)}function kx(n){n.Q_=new _C({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),xd(n).start(),n.q_.v_()}function Lx(n){return Sc(n)&&!xd(n).n_()&&n.N_.size>0}function Sc(n){return Qe(n).L_.size===0}function k2(n){n.Q_=void 0}function _Z(n){return U(this,null,function*(){n.q_.set("Online")})}function EZ(n){return U(this,null,function*(){n.N_.forEach((e,t)=>{Mx(n,e)})})}function TZ(n,e){return U(this,null,function*(){k2(n),Lx(n)?(n.q_.M_(e),kx(n)):n.q_.set("Unknown")})}function wZ(n,e,t){return U(this,null,function*(){if(n.q_.set("Online"),e instanceof rv&&e.state===2&&e.cause)try{yield function(r,s){return U(this,null,function*(){let o=s.cause;for(let a of s.targetIds)r.N_.has(a)&&(yield r.remoteSyncer.rejectListen(a,o),r.N_.delete(a),r.Q_.removeTarget(a))})}(n,e)}catch(i){ke("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),yield hv(n,i)}else if(e instanceof fd?n.Q_.Ke(e):e instanceof iv?n.Q_.He(e):n.Q_.We(e),!t.isEqual(tt.min()))try{let i=yield P2(n.localStore);t.compareTo(i)>=0&&(yield function(s,o){let a=s.Q_.rt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){let d=s.N_.get(u);d&&s.N_.set(u,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{let d=s.N_.get(l);if(!d)return;s.N_.set(l,d.withResumeToken(pi.EMPTY_BYTE_STRING,d.snapshotVersion)),M2(s,l);let f=new sp(d.target,l,u,d.sequenceNumber);Mx(s,f)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(i){ke("RemoteStore","Failed to raise snapshot:",i),yield hv(n,i)}})}function hv(n,e,t){return U(this,null,function*(){if(!yp(e))throw e;n.L_.add(1),yield vp(n),n.q_.set("Offline"),t||(t=()=>P2(n.localStore)),n.asyncQueue.enqueueRetryable(()=>U(this,null,function*(){ke("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield kv(n)}))})}function L2(n,e){return e().catch(t=>hv(n,t,e))}function Lv(n){return U(this,null,function*(){let e=Qe(n),t=tl(e),i=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;IZ(e);)try{let r=yield mZ(e.localStore,i);if(r===null){e.O_.length===0&&t.o_();break}i=r.batchId,bZ(e,r)}catch(r){yield hv(e,r)}O2(e)&&N2(e)})}function IZ(n){return Sc(n)&&n.O_.length<10}function bZ(n,e){n.O_.push(e);let t=tl(n);t.r_()&&t.V_&&t.m_(e.mutations)}function O2(n){return Sc(n)&&!tl(n).n_()&&n.O_.length>0}function N2(n){tl(n).start()}function SZ(n){return U(this,null,function*(){tl(n).p_()})}function CZ(n){return U(this,null,function*(){let e=tl(n);for(let t of n.O_)e.m_(t.mutations)})}function xZ(n,e,t){return U(this,null,function*(){let i=n.O_.shift(),r=mC.from(i,e,t);yield L2(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield Lv(n)})}function AZ(n,e){return U(this,null,function*(){e&&tl(n).V_&&(yield function(i,r){return U(this,null,function*(){if(function(o){return HQ(o)&&o!==se.ABORTED}(r.code)){let s=i.O_.shift();tl(i).s_(),yield L2(i,()=>i.remoteSyncer.rejectFailedWrite(s.batchId,r)),yield Lv(i)}})}(n,e)),O2(n)&&N2(n)})}function BF(n,e){return U(this,null,function*(){let t=Qe(n);t.asyncQueue.verifyOperationInProgress(),ke("RemoteStore","RemoteStore received new credentials");let i=Sc(t);t.L_.add(3),yield vp(t),i&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield kv(t)})}function DZ(n,e){return U(this,null,function*(){let t=Qe(n);e?(t.L_.delete(2),yield kv(t)):e||(t.L_.add(2),yield vp(t),t.q_.set("Unknown"))})}function xd(n){return n.K_||(n.K_=function(t,i,r){let s=Qe(t);return s.w_(),new QC(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Eo:_Z.bind(null,n),Ro:EZ.bind(null,n),mo:TZ.bind(null,n),d_:wZ.bind(null,n)}),n.B_.push(e=>U(this,null,function*(){e?(n.K_.s_(),Lx(n)?kx(n):n.q_.set("Unknown")):(yield n.K_.stop(),k2(n))}))),n.K_}function tl(n){return n.U_||(n.U_=function(t,i,r){let s=Qe(t);return s.w_(),new ZC(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:SZ.bind(null,n),mo:AZ.bind(null,n),f_:CZ.bind(null,n),g_:xZ.bind(null,n)}),n.B_.push(e=>U(this,null,function*(){e?(n.U_.s_(),yield Lv(n)):(yield n.U_.stop(),n.O_.length>0&&(ke("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var tx=class n{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new ts,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,s){let o=Date.now()+i,a=new n(e,t,o,r,s);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new we(se.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Ox(n,e){if(zo("AsyncQueue",`${e}: ${n}`),yp(n))return new we(se.UNAVAILABLE,`${e}: ${n}`);throw n}var fv=class n{constructor(e){this.comparator=e?(t,i)=>e(t,i)||Ve.comparator(t.key,i.key):(t,i)=>Ve.comparator(t.key,i.key),this.keyedMap=Yf(),this.sortedSet=new yn(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let i=new n;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}};var pv=class{constructor(){this.W_=new yn(Ve.comparator)}track(e){let t=e.doc.key,i=this.W_.get(t);i?e.type!==0&&i.type===3?this.W_=this.W_.insert(t,e):e.type===3&&i.type!==1?this.W_=this.W_.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.W_=this.W_.remove(t):e.type===1&&i.type===2?this.W_=this.W_.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):ze():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,i)=>{e.push(i)}),e}},wd=class n{constructor(e,t,i,r,s,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,i,r,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,fv.emptySet(t),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Pv(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}};var nx=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},ix=class{constructor(){this.queries=UF(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,i){let r=Qe(t),s=r.queries;r.queries=UF(),s.forEach((o,a)=>{for(let l of a.j_)l.onError(i)})})(this,new we(se.ABORTED,"Firestore shutting down"))}};function UF(){return new Xa(n=>l2(n),Pv)}function Nx(n,e){return U(this,null,function*(){let t=Qe(n),i=3,r=e.query,s=t.queries.get(r);s?!s.H_()&&e.J_()&&(i=2):(s=new nx,i=e.J_()?0:1);try{switch(i){case 0:s.z_=yield t.onListen(r,!0);break;case 1:s.z_=yield t.onListen(r,!1);break;case 2:yield t.onFirstRemoteStoreListen(r)}}catch(o){let a=Ox(o,`Initialization of query '${ld(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&Vx(t)})}function Fx(n,e){return U(this,null,function*(){let t=Qe(n),i=e.query,r=3,s=t.queries.get(i);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?r=e.J_()?0:1:!s.H_()&&e.J_()&&(r=2))}switch(r){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}})}function PZ(n,e){let t=Qe(n),i=!1;for(let r of e){let s=r.query,o=t.queries.get(s);if(o){for(let a of o.j_)a.X_(r)&&(i=!0);o.z_=r}}i&&Vx(t)}function RZ(n,e,t){let i=Qe(n),r=i.queries.get(e);if(r)for(let s of r.j_)s.onError(t);i.queries.delete(e)}function Vx(n){n.Y_.forEach(e=>{e.next()})}var rx,$F;($F=rx||(rx={})).ea="default",$F.Cache="cache";var lp=class{constructor(e,t,i){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=i||{}}X_(e){if(!this.options.includeMetadataChanges){let i=[];for(let r of e.docChanges)r.type!==3&&i.push(r);e=new wd(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let i=t!=="Offline";return(!this.options._a||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=wd.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==rx.Cache}};var mv=class{constructor(e){this.key=e}},gv=class{constructor(e){this.key=e}},sx=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=_t(),this.mutatedKeys=_t(),this.Aa=c2(e),this.Ra=new fv(this.Aa)}get Va(){return this.Ta}ma(e,t){let i=t?t.fa:new pv,r=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1,l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((d,f)=>{let m=r.get(d),y=Rv(this.query,f)?f:null,v=!!m&&this.mutatedKeys.has(m.key),E=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations),T=!1;m&&y?m.data.isEqual(y.data)?v!==E&&(i.track({type:3,doc:y}),T=!0):this.ga(m,y)||(i.track({type:2,doc:y}),T=!0,(l&&this.Aa(y,l)>0||u&&this.Aa(y,u)<0)&&(a=!0)):!m&&y?(i.track({type:0,doc:y}),T=!0):m&&!y&&(i.track({type:1,doc:m}),T=!0,(l||u)&&(a=!0)),T&&(y?(o=o.add(y),s=E?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),i.track({type:1,doc:d})}return{Ra:o,fa:i,ns:a,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,r){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((d,f)=>function(y,v){let E=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ze()}};return E(y)-E(v)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(i),r=r!=null&&r;let a=t&&!r?this.ya():[],l=this.da.size===0&&this.current&&!r?1:0,u=l!==this.Ea;return this.Ea=l,o.length!==0||u?{snapshot:new wd(this.query,e.Ra,s,o,e.mutatedKeys,l===0,u,!1,!!i&&i.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new pv,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=_t(),this.Ra.forEach(i=>{this.Sa(i.key)&&(this.da=this.da.add(i.key))});let t=[];return e.forEach(i=>{this.da.has(i)||t.push(new gv(i))}),this.da.forEach(i=>{e.has(i)||t.push(new mv(i))}),t}ba(e){this.Ta=e.Ts,this.da=_t();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return wd.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},ox=class{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}},ax=class{constructor(e){this.key=e,this.va=!1}},lx=class{constructor(e,t,i,r,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Xa(a=>l2(a),Pv),this.Ma=new Map,this.xa=new Set,this.Oa=new yn(Ve.comparator),this.Na=new Map,this.La=new ap,this.Ba={},this.ka=new Map,this.qa=op.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function MZ(n,e,t=!0){return U(this,null,function*(){let i=j2(n),r,s=i.Fa.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.Da()):r=yield F2(i,e,t,!0),r})}function kZ(n,e){return U(this,null,function*(){let t=j2(n);yield F2(t,e,!0,!1)})}function F2(n,e,t,i){return U(this,null,function*(){let r=yield gZ(n.localStore,js(e)),s=r.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return i&&(a=yield LZ(n,e,s,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&R2(n.remoteStore,r),a})}function LZ(n,e,t,i,r){return U(this,null,function*(){n.Ka=(f,m,y)=>function(E,T,C,D){return U(this,null,function*(){let P=T.view.ma(C);P.ns&&(P=yield VF(E.localStore,T.query,!1).then(({documents:A})=>T.view.ma(A,P)));let V=D&&D.targetChanges.get(T.targetId),G=D&&D.targetMismatches.get(T.targetId)!=null,H=T.view.applyChanges(P,E.isPrimaryClient,V,G);return GF(E,T.targetId,H.wa),H.snapshot})}(n,f,m,y);let s=yield VF(n.localStore,e,!0),o=new sx(e,s.Ts),a=o.ma(s.documents),l=rp.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",r),u=o.applyChanges(a,n.isPrimaryClient,l);GF(n,t,u.wa);let d=new ox(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),u.snapshot})}function OZ(n,e,t){return U(this,null,function*(){let i=Qe(n),r=i.Fa.get(e),s=i.Ma.get(r.targetId);if(s.length>1)return i.Ma.set(r.targetId,s.filter(o=>!Pv(o,e))),void i.Fa.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||(yield HC(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),t&&Rx(i.remoteStore,r.targetId),cx(i,r.targetId)}).catch(gp))):(cx(i,r.targetId),yield HC(i.localStore,r.targetId,!0))})}function NZ(n,e){return U(this,null,function*(){let t=Qe(n),i=t.Fa.get(e),r=t.Ma.get(i.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),Rx(t.remoteStore,i.targetId))})}function FZ(n,e,t){return U(this,null,function*(){let i=zZ(n);try{let r=yield function(o,a){let l=Qe(o),u=gn.now(),d=a.reduce((y,v)=>y.add(v.key),_t()),f,m;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let v=Wo(),E=_t();return l.cs.getEntries(y,d).next(T=>{v=T,v.forEach((C,D)=>{D.isValidDocument()||(E=E.add(C))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,v)).next(T=>{f=T;let C=[];for(let D of a){let P=zQ(D,f.get(D.key).overlayedDocument);P!=null&&C.push(new Hs(D.key,P,n2(P.value.mapValue),Go.exists(!0)))}return l.mutationQueue.addMutationBatch(y,u,C,a)}).next(T=>{m=T;let C=T.applyToLocalDocumentSet(f,E);return l.documentOverlayCache.saveOverlays(y,T.batchId,C)})}).then(()=>({batchId:m.batchId,changes:d2(f)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(o,a,l){let u=o.Ba[o.currentUser.toKey()];u||(u=new yn(Rt)),u=u.insert(a,l),o.Ba[o.currentUser.toKey()]=u}(i,r.batchId,t),yield _p(i,r.changes),yield Lv(i.remoteStore)}catch(r){let s=Ox(r,"Failed to persist write");t.reject(s)}})}function V2(n,e){return U(this,null,function*(){let t=Qe(n);try{let i=yield fZ(t.localStore,e);e.targetChanges.forEach((r,s)=>{let o=t.Na.get(s);o&&($t(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.va=!0:r.modifiedDocuments.size>0?$t(o.va):r.removedDocuments.size>0&&($t(o.va),o.va=!1))}),yield _p(t,i,e)}catch(i){yield gp(i)}})}function jF(n,e,t){let i=Qe(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){let r=[];i.Fa.forEach((s,o)=>{let a=o.view.Z_(e);a.snapshot&&r.push(a.snapshot)}),function(o,a){let l=Qe(o);l.onlineState=a;let u=!1;l.queries.forEach((d,f)=>{for(let m of f.j_)m.Z_(a)&&(u=!0)}),u&&Vx(l)}(i.eventManager,e),r.length&&i.Ca.d_(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}function VZ(n,e,t){return U(this,null,function*(){let i=Qe(n);i.sharedClientState.updateQueryState(e,"rejected",t);let r=i.Na.get(e),s=r&&r.key;if(s){let o=new yn(Ve.comparator);o=o.insert(s,ns.newNoDocument(s,tt.min()));let a=_t().add(s),l=new nv(tt.min(),new Map,new yn(Rt),o,a);yield V2(i,l),i.Oa=i.Oa.remove(s),i.Na.delete(e),Bx(i)}else yield HC(i.localStore,e,!1).then(()=>cx(i,e,t)).catch(gp)})}function BZ(n,e){return U(this,null,function*(){let t=Qe(n),i=e.batch.batchId;try{let r=yield hZ(t.localStore,e);U2(t,i,null),B2(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),yield _p(t,r)}catch(r){yield gp(r)}})}function UZ(n,e,t){return U(this,null,function*(){let i=Qe(n);try{let r=yield function(o,a){let l=Qe(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return l.mutationQueue.lookupMutationBatch(u,a).next(f=>($t(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>l.localDocuments.getDocuments(u,d))})}(i.localStore,e);U2(i,e,t),B2(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),yield _p(i,r)}catch(r){yield gp(r)}})}function B2(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function U2(n,e,t){let i=Qe(n),r=i.Ba[i.currentUser.toKey()];if(r){let s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.Ba[i.currentUser.toKey()]=r}}function cx(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let i of n.Ma.get(e))n.Fa.delete(i),t&&n.Ca.$a(i,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(i=>{n.La.containsKey(i)||$2(n,i)})}function $2(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(Rx(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Bx(n))}function GF(n,e,t){for(let i of t)i instanceof mv?(n.La.addReference(i.key,e),$Z(n,i)):i instanceof gv?(ke("SyncEngine","Document no longer in limbo: "+i.key),n.La.removeReference(i.key,e),n.La.containsKey(i.key)||$2(n,i.key)):ze()}function $Z(n,e){let t=e.key,i=t.path.canonicalString();n.Oa.get(t)||n.xa.has(i)||(ke("SyncEngine","New document in limbo: "+t),n.xa.add(i),Bx(n))}function Bx(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new Ve(cn.fromString(e)),i=n.qa.next();n.Na.set(i,new ax(t)),n.Oa=n.Oa.insert(t,i),R2(n.remoteStore,new sp(js(Dv(t.path)),i,"TargetPurposeLimboResolution",XF.oe))}}function _p(n,e,t){return U(this,null,function*(){let i=Qe(n),r=[],s=[],o=[];i.Fa.isEmpty()||(i.Fa.forEach((a,l)=>{o.push(i.Ka(l,e,t).then(u=>{var d;if((u||t)&&i.isPrimaryClient){let f=u?!u.fromCache:(d=t?.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;i.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){r.push(u);let f=$C.Wi(l.targetId,u);s.push(f)}}))}),yield Promise.all(o),i.Ca.d_(r),yield function(l,u){return U(this,null,function*(){let d=Qe(l);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>ge.forEach(u,m=>ge.forEach(m.$i,y=>d.persistence.referenceDelegate.addReference(f,m.targetId,y)).next(()=>ge.forEach(m.Ui,y=>d.persistence.referenceDelegate.removeReference(f,m.targetId,y)))))}catch(f){if(!yp(f))throw f;ke("LocalStore","Failed to update sequence numbers: "+f)}for(let f of u){let m=f.targetId;if(!f.fromCache){let y=d.os.get(m),v=y.snapshotVersion,E=y.withLastLimboFreeSnapshotVersion(v);d.os=d.os.insert(m,E)}}})}(i.localStore,s))})}function jZ(n,e){return U(this,null,function*(){let t=Qe(n);if(!t.currentUser.isEqual(e)){ke("SyncEngine","User change. New user:",e.toKey());let i=yield D2(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(a=>{a.forEach(l=>{l.reject(new we(se.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield _p(t,i.hs)}})}function GZ(n,e){let t=Qe(n),i=t.Na.get(e);if(i&&i.va)return _t().add(i.key);{let r=_t(),s=t.Ma.get(e);if(!s)return r;for(let o of s){let a=t.Fa.get(o);r=r.unionWith(a.view.Va)}return r}}function j2(n){let e=Qe(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=V2.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=GZ.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=VZ.bind(null,e),e.Ca.d_=PZ.bind(null,e.eventManager),e.Ca.$a=RZ.bind(null,e.eventManager),e}function zZ(n){let e=Qe(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=BZ.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=UZ.bind(null,e),e}var zF=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return U(this,null,function*(){this.serializer=Mv(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,i){return null}Ha(t,i){return null}za(t){return dZ(this.persistence,new GC,t.initialUser,this.serializer)}Ga(t){return new VC(UC.Zr,this.serializer)}Wa(t){return new qC}terminate(){return U(this,null,function*(){var t,i;(t=this.gcScheduler)===null||t===void 0||t.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var HZ=(()=>{class n{initialize(t,i){return U(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>jF(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=jZ.bind(null,this.syncEngine),yield DZ(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new ix}()}createDatastore(t){let i=Mv(t.databaseInfo.databaseId),r=function(o){return new YC(o)}(t.databaseInfo);return function(o,a,l,u){return new XC(o,a,l,u)}(t.authCredentials,t.appCheckCredentials,r,i)}createRemoteStore(t){return function(r,s,o,a,l){return new ex(r,s,o,a,l)}(this.localStore,this.datastore,t.asyncQueue,i=>jF(this.syncEngine,i,0),function(){return cv.D()?new cv:new WC}())}createSyncEngine(t,i){return function(s,o,a,l,u,d,f){let m=new lx(s,o,a,l,u,d);return f&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,i)}terminate(){return U(this,null,function*(){var t,i;yield function(s){return U(this,null,function*(){let o=Qe(s);ke("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield vp(o),o.k_.shutdown(),o.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()})}}return n.provider={build:()=>new n},n})();var cp=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):zo("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var ux=class{constructor(e,t,i,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=Qn.UNAUTHENTICATED,this.clientId=Ky.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(i,o=>U(this,null,function*(){ke("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(i,o=>(ke("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ts;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>U(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let i=Ox(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}};function jS(n,e){return U(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),ke("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(r=>U(this,null,function*(){i.isEqual(r)||(yield D2(e.localStore,r),i=r)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function HF(n,e){return U(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield qZ(n);ke("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>BF(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,r)=>BF(e.remoteStore,r)),n._onlineComponents=e})}function qZ(n){return U(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ke("FirestoreClient","Using user provided OfflineComponentProvider");try{yield jS(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(r){return r.name==="FirebaseError"?r.code===se.FAILED_PRECONDITION||r.code===se.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;md("Error using user provided cache. Falling back to memory cache: "+t),yield jS(n,new zF)}}else ke("FirestoreClient","Using default OfflineComponentProvider"),yield jS(n,new zF);return n._offlineComponents})}function G2(n){return U(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(ke("FirestoreClient","Using user provided OnlineComponentProvider"),yield HF(n,n._uninitializedComponentsProvider._online)):(ke("FirestoreClient","Using default OnlineComponentProvider"),yield HF(n,new HZ))),n._onlineComponents})}function WZ(n){return G2(n).then(e=>e.syncEngine)}function yv(n){return U(this,null,function*(){let e=yield G2(n),t=e.eventManager;return t.onListen=MZ.bind(null,e.syncEngine),t.onUnlisten=OZ.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=kZ.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=NZ.bind(null,e.syncEngine),t})}function KZ(n,e,t={}){let i=new ts;return n.asyncQueue.enqueueAndForget(()=>U(this,null,function*(){return function(s,o,a,l,u){let d=new cp({next:m=>{d.Za(),o.enqueueAndForget(()=>Fx(s,f));let y=m.docs.has(a);!y&&m.fromCache?u.reject(new we(se.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&m.fromCache&&l&&l.source==="server"?u.reject(new we(se.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new lp(Dv(a.path),d,{includeMetadataChanges:!0,_a:!0});return Nx(s,f)}(yield yv(n),n.asyncQueue,e,t,i)})),i.promise}function YZ(n,e,t={}){let i=new ts;return n.asyncQueue.enqueueAndForget(()=>U(this,null,function*(){return function(s,o,a,l,u){let d=new cp({next:m=>{d.Za(),o.enqueueAndForget(()=>Fx(s,f)),m.fromCache&&l.source==="server"?u.reject(new we(se.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new lp(a,d,{includeMetadataChanges:!0,_a:!0});return Nx(s,f)}(yield yv(n),n.asyncQueue,e,t,i)})),i.promise}function z2(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var qF=new Map;function H2(n,e,t){if(!t)throw new we(se.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function QZ(n,e,t,i){if(e===!0&&i===!0)throw new we(se.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function WF(n){if(!Ve.isDocumentKey(n))throw new we(se.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function KF(n){if(Ve.isDocumentKey(n))throw new we(se.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ov(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ze()}function kr(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new we(se.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Ov(n);throw new we(se.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ZZ(n,e){if(e<=0)throw new we(se.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var vv=class{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new we(se.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new we(se.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}QZ("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=z2((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new we(se.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new we(se.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new we(se.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Id=class{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vv({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new we(se.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new we(se.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vv(e),e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new GS;switch(i.type){case"firstParty":return new WS(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new we(se.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return U(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let i=qF.get(t);i&&(ke("ComponentProvider","Removing Datastore"),qF.delete(t),i.terminate())}(this),Promise.resolve()}};function q2(n,e,t,i={}){var r;let s=(n=kr(n,Id))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&md("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),i.mockUserToken){let a,l;if(typeof i.mockUserToken=="string")a=i.mockUserToken,l=Qn.MOCK_USER;else{a=HO(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);let u=i.mockUserToken.sub||i.mockUserToken.user_id;if(!u)throw new we(se.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Qn(u)}n._authCredentials=new zS(new Wy(a,l))}}var qs=class n{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},bi=class n{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ya(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Ya=class n extends qs{constructor(e,t,i){super(e,t,Dv(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new bi(this.firestore,null,new Ve(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function W2(n,e,...t){if(n=wn(n),H2("collection","path",e),n instanceof Id){let i=cn.fromString(e,...t);return KF(i),new Ya(n,null,i)}{if(!(n instanceof bi||n instanceof Ya))throw new we(se.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(cn.fromString(e,...t));return KF(i),new Ya(n.firestore,null,i)}}function Ux(n,e,...t){if(n=wn(n),arguments.length===1&&(e=Ky.newId()),H2("doc","path",e),n instanceof Id){let i=cn.fromString(e,...t);return WF(i),new bi(n,null,new Ve(i))}{if(!(n instanceof bi||n instanceof Ya))throw new we(se.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(cn.fromString(e,...t));return WF(i),new bi(n.firestore,n instanceof Ya?n.converter:null,new Ve(i))}}var _v=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new uv(this,"async_queue_retry"),this.Vu=()=>{let i=$S();i&&ke("AsyncQueue","Visibility state changed to "+i.visibilityState),this.t_.jo()},this.mu=e;let t=$S();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=$S();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new ts;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return U(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!yp(e))throw e;ke("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(i=>{this.Eu=i,this.du=!1;let r=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(i);throw zo("INTERNAL UNHANDLED ERROR: ",r),i}).then(i=>(this.du=!1,i))));return this.mu=t,t}enqueueAfterDelay(e,t,i){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let r=tx.createAndSchedule(this,e,t,i,s=>this.yu(s));return this.Tu.push(r),r}fu(){this.Eu&&ze()}verifyOperationInProgress(){}wu(){return U(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function YF(n){return function(t,i){if(typeof t!="object"||t===null)return!1;let r=t;for(let s of i)if(s in r&&typeof r[s]=="function")return!0;return!1}(n,["next","error","complete"])}var Ws=class extends Id{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new _v,this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return U(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new _v(e),this._firestoreClient=void 0,yield e}})}};function K2(n,e){let t=typeof n=="object"?n:td(),i=typeof n=="string"?n:e||"(default)",r=Of(t,"firestore").getImmediate({identifier:i});if(!r._initialized){let s=zO("firestore");s&&q2(r,...s)}return r}function Nv(n){if(n._terminated)throw new we(se.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||XZ(n),n._firestoreClient}function XZ(n){var e,t,i;let r=n._freezeSettings(),s=function(a,l,u,d){return new XS(a,l,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,z2(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._componentsProvider||!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=r.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),n._firestoreClient=new ux(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(a){let l=a?._online.build();return{_offline:a?._offline.build(l),_online:l}}(n._componentsProvider))}var up=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(pi.fromBase64String(e))}catch(t){throw new we(se.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(pi.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var bd=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new we(se.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ur(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var nl=class{constructor(e){this._methodName=e}};var dp=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new we(se.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new we(se.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Rt(this._lat,e._lat)||Rt(this._long,e._long)}};var hp=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(i,r){if(i.length!==r.length)return!1;for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(this._values,e._values)}};var JZ=/^__.*__$/,dx=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Hs(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ic(e,this.data,t,this.fieldTransforms)}},Ev=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new Hs(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Y2(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ze()}}var Tv=class n{constructor(e,t,i,r,s,o){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:i,xu:!1});return r.Ou(e),r}Nu(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:i,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Iv(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Y2(this.Cu)&&JZ.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},hx=class{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||Mv(e)}Qu(e,t,i,r=!1){return new Tv({Cu:e,methodName:t,qu:i,path:ur.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Fv(n){let e=n._freezeSettings(),t=Mv(n._databaseId);return new hx(n._databaseId,!!e.ignoreUndefinedProperties,t)}function eX(n,e,t,i,r,s={}){let o=n.Qu(s.merge||s.mergeFields?2:0,e,t,r);$x("Data must be an object, but it was:",o,i);let a=X2(i,o),l,u;if(s.merge)l=new Mr(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){let d=[];for(let f of s.mergeFields){let m=gx(e,f,t);if(!o.contains(m))throw new we(se.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);eV(d,m)||d.push(m)}l=new Mr(d),u=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=o.fieldTransforms;return new dx(new cr(a),l,u)}var wv=class n extends nl{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function Q2(n,e,t){return new Tv({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var fx=class n extends nl{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=Q2(this,e,!0),i=this.Ku.map(s=>Cc(s,t)),r=new Ja(i);return new np(e.path,r)}isEqual(e){return e instanceof n&&Oo(this.Ku,e.Ku)}},px=class n extends nl{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=Q2(this,e,!0),i=this.Ku.map(s=>Cc(s,t)),r=new el(i);return new np(e.path,r)}isEqual(e){return e instanceof n&&Oo(this.Ku,e.Ku)}},mx=class n extends nl{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){let t=new wc(e.serializer,p2(e.serializer,this.$u));return new np(e.path,t)}isEqual(e){return e instanceof n&&this.$u===e.$u}};function tX(n,e,t,i){let r=n.Qu(1,e,t);$x("Data must be an object, but it was:",r,i);let s=[],o=cr.empty();bc(i,(l,u)=>{let d=jx(e,l,t);u=wn(u);let f=r.Nu(d);if(u instanceof wv)s.push(d);else{let m=Cc(u,f);m!=null&&(s.push(d),o.set(d,m))}});let a=new Mr(s);return new Ev(o,a,r.fieldTransforms)}function nX(n,e,t,i,r,s){let o=n.Qu(1,e,t),a=[gx(e,i,t)],l=[r];if(s.length%2!=0)throw new we(se.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)a.push(gx(e,s[m])),l.push(s[m+1]);let u=[],d=cr.empty();for(let m=a.length-1;m>=0;--m)if(!eV(u,a[m])){let y=a[m],v=l[m];v=wn(v);let E=o.Nu(y);if(v instanceof wv)u.push(y);else{let T=Cc(v,E);T!=null&&(u.push(y),d.set(y,T))}}let f=new Mr(u);return new Ev(d,f,o.fieldTransforms)}function Z2(n,e,t,i=!1){return Cc(t,n.Qu(i?4:3,e))}function Cc(n,e){if(J2(n=wn(n)))return $x("Unsupported field value:",e,n),X2(n,e);if(n instanceof nl)return function(i,r){if(!Y2(r.Cu))throw r.Bu(`${i._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Bu(`${i._methodName}() is not currently supported inside arrays`);let s=i._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(i,r){let s=[],o=0;for(let a of i){let l=Cc(a,r.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),o++}return{arrayValue:{values:s}}}(n,e)}return function(i,r){if((i=wn(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return p2(r.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){let s=gn.fromDate(i);return{timestampValue:ov(r.serializer,s)}}if(i instanceof gn){let s=new gn(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:ov(r.serializer,s)}}if(i instanceof dp)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof up)return{bytesValue:w2(r.serializer,i._byteString)};if(i instanceof bi){let s=r.databaseId,o=i.firestore._databaseId;if(!o.isEqual(s))throw r.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Px(i.firestore._databaseId||r.databaseId,i._key.path)}}if(i instanceof hp)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Dx(a.serializer,l)})}}}}}}(i,r);throw r.Bu(`Unsupported field value: ${Ov(i)}`)}(n,e)}function X2(n,e){let t={};return JF(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):bc(n,(i,r)=>{let s=Cc(r,e.Mu(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function J2(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof gn||n instanceof dp||n instanceof up||n instanceof bi||n instanceof nl||n instanceof hp)}function $x(n,e,t){if(!J2(t)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(t)){let i=Ov(t);throw i==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+i)}}function gx(n,e,t){if((e=wn(e))instanceof bd)return e._internalPath;if(typeof e=="string")return jx(n,e);throw Iv("Field path arguments must be of type string or ",n,!1,void 0,t)}var iX=new RegExp("[~\\*/\\[\\]]");function jx(n,e,t){if(e.search(iX)>=0)throw Iv(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new bd(...e.split("."))._internalPath}catch{throw Iv(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Iv(n,e,t,i,r){let s=i&&!i.isEmpty(),o=r!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${i}`),o&&(l+=` in document ${r}`),l+=")"),new we(se.INVALID_ARGUMENT,a+n+l)}function eV(n,e){return n.some(t=>t.isEqual(e))}var fp=class{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new bi(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new yx(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Vv("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},yx=class extends fp{data(){return super.data()}};function Vv(n,e){return typeof e=="string"?jx(n,e):e instanceof bd?e._internalPath:e._delegate._internalPath}function tV(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new we(se.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var pp=class{},Sd=class extends pp{};function nV(n,e,...t){let i=[];e instanceof pp&&i.push(e),i=i.concat(t),function(s){let o=s.filter(l=>l instanceof vx).length,a=s.filter(l=>l instanceof bv).length;if(o>1||o>0&&a>0)throw new we(se.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(let r of i)n=r._apply(n);return n}var bv=class n extends Sd{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=this._parse(e);return aV(e._query,t),new qs(e.firestore,e.converter,dC(e._query,t))}_parse(e){let t=Fv(e.firestore);return function(s,o,a,l,u,d,f){let m;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new we(se.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){ZF(f,d);let y=[];for(let v of f)y.push(QF(l,s,v));m={arrayValue:{values:y}}}else m=QF(l,s,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||ZF(f,d),m=Z2(a,o,f,d==="in"||d==="not-in");return Ln.create(u,d,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function iV(n,e,t){let i=e,r=Vv("where",n);return bv._create(r,i,t)}var vx=class n extends pp{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:is.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(r,s){let o=r,a=s.getFlattenedFilters();for(let l of a)aV(o,l),o=dC(o,l)}(e._query,t),new qs(e.firestore,e.converter,dC(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var _x=class n extends Sd{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(r,s,o){if(r.startAt!==null)throw new we(se.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new we(se.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Tc(s,o)}(e._query,this._field,this._direction);return new qs(e.firestore,e.converter,function(r,s){let o=r.explicitOrderBy.concat([s]);return new qo(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}};function rV(n,e="asc"){let t=e,i=Vv("orderBy",n);return _x._create(i,t)}var Ex=class n extends Sd{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){return new qs(e.firestore,e.converter,tv(e._query,this._limit,this._limitType))}};function sV(n){return ZZ("limit",n),Ex._create("limit",n,"F")}var Tx=class n extends Sd{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=rX(e,this.type,this._docOrFields,this._inclusive);return new qs(e.firestore,e.converter,function(r,s){return new qo(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)}(e._query,t))}};function oV(...n){return Tx._create("startAfter",n,!1)}function rX(n,e,t,i){if(t[0]=wn(t[0]),t[0]instanceof fp)return function(s,o,a,l,u){if(!l)throw new we(se.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let f of hd(s))if(f.field.isKeyField())d.push(Jy(o,l.key));else{let m=l.data.field(f.field);if(Av(m))throw new we(se.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){let y=f.field.canonicalString();throw new we(se.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(m)}return new Za(d,u)}(n._query,n.firestore._databaseId,e,t[0]._document,i);{let r=Fv(n.firestore);return function(o,a,l,u,d,f){let m=o.explicitOrderBy;if(d.length>m.length)throw new we(se.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let y=[];for(let v=0;v<d.length;v++){let E=d[v];if(m[v].field.isKeyField()){if(typeof E!="string")throw new we(se.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof E}`);if(!Ax(o)&&E.indexOf("/")!==-1)throw new we(se.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${E}' contains a slash.`);let T=o.path.child(cn.fromString(E));if(!Ve.isDocumentKey(T))throw new we(se.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${T}' is not because it contains an odd number of segments.`);let C=new Ve(T);y.push(Jy(a,C))}else{let T=Z2(l,u,E);y.push(T)}}return new Za(y,f)}(n._query,n.firestore._databaseId,r,e,t,i)}}function QF(n,e,t){if(typeof(t=wn(t))=="string"){if(t==="")throw new we(se.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ax(e)&&t.indexOf("/")!==-1)throw new we(se.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let i=e.path.child(cn.fromString(t));if(!Ve.isDocumentKey(i))throw new we(se.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Jy(n,new Ve(i))}if(t instanceof bi)return Jy(n,t._key);throw new we(se.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ov(t)}.`)}function ZF(n,e){if(!Array.isArray(n)||n.length===0)throw new we(se.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function aV(n,e){let t=function(r,s){for(let o of r)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new we(se.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new we(se.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var wx=class{convertValue(e,t="none"){switch(Ec(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ln(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Qa(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ze()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let i={};return bc(e,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertVectorValue(e){var t,i,r;let s=(r=(i=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.map(o=>ln(o.doubleValue));return new hp(s)}convertGeoPoint(e){return new dp(ln(e.latitude),ln(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":let i=bx(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(ep(e));default:return null}}convertTimestamp(e){let t=Ho(e);return new gn(t.seconds,t.nanos)}convertDocumentKey(e,t){let i=cn.fromString(e);$t(A2(i));let r=new Xy(i.get(1),i.get(3)),s=new Ve(i.popFirst(5));return r.isEqual(t)||zo(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function sX(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}var yc=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Sv=class extends fp{constructor(e,t,i,r,s,o){super(e,t,i,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new pd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let i=this._document.data.field(Vv("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}},pd=class extends Sv{data(e={}){return super.data(e)}},Cv=class{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new yc(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new pd(this._firestore,this._userDataWriter,i.key,i,new yc(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new we(se.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(a=>{let l=new pd(r._firestore,r._userDataWriter,a.doc.key,a.doc,new yc(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let l=new pd(r._firestore,r._userDataWriter,a.doc.key,a.doc,new yc(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter),u=-1,d=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:oX(a.type),doc:l,oldIndex:u,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function oX(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ze()}}function lV(n){n=kr(n,bi);let e=kr(n.firestore,Ws);return KZ(Nv(e),n._key).then(t=>pV(e,n,t))}var mp=class extends wx{constructor(e){super(),this.firestore=e}convertBytes(e){return new up(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new bi(this.firestore,null,t)}};function cV(n){n=kr(n,qs);let e=kr(n.firestore,Ws),t=Nv(e),i=new mp(e);return tV(n._query),YZ(t,n._query).then(r=>new Cv(e,i,n,r))}function uV(n,e,t,...i){n=kr(n,bi);let r=kr(n.firestore,Ws),s=Fv(r),o;return o=typeof(e=wn(e))=="string"||e instanceof bd?nX(s,"updateDoc",n._key,e,t,i):tX(s,"updateDoc",n._key,e),Gx(r,[o.toMutation(n._key,Go.exists(!0))])}function dV(n){return Gx(kr(n.firestore,Ws),[new ip(n._key,Go.none())])}function hV(n,e){let t=kr(n.firestore,Ws),i=Ux(n),r=sX(n.converter,e);return Gx(t,[eX(Fv(n.firestore),"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,Go.exists(!1))]).then(()=>i)}function fV(n,...e){var t,i,r;n=wn(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||YF(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(YF(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(i=f.error)===null||i===void 0?void 0:i.bind(f),e[o+2]=(r=f.complete)===null||r===void 0?void 0:r.bind(f)}let l,u,d;if(n instanceof bi)u=kr(n.firestore,Ws),d=Dv(n._key.path),l={next:f=>{e[o]&&e[o](pV(u,n,f))},error:e[o+1],complete:e[o+2]};else{let f=kr(n,qs);u=kr(f.firestore,Ws),d=f._query;let m=new mp(u);l={next:y=>{e[o]&&e[o](new Cv(u,m,f,y))},error:e[o+1],complete:e[o+2]},tV(n._query)}return function(m,y,v,E){let T=new cp(E),C=new lp(y,T,v);return m.asyncQueue.enqueueAndForget(()=>U(this,null,function*(){return Nx(yield yv(m),C)})),()=>{T.Za(),m.asyncQueue.enqueueAndForget(()=>U(this,null,function*(){return Fx(yield yv(m),C)}))}}(Nv(u),d,a,l)}function Gx(n,e){return function(i,r){let s=new ts;return i.asyncQueue.enqueueAndForget(()=>U(this,null,function*(){return FZ(yield WZ(i),r,s)})),s.promise}(Nv(n),e)}function pV(n,e,t){let i=t.docs.get(e._key),r=new mp(n);return new Sv(n,r,e._key,i,new yc(t.hasPendingWrites,t.fromCache),e.converter)}function mV(...n){return new fx("arrayUnion",n)}function gV(...n){return new px("arrayRemove",n)}function yV(n){return new mx("increment",n)}(function(e,t=!0){(function(r){Cd=r})(Ga),ja(new Rr("firestore",(i,{instanceIdentifier:r,options:s})=>{let o=i.getProvider("app").getImmediate(),a=new Ws(new HS(i.getProvider("auth-internal")),new YS(i.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new we(se.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Xy(u.options.projectId,d)}(o,r),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Un(vF,"4.7.3",e),Un(vF,"4.7.3","esm2017")})();var xc=class{constructor(e){return e}},vV="firestore",zx=class{constructor(){return Nf(vV)}};var Hx=new Pe("angularfire2.firestore-instances");function aX(n,e){let t=vy(vV,n,e);return t&&new xc(t)}function lX(n){return(e,t)=>{let i=e.runOutsideAngular(()=>n(t));return new xc(i)}}var cX={provide:zx,deps:[[new ci,Hx]]},uX={provide:xc,useFactory:aX,deps:[[new ci,Hx],Fo]};function _V(n,...e){return Un("angularfire",uc.full,"fst"),Yr([uX,cX,{provide:Hx,useFactory:lX(n),multi:!0,deps:[Ct,ii,rd,dc,[new ci,qf],[new ci,id],...e]}])}var EV=sn(hV,!0);var qx=sn(gV,!0),Wx=sn(mV,!0);var Ad=sn(W2,!0);var TV=sn(dV,!0);var Ac=sn(Ux,!0);var wV=sn(lV,!0);var Bv=sn(cV,!0);var IV=sn(K2,!0);var Uv=sn(yV,!0);var $v=sn(sV,!0);var bV=sn(fV,!0);var Ep=sn(rV,!0);var Dd=sn(nV,!0);var SV=sn(oV,!0);var Dc=sn(uV,!0);var CV=sn(iV,!0);var Tp={production:!1,firebase:{apiKey:"AIzaSyA9H-CYGk2kEsfzKyFMA6cdPQRRQMf750M",authDomain:"bengaluru-swada-1ecca.firebaseapp.com",projectId:"bengaluru-swada-1ecca",storageBucket:"bengaluru-swada-1ecca.firebasestorage.app",messagingSenderId:"831575973864",appId:"1:831575973864:web:8ba5a2fa1e28b9e16bce5d",measurementId:"G-DEZTYKDN53"},cloudflare:{workerUrl:"https://r2-video-uploader.bengaluru-swada.workers.dev",cdnUrl:"https://r2-video-uploader.bengaluru-swada.workers.dev",bucketName:"bengaluru-swada-videos"}};var Pc=class{hasShownSplash=!1;markSplashShown(){this.hasShownSplash=!0}shouldShowSplash(){return!this.hasShownSplash}reset(){this.hasShownSplash=!1}},Rc=()=>{let n=le(xt);return le(Pc).shouldShowSplash()?(console.log("[SplashGuard] Redirecting to splash screen"),n.createUrlTree(["/"])):!0};var jv=class n{constructor(e,t,i){this.router=e;this.auth=t;this.appInit=i}minSplashDuration=3e3;splashStartTime=0;authUnsubscribe;ngOnInit(){this.splashStartTime=Date.now(),console.log("[Splash] Splash screen started at:",new Date().toISOString()),this.authUnsubscribe=pF(this.auth,e=>{let t=Date.now()-this.splashStartTime,i=Math.max(0,this.minSplashDuration-t);console.log(`[Splash] Auth checked. Elapsed: ${t}ms, Waiting additional: ${i}ms`),setTimeout(()=>{this.appInit.markSplashShown(),e?(console.log("[Splash] User is logged in:",e.uid),this.router.navigate(["/main-app"],{replaceUrl:!0})):(console.log("[Splash] User is not logged in, navigating to phone-input"),this.router.navigate(["/phone-input"],{replaceUrl:!0}))},i)})}ngOnDestroy(){this.authUnsubscribe&&this.authUnsubscribe()}static \u0275fac=function(t){return new(t||n)(Te(xt),Te(Kt),Te(Pc))};static \u0275cmp=Dt({type:n,selectors:[["app-splash"]],standalone:!0,features:[Pt],decls:2,vars:0,consts:[[1,"splash-container"],["src","assets/logo.jpg","alt","Bengaluru Swada Logo",1,"splash-logo"]],template:function(t,i){t&1&&(N(0,"div",0),fe(1,"img",1),$())},dependencies:[Ut],styles:[".splash-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background-color:#fff}.splash-logo[_ngcontent-%COMP%]{max-width:80%;max-height:50vh;object-fit:contain;animation:_ngcontent-%COMP%_fadeIn 1.5s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}"]})};var LV=(()=>{class n{constructor(t,i){this._renderer=t,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(t,i){this._renderer.setProperty(this._elementRef.nativeElement,t,i)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static{this.\u0275fac=function(i){return new(i||n)(Te(Yl),Te(Zr))}}static{this.\u0275dir=ri({type:n})}}return n})(),OV=(()=>{class n extends LV{static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=wo(n)))(r||n)}})()}static{this.\u0275dir=ri({type:n,features:[As]})}}return n})(),eA=new Pe("");var fX={provide:eA,useExisting:_o(()=>Vi),multi:!0};function pX(){let n=Ao()?Ao().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var mX=new Pe(""),Vi=(()=>{class n extends LV{constructor(t,i,r){super(t,i),this._compositionMode=r,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!pX())}writeValue(t){let i=t??"";this.setProperty("value",i)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static{this.\u0275fac=function(i){return new(i||n)(Te(Yl),Te(Zr),Te(mX,8))}}static{this.\u0275dir=ri({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,r){i&1&&ve("input",function(o){return r._handleInput(o.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(o){return r._compositionEnd(o.target.value)})},features:[Zl([fX]),As]})}}return n})();function Kx(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function gX(n){return n!=null&&typeof n.length=="number"}var Wv=new Pe(""),yX=new Pe("");function vX(n){return e=>{if(Kx(e.value)||Kx(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function _X(n){return e=>gX(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function EX(n){if(!n)return Yx;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),i=>{if(Kx(i.value))return null;let r=i.value;return e.test(r)?null:{pattern:{requiredPattern:t,actualValue:r}}}}function Yx(n){return null}function NV(n){return n!=null}function FV(n){return Xl(n)?en(n):n}function VV(n){let e={};return n.forEach(t=>{e=t!=null?ue(ue({},e),t):e}),Object.keys(e).length===0?null:e}function BV(n,e){return e.map(t=>t(n))}function TX(n){return!n.validate}function UV(n){return n.map(e=>TX(e)?e:t=>e.validate(t))}function wX(n){if(!n)return null;let e=n.filter(NV);return e.length==0?null:function(t){return VV(BV(t,e))}}function $V(n){return n!=null?wX(UV(n)):null}function IX(n){if(!n)return null;let e=n.filter(NV);return e.length==0?null:function(t){let i=BV(t,e).map(FV);return ME(i).pipe(qe(VV))}}function jV(n){return n!=null?IX(UV(n)):null}function xV(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function bX(n){return n._rawValidators}function SX(n){return n._rawAsyncValidators}function Qx(n){return n?Array.isArray(n)?n:[n]:[]}function zv(n,e){return Array.isArray(n)?n.includes(e):n===e}function AV(n,e){let t=Qx(e);return Qx(n).forEach(r=>{zv(t,r)||t.push(r)}),t}function DV(n,e){return Qx(e).filter(t=>!zv(n,t))}var Hv=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=$V(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=jV(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Zx=class extends Hv{get formDirective(){return null}get path(){return null}},Cp=class extends Hv{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Xx=class{constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},CX={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},Jme=Ye(ue({},CX),{"[class.ng-submitted]":"isSubmitted"}),Lr=(()=>{class n extends Xx{constructor(t){super(t)}static{this.\u0275fac=function(i){return new(i||n)(Te(Cp,2))}}static{this.\u0275dir=ri({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,r){i&2&&ct("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},features:[As]})}}return n})();var wp="VALID",Gv="INVALID",Pd="PENDING",Ip="DISABLED",Md=class{},qv=class extends Md{constructor(e,t){super(),this.value=e,this.source=t}},bp=class extends Md{constructor(e,t){super(),this.pristine=e,this.source=t}},Sp=class extends Md{constructor(e,t){super(),this.touched=e,this.source=t}},Rd=class extends Md{constructor(e,t){super(),this.status=e,this.source=t}};function xX(n){return(Kv(n)?n.validators:n)||null}function AX(n){return Array.isArray(n)?$V(n):n||null}function DX(n,e){return(Kv(e)?e.asyncValidators:n)||null}function PX(n){return Array.isArray(n)?jV(n):n||null}function Kv(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}var Jx=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=c0(()=>this.statusReactive()),this.statusReactive=i0(void 0),this._pristine=c0(()=>this.pristineReactive()),this.pristineReactive=i0(!0),this._touched=c0(()=>this.touchedReactive()),this.touchedReactive=i0(!1),this._events=new Hn,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return Ra(this.statusReactive)}set status(e){Ra(()=>this.statusReactive.set(e))}get valid(){return this.status===wp}get invalid(){return this.status===Gv}get pending(){return this.status==Pd}get disabled(){return this.status===Ip}get enabled(){return this.status!==Ip}get pristine(){return Ra(this.pristineReactive)}set pristine(e){Ra(()=>this.pristineReactive.set(e))}get dirty(){return!this.pristine}get touched(){return Ra(this.touchedReactive)}set touched(e){Ra(()=>this.touchedReactive.set(e))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(AV(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(AV(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(DV(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(DV(e,this._rawAsyncValidators))}hasValidator(e){return zv(this._rawValidators,e)}hasAsyncValidator(e){return zv(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let i=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(Ye(ue({},e),{sourceControl:i})),t&&e.emitEvent!==!1&&this._events.next(new Sp(!0,i))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let i=e.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:i})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,i),t&&e.emitEvent!==!1&&this._events.next(new Sp(!1,i))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let i=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(Ye(ue({},e),{sourceControl:i})),t&&e.emitEvent!==!1&&this._events.next(new bp(!1,i))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let i=e.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,i),t&&e.emitEvent!==!1&&this._events.next(new bp(!0,i))}markAsPending(e={}){this.status=Pd;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Rd(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(Ye(ue({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ip,this.errors=null,this._forEachChild(r=>{r.disable(Ye(ue({},e),{onlySelf:!0}))}),this._updateValue();let i=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new qv(this.value,i)),this._events.next(new Rd(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Ye(ue({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=wp,this._forEachChild(i=>{i.enable(Ye(ue({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Ye(ue({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let i=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===wp||this.status===Pd)&&this._runAsyncValidator(i,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new qv(this.value,t)),this._events.next(new Rd(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(Ye(ue({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ip:wp}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=Pd,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let i=FV(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((i,r)=>i&&i._find(r),this)}getError(e,t){let i=t?this.get(t):this;return i&&i.errors?i.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,i){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||i)&&this._events.next(new Rd(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,i)}_initObservables(){this.valueChanges=new lt,this.statusChanges=new lt}_calculateStatus(){return this._allControlsDisabled()?Ip:this.errors?Gv:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Pd)?Pd:this._anyControlsHaveStatus(Gv)?Gv:wp}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let i=!this._anyControlsDirty(),r=this.pristine!==i;this.pristine=i,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),r&&this._events.next(new bp(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new Sp(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Kv(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=AX(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=PX(this._rawAsyncValidators)}};var GV=new Pe("CallSetDisabledState",{providedIn:"root",factory:()=>tA}),tA="always";function RX(n,e){return[...e.path,n]}function MX(n,e,t=tA){LX(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),OX(n,e),FX(n,e),NX(n,e),kX(n,e)}function PV(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function kX(n,e){if(e.valueAccessor.setDisabledState){let t=i=>{e.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function LX(n,e){let t=bX(n);e.validator!==null?n.setValidators(xV(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let i=SX(n);e.asyncValidator!==null?n.setAsyncValidators(xV(i,e.asyncValidator)):typeof i=="function"&&n.setAsyncValidators([i]);let r=()=>n.updateValueAndValidity();PV(e._rawValidators,r),PV(e._rawAsyncValidators,r)}function OX(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&zV(n,e)})}function NX(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&zV(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function zV(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function FX(n,e){let t=(i,r)=>{e.valueAccessor.writeValue(i),r&&e.viewToModelUpdate(i)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function VX(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function BX(n){return Object.getPrototypeOf(n.constructor)===OV}function UX(n,e){if(!e)return null;Array.isArray(e);let t,i,r;return e.forEach(s=>{s.constructor===Vi?t=s:BX(s)?i=s:r=s}),r||i||t||null}function RV(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function MV(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var $X=class extends Jx{constructor(e=null,t,i){super(xX(t),DX(i,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Kv(t)&&(t.nonNullable||t.initialValueIsDefault)&&(MV(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(i=>i(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){RV(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){RV(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){MV(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var jX={provide:Cp,useExisting:_o(()=>dr)},kV=Promise.resolve(),dr=(()=>{class n extends Cp{constructor(t,i,r,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this.control=new $X,this._registered=!1,this.name="",this.update=new lt,this._parent=t,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=UX(this,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let i=t.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),VX(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){MX(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){kV.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let i=t.isDisabled.currentValue,r=i!==0&&Jl(i);kV.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?RX(t,this._parent):[t]}static{this.\u0275fac=function(i){return new(i||n)(Te(Zx,9),Te(Wv,10),Te(yX,10),Te(eA,10),Te(tr,8),Te(GV,8))}}static{this.\u0275dir=ri({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Zl([jX]),As,Cr]})}}return n})();var GX={provide:eA,useExisting:_o(()=>nA),multi:!0},nA=(()=>{class n extends OV{writeValue(t){let i=t??"";this.setProperty("value",i)}registerOnChange(t){this.onChange=i=>{t(i==""?null:parseFloat(i))}}static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=wo(n)))(r||n)}})()}static{this.\u0275dir=ri({type:n,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(i,r){i&1&&ve("input",function(o){return r.onChange(o.target.value)})("blur",function(){return r.onTouched()})},features:[Zl([GX]),As]})}}return n})();function zX(n){return typeof n=="number"?n:parseInt(n,10)}function HX(n){return typeof n=="number"?n:parseFloat(n)}var iA=(()=>{class n{constructor(){this._validator=Yx}ngOnChanges(t){if(this.inputName in t){let i=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):Yx,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275dir=ri({type:n,features:[Cr]})}}return n})();var qX={provide:Wv,useExisting:_o(()=>rA),multi:!0},rA=(()=>{class n extends iA{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=t=>HX(t),this.createValidator=t=>vX(t)}static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=wo(n)))(r||n)}})()}static{this.\u0275dir=ri({type:n,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&Ds("min",r._enabled?r.min:null)},inputs:{min:"min"},features:[Zl([qX]),As]})}}return n})();var WX={provide:Wv,useExisting:_o(()=>xp),multi:!0},xp=(()=>{class n extends iA{constructor(){super(...arguments),this.inputName="maxlength",this.normalizeInput=t=>zX(t),this.createValidator=t=>_X(t)}static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=wo(n)))(r||n)}})()}static{this.\u0275dir=ri({type:n,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&Ds("maxlength",r._enabled?r.maxlength:null)},inputs:{maxlength:"maxlength"},features:[Zl([WX]),As]})}}return n})(),KX={provide:Wv,useExisting:_o(()=>sA),multi:!0},sA=(()=>{class n extends iA{constructor(){super(...arguments),this.inputName="pattern",this.normalizeInput=t=>t,this.createValidator=t=>EX(t)}static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=wo(n)))(r||n)}})()}static{this.\u0275dir=ri({type:n,selectors:[["","pattern","","formControlName",""],["","pattern","","formControl",""],["","pattern","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&Ds("pattern",r._enabled?r.pattern:null)},inputs:{pattern:"pattern"},features:[Zl([KX]),As]})}}return n})();var YX=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=Cs({type:n})}static{this.\u0275inj=Ss({})}}return n})();var Bi=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:GV,useValue:t.callSetDisabledState??tA}]}}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=Cs({type:n})}static{this.\u0275inj=Ss({imports:[YX]})}}return n})();var Ld=class n{constructor(e){this.auth=e}confirmationResult=null;phoneNumber="";sendOtp(e,t){return U(this,null,function*(){try{let i=yield mF(this.auth,e,t);return this.setConfirmationResult(i),this.setPhoneNumber(e),i}catch(i){throw i}})}setConfirmationResult(e){this.confirmationResult=e}getConfirmationResult(){return this.confirmationResult}setPhoneNumber(e){this.phoneNumber=e}getPhoneNumber(){return this.phoneNumber}static \u0275fac=function(t){return new(t||n)(Me(Kt))};static \u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})};function QX(n,e){if(n&1&&(N(0,"div",14)(1,"span"),X(2),$()()),n&2){let t=Ce();K(2),pt("\u26A0\uFE0F ",t.error,"")}}function ZX(n,e){n&1&&(N(0,"span"),X(1,"Continue"),$())}function XX(n,e){n&1&&(N(0,"span",15),X(1,"Sending OTP..."),$())}var Yv=class n{constructor(e,t,i){this.router=e;this.auth=t;this.phoneAuthService=i}mobile="";valid=!1;loading=!1;error="";recaptchaVerifier;confirmationResult;ngOnInit(){setTimeout(()=>{this.recaptchaVerifier=new pc(this.auth,"recaptcha-container",{size:"invisible",callback:()=>console.log("reCAPTCHA success"),"expired-callback":()=>this.error="ReCAPTCHA expired. Try again."}),this.recaptchaVerifier.render()})}onInput(){this.valid=/^\d{10}$/.test(this.mobile),this.error=""}continue(){return U(this,null,function*(){if(!(!this.valid||this.loading)){this.loading=!0,this.error="";try{let e="+91"+this.mobile;this.confirmationResult=yield this.phoneAuthService.sendOtp(e,this.recaptchaVerifier),this.router.navigate(["/otp"])}catch(e){console.error(e),e.code==="auth/invalid-phone-number"?this.error="Invalid phone number.":e.code==="auth/too-many-requests"?this.error="Too many attempts. Try again later.":e.code==="auth/quota-exceeded"?this.error="SMS quota exceeded.":e.code==="auth/billing-not-enabled"?this.error="Firebase billing is not enabled. Please enable it in the Firebase Console.":this.error=`Failed to send OTP: ${e.message} (${e.code})`,this.loading=!1}}})}static \u0275fac=function(t){return new(t||n)(Te(xt),Te(Kt),Te(Ld))};static \u0275cmp=Dt({type:n,selectors:[["app-phone-input"]],standalone:!0,features:[Pt],decls:18,vars:8,consts:[[1,"phone-input-page"],[1,"mobile-input-section"],[1,"mobile-form"],[1,"welcome-text"],[1,"subtitle","light-grey"],[1,"input-container"],[1,"country-code"],["type","tel","id","mobileNumber","placeholder","Enter your mobile number","maxlength","10","pattern","[0-9]{10}",3,"ngModelChange","input","ngModel","disabled"],["class","error-message",4,"ngIf"],[1,"continue-btn",3,"click","disabled"],[4,"ngIf"],["class","loading-spinner",4,"ngIf"],[1,"privacy-text","light-grey"],["id","recaptcha-container"],[1,"error-message"],[1,"loading-spinner"]],template:function(t,i){t&1&&(N(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),X(4,"Welcome to Bengaluru Swada!"),$(),N(5,"p",4),X(6," Enter your mobile number to discover amazing street food near you "),$(),N(7,"div",5)(8,"div",6),X(9,"+91"),$(),N(10,"input",7),Bn("ngModelChange",function(s){return qn(i.mobile,s)||(i.mobile=s),s}),ve("input",function(){return i.onInput()}),$()(),Be(11,QX,3,1,"div",8),N(12,"button",9),ve("click",function(){return i.continue()}),Be(13,ZX,2,0,"span",10)(14,XX,2,0,"span",11),$(),N(15,"p",12),X(16," We'll send you an OTP to verify your number. Your privacy is important to us. "),$(),fe(17,"div",13),$()()()),t&2&&(K(10),Vn("ngModel",i.mobile),ce("disabled",i.loading),K(),ce("ngIf",i.error),K(),ct("active",i.valid&&!i.loading),ce("disabled",!i.valid||i.loading),K(),ce("ngIf",!i.loading),K(),ce("ngIf",i.loading))},dependencies:[Ut,nn,Bi,Vi,Lr,xp,sA,dr],styles:[".mobile-input-section[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:2rem 1rem}.welcome-text[_ngcontent-%COMP%]{font-size:2rem;font-weight:600;margin-bottom:1rem}.mobile-form[_ngcontent-%COMP%]{width:100%;max-width:400px;text-align:center}.subtitle[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:2rem;line-height:1.5}.input-container[_ngcontent-%COMP%]{display:flex;background:#f8f9fa;border:2px solid #e9ecef;border-radius:12px;overflow:hidden;margin:2rem 0}.country-code[_ngcontent-%COMP%]{padding:1rem;border-right:1px solid #e9ecef;font-weight:600}#mobileNumber[_ngcontent-%COMP%]{flex:1;padding:1rem;border:none;outline:none;font-size:1.1rem;background:transparent}#mobileNumber[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.error-message[_ngcontent-%COMP%]{background:#fee;border:1px solid #fcc;border-radius:8px;padding:.75rem 1rem;margin-bottom:1rem;color:#c33;font-size:.9rem;text-align:left}#recaptcha-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:1.5rem 0;min-height:78px}.continue-btn[_ngcontent-%COMP%]{width:100%;padding:1rem;font-weight:600;border-radius:12px;border:none;background:#dee2e6;color:#6c757d;margin-bottom:20px;cursor:pointer;transition:all .2s;font-size:1rem}.continue-btn.active[_ngcontent-%COMP%]{background:#ff6b35;color:#fff;box-shadow:0 4px 15px #ff6b354d;transform:translateY(-1px)}.continue-btn[_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.6}.loading-spinner[_ngcontent-%COMP%]{display:inline-block;animation:_ngcontent-%COMP%_pulse 1.5s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.privacy-text[_ngcontent-%COMP%]{font-size:.9rem;line-height:1.4}.light-grey[_ngcontent-%COMP%]{color:#6c757d}"]})};var JX=()=>[0,1,2,3,4,5];function eJ(n,e){if(n&1){let t=Tt();N(0,"input",15),Bn("ngModelChange",function(r){let s=xe(t).index,o=Ce();return qn(o.otp[s],r)||(o.otp[s]=r),Ae(r)}),ve("input",function(){let r=xe(t).index,s=Ce();return Ae(s.onOtpInput(r))}),$()}if(n&2){let t=e.index,i=Ce();ct("error-border",i.hasError),Vn("ngModel",i.otp[t])}}function tJ(n,e){if(n&1&&(N(0,"p",16),X(1,"Resend in "),N(2,"span",17),X(3),$()()),n&2){let t=Ce();K(3),pt("",t.countdown,"s")}}function nJ(n,e){if(n&1){let t=Tt();N(0,"p",18),ve("click",function(){xe(t);let r=Ce();return Ae(r.resend())}),X(1,"Resend OTP"),$()}}function iJ(n,e){n&1&&(N(0,"div",19)(1,"div",20)(2,"div",21),fe(3,"div",22),$(),N(4,"h2"),X(5,"Verified!"),$()()())}var Qv=class n{constructor(e,t,i,r){this.router=e;this.cdr=t;this.phoneAuthService=i;this.auth=r;this.phone=this.phoneAuthService.getPhoneNumber(),this.confirmationResult=this.phoneAuthService.getConfirmationResult(),this.confirmationResult||this.router.navigate(["/phone-input"])}phone="";back=new lt;verified=new lt;otp=["","","","","",""];countdown=30;timerHandle;complete=!1;loading=!1;error="";confirmationResult=null;hasError=!1;isVerified=!1;recaptchaVerifier;ngOnInit(){this.startTimer(),setTimeout(()=>{this.recaptchaVerifier||(this.recaptchaVerifier=new pc(this.auth,"recaptcha-container-otp",{size:"invisible",callback:()=>{}}))})}startTimer(){clearInterval(this.timerHandle),this.countdown=30,this.timerHandle=setInterval(()=>{this.countdown>0?this.countdown--:clearInterval(this.timerHandle),this.cdr.detectChanges()},1e3)}onOtpInput(e){if(this.complete=this.otp.join("").length===6&&/^\d{6}$/.test(this.otp.join("")),this.error="",this.hasError=!1,this.otp[e]&&e<5){let t=document.querySelectorAll(".otp-input")[e+1];t&&t.focus()}}verify(){return U(this,null,function*(){if(!(!this.complete||this.loading||!this.confirmationResult)){this.loading=!0,this.error="",this.hasError=!1;try{let e=this.otp.join(""),t=yield this.confirmationResult.confirm(e);console.log("User signed in successfully:",t.user),this.isVerified=!0,this.loading=!1,setTimeout(()=>{this.router.navigate(["/location-permission"],{replaceUrl:!0})},2e3)}catch(e){console.error("Error verifying OTP:",e),e.code==="auth/invalid-verification-code"?this.error="Invalid OTP. Please check and try again.":e.code==="auth/code-expired"?this.error="OTP has expired. Please request a new one.":this.error="Verification failed. Please try again.",this.loading=!1,this.hasError=!0,this.otp=["","","","","",""],this.complete=!1}}})}resend(){return U(this,null,function*(){if(!this.loading){this.loading=!0,this.error="";try{console.log("Current stored phone:",this.phone);let e=this.phone;e.startsWith("+")||(e="+91"+e),console.log("Sending OTP to:",e);let t=yield this.phoneAuthService.sendOtp(e,this.recaptchaVerifier);this.confirmationResult=t,this.phoneAuthService.setConfirmationResult(t),this.startTimer(),this.otp=["","","","","",""],this.complete=!1,this.loading=!1}catch(e){console.error("Resend error:",e),this.error="Failed to resend OTP. Try again later.",this.loading=!1}}})}change(){this.router.navigate(["/phone-input"])}static \u0275fac=function(t){return new(t||n)(Te(xt),Te(tr),Te(Ld),Te(Kt))};static \u0275cmp=Dt({type:n,selectors:[["app-otp"]],outputs:{back:"back",verified:"verified"},standalone:!0,features:[Pt],decls:22,vars:8,consts:[[1,"otp-container"],[1,"otp-section"],[1,"otp-form"],[1,"otp-title"],[1,"otp-subtitle"],[1,"phone-number"],["class","otp-input","type","text","inputmode","numeric","maxlength","1",3,"error-border","ngModel","ngModelChange","input",4,"ngFor","ngForOf"],[1,"verify-btn",3,"click","disabled"],[1,"resend-container"],[1,"resend-text"],["class","timer",4,"ngIf"],["class","resend-link",3,"click",4,"ngIf"],[3,"click"],["id","recaptcha-container-otp"],["class","success-overlay",4,"ngIf"],["type","text","inputmode","numeric","maxlength","1",1,"otp-input",3,"ngModelChange","input","ngModel"],[1,"timer"],[1,"countdown"],[1,"resend-link",3,"click"],[1,"success-overlay"],[1,"success-content"],[1,"checkmark-circle"],[1,"checkmark","draw"]],template:function(t,i){t&1&&(N(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),X(4,"Verify Your Number"),$(),N(5,"p",4),X(6,"We've sent a 6-digit OTP to "),N(7,"span",5),X(8),$()(),N(9,"div",0),Be(10,eJ,1,3,"input",6),$(),N(11,"button",7),ve("click",function(){return i.verify()}),X(12),$(),N(13,"div",8)(14,"p",9),X(15,"Didn't receive OTP?"),$(),Be(16,tJ,4,1,"p",10)(17,nJ,2,0,"p",11),$(),N(18,"div",12),ve("click",function(){return i.change()}),X(19,"\u2190 Change Number"),$(),fe(20,"div",13),$()(),Be(21,iJ,6,0,"div",14),$()),t&2&&(K(8),Ot(i.phone),K(2),ce("ngForOf",bk(7,JX)),K(),ce("disabled",!i.complete||i.loading),K(),pt(" ",i.loading?"Verifying OTP...":"Verify OTP"," "),K(4),ce("ngIf",i.countdown>0),K(),ce("ngIf",i.countdown===0),K(4),ce("ngIf",i.isVerified))},dependencies:[Bi,Vi,Lr,xp,dr,Ut,di,nn],styles:['.otp-section[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:2rem 1rem;background:#fff;font-family:Poppins,sans-serif}.otp-form[_ngcontent-%COMP%]{width:100%;max-width:400px;text-align:center}.otp-title[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:#2c3e50;margin-bottom:.5rem}.otp-subtitle[_ngcontent-%COMP%]{font-size:1rem;color:#7f8c8d;margin-bottom:2.5rem}.phone-number[_ngcontent-%COMP%]{color:#ff6b35;font-weight:600}.otp-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:.5rem;margin-bottom:2rem;width:100%}@media (min-width: 400px){.otp-container[_ngcontent-%COMP%]{gap:1rem}}.otp-input[_ngcontent-%COMP%]{width:100%;max-width:45px;aspect-ratio:1;height:auto;border:1px solid #dee2e6;border-radius:12px;text-align:center;font-size:1.2rem;background:#fff;color:#495057;transition:all .2s;box-shadow:0 2px 5px #00000005;padding:0}@media (min-width: 400px){.otp-input[_ngcontent-%COMP%]{max-width:60px;font-size:1.5rem}}.otp-input[_ngcontent-%COMP%]:focus{border-color:#ff6b35;outline:none;box-shadow:0 0 0 3px #ff6b351a}.error-border[_ngcontent-%COMP%]{border-color:red!important;box-shadow:0 0 0 3px #ff00001a!important}.verify-btn[_ngcontent-%COMP%]{width:100%;padding:1rem;border-radius:12px;border:none;background:#dfe4ea;color:#495057;font-size:1rem;font-weight:600;cursor:not-allowed;margin-bottom:2rem;transition:all .2s}.verify-btn[_ngcontent-%COMP%]:not([disabled]){background:#ff6b35;color:#fff;cursor:pointer;box-shadow:0 4px 10px #ff6b354d}.resend-container[_ngcontent-%COMP%]{margin-bottom:2rem;color:#7f8c8d;font-size:.9rem}.resend-text[_ngcontent-%COMP%]{margin-bottom:.3rem;cursor:pointer;font-size:.9rem;transition:color .2s}.resend-text[_ngcontent-%COMP%]:hover{color:#495057}.timer[_ngcontent-%COMP%]{color:#7f8c8d}.timer[_ngcontent-%COMP%]   .countdown[_ngcontent-%COMP%]{color:#ff6b35;font-weight:600}.resend-link[_ngcontent-%COMP%]{color:#ff6b35;font-weight:600;cursor:pointer;text-decoration:underline}.success-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#fffffff2;display:flex;justify-content:center;align-items:center;z-index:1000;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.success-content[_ngcontent-%COMP%]{text-align:center}.success-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#2c3e50;margin:1rem 0 .5rem;font-size:2rem}.success-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#7f8c8d}.checkmark-circle[_ngcontent-%COMP%]{width:80px;height:80px;position:relative;display:inline-block;vertical-align:top;border-radius:50%;background-color:#2ecc71;animation:_ngcontent-%COMP%_scaleIn .3s cubic-bezier(.175,.885,.32,1.275) forwards}.checkmark[_ngcontent-%COMP%]:after{content:"";display:block;width:20px;height:40px;border:solid #fff;border-width:0 4px 4px 0;position:absolute;top:16px;left:28px;transform:rotate(45deg);opacity:0;animation:_ngcontent-%COMP%_checkmark .3s ease-out .3s forwards}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scaleIn{0%{transform:scale(0)}to{transform:scale(1)}}@keyframes _ngcontent-%COMP%_checkmark{0%{opacity:0;height:0}to{opacity:1;height:40px}}']})};var Or=class n{userLocation=null;locationPromise=null;LOCATION_TIMEOUT_MS=5e3;DEFAULT_LOCATION={latitude:12.9352,longitude:77.6245};AREAS=[{name:"Adugodi",pincode:"560030",lat:12.9716,lng:77.5946},{name:"Agaram",pincode:"560007",lat:12.8431,lng:77.4863},{name:"Air Force Stn. Yelahanka",pincode:"560063",lat:13.1048,lng:77.5763},{name:"Banashankari",pincode:"560050",lat:12.925453,lng:77.546761},{name:"Banashankari 2nd Stage",pincode:"560070",lat:12.9249,lng:77.5662},{name:"Banashankari 3rd Stage",pincode:"560085",lat:12.9216,lng:77.5543},{name:"Banashankari 6th Stage",pincode:"560062",lat:12.8963,lng:77.5353},{name:"Banaswadi",pincode:"560043",lat:13.0159,lng:77.6516},{name:"Basavanapura",pincode:"560036",lat:12.9835,lng:77.6773},{name:"Basaveshwaranagar",pincode:"560079",lat:12.9975,lng:77.5334},{name:"Bellandur",pincode:"560103",lat:12.9304,lng:77.6784},{name:"Bidadi",pincode:"562109",lat:12.8274,lng:77.3971},{name:"Bilekahalli",pincode:"560076",lat:12.8989,lng:77.6103},{name:"Binnamangala",pincode:"560038",lat:12.9837,lng:77.6388},{name:"Bommanahalli",pincode:"560068",lat:12.9082,lng:77.6245},{name:"Bommasandra",pincode:"560099",lat:12.8009,lng:77.699},{name:"Brookefield",pincode:"560037",lat:12.9698,lng:77.7184},{name:"BTM 2nd Stage",pincode:"560076",lat:12.9167,lng:77.6108},{name:"Budigere",pincode:"562129",lat:13.035,lng:77.7478},{name:"Byatarayanapura",pincode:"560026",lat:13.056,lng:77.5926},{name:"C V Raman Nagar",pincode:"560093",lat:12.9767,lng:77.6597},{name:"Chamarajpet",pincode:"560018",lat:12.9582,lng:77.5709},{name:"Channasandra",pincode:"560067",lat:12.9629,lng:77.758},{name:"Chikbasavanapura",pincode:"560067",lat:12.9948,lng:77.7327},{name:"Chickpet",pincode:"560053",lat:12.9662,lng:77.5767},{name:"Chikkalasandra",pincode:"560061",lat:12.9132,lng:77.5454},{name:"Choodasandra",pincode:"560099",lat:12.8848,lng:77.6785},{name:"Cox Town",pincode:"560005",lat:12.9996,lng:77.6229},{name:"D J Halli",pincode:"560005",lat:13.0083,lng:77.6228},{name:"Doddabidarakallu",pincode:"560073",lat:13.0426,lng:77.5019},{name:"Doorvaninagar",pincode:"560016",lat:13.0252,lng:77.6688},{name:"Ejipura",pincode:"560047",lat:12.9437,lng:77.6274},{name:"Electronic City",pincode:"560100",lat:12.8394,lng:77.677},{name:"Frazer Town",pincode:"560005",lat:12.999,lng:77.6226},{name:"Gandhi Nagar",pincode:"560009",lat:12.9772,lng:77.573},{name:"Gavipuram Extn",pincode:"560019",lat:12.9552,lng:77.5668},{name:"Geddalahalli",pincode:"560077",lat:13.0309,lng:77.6389},{name:"Gottigere",pincode:"560083",lat:12.8725,lng:77.5944},{name:"Halasur",pincode:"560042",lat:12.9833,lng:77.6194},{name:"Hebbal",pincode:"560024",lat:13.0355,lng:77.606},{name:"Heggere",pincode:"560073",lat:13.0172,lng:77.5004},{name:"HMT Layout",pincode:"560031",lat:13.039,lng:77.547},{name:"Horamavu",pincode:"560043",lat:13.0267,lng:77.6571},{name:"Hosakerehalli",pincode:"560085",lat:12.9251,lng:77.536},{name:"HSR Layout",pincode:"560102",lat:12.9121,lng:77.6446},{name:"Hulimavu",pincode:"560076",lat:12.8829,lng:77.6083},{name:"Indiranagar",pincode:"560038",lat:12.9719,lng:77.6412},{name:"ISRO Layout",pincode:"560078",lat:12.9056,lng:77.5665},{name:"J P Nagar",pincode:"560078",lat:12.9041,lng:77.5852},{name:"Jakkur",pincode:"560064",lat:13.0811,lng:77.5924},{name:"Jalahalli",pincode:"560013",lat:13.0491,lng:77.5422},{name:"Jayanagar 4th T Block",pincode:"560041",lat:12.9352,lng:77.5837},{name:"Jigani",pincode:"560105",lat:12.7849,lng:77.642},{name:"Kadubeesanahalli",pincode:"560103",lat:12.956,lng:77.7026},{name:"Kadugodi",pincode:"560067",lat:12.9968,lng:77.7583},{name:"Kaggadasapura",pincode:"560093",lat:12.9782,lng:77.6801},{name:"Kalasipalyam",pincode:"560002",lat:12.9636,lng:77.5777},{name:"Kalyananagar",pincode:"560043",lat:13.0288,lng:77.6402},{name:"Kamakshipalya",pincode:"560079",lat:12.9829,lng:77.5208},{name:"Kengeri",pincode:"560060",lat:12.9177,lng:77.4822},{name:"Kodichikkanahalli",pincode:"560068",lat:12.8903,lng:77.6239},{name:"Koramangala",pincode:"560095",lat:12.9344,lng:77.6173},{name:"KR Puram",pincode:"560036",lat:13.0022,lng:77.6951},{name:"Kyalasanahalli",pincode:"560077",lat:13.0269,lng:77.6589},{name:"Laggere",pincode:"560058",lat:13.0102,lng:77.5157},{name:"Mahadevapura",pincode:"560048",lat:12.9923,lng:77.6957},{name:"Majestic",pincode:"560009",lat:12.9779,lng:77.572},{name:"Malleshpalya",pincode:"560075",lat:12.9839,lng:77.6702},{name:"Malleshwaram",pincode:"560003",lat:12.9999,lng:77.5715},{name:"Manorayanapalya",pincode:"560032",lat:13.0365,lng:77.5726},{name:"Marathahalli",pincode:"560037",lat:12.9563,lng:77.7019},{name:"Mathikere",pincode:"560054",lat:13.0307,lng:77.5639},{name:"Munnekollal",pincode:"560037",lat:12.9568,lng:77.7045},{name:"Nagarbhavi",pincode:"560072",lat:12.9674,lng:77.5049},{name:"Nayandahalli",pincode:"560039",lat:12.9413,lng:77.5159},{name:"Neelasandra",pincode:"560047",lat:12.9479,lng:77.6236},{name:"Peenya",pincode:"560058",lat:13.0194,lng:77.5153},{name:"Raghuvanahalli",pincode:"560062",lat:12.8821,lng:77.5466},{name:"Rajajinagar",pincode:"560010",lat:12.9989,lng:77.5536},{name:"Ramamurthy Nagar",pincode:"560016",lat:13.0045,lng:77.6797},{name:"RT Nagar",pincode:"560032",lat:13.0266,lng:77.5979},{name:"Sadashivanagar",pincode:"560080",lat:13.0093,lng:77.5772},{name:"Shanti Nagar",pincode:"560027",lat:12.9537,lng:77.5926},{name:"Tavarekere",pincode:"560029",lat:12.931,lng:77.6106},{name:"Varthur",pincode:"560087",lat:12.9352,lng:77.7501},{name:"Vidyaranyapura",pincode:"560097",lat:13.067,lng:77.56}];locationSource=new Tn(null);currentLocation$=this.locationSource.asObservable();updateLocation(e,t,i){this.setUserLocation(t,i),this.locationSource.next({name:e,lat:t,lng:i})}DEFAULT_LOCATION_DATA={name:"Koramangala",lat:12.9352,lng:77.6245};getUserLocation(){return this.userLocation?Promise.resolve(this.userLocation):this.locationPromise?this.locationPromise:(this.locationPromise=new Promise(e=>{let t=!1,i=setTimeout(()=>{t||(t=!0,console.warn("[LocationService] Timeout expired. Using default location."),this.userLocation=this.DEFAULT_LOCATION,e(this.DEFAULT_LOCATION),this.locationPromise=null)},this.LOCATION_TIMEOUT_MS);if(!("geolocation"in navigator)){t||(t=!0,clearTimeout(i),this.userLocation=this.DEFAULT_LOCATION,e(this.DEFAULT_LOCATION));return}navigator.geolocation.getCurrentPosition(r=>{t||(t=!0,clearTimeout(i),this.userLocation={latitude:r.coords.latitude,longitude:r.coords.longitude},e(this.userLocation))},r=>{t||(t=!0,clearTimeout(i),console.warn("[LocationService] Geolocation error, using default. Code:",r.code),this.userLocation=this.DEFAULT_LOCATION,e(this.DEFAULT_LOCATION))},{enableHighAccuracy:!1,timeout:4e3,maximumAge:6e5})}),this.locationPromise)}setUserLocation(e,t){this.userLocation={latitude:e,longitude:t}}calculateDistance(e,t,i,r){let o=this.toRadians(i-e),a=this.toRadians(r-t),l=Math.sin(o/2)*Math.sin(o/2)+Math.cos(this.toRadians(e))*Math.cos(this.toRadians(i))*Math.sin(a/2)*Math.sin(a/2);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}formatDistance(e){return e<1?`${Math.round(e*1e3)} m`:`${e.toFixed(1)} km`}getDistanceFromUser(e,t){return U(this,null,function*(){let i=yield this.getUserLocation(),r=this.calculateDistance(i.latitude,i.longitude,e,t);return this.formatDistance(r)})}toRadians(e){return e*(Math.PI/180)}clearLocation(){this.userLocation=null}getAreaName(e,t){return this.findNearestArea(e,t)}findNearestArea(e,t){let i="Bangalore",r=1/0;for(let s of this.AREAS){let o=this.calculateDistance(e,t,s.lat,s.lng);o<r&&(r=o,i=s.name)}return i}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})};var rJ=["searchInput"];function sJ(n,e){if(n&1){let t=Tt();N(0,"div",33),ve("click",function(){let r=xe(t).$implicit,s=Ce(2);return Ae(s.selectLocation(r))}),N(1,"div",3),Fe(),N(2,"svg",34),fe(3,"path",35),$()(),Ge(),N(4,"div",36)(5,"div",37),X(6),$(),N(7,"div",38),X(8),$()(),Fe(),N(9,"svg",39),fe(10,"path",40),$()()}if(n&2){let t=e.$implicit;K(6),Ot(t.name),K(2),pt("Pincode: ",t.pincode,"")}}function oJ(n,e){n&1&&(N(0,"div",41),Fe(),N(1,"svg",42),fe(2,"circle",27)(3,"path",28),$(),Ge(),N(4,"p"),X(5,"No locations found"),$(),N(6,"span"),X(7,"Try searching for a different area"),$()())}function aJ(n,e){if(n&1){let t=Tt();N(0,"div",19),ve("click",function(){xe(t);let r=Ce();return Ae(r.closeLocationModal())}),N(1,"div",20),ve("click",function(r){return xe(t),Ae(r.stopPropagation())}),N(2,"div",21)(3,"h2"),X(4,"Select Location"),$(),N(5,"button",22),ve("click",function(){xe(t);let r=Ce();return Ae(r.closeLocationModal())}),Fe(),N(6,"svg",23),fe(7,"path",24),$()()(),Ge(),N(8,"div",25),Fe(),N(9,"svg",26),fe(10,"circle",27)(11,"path",28),$(),Ge(),N(12,"input",29,0),Bn("ngModelChange",function(r){xe(t);let s=Ce();return qn(s.searchQuery,r)||(s.searchQuery=r),Ae(r)}),$()(),N(14,"div",30),Be(15,sJ,11,2,"div",31)(16,oJ,8,0,"div",32),$()()()}if(n&2){let t=Ce();K(12),Vn("ngModel",t.searchQuery),K(3),ce("ngForOf",t.filteredLocations),K(),ce("ngIf",t.filteredLocations.length===0)}}var Zv=class n{constructor(e,t){this.router=e;this.locationService=t}searchInput;showLocationModal=!1;searchQuery="";locations=[{name:"Adugodi",pincode:"560030",lat:12.9716,lng:77.5946},{name:"Agaram",pincode:"560007",lat:12.8431,lng:77.4863},{name:"Air Force Stn. Yelahanka",pincode:"560063",lat:13.1048,lng:77.5763},{name:"Banashankari",pincode:"560050",lat:12.925453,lng:77.546761},{name:"Banashankari 2nd Stage",pincode:"560070",lat:12.9249,lng:77.5662},{name:"Banashankari 3rd Stage",pincode:"560085",lat:12.9216,lng:77.5543},{name:"Banashankari 6th Stage",pincode:"560062",lat:12.8963,lng:77.5353},{name:"Banaswadi",pincode:"560043",lat:13.0159,lng:77.6516},{name:"Basavanapura",pincode:"560036",lat:12.9835,lng:77.6773},{name:"Basaveshwaranagar",pincode:"560079",lat:12.9975,lng:77.5334},{name:"Bellandur",pincode:"560103",lat:12.9304,lng:77.6784},{name:"Bidadi",pincode:"562109",lat:12.8274,lng:77.3971},{name:"Bilekahalli",pincode:"560076",lat:12.8989,lng:77.6103},{name:"Binnamangala",pincode:"560038",lat:12.9837,lng:77.6388},{name:"Bommanahalli",pincode:"560068",lat:12.9082,lng:77.6245},{name:"Bommasandra",pincode:"560099",lat:12.8009,lng:77.699},{name:"Brookefield",pincode:"560037",lat:12.9698,lng:77.7184},{name:"BTM 2nd Stage",pincode:"560076",lat:12.9167,lng:77.6108},{name:"Budigere",pincode:"562129",lat:13.035,lng:77.7478},{name:"Byatarayanapura",pincode:"560026",lat:13.056,lng:77.5926},{name:"C V Raman Nagar",pincode:"560093",lat:12.9767,lng:77.6597},{name:"Chamarajpet",pincode:"560018",lat:12.9582,lng:77.5709},{name:"Channasandra",pincode:"560067",lat:12.9629,lng:77.758},{name:"Chikbasavanapura",pincode:"560067",lat:12.9948,lng:77.7327},{name:"Chickpet",pincode:"560053",lat:12.9662,lng:77.5767},{name:"Chikkalasandra",pincode:"560061",lat:12.9132,lng:77.5454},{name:"Choodasandra",pincode:"560099",lat:12.8848,lng:77.6785},{name:"Cox Town",pincode:"560005",lat:12.9996,lng:77.6229},{name:"D J Halli",pincode:"560005",lat:13.0083,lng:77.6228},{name:"Doddabidarakallu",pincode:"560073",lat:13.0426,lng:77.5019},{name:"Doorvaninagar",pincode:"560016",lat:13.0252,lng:77.6688},{name:"Ejipura",pincode:"560047",lat:12.9437,lng:77.6274},{name:"Electronic City",pincode:"560100",lat:12.8394,lng:77.677},{name:"Frazer Town",pincode:"560005",lat:12.999,lng:77.6226},{name:"Gandhi Nagar",pincode:"560009",lat:12.9772,lng:77.573},{name:"Gavipuram Extn",pincode:"560019",lat:12.9552,lng:77.5668},{name:"Geddalahalli",pincode:"560077",lat:13.0309,lng:77.6389},{name:"Gottigere",pincode:"560083",lat:12.8725,lng:77.5944},{name:"Halasur",pincode:"560042",lat:12.9833,lng:77.6194},{name:"Hebbal",pincode:"560024",lat:13.0355,lng:77.606},{name:"Heggere",pincode:"560073",lat:13.0172,lng:77.5004},{name:"HMT Layout",pincode:"560031",lat:13.039,lng:77.547},{name:"Horamavu",pincode:"560043",lat:13.0267,lng:77.6571},{name:"Hosakerehalli",pincode:"560085",lat:12.9251,lng:77.536},{name:"HSR Layout",pincode:"560102",lat:12.9121,lng:77.6446},{name:"Hulimavu",pincode:"560076",lat:12.8829,lng:77.6083},{name:"Indiranagar",pincode:"560038",lat:12.9719,lng:77.6412},{name:"ISRO Layout",pincode:"560078",lat:12.9056,lng:77.5665},{name:"J P Nagar",pincode:"560078",lat:12.9041,lng:77.5852},{name:"Jakkur",pincode:"560064",lat:13.0811,lng:77.5924},{name:"Jalahalli",pincode:"560013",lat:13.0491,lng:77.5422},{name:"Jayanagar 4th T Block",pincode:"560041",lat:12.9352,lng:77.5837},{name:"Jigani",pincode:"560105",lat:12.7849,lng:77.642},{name:"Kadubeesanahalli",pincode:"560103",lat:12.956,lng:77.7026},{name:"Kadugodi",pincode:"560067",lat:12.9968,lng:77.7583},{name:"Kaggadasapura",pincode:"560093",lat:12.9782,lng:77.6801},{name:"Kalasipalyam",pincode:"560002",lat:12.9636,lng:77.5777},{name:"Kalyananagar",pincode:"560043",lat:13.0288,lng:77.6402},{name:"Kamakshipalya",pincode:"560079",lat:12.9829,lng:77.5208},{name:"Kengeri",pincode:"560060",lat:12.9177,lng:77.4822},{name:"Kodichikkanahalli",pincode:"560068",lat:12.8903,lng:77.6239},{name:"Koramangala",pincode:"560095",lat:12.9344,lng:77.6173},{name:"KR Puram",pincode:"560036",lat:13.0022,lng:77.6951},{name:"Kyalasanahalli",pincode:"560077",lat:13.0269,lng:77.6589},{name:"Laggere",pincode:"560058",lat:13.0102,lng:77.5157},{name:"Mahadevapura",pincode:"560048",lat:12.9923,lng:77.6957},{name:"Majestic",pincode:"560009",lat:12.9779,lng:77.572},{name:"Malleshpalya",pincode:"560075",lat:12.9839,lng:77.6702},{name:"Malleshwaram",pincode:"560003",lat:12.9999,lng:77.5715},{name:"Manorayanapalya",pincode:"560032",lat:13.0365,lng:77.5726},{name:"Marathahalli",pincode:"560037",lat:12.9563,lng:77.7019},{name:"Mathikere",pincode:"560054",lat:13.0307,lng:77.5639},{name:"Munnekollal",pincode:"560037",lat:12.9568,lng:77.7045},{name:"Nagarbhavi",pincode:"560072",lat:12.9674,lng:77.5049},{name:"Nayandahalli",pincode:"560039",lat:12.9413,lng:77.5159},{name:"Neelasandra",pincode:"560047",lat:12.9479,lng:77.6236},{name:"Peenya",pincode:"560058",lat:13.0194,lng:77.5153},{name:"Raghuvanahalli",pincode:"560062",lat:12.8821,lng:77.5466},{name:"Rajajinagar",pincode:"560010",lat:12.9989,lng:77.5536},{name:"Ramamurthy Nagar",pincode:"560016",lat:13.0045,lng:77.6797},{name:"RT Nagar",pincode:"560032",lat:13.0266,lng:77.5979},{name:"Sadashivanagar",pincode:"560080",lat:13.0093,lng:77.5772},{name:"Shanti Nagar",pincode:"560027",lat:12.9537,lng:77.5926},{name:"Tavarekere",pincode:"560029",lat:12.931,lng:77.6106},{name:"Varthur",pincode:"560087",lat:12.9352,lng:77.7501},{name:"Vidyaranyapura",pincode:"560097",lat:13.067,lng:77.56}];ngAfterViewInit(){this.showLocationModal&&this.searchInput&&setTimeout(()=>this.searchInput?.nativeElement.focus(),300)}allow(){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(e=>{let t=e.coords.latitude,i=e.coords.longitude,r=this.locationService.findNearestArea(t,i);this.locationService.setUserLocation(t,i),this.router.navigate(["/main-app"],{replaceUrl:!0,state:{location:r,latitude:t,longitude:i}})},e=>{console.error("Location error:",e),alert("Location denied or unavailable")},{enableHighAccuracy:!0,timeout:1e4}):alert("Geolocation not supported")}manual(){this.showLocationModal=!0,this.searchQuery="",setTimeout(()=>this.searchInput?.nativeElement.focus(),300)}closeLocationModal(){this.showLocationModal=!1,this.searchQuery=""}selectLocation(e){this.locationService.setUserLocation(e.lat,e.lng),this.router.navigate(["/main-app"],{replaceUrl:!0,state:{location:e.name,latitude:e.lat,longitude:e.lng}})}get filteredLocations(){if(!this.searchQuery.trim())return this.locations;let e=this.searchQuery.toLowerCase();return this.locations.filter(t=>t.name.toLowerCase().includes(e)||t.pincode.includes(e))}static \u0275fac=function(t){return new(t||n)(Te(xt),Te(Or))};static \u0275cmp=Dt({type:n,selectors:[["app-location-permission"]],viewQuery:function(t,i){if(t&1&&er(rJ,5),t&2){let r;Oi(r=Ni())&&(i.searchInput=r.first)}},standalone:!0,features:[Pt],decls:31,vars:1,consts:[["searchInput",""],[1,"location-section"],[1,"location-form"],[1,"location-icon"],["width","80","height","80","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","locationGradient","x1","0%","y1","0%","x2","100%","y2","100%"],["offset","0%",2,"stop-color","#ff6b35","stop-opacity","1"],["offset","100%",2,"stop-color","#ff8c5a","stop-opacity","1"],["d","M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z","fill","url(#locationGradient)"],[1,"location-title"],[1,"location-subtitle"],[1,"location-benefits"],[1,"benefit-item"],[1,"benefit-icon"],[1,"benefit-text"],[1,"allow-location-btn",3,"click"],[1,"manual-location-btn",3,"click"],[1,"location-privacy"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"location-modal",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],["width","24","height","24","viewBox","0 0 24 24","fill","none"],["d","M18 6L6 18M6 6l12 12","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"search-box"],["width","20","height","20","viewBox","0 0 24 24","fill","none",1,"search-icon"],["cx","11","cy","11","r","8","stroke","currentColor","stroke-width","2"],["d","M21 21l-4.35-4.35","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["type","text","placeholder","Search for a location...",1,"search-input",3,"ngModelChange","ngModel"],[1,"locations-list"],["class","location-item",3,"click",4,"ngFor","ngForOf"],["class","no-results",4,"ngIf"],[1,"location-item",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","none"],["d","M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z","fill","currentColor"],[1,"location-info"],[1,"location-name"],[1,"location-area"],["width","20","height","20","viewBox","0 0 24 24","fill","none",1,"chevron-right"],["d","M9 18l6-6-6-6","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"no-results"],["width","48","height","48","viewBox","0 0 24 24","fill","none"]],template:function(t,i){t&1&&(N(0,"div",1)(1,"div",2)(2,"div",3),Fe(),N(3,"svg",4)(4,"defs")(5,"linearGradient",5),fe(6,"stop",6)(7,"stop",7),$()(),fe(8,"path",8),$()(),Ge(),N(9,"h2",9),X(10,"Find Street Food Near You"),$(),N(11,"p",10),X(12,"We need your location to show you the best street food options around you"),$(),N(13,"div",11)(14,"div",12)(15,"span",13),X(16,"\u{1F3AF}"),$(),N(17,"span",14),X(18,"Discover food stalls nearby"),$()(),N(19,"div",12)(20,"span",13),X(21,"\u{1F4B0}"),$(),N(22,"span",14),X(23,"See accurate prices & distance"),$()()(),N(24,"button",15),ve("click",function(){return i.allow()}),X(25,"Allow Location Access"),$(),N(26,"button",16),ve("click",function(){return i.manual()}),X(27,"Select Location Manually"),$(),N(28,"p",17),X(29,"Your location data is secure and only used to show nearby food options."),$()(),Be(30,aJ,17,3,"div",18),$()),t&2&&(K(30),ce("ngIf",i.showLocationModal))},dependencies:[Ut,di,nn,Bi,Vi,Lr,dr],styles:[".location-section[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:2rem 1.5rem;background:#fff;font-family:Poppins,sans-serif}.location-form[_ngcontent-%COMP%]{width:100%;max-width:400px;text-align:center}.location-icon[_ngcontent-%COMP%]{margin-bottom:1.5rem;display:inline-block;animation:_ngcontent-%COMP%_float 3s ease-in-out infinite}.location-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{filter:drop-shadow(0 4px 12px rgba(255,107,53,.3))}@keyframes _ngcontent-%COMP%_float{0%,to{transform:translateY(0)}50%{transform:translateY(-10px)}}.location-title[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:#2c3e50;margin-bottom:.5rem}.location-subtitle[_ngcontent-%COMP%]{font-size:1rem;color:#7f8c8d;margin-bottom:2.5rem;line-height:1.5}.location-benefits[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin-bottom:2.5rem}.benefit-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem;border-radius:12px;text-align:left}.benefit-icon[_ngcontent-%COMP%]{font-size:1.5rem;margin-right:1rem;width:40px;height:40px;display:flex;align-items:center;justify-content:center;background:#fff;border-radius:50%;box-shadow:0 2px 5px #0000000d}.benefit-text[_ngcontent-%COMP%]{font-weight:500;color:#34495e}.allow-location-btn[_ngcontent-%COMP%]{width:100%;padding:1.2rem;background:#ff6b35;color:#fff;border-radius:12px;border:none;font-size:1.1rem;font-weight:600;cursor:pointer;box-shadow:0 4px 15px #ff6b354d;transition:transform .2s;display:flex;align-items:center;justify-content:center;gap:.5rem;margin-bottom:1rem}.allow-location-btn[_ngcontent-%COMP%]:active{transform:scale(.98)}.manual-location-btn[_ngcontent-%COMP%]{width:100%;padding:1.1rem;border-radius:12px;border:2px solid #e9ecef;background:#fff;color:#7f8c8d;font-weight:600;cursor:pointer;transition:all .2s}.manual-location-btn[_ngcontent-%COMP%]:hover{border-color:#ced4da;color:#495057}.location-privacy[_ngcontent-%COMP%]{font-size:.8rem;color:#adb5bd;margin-top:2rem;padding:1rem;background:#f8f9fa;border-radius:8px;border-left:3px solid #ff6b35;text-align:left;line-height:1.4}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000c;backdrop-filter:blur(1px);z-index:100;display:flex;align-items:flex-end;animation:_ngcontent-%COMP%_fadeIn .2s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.location-modal[_ngcontent-%COMP%]{background:#1a1a1a;width:100%;max-height:80vh;border-radius:24px 24px 0 0;display:flex;flex-direction:column;animation:_ngcontent-%COMP%_slideUp .3s cubic-bezier(.4,0,.2,1)}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(100%)}to{transform:translateY(0)}}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:24px 20px 16px;border-bottom:1px solid rgba(255,255,255,.1)}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#fff;margin:0}.modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:transparent;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#888;cursor:pointer;border-radius:50%;transition:all .2s ease}.modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#fff}.modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]:active{transform:scale(.95)}.search-box[_ngcontent-%COMP%]{padding:16px 20px;position:relative;border-bottom:1px solid rgba(255,255,255,.1)}.search-box[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{position:absolute;left:36px;top:50%;transform:translateY(-50%);color:#666;pointer-events:none}.search-box[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{width:100%;padding:14px 16px 14px 48px;background:#ffffff0d;border:1px solid rgba(255,255,255,.1);border-radius:12px;color:#fff;font-size:15px;transition:all .2s ease;box-sizing:border-box}.search-box[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]::placeholder{color:#666}.search-box[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]:focus{outline:none;background:#ffffff14;border-color:#ff6b35;box-shadow:0 0 0 3px #ff6b351a}.locations-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:8px 0}.location-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:16px 20px;cursor:pointer;transition:all .2s ease;border-bottom:1px solid rgba(255,255,255,.05)}.location-item[_ngcontent-%COMP%]:hover{background:#ffffff0d}.location-item[_ngcontent-%COMP%]:active{background:#ffffff1a;transform:scale(.98)}.location-item[_ngcontent-%COMP%]   .location-icon[_ngcontent-%COMP%]{width:40px;height:40px;background:#ff6b351a;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#ff6b35;flex-shrink:0}.location-item[_ngcontent-%COMP%]   .location-info[_ngcontent-%COMP%]{flex:1;min-width:0}.location-item[_ngcontent-%COMP%]   .location-info[_ngcontent-%COMP%]   .location-name[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#fff;margin-bottom:4px}.location-item[_ngcontent-%COMP%]   .location-info[_ngcontent-%COMP%]   .location-area[_ngcontent-%COMP%]{font-size:13px;color:#888}.location-item[_ngcontent-%COMP%]   .chevron-right[_ngcontent-%COMP%]{color:#666;flex-shrink:0}.no-results[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center;color:#666}.no-results[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{margin-bottom:16px;opacity:.5}.no-results[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin:0 0 8px;color:#888}.no-results[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;color:#666}@media (min-width: 768px){.location-modal[_ngcontent-%COMP%]{max-width:500px;margin:0 auto;border-radius:24px;max-height:70vh}.modal-overlay[_ngcontent-%COMP%]{align-items:center}}"],data:{animation:[qI("fadeIn",[Sf(":enter",[Ls({opacity:0}),bf("200ms ease-out",Ls({opacity:1}))]),Sf(":leave",[bf("200ms ease-in",Ls({opacity:0}))])]),qI("slideUp",[Sf(":enter",[Ls({transform:"translateY(100%)",opacity:0}),bf("300ms cubic-bezier(0.4, 0, 0.2, 1)",Ls({transform:"translateY(0)",opacity:1}))]),Sf(":leave",[bf("200ms ease-in",Ls({transform:"translateY(100%)",opacity:0}))])])]}})};var Ie=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},lJ=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=cJ},cJ=Number.MAX_SAFE_INTEGER||9007199254740991,Oe=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),Q=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),b=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({}),mt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},De={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},sl=class{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){let i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){let e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}},AA=class{constructor(e,t,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new sl(e),this.fast_=new sl(t),this.defaultTTFB_=r,this.ttfb_=new sl(e)}update(e,t){let{slow_:i,fast_:r,ttfb_:s}=this;i.halfLife!==e&&(this.slow_=new sl(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.fast_=new sl(t,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new sl(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);let i=8*t,r=e/1e3,s=i/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(e){let t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}};function uJ(n,e,t){return(e=hJ(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function zt(){return zt=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},zt.apply(null,arguments)}function qV(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function jt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?qV(Object(t),!0).forEach(function(i){uJ(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):qV(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function dJ(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function hJ(n){var e=dJ(n,"string");return typeof e=="symbol"?e:e+""}var ji=class{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;let i=`[${e}]:`;this.trace=ol,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}},ol=function(){},fJ={trace:ol,debug:ol,log:ol,warn:ol,info:ol,error:ol};function DA(){return zt({},fJ)}function pJ(n,e){let t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):ol}function WV(n,e,t){return e[n]?e[n].bind(e):pJ(n,t)}var PA=DA();function mJ(n,e,t){let i=DA();if(typeof console=="object"&&n===!0||typeof n=="object"){let r=["debug","log","info","warn","error"];r.forEach(s=>{i[s]=WV(s,n,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return DA()}r.forEach(s=>{PA[s]=WV(s,n)})}else zt(PA,i);return i}var Gt=PA;function al(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function gJ(n){return typeof self<"u"&&n===self.ManagedMediaSource}function rU(n,e){let t=Object.keys(n),i=Object.keys(e),r=t.length,s=i.length;return!r||!s||r===s&&!t.some(o=>i.indexOf(o)===-1)}function mr(n,e=!1){if(typeof TextDecoder<"u"){let u=new TextDecoder("utf-8").decode(n);if(e){let d=u.indexOf("\0");return d!==-1?u.substring(0,d):u}return u.replace(/\0/g,"")}let t=n.length,i,r,s,o="",a=0;for(;a<t;){if(i=n[a++],i===0&&e)return o;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:r=n[a++],o+=String.fromCharCode((i&31)<<6|r&63);break;case 14:r=n[a++],s=n[a++],o+=String.fromCharCode((i&15)<<12|(r&63)<<6|(s&63)<<0);break}}return o}function si(n){let e="";for(let t=0;t<n.length;t++){let i=n[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}function sU(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function yJ(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var oA={exports:{}},KV;function vJ(){return KV||(KV=1,function(n,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,u,d){if(d=d||{},l=l.trim(),u=u.trim(),!u){if(!d.alwaysNormalize)return l;var f=a.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");return f.path=a.normalizePath(f.path),a.buildURLFromParts(f)}var m=a.parseURL(u);if(!m)throw new Error("Error trying to parse relative URL.");if(m.scheme)return d.alwaysNormalize?(m.path=a.normalizePath(m.path),a.buildURLFromParts(m)):u;var y=a.parseURL(l);if(!y)throw new Error("Error trying to parse base URL.");if(!y.netLoc&&y.path&&y.path[0]!=="/"){var v=r.exec(y.path);y.netLoc=v[1],y.path=v[2]}y.netLoc&&!y.path&&(y.path="/");var E={scheme:y.scheme,netLoc:m.netLoc,path:null,params:m.params,query:m.query,fragment:m.fragment};if(!m.netLoc&&(E.netLoc=y.netLoc,m.path[0]!=="/"))if(!m.path)E.path=y.path,m.params||(E.params=y.params,m.query||(E.query=y.query));else{var T=y.path,C=T.substring(0,T.lastIndexOf("/")+1)+m.path;E.path=a.normalizePath(C)}return E.path===null&&(E.path=d.alwaysNormalize?a.normalizePath(m.path):m.path),a.buildURLFromParts(E)},parseURL:function(l){var u=i.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=a})()}(oA)),oA.exports}var WD=vJ(),Op=class{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},Yt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},__=class{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,_J(this,"stats")}setByteRange(e,t){let i=e.split("@",2),r;i.length===1?r=t?.byteRangeEndOffset||0:r=parseInt(i[1]),this._byteRange=[r,parseInt(i[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Yt.AUDIO]:null,[Yt.VIDEO]:null,[Yt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Op),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=WD.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){let{elementaryStreams:e}=this;e[Yt.AUDIO]=null,e[Yt.VIDEO]=null,e[Yt.AUDIOVIDEO]=null}};function In(n){return n.sn!=="initSegment"}var Rp=class extends __{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){let e=this.stats.total;if(e)return e}if(this.byteRange.length){let e=this.byteRange[0],t=this.byteRange[1];if(Ie(e)&&Ie(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;let{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){let i=Object.keys(t);if(i.length===1){let r=this._decryptdata=t[i[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;let e=Ie(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;let i=Object.keys(this.levelkeys),r=i.length;if(r>1||r===1&&(t=this.levelkeys[i[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Ie(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return In(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){let t=this.levelkeys;if(t){var i;let r=t[e];r&&!((i=this._decryptdata)!=null&&i.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,r,s,o=!1){let{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:i,startDTS:r,endDTS:s,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,i),l.startDTS=Math.min(l.startDTS,r),l.endDTS=Math.max(l.endDTS,s)}},RA=class extends __{constructor(e,t,i,r,s){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;let o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){let{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}};function oU(n,e){let t=Object.getPrototypeOf(n);if(t){let i=Object.getOwnPropertyDescriptor(t,e);return i||oU(t,e)}}function _J(n,e){let t=oU(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}var YV=Math.pow(2,32)-1,EJ=[].push,aU={video:1,audio:2,id3:3,text:4};function $n(n){return String.fromCharCode.apply(null,n)}function lU(n,e){let t=n[e]<<8|n[e+1];return t<0?65536+t:t}function He(n,e){let t=cU(n,e);return t<0?4294967296+t:t}function QV(n,e){let t=He(n,e);return t*=Math.pow(2,32),t+=He(n,e+4),t}function cU(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function TJ(n){let e=n.byteLength;for(let t=0;t<e;){let i=He(n,t);if(i>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=i>1?t+i:e}return!1}function ht(n,e){let t=[];if(!e.length)return t;let i=n.byteLength;for(let r=0;r<i;){let s=He(n,r),o=$n(n.subarray(r+4,r+8)),a=s>1?r+s:i;if(o===e[0])if(e.length===1)t.push(n.subarray(r+8,a));else{let l=ht(n.subarray(r+8,a),e.slice(1));l.length&&EJ.apply(t,l)}r=a}return t}function wJ(n){let e=[],t=n[0],i=8,r=He(n,i);i+=4;let s=0,o=0;t===0?(s=He(n,i),o=He(n,i+4),i+=8):(s=QV(n,i),o=QV(n,i+8),i+=16),i+=2;let a=n.length+o,l=lU(n,i);i+=2;for(let u=0;u<l;u++){let d=i,f=He(n,d);d+=4;let m=f&2147483647;if((f&2147483648)>>>31===1)return Gt.warn("SIDX has hierarchical references (not supported)"),null;let v=He(n,d);d+=4,e.push({referenceSize:m,subsegmentDuration:v,info:{duration:v/r,start:a,end:a+m-1}}),a+=m,d+=4,i=d}return{earliestPresentationTime:s,timescale:r,version:t,referencesCount:l,references:e}}function uU(n){let e=[],t=ht(n,["moov","trak"]);for(let r=0;r<t.length;r++){let s=t[r],o=ht(s,["tkhd"])[0];if(o){let a=o[0],l=He(o,a===0?12:20),u=ht(s,["mdia","mdhd"])[0];if(u){a=u[0];let d=He(u,a===0?12:20),f=ht(s,["mdia","hdlr"])[0];if(f){let m=$n(f.subarray(8,12)),y={soun:Yt.AUDIO,vide:Yt.VIDEO}[m],v=ht(s,["mdia","minf","stbl","stsd"])[0],E=IJ(v);y?(e[l]={timescale:d,type:y,stsd:E},e[y]=jt({timescale:d,id:l},E)):e[l]={timescale:d,type:m,stsd:E}}}}}return ht(n,["moov","mvex","trex"]).forEach(r=>{let s=He(r,4),o=e[s];o&&(o.default={duration:He(r,12),flags:He(r,20)})}),e}function IJ(n){let e=n.subarray(8),t=e.subarray(86),i=$n(e.subarray(4,8)),r=i,s,o=i==="enca"||i==="encv";if(o){let u=ht(e,[i])[0].subarray(i==="enca"?28:78);ht(u,["sinf"]).forEach(f=>{let m=ht(f,["schm"])[0];if(m){let y=$n(m.subarray(4,8));if(y==="cbcs"||y==="cenc"){let v=ht(f,["frma"])[0];v&&(r=$n(v))}}})}let a=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{let l=ht(t,["avcC"])[0];l&&l.length>3&&(r+="."+Jv(l[1])+Jv(l[2])+Jv(l[3]),s=Xv(a==="avc1"?"dva1":"dvav",t));break}case"mp4a":{let l=ht(e,[i])[0],u=ht(l.subarray(28),["esds"])[0];if(u&&u.length>7){let d=4;if(u[d++]!==3)break;d=aA(u,d),d+=2;let f=u[d++];if(f&128&&(d+=2),f&64&&(d+=u[d++]),u[d++]!==4)break;d=aA(u,d);let m=u[d++];if(m===64)r+="."+Jv(m);else break;if(d+=12,u[d++]!==5)break;d=aA(u,d);let y=u[d++],v=(y&248)>>3;v===31&&(v+=1+((y&7)<<3)+((u[d]&224)>>5)),r+="."+v}break}case"hvc1":case"hev1":{let l=ht(t,["hvcC"])[0];if(l&&l.length>12){let u=l[1],d=["","A","B","C"][u>>6],f=u&31,m=He(l,2),y=(u&32)>>5?"H":"L",v=l[12],E=l.subarray(6,12);r+="."+d+f,r+="."+bJ(m).toString(16).toUpperCase(),r+="."+y+v;let T="";for(let C=E.length;C--;){let D=E[C];(D||T)&&(T="."+D.toString(16).toUpperCase()+T)}r+=T}s=Xv(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=Xv(r,t)||r;break}case"vp09":{let l=ht(t,["vpcC"])[0];if(l&&l.length>6){let u=l[4],d=l[5],f=l[6]>>4&15;r+="."+Qs(u)+"."+Qs(d)+"."+Qs(f)}break}case"av01":{let l=ht(t,["av1C"])[0];if(l&&l.length>2){let u=l[1]>>>5,d=l[1]&31,f=l[2]>>>7?"H":"M",m=(l[2]&64)>>6,y=(l[2]&32)>>5,v=u===2&&m?y?12:10:m?10:8,E=(l[2]&16)>>4,T=(l[2]&8)>>3,C=(l[2]&4)>>2,D=l[2]&3;r+="."+u+"."+Qs(d)+f+"."+Qs(v)+"."+E+"."+T+C+D+"."+Qs(1)+"."+Qs(1)+"."+Qs(1)+"."+0,s=Xv("dav1",t)}break}}return{codec:r,encrypted:o,supplemental:s}}function Xv(n,e){let t=ht(e,["dvvC"]),i=t.length?t[0]:ht(e,["dvcC"])[0];if(i){let r=i[2]>>1&127,s=i[2]<<5&32|i[3]>>3&31;return n+"."+Qs(r)+"."+Qs(s)}}function bJ(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function aA(n,e){let t=e+5;for(;n[e++]&128&&e<t;);return e}function Jv(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function Qs(n){return(n<10?"0":"")+n}function SJ(n,e){if(!n||!e)return;let t=e.keyId;t&&e.isCommonEncryption&&dU(n,(i,r)=>{let s=i.subarray(8,24);s.some(o=>o!==0)||(Gt.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${si(s)} -> ${si(t)}`),i.set(t,8))})}function CJ(n){let e=[];return dU(n,t=>e.push(t.subarray(8,24))),e}function dU(n,e){ht(n,["moov","trak"]).forEach(i=>{let r=ht(i,["mdia","minf","stbl","stsd"])[0];if(!r)return;let s=r.subarray(8),o=ht(s,["enca"]),a=o.length>0;a||(o=ht(s,["encv"])),o.forEach(l=>{let u=a?l.subarray(28):l.subarray(78);ht(u,["sinf"]).forEach(f=>{let m=hU(f);m&&e(m,a)})})})}function hU(n){let e=ht(n,["schm"])[0];if(e){let t=$n(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){let i=ht(n,["schi","tenc"])[0];if(i)return i}}}function xJ(n,e,t){let i={},r=ht(n,["moof","traf"]);for(let s=0;s<r.length;s++){let o=r[s],a=ht(o,["tfhd"])[0],l=He(a,4),u=e[l];if(!u)continue;i[l]||(i[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});let d=i[l],f=ht(o,["tfdt"])[0];if(f){let P=f[0],V=He(f,4);P===1&&(V===YV?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(V*=YV+1,V+=He(f,8))),Ie(V)&&(!Ie(d.start)||V<d.start)&&(d.start=V)}let m=u.default,y=He(a,0)|m?.flags,v=m?.duration||0;y&8&&(y&2?v=He(a,12):v=He(a,8));let E=ht(o,["trun"]),T=d.start||0,C=0,D=v;for(let P=0;P<E.length;P++){let V=E[P],G=He(V,4),H=d.sampleCount;d.sampleCount+=G;let A=V[3]&1,x=V[3]&4,R=V[2]&1,M=V[2]&2,F=V[2]&4,j=V[2]&8,B=8,pe=G;for(A&&(B+=4),x&&G&&(!(V[B+1]&1)&&d.keyFrameIndex===void 0&&(d.keyFrameIndex=H),B+=4,R?(D=He(V,B),B+=4):D=v,M&&(B+=4),j&&(B+=4),T+=D,C+=D,pe--);pe--;)R?(D=He(V,B),B+=4):D=v,M&&(B+=4),F&&(V[B+1]&1||d.keyFrameIndex===void 0&&(d.keyFrameIndex=d.sampleCount-(pe+1),d.keyFrameStart=T),B+=4),j&&(B+=4),T+=D,C+=D;!C&&v&&(C+=v*G)}d.duration+=C}if(!Object.keys(i).some(s=>i[s].duration)){let s=1/0,o=0,a=ht(n,["sidx"]);for(let l=0;l<a.length;l++){let u=wJ(a[l]);if(u!=null&&u.references){s=Math.min(s,u.earliestPresentationTime/u.timescale);let d=u.references.reduce((f,m)=>f+m.info.duration||0,0);o=Math.max(o,d+u.earliestPresentationTime/u.timescale)}}o&&Ie(o)&&Object.keys(i).forEach(l=>{i[l].duration||(i[l].duration=o*i[l].timescale-i[l].start)})}return i}function AJ(n){let e={valid:null,remainder:null},t=ht(n,["moof"]);if(t.length<2)return e.remainder=n,e;let i=t[t.length-1];return e.valid=n.slice(0,i.byteOffset-8),e.remainder=n.slice(i.byteOffset-8),e}function Nr(n,e){let t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function ZV(n,e){let t=[],i=e.samples,r=e.timescale,s=e.id,o=!1;return ht(i,["moof"]).map(l=>{let u=l.byteOffset-8;ht(l,["traf"]).map(f=>{let m=ht(f,["tfdt"]).map(y=>{let v=y[0],E=He(y,4);return v===1&&(E*=Math.pow(2,32),E+=He(y,8)),E/r})[0];return m!==void 0&&(n=m),ht(f,["tfhd"]).map(y=>{let v=He(y,4),E=He(y,0)&16777215,T=(E&1)!==0,C=(E&2)!==0,D=(E&8)!==0,P=0,V=(E&16)!==0,G=0,H=(E&32)!==0,A=8;v===s&&(T&&(A+=8),C&&(A+=4),D&&(P=He(y,A),A+=4),V&&(G=He(y,A),A+=4),H&&(A+=4),e.type==="video"&&(o=z_(e.codec)),ht(f,["trun"]).map(x=>{let R=x[0],M=He(x,0)&16777215,F=(M&1)!==0,j=0,B=(M&4)!==0,pe=(M&256)!==0,Ee=0,q=(M&512)!==0,te=0,W=(M&1024)!==0,ne=(M&2048)!==0,ye=0,oe=He(x,4),ie=8;F&&(j=He(x,ie),ie+=4),B&&(ie+=4);let de=j+u;for(let he=0;he<oe;he++){if(pe?(Ee=He(x,ie),ie+=4):Ee=P,q?(te=He(x,ie),ie+=4):te=G,W&&(ie+=4),ne&&(R===0?ye=He(x,ie):ye=cU(x,ie),ie+=4),e.type===Yt.VIDEO){let Ne=0;for(;Ne<te;){let je=He(i,de);if(de+=4,DJ(o,i[de])){let Je=i.subarray(de,de+je);KD(Je,o?2:1,n+ye/r,t)}de+=je,Ne+=je+4}}n+=Ee/r}}))})})}),t}function z_(n){if(!n)return!1;let e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function DJ(n,e){if(n){let t=e>>1&63;return t===39||t===40}else return(e&31)===6}function KD(n,e,t,i){let r=fU(n),s=0;s+=e;let o=0,a=0,l=0;for(;s<r.length;){o=0;do{if(s>=r.length)break;l=r[s++],o+=l}while(l===255);a=0;do{if(s>=r.length)break;l=r[s++],a+=l}while(l===255);let u=r.length-s,d=s;if(a<u)s+=a;else if(a>u){Gt.error(`Malformed SEI payload. ${a} is too small, only ${u} bytes left to parse.`);break}if(o===4){if(r[d++]===181){let m=lU(r,d);if(d+=2,m===49){let y=He(r,d);if(d+=4,y===1195456820){let v=r[d++];if(v===3){let E=r[d++],T=31&E,C=64&E,D=C?2+T*3:0,P=new Uint8Array(D);if(C){P[0]=E;for(let V=1;V<D;V++)P[V]=r[d++]}i.push({type:v,payloadType:o,pts:t,bytes:P})}}}}}else if(o===5&&a>16){let f=[];for(let v=0;v<16;v++){let E=r[d++].toString(16);f.push(E.length==1?"0"+E:E),(v===3||v===5||v===7||v===9)&&f.push("-")}let m=a-16,y=new Uint8Array(m);for(let v=0;v<m;v++)y[v]=r[d++];i.push({payloadType:o,pts:t,uuid:f.join(""),userData:mr(y),userDataBytes:y})}}}function fU(n){let e=n.byteLength,t=[],i=1;for(;i<e-2;)n[i]===0&&n[i+1]===0&&n[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return n;let r=e-t.length,s=new Uint8Array(r),o=0;for(i=0;i<r;o++,i++)o===t[0]&&(o++,t.shift()),s[i]=n[o];return s}function PJ(n){let e=n[0],t="",i="",r=0,s=0,o=0,a=0,l=0,u=0;if(e===0){for(;$n(n.subarray(u,u+1))!=="\0";)t+=$n(n.subarray(u,u+1)),u+=1;for(t+=$n(n.subarray(u,u+1)),u+=1;$n(n.subarray(u,u+1))!=="\0";)i+=$n(n.subarray(u,u+1)),u+=1;i+=$n(n.subarray(u,u+1)),u+=1,r=He(n,12),s=He(n,16),a=He(n,20),l=He(n,24),u=28}else if(e===1){u+=4,r=He(n,u),u+=4;let f=He(n,u);u+=4;let m=He(n,u);for(u+=4,o=2**32*f+m,lJ(o)||(o=Number.MAX_SAFE_INTEGER,Gt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=He(n,u),u+=4,l=He(n,u),u+=4;$n(n.subarray(u,u+1))!=="\0";)t+=$n(n.subarray(u,u+1)),u+=1;for(t+=$n(n.subarray(u,u+1)),u+=1;$n(n.subarray(u,u+1))!=="\0";)i+=$n(n.subarray(u,u+1)),u+=1;i+=$n(n.subarray(u,u+1)),u+=1}let d=n.subarray(u,n.byteLength);return{schemeIdUri:t,value:i,timeScale:r,presentationTime:o,presentationTimeDelta:s,eventDuration:a,id:l,payload:d}}function RJ(n,...e){let t=e.length,i=8,r=t;for(;r--;)i+=e[r].byteLength;let s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=i&255,s.set(n,4),r=0,i=8;r<t;r++)s.set(e[r],i),i+=e[r].byteLength;return s}function MJ(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let i,r;i=0,r=new Uint8Array;let s;i>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;let o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),RJ([112,115,115,104],new Uint8Array([i,0,0,0]),n,s,r,o,t)}function kJ(n){let e=[];if(n instanceof ArrayBuffer){let t=n.byteLength,i=0;for(;i+32<t;){let r=new DataView(n,i),s=LJ(r);e.push(s),i+=s.size}}return e}function LJ(n){let e=n.getUint32(0),t=n.byteOffset,i=n.byteLength;if(i<e)return{offset:t,size:i};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};let s=n.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};let o=n.buffer,a=si(new Uint8Array(o,t+12,16)),l=null,u=null,d=0;if(s===0)d=28;else{let m=n.getUint32(28);if(!m||i<32+m*16)return{offset:t,size:e};l=[];for(let y=0;y<m;y++)l.push(new Uint8Array(o,t+32+y*16,16));d=32+m*16}if(!d)return{offset:t,size:e};let f=n.getUint32(d);return e-32<f?{offset:t,size:e}:(u=new Uint8Array(o,t+d+4,f),{version:s,systemId:a,kids:l,data:u,offset:t,size:e})}var pU=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Wd={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function YD(n,e){let t=Wd[e];return!!t&&!!t[n.slice(0,4)]}function Np(n,e,t=!0){return!n.split(",").some(i=>!QD(i,e,t))}function QD(n,e,t=!0){var i;let r=al(t);return(i=r?.isTypeSupported(Fp(n,e)))!=null?i:!1}function Fp(n,e){return`${e}/mp4;codecs=${n}`}function XV(n){if(n){let e=n.substring(0,4);return Wd.video[e]}return 2}function E_(n){let e=pU();return n.split(",").reduce((t,i)=>{let s=e&&z_(i)?9:Wd.video[i];return s?(s*2+t)/(t?3:2):(Wd.audio[i]+t)/(t?2:1)},0)}var lA={};function OJ(n,e=!0){if(lA[n])return lA[n];let t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let r=0;r<t.length;r++){var i;if(QD(t[r],"audio",e))return lA[n]=t[r],t[r];if(t[r]==="mp3"&&(i=al(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return n}var NJ=/flac|opus|mp4a\.40\.34/i;function T_(n,e=!0){return n.replace(NJ,t=>OJ(t.toLowerCase(),e))}function FJ(n,e){let t=[];if(n){let i=n.split(",");for(let r=0;r<i.length;r++)YD(i[r],"video")||t.push(i[r])}return e&&t.push(e),t.join(",")}function h_(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(JV(n,"audio")||JV(n,"video")))return n;if(e){let t=e.split(",");if(t.length>1){if(n){for(let i=t.length;i--;)if(t[i].substring(0,4)===n.substring(0,4))return t[i]}return t[0]}}return e||n}function JV(n,e){return YD(n,e)&&QD(n,e)}function VJ(n){let e=n.split(",");for(let t=0;t<e.length;t++){let i=e[t].split(".");i.length>2&&i[0]==="avc1"&&(e[t]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function BJ(n){if(n.startsWith("av01.")){let e=n.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return n}function eB(n){let e=al(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function MA(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}var UJ={supported:!0,powerEfficient:!0,smooth:!0},$J={supported:!1,smooth:!1,powerEfficient:!1},mU={supported:!0,configurations:[],decodingInfoResults:[UJ]};function gU(n,e){return{supported:!1,configurations:e,decodingInfoResults:[$J],error:n}}function jJ(n,e,t,i,r,s){let o=n.videoCodec,a=n.audioCodec?n.audioGroups:null,l=s?.audioCodec,u=s?.channels,d=u?parseInt(u):l?1/0:2,f=null;if(a!=null&&a.length)try{a.length===1&&a[0]?f=e.groups[a[0]].channels:f=a.reduce((m,y)=>{if(y){let v=e.groups[y];if(!v)throw new Error(`Audio track group ${y} not found`);Object.keys(v.channels).forEach(E=>{m[E]=(m[E]||0)+v.channels[E]})}return m},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(m=>z_(m))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(i,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(r,8e6))||!!f&&Ie(d)&&Object.keys(f).some(m=>parseInt(m)>d)}function yU(n,e,t,i={}){let r=n.videoCodec;if(!r&&!n.audioCodec||!t)return Promise.resolve(mU);let s=[],o=GJ(n),a=o.length,l=zJ(n,e,a>0),u=l.length;for(let d=a||1*u||1;d--;){let f={type:"media-source"};if(a&&(f.video=o[d%a]),u){f.audio=l[d%u];let m=f.audio.bitrate;f.video&&m&&(f.video.bitrate-=m)}s.push(f)}if(r){let d=navigator.userAgent;if(r.split(",").some(f=>z_(f))&&pU())return Promise.resolve(gU(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${d})`),s))}return Promise.all(s.map(d=>{let f=qJ(d);return i[f]||(i[f]=t.decodingInfo(d))})).then(d=>({supported:!d.some(f=>!f.supported),configurations:s,decodingInfoResults:d})).catch(d=>({supported:!1,configurations:s,decodingInfoResults:[],error:d}))}function GJ(n){var e;let t=(e=n.videoCodec)==null?void 0:e.split(","),i=vU(n),r=n.width||640,s=n.height||480,o=n.frameRate||30,a=n.videoRange.toLowerCase();return t?t.map(l=>{let u={contentType:Fp(BJ(l),"video"),width:r,height:s,bitrate:i,framerate:o};return a!=="sdr"&&(u.transferFunction=a),u}):[]}function zJ(n,e,t){var i;let r=(i=n.audioCodec)==null?void 0:i.split(","),s=vU(n);return r&&n.audioGroups?n.audioGroups.reduce((o,a)=>{var l;let u=a?(l=e.groups[a])==null?void 0:l.tracks:null;return u?u.reduce((d,f)=>{if(f.groupId===a){let m=parseFloat(f.channels||"");r.forEach(y=>{let v={contentType:Fp(y,"audio"),bitrate:t?HJ(y,s):s};m&&(v.channels=""+m),d.push(v)})}return d},o):o},[]):[]}function HJ(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function vU(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function qJ(n){let e="",{audio:t,video:i}=n;if(i){let r=MA(i.contentType);e+=`${r}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(t){let r=MA(t.contentType);e+=`${i?"_":""}${r}_c${t.channels}`}return e}var kA=["NONE","TYPE-0","TYPE-1",null];function WJ(n){return kA.indexOf(n)>-1}var w_=["SDR","PQ","HLG"];function KJ(n){return!!n&&w_.indexOf(n)>-1}var f_={No:"",Yes:"YES",v2:"v2"};function tB(n){let{canSkipUntil:e,canSkipDateRanges:t,age:i}=n,r=i<e/2;return e&&r?t?f_.v2:f_.Yes:f_.No}var I_=class{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){let t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}},Vc=class{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;let i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return nB(this._audioGroups,e)}hasSubtitleGroup(e){return nB(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}};function nB(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function YJ(){if(typeof matchMedia=="function"){let n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function QJ(n,e){let t=!1,i=[];if(n&&(t=n!=="SDR",i=[n]),e){i=e.allowedVideoRanges||w_.slice(0);let r=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&YJ(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}var ZJ=n=>{let e=new WeakSet;return(t,i)=>{if(n&&(i=n(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},Qt=(n,e)=>JSON.stringify(n,ZJ(e));function XJ(n,e,t,i,r){let s=Object.keys(n),o=i?.channels,a=i?.audioCodec,l=r?.videoCodec,u=o&&parseInt(o)===2,d=!1,f=!1,m=1/0,y=1/0,v=1/0,E=1/0,T=0,C=[],{preferHDR:D,allowedVideoRanges:P}=QJ(e,r);for(let x=s.length;x--;){let R=n[s[x]];d||(d=R.channels[2]>0),m=Math.min(m,R.minHeight),y=Math.min(y,R.minFramerate),v=Math.min(v,R.minBitrate),P.filter(F=>R.videoRanges[F]>0).length>0&&(f=!0)}m=Ie(m)?m:0,y=Ie(y)?y:0;let V=Math.max(1080,m),G=Math.max(30,y);v=Ie(v)?v:t,t=Math.max(v,t),f||(e=void 0);let H=s.length>1;return{codecSet:s.reduce((x,R)=>{let M=n[R];if(R===x)return x;if(C=f?P.filter(F=>M.videoRanges[F]>0):[],H){if(M.minBitrate>t)return Ks(R,`min bitrate of ${M.minBitrate} > current estimate of ${t}`),x;if(!M.hasDefaultAudio)return Ks(R,"no renditions with default or auto-select sound found"),x;if(a&&R.indexOf(a.substring(0,4))%5!==0)return Ks(R,`audio codec preference "${a}" not found`),x;if(o&&!u){if(!M.channels[o])return Ks(R,`no renditions with ${o} channel sound found (channels options: ${Object.keys(M.channels)})`),x}else if((!a||u)&&d&&M.channels[2]===0)return Ks(R,"no renditions with stereo sound found"),x;if(M.minHeight>V)return Ks(R,`min resolution of ${M.minHeight} > maximum of ${V}`),x;if(M.minFramerate>G)return Ks(R,`min framerate of ${M.minFramerate} > maximum of ${G}`),x;if(!C.some(F=>M.videoRanges[F]>0))return Ks(R,`no variants with VIDEO-RANGE of ${Qt(C)} found`),x;if(l&&R.indexOf(l.substring(0,4))%5!==0)return Ks(R,`video codec preference "${l}" not found`),x;if(M.maxScore<T)return Ks(R,`max score of ${M.maxScore} < selected max of ${T}`),x}return x&&(E_(R)>=E_(x)||M.fragmentError>n[x].fragmentError)?x:(E=M.minIndex,T=M.maxScore,R)},void 0),videoRanges:C,preferHDR:D,minFramerate:y,minBitrate:v,minIndex:E}}function Ks(n,e){Gt.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function _U(n){return n.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);let r=t.channels||"2";return i.channels[r]=(i.channels[r]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function JJ(n,e,t,i){return n.slice(t,i+1).reduce((r,s,o)=>{if(!s.codecSet)return r;let a=s.audioGroups,l=r[s.codecSet];l||(r[s.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,s.bitrate);let u=Math.min(s.height,s.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,s.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,s.score),l.fragmentError+=s.fragmentError,l.videoRanges[s.videoRange]=(l.videoRanges[s.videoRange]||0)+1,a&&a.forEach(d=>{if(!d)return;let f=e.groups[d];f&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?f.hasDefault:f.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(f.channels).forEach(m=>{l.channels[m]=(l.channels[m]||0)+f.channels[m]}))}),r},{})}function iB(n){if(!n)return n;let{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:s}=n;return{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:s}}function Xs(n,e,t){if("attrs"in n){let i=e.indexOf(n);if(i!==-1)return i}for(let i=0;i<e.length;i++){let r=e[i];if(Nc(n,r,t))return i}return-1}function Nc(n,e,t){let{groupId:i,name:r,lang:s,assocLang:o,default:a}=n,l=n.forced;return(i===void 0||e.groupId===i)&&(r===void 0||e.name===r)&&(s===void 0||eee(s,e.lang))&&(s===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||tee(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function eee(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function tee(n,e=""){let t=n.split(","),i=e.split(",");return t.length===i.length&&!t.some(r=>i.indexOf(r)===-1)}function Lc(n,e){let{audioCodec:t,channels:i}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function nee(n,e,t,i,r){let s=e[i],a=e.reduce((m,y,v)=>{let E=y.uri;return(m[E]||(m[E]=[])).push(v),m},{})[s.uri];a.length>1&&(i=Math.max.apply(Math,a));let l=s.videoRange,u=s.frameRate,d=s.codecSet.substring(0,4),f=rB(e,i,m=>{if(m.videoRange!==l||m.frameRate!==u||m.codecSet.substring(0,4)!==d)return!1;let y=m.audioGroups,v=t.filter(E=>!y||y.indexOf(E.groupId)!==-1);return Xs(n,v,r)>-1});return f>-1?f:rB(e,i,m=>{let y=m.audioGroups,v=t.filter(E=>!y||y.indexOf(E.groupId)!==-1);return Xs(n,v,r)>-1})}function rB(n,e,t){for(let i=e;i>-1;i--)if(t(n[i]))return i;for(let i=e+1;i<n.length;i++)if(t(n[i]))return i;return-1}function b_(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}var LA=class extends ji{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;let{fragCurrent:r,partCurrent:s,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!r||!l)return;let u=performance.now(),d=s?s.stats:r.stats,f=s?s.duration:r.duration,m=u-d.loading.start,y=o.minAutoLevel,v=r.level,E=this._nextAutoLevel;if(d.aborted||d.loaded&&d.loaded===d.total||v<=y){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;let T=E>-1&&E!==v,C=!!t||T;if(!C&&(l.paused||!l.playbackRate||!l.readyState))return;let D=o.mainForwardBufferInfo;if(!C&&D===null)return;let P=this.bwEstimator.getEstimateTTFB(),V=Math.abs(l.playbackRate);if(m<=Math.max(P,1e3*(f/(V*2))))return;let G=D?D.len/V:0,H=d.loading.first?d.loading.first-d.loading.start:-1,A=d.loaded&&H>-1,x=this.getBwEstimate(),R=o.levels,M=R[v],F=Math.max(d.loaded,Math.round(f*(r.bitrate||M.averageBitrate)/8)),j=A?m-H:m;j<1&&A&&(j=Math.min(m,d.loaded*8/x));let B=A?d.loaded*1e3/j:0,pe=P/1e3,Ee=B?(F-d.loaded)/B:F*8/x+pe;if(Ee<=G)return;let q=B?B*8:x,te=((i=t?.details||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,W=this.hls.config.abrBandWidthUpFactor,ne=Number.POSITIVE_INFINITY,ye;for(ye=v-1;ye>y;ye--){let he=R[ye].maxBitrate,Ne=!R[ye].details||te;if(ne=this.getTimeToLoadFrag(pe,q,f*he,Ne),ne<Math.min(G,f+pe))break}if(ne>=Ee||ne>f*10)return;A?this.bwEstimator.sample(m-Math.min(P,H),d.loaded):this.bwEstimator.sampleTTFB(m);let oe=R[ye].maxBitrate;this.getBwEstimate()*W>oe&&this.resetEstimator(oe);let ie=this.findBestLevel(oe,y,ye,0,G,1,1);ie>-1&&(ye=ie),this.warn(`Fragment ${r.sn}${s?" part "+s.index:""} of level ${v} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${G.toFixed(3)} s
      Estimated load time for current fragment: ${Ee.toFixed(3)} s
      Estimated load time for down switch fragment: ${ne.toFixed(3)} s
      TTFB estimate: ${H|0} ms
      Current BW estimate: ${Ie(x)?x|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${ye} @ ${oe|0} bps`),o.nextLoadLevel=o.nextAutoLevel=ye,this.clearTimer();let de=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===ye&&ye>0){let he=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${ye>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${he.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,ye>y){let Ne=this.findBestLevel(this.hls.levels[y].bitrate,y,ye,0,he,1,1);Ne===-1&&(Ne=y),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Ne,this.resetEstimator(this.hls.levels[Ne].bitrate)}}};T||Ee>ne*2?de():this.timer=self.setInterval(de,ne*1e3),o.trigger(b.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:s,stats:d})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){let e=this.hls.config;return new AA(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){let{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e&&(e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(b.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){let i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var r;this.fragCurrent=i,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Q.FRAG_LOAD_TIMEOUT:{let i=t.frag,{fragCurrent:r,partCurrent:s}=this;if(i&&r&&i.sn===r.sn&&i.level===r.level){let o=performance.now(),a=s?s.stats:i.stats,l=o-a.loading.start,u=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&u>-1){let f=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(f,u),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,i,r){let s=e+i/t,o=r?e+this.lastLevelLoadSec:0;return s+o}onLevelLoaded(e,t){let i=this.hls.config,{loading:r}=t.stats,s=r.end-r.first;Ie(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){let r=i?i.stats:t.stats;if(t.type===De.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){let s=i?i.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+r.loaded,l=(o.loaded?o.loaded.duration:0)+s;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){let s={stats:r,frag:t,part:i,id:t.type};this.onFragBuffered(b.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){let{frag:i,part:r}=t,s=r!=null&&r.stats.loaded?r.stats:i.stats;if(s.aborted||this.ignoreFragment(i))return;let o=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,s.loaded),s.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==De.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){let{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,s=this.findBestLevel(i,t,e,0,r,1,1);if(s>-1)return s;let o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){let e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;let s=i&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){let o=this.hls.levels;if(o.length>Math.max(e,s)&&o[e].loadError<=o[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){let{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;let{maxAutoLevel:r,config:s,minAutoLevel:o}=i,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay(),d=s.abrBandWidthFactor,f=s.abrBandWidthUpFactor;if(u){let T=this.findBestLevel(l,o,r,u,0,d,f);if(T>=0)return this.rebufferNotice=-1,T}let m=a?Math.min(a,s.maxStarvationDelay):s.maxStarvationDelay;if(!u){let T=this.bitrateTestDelay;T&&(m=(a?Math.min(a,s.maxLoadingDelay):s.maxLoadingDelay)-T,this.info(`bitrate test took ${Math.round(1e3*T)}ms, set first fragment max fetchDuration to ${Math.round(1e3*m)} ms`),d=f=1)}let y=this.findBestLevel(l,o,r,u,m,d,f);if(this.rebufferNotice!==y&&(this.rebufferNotice=y,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${y}`)),y>-1)return y;let v=i.levels[o],E=i.loadLevelObj;return E&&v?.bitrate<E.bitrate?o:i.loadLevel}getStarvationDelay(){let e=this.hls,t=e.media;if(!t)return 1/0;let i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,r,s,o,a){var l;let u=r+s,d=this.lastLoadedFragLevel,f=d===-1?this.hls.firstLevel:d,{fragCurrent:m,partCurrent:y}=this,{levels:v,allAudioTracks:E,loadLevel:T,config:C}=this.hls;if(v.length===1)return 0;let D=v[f],P=!!((l=this.hls.latestLevelDetails)!=null&&l.live),V=T===-1||d===-1,G,H="SDR",A=D?.frameRate||0,{audioPreference:x,videoPreference:R}=C,M=this.audioTracksByGroup||(this.audioTracksByGroup=_U(E)),F=-1;if(V){if(this.firstSelection!==-1)return this.firstSelection;let q=this.codecTiers||(this.codecTiers=JJ(v,M,t,i)),te=XJ(q,H,e,x,R),{codecSet:W,videoRanges:ne,minFramerate:ye,minBitrate:oe,minIndex:ie,preferHDR:de}=te;F=ie,G=W,H=de?ne[ne.length-1]:ne[0],A=ye,e=Math.max(e,oe),this.log(`picked start tier ${Qt(te)}`)}else G=D?.codecSet,H=D?.videoRange;let j=y?y.duration:m?m.duration:0,B=this.bwEstimator.getEstimateTTFB()/1e3,pe=[];for(let q=i;q>=t;q--){var Ee;let te=v[q],W=q>f;if(!te)continue;if(C.useMediaCapabilities&&!te.supportedResult&&!te.supportedPromise){let Ne=navigator.mediaCapabilities;typeof Ne?.decodingInfo=="function"&&jJ(te,M,H,A,e,x)?(te.supportedPromise=yU(te,M,Ne,this.supportedCache),te.supportedPromise.then(je=>{if(!this.hls)return;te.supportedResult=je;let Je=this.hls.levels,Mt=Je.indexOf(te);je.error?this.warn(`MediaCapabilities decodingInfo error: "${je.error}" for level ${Mt} ${Qt(je)}`):je.supported?je.decodingInfoResults.some(kt=>kt.smooth===!1||kt.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Mt} not smooth or powerEfficient: ${Qt(je)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Mt} ${Qt(je)}`),Mt>-1&&Je.length>1&&(this.log(`Removing unsupported level ${Mt}`),this.hls.removeLevel(Mt),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(je=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${je}`)})):te.supportedResult=mU}if((G&&te.codecSet!==G||H&&te.videoRange!==H||W&&A>te.frameRate||!W&&A>0&&A<te.frameRate||(Ee=te.supportedResult)!=null&&(Ee=Ee.decodingInfoResults)!=null&&Ee.some(Ne=>Ne.smooth===!1))&&(!V||q!==F)){pe.push(q);continue}let ne=te.details,ye=(y?ne?.partTarget:ne?.averagetargetduration)||j,oe;W?oe=a*e:oe=o*e;let ie=j&&r>=j*2&&s===0?te.averageBitrate:te.maxBitrate,de=this.getTimeToLoadFrag(B,oe,ie*ye,ne===void 0);if(oe>=ie&&(q===d||te.loadError===0&&te.fragmentError===0)&&(de<=B||!Ie(de)||P&&!this.bitrateTestDelay||de<u)){let Ne=this.forcedAutoLevel;return q!==T&&(Ne===-1||Ne!==T)&&(pe.length&&this.trace(`Skipped level(s) ${pe.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${v[pe[0]].codecs}" ${v[pe[0]].videoRange}; not compatible with "${G}" ${H}`),this.info(`switch candidate:${f}->${q} adjustedbw(${Math.round(oe)})-bitrate=${Math.round(oe-ie)} ttfb:${B.toFixed(1)} avgDuration:${ye.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${de.toFixed(1)} firstSelection:${V} codecSet:${te.codecSet} videoRange:${te.videoRange} hls.loadLevel:${T}`)),V&&(this.firstSelection=q),q}}return-1}set nextAutoLevel(e){let t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){let{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}},EU={search:function(n,e){let t=0,i=n.length-1,r=null,s=null;for(;t<=i;){r=(t+i)/2|0,s=n[r];let o=e(s);if(o>0)t=r+1;else if(o<0)i=r-1;else return s}return null}};function iee(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!Ie(e))return null;let i=n[0].programDateTime;if(e<(i||0))return null;let r=n[n.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let s=0;s<n.length;++s){let o=n[s];if(see(e,t,o))return o}return null}function Bc(n,e,t=0,i=0,r=.005){let s=null;if(n){s=e[1+n.sn-e[0].sn]||null;let a=n.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),s&&n.level!==s.level&&s.end<=n.end&&(s=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!n||n.level===s.level)&&sB(t,i,s)===0||ree(s,n,Math.min(r,i))))return s;let o=EU.search(e,sB.bind(null,t,i));return o&&(o!==n||!s)?o:s}function ree(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){let i=e.tagList.reduce((r,s)=>(s[0]==="INF"&&(r+=parseFloat(s[1])),r),t);return n.start<=i}return!1}function sB(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;let i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=n?1:t.start-i>n&&t.start?-1:0}function see(n,e,t){let i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>n}function TU(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let i=n.fragments,{fragmentHint:r}=n;r&&(i=i.concat(r));let s;return EU.search(i,o=>o.cc<e?1:o.cc>e?-1:(s=o,o.end<=t?1:o.start>t?-1:0)),s||null}return null}function S_(n){switch(n.details){case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_TIMEOUT:case Q.LEVEL_LOAD_TIMEOUT:case Q.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function wU(n){return n.details.startsWith("key")}function IU(n){return wU(n)&&!!n.frag&&!n.frag.decryptdata}function oB(n,e){let t=S_(e);return n.default[`${t?"timeout":"error"}Retry`]}function ZD(n,e){let t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function aB(n){return jt(jt({},n),{errorRetry:null,timeoutRetry:null})}function C_(n,e,t,i){if(!n)return!1;let r=i?.code,s=e<n.maxNumRetry&&(oee(r)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,i,s):s}function oee(n){return OA(n)||!!n&&(n<400||n>499)}function OA(n){return n===0&&navigator.onLine===!1}var Xn={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},hr={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4,SwitchToSDR:8},NA=class extends ji{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){let e=this.hls;e.on(b.ERROR,this.onError,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){let e=this.hls;e&&(e.off(b.ERROR,this.onError,this),e.off(b.ERROR,this.onErrorOut,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===De.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;let t=this.hls,i=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||i===-1?t.loadLevel:i}variantHasKey(e,t){if(e){var i;if((i=e.details)!=null&&i.hasKey(t))return!0;let r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(o=>r.indexOf(o.groupId)>=0).some(o=>{var a;return(a=o.details)==null?void 0:a.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;let r=this.hls,s=t.context;switch(t.details){case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Q.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=Gd();return}case Q.FRAG_GAP:case Q.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Xn.SendAlternateToPenaltyBox;return}case Q.LEVEL_EMPTY_ERROR:case Q.LEVEL_PARSING_ERROR:{var o;let l=t.parent===De.MAIN?t.level:r.loadLevel;t.details===Q.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case Q.LEVEL_LOAD_ERROR:case Q.LEVEL_LOAD_TIMEOUT:typeof s?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case Q.AUDIO_TRACK_LOAD_ERROR:case Q.AUDIO_TRACK_LOAD_TIMEOUT:case Q.SUBTITLE_LOAD_ERROR:case Q.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){let l=r.loadLevelObj;if(l&&(s.type===mt.AUDIO_TRACK&&l.hasAudioGroup(s.groupId)||s.type===mt.SUBTITLE_TRACK&&l.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Xn.SendAlternateToPenaltyBox,t.errorAction.flags=hr.MoveAllAlternatesMatchingHost;return}}return;case Q.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Xn.SendAlternateToPenaltyBox,flags:hr.MoveAllAlternatesMatchingHDCP};return;case Q.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Q.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Q.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Xn.SendAlternateToPenaltyBox,flags:hr.MoveAllAlternatesMatchingKey};return;case Q.BUFFER_ADD_CODEC_ERROR:case Q.REMUX_ALLOC_ERROR:case Q.BUFFER_APPEND_ERROR:if(!t.errorAction){var a;t.errorAction=this.getLevelSwitchAction(t,(a=t.level)!=null?a:r.loadLevel)}return;case Q.INTERNAL_EXCEPTION:case Q.BUFFER_APPENDING_ERROR:case Q.BUFFER_FULL_ERROR:case Q.LEVEL_SWITCH_ERROR:case Q.BUFFER_STALLED_ERROR:case Q.BUFFER_SEEK_OVER_HOLE:case Q.BUFFER_NUDGE_ON_STALL:t.errorAction=Gd();return}t.type===Oe.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Gd())}getPlaylistRetryOrSwitchAction(e,t){let i=this.hls,r=oB(i.config.playlistLoadPolicy,e),s=this.playlistError++;if(C_(r,s,S_(e),e.response))return{action:Xn.RetryRequest,flags:hr.None,retryConfig:r,retryCount:s};let a=this.getLevelSwitchAction(e,t);return r&&(a.retryConfig=r,a.retryCount=s),a}getFragRetryOrSwitchAction(e){let t=this.hls,i=this.getVariantLevelIndex(e.frag),r=t.levels[i],{fragLoadPolicy:s,keyLoadPolicy:o}=t.config,a=oB(wU(e)?o:s,e),l=t.levels.reduce((d,f)=>d+f.fragmentError,0);if(r&&(e.details!==Q.FRAG_GAP&&r.fragmentError++,!IU(e)&&C_(a,l,S_(e),e.response)))return{action:Xn.RetryRequest,flags:hr.None,retryConfig:a,retryCount:l};let u=this.getLevelSwitchAction(e,i);return a&&(u.retryConfig=a,u.retryCount=l),u}getLevelSwitchAction(e,t){let i=this.hls;t==null&&(t=i.loadLevel);let r=this.hls.levels[t];if(r){var s,o;let u=e.details;r.loadError++,u===Q.BUFFER_APPEND_ERROR&&r.fragmentError++;let d=-1,{levels:f,loadLevel:m,minAutoLevel:y,maxAutoLevel:v}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);let E=(s=e.frag)==null?void 0:s.type,C=(E===De.AUDIO&&u===Q.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===Q.BUFFER_ADD_CODEC_ERROR||u===Q.BUFFER_APPEND_ERROR))&&f.some(({audioCodec:H})=>r.audioCodec!==H),P=e.sourceBufferName==="video"&&(u===Q.BUFFER_ADD_CODEC_ERROR||u===Q.BUFFER_APPEND_ERROR)&&f.some(({codecSet:H,audioCodec:A})=>r.codecSet!==H&&r.audioCodec===A),{type:V,groupId:G}=(o=e.context)!=null?o:{};for(let H=f.length;H--;){let A=(H+m)%f.length;if(A!==m&&A>=y&&A<=v&&f[A].loadError===0){var a,l;let x=f[A];if(u===Q.FRAG_GAP&&E===De.MAIN&&e.frag){let R=f[A].details;if(R){let M=Bc(e.frag,R.fragments,e.frag.start);if(M!=null&&M.gap)continue}}else{if(V===mt.AUDIO_TRACK&&x.hasAudioGroup(G)||V===mt.SUBTITLE_TRACK&&x.hasSubtitleGroup(G))continue;if(E===De.AUDIO&&(a=r.audioGroups)!=null&&a.some(R=>x.hasAudioGroup(R))||E===De.SUBTITLE&&(l=r.subtitleGroups)!=null&&l.some(R=>x.hasSubtitleGroup(R))||C&&r.audioCodec===x.audioCodec||P&&r.codecSet===x.codecSet||!C&&r.codecSet!==x.codecSet)continue}d=A;break}}if(d>-1&&i.loadLevel!==d)return e.levelRetry=!0,this.playlistError=0,{action:Xn.SendAlternateToPenaltyBox,flags:hr.None,nextAutoLevel:d}}return{action:Xn.SendAlternateToPenaltyBox,flags:hr.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case Xn.DoNothing:break;case Xn.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Q.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break;case Xn.RetryRequest:break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){let t=this.hls,i=e.errorAction;if(!i)return;let{flags:r}=i,s=i.nextAutoLevel;switch(r){case hr.None:this.switchLevel(e,s);break;case hr.MoveAllAlternatesMatchingHDCP:{let l=this.getVariantLevelIndex(e.frag),u=t.levels[l],d=u?.attrs["HDCP-LEVEL"];if(i.hdcpLevel=d,d==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(d){t.maxHdcpLevel=kA[kA.indexOf(d)-1],i.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case hr.MoveAllAlternatesMatchingKey:{let l=e.decryptdata;if(l){let u=this.hls.levels,d=u.length;for(let m=d;m--;)if(this.variantHasKey(u[m],l)){var o,a;this.log(`Banned key found in level ${m} (${u[m].bitrate}bps) or audio group "${(o=u[m].audioGroups)==null?void 0:o.join(",")}" (${(a=e.frag)==null?void 0:a.type} fragment) ${si(l.keyId||[])}`),u[m].fragmentError++,u[m].loadError++,this.log(`Removing level ${m} with key error (${e.error})`),this.hls.removeLevel(m)}let f=e.frag;if(this.hls.levels.length<d)i.resolved=!0;else if(f&&f.type!==De.MAIN){let m=f.decryptdata;m&&!l.matches(m)&&(i.resolved=!0)}}break}}i.resolved||this.switchLevel(e,s)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Q.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){let i=MA(e.mimeType),r=this.hls.levels;for(let s=r.length;s--;)r[s][`${e.sourceBufferName}Codec`]===i&&(this.log(`Removing level ${s} for ${e.details} ("${i}" not supported)`),this.hls.removeLevel(s))}}};function Gd(n){let e={action:Xn.DoNothing,flags:hr.None};return n&&(e.resolved=!0),e}var jn={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},FA=class{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){let{hls:e}=this;e&&(e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.BUFFER_APPENDED,this.onBufferAppended,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){let{hls:e}=this;e&&(e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.BUFFER_APPENDED,this.onBufferAppended,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){let i=this.activePartLists[t];if(i)for(let r=i.length;r--;){let s=i[r];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){let{fragments:r}=this,s=Object.keys(r);for(let o=s.length;o--;){let a=r[s[o]];if(a?.body.type===t&&(!i||a.buffered)){let l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,i,r,s){this.timeRanges&&(this.timeRanges[e]=t);let o=r?.fragment.sn||-1;Object.keys(this.fragments).forEach(a=>{let l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||s)){l.body.type===i&&this.removeFragment(l.body);return}let u=l.range[e];if(u){if(u.time.length===0){this.removeFragment(l.body);return}u.time.some(d=>{let f=!this.isTimeBuffered(d.startPTS,d.endPTS,t);return f&&this.removeFragment(l.body),f})}})}detectPartialFragments(e){let t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;let i=e.frag,r=Od(i),s=this.fragments[r];if(!s||s.buffered&&i.gap)return;let o=!i.relurl;Object.keys(t).forEach(a=>{let l=i.elementaryStreams[a];if(!l)return;let u=t[a],d=o||l.partial===!0;s.range[a]=this.getBufferedTimes(i,e.part,d,u)}),s.loaded=null,Object.keys(s.range).length?(this.bufferedEnd(s,i),e_(s)||this.removeParts(i.sn-1,i.type)):this.removeFragment(s.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){let i=this.activePartLists[t];i&&(this.activePartLists[t]=lB(i,r=>r.fragment.sn>=e))}fragBuffered(e,t){let i=Od(e),r=this.fragments[i];!r&&t&&(r=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,e))}getBufferedTimes(e,t,i,r){let s={time:[],partial:i},o=e.start,a=e.end,l=e.minEndPTS||a,u=e.maxStartPTS||o;for(let d=0;d<r.length;d++){let f=r.start(d)-this.bufferPadding,m=r.end(d)+this.bufferPadding;if(u>=f&&l<=m){s.time.push({startPTS:Math.max(o,r.start(d)),endPTS:Math.min(a,r.end(d))});break}else if(o<m&&a>f){let y=Math.max(o,r.start(d)),v=Math.min(a,r.end(d));v>y&&(s.partial=!0,s.time.push({startPTS:y,endPTS:v}))}else if(a<=f)break}return s}getPartialFragment(e){let t=null,i,r,s,o=0,{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(u=>{let d=l[u];d&&e_(d)&&(r=d.body.start-a,s=d.body.end+a,e>=r&&e<=s&&(i=Math.min(e-r,s-e),o<=i&&(t=d.body,o=i)))}),t}isEndListAppended(e){let t=this.endListFragments[e];return t!==void 0&&(t.buffered||e_(t))}getState(e){let t=Od(e),i=this.fragments[t];return i?i.buffered?e_(i)?jn.PARTIAL:jn.OK:jn.APPENDING:jn.NOT_LOADED}isTimeBuffered(e,t,i){let r,s;for(let o=0;o<i.length;o++){if(r=i.start(o)-this.bufferPadding,s=i.end(o)+this.bufferPadding,e>=r&&t<=s)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;let i=t.frag,r=t.part?null:t,s=Od(i);this.fragments[s]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){let{frag:i,part:r,timeRanges:s,type:o}=t;if(i.sn==="initSegment")return;let a=i.type;if(r){let u=this.activePartLists[a];u||(this.activePartLists[a]=u=[]),u.push(r)}this.timeRanges=s;let l=s[o];this.detectEvictedFragments(o,l,a,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){let t=Od(e);return!!this.fragments[t]}hasFragments(e){let{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let r=i.length;r--;){let s=t[i[r]];if(s?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{let a=this.fragments[o];if(!a)return;let l=a.body;l.type!==i||r&&!l.gap||l.start<t&&l.end>e&&(a.buffered||s)&&this.removeFragment(l)})}removeFragment(e){let t=Od(e);e.clearElementaryStreamInfo();let i=this.activePartLists[e.type];if(i){let r=e.sn;this.activePartLists[e.type]=lB(i,s=>s.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;let t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(i=>i.clearElementaryStreamInfo())}};function e_(n){var e,t,i;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(i=n.range.audiovideo)!=null&&i.partial)}function Od(n){return`${n.type}_${n.level}_${n.sn}`}function lB(n,e){return n.filter(t=>{let i=e(t);return i||t.clearElementaryStreamInfo(),i})}var ll={cbc:0,ctr:1},VA=class{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case ll.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case ll.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}};function aee(n){let e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}var BA=class{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){let t=new DataView(e),i=new Uint32Array(4);for(let r=0;r<4;r++)i[r]=t.getUint32(r*4);return i}initTable(){let e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],s=i[1],o=i[2],a=i[3],l=this.invSubMix,u=l[0],d=l[1],f=l[2],m=l[3],y=new Uint32Array(256),v=0,E=0,T=0;for(T=0;T<256;T++)T<128?y[T]=T<<1:y[T]=T<<1^283;for(T=0;T<256;T++){let C=E^E<<1^E<<2^E<<3^E<<4;C=C>>>8^C&255^99,e[v]=C,t[C]=v;let D=y[v],P=y[D],V=y[P],G=y[C]*257^C*16843008;r[v]=G<<24|G>>>8,s[v]=G<<16|G>>>16,o[v]=G<<8|G>>>24,a[v]=G,G=V*16843009^P*65537^D*257^v*16843008,u[C]=G<<24|G>>>8,d[C]=G<<16|G>>>16,f[C]=G<<8|G>>>24,m[C]=G,v?(v=D^y[y[y[V^D]]],E^=y[y[E]]):v=E=1}}expandKey(e){let t=this.uint8ArrayToUint32Array_(e),i=!0,r=0;for(;r<t.length&&i;)i=t[r]===this.key[r],r++;if(i)return;this.key=t;let s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);let o=this.ksRows=(s+6+1)*4,a,l,u=this.keySchedule=new Uint32Array(o),d=this.invKeySchedule=new Uint32Array(o),f=this.sBox,m=this.rcon,y=this.invSubMix,v=y[0],E=y[1],T=y[2],C=y[3],D,P;for(a=0;a<o;a++){if(a<s){D=u[a]=t[a];continue}P=D,a%s===0?(P=P<<8|P>>>24,P=f[P>>>24]<<24|f[P>>>16&255]<<16|f[P>>>8&255]<<8|f[P&255],P^=m[a/s|0]<<24):s>6&&a%s===4&&(P=f[P>>>24]<<24|f[P>>>16&255]<<16|f[P>>>8&255]<<8|f[P&255]),u[a]=D=(u[a-s]^P)>>>0}for(l=0;l<o;l++)a=o-l,l&3?P=u[a]:P=u[a-4],l<4||a<=4?d[l]=P:d[l]=v[f[P>>>24]]^E[f[P>>>16&255]]^T[f[P>>>8&255]]^C[f[P&255]],d[l]=d[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){let r=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],u=a[1],d=a[2],f=a[3],m=this.uint8ArrayToUint32Array_(i),y=m[0],v=m[1],E=m[2],T=m[3],C=new Int32Array(e),D=new Int32Array(C.length),P,V,G,H,A,x,R,M,F,j,B,pe,Ee,q,te=this.networkToHostOrderSwap;for(;t<C.length;){for(F=te(C[t]),j=te(C[t+1]),B=te(C[t+2]),pe=te(C[t+3]),A=F^s[0],x=pe^s[1],R=B^s[2],M=j^s[3],Ee=4,q=1;q<r;q++)P=l[A>>>24]^u[x>>16&255]^d[R>>8&255]^f[M&255]^s[Ee],V=l[x>>>24]^u[R>>16&255]^d[M>>8&255]^f[A&255]^s[Ee+1],G=l[R>>>24]^u[M>>16&255]^d[A>>8&255]^f[x&255]^s[Ee+2],H=l[M>>>24]^u[A>>16&255]^d[x>>8&255]^f[R&255]^s[Ee+3],A=P,x=V,R=G,M=H,Ee=Ee+4;P=o[A>>>24]<<24^o[x>>16&255]<<16^o[R>>8&255]<<8^o[M&255]^s[Ee],V=o[x>>>24]<<24^o[R>>16&255]<<16^o[M>>8&255]<<8^o[A&255]^s[Ee+1],G=o[R>>>24]<<24^o[M>>16&255]<<16^o[A>>8&255]<<8^o[x&255]^s[Ee+2],H=o[M>>>24]<<24^o[A>>16&255]<<16^o[x>>8&255]<<8^o[R&255]^s[Ee+3],D[t]=te(P^y),D[t+1]=te(H^v),D[t+2]=te(G^E),D[t+3]=te(V^T),y=F,v=j,E=B,T=pe,t=t+4}return D.buffer}},UA=class{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){let e=lee(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}};function lee(n){switch(n){case ll.cbc:return"AES-CBC";case ll.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}var cee=16,Vp=class{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{let i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){let{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;let i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?aee(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,r){return this.useSoftware?new Promise((s,o)=>{let a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,i,r);let l=this.flush();l?s(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,r)}softwareDecrypt(e,t,i,r){let{currentIV:s,currentResult:o,remainderData:a}=this;if(r!==ll.cbc||t.byteLength!==16)return Gt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=Nr(a,e),this.remainderData=null);let l=this.getValidChunk(e);if(!l.length)return null;s&&(i=s);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new BA),u.expandKey(t);let d=o;return this.currentResult=u.decrypt(l.buffer,0,i),this.currentIV=l.slice(-16).buffer,d||null}webCryptoDecrypt(e,t,i,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,r));this.key=t,this.fastAesKey=new UA(this.subtle,t,r)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new VA(this.subtle,new Uint8Array(i),r).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Gt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,i,r)))}onWebCryptoError(e,t,i,r){let s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,r);let o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e,i=e.length-e.length%cee;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(Gt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}},cB=Math.pow(2,17),$A=class{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){let i=e.url;if(!i)return Promise.reject(new os({type:Oe.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();let r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(v=>v[0]==="GAP")){l(dB(e));return}else e.gap=!1;let u=this.loader=s?new s(r):new o(r),d=uB(e);e.loader=u;let f=aB(r.fragLoadPolicy.default),m={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:cB};e.stats=u.stats;let y={onSuccess:(v,E,T,C)=>{this.resetLoader(e,u);let D=v.data;T.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(D.slice(0,16)),D=D.slice(16)),a({frag:e,part:null,payload:D,networkDetails:C})},onError:(v,E,T,C)=>{this.resetLoader(e,u),l(new os({type:Oe.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:jt({url:i,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:T,stats:C}))},onAbort:(v,E,T)=>{this.resetLoader(e,u),l(new os({type:Oe.NETWORK_ERROR,details:Q.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:T,stats:v}))},onTimeout:(v,E,T)=>{this.resetLoader(e,u),l(new os({type:Oe.NETWORK_ERROR,details:Q.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:T,stats:v}))}};t&&(y.onProgress=(v,E,T,C)=>t({frag:e,part:null,payload:T,networkDetails:C})),u.load(d,m,y)})}loadPart(e,t,i){this.abort();let r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(dB(e,t));return}let u=this.loader=s?new s(r):new o(r),d=uB(e,t);e.loader=u;let f=aB(r.fragLoadPolicy.default),m={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:cB};t.stats=u.stats,u.load(d,m,{onSuccess:(y,v,E,T)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);let C={frag:e,part:t,payload:y.data,networkDetails:T};i(C),a(C)},onError:(y,v,E,T)=>{this.resetLoader(e,u),l(new os({type:Oe.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:jt({url:d.url,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:E,stats:T}))},onAbort:(y,v,E)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new os({type:Oe.NETWORK_ERROR,details:Q.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:E,stats:y}))},onTimeout:(y,v,E)=>{this.resetLoader(e,u),l(new os({type:Oe.NETWORK_ERROR,details:Q.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:E,stats:y}))}})})}updateStatsFromPart(e,t){let i=e.stats,r=t.stats,s=r.total;if(i.loaded+=r.loaded,s){let l=Math.round(e.duration/t.duration),u=Math.min(Math.round(i.loaded/s),l),f=(l-u)*Math.round(i.loaded/u);i.total=i.loaded+f}else i.total=Math.max(i.loaded,i.total);let o=i.loading,a=r.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}};function uB(n,e=null){let t=e||n,i={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(Ie(r)&&Ie(s)){var o;let a=r,l=s;if(n.sn==="initSegment"&&uee((o=n.decryptdata)==null?void 0:o.method)){let u=s-r;u%16&&(l=s+(16-u%16)),r!==0&&(i.resetIV=!0,a=r-16)}i.rangeStart=a,i.rangeEnd=l}return i}function dB(n,e){let t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),i={type:Oe.MEDIA_ERROR,details:Q.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(i.part=e),(e||n).stats.aborted=!0,new os(i)}function uee(n){return n==="AES-128"||n==="AES-256"}var os=class extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}},x_=class extends ji{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}},Bp=class{constructor(e,t,i,r=0,s=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=t_(),this.buffering={audio:t_(),video:t_(),audiovideo:t_()},this.level=e,this.sn=t,this.id=i,this.size=r,this.part=s,this.partial=o}};function t_(){return{start:0,executeStart:0,executeEnd:0,end:0}}var hB={length:0,start:()=>0,end:()=>0},ot=class n{static isBuffered(e,t){if(e){let i=n.getBuffered(e);for(let r=i.length;r--;)if(t>=i.start(r)&&t<=i.end(r))return!0}return!1}static bufferedRanges(e){if(e){let t=n.getBuffered(e);return n.timeRangesToArray(t)}return[]}static timeRangesToArray(e){let t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){let r=n.bufferedRanges(e);if(r.length)return n.bufferedInfo(r,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((d,f)=>d.start-f.start||f.end-d.end);let r=-1,s=[];if(i)for(let d=0;d<e.length;d++){t>=e[d].start&&t<=e[d].end&&(r=d);let f=s.length;if(f){let m=s[f-1].end;e[d].start-m<i?e[d].end>m&&(s[f-1].end=e[d].end):s.push(e[d])}else s.push(e[d])}else s=e;let o=0,a,l=t,u=t;for(let d=0;d<s.length;d++){let f=s[d].start,m=s[d].end;if(r===-1&&t>=f&&t<=m&&(r=d),t+i>=f&&t<m)l=f,u=m,o=u-t;else if(t+i<f){a=f;break}}return{len:o,start:l||0,end:u||0,nextStart:a,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||hB}catch(t){return Gt.log("failed to get media.buffered",t),hB}}},bU=/\{\$([a-zA-Z0-9-_]+)\}/g;function fB(n){return bU.test(n)}function jA(n,e){if(n.variableList!==null||n.hasVariableRefs){let t=n.variableList;return e.replace(bU,i=>{let r=i.substring(2,i.length-1),s=t?.[r];return s===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),i):s})}return e}function pB(n,e,t){let i=n.variableList;i||(n.variableList=i={});let r,s;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{let o=new self.URL(t).searchParams;if(o.has(r))s=o.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else r=e.NAME,s=e.VALUE;r in i?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):i[r]=s||""}function dee(n,e,t){let i=e.IMPORT;if(t&&i in t){let r=n.variableList;r||(n.variableList=r={}),r[i]=t[i]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}var hee=/^(\d+)x(\d+)$/,mB=/(.+?)=(".*?"|.*?)(?:,|$)/g,hn=class n{constructor(e,t){typeof e=="string"&&(e=n.parseAttrList(e,t)),zt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){let t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;let i=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)i[r]=parseInt(t.slice(r*2,r*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){let t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){let i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){let i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((r,s)=>(r[s.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){let t=hee.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i,r={},s='"';for(mB.lastIndex=0;(i=mB.exec(e))!==null;){let o=i[1].trim(),a=i[2],l=a.indexOf(s)===0&&a.lastIndexOf(s)===a.length-1,u=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))a=jA(t,a);else if(!u&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Gt.warn(`${e}: attribute ${o} is missing quotes`)}r[o]=a}return r}},fee="com.apple.hls.interstitial";function pee(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function mee(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}var A_=class{constructor(e,t,i=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(r=t?.tagOrder)!=null?r:i,t){let s=t.attr;for(let o in s)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==s[o]){Gt.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=zt(new hn({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){let s=t?.endDate||new Date(this.attr["END-DATE"]);Ie(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){let e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){let{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Gt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){let e=this._endDate||this._dateAtEnd;if(e)return e;let t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){let e=this.attr.decimalFloatingPoint("DURATION");if(Ie(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===fee}get isValid(){return!!this.id&&!this._badValueForSameId&&Ie(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}},gee=10,GA=class{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}let t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let i=t.decryptdata;return i||(t.setKeyFormat(e.keyFormat),i=t.decryptdata),!!i&&e.matches(i)})}get hasProgramDateTime(){return this.fragments.length?Ie(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||gee}get drift(){let e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){let e=this.partList;if(e){let t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){let e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}};function D_(n,e){return n.length===e.length?!n.some((t,i)=>t!==e[i]):!1}function gB(n,e){return!n&&!e?!0:!n||!e?!1:D_(n,e)}function zd(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function XD(n){switch(n){case"AES-128":case"AES-256":return ll.cbc;case"AES-256-CTR":return ll.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function JD(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function zA(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function yee(n){let e=zA(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function SU(n){let e=function(i,r,s){let o=i[r];i[r]=i[s],i[s]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function CU(n){let e=n.split(":"),t=null;if(e[0]==="data"&&e.length===2){let i=e[1].split(";"),r=i[i.length-1].split(",");if(r.length===2){let s=r[0]==="base64",o=r[1];s?(i.splice(-1,1),t=JD(o)):t=yee(o)}}return t}var P_=typeof self<"u"?self:void 0,fn={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},oi={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function p_(n){switch(n){case oi.FAIRPLAY:return fn.FAIRPLAY;case oi.PLAYREADY:return fn.PLAYREADY;case oi.WIDEVINE:return fn.WIDEVINE;case oi.CLEARKEY:return fn.CLEARKEY}}function cA(n){switch(n){case fn.FAIRPLAY:return oi.FAIRPLAY;case fn.PLAYREADY:return oi.PLAYREADY;case fn.WIDEVINE:return oi.WIDEVINE;case fn.CLEARKEY:return oi.CLEARKEY}}function Pp(n){let{drmSystems:e,widevineLicenseUrl:t}=n,i=e?[fn.FAIRPLAY,fn.WIDEVINE,fn.PLAYREADY,fn.CLEARKEY].filter(r=>!!e[r]):[];return!i[fn.WIDEVINE]&&t&&i.push(fn.WIDEVINE),i}var xU=function(n){return P_!=null&&(n=P_.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function vee(n,e,t,i){let r;switch(n){case fn.FAIRPLAY:r=["cenc","sinf"];break;case fn.WIDEVINE:case fn.PLAYREADY:r=["cenc"];break;case fn.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return _ee(r,e,t,i)}function _ee(n,e,t,i){return[{initDataTypes:n,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function Eee(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function AU(n){let e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(o){let a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){let l=JD(a).subarray(0,16);return SU(l),l}}return null}var Nd={},Kd=class n{static clearKeyUriToKeyIdMap(){Nd={}}static setKeyIdForUri(e,t){Nd[e]=t}static addKeyIdForUri(e){let t=Object.keys(Nd).length%Number.MAX_SAFE_INTEGER,i=new Uint8Array(16);return new DataView(i.buffer,12,4).setUint32(0,t),Nd[e]=i,i}constructor(e,t,i,r=[1],s=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=r,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!zd(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(sU(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&D_(e.keyFormatVersions,this.keyFormatVersions)&&gB(e.iv,this.iv)&&gB(e.keyId,this.keyId)}isSupported(){if(this.method){if(zd(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case oi.FAIRPLAY:case oi.WIDEVINE:case oi.PLAYREADY:case oi.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(zd(this.method)){let s=this.iv;return s||(typeof e!="number"&&(Gt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),s=wee(e)),new n(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){let s=Nd[this.uri];if(s&&!D_(this.keyId,s)&&n.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}let i=CU(this.uri);if(i)switch(this.keyFormat){case oi.WIDEVINE:if(this.pssh=i,!this.keyId){let s=kJ(i.buffer);if(s.length){var r;let o=s[0];this.keyId=(r=o.kids)!=null&&r.length?o.kids[0]:null}}this.keyId||(this.keyId=yB(t));break;case oi.PLAYREADY:{let s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=MJ(s,null,i),this.keyId=AU(i);break}default:{let s=i.subarray(0,16);if(s.length!==16){let o=new Uint8Array(16);o.set(s,16-s.length),s=o}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s;s=Tee(t),s||(s=yB(t),s||(s=Nd[this.uri])),s&&(this.keyId=s,n.setKeyIdForUri(this.uri,s))}return this}};function Tee(n){let e=n?.[oi.WIDEVINE];return e?e.keyId:null}function yB(n){let e=n?.[oi.PLAYREADY];if(e){let t=CU(e.uri);if(t)return AU(t)}return null}function wee(n){let e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}var vB=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,_B=/#EXT-X-MEDIA:(.*)/g,Iee=/^#EXT(?:INF|-X-TARGETDURATION):/m,uA=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),bee=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Oc=class n{static findGroup(e,t){for(let i=0;i<e.length;i++){let r=e[i];if(r.id===t)return r}}static resolve(e,t){return WD.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Iee.test(e)}static parseMasterPlaylist(e,t){let i=fB(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},s=[];if(vB.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let o;for(;(o=vB.exec(e))!=null;)if(o[1]){var a;let u=new hn(o[1],r),d=jA(r,o[2]),f={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:n.resolve(d,t)},m=u.decimalResolution("RESOLUTION");m&&(f.width=m.width,f.height=m.height),wB(u.CODECS,f);let y=u["SUPPLEMENTAL-CODECS"];y&&(f.supplemental={},wB(y,f.supplemental)),(a=f.unknownCodecs)!=null&&a.length||s.push(f),r.levels.push(f)}else if(o[3]){let u=o[3],d=o[4];switch(u){case"SESSION-DATA":{let f=new hn(d,r),m=f["DATA-ID"];m&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[m]=f);break}case"SESSION-KEY":{let f=EB(d,t,r);f.encrypted&&f.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(f)):Gt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${d}"`);break}case"DEFINE":{{let f=new hn(d,r);pB(r,f,t)}break}case"CONTENT-STEERING":{let f=new hn(d,r);r.contentSteering={uri:n.resolve(f["SERVER-URI"],t),pathwayId:f["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=TB(d);break}}}let l=s.length>0&&s.length<r.levels.length;return r.levels=l?s:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,i){let r,s={},o=i.levels,a={AUDIO:o.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:o.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]},l=0;for(_B.lastIndex=0;(r=_B.exec(e))!==null;){let u=new hn(r[1],i),d=u.TYPE;if(d){let f=a[d],m=s[d]||[];s[d]=m;let y=u.LANGUAGE,v=u["ASSOC-LANGUAGE"],E=u.CHANNELS,T=u.CHARACTERISTICS,C=u["INSTREAM-ID"],D={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||y||"",type:d,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:y,url:u.URI?n.resolve(u.URI,t):""};if(v&&(D.assocLang=v),E&&(D.channels=E),T&&(D.characteristics=T),C&&(D.instreamId=C),f!=null&&f.length){let P=n.findGroup(f,D.groupId)||f[0];IB(D,P,"audioCodec"),IB(D,P,"textCodec")}m.push(D)}}return s}static parseLevelPlaylist(e,t,i,r,s,o){var a;let l={url:t},u=new GA(t),d=u.fragments,f=[],m=null,y=0,v=0,E=0,T=0,C=0,D=null,P=new Rp(r,l),V,G,H,A=-1,x=!1,R=null,M;if(uA.lastIndex=0,u.m3u8=e,u.hasVariableRefs=fB(e),((a=uA.exec(e))==null?void 0:a[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(V=uA.exec(e))!==null;){x&&(x=!1,P=new Rp(r,l),P.playlistOffset=E,P.setStart(E),P.sn=y,P.cc=T,C&&(P.bitrate=C),P.level=i,m&&(P.initSegment=m,m.rawProgramDateTime&&(P.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null),R&&(P.setByteRange(R),R=null)));let pe=V[1];if(pe){P.duration=parseFloat(pe);let Ee=(" "+V[2]).slice(1);P.title=Ee||null,P.tagList.push(Ee?["INF",pe,Ee]:["INF",pe])}else if(V[3]){if(Ie(P.duration)){P.playlistOffset=E,P.setStart(E),H&&SB(P,H,u),P.sn=y,P.level=i,P.cc=T,d.push(P);let Ee=(" "+V[3]).slice(1);P.relurl=jA(u,Ee),HA(P,D,f),D=P,E+=P.duration,y++,v=0,x=!0}}else{if(V=V[0].match(bee),!V){Gt.warn("No matches on slow regex match for level playlist!");continue}for(G=1;G<V.length&&V[G]===void 0;G++);let Ee=(" "+V[G]).slice(1),q=(" "+V[G+1]).slice(1),te=V[G+2]?(" "+V[G+2]).slice(1):null;switch(Ee){case"BYTERANGE":D?P.setByteRange(q,D):P.setByteRange(q);break;case"PROGRAM-DATE-TIME":P.rawProgramDateTime=q,P.tagList.push(["PROGRAM-DATE-TIME",q]),A===-1&&(A=d.length);break;case"PLAYLIST-TYPE":u.type&&Ko(u,Ee,V),u.type=q.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?Ko(u,Ee,V):d.length>0&&CB(u,Ee,V),y=u.startSN=parseInt(q);break;case"SKIP":{u.skippedSegments&&Ko(u,Ee,V);let W=new hn(q,u),ne=W.decimalInteger("SKIPPED-SEGMENTS");if(Ie(ne)){u.skippedSegments+=ne;for(let oe=ne;oe--;)d.push(null);y+=ne}let ye=W.enumeratedString("RECENTLY-REMOVED-DATERANGES");ye&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(ye.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&Ko(u,Ee,V),u.targetduration=Math.max(parseInt(q),1);break;case"VERSION":u.version!==null&&Ko(u,Ee,V),u.version=parseInt(q);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||Ko(u,Ee,V),u.live=!1;break;case"#":(q||te)&&P.tagList.push(te?[q,te]:[q]);break;case"DISCONTINUITY":T++,P.tagList.push(["DIS"]);break;case"GAP":P.gap=!0,P.tagList.push([Ee]);break;case"BITRATE":P.tagList.push([Ee,q]),C=parseInt(q)*1e3,Ie(C)?P.bitrate=C:C=0;break;case"DATERANGE":{let W=new hn(q,u),ne=new A_(W,u.dateRanges[W.ID],u.dateRangeTagCount);u.dateRangeTagCount++,ne.isValid||u.skippedSegments?u.dateRanges[ne.id]=ne:Gt.warn(`Ignoring invalid DATERANGE tag: "${q}"`),P.tagList.push(["EXT-X-DATERANGE",q]);break}case"DEFINE":{{let W=new hn(q,u);"IMPORT"in W?dee(u,W,o):pB(u,W,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?Ko(u,Ee,V):d.length>0&&CB(u,Ee,V),u.startCC=T=parseInt(q);break;case"KEY":{let W=EB(q,t,u);if(W.isSupported()){if(W.method==="NONE"){H=void 0;break}H||(H={});let ne=H[W.keyFormat];ne!=null&&ne.matches(W)||(ne&&(H=zt({},H)),H[W.keyFormat]=W)}else Gt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${q}"`);break}case"START":u.startTimeOffset=TB(q);break;case"MAP":{let W=new hn(q,u);if(P.duration){let ne=new Rp(r,l);bB(ne,W,i,H),m=ne,P.initSegment=m,m.rawProgramDateTime&&!P.rawProgramDateTime&&(P.rawProgramDateTime=m.rawProgramDateTime)}else{let ne=P.byteRangeEndOffset;if(ne){let ye=P.byteRangeStartOffset;R=`${ne-ye}@${ye}`}else R=null;bB(P,W,i,H),m=P,x=!0}m.cc=T;break}case"SERVER-CONTROL":{M&&Ko(u,Ee,V),M=new hn(q),u.canBlockReload=M.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=M.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&M.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=M.optionalFloat("PART-HOLD-BACK",0),u.holdBack=M.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&Ko(u,Ee,V);let W=new hn(q);u.partTarget=W.decimalFloatingPoint("PART-TARGET");break}case"PART":{let W=u.partList;W||(W=u.partList=[]);let ne=v>0?W[W.length-1]:void 0,ye=v++,oe=new hn(q,u),ie=new RA(oe,P,l,ye,ne);W.push(ie),P.duration+=ie.duration;break}case"PRELOAD-HINT":{let W=new hn(q,u);u.preloadHint=W;break}case"RENDITION-REPORT":{let W=new hn(q,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(W);break}default:Gt.warn(`line parsed but not handled: ${V}`);break}}}D&&!D.relurl?(d.pop(),E-=D.duration,u.partList&&(u.fragmentHint=D)):u.partList&&(HA(P,D,f),P.cc=T,u.fragmentHint=P,H&&SB(P,H,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));let F=d.length,j=d[0],B=d[F-1];if(E+=u.skippedSegments*u.targetduration,E>0&&F&&B){u.averagetargetduration=E/F;let pe=B.sn;u.endSN=pe!=="initSegment"?pe:0,u.live||(B.endList=!0),A>0&&(Cee(d,A),j&&f.unshift(j))}return u.fragmentHint&&(E+=u.fragmentHint.duration),u.totalduration=E,f.length&&u.dateRangeTagCount&&j&&DU(f,u),u.endCC=T,u}};function DU(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){let a=e.fragments[e.fragments.length-1];n.push(a),t++}else return;let i=n[t-1],r=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let a=s.length;a--;){let l=e.dateRanges[s[a]],u=l.startDate.getTime();l.tagAnchor=i.ref;for(let d=t;d--;){var o;if(((o=n[d])==null?void 0:o.sn)<e.startSN)break;let f=See(e,u,n,d,r);if(f!==-1){l.tagAnchor=e.fragments[f].ref;break}}}}function See(n,e,t,i,r){let s=t[i];if(s){let a=s.programDateTime;if(e>=a||i===0){var o;let l=(((o=t[i+1])==null?void 0:o.start)||r)-s.start;if(e<=a+l*1e3){let u=t[i].sn-n.startSN;if(u<0)return-1;let d=n.fragments;if(d.length>t.length){let m=(t[i+1]||d[d.length-1]).sn-n.startSN;for(let y=m;y>u;y--){let v=d[y].programDateTime;if(e>=v&&e<v+d[y].duration*1e3)return y}}return u}}}return-1}function EB(n,e,t){var i,r;let s=new hn(n,t),o=(i=s.METHOD)!=null?i:"",a=s.URI,l=s.hexadecimalInteger("IV"),u=s.KEYFORMATVERSIONS,d=(r=s.KEYFORMAT)!=null?r:"identity";a&&s.IV&&!l&&Gt.error(`Invalid IV: ${s.IV}`);let f=a?Oc.resolve(a,e):"",m=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Kd(o,f,d,m,l,s.KEYID)}function TB(n){let t=new hn(n).decimalFloatingPoint("TIME-OFFSET");return Ie(t)?t:null}function wB(n,e){let t=(n||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{let r=t.filter(s=>YD(s,i));r.length&&(e[`${i}Codec`]=r.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>r.indexOf(s)===-1))}),e.unknownCodecs=t}function IB(n,e,t){let i=e[t];i&&(n[t]=i)}function Cee(n,e){let t=n[e];for(let i=e;i--;){let r=n[i];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function HA(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function bB(n,e,t,i){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",i&&(n.levelkeys=i),n.initSegment=null}function SB(n,e,t){n.levelkeys=e;let{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&i.push(n)}function Ko(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function CB(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function dA(n,e){let t=e.startPTS;if(Ie(t)){let i=0,r;e.sn>n.sn?(i=t-n.start,r=n):(i=n.start-t,r=e),r.duration!==i&&r.setDuration(i)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function PU(n,e,t,i,r,s,o){i-t<=0&&(o.warn("Fragment should have a positive duration",e),i=t+e.duration,s=r+e.duration);let l=t,u=i,d=e.startPTS,f=e.endPTS;if(Ie(d)){let C=Math.abs(d-t);n&&C>n.totalduration?o.warn(`media timestamps and playlist times differ by ${C}s for level ${e.level} ${n.url}`):Ie(e.deltaPTS)?e.deltaPTS=Math.max(C,e.deltaPTS):e.deltaPTS=C,l=Math.max(t,d),t=Math.min(t,d),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,u=Math.min(i,f),i=Math.max(i,f),s=e.endDTS!==void 0?Math.max(s,e.endDTS):s}let m=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=r,e.endPTS=i,e.minEndPTS=u,e.endDTS=s;let y=e.sn;if(!n||y<n.startSN||y>n.endSN)return 0;let v,E=y-n.startSN,T=n.fragments;for(T[E]=e,v=E;v>0;v--)dA(T[v],T[v-1]);for(v=E;v<T.length-1;v++)dA(T[v],T[v+1]);return n.fragmentHint&&dA(T[T.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,m}function xee(n,e,t){if(n===e)return;let i=null,r=n.fragments;for(let d=r.length-1;d>=0;d--){let f=r[d].initSegment;if(f){i=f;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let s;Pee(n,e,(d,f,m,y)=>{if((!e.startCC||e.skippedSegments)&&f.cc!==d.cc){let v=d.cc-f.cc;for(let E=m;E<y.length;E++)y[E].cc+=v;e.endCC=y[y.length-1].cc}Ie(d.startPTS)&&Ie(d.endPTS)&&(f.setStart(f.startPTS=d.startPTS),f.startDTS=d.startDTS,f.maxStartPTS=d.maxStartPTS,f.endPTS=d.endPTS,f.endDTS=d.endDTS,f.minEndPTS=d.minEndPTS,f.setDuration(d.endPTS-d.startPTS),f.duration&&(s=f),e.PTSKnown=e.alignedSliding=!0),d.hasStreams&&(f.elementaryStreams=d.elementaryStreams),f.loader=d.loader,d.hasStats&&(f.stats=d.stats),d.initSegment&&(f.initSegment=d.initSegment,i=d.initSegment)});let o=e.fragments,a=e.fragmentHint?o.concat(e.fragmentHint):o;if(i&&a.forEach(d=>{var f;d&&(!d.initSegment||d.initSegment.relurl===((f=i)==null?void 0:f.relurl))&&(d.initSegment=i)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(d=>!d),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let d=e.skippedSegments;d--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Aee(n.dateRanges,e,t));let d=n.fragments.filter(f=>f.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let f=1;f<a.length;f++)a[f].programDateTime===null&&HA(a[f],a[f-1],d);DU(d,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var l;let d=kU(n,e.startSN-1);e.startCC=(l=d?.cc)!=null?l:o[0].cc}Dee(n.partList,e.partList,(d,f)=>{f.elementaryStreams=d.elementaryStreams,f.stats=d.stats}),s?PU(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,t):RU(n,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;let u=e.advancedDateTime;if(e.advanced&&u){let d=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=d),e.driftEndTime=u,e.driftEnd=d}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function Aee(n,e,t){let{dateRanges:i,recentlyRemovedDateranges:r}=e,s=zt({},n);r&&r.forEach(l=>{delete s[l]});let a=Object.keys(s).length;return a?(Object.keys(i).forEach(l=>{let u=s[l],d=new A_(i[l].attr,u);d.isValid?(s[l]=d,u||(d.tagOrder+=a)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Qt(i[l].attr)}"`)}),s):i}function Dee(n,e,t){if(n&&e){let i=0;for(let r=0,s=n.length;r<=s;r++){let o=n[r],a=e[r+i];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):i--}}}function Pee(n,e,t){let i=e.skippedSegments,r=Math.max(n.startSN,e.startSN)-e.startSN,s=(n.fragmentHint?1:0)+(i?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let u=r;u<=s;u++){let d=l[o+u],f=a[u];if(i&&!f&&d&&(f=e.fragments[u]=d),d&&f){t(d,f,u,a);let m=d.relurl,y=f.relurl;if(m&&Ree(m,y)){e.playlistParsingError=xB(`media sequence mismatch ${f.sn}:`,n,e,d,f);return}else if(d.cc!==f.cc){e.playlistParsingError=xB(`discontinuity sequence mismatch (${d.cc}!=${f.cc})`,n,e,d,f);return}}}}function xB(n,e,t,i,r){return new Error(`${n} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function RU(n,e,t=!0){let i=e.startSN+e.skippedSegments-n.startSN,r=n.fragments,s=i>=0,o=0;if(s&&i<r.length)o=r[i].start;else if(s&&e.startSN===n.endSN+1)o=n.fragmentEnd;else if(s&&t)o=n.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=n.fragmentStart;else return;qA(e,o)}function qA(n,e){if(e){let t=n.fragments;for(let i=n.skippedSegments;i<t.length;i++)t[i].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function MU(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){let i=n.fragments;if(i.length&&t*4>e){let s=i[i.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function kU(n,e,t){if(!n)return null;let i=n.fragments[e-n.startSN];return i||(i=n.fragmentHint,i&&i.sn===e)?i:e<n.startSN&&t&&t.sn===e?t:null}function AB(n,e,t){return n?LU(n.partList,e,t):null}function LU(n,e,t){if(n)for(let i=n.length;i--;){let r=n[i];if(r.index===t&&r.fragment.sn===e)return r}return null}function OU(n){n.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function Ree(n,e){return n!==e&&e?DB(n)!==DB(e):!1}function DB(n){return n.replace(/\?[^?]*$/,"")}function Mp(n,e){for(let i=0,r=n.length;i<r;i++){var t;if(((t=n[i])==null?void 0:t.cc)===e)return n[i]}return null}function Mee(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function PB(n,e){let t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function NU(n,e){let t=e.fragments;for(let i=0,r=t.length;i<r;i++)PB(t[i],n);e.fragmentHint&&PB(e.fragmentHint,n),e.alignedSliding=!0}function kee(n,e){n&&(FU(e,n),e.alignedSliding||R_(e,n),!e.alignedSliding&&!e.skippedSegments&&RU(n,e,!1))}function FU(n,e){if(!Mee(e,n))return;let t=Math.min(e.endCC,n.endCC),i=Mp(e.fragments,t),r=Mp(n.fragments,t);if(!i||!r)return;Gt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);let s=i.start-r.start;NU(s,n)}function R_(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;let t=n.fragments,i=e.fragments;if(!t.length||!i.length)return;let r,s,o=Math.min(e.endCC,n.endCC);e.startCC<o&&n.startCC<o&&(r=Mp(i,o),s=Mp(t,o)),(!r||!s)&&(r=i[Math.floor(i.length/2)],s=Mp(t,r.cc)||t[Math.floor(t.length/2)]);let a=r.programDateTime,l=s.programDateTime;if(!a||!l)return;let u=(l-a)/1e3-(s.start-r.start);NU(u,n)}function Ci(n,e,t){$i(n,e,t),n.addEventListener(e,t)}function $i(n,e,t){n.removeEventListener(e,t)}var Lee={toString:function(n){let e="",t=n.length;for(let i=0;i<t;i++)e+=`[${n.start(i).toFixed(3)}-${n.end(i).toFixed(3)}]`;return e}},re={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},Up=class extends x_{constructor(e,t,i,r,s){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=re.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{let{config:o,fragCurrent:a,media:l,mediaBuffer:u,state:d}=this,f=l?l.currentTime:0,m=ot.bufferInfo(u||l,f,o.maxBufferHole),y=!m.len;if(this.log(`Media seeking to ${Ie(f)?f.toFixed(3):f}, state: ${d}, ${y?"out of":"in"} buffer`),this.state===re.ENDED)this.resetLoadingState();else if(a){let v=o.maxFragLookUpTolerance,E=a.start-v,T=a.start+a.duration+v;if(y||T<m.start||E>m.end){let C=f>T;(f<E||C)&&(C&&a.loader&&(this.log(`Cancelling fragment load for seek (sn: ${a.sn})`),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(f,1/0,this.playlistType,!0);let v=this.lastCurrentTime;if(f>v&&(this.lastCurrentTime=f),!this.loadingParts){let E=Math.max(m.end,f),T=this.shouldLoadParts(this.getLevelDetails(),E);T&&(this.log(`LL-Part loading ON after seeking to ${f.toFixed(2)} with buffer @${E.toFixed(2)}`),this.loadingParts=T)}}this.hls.hasEnoughToStart||(this.log(`Setting ${y?"startPosition":"nextLoadPosition"} to ${f} for seek without enough to start`),this.nextLoadPosition=f,y&&(this.startPosition=f)),y&&this.state===re.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new $A(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Vp(e.config)}registerListeners(){let{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===re.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);let e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=re.STOPPED}get startPositionValue(){let{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;let i=e.end||0,r=this.config.timelineOffset||0;if(i<=r)return!1;let s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=ot.bufferedInfo(s,e.start,0));let o=e.nextStart;if(o&&o>r&&o<t.edge||this.media.currentTime<e.start)return!1;let l=t.partList;if(l!=null&&l.length){let d=l[l.length-1];return ot.isBuffered(this.media,d.start+d.duration/2)}let u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){let e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){let i=this.media=this.mediaBuffer=t.media;Ci(i,"seeking",this.onMediaSeeking),Ci(i,"ended",this.onMediaEnded);let r=this.config;this.levels&&r.autoStartLoad&&this.state===re.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){let i=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),$i(r,"seeking",this.onMediaSeeking),$i(r,"ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=re.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){let r=s=>{let o=s.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(o,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,i,r).then(s=>{if(!s)return;let o=this.state,a=s.frag;if(this.fragContextChanged(a)){(o===re.FRAG_LOADING||!this.fragCurrent&&o===re.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=re.IDLE);return}"payload"in s&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(b.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(`Frag error: ${s?.message||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;let{fragmentTracker:i}=this;if(i.getState(e)===jn.APPENDING){let s=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,s),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===jn.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){let t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){let t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;let r={startOffset:e,endOffset:t,type:i};this.hls.trigger(b.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{let r=i?.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{let{hls:r}=this,{frag:s,payload:o}=i,a=s.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&zd(a.method)){let l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,XD(a.method)).catch(u=>{throw r.trigger(b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:s}),u}).then(u=>{let d=self.performance.now();return r.trigger(b.FRAG_DECRYPTED,{frag:s,payload:u,stats:{tstart:l,tdecrypt:d}}),i.payload=u,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){let{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");let i=e.frag.stats;this.state!==re.STOPPED&&(this.state=re.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var i,r;let s=e.tracks;if(s&&!t.encrypted&&((i=s.audio)!=null&&i.encrypted||(r=s.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){let o=this.media,a=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(a.message),!o||o.mediaKeys?!1:(this.hls.trigger(b.ERROR,{type:Oe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_KEYS,fatal:!1,error:a,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){let{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){let i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?Lee.toString(ot.getBuffered(i)):"(detached)"})`),In(e)){var r;if(e.type!==De.SUBTITLE){let o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=re.IDLE;return}}let s=(r=this.levels)==null?void 0:r[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=re.IDLE}_handleFragmentLoadComplete(e){let{transmuxer:t}=this;if(!t)return;let{frag:i,part:r,partsLoaded:s}=e,o=!s||s.length===0||s.some(l=>!l),a=new Bp(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,r){var s;this.fragCurrent=e;let o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=re.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(m=>{if(!this.fragContextChanged(m.frag))return this.hls.trigger(b.KEY_LOADED,m),this.state===re.KEY_LOADING&&(this.state=re.IDLE),m}),this.hls.trigger(b.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(a=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));let l=this.fragPrevious;if(In(e)&&(!l||e.sn!==l.sn)){let m=this.shouldLoadParts(t.details,e.end);m!==this.loadingParts&&(this.log(`LL-Part loading ${m?"ON":"OFF"} loading sn ${l?.sn}->${e.sn}`),this.loadingParts=m)}if(i=Math.max(e.start,i||0),this.loadingParts&&In(e)){let m=o.partList;if(m&&r){i>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);let y=this.getNextPart(m,e,i);if(y>-1){let v=m[y];e=this.fragCurrent=v.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${v.index} (${y}/${m.length-1}) of ${this.fragInfo(e,!1,v)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=v.start+v.duration,this.state=re.FRAG_LOADING;let E;return a?E=a.then(T=>!T||this.fragContextChanged(T.frag)?null:this.doFragPartsLoad(e,v,t,r)).catch(T=>this.handleFragLoadError(T)):E=this.doFragPartsLoad(e,v,t,r).catch(T=>this.handleFragLoadError(T)),this.hls.trigger(b.FRAG_LOADING,{frag:e,part:v,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):E}else if(!e.url||this.loadedEndOfParts(m,i))return Promise.resolve(null)}}if(In(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=o.partList)==null?void 0:u.filter(m=>m.loaded).map(m=>`[${m.start}-${m.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(i.toFixed(3))}`),Ie(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=re.FRAG_LOADING;let d=this.config.progressive&&e.type!==De.SUBTITLE,f;return d&&a?f=a.then(m=>!m||this.fragContextChanged(m.frag)?null:this.fragmentLoader.load(e,r)).catch(m=>this.handleFragLoadError(m)):f=Promise.all([this.fragmentLoader.load(e,d?r:void 0),a]).then(([m])=>(!d&&r&&r(m),m)).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(b.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):f}doFragPartsLoad(e,t,i,r){return new Promise((s,o)=>{var a;let l=[],u=(a=i.details)==null?void 0:a.partList,d=f=>{this.fragmentLoader.loadPart(e,f,r).then(m=>{l[f.index]=m;let y=m.part;this.hls.trigger(b.FRAG_LOADED,m);let v=AB(i.details,e.sn,f.index+1)||LU(u,e.sn,f.index+1);if(v)d(v);else return s({frag:e,part:y,partsLoaded:l})}).catch(o)};d(t)})}handleFragLoadError(e){if("data"in e){let t=e.data;t.frag&&t.details===Q.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Oe.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(b.ERROR,t)}else this.hls.trigger(b.ERROR,{type:Oe.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){let t=this.getCurrentContext(e);if(!t||this.state!==re.PARSING){!this.fragCurrent&&this.state!==re.STOPPED&&this.state!==re.ERROR&&(this.state=re.IDLE);return}let{frag:i,part:r,level:s}=t,o=self.performance.now();i.stats.parsing.end=o,r&&(r.stats.parsing.end=o);let a=this.getLevelDetails(),u=a&&i.sn>a.endSN||this.shouldLoadParts(a,i.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(i,r,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var i;let s=e.partList[0];if(s.fragment.type===De.SUBTITLE)return!1;let o=s.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=o){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){let{levels:t,fragCurrent:i}=this,{level:r,sn:s,part:o}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;let a=t[r],l=a.details,u=o>-1?AB(l,s,o):null,d=u?u.fragment:kU(l,s,i);return d?(i&&i!==d&&(d.stats=i.stats),{frag:d,part:u,level:a}):null}bufferFragmentData(e,t,i,r,s){if(this.state!==re.PARSING)return;let{data1:o,data2:a}=e,l=o;if(a&&(l=Nr(o,a)),!l.length)return;let u=this.initPTS[t.cc],d=u?-u.baseTime/u.timescale:void 0,f={type:e.type,frag:t,part:i,chunkMeta:r,offset:d,parent:t.type,data:l};if(this.hls.trigger(b.BUFFER_APPENDING,f),e.dropped&&e.independent&&!i){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){let t=this.media;if(!t)return;if(!ot.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}let i=t.currentTime,r=ot.bufferInfo(t,i,0),s=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),a=Math.max(Math.min(e.start-o,r.end-o),i+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var i;let r=this.getLoadPosition();if(!Ie(r))return null;let o=this.lastCurrentTime>r||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,o)}getFwdBufferInfoAtPos(e,t,i,r){let s=ot.bufferInfo(e,t,r);if(s.len===0&&s.nextStart!==void 0){let o=this.fragmentTracker.getBufferedFrag(t,i);if(o&&(s.nextStart<=o.end||o.gap)){let a=Math.max(Math.min(s.nextStart,o.end)-t,r);return ot.bufferInfo(e,t,a)}}return s}getMaxBufferLength(e){let{config:t}=this,i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){let i=this.config,r=Math.max(Math.min(e-t,i.maxBufferLength),t),s=Math.max(e-t*3,i.maxMaxBufferLength/2,r);return s>=r?(i.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=De.MAIN){let i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){let i=t.fragments,r=i.length;if(!r)return null;let{config:s}=this,o=i[0].start,a=s.lowLatencyMode&&!!t.partList,l=null;if(t.live){let f=s.initialLiveManifestSize;if(r<f)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${f})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var u;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);let m=this.hls.startPosition,y=this.hls.liveSyncPosition,v=l?(m!==-1&&m>=o?m:y)||l.start:e;this.log(`Setting startPosition to ${v} to match start frag at live edge. mainStart: ${m} liveSyncPosition: ${y} frag.start: ${(u=l)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=v}}else e<=o&&(l=i[0]);if(!l){let f=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,f,t)}let d=this.filterReplacedPrimary(l,t);if(!d&&l){let f=l.sn-t.startSN;d=this.filterReplacedPrimary(i[f+1]||null,t)}return this.mapToInitFragWhenRequired(d)}isLoopLoading(e,t){let i=this.fragmentTracker.getState(e);return(i===jn.OK||i===jn.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,r,s){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&i.nextStart)){let a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r,0);if(a!==null&&i.len+a.len>=s){let l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(RB(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(RB(this.config)&&e.type!==De.SUBTITLE){let i=this.hls.interstitialsManager,r=i?.bufferingItem;if(r){let o=r.event;if(o){if(o.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&t?.live===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}let s=i?.playerQueue;if(s)for(let o=s.length;o--;){let a=s[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let r=-1,s=!1,o=!0;for(let a=0,l=e.length;a<l;a++){let u=e[a];if(o=o&&!u.independent,r>-1&&i<u.start)break;let d=u.loaded;d?r=-1:(s||(u.independent||o)&&u.fragment===t)&&(u.fragment!==t&&this.warn(`Need buffer at ${i} but next unloaded part starts at ${u.start}`),r=a),s=d}return r}loadedEndOfParts(e,t){let i;for(let r=e.length;r--;){if(i=e[r],!i.loaded)return!1;if(t>i.start)return!0}return!1}getInitialLiveFragment(e){let t=e.fragments,i=this.fragPrevious,r=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=iee(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){let s=i.sn+1;if(s>=e.startSN&&s<=e.endSN){let o=t[s-e.startSN];i.cc===o.cc&&(r=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=TU(e,i.cc,i.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{let s=this.hls.liveSyncPosition;s!==null&&(r=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,i){let{config:r}=this,{fragPrevious:s}=this,{fragments:o,endSN:a}=i,{fragmentHint:l}=i,{maxFragLookUpTolerance:u}=r,d=i.partList,f=!!(this.loadingParts&&d!=null&&d.length&&l);f&&!this.bitrateTest&&d[d.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let m;if(e<t){var y;let E=e<this.lastCurrentTime||e>t-u||(y=this.media)!=null&&y.paused||!this.startFragRequested?0:u;m=Bc(s,o,e,E)}else m=o[o.length-1];if(m){let v=m.sn-i.startSN,E=this.fragmentTracker.getState(m);if((E===jn.OK||E===jn.PARTIAL&&m.gap)&&(s=m),s&&m.sn===s.sn&&(!f||d[0].fragment.sn>m.sn||!i.live)&&m.level===s.level){let C=o[v+1];m.sn<a&&this.fragmentTracker.getState(C)!==jn.OK?m=C:m=null}}return m}alignPlaylists(e,t,i){let r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;let s=e.fragmentStart,o=!t,a=e.alignedSliding&&Ie(s);if(o||!a&&!s){kee(i,e);let l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),l}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);let r=this.timelineOffset;if(i===-1){let s=this.startTimeOffset!==null,o=s?this.startTimeOffset:e.startTimeOffset;o!==null&&Ie(o)?(i=t+o,o<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${o} found in ${s?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+r}this.nextLoadPosition=i+r}getLoadPosition(){var e;let{media:t}=this,i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&In(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==re.FRAG_LOADING_WAITING_RETRY)&&(this.state=re.IDLE)}onFragmentOrKeyLoadError(e,t){var i;if(t.chunkMeta&&!t.frag){let C=this.getCurrentContext(t.chunkMeta);C&&(t.frag=C.frag)}let r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var s;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}let o=t.details===Q.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(r,!0);let a=t.errorAction;if(!a){this.state=re.ERROR;return}let{action:l,flags:u,retryCount:d=0,retryConfig:f}=a,m=!!f,y=m&&l===Xn.RetryRequest,v=m&&!a.resolved&&u===hr.MoveAllAlternatesMatchingHost,E=(i=this.hls.latestLevelDetails)==null?void 0:i.live;if(!y&&v&&In(r)&&!r.endList&&E&&!IU(t))this.resetFragmentErrors(e),this.treatAsGap(r),a.resolved=!0;else if((y||v)&&d<f.maxNumRetry){var T;let C=OA((T=t.response)==null?void 0:T.code),D=ZD(f,d);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+D,this.state=re.FRAG_LOADING_WAITING_RETRY,a.resolved=!0,C){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${d+1}/${f.maxNumRetry} in ${D}ms`)}else if(f)if(this.resetFragmentErrors(e),d<f.maxNumRetry)!o&&l!==Xn.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${d})`);return}else l===Xn.SendAlternateToPenaltyBox?this.state=re.WAITING_LEVEL:this.state=re.ERROR;this.tickImmediate()}checkRetryDate(){let e=self.performance.now(),t=this.retryDate,i=t===1/0;(!t||e>=t||i&&!OA(0))&&(i&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=re.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===re.PARSING||this.state===re.PARSED){let t=e.frag,i=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,i),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len,t?.duration||10);let o=!s;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===De.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==re.STOPPED&&(this.state=re.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;let r=ot.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,i),this.state===re.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==re.STOPPED&&(this.state=re.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;let e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,r){let s=i.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{let d=e.elementaryStreams[u];if(d){let f=d.endPTS-d.startPTS;if(f<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${f})`),l||!1;let m=r?0:PU(s,e,d.startPTS,d.endPTS,d.startDTS,d.endDTS,this);return this.hls.trigger(b.LEVEL_PTS_UPDATED,{details:s,level:i,drift:m,type:u,frag:e,start:d.startPTS,end:d.endPTS}),!0}return l},!1)){var a;let l=((a=this.transmuxer)==null?void 0:a.error)===null;if((i.fragmentError===0||l&&(i.fragmentError<2||e.endList))&&this.treatAsGap(e,i),l){let u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=re.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(b.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===De.MAIN?"level":"track"}fragInfo(e,t=!0,i){var r,s;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((r=t&&!i?e.startPTS:(i||e).start)!=null?r:NaN).toFixed(3)}-${((s=t&&!i?e.endPTS:(i||e).end)!=null?s:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){let t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}};function RB(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}var M_=class{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){let{chunks:e,dataLength:t}=this,i;if(e.length)e.length===1?i=e[0]:i=Oee(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}};function Oee(n,e){let t=new Uint8Array(e),i=0;for(let r=0;r<n.length;r++){let s=n[r];t.set(s,i),i+=s.length}return t}var hA={exports:{}},MB;function Nee(){return MB||(MB=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function r(l,u,d){this.fn=l,this.context=u,this.once=d||!1}function s(l,u,d,f,m){if(typeof d!="function")throw new TypeError("The listener must be a function");var y=new r(d,f||l,m),v=t?t+u:u;return l._events[v]?l._events[v].fn?l._events[v]=[l._events[v],y]:l._events[v].push(y):(l._events[v]=y,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new i:delete l._events[u]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],d,f;if(this._eventsCount===0)return u;for(f in d=this._events)e.call(d,f)&&u.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},a.prototype.listeners=function(u){var d=t?t+u:u,f=this._events[d];if(!f)return[];if(f.fn)return[f.fn];for(var m=0,y=f.length,v=new Array(y);m<y;m++)v[m]=f[m].fn;return v},a.prototype.listenerCount=function(u){var d=t?t+u:u,f=this._events[d];return f?f.fn?1:f.length:0},a.prototype.emit=function(u,d,f,m,y,v){var E=t?t+u:u;if(!this._events[E])return!1;var T=this._events[E],C=arguments.length,D,P;if(T.fn){switch(T.once&&this.removeListener(u,T.fn,void 0,!0),C){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,d),!0;case 3:return T.fn.call(T.context,d,f),!0;case 4:return T.fn.call(T.context,d,f,m),!0;case 5:return T.fn.call(T.context,d,f,m,y),!0;case 6:return T.fn.call(T.context,d,f,m,y,v),!0}for(P=1,D=new Array(C-1);P<C;P++)D[P-1]=arguments[P];T.fn.apply(T.context,D)}else{var V=T.length,G;for(P=0;P<V;P++)switch(T[P].once&&this.removeListener(u,T[P].fn,void 0,!0),C){case 1:T[P].fn.call(T[P].context);break;case 2:T[P].fn.call(T[P].context,d);break;case 3:T[P].fn.call(T[P].context,d,f);break;case 4:T[P].fn.call(T[P].context,d,f,m);break;default:if(!D)for(G=1,D=new Array(C-1);G<C;G++)D[G-1]=arguments[G];T[P].fn.apply(T[P].context,D)}}return!0},a.prototype.on=function(u,d,f){return s(this,u,d,f,!1)},a.prototype.once=function(u,d,f){return s(this,u,d,f,!0)},a.prototype.removeListener=function(u,d,f,m){var y=t?t+u:u;if(!this._events[y])return this;if(!d)return o(this,y),this;var v=this._events[y];if(v.fn)v.fn===d&&(!m||v.once)&&(!f||v.context===f)&&o(this,y);else{for(var E=0,T=[],C=v.length;E<C;E++)(v[E].fn!==d||m&&!v[E].once||f&&v[E].context!==f)&&T.push(v[E]);T.length?this._events[y]=T.length===1?T[0]:T:o(this,y)}return this},a.prototype.removeAllListeners=function(u){var d;return u?(d=t?t+u:u,this._events[d]&&o(this,d)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a}(hA)),hA.exports}var Fee=Nee(),e1=yJ(Fee),$p="1.6.15",Yd={};function Vee(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Bee(){let n=Yd[$p];if(n)return n.clientCount++,n;let e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return Yd[$p]=r,r}function Uee(n){let e=Yd[n];if(e)return e.clientCount++,e;let t=new self.URL(n,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Yd[n]=r,r}function $ee(n){let e=Yd[n||$p];if(e&&e.clientCount--===1){let{worker:i,objectURL:r}=e;delete Yd[n||$p],r&&self.URL.revokeObjectURL(r),i.terminate()}}function VU(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function t1(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function H_(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function jp(n,e){let t=e,i=0;for(;t1(n,e);){i+=10;let r=H_(n,e+6);i+=r,VU(n,e+10)&&(i+=10),e+=i}if(i>0)return n.subarray(t,t+i)}function jee(n,e,t,i){let r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],o=s>>2&15;if(o>12){let y=new Error(`invalid ADTS sampling index:${o}`);n.emit(b.ERROR,b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!0,error:y,reason:y.message});return}let a=(s>>6&3)+1,l=e[t+3]>>6&3|(s&1)<<2,u="mp4a.40."+a,d=r[o],f=o;(a===5||a===29)&&(f-=3);let m=[a<<3|(f&14)>>1,(f&1)<<7|l<<3];return Gt.log(`manifest codec:${i}, parsed codec:${u}, channels:${l}, rate:${d} (ADTS object type:${a} sampling index:${o})`),{config:m,samplerate:d,channelCount:l,codec:u,parsedCodec:u,manifestCodec:i}}function BU(n,e){return n[e]===255&&(n[e+1]&246)===240}function UU(n,e){return n[e+1]&1?7:9}function n1(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function Gee(n,e){return e+5<n.length}function k_(n,e){return e+1<n.length&&BU(n,e)}function zee(n,e){return Gee(n,e)&&BU(n,e)&&n1(n,e)<=n.length-e}function Hee(n,e){if(k_(n,e)){let t=UU(n,e);if(e+t>=n.length)return!1;let i=n1(n,e);if(i<=t)return!1;let r=e+i;return r===n.length||k_(n,r)}return!1}function $U(n,e,t,i,r){if(!n.samplerate){let s=jee(e,t,i,r);if(!s)return;zt(n,s)}}function jU(n){return 1024*9e4/n}function qee(n,e){let t=UU(n,e);if(e+t<=n.length){let i=n1(n,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function GU(n,e,t,i,r){let s=jU(n.samplerate),o=i+r*s,a=qee(e,t),l;if(a){let{frameLength:f,headerLength:m}=a,y=m+f,v=Math.max(0,t+y-e.length);v?(l=new Uint8Array(y-m),l.set(e.subarray(t+m,e.length),0)):l=e.subarray(t+m,t+y);let E={unit:l,pts:o};return v||n.samples.push(E),{sample:E,length:y,missing:v}}let u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:u,missing:-1}}function Wee(n,e){return t1(n,e)&&H_(n,e+6)+10<=n.length-e}function Kee(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function fA(n,e=0,t=1/0){return Yee(n,e,t,Uint8Array)}function Yee(n,e,t,i){let r=Qee(n),s=1;"BYTES_PER_ELEMENT"in i&&(s=i.BYTES_PER_ELEMENT);let o=Zee(n)?n.byteOffset:0,a=(o+n.byteLength)/s,l=(o+e)/s,u=Math.floor(Math.max(0,Math.min(l,a))),d=Math.floor(Math.min(u+Math.max(t,0),a));return new i(r,u,d-u)}function Qee(n){return n instanceof ArrayBuffer?n:n.buffer}function Zee(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function Xee(n){let e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}let i=n.data.subarray(1).indexOf(0);if(i===-1)return;let r=mr(fA(n.data,1,i)),s=n.data[2+i],o=n.data.subarray(3+i).indexOf(0);if(o===-1)return;let a=mr(fA(n.data,3+i,o)),l;return r==="-->"?l=mr(fA(n.data,4+i+o)):l=Kee(n.data.subarray(4+i+o)),e.mimeType=r,e.pictureType=s,e.description=a,e.data=l,e}function Jee(n){if(n.size<2)return;let e=mr(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function ete(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1,i=mr(n.data.subarray(t),!0);t+=i.length+1;let r=mr(n.data.subarray(t));return{key:n.type,info:i,data:r}}let e=mr(n.data.subarray(1));return{key:n.type,info:"",data:e}}function tte(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1,i=mr(n.data.subarray(t),!0);t+=i.length+1;let r=mr(n.data.subarray(t));return{key:n.type,info:i,data:r}}let e=mr(n.data);return{key:n.type,info:"",data:e}}function nte(n){return n.type==="PRIV"?Jee(n):n.type[0]==="W"?tte(n):n.type==="APIC"?Xee(n):ete(n)}function ite(n){let e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=H_(n,4),i=10;return{type:e,size:t,data:n.subarray(i,i+t)}}var n_=10,rte=10;function zU(n){let e=0,t=[];for(;t1(n,e);){let i=H_(n,e+6);n[e+5]>>6&1&&(e+=n_),e+=n_;let r=e+i;for(;e+rte<r;){let s=ite(n.subarray(e)),o=nte(s);o&&t.push(o),e+=s.size+n_}VU(n,e)&&(e+=n_)}return t}function HU(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function ste(n){if(n.data.byteLength===8){let e=new Uint8Array(n.data),t=e[3]&1,i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function i1(n){let e=zU(n);for(let t=0;t<e.length;t++){let i=e[t];if(HU(i))return ste(i)}}var pr=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function Zs(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}var Gp=class{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=Nr(this.cachedData,e),this.cachedData=null);let i=jp(e,0),r=i?i.length:0,s,o=this._audioTrack,a=this._id3Track,l=i?i1(i):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&Ie(l))&&(this.basePTS=ote(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:pr.audioId3,duration:Number.POSITIVE_INFINITY});r<u;){if(this.canParse(e,r)){let d=this.appendFrame(o,e,r);d?(this.frameIndex++,this.lastPTS=d.sample.pts,r+=d.length,s=r):r=u}else Wee(e,r)?(i=jp(e,r),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:pr.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,s=r):r++;if(r===u&&s!==u){let d=e.slice(s);this.cachedData?this.cachedData=Nr(this.cachedData,d):this.cachedData=d}}return{audioTrack:o,videoTrack:Zs(),id3Track:a,textTrack:Zs()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){let t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Zs(),id3Track:this._id3Track,textTrack:Zs()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}},ote=(n,e,t)=>{if(Ie(n))return n*90;let i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i},i_=null,ate=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],lte=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],cte=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],ute=[0,1,1,4];function qU(n,e,t,i,r){if(t+24>e.length)return;let s=WU(e,t);if(s&&t+s.frameLength<=e.length){let o=s.samplesPerFrame*9e4/s.sampleRate,a=i+r*o,l={unit:e.subarray(t,t+s.frameLength),pts:a,dts:a};return n.config=[],n.channelCount=s.channelCount,n.samplerate=s.sampleRate,n.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function WU(n,e){let t=n[e+1]>>3&3,i=n[e+1]>>1&3,r=n[e+2]>>4&15,s=n[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&s!==3){let o=n[e+2]>>1&1,a=n[e+3]>>6,l=t===3?3-i:i===3?3:4,u=ate[l*14+r-1]*1e3,f=lte[(t===3?0:t===2?1:2)*3+s],m=a===3?1:2,y=cte[t][i],v=ute[i],E=y*8*v,T=Math.floor(y*u/f+o)*v;if(i_===null){let P=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);i_=P?parseInt(P[1]):0}return!!i_&&i_<=87&&i===2&&u>=224e3&&a===0&&(n[e+3]=n[e+3]|128),{sampleRate:f,channelCount:m,frameLength:T,samplesPerFrame:E}}}function r1(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function KU(n,e){return e+1<n.length&&r1(n,e)}function dte(n,e){return r1(n,e)&&4<=n.length-e}function YU(n,e){if(e+1<n.length&&r1(n,e)){let i=WU(n,e),r=4;i!=null&&i.frameLength&&(r=i.frameLength);let s=e+r;return s===n.length||KU(n,s)}return!1}var WA=class extends Gp{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;let i=jp(e,0),r=i?.length||0;if(YU(e,r))return!1;for(let s=e.length;r<s;r++)if(Hee(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return zee(e,t)}appendFrame(e,t,i){$U(e,this.observer,t,i,e.manifestCodec);let r=GU(e,t,i,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}},QU=(n,e)=>{let t=0,i=5;e+=i;let r=new Uint32Array(1),s=new Uint32Array(1),o=new Uint8Array(1);for(;i>0;){o[0]=n[e];let a=Math.min(i,8),l=8-a;s[0]=4278190080>>>24+l<<l,r[0]=(o[0]&s[0])>>l,t=t?t<<a|r[0]:r[0],e+=1,i-=a}return t},KA=class extends Gp{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){let r=ZU(e,t,i,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;let t=jp(e,0);if(!t)return!1;let i=t.length;return e[i]===11&&e[i+1]===119&&i1(t)!==void 0&&QU(e,i)<16}};function ZU(n,e,t,i,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;let s=e[t+4]>>6;if(s>=3)return-1;let a=[48e3,44100,32e3][s],l=e[t+4]&63,d=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+s]*2;if(t+d>e.length)return-1;let f=e[t+6]>>5,m=0;f===2?m+=2:(f&1&&f!==1&&(m+=2),f&4&&(m+=2));let y=(e[t+6]<<8|e[t+7])>>12-m&1,E=[2,1,2,3,3,4,4,5][f]+y,T=e[t+5]>>3,C=e[t+5]&7,D=new Uint8Array([s<<6|T<<1|C>>2,(C&3)<<6|f<<3|y<<2|l>>4,l<<4&224]),P=1536/a*9e4,V=i+r*P,G=e.subarray(t,t+d);return n.config=D,n.channelCount=E,n.samplerate=a,n.samples.push({unit:G,pts:V}),d}var YA=class extends Gp{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=jp(e,0),i=t?.length||0;if(t&&e[i]===11&&e[i+1]===119&&i1(t)!==void 0&&QU(e,i)<=16)return!1;for(let r=e.length;i<r;i++)if(YU(e,i))return Gt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return dte(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return qU(e,t,i,this.basePTS,this.frameIndex)}},hte=/\/emsg[-/]ID3/i,QA=class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,r){let s=this.videoTrack=Zs("video",1),o=this.audioTrack=Zs("audio",1),a=this.txtTrack=Zs("text",1);if(this.id3Track=Zs("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;let l=uU(e);if(l.video){let{id:u,timescale:d,codec:f,supplemental:m}=l.video;s.id=u,s.timescale=a.timescale=d,s.codec=f,s.supplemental=m}if(l.audio){let{id:u,timescale:d,codec:f}=l.audio;o.id=u,o.timescale=d,o.codec=f}a.id=aU.text,s.sampleDuration=0,s.duration=o.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return TJ(e)}demux(e,t){this.timeOffset=t;let i=e,r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=Nr(this.remainderData,e));let a=AJ(i);this.remainderData=a.remainder,r.samples=a.valid||new Uint8Array}else r.samples=i;let o=this.extractID3Track(r,t);return s.samples=ZV(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){let e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;let r=this.extractID3Track(t,this.timeOffset);return i.samples=ZV(e,t),{videoTrack:t,audioTrack:Zs(),id3Track:r,textTrack:Zs()}}extractID3Track(e,t){let i=this.id3Track;if(e.samples.length){let r=ht(e.samples,["emsg"]);r&&r.forEach(s=>{let o=PJ(s);if(hte.test(o.schemeIdUri)){let a=kB(o,t),l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);let u=o.payload;i.samples.push({data:u,len:u.byteLength,dts:a,pts:a,type:pr.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){let a=kB(o,t);i.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:pr.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}};function kB(n,e){return Ie(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}var ZA=class{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Vp(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,ll.cbc)}decryptAacSample(e,t,i){let r=e[t].unit;if(r.length<=16)return;let s=r.subarray(16,r.length-r.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(o).then(a=>{let l=new Uint8Array(a);r.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)}).catch(i)}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){let t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t),r=0;for(let s=32;s<e.length-16;s+=160,r+=16)i.set(e.subarray(s,s+16),r);return i}getAvcDecryptedUnit(e,t){let i=new Uint8Array(t),r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(i.subarray(r,r+16),s);return e}decryptAvcSample(e,t,i,r,s){let o=fU(s.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,r)}).catch(r)}decryptAvcSamples(e,t,i,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){r();return}let s=e[t].units;for(;!(i>=s.length);i++){let o=s[i];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,i,r,o),!this.decrypter.isSync()))return}}}},L_=class{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,r;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){let s=i.units;r=s[s.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){let i=t.samples,r=i.length;if(r){let s=i[r-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){let r=t.byteLength,s=e.naluState||0,o=s,a=[],l=0,u,d,f,m=-1,y=0;for(s===-1&&(m=0,y=this.getNALuType(t,0),s=0,l=1);l<r;){if(u=t[l++],!s){s=u?0:1;continue}if(s===1){s=u?0:2;continue}if(!u)s=3;else if(u===1){if(d=l-s-1,m>=0){let v={data:t.subarray(m,d),type:y};a.push(v)}else{let v=this.getLastNalUnit(e.samples);v&&(o&&l<=4-o&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-o)),d>0&&(v.data=Nr(v.data,t.subarray(0,d)),v.state=0))}l<r?(f=this.getNALuType(t,l),m=l,y=f,s=0):s=-1}else s=0}if(m>=0&&s>=0){let v={data:t.subarray(m,r),type:y,state:s};a.push(v)}if(a.length===0){let v=this.getLastNalUnit(e.samples);v&&(v.data=Nr(v.data,t))}return e.naluState=s,a}},Fc=class{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){let e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");r.set(e.subarray(i,i+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;if(e>32&&Gt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){let e=this.skipLZ();return this.readBits(e+1)-1}readEG(){let e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}},XA=class extends L_{parsePES(e,t,i,r){let s=this.parseNALu(e,i.data,r),o=this.VideoSample,a,l=!1;i.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(u=>{var d,f;switch(u.type){case 1:{let E=!1;a=!0;let T=u.data;if(l&&T.length>4){let C=this.readSliceType(T);(C===2||C===4||C===7||C===9)&&(E=!0)}if(E){var m;(m=o)!=null&&m.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.frame=!0,o.key=E;break}case 5:a=!0,(d=o)!=null&&d.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,KD(u.data,1,i.pts,t.samples);break}case 7:{var y,v;a=!0,l=!0;let E=u.data,T=this.readSPS(E);if(!e.sps||e.width!==T.width||e.height!==T.height||((y=e.pixelRatio)==null?void 0:y[0])!==T.pixelRatio[0]||((v=e.pixelRatio)==null?void 0:v[1])!==T.pixelRatio[1]){e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.sps=[E];let C=E.subarray(1,4),D="avc1.";for(let P=0;P<3;P++){let V=C[P].toString(16);V.length<2&&(V="0"+V),D+=V}e.codec=D}break}case 8:a=!0,e.pps=[u.data];break;case 9:a=!0,e.audFound=!0,(f=o)!=null&&f.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(u)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){let t=new Fc(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,r=8,s;for(let o=0;o<e;o++)r!==0&&(s=t.readEG(),r=(i+s+256)%256),i=r===0?i:r}readSPS(e){let t=new Fc(e),i=0,r=0,s=0,o=0,a,l,u,d=t.readUByte.bind(t),f=t.readBits.bind(t),m=t.readUEG.bind(t),y=t.readBoolean.bind(t),v=t.skipBits.bind(t),E=t.skipEG.bind(t),T=t.skipUEG.bind(t),C=this.skipScalingList.bind(this);d();let D=d();if(f(5),v(3),d(),T(),D===100||D===110||D===122||D===244||D===44||D===83||D===86||D===118||D===128){let x=m();if(x===3&&v(1),T(),T(),v(1),y())for(l=x!==3?8:12,u=0;u<l;u++)y()&&(u<6?C(16,t):C(64,t))}T();let P=m();if(P===0)m();else if(P===1)for(v(1),E(),E(),a=m(),u=0;u<a;u++)E();T(),v(1);let V=m(),G=m(),H=f(1);H===0&&v(1),v(1),y()&&(i=m(),r=m(),s=m(),o=m());let A=[1,1];if(y()&&y())switch(d()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[d()<<8|d(),d()<<8|d()];break}}return{width:Math.ceil((V+1)*16-i*2-r*2),height:(2-H)*(G+1)*16-(H?2:4)*(s+o),pixelRatio:A}}},JA=class extends L_{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,r){let s=this.parseNALu(e,i.data,r),o=this.VideoSample,a,l=!1;i.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(u=>{var d,f;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var m;(m=o)!=null&&m.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(d=o)!=null&&d.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,KD(u.data,2,i.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=zt(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){let y=this.readSPS(u.data);e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.codec=y.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(let v in y.params)e.params[v]=y.params[v]}this.pushParameterSet(e.sps,u.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];let y=this.readPPS(u.data);for(let v in y)e.params[v]=y[v]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(f=o)!=null&&f.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:a=!1;break}o&&a&&o.units.push(u)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){let t=new Uint8Array(e.byteLength),i=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[i]=e[r],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){let t=new Fc(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);let i=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:r}}readSPS(e){let t=new Fc(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);let i=t.readBits(3);t.readBoolean();let r=t.readBits(2),s=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),l=t.readUByte(),u=t.readUByte(),d=t.readUByte(),f=t.readUByte(),m=t.readUByte(),y=t.readUByte(),v=t.readUByte(),E=t.readUByte(),T=t.readUByte(),C=t.readUByte(),D=[],P=[];for(let at=0;at<i;at++)D.push(t.readBoolean()),P.push(t.readBoolean());if(i>0)for(let at=i;at<8;at++)t.readBits(2);for(let at=0;at<i;at++)D[at]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),P[at]&&t.readUByte();t.readUEG();let V=t.readUEG();V==3&&t.skipBits(1);let G=t.readUEG(),H=t.readUEG(),A=t.readBoolean(),x=0,R=0,M=0,F=0;A&&(x+=t.readUEG(),R+=t.readUEG(),M+=t.readUEG(),F+=t.readUEG());let j=t.readUEG(),B=t.readUEG(),pe=t.readUEG(),Ee=t.readBoolean();for(let at=Ee?0:i;at<=i;at++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let _n=0;_n<4;_n++)for(let Jn=0;Jn<(_n===3?2:6);Jn++)if(!t.readBoolean())t.readUEG();else{let ei=Math.min(64,1<<4+(_n<<1));_n>1&&t.readEG();for(let Gi=0;Gi<ei;Gi++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());let W=t.readUEG(),ne=0;for(let at=0;at<W;at++){let _n=!1;if(at!==0&&(_n=t.readBoolean()),_n){at===W&&t.readUEG(),t.readBoolean(),t.readUEG();let Jn=0;for(let xi=0;xi<=ne;xi++){let ei=t.readBoolean(),Gi=!1;ei||(Gi=t.readBoolean()),(ei||Gi)&&Jn++}ne=Jn}else{let Jn=t.readUEG(),xi=t.readUEG();ne=Jn+xi;for(let ei=0;ei<Jn;ei++)t.readUEG(),t.readBoolean();for(let ei=0;ei<xi;ei++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){let at=t.readUEG();for(let _n=0;_n<at;_n++){for(let Jn=0;Jn<pe+4;Jn++)t.readBits(1);t.readBits(1)}}let oe=0,ie=1,de=1,he=!0,Ne=1,je=0;t.readBoolean(),t.readBoolean();let Je=!1;if(t.readBoolean()){if(t.readBoolean()){let gr=t.readUByte(),jc=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],yr=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];gr>0&&gr<16?(ie=jc[gr-1],de=yr[gr-1]):gr===255&&(ie=t.readBits(16),de=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Je=t.readBoolean(),Je&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(Ne=t.readBits(32),je=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){let yr=t.readBoolean(),eo=t.readBoolean(),vr=!1;(yr||eo)&&(vr=t.readBoolean(),vr&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),vr&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let En=0;En<=i;En++){he=t.readBoolean();let Sn=he||t.readBoolean(),cs=!1;Sn?t.readEG():cs=t.readBoolean();let fl=cs?1:t.readUEG()+1;if(yr)for(let Vr=0;Vr<fl;Vr++)t.readUEG(),t.readUEG(),vr&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(eo)for(let Vr=0;Vr<fl;Vr++)t.readUEG(),t.readUEG(),vr&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),oe=t.readUEG())}let kt=G,Zt=H;if(A){let at=1,_n=1;V===1?at=_n=2:V==2&&(at=2),kt=G-at*R-at*x,Zt=H-_n*F-_n*M}let bn=r?["A","B","C"][r]:"",hl=a<<24|l<<16|u<<8|d,as=0;for(let at=0;at<32;at++)as=(as|(hl>>at&1)<<31-at)>>>0;let ls=as.toString(16);return o===1&&ls==="2"&&(ls="6"),{codecString:`hvc1.${bn}${o}.${ls}.${s?"H":"L"}${C}.B0`,params:{general_tier_flag:s,general_profile_idc:o,general_profile_space:r,general_profile_compatibility_flags:[a,l,u,d],general_constraint_indicator_flags:[f,m,y,v,E,T],general_level_idc:C,bit_depth:j+8,bit_depth_luma_minus8:j,bit_depth_chroma_minus8:B,min_spatial_segmentation_idc:oe,chroma_format_idc:V,frame_rate:{fixed:he,fps:je/Ne}},width:kt,height:Zt,pixelRatio:[ie,de]}}readPPS(e){let t=new Fc(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);let r=t.readBoolean(),s=t.readBoolean(),o=1;return s&&r?o=0:s?o=3:r&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}},Zn=188,eD=class n{constructor(e,t,i,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=r,this.videoParser=null}static probe(e,t){let i=n.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){let t=e.length,i=Math.min(Zn*5,t-Zn)+1,r=0;for(;r<i;){let s=!1,o=-1,a=0;for(let l=r;l<t;l+=Zn)if(e[l]===71&&(t-l===Zn||e[l+Zn]===71)){if(a++,o===-1&&(o=l,o!==0&&(i=Math.min(o+Zn*99,e.length-Zn)+1)),s||(s=tD(e,l)===0),s&&a>1&&(o===0&&a>2||l+Zn>i))return o}else{if(a)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:aU[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=n.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=n.createTrack("audio",r),this._id3Track=n.createTrack("id3"),this._txtTrack=n.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){let{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,r=!1){i||(this.sampleAes=null);let s,o=this._videoTrack,a=this._audioTrack,l=this._id3Track,u=this._txtTrack,d=o.pid,f=o.pesData,m=a.pid,y=l.pid,v=a.pesData,E=l.pesData,T=null,C=this.pmtParsed,D=this._pmtId,P=e.length;if(this.remainderData&&(e=Nr(this.remainderData,e),P=e.length,this.remainderData=null),P<Zn&&!r)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};let V=Math.max(0,n.syncOffset(e));P-=(P-V)%Zn,P<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,P,e.buffer.byteLength-P));let G=0;for(let A=V;A<P;A+=Zn)if(e[A]===71){let x=!!(e[A+1]&64),R=tD(e,A),M=(e[A+3]&48)>>4,F;if(M>1){if(F=A+5+e[A+4],F===A+Zn)continue}else F=A+4;switch(R){case d:x&&(f&&(s=Fd(f,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,u,s,!1)),f={data:[],size:0}),f&&(f.data.push(e.subarray(F,A+Zn)),f.size+=A+Zn-F);break;case m:if(x){if(v&&(s=Fd(v,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,s);break;case"mp3":this.parseMPEGPES(a,s);break;case"ac3":this.parseAC3PES(a,s);break}v={data:[],size:0}}v&&(v.data.push(e.subarray(F,A+Zn)),v.size+=A+Zn-F);break;case y:x&&(E&&(s=Fd(E,this.logger))&&this.parseID3PES(l,s),E={data:[],size:0}),E&&(E.data.push(e.subarray(F,A+Zn)),E.size+=A+Zn-F);break;case 0:x&&(F+=e[F]+1),D=this._pmtId=fte(e,F);break;case D:{x&&(F+=e[F]+1);let j=pte(e,F,this.typeSupported,i,this.observer,this.logger);d=j.videoPid,d>0&&(o.pid=d,o.segmentCodec=j.segmentVideoCodec),m=j.audioPid,m>0&&(a.pid=m,a.segmentCodec=j.segmentAudioCodec),y=j.id3Pid,y>0&&(l.pid=y),T!==null&&!C&&(this.logger.warn(`MPEG-TS PMT found at ${A} after unknown PID '${T}'. Backtracking to sync byte @${V} to parse all TS packets.`),T=null,A=V-188),C=this.pmtParsed=!0;break}case 17:case 8191:break;default:T=R;break}}else G++;G>0&&nD(this.observer,new Error(`Found ${G} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=f,a.pesData=v,l.pesData=E;let H={audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};return r&&this.extractRemainingSamples(H),H}flush(){let{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){let{audioTrack:t,videoTrack:i,id3Track:r,textTrack:s}=e,o=i.pesData,a=t.pesData,l=r.pesData,u;if(o&&(u=Fd(o,this.logger))?(this.readyVideoParser(i.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(i,s,u,!0),i.pesData=null)):i.pesData=o,a&&(u=Fd(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(u=Fd(l,this.logger))?(this.parseID3PES(r,u),r.pesData=null):r.pesData=l}demuxSampleAes(e,t,i){let r=this.demux(e,i,!0,!this.config.progressive),s=this.sampleAes=new ZA(this.observer,this.config,t);return this.decrypt(r,s)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new XA:e==="hevc"&&(this.videoParser=new JA))}decrypt(e,t){return new Promise(i=>{let{audioTrack:r,videoTrack:s}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{i(e)}):i(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0,r=this.aacOverFlow,s=t.data;if(r){this.aacOverFlow=null;let f=r.missing,m=r.sample.unit.byteLength;if(f===-1)s=Nr(r.sample.unit,s);else{let y=m-f;r.sample.unit.set(s.subarray(0,f),y),e.samples.push(r.sample),i=r.missing}}let o,a;for(o=i,a=s.length;o<a-1&&!k_(s,o);o++);if(o!==i){let f,m=o<a-1;if(m?f=`AAC PES did not start with ADTS header,offset:${o}`:f="No ADTS header found in AAC PES",nD(this.observer,new Error(f),m,this.logger),!m)return}$U(e,this.observer,s,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(r){let f=jU(e.samplerate);l=r.sample.pts+f}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,d;for(;o<a;)if(d=GU(e,s,o,l,u),o+=d.length,d.missing){this.aacOverFlow=d;break}else for(u++;o<a-1&&!k_(s,o);o++);}parseMPEGPES(e,t){let i=t.data,r=i.length,s=0,o=0,a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<r;)if(KU(i,o)){let l=qU(e,i,o,a,s);if(l)o+=l.length,s++;else break}else o++}parseAC3PES(e,t){{let i=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}let s=i.length,o=0,a=0,l;for(;a<s&&(l=ZU(e,i,a,r,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}let i=zt({},t,{type:this._videoTrack?pr.emsg:pr.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}};function tD(n,e){return((n[e+1]&31)<<8)+n[e+2]}function fte(n,e){return(n[e+10]&31)<<8|n[e+11]}function pte(n,e,t,i,r,s){let o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(n[e+1]&15)<<8|n[e+2],l=e+3+a-4,u=(n[e+10]&15)<<8|n[e+11];for(e+=12+u;e<l;){let d=tD(n,e),f=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!i){pA("ADTS AAC",s);break}case 15:o.audioPid===-1&&(o.audioPid=d);break;case 21:o.id3Pid===-1&&(o.id3Pid=d);break;case 219:if(!i){pA("H.264",s);break}case 27:o.videoPid===-1&&(o.videoPid=d);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=d,o.segmentAudioCodec="mp3");break;case 193:if(!i){pA("AC-3",s);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=d,o.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&f>0){let m=e+5,y=f;for(;y>2;){switch(n[m]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=d,o.segmentAudioCodec="ac3");break}let E=n[m+1]+2;m+=E,y-=E}}break;case 194:case 135:return nD(r,new Error("Unsupported EC-3 in M2TS found"),void 0,s),o;case 36:o.videoPid===-1&&(o.videoPid=d,o.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=f+5}return o}function nD(n,e,t,i){i.warn(`parsing error: ${e.message}`),n.emit(b.ERROR,b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function pA(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Fd(n,e){let t=0,i,r,s,o,a,l=n.data;if(!n||n.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Nr(l[0],l[1]),l.splice(1,1);if(i=l[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(r=(i[4]<<8)+i[5],r&&r>n.size-6)return null;let d=i[7];d&192&&(o=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,d&64?(a=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),s=i[8];let f=s+9;if(n.size<=f)return null;n.size-=f;let m=new Uint8Array(n.size);for(let y=0,v=l.length;y<v;y++){i=l[y];let E=i.byteLength;if(f)if(f>E){f-=E;continue}else i=i.subarray(f),E-=f,f=0;m.set(i,t),t+=E}return r&&(r-=s+3),{data:m,pts:o,dts:a,len:r}}return null}var iD=class{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}},il=Math.pow(2,32)-1,Vd=(()=>{class n{static init(){n.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let t;for(t in n.types)n.types.hasOwnProperty(t)&&(n.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);let i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);n.HDLR_TYPES={video:i,audio:r};let s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);n.STTS=n.STSC=n.STCO=o,n.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),n.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),n.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),n.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);let a=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);n.FTYP=n.box(n.types.ftyp,a,u,a,l),n.DINF=n.box(n.types.dinf,n.box(n.types.dref,s))}static box(t,...i){let r=8,s=i.length,o=s;for(;s--;)r+=i[s].byteLength;let a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=r&255,a.set(t,4),s=0,r=8;s<o;s++)a.set(i[s],r),r+=i[s].byteLength;return a}static hdlr(t){return n.box(n.types.hdlr,n.HDLR_TYPES[t])}static mdat(t){return n.box(n.types.mdat,t)}static mdhd(t,i){i*=t;let r=Math.floor(i/(il+1)),s=Math.floor(i%(il+1));return n.box(n.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(t){return n.box(n.types.mdia,n.mdhd(t.timescale||0,t.duration||0),n.hdlr(t.type),n.minf(t))}static mfhd(t){return n.box(n.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))}static minf(t){return t.type==="audio"?n.box(n.types.minf,n.box(n.types.smhd,n.SMHD),n.DINF,n.stbl(t)):n.box(n.types.minf,n.box(n.types.vmhd,n.VMHD),n.DINF,n.stbl(t))}static moof(t,i,r){return n.box(n.types.moof,n.mfhd(t),n.traf(r,i))}static moov(t){let i=t.length,r=[];for(;i--;)r[i]=n.trak(t[i]);return n.box.apply(null,[n.types.moov,n.mvhd(t[0].timescale||0,t[0].duration||0)].concat(r).concat(n.mvex(t)))}static mvex(t){let i=t.length,r=[];for(;i--;)r[i]=n.trex(t[i]);return n.box.apply(null,[n.types.mvex,...r])}static mvhd(t,i){i*=t;let r=Math.floor(i/(il+1)),s=Math.floor(i%(il+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return n.box(n.types.mvhd,o)}static sdtp(t){let i=t.samples||[],r=new Uint8Array(4+i.length),s,o;for(s=0;s<i.length;s++)o=i[s].flags,r[s+4]=o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy;return n.box(n.types.sdtp,r)}static stbl(t){return n.box(n.types.stbl,n.stsd(t),n.box(n.types.stts,n.STTS),n.box(n.types.stsc,n.STSC),n.box(n.types.stsz,n.STSZ),n.box(n.types.stco,n.STCO))}static avc1(t){let i=[],r=[],s,o,a;for(s=0;s<t.sps.length;s++)o=t.sps[s],a=o.byteLength,i.push(a>>>8&255),i.push(a&255),i=i.concat(Array.prototype.slice.call(o));for(s=0;s<t.pps.length;s++)o=t.pps[s],a=o.byteLength,r.push(a>>>8&255),r.push(a&255),r=r.concat(Array.prototype.slice.call(o));let l=n.box(n.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(r))),u=t.width,d=t.height,f=t.pixelRatio[0],m=t.pixelRatio[1];return n.box(n.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,n.box(n.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),n.box(n.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,m>>24,m>>16&255,m>>8&255,m&255])))}static esds(t){let i=t.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...i,6,1,2])}static audioStsd(t){let i=t.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount||0,0,16,0,0,0,0,i>>8&255,i&255,0,0])}static mp4a(t){return n.box(n.types.mp4a,n.audioStsd(t),n.box(n.types.esds,n.esds(t)))}static mp3(t){return n.box(n.types[".mp3"],n.audioStsd(t))}static ac3(t){return n.box(n.types["ac-3"],n.audioStsd(t),n.box(n.types.dac3,t.config))}static stsd(t){let{segmentCodec:i}=t;if(t.type==="audio"){if(i==="aac")return n.box(n.types.stsd,n.STSD,n.mp4a(t));if(i==="ac3"&&t.config)return n.box(n.types.stsd,n.STSD,n.ac3(t));if(i==="mp3"&&t.codec==="mp3")return n.box(n.types.stsd,n.STSD,n.mp3(t))}else if(t.pps&&t.sps){if(i==="avc")return n.box(n.types.stsd,n.STSD,n.avc1(t));if(i==="hevc"&&t.vps)return n.box(n.types.stsd,n.STSD,n.hvc1(t))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${t.type} segment codec (${i}/${t.codec})`)}static tkhd(t){let i=t.id,r=(t.duration||0)*(t.timescale||0),s=t.width||0,o=t.height||0,a=Math.floor(r/(il+1)),l=Math.floor(r%(il+1));return n.box(n.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,i&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,l>>24,l>>16&255,l>>8&255,l&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,o>>8&255,o&255,0,0]))}static traf(t,i){let r=n.sdtp(t),s=t.id,o=Math.floor(i/(il+1)),a=Math.floor(i%(il+1));return n.box(n.types.traf,n.box(n.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),n.box(n.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255])),n.trun(t,r.length+16+20+8+16+8+8),r)}static trak(t){return t.duration=t.duration||4294967295,n.box(n.types.trak,n.tkhd(t),n.mdia(t))}static trex(t){let i=t.id;return n.box(n.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,i){let r=t.samples||[],s=r.length,o=12+16*s,a=new Uint8Array(o),l,u,d,f,m,y;for(i+=8+o,a.set([t.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255],0),l=0;l<s;l++)u=r[l],d=u.duration,f=u.size,m=u.flags,y=u.cts,a.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&61440,m.degradPrio&15,y>>>24&255,y>>>16&255,y>>>8&255,y&255],12+16*l);return n.box(n.types.trun,a)}static initSegment(t){n.types||n.init();let i=n.moov(t);return Nr(n.FTYP,i)}static hvc1(t){let i=t.params,r=[t.vps,t.sps,t.pps],s=4,o=new Uint8Array([1,i.general_profile_space<<6|(i.general_tier_flag?32:0)|i.general_profile_idc,i.general_profile_compatibility_flags[0],i.general_profile_compatibility_flags[1],i.general_profile_compatibility_flags[2],i.general_profile_compatibility_flags[3],i.general_constraint_indicator_flags[0],i.general_constraint_indicator_flags[1],i.general_constraint_indicator_flags[2],i.general_constraint_indicator_flags[3],i.general_constraint_indicator_flags[4],i.general_constraint_indicator_flags[5],i.general_level_idc,240|i.min_spatial_segmentation_idc>>8,255&i.min_spatial_segmentation_idc,252|i.parallelismType,252|i.chroma_format_idc,248|i.bit_depth_luma_minus8,248|i.bit_depth_chroma_minus8,0,parseInt(i.frame_rate.fps),s-1|i.temporal_id_nested<<2|i.num_temporal_layers<<3|(i.frame_rate.fixed?64:0),r.length]),a=o.length;for(let E=0;E<r.length;E+=1){a+=3;for(let T=0;T<r[E].length;T+=1)a+=2+r[E][T].length}let l=new Uint8Array(a);l.set(o,0),a=o.length;let u=r.length-1;for(let E=0;E<r.length;E+=1){l.set(new Uint8Array([32+E|(E===u?128:0),0,r[E].length]),a),a+=3;for(let T=0;T<r[E].length;T+=1)l.set(new Uint8Array([r[E][T].length>>8,r[E][T].length&255]),a),a+=2,l.set(r[E][T],a),a+=r[E][T].length}let d=n.box(n.types.hvcC,l),f=t.width,m=t.height,y=t.pixelRatio[0],v=t.pixelRatio[1];return n.box(n.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,n.box(n.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),n.box(n.types.pasp,new Uint8Array([y>>24,y>>16&255,y>>8&255,y&255,v>>24,v>>16&255,v>>8&255,v&255])))}}return n.types=void 0,n.HDLR_TYPES=void 0,n.STTS=void 0,n.STSC=void 0,n.STCO=void 0,n.STSZ=void 0,n.VMHD=void 0,n.SMHD=void 0,n.STSD=void 0,n.FTYP=void 0,n.DINF=void 0,n})(),XU=9e4;function s1(n,e,t=1,i=!1){let r=n*e*t;return i?Math.round(r):r}function mte(n,e,t=1,i=!1){return s1(n,e,1/t,i)}function Dp(n,e=!1){return s1(n,1e3,1/XU,e)}function gte(n,e=1){return s1(n,XU,1/e)}function LB(n){let{baseTime:e,timescale:t,trackId:i}=n;return`${e/t} (${e}/${t}) trackId: ${i}`}var yte=10*1e3,vte=1024,_te=1152,Ete=1536,Bd=null,mA=null;function OB(n,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}var Hd=class extends ji{constructor(e,t,i,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,Bd===null){let o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Bd=o?parseInt(o[1]):0}if(mA===null){let s=navigator.userAgent.match(/Safari\/(\d+)/i);mA=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){let t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&LB(t)} > ${e&&LB(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1,i=e[0].pts,r=e.reduce((s,o)=>{let a=o.pts,l=a-s;return l<-4294967296&&(t=!0,a=fr(a,i),l=a-s),l>0?s:a},i);return t&&this.debug("PTS rollover detected"),r}remux(e,t,i,r,s,o,a,l){let u,d,f,m,y,v,E=s,T=s,C=e.pid>-1,D=t.pid>-1,P=t.samples.length,V=e.samples.length>0,G=a&&P>0||P>1;if((!C||V)&&(!D||G)||this.ISGenerated||a){if(this.ISGenerated){var A,x,R,M;let pe=this.videoTrackConfig;(pe&&(t.width!==pe.width||t.height!==pe.height||((A=t.pixelRatio)==null?void 0:A[0])!==((x=pe.pixelRatio)==null?void 0:x[0])||((R=t.pixelRatio)==null?void 0:R[1])!==((M=pe.pixelRatio)==null?void 0:M[1]))||!pe&&G||this.nextAudioTs===null&&V)&&this.resetInitSegment()}this.ISGenerated||(f=this.generateIS(e,t,s,o));let F=this.isVideoContiguous,j=-1,B;if(G&&(j=Tte(t.samples),!F&&this.config.forceKeyFrameOnDiscontinuity))if(v=!0,j>0){this.warn(`Dropped ${j} out of ${P} video samples due to a missing keyframe`);let pe=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(j),t.dropped+=j,T+=(t.samples[0].pts-pe)/t.inputTimeScale,B=T}else j===-1&&(this.warn(`No keyframe found out of ${P} video samples`),v=!1);if(this.ISGenerated){if(V&&G){let pe=this.getVideoStartPts(t.samples),q=(fr(e.samples[0].pts,pe)-pe)/t.inputTimeScale;E+=Math.max(0,q),T+=Math.max(0,-q)}if(V){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),f=this.generateIS(e,t,s,o)),d=this.remuxAudio(e,E,this.isAudioContiguous,o,D||G||l===De.AUDIO?T:void 0),G){let pe=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),f=this.generateIS(e,t,s,o)),u=this.remuxVideo(t,T,F,pe)}}else G&&(u=this.remuxVideo(t,T,F,0));u&&(u.firstKeyFrame=j,u.independent=j!==-1,u.firstKeyFramePTS=B)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(y=JU(i,s,this._initPTS,this._initDTS)),r.samples.length&&(m=e$(r,s,this._initPTS))),{audio:d,video:u,initSegment:f,independent:v,text:m,id3:y}}computeInitPts(e,t,i,r){let s=Math.round(i*t),o=fr(e,s);if(o<s+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(s-o)/t} ${r}`);o<s+t;)o+=8589934592;return o-s}generateIS(e,t,i,r){let s=e.samples,o=t.samples,a=this.typeSupported,l={},u=this._initPTS,d=!u||r,f="audio/mp4",m,y,v,E=-1;if(d&&(m=y=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:f,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):Vd.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(E=e.id,v=e.inputTimeScale,!u||v!==u.timescale?m=y=this.computeInitPts(s[0].pts,v,i,"audio"):d=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Vd.initSegment([t]),metadata:{width:t.width,height:t.height}},d)if(E=t.id,v=t.inputTimeScale,!u||v!==u.timescale){let T=this.getVideoStartPts(o),C=fr(o[0].dts,T),D=this.computeInitPts(C,v,i,"video"),P=this.computeInitPts(T,v,i,"video");y=Math.min(y,D),m=Math.min(m,P)}else d=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,d?(u&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${i} ${m/v} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${m/v} (${m}/${v}) trackId: ${E}`),this._initPTS={baseTime:m,timescale:v,trackId:E},this._initDTS={baseTime:y,timescale:v,trackId:E}):m=v=void 0,{tracks:l,initPTS:m,timescale:v,trackId:E}}remuxVideo(e,t,i,r){let s=e.inputTimeScale,o=e.samples,a=[],l=o.length,u=this._initPTS,d=u.baseTime*s/u.timescale,f=this.nextVideoTs,m=8,y=this.videoSampleDuration,v,E,T=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY,D=!1;if(!i||f===null){let oe=d+t*s,ie=o[0].pts-fr(o[0].dts,o[0].pts);Bd&&f!==null&&Math.abs(oe-ie-(f+d))<15e3?i=!0:f=oe-ie-d}let P=f+d;for(let oe=0;oe<l;oe++){let ie=o[oe];ie.pts=fr(ie.pts,P),ie.dts=fr(ie.dts,P),ie.dts<o[oe>0?oe-1:oe].dts&&(D=!0)}D&&o.sort(function(oe,ie){let de=oe.dts-ie.dts,he=oe.pts-ie.pts;return de||he}),v=o[0].dts,E=o[o.length-1].dts;let V=E-v,G=V?Math.round(V/(l-1)):y||e.inputTimeScale/30;if(i){let oe=v-P,ie=oe>G,de=oe<-1;if((ie||de)&&(ie?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Dp(oe,!0)} ms (${oe}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Dp(-oe,!0)} ms (${oe}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!de||P>=o[0].pts||Bd)){v=P;let he=o[0].pts-oe;if(ie)o[0].dts=v,o[0].pts=he;else{let Ne=!0;for(let je=0;je<o.length&&!(o[je].dts>he&&Ne);je++){let Je=o[je].pts;if(o[je].dts-=oe,o[je].pts-=oe,je<o.length-1){let Mt=o[je+1].pts,kt=o[je].pts,Zt=Mt<=kt,bn=Mt<=Je;Ne=Zt==bn}}}this.log(`Video: Initial PTS/DTS adjusted: ${Dp(he,!0)}/${Dp(v,!0)}, delta: ${Dp(oe,!0)} ms`)}}v=Math.max(0,v);let H=0,A=0,x=v;for(let oe=0;oe<l;oe++){let ie=o[oe],de=ie.units,he=de.length,Ne=0;for(let je=0;je<he;je++)Ne+=de[je].data.length;A+=Ne,H+=he,ie.length=Ne,ie.dts<x?(ie.dts=x,x+=G/4|0||1):x=ie.dts,T=Math.min(ie.pts,T),C=Math.max(ie.pts,C)}E=o[l-1].dts;let R=A+4*H+8,M;try{M=new Uint8Array(R)}catch(oe){this.observer.emit(b.ERROR,b.ERROR,{type:Oe.MUX_ERROR,details:Q.REMUX_ALLOC_ERROR,fatal:!1,error:oe,bytes:R,reason:`fail allocating video mdat ${R}`});return}let F=new DataView(M.buffer);F.setUint32(0,R),M.set(Vd.types.mdat,4);let j=!1,B=Number.POSITIVE_INFINITY,pe=Number.POSITIVE_INFINITY,Ee=Number.NEGATIVE_INFINITY,q=Number.NEGATIVE_INFINITY;for(let oe=0;oe<l;oe++){let ie=o[oe],de=ie.units,he=0;for(let Je=0,Mt=de.length;Je<Mt;Je++){let kt=de[Je],Zt=kt.data,bn=kt.data.byteLength;F.setUint32(m,bn),m+=4,M.set(Zt,m),m+=bn,he+=4+bn}let Ne;if(oe<l-1)y=o[oe+1].dts-ie.dts,Ne=o[oe+1].pts-ie.pts;else{let Je=this.config,Mt=oe>0?ie.dts-o[oe-1].dts:G;if(Ne=oe>0?ie.pts-o[oe-1].pts:G,Je.stretchShortVideoTrack&&this.nextAudioTs!==null){let kt=Math.floor(Je.maxBufferHole*s),Zt=(r?T+r*s:this.nextAudioTs+d)-ie.pts;Zt>kt?(y=Zt-Mt,y<0?y=Mt:j=!0,this.log(`It is approximately ${Zt/90} ms to the next segment; using duration ${y/90} ms for the last video frame.`)):y=Mt}else y=Mt}let je=Math.round(ie.pts-ie.dts);B=Math.min(B,y),Ee=Math.max(Ee,y),pe=Math.min(pe,Ne),q=Math.max(q,Ne),a.push(OB(ie.key,y,he,je))}if(a.length){if(Bd){if(Bd<70){let oe=a[0].flags;oe.dependsOn=2,oe.isNonSync=0}}else if(mA&&q-pe<Ee-B&&G/Ee<.025&&a[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let oe=v;for(let ie=0,de=a.length;ie<de;ie++){let he=oe+a[ie].duration,Ne=oe+a[ie].cts;if(ie<de-1){let je=he+a[ie+1].cts;a[ie].duration=je-Ne}else a[ie].duration=ie?a[ie-1].duration:G;a[ie].cts=0,oe=he}}}y=j||!y?G:y;let te=E+y;this.nextVideoTs=f=te-d,this.videoSampleDuration=y,this.isVideoContiguous=!0;let ye={data1:Vd.moof(e.sequenceNumber++,v,zt(e,{samples:a})),data2:M,startPTS:(T-d)/s,endPTS:(C+y-d)/s,startDTS:(v-d)/s,endDTS:f/s,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,ye}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return _te;case"ac3":return Ete;default:return vte}}remuxAudio(e,t,i,r,s){let o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,u=this.getSamplesPerFrame(e),d=u*l,f=this._initPTS,m=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,y=[],v=s!==void 0,E=e.samples,T=m?0:8,C=this.nextAudioTs||-1,D=f.baseTime*o/f.timescale,P=D+t*o;if(this.isAudioContiguous=i=i||E.length&&C>0&&(r&&Math.abs(P-(C+D))<9e3||Math.abs(fr(E[0].pts,P)-(C+D))<20*d),E.forEach(function(q){q.pts=fr(q.pts,P)}),!i||C<0){let q=E.length;if(E=E.filter(te=>te.pts>=0),q!==E.length&&this.warn(`Removed ${E.length-q} of ${q} samples (initPTS ${D} / ${o})`),!E.length)return;s===0?C=0:r&&!v?C=Math.max(0,P-D):C=E[0].pts-D}if(e.segmentCodec==="aac"){let q=this.config.maxAudioFramesDrift;for(let te=0,W=C+D;te<E.length;te++){let ne=E[te],ye=ne.pts,oe=ye-W,ie=Math.abs(1e3*oe/o);if(oe<=-q*d&&v)te===0&&(this.warn(`Audio frame @ ${(ye/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*oe/o)} ms.`),this.nextAudioTs=C=ye-D,W=ye);else if(oe>=q*d&&ie<yte&&v){let de=Math.round(oe/d);for(W=ye-de*d;W<0&&de&&d;)de--,W+=d;te===0&&(this.nextAudioTs=C=W-D),this.warn(`Injecting ${de} audio frames @ ${((W-D)/o).toFixed(3)}s due to ${Math.round(1e3*oe/o)} ms gap.`);for(let he=0;he<de;he++){let Ne=iD.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Ne||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Ne=ne.unit.subarray()),E.splice(te,0,{unit:Ne,pts:W}),W+=d,te++}}ne.pts=W,W+=d}}let V=null,G=null,H,A=0,x=E.length;for(;x--;)A+=E[x].unit.byteLength;for(let q=0,te=E.length;q<te;q++){let W=E[q],ne=W.unit,ye=W.pts;if(G!==null){let ie=y[q-1];ie.duration=Math.round((ye-G)/l)}else if(i&&e.segmentCodec==="aac"&&(ye=C+D),V=ye,A>0){A+=T;try{H=new Uint8Array(A)}catch(ie){this.observer.emit(b.ERROR,b.ERROR,{type:Oe.MUX_ERROR,details:Q.REMUX_ALLOC_ERROR,fatal:!1,error:ie,bytes:A,reason:`fail allocating audio mdat ${A}`});return}m||(new DataView(H.buffer).setUint32(0,A),H.set(Vd.types.mdat,4))}else return;H.set(ne,T);let oe=ne.byteLength;T+=oe,y.push(OB(!0,u,oe,0)),G=ye}let R=y.length;if(!R)return;let M=y[y.length-1];C=G-D,this.nextAudioTs=C+l*M.duration;let F=m?new Uint8Array(0):Vd.moof(e.sequenceNumber++,V/l,zt({},e,{samples:y}));e.samples=[];let j=(V-D)/o,B=this.nextAudioTs/o,Ee={data1:F,data2:H,startPTS:j,endPTS:B,startDTS:j,endDTS:B,type:"audio",hasAudio:!0,hasVideo:!1,nb:R};return this.isAudioContiguous=!0,Ee}};function fr(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function Tte(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function JU(n,e,t,i){let r=n.samples.length;if(!r)return;let s=n.inputTimeScale;for(let a=0;a<r;a++){let l=n.samples[a];l.pts=fr(l.pts-t.baseTime*s/t.timescale,e*s)/s,l.dts=fr(l.dts-i.baseTime*s/i.timescale,e*s)/s}let o=n.samples;return n.samples=[],{samples:o}}function e$(n,e,t){let i=n.samples.length;if(!i)return;let r=n.inputTimeScale;for(let o=0;o<i;o++){let a=n.samples[o];a.pts=fr(a.pts-t.baseTime*r/t.timescale,e*r)/r}n.samples.sort((o,a)=>o.pts-a.pts);let s=n.samples;return n.samples=[],{samples:s}}var rD=class extends ji{constructor(e,t,i,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;let t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,i,r){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:i,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}let{audio:s,video:o}=this.initData=uU(e);if(t)SJ(e,t);else{let l=s||o;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}s&&(i=NB(s,Yt.AUDIO,this)),o&&(r=NB(o,Yt.VIDEO,this));let a={};s&&o?a.audiovideo={container:"video/mp4",codec:i+","+r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:s?a.audio={container:"audio/mp4",codec:i,encrypted:s.encrypted,initSegment:e,id:"audio"}:o?a.video={container:"video/mp4",codec:r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,i,r,s,o){var a,l;let{initPTS:u,lastEndTime:d}=this,f={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};Ie(d)||(d=this.lastEndTime=s||0);let m=t.samples;if(!m.length)return f;let y={initPTS:void 0,timescale:void 0,trackId:void 0},v=this.initData;if((a=v)!=null&&a.length||(this.generateInitSegment(m),v=this.initData),!((l=v)!=null&&l.length))return this.warn("Failed to generate initSegment."),f;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1);let E=xJ(m,v,this),T=v.audio?E[v.audio.id]:null,C=v.video?E[v.video.id]:null,D=r_(C,1/0),P=r_(T,1/0),V=r_(C,0,!0),G=r_(T,0,!0),H=s,A=0,x=T&&(!C||!u&&P<D||u&&u.trackId===v.audio.id),R=x?T:C;if(R){let W=R.timescale,ne=R.start-s*W,ye=x?v.audio.id:v.video.id;H=R.start/W,A=x?G-P:V-D,(o||!u)&&(wte(u,H,s,A)||W!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${s} ${ne/W} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${H-s} (${ne}/${W}) trackId: ${ye}`),u=null,y.initPTS=ne,y.timescale=W,y.trackId=ye)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);u?(y.initPTS=u.baseTime,y.timescale=u.timescale,y.trackId=u.trackId):((!y.timescale||y.trackId===void 0||y.initPTS===void 0)&&(this.warn("Could not set initPTS"),y.initPTS=H,y.timescale=1,y.trackId=-1),this.initPTS=u={baseTime:y.initPTS,timescale:y.timescale,trackId:y.trackId});let M=H-u.baseTime/u.timescale,F=M+A;A>0?this.lastEndTime=F:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());let j=!!v.audio,B=!!v.video,pe="";j&&(pe+="audio"),B&&(pe+="video");let Ee=(v.audio?v.audio.encrypted:!1)||(v.video?v.video.encrypted:!1),q={data1:m,startPTS:M,startDTS:M,endPTS:F,endDTS:F,type:pe,hasAudio:j,hasVideo:B,nb:1,dropped:0,encrypted:Ee};f.audio=j&&!B?q:void 0,f.video=B?q:void 0;let te=C?.sampleCount;if(te){let W=C.keyFrameIndex,ne=W!==-1;q.nb=te,q.dropped=W===0||this.isVideoContiguous?0:ne?W:te,q.independent=ne,q.firstKeyFrame=W,ne&&C.keyFrameStart&&(q.firstKeyFramePTS=(C.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(f.independent=ne),this.isVideoContiguous||(this.isVideoContiguous=ne),q.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${W}/${te} dropped: ${q.dropped} start: ${q.firstKeyFramePTS||"NA"}`)}return f.initSegment=y,f.id3=JU(i,s,u,u),r.samples.length&&(f.text=e$(r,s,u)),f}};function r_(n,e,t=!1){return n?.start!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function wte(n,e,t,i){if(n===null)return!0;let r=Math.max(i,1),s=e-n.baseTime/n.timescale;return Math.abs(s-t)>r}function NB(n,e,t){let i=n.codec;return i&&i.length>4?i:e===Yt.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?T_(i,!1):(t.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(t.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}var Qo;try{Qo=self.performance.now.bind(self.performance)}catch{Qo=Date.now}var m_=[{demux:QA,remux:rD},{demux:eD,remux:Hd},{demux:WA,remux:Hd},{demux:YA,remux:Hd}];m_.splice(2,0,{demux:KA,remux:Hd});var O_=class{constructor(e,t,i,r,s,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=s,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,r){let s=i.transmuxing;s.executeStart=Qo();let o=new Uint8Array(e),{currentTransmuxState:a,transmuxConfig:l}=this;r&&(this.currentTransmuxState=r);let{contiguous:u,discontinuity:d,trackSwitch:f,accurateTimeOffset:m,timeOffset:y,initSegmentChange:v}=r||a,{audioCodec:E,videoCodec:T,defaultInitPts:C,duration:D,initSegmentData:P}=l,V=Ite(o,t);if(V&&zd(V.method)){let x=this.getDecrypter(),R=XD(V.method);if(x.isSync()){let M=x.softwareDecrypt(o,V.key.buffer,V.iv.buffer,R);if(i.part>-1){let j=x.flush();M=j&&j.buffer}if(!M)return s.executeEnd=Qo(),gA(i);o=new Uint8Array(M)}else return this.asyncResult=!0,this.decryptionPromise=x.webCryptoDecrypt(o,V.key.buffer,V.iv.buffer,R).then(M=>{let F=this.push(M,null,i);return this.decryptionPromise=null,F}),this.decryptionPromise}let G=this.needsProbing(d,f);if(G){let x=this.configureTransmuxer(o);if(x)return this.logger.warn(`[transmuxer] ${x.message}`),this.observer.emit(b.ERROR,b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,error:x,reason:x.message}),s.executeEnd=Qo(),gA(i)}(d||f||v||G)&&this.resetInitSegment(P,E,T,D,t),(d||v||G)&&this.resetInitialTimestamp(C),u||this.resetContiguity();let H=this.transmux(o,V,y,m,i);this.asyncResult=zp(H);let A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,s.executeEnd=Qo(),H}flush(e){let t=e.transmuxing;t.executeStart=Qo();let{decrypter:i,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));let o=[],{timeOffset:a}=r;if(i){let f=i.flush();f&&o.push(this.push(f.buffer,null,e))}let{demuxer:l,remuxer:u}=this;if(!l||!u){t.executeEnd=Qo();let f=[gA(e)];return this.asyncResult?Promise.resolve(f):f}let d=l.flush(a);return zp(d)?(this.asyncResult=!0,d.then(f=>(this.flushRemux(o,f,e),o))):(this.flushRemux(o,d,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,i){let{audioTrack:r,videoTrack:s,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===De.MAIN?"level":"track"} ${i.level}`);let d=this.remuxer.remux(r,s,o,a,u,l,!0,this.id);e.push({remuxResult:d,chunkMeta:i}),i.transmuxing.executeEnd=Qo()}resetInitialTimestamp(e){let{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){let{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,r,s){let{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,i,r),a.resetInitSegment(e,t,i,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,r,s){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,i,r,s):o=this.transmuxUnencrypted(e,i,r,s),o}transmuxUnencrypted(e,t,i,r){let{audioTrack:s,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,o,a,l,t,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,i,r,s){return this.demuxer.demuxSampleAes(e,t,i).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,i,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){let{config:t,observer:i,typeSupported:r}=this,s;for(let f=0,m=m_.length;f<m;f++){var o;if((o=m_[f].demux)!=null&&o.probe(e,this.logger)){s=m_[f];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");let a=this.demuxer,l=this.remuxer,u=s.remux,d=s.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(i,t,r,this.logger)),(!a||!(a instanceof d))&&(this.demuxer=new d(i,t,r,this.logger),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Vp(this.config)),e}};function Ite(n,e){let t=null;return n.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}var gA=n=>({remuxResult:{},chunkMeta:n});function zp(n){return"then"in n&&n.then instanceof Function}var sD=class{constructor(e,t,i,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=r,this.defaultInitPts=s||null}},oD=class{constructor(e,t,i,r,s,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=o}},FB=0,N_=class{constructor(e,t,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=FB++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{let u=l.data,d=this.hls;if(!(!d||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var f;let m=(f=this.workerContext)==null?void 0:f.objectURL;m&&self.URL.revokeObjectURL(m);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{d.logger[u.data.logType]&&d.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,d.trigger(u.event,u.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;let u=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(b.ERROR,{type:Oe.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};let s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;let o=(l,u)=>{u=u||{},u.frag=this.frag||void 0,l===b.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(l,u)};this.observer=new e1,this.observer.on(b.FRAG_DECRYPTED,o),this.observer.on(b.ERROR,o);let a=eB(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){let l=this.hls.logger;if(s.workerPath||Vee()){try{s.workerPath?(l.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=Uee(s.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=Bee());let{worker:d}=this.workerContext;d.addEventListener("message",this.onWorkerMessage),d.addEventListener("error",this.onWorkerError),d.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:Qt(s)})}catch(d){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,d),this.terminateWorker(),this.error=null,this.transmuxer=new O_(this.observer,a,s,"",t,e.logger)}return}}this.transmuxer=new O_(this.observer,a,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){let e=this.instanceNo;this.instanceNo=FB++;let t=this.hls.config,i=eB(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:Qt(t)})}}terminateWorker(){if(this.workerContext){let{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),$ee(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{let t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}let e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,r,s,o,a,l,u,d){var f,m;u.transmuxing.start=self.performance.now();let{instanceNo:y,transmuxer:v}=this,E=o?o.start:s.start,T=s.decryptdata,C=this.frag,D=!(C&&s.cc===C.cc),P=!(C&&u.level===C.level),V=C?u.sn-C.sn:-1,G=this.part?u.part-this.part.index:-1,H=V===0&&u.id>1&&u.id===C?.stats.chunkCount,A=!P&&(V===1||V===0&&(G===1||H&&G<=0)),x=self.performance.now();(P||V||s.stats.parsing.start===0)&&(s.stats.parsing.start=x),o&&(G||!A)&&(o.stats.parsing.start=x);let R=!(C&&((f=s.initSegment)==null?void 0:f.url)===((m=C.initSegment)==null?void 0:m.url)),M=new oD(D,A,l,P,E,R);if(!A||D||R){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===De.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${D}
        trackSwitch: ${P}
        contiguous: ${A}
        accurateTimeOffset: ${l}
        timeOffset: ${E}
        initSegmentChange: ${R}`);let F=new sD(i,r,t,a,d);this.configureTransmuxer(F)}if(this.frag=s,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:y,cmd:"demux",data:e,decryptdata:T,chunkMeta:u,state:M},e instanceof ArrayBuffer?[e]:[]);else if(v){let F=v.push(e,T,u,M);zp(F)?F.then(j=>{this.handleTransmuxComplete(j)}).catch(j=>{this.transmuxerError(j,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(F)}}flush(e){e.transmuxing.start=self.performance.now();let{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){let r=i.flush(e);zp(r)?r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){let{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}},VB=100,aD=class extends Up{constructor(e,t,i){super(e,t,i,"audio-stream-controller",De.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();let{hls:e}=this;e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(b.BUFFER_RESET,this.onBufferReset,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){let{hls:e}=this;e&&(super.unregisterListeners(),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(b.BUFFER_RESET,this.onBufferReset,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s,trackId:o}){if(i===De.MAIN){let a=t.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:r,timescale:s,trackId:o},this.log(`InitPTS for cc: ${a} found from main: ${r/s} (${r}/${s}) trackId: ${o}`),this.mainAnchor=t,this.state===re.WAITING_INIT_PTS){let u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==a)&&this.syncWithAnchor(t,u?.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===re.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var i;let r=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(t&&r?.cc===t.cc)return;let s=(r||e).cc,o=this.getLevelDetails(),a=this.getLoadPosition(),l=TU(o,s,a);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===re.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=re.STOPPED;return}let i=this.lastCurrentTime;this.stopLoad(),this.setInterval(VB),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=re.IDLE):this.state=re.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case re.IDLE:this.doTickIdle();break;case re.WAITING_TRACK:{let{levels:e,trackId:t}=this,i=e?.[t],r=i?.details;if(r&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(r))break;this.state=re.WAITING_INIT_PTS}break}case re.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case re.WAITING_INIT_PTS:{let e=this.waitingData;if(e){let{frag:t,part:i,cache:r,complete:s}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=re.FRAG_LOADING;let a=r.flush().buffer,l={frag:t,part:i,payload:a,networkDetails:null};this._handleFragmentLoadProgress(l),s&&super._handleFragmentLoadComplete(l)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=re.IDLE}}this.onTickEnd()}resetLoadingState(){let e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){let{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;let{hls:t,levels:i,media:r,trackId:s}=this,o=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(i!=null&&i[s]))return;let a=i[s],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=re.WAITING_TRACK,this.startFragRequested=!1;return}let u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,Yt.AUDIO,De.AUDIO));let d=this.getFwdBufferInfo(u,De.AUDIO);if(d===null)return;if(!this.switchingTrack&&this._streamEnded(d,l)){t.trigger(b.BUFFER_EOS,{type:"audio"}),this.state=re.ENDED;return}let f=d.len,m=t.maxBufferLength,y=l.fragments,v=y[0].start,E=this.getLoadPosition(),T=this.flushing?E:d.end;if(this.switchingTrack&&r){let P=E;l.PTSKnown&&P<v&&(d.end>v||d.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=v+.05)}if(f>=m&&!this.switchingTrack&&T<y[y.length-1].start)return;let C=this.getNextFragment(T,l);if(C&&this.isLoopLoading(C,T)&&(C=this.getNextFragmentLoopLoading(C,l,d,De.MAIN,m)),!C){this.bufferFlushed=!0;return}let D=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&D&&In(C)&&!C.endList&&(!l.live||!this.loadingParts&&T<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(D)===jn.OK&&(this.mainFragLoading=D=null),D&&In(D))){if(C.start>D.end){let V=this.fragmentTracker.getFragAtPos(T,De.MAIN);V&&V.end>D.end&&(D=V,this.mainFragLoading={frag:V,targetBufferTime:null})}if(C.start>D.end)return}this.loadFragment(C,a,T)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new Vc(i))}onAudioTrackSwitching(e,t){let i=!!t.url;this.trackId=t.id;let{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==re.STOPPED&&(this.setInterval(VB),this.state=re.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;let i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(b.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;let{levels:r}=this,{details:s,id:o,groupId:a,track:l}=t;if(!r){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}let u=this.mainDetails;if(!u||s.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==re.STOPPED&&(this.state=re.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);let d=r[o],f=0;if(s.live||(i=d.details)!=null&&i.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(d.details){var m;f=this.alignPlaylists(s,d.details,(m=this.levelLastLoaded)==null?void 0:m.details)}s.alignedSliding||(FU(s,u),s.alignedSliding||R_(s,u),f=s.fragmentStart)}d.details=s,this.levelLastLoaded=d,this.startFragRequested||this.setStartPosition(u,f),this.hls.trigger(b.AUDIO_TRACK_UPDATED,{details:s,id:o,groupId:t.groupId}),this.state===re.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=re.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;let i=e.frag,{part:r,payload:s}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}let u=l[a];if(!u){this.warn("Audio track is undefined on fragment load progress");return}let d=u.details;if(!d){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}let f=o.defaultAudioCodec||u.audioCodec||"mp4a.40.2",m=this.transmuxer;m||(m=this.transmuxer=new N_(this.hls,De.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));let y=this.initPTS[i.cc],v=(t=i.initSegment)==null?void 0:t.data;if(y!==void 0){let T=r?r.index:-1,C=T!==-1,D=new Bp(i.level,i.sn,i.stats.chunkCount,s.byteLength,T,C);m.push(s,v,f,"",i,r,d.totalduration,!1,D,y)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${d.startSN} ,${d.endSN}],track ${a}`);let{cache:E}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new M_,complete:!1};E.push(new Uint8Array(s)),this.state!==re.STOPPED&&(this.state=re.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;let i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===De.MAIN&&In(t.frag)&&(this.mainFragLoading=t,this.state===re.IDLE&&this.tick())}onFragBuffered(e,t){let{frag:i,part:r}=t;if(i.type!==De.AUDIO){!this.audioOnly&&i.type===De.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(In(i)){this.fragPrevious=i;let s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(b.AUDIO_TRACK_SWITCHED,jt({},s)))}this.fragBufferedComplete(i,r),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=re.ERROR;return}switch(t.details){case Q.FRAG_GAP:case Q.FRAG_PARSING_ERROR:case Q.FRAG_DECRYPT_ERROR:case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(De.AUDIO,t);break;case Q.AUDIO_TRACK_LOAD_ERROR:case Q.AUDIO_TRACK_LOAD_TIMEOUT:case Q.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===re.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===mt.AUDIO_TRACK&&(this.state=re.IDLE);break;case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Q.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Q.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Yt.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Yt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===re.ENDED&&(this.state=re.IDLE);let i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,De.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;let i="audio",{hls:r}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}let{frag:l,part:u,level:d}=a,{details:f}=d,{audio:m,text:y,id3:v,initSegment:E}=s;if(this.fragContextChanged(l)||!f){this.fragmentTracker.removeFragment(l);return}if(this.state=re.PARSING,this.switchingTrack&&m&&this.completeAudioSwitch(this.switchingTrack),E!=null&&E.tracks){let T=l.initSegment||l;if(this.unhandledEncryptionError(E,l))return;this._bufferInitSegment(d,E.tracks,T,o),r.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:i,tracks:E.tracks})}if(m){let{startPTS:T,endPTS:C,startDTS:D,endDTS:P}=m;u&&(u.elementaryStreams[Yt.AUDIO]={startPTS:T,endPTS:C,startDTS:D,endDTS:P}),l.setElementaryStreamInfo(Yt.AUDIO,T,C,D,P),this.bufferFragmentData(m,l,u,o)}if(v!=null&&(t=v.samples)!=null&&t.length){let T=zt({id:i,frag:l,details:f},v);r.trigger(b.FRAG_PARSING_METADATA,T)}if(y){let T=zt({id:i,frag:l,details:f},y);r.trigger(b.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,i,r){if(this.state!==re.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;let s=t.audio;s.id=De.AUDIO;let o=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${o}/${s.codec}]`),o&&o.split(",").length===1&&(s.levelCodec=o),this.hls.trigger(b.BUFFER_CODECS,t);let a=s.initSegment;if(a!=null&&a.byteLength){let l={type:"audio",frag:i,part:null,chunkMeta:r,parent:i.type,data:a};this.hls.trigger(b.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,i){let r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===jn.NOT_LOADED||r===jn.PARTIAL){var s;if(!In(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=re.WAITING_INIT_PTS;let o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&R_(t.details,o)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){let{name:t,lang:i,assocLang:r,characteristics:s,audioCodec:o,channels:a}=this.bufferedTrack;Nc({name:t,lang:i,assocLang:r,characteristics:s,audioCodec:o,channels:a},e,Lc)||(b_(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){let{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(b.AUDIO_TRACK_SWITCHED,jt({},e))}},Hp=class extends ji{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){let r=t?.renditionReports;if(r){let s=-1;for(let o=0;o<r.length;o++){let a=r[o],l;try{l=new self.URL(a.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),l=a.URI||""}if(l===e){s=o;break}else l===e.substring(0,l.length)&&(s=o)}if(s!==-1){let o=r[s],a=parseInt(o["LAST-MSN"])||t.lastPartSn,l=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){let d=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&d>t.partTarget&&(l+=1)}let u=i&&tB(i);return new I_(a,l>=0?l:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){let{details:r,stats:s}=t,o=self.performance.now(),a=s.loading.first?Math.max(0,o-s.loading.first):0;r.advancedDateTime=Date.now()-a;let l=this.hls.config.timelineOffset;if(l!==r.appliedTimelineOffset){let d=Math.max(l||0,0);r.appliedTimelineOffset=d,r.fragments.forEach(f=>{f.setStart(f.playlistOffset+d)})}if(r.live||i!=null&&i.live){let d="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(i),i&&r.fragments.length>0){xee(i,r,this);let D=r.playlistParsingError;if(D){this.warn(D);let P=this.hls;if(!P.config.ignorePlaylistParsingErrors){var u;let{networkDetails:V}=t;P.trigger(b.ERROR,{type:Oe.NETWORK_ERROR,details:Q.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:D,reason:D.message,level:t.level||void 0,parent:(u=r.fragments[0])==null?void 0:u.type,networkDetails:V,stats:s});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=s.loading.start);let f=this.hls.mainForwardBufferInfo,m=f?f.end-f.len:0,y=(r.edge-m)*1e3,v=MU(r,y);if(r.requestScheduled+v<o?r.requestScheduled=o:r.requestScheduled+=v,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let E,T,C;if(r.canBlockReload&&r.endSN&&r.advanced){let D=this.hls.config.lowLatencyMode,P=r.lastPartSn,V=r.endSN,G=r.lastPartIndex,H=G!==-1,A=P===V;H?A?(T=V+1,C=D?0:G):(T=P,C=D?G+1:r.maxPartIndex):T=V+1;let x=r.age,R=x+r.ageHeader,M=Math.min(R-r.partTarget,r.targetduration*1.5);if(M>0){if(R>r.targetduration*3)this.log(`Playlist last advanced ${x.toFixed(2)}s ago. Omitting segment and part directives.`),T=void 0,C=void 0;else if(i!=null&&i.tuneInGoal&&R-r.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${M} with playlist age: ${r.age}`),M=0;else{let F=Math.floor(M/r.targetduration);if(T+=F,C!==void 0){let j=Math.round(M%r.targetduration/r.partTarget);C+=j}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${x.toFixed(2)}s goal: ${M} skip sn ${F} to part ${C}`)}r.tuneInGoal=M}if(E=this.getDeliveryDirectives(r,t.deliveryDirectives,T,C),D||!A){r.requestScheduled=o,this.loadingPlaylist(d,E);return}}else(r.canBlockReload||r.canSkipUntil)&&(E=this.getDeliveryDirectives(r,t.deliveryDirectives,T,C));E&&T!==void 0&&r.canBlockReload&&(r.requestScheduled=s.loading.first+Math.max(v-a*2,v/2)),this.scheduleLoading(d,E,r)}else this.clearTimer()}scheduleLoading(e,t,i){let r=i||e.details;if(!r){this.loadingPlaylist(e,t);return}let s=self.performance.now(),o=r.requestScheduled;if(s>=o){this.loadingPlaylist(e,t);return}let a=o-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,i,r){let s=tB(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,r=t.part,s=f_.No),new I_(i,r,s)}checkRetry(e){let t=e.details,i=S_(e),r=e.errorAction,{action:s,retryCount:o=0,retryConfig:a}=r||{},l=!!r&&!!a&&(s===Xn.RetryRequest||!r.resolved&&s===Xn.SendAlternateToPenaltyBox);if(l){var u;if(o>=a.maxNumRetry)return!1;if(i&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{let d=ZD(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),d),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${d}ms`)}e.levelRetry=!0,r.resolved=!0}return l}};function t$(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!qp(n[t].attrs,e[t].attrs))return!1;return!0}function qp(n,e,t){let i=n["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>n[r]!==e[r])}function lD(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}var cD=class extends Hp{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){let{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(b.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){let{id:i,groupId:r,details:s}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==r){this.warn(`Audio track with id:${i} and group:${r} not found in active group ${o?.groupId}`);return}let a=o.details;o.details=t.details,this.log(`Audio track ${i} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!t)return;let i=t.audioGroups||null,r=this.groupIds,s=this.currentTrack;if(!i||r?.length!==i?.length||i!=null&&i.some(a=>r?.indexOf(a)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;let a=this.tracks.filter(m=>!i||i.indexOf(m.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(m=>m.default)&&(this.selectDefaultTrack=!1),a.forEach((m,y)=>{m.id=y});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;let l=this.hls.config.audioPreference;if(!s&&l){let m=Xs(l,a,Lc);if(m>-1)s=a[m];else{let y=Xs(l,this.tracks);s=this.tracks[y]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));let d={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${i?.join(",")}`),this.hls.trigger(b.AUDIO_TRACKS_UPDATED,d);let f=this.trackId;if(u!==-1&&f===-1)this.setAudioTrack(u);else if(a.length&&f===-1){var o;let m=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(m.message),this.hls.trigger(b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:m})}}}onError(e,t){t.fatal||!t.context||t.context.type===mt.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){let t=this.hls;if(t.config.audioPreference=e,e){let i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){let r=this.currentTrack;if(r&&Nc(e,r,Lc))return r;let s=Xs(e,this.tracksInGroup,Lc);if(s>-1){let o=this.tracksInGroup[s];return this.setAudioTrack(s),o}else if(r){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);let a=nee(e,t.levels,i,o,Lc);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){let o=Xs(e,i);if(o>-1)return i[o]}}}return null}setAudioTrack(e){let t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;let i=this.currentTrack,r=t[e],s=r.details&&!r.details.live;if(e===this.trackId&&r===i&&s||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(b.AUDIO_TRACK_SWITCHING,jt({},r)),s))return;let o=this.switchParams(r.url,i?.details,r.details);this.loadPlaylist(o)}findTrackId(e){let t=this.tracksInGroup;for(let i=0;i<t.length;i++){let r=t[i];if(!(this.selectDefaultTrack&&!r.default)&&(!e||Nc(e,r,Lc)))return i}if(e){let{name:i,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l}=e;for(let u=0;u<t.length;u++){let d=t[u];if(Nc({name:i,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l},d,Lc))return u}for(let u=0;u<t.length;u++){let d=t[u];if(qp(e.attrs,d.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){let d=t[u];if(qp(e.attrs,d.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();let t=this.currentTrack;this.shouldLoadPlaylist(t)&&b_(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);let i=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),o=e.details,a=o?.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(b.AUDIO_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:t||null,track:e})}},uD=class{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;let r=this.queues[t];r.push(e),r.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{let i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){let i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;let i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;let t=this.queues[e];if(t.length){let r=t[0];try{r.execute()}catch(s){var i;if(r.onError(s),this.queues===null||this.tracks===null)return;let o=(i=this.tracks[e])==null?void 0:i.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){let{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;let i=(t=this.tracks)==null?void 0:t[e],r=i?.buffer;return r?`SourceBuffer${r.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}},BB=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,n$="HlsJsTrackRemovedError",dD=class extends Error{constructor(e){super(e),this.name=n$}},hD=class extends ji{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{let{media:r,mediaSource:s}=this;i&&this.log("Media source opened"),!(!r||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(b.MEDIA_ATTACHED,{media:r,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{let{mediaSrc:i,_objectUrl:r}=this;i!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=gJ(al(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){let{hls:e}=this;e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.BUFFER_RESET,this.onBufferReset,this),e.on(b.BUFFER_APPENDING,this.onBufferAppending,this),e.on(b.BUFFER_CODECS,this.onBufferCodecs,this),e.on(b.BUFFER_EOS,this.onBufferEos,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.FRAG_PARSED,this.onFragParsed,this),e.on(b.FRAG_CHANGED,this.onFragChanged,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.BUFFER_RESET,this.onBufferReset,this),e.off(b.BUFFER_APPENDING,this.onBufferAppending,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.BUFFER_EOS,this.onBufferEos,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.FRAG_PARSED,this.onFragParsed,this),e.off(b.FRAG_CHANGED,this.onFragChanged,this),e.off(b.ERROR,this.onError,this)}transferMedia(){let{media:e,mediaSource:t}=this;if(!e)return null;let i={};if(this.operationQueue){let s=this.isUpdating();s||this.operationQueue.removeBlockers();let o=this.isQueued();(s||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}let r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?zt(i,r.tracks):this.sourceBuffers.forEach(s=>{let[o]=s;o&&(i[o]=zt({},this.tracks[o]),this.removeBuffer(o)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){let e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){let i=this.media=t.media;this.transferData=this.overrides=void 0;let r=al(this.appendSource);if(r){let s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);let o=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(o),s)this._objectUrl=i.src,this.attachTransferred();else{let a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{i.removeAttribute("src");let l=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||l&&o instanceof l,UB(i),bte(i,a),i.load()}catch{i.src=a}else i.src=a}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){let e=this.media,t=this.transferData;if(!t||!e)return;let i=this.tracks,r=t.tracks,s=r?Object.keys(r):null,o=s?s.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&s&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Qt(i,(l,u)=>l==="initSegment"?void 0:u)};
transfer tracks: ${Qt(r,(l,u)=>l==="initSegment"?void 0:u)}}`),!rU(r,i)){t.mediaSource=null,t.tracks=void 0;let l=e.currentTime,u=this.details,d=Math.max(l,u?.fragments[0].start||0);if(d-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${d}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(i)}") start time: ${d} currentTime: ${l}`),this.onMediaDetaching(b.MEDIA_DETACHING,{}),this.onMediaAttaching(b.MEDIA_ATTACHING,t),e.currentTime=d;return}this.transferData=void 0,s.forEach(l=>{let u=l,d=r[u];if(d){let f=d.buffer;if(f){let m=this.fragmentTracker,y=d.id;if(m.hasFragments(y)||m.hasParts(y)){let T=ot.getBuffered(f);m.detectEvictedFragments(u,T,y,null,!0)}let v=yA(u),E=[u,f];this.sourceBuffers[v]=E,f.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,d)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;let t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){let i=!!t.transferMedia;this.transferData=this.overrides=void 0;let{media:r,mediaSource:s,_objectUrl:o}=this;if(s){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){let a=s.readyState==="open";try{let l=s.sourceBuffers;for(let u=l.length;u--;)a&&l[u].abort(),s.removeSourceBuffer(l[u]);a&&s.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),i||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(r.removeAttribute("src"),this.appendSource&&UB(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(b.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;let i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[yA(e)]=[null,null];let t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new uD(this.tracks)}onBufferCodecs(e,t){var i;let r=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);let o="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),a=!o&&this.sourceBufferCount&&this.media&&s.some(l=>!r[l]);if(o||a){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${s}" SourceBuffers`);return}s.forEach(l=>{var u,d;let f=t[l],{id:m,codec:y,levelCodec:v,container:E,metadata:T,supplemental:C}=f,D=r[l],P=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[l],V=P!=null&&P.buffer?P:D,G=V?.pendingCodec||V?.codec,H=V?.levelCodec;D||(D=r[l]={buffer:void 0,listeners:[],codec:y,supplemental:C,container:E,levelCodec:v,metadata:T,id:m});let A=h_(G,H),x=A?.replace(BB,"$1"),R=h_(y,v),M=(d=R)==null?void 0:d.replace(BB,"$1");R&&A&&x!==M&&(l.slice(0,5)==="audio"&&(R=T_(R,this.appendSource)),this.log(`switching codec ${G} to ${R}`),R!==(D.pendingCodec||D.codec)&&(D.pendingCodec=R),D.container=E,this.appendChangeType(l,E,R))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((i=t.audio)==null?void 0:i.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{let i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){let r=`${t};codecs=${i}`,s={label:`change-type=${r}`,execute:()=>{let o=this.tracks[e];if(o){let a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),a.changeType(r),o.codec=i,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;let i=e.start,r=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,De.MAIN))==null?void 0:t.gap)===!0)return;let o={label:"block-audio",execute:()=>{var a;let l=this.tracks.video;(this.lastVideoAppendEnd>r||l!=null&&l.buffer&&ot.isBuffered(l.buffer,r)||((a=this.fragmentTracker.getAppendedFrag(r,De.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){let{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){let{tracks:i}=this,{data:r,type:s,parent:o,frag:a,part:l,chunkMeta:u,offset:d}=t,f=u.buffering[s],{sn:m,cc:y}=a,v=self.performance.now();f.start=v;let E=a.stats.buffering,T=l?l.stats.buffering:null;E.start===0&&(E.start=v),T&&T.start===0&&(T.start=v);let C=i.audio,D=!1;s==="audio"&&C?.container==="audio/mpeg"&&(D=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);let P=i.video,V=P?.buffer;if(V&&m!=="initSegment"){let A=l||a,x=this.blockedAudioAppend;if(s==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(P.ending||P.ended)){let M=A.start+A.duration*.05,F=V.buffered,j=this.currentOp("video");!F.length&&!j?this.blockAudio(A):!j&&!ot.isBuffered(V,M)&&this.lastVideoAppendEnd<M&&this.blockAudio(A)}else if(s==="video"){let R=A.end;if(x){let M=x.frag.start;(R>M||R<this.lastVideoAppendEnd||ot.isBuffered(V,M))&&this.unblockAudio()}this.lastVideoAppendEnd=R}}let G=(l||a).start,H={label:`append-${s}`,execute:()=>{var A;f.executeStart=self.performance.now();let x=(A=this.tracks[s])==null?void 0:A.buffer;x&&(D?this.updateTimestampOffset(x,G,.1,s,m,y):d!==void 0&&Ie(d)&&this.updateTimestampOffset(x,d,1e-6,s,m,y)),this.appendExecutor(r,s)},onStart:()=>{},onComplete:()=>{let A=self.performance.now();f.executeEnd=f.end=A,E.first===0&&(E.first=A),T&&T.first===0&&(T.first=A);let x={};this.sourceBuffers.forEach(([R,M])=>{R&&(x[R]=ot.getBuffered(M))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(b.BUFFER_APPENDED,{type:s,frag:a,part:l,chunkMeta:u,parent:a.type,timeRanges:x})},onError:A=>{var x;let R={type:Oe.MEDIA_ERROR,parent:a.type,details:Q.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:a,part:l,chunkMeta:u,error:A,err:A,fatal:!1},M=(x=this.media)==null?void 0:x.error;if(A.code===DOMException.QUOTA_EXCEEDED_ERR||A.name=="QuotaExceededError"||"quota"in A)R.details=Q.BUFFER_FULL_ERROR;else if(A.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!M)R.errorAction=Gd(!0);else if(A.name===n$&&this.sourceBufferCount===0)R.errorAction=Gd(!0);else{let F=++this.appendErrors[s];this.warn(`Failed ${F}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${M||"no media error"})`),(F>=this.hls.config.appendErrorMaxRetry||M)&&(R.fatal=!0)}this.hls.trigger(b.ERROR,R)}};this.log(`queuing "${s}" append sn: ${m}${l?" p: "+l.index:""} of ${a.type===De.MAIN?"level":"track"} ${a.level} cc: ${y}`),this.append(H,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(b.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){let{type:i,startOffset:r,endOffset:s}=t;i?this.append(this.getFlushOp(i,r,s),i):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,r,s),o)})}onFragParsed(e,t){let{frag:i,part:r}=t,s=[],o=r?r.elementaryStreams:i.elementaryStreams;o[Yt.AUDIOVIDEO]?s.push("audiovideo"):(o[Yt.AUDIO]&&s.push("audio"),o[Yt.VIDEO]&&s.push("video"));let a=()=>{let l=self.performance.now();i.stats.buffering.end=l,r&&(r.stats.buffering.end=l);let u=r?r.stats:i.stats;this.hls.trigger(b.FRAG_BUFFERED,{frag:i,part:r,stats:u,id:i.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(a,s).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){let t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([o])=>{if(o){let a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});let r=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();let{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(b.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(b.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){let t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{let e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Q.BUFFER_APPEND_ERROR&&t.frag){var i;let r=(i=t.errorAction)==null?void 0:i.nextAutoLevel;Ie(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){let{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;let r=e.config,s=i.currentTime,o=t.levelTargetDuration,a=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(Ie(a)&&a>=0){let u=Math.max(a,o),d=Math.floor(s/o)*o-u;this.flushBackBuffer(s,o,d)}let l=r.frontBufferFlushThreshold;if(Ie(l)&&l>0){let u=Math.max(r.maxBufferLength,l),d=Math.max(u,o),f=Math.floor(s/o)*o+d;this.flushFrontBuffer(s,o,f)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([r,s])=>{if(s){let a=ot.getBuffered(s);if(a.length>0&&i>a.start(0)){var o;this.hls.trigger(b.BACK_BUFFER_REACHED,{bufferEnd:i});let l=this.tracks[r];if((o=this.details)!=null&&o.live)this.hls.trigger(b.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(l!=null&&l.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:r})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([r,s])=>{if(s){let o=ot.getBuffered(s),a=o.length;if(a<2)return;let l=o.start(a-1),u=o.end(a-1);if(i>l||e>=l&&e<=u)return;this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;let{details:t,mediaSource:i}=this;if(!t||!this.media||i?.readyState!=="open")return null;let r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&i.setLiveSeekableRange){let u=Math.max(0,t.fragmentStart),d=Math.max(u,r);return{duration:1/0,start:u,end:d}}return{duration:1/0}}let s=(e=this.overrides)==null?void 0:e.duration;if(s)return Ie(s)?{duration:s}:null;let o=this.media.duration,a=Ie(i.duration)?i.duration:0;return r>a&&r>o||!Ie(o)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:i}){let r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(Ie(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${i}.`),r.setLiveSeekableRange(t,i)))}get tracksReady(){let e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){let{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Qt(i)}`),this.tracksReady){var r;let s=(r=this.transferData)==null?void 0:r.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){let e={};this.sourceBuffers.forEach(([t,i])=>{if(t){let r=this.tracks[t];e[t]={buffer:i,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(b.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{let e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){let{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(let s in e){let o=s,a=e[o];if(this.isPending(a)){let l=this.getTrackCodec(a,o),u=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${u})${this.currentOp(o)?" Queued":""} ${Qt(a)}`);try{let d=i.addSourceBuffer(u),f=yA(o),m=[o,d];t[f]=m,a.buffer=d}catch(d){var r;this.error(`error while trying to add sourceBuffer: ${d.message}`),this.shiftAndExecuteNext(o),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[o],this.hls.trigger(b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:d,sourceBufferName:o,mimeType:u,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){let i=e.supplemental,r=e.codec;i&&(t==="video"||t==="audiovideo")&&Np(i,"video")&&(r=FJ(r,i));let s=h_(r,e.levelCodec);return s?t.slice(0,5)==="audio"?T_(s,this.appendSource):s:""}trackSourceBuffer(e,t){let i=t.buffer;if(!i)return;let r=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,o)=>{let a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(b.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;let i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i?.src}onSBUpdateStart(e){let t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}let i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;let r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${r}`,t),this.hls.trigger(b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});let s=this.currentOp(e);s&&s.onError(r)}updateTimestampOffset(e,t,i,r,s,o){let a=t-e.timestampOffset;Math.abs(a)>=i&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${s} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,i){let{media:r,mediaSource:s}=this,o=this.tracks[e],a=o?.buffer;if(!r||!s||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}let l=Ie(r.duration)?r.duration:1/0,u=Ie(s.duration)?s.duration:1/0,d=Math.max(0,t),f=Math.min(i,l,u);f>d&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${d},${f}] from the ${e} SourceBuffer`),a.remove(d,f)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){let i=this.tracks[t],r=i?.buffer;if(!r)throw new dD(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);let{operationQueue:i}=this,r=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(o=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;let r=(i=this.tracks[t])==null?void 0:i.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){let r=this.tracks[e];if(!r)return;let s=r.buffer;if(!s)return;let o=i.bind(this,e);r.listeners.push({event:t,listener:o}),s.addEventListener(t,o)}removeBufferListeners(e){let t=this.tracks[e];if(!t)return;let i=t.buffer;i&&(t.listeners.forEach(r=>{i.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}};function UB(n){let e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function bte(n,e){let t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function yA(n){return n==="audio"?1:0}var fD=class n{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){let{hls:e}=this;e.on(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.BUFFER_CODECS,this.onBufferCodecs,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){let{hls:e}=this;e.off(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){let i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){let i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Ie(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}let e=this.hls.levels;if(e.length){let t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){let t=this.hls.levels;if(!t.length)return-1;let i=t.filter((r,s)=>this.isLevelAllowed(r)&&s<=e);return this.clientRect=null,n.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;let e=this.media,t={width:0,height:0};if(e){let i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;let r=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0,s=e.length-1,o=Math.max(t,i);for(let a=0;a<e.length;a+=1){let l=e[a];if((l.width>=o||l.height>=o)&&r(l,e[a+1])){s=a;break}}return s}},Ste={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Ui=Ste,Cte={HLS:"h"},xte=Cte,Zo=class n{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof n?i:new n(i))),this.value=e,this.params=t}},Ate="Dict";function Dte(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function Pte(n,e,t,i){return new Error(`failed to ${n} "${Dte(e)}" as ${t}`,{cause:i})}function Js(n,e,t){return Pte("serialize",n,e,t)}var F_=class{constructor(e){this.description=e}},$B="Bare Item",Rte="Boolean";function Mte(n){if(typeof n!="boolean")throw Js(n,Rte);return n?"?1":"?0"}function kte(n){return btoa(String.fromCharCode(...n))}var Lte="Byte Sequence";function Ote(n){if(ArrayBuffer.isView(n)===!1)throw Js(n,Lte);return`:${kte(n)}:`}var Nte="Integer";function Fte(n){return n<-999999999999999||999999999999999<n}function i$(n){if(Fte(n))throw Js(n,Nte);return n.toString()}function Vte(n){return`@${i$(n.getTime()/1e3)}`}function r$(n,e){if(n<0)return-r$(-n,e);let t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){let r=Math.floor(n*t);return(r%2===0?r:r+1)/t}else return Math.round(n*t)/t}var Bte="Decimal";function Ute(n){let e=r$(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Js(n,Bte);let t=e.toString();return t.includes(".")?t:`${t}.0`}var $te="String",jte=/[\x00-\x1f\x7f]+/;function Gte(n){if(jte.test(n))throw Js(n,$te);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function zte(n){return n.description||n.toString().slice(7,-1)}var Hte="Token";function jB(n){let e=zte(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Js(e,Hte);return e}function pD(n){switch(typeof n){case"number":if(!Ie(n))throw Js(n,$B);return Number.isInteger(n)?i$(n):Ute(n);case"string":return Gte(n);case"symbol":return jB(n);case"boolean":return Mte(n);case"object":if(n instanceof Date)return Vte(n);if(n instanceof Uint8Array)return Ote(n);if(n instanceof F_)return jB(n);default:throw Js(n,$B)}}var qte="Key";function mD(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw Js(n,qte);return n}function o1(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${mD(e)}`:`;${mD(e)}=${pD(t)}`).join("")}function s$(n){return n instanceof Zo?`${pD(n.value)}${o1(n.params)}`:pD(n)}function Wte(n){return`(${n.value.map(s$).join(" ")})${o1(n.params)}`}function Kte(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw Js(n,Ate);let t=n instanceof Map?n.entries():Object.entries(n),i=e?.whitespace?" ":"";return Array.from(t).map(([r,s])=>{s instanceof Zo||(s=new Zo(s));let o=mD(r);return s.value===!0?o+=o1(s.params):(o+="=",Array.isArray(s.value)?o+=Wte(s):o+=s$(s)),o}).join(`,${i}`)}function o$(n,e){return Kte(n,e)}var Ys="CMCD-Object",vn="CMCD-Request",Mc="CMCD-Session",rl="CMCD-Status",Yte={br:Ys,ab:Ys,d:Ys,ot:Ys,tb:Ys,tpb:Ys,lb:Ys,tab:Ys,lab:Ys,url:Ys,pb:vn,bl:vn,tbl:vn,dl:vn,ltc:vn,mtp:vn,nor:vn,nrr:vn,rc:vn,sn:vn,sta:vn,su:vn,ttfb:vn,ttfbb:vn,ttlb:vn,cmsdd:vn,cmsds:vn,smrt:vn,df:vn,cs:vn,ts:vn,cid:Mc,pr:Mc,sf:Mc,sid:Mc,st:Mc,v:Mc,msd:Mc,bs:rl,bsd:rl,cdn:rl,rtp:rl,bg:rl,pt:rl,ec:rl,e:rl},Qte={REQUEST:vn};function Zte(n){return Object.keys(n).reduce((e,t)=>{var i;return(i=n[t])===null||i===void 0||i.forEach(r=>e[r]=t),e},{})}function Xte(n,e){let t={};if(!n)return t;let i=Object.keys(n),r=e?Zte(e):{};return i.reduce((s,o)=>{var a;let l=Yte[o]||r[o]||Qte.REQUEST,u=(a=s[l])!==null&&a!==void 0?a:s[l]={};return u[o]=n[o],s},t)}function Jte(n){return["ot","sf","st","e","sta"].includes(n)}function ene(n){return typeof n=="number"?Ie(n):n!=null&&n!==""&&n!==!1}var a$="event";function tne(n,e){let t=new URL(n),i=new URL(e);if(t.origin!==i.origin)return n;let r=t.pathname.split("/").slice(1),s=i.pathname.split("/").slice(1,-1);for(;r[0]===s[0];)r.shift(),s.shift();for(;s.length;)s.shift(),r.unshift("..");return r.join("/")+t.search+t.hash}var g_=n=>Math.round(n),gD=(n,e)=>Array.isArray(n)?n.map(t=>gD(t,e)):n instanceof Zo&&typeof n.value=="string"?new Zo(gD(n.value,e),n.params):(e.baseUrl&&(n=tne(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),s_=n=>g_(n/100)*100,nne=(n,e)=>{let t=n;return e.version>=2&&(n instanceof Zo&&typeof n.value=="string"?t=new Zo([n]):typeof n=="string"&&(t=[n])),gD(t,e)},ine={br:g_,d:g_,bl:s_,dl:s_,mtp:s_,nor:nne,rtp:s_,tb:g_},l$="request",c$="response",a1=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],rne=["e"],sne=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function q_(n){return sne.test(n)}function one(n){return a1.includes(n)||rne.includes(n)||q_(n)}var u$=["d","dl","nor","ot","rtp","su"];function ane(n){return a1.includes(n)||u$.includes(n)||q_(n)}var lne=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function cne(n){return a1.includes(n)||u$.includes(n)||lne.includes(n)||q_(n)}var une=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function dne(n){return une.includes(n)||q_(n)}var hne={[c$]:cne,[a$]:one,[l$]:ane};function d$(n,e={}){let t={};if(n==null||typeof n!="object")return t;let i=e.version||n.v||1,r=e.reportingMode||l$,s=i===1?dne:hne[r],o=Object.keys(n).filter(s),a=e.filter;typeof a=="function"&&(o=o.filter(a));let l=r===c$||r===a$;l&&!o.includes("ts")&&o.push("ts"),i>1&&!o.includes("v")&&o.push("v");let u=zt({},ine,e.formatters),d={version:i,reportingMode:r,baseUrl:e.baseUrl};return o.sort().forEach(f=>{let m=n[f],y=u[f];if(typeof y=="function"&&(m=y(m,d)),f==="v"){if(i===1)return;m=i}f=="pr"&&m===1||(l&&f==="ts"&&!Ie(m)&&(m=Date.now()),ene(m)&&(Jte(f)&&typeof m=="string"&&(m=new F_(m)),t[f]=m))}),t}function fne(n,e={}){let t={};if(!n)return t;let i=d$(n,e),r=Xte(i,e?.customHeaderMap);return Object.entries(r).reduce((s,[o,a])=>{let l=o$(a,{whitespace:!1});return l&&(s[o]=l),s},t)}function pne(n,e,t){return zt(n,fne(e,t))}var mne="CMCD";function gne(n,e={}){return n?o$(d$(n,e),{whitespace:!1}):""}function yne(n,e={}){if(!n)return"";let t=gne(n,e);return encodeURIComponent(t)}function vne(n,e={}){if(!n)return"";let t=yne(n,e);return`${mne}=${t}`}var GB=/CMCD=[^&#]+/;function _ne(n,e,t){let i=vne(e,t);if(!i)return n;if(GB.test(n))return n.replace(GB,i);let r=n.includes("?")?"&":"?";return`${n}${r}${i}`}var yD=class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:Ui.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=r=>{try{let{frag:s,part:o}=r,a=this.hls.levels[s.level],l=this.getObjectType(s),u={d:(o||s).duration*1e3,ot:l};(l===Ui.VIDEO||l===Ui.AUDIO||l==Ui.MUXED)&&(u.br=a.bitrate/1e3,u.tb=this.getTopBandwidth(l)/1e3,u.bl=this.getBufferLength(l));let d=o?this.getNextPart(o):this.getNextFrag(s);d!=null&&d.url&&d.url!==s.url&&(u.nor=d.url),this.apply(r,u)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;let t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){let e=this.hls;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHED,this.onMediaDetached,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){let e=this.hls;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHED,this.onMediaDetached,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,r;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:xte.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){zt(t,this.createData());let i=t.ot===Ui.INIT||t.ot===Ui.VIDEO||t.ot===Ui.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);let{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((o,a)=>(r.includes(a)&&(o[a]=t[a]),o),{}));let s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),pne(e.headers,t,s)):e.url=_ne(e.url,t,s)}getNextFrag(e){var t;let i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){let r=e.sn-i.startSN;return i.fragments[r+1]}}getNextPart(e){var t;let{index:i,fragment:r}=e,s=(t=this.hls.levels[r.level])==null||(t=t.details)==null?void 0:t.partList;if(s){let{sn:o}=r;for(let a=s.length-1;a>=0;a--){let l=s[a];if(l.index===i&&l.fragment.sn===o)return s[a+1]}}}getObjectType(e){let{type:t}=e;if(t==="subtitle")return Ui.TIMED_TEXT;if(e.sn==="initSegment")return Ui.INIT;if(t==="audio")return Ui.AUDIO;if(t==="main")return this.hls.audioTracks.length?Ui.VIDEO:Ui.MUXED}getTopBandwidth(e){let t=0,i,r=this.hls;if(e===Ui.AUDIO)i=r.audioTracks;else{let s=r.maxAutoLevel,o=s>-1?s+1:r.levels.length;i=r.levels.slice(0,o)}return i.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){let t=this.media,i=e===Ui.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:ot.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){let{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}createFragmentLoader(){let{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}},Ene=3e5,vD=class extends ji{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){let e=this.hls;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){let e=this.hls;e&&(e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){let e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){let t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){let{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){let{errorAction:i}=t;if(i?.action===Xn.SendAlternateToPenaltyBox&&i.flags===hr.MoveAllAlternatesMatchingHost){let r=this.levels,s=this._pathwayPriority,o=this.pathwayId;if(t.context){let{groupId:a,pathwayId:l,type:u}=t.context;a&&r?o=this.getPathwayForGroupId(a,u,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!s&&r&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),i.resolved=this.pathwayId!==o),t.details===Q.BUFFER_APPEND_ERROR&&!t.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${r&&r.length} priorities: ${Qt(s)} penalized: ${Qt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){let i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t,i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach(s=>{r-i[s]>Ene&&delete i[s]});for(let s=0;s<e.length;s++){let o=e[s];if(o in i)continue;if(o===this.pathwayId)return;let a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,OU(t),this.hls.trigger(b.LEVELS_UPDATED,{levels:t});let u=this.hls.levels[a];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,i){let r=this.getLevelsForPathway(i).concat(this.levels||[]);for(let s=0;s<r.length;s++)if(t===mt.AUDIO_TRACK&&r[s].hasAudioGroup(e)||t===mt.SUBTITLE_TRACK&&r[s].hasSubtitleGroup(e))return r[s].pathwayId;return i}clonePathways(e){let t=this.levels;if(!t)return;let i={},r={};e.forEach(s=>{let{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=s;if(t.some(d=>d.pathwayId===o))return;let u=this.getLevelsForPathway(a).map(d=>{let f=new hn(d.attrs);f["PATHWAY-ID"]=o;let m=f.AUDIO&&`${f.AUDIO}_clone_${o}`,y=f.SUBTITLES&&`${f.SUBTITLES}_clone_${o}`;m&&(i[f.AUDIO]=m,f.AUDIO=m),y&&(r[f.SUBTITLES]=y,f.SUBTITLES=y);let v=h$(d.uri,f["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),E=new Vc({attrs:f,audioCodec:d.audioCodec,bitrate:d.bitrate,height:d.height,name:d.name,url:v,videoCodec:d.videoCodec,width:d.width});if(d.audioGroups)for(let T=1;T<d.audioGroups.length;T++)E.addGroupId("audio",`${d.audioGroups[T]}_clone_${o}`);if(d.subtitleGroups)for(let T=1;T<d.subtitleGroups.length;T++)E.addGroupId("text",`${d.subtitleGroups[T]}_clone_${o}`);return E});t.push(...u),zB(this.audioTracks,i,l,o),zB(this.subtitleTracks,r,l,o)})}loadSteeringManifest(e){let t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){let d=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+d)}let s={responseType:"json",url:r.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},u={onSuccess:(d,f,m,y)=>{this.log(`Loaded steering manifest: "${r}"`);let v=d.data;if(v?.VERSION!==1){this.log(`Steering VERSION ${v.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=v.TTL;let{"RELOAD-URI":E,"PATHWAY-CLONES":T,"PATHWAY-PRIORITY":C}=v;if(E)try{this.uri=new self.URL(E,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${E}`);return}this.scheduleRefresh(this.uri||m.url),T&&this.clonePathways(T);let D={steeringManifest:v,url:r.toString()};this.hls.trigger(b.STEERING_MANIFEST_LOADED,D),C&&this.updatePathwayPriority(C)},onError:(d,f,m,y)=>{if(this.log(`Error loading steering manifest: ${d.code} ${d.text} (${f.url})`),this.stopLoad(),d.code===410){this.enabled=!1,this.log(`Steering manifest ${f.url} no longer available`);return}let v=this.timeToLoad*1e3;if(d.code===429){let E=this.loader;if(typeof E?.getResponseHeader=="function"){let T=E.getResponseHeader("Retry-After");T&&(v=parseFloat(T)*1e3)}this.log(`Steering manifest ${f.url} rate limited`);return}this.scheduleRefresh(this.uri||f.url,v)},onTimeout:(d,f,m)=>{this.log(`Timeout loading steering manifest (${f.url})`),this.scheduleRefresh(this.uri||f.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;let r=(i=this.hls)==null?void 0:i.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}};function zB(n,e,t,i){n&&Object.keys(e).forEach(r=>{let s=n.filter(o=>o.groupId===r).map(o=>{let a=zt({},o);return a.details=void 0,a.attrs=new hn(a.attrs),a.url=a.attrs.URI=h$(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[r],a.attrs["PATHWAY-ID"]=i,a});n.push(...s)})}function h$(n,e,t,i){let{HOST:r,PARAMS:s,[t]:o}=i,a;e&&(a=o?.[e],a&&(n=a));let l=new self.URL(n);return r&&!a&&(l.host=r),s&&Object.keys(s).sort().forEach(u=>{u&&l.searchParams.set(u,s[u])}),l.href}var Tne=(()=>{class n extends ji{constructor(t){super("eme",t.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=n.CDMCleanupPromise?[n.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=i=>{let{initDataType:r,initData:s}=i,o=`"${i.type}" event: init data type: "${r}"`;if(this.debug(o),s!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=Pp(this.config));let l=a.map(cA).filter(u=>!!u);this.keyFormatPromise=this.getKeyFormatPromise(l)}this.keyFormatPromise.then(a=>{let l=p_(a);if(r!=="sinf"||l!==fn.FAIRPLAY){this.log(`Ignoring "${i.type}" event with init data type: "${r}" for selected key-system ${l}`);return}let u;try{let v=$n(new Uint8Array(s)),E=JD(JSON.parse(v).sinf),T=hU(E);if(!T)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");u=new Uint8Array(T.subarray(8,24))}catch(v){this.warn(`${o} Failed to parse sinf: ${v}`);return}let d=si(u),{keyIdToKeySessionPromise:f,mediaKeySessions:m}=this,y=f[d];for(let v=0;v<m.length;v++){let E=m[v],T=E.decryptdata;if(!T.keyId)continue;let C=si(T.keyId);if(D_(u,T.keyId)||T.uri.replace(/-/g,"").indexOf(d)!==-1){if(y=f[C],!y)continue;if(T.pssh)break;delete f[C],T.pssh=new Uint8Array(s),T.keyId=u,y=f[d]=y.then(()=>this.generateRequestWithPreferredKeySession(E,r,s,"encrypted-event-key-match")),y.catch(D=>this.handleError(D));break}}y||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${m.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=i=>{this.log(`"${i.type}" event`)},this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();let t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(b.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(b.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(t){let{drmSystems:i,widevineLicenseUrl:r}=this.config,s=i?.[t];if(s)return s.licenseUrl;if(t===fn.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(t){let i=this.getLicenseServerUrl(t);if(i===void 0)throw new Error(`no license server URL configured for key-system "${t}"`);return i}getServerCertificateUrl(t){let{drmSystems:i}=this.config,r=i?.[t];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){let i=this.hls.levels,r=(a,l,u)=>!!a&&u.indexOf(a)===l,s=i.map(a=>a.audioCodec).filter(r),o=i.map(a=>a.videoCodec).filter(r);return s.length+o.length===0&&o.push("avc1.42e01e"),new Promise((a,l)=>{let u=d=>{let f=d.shift();this.getMediaKeysPromise(f,s,o).then(m=>a({keySystem:f,mediaKeys:m})).catch(m=>{d.length?u(d):m instanceof Si?l(m):l(new Si({type:Oe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};u(t)})}requestMediaKeySystemAccess(t,i){let{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${r}`;return xU===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return r(t,i)}getMediaKeysPromise(t,i,r){var s;let o=vee(t,i,r,this.config.drmSystemOptions||{}),a=this.keySystemAccessPromises[t],l=(s=a)==null?void 0:s.keySystemAccess;if(!l){this.log(`Requesting encrypted media "${t}" key-system access with config: ${Qt(o)}`),l=this.requestMediaKeySystemAccess(t,o);let u=a=this.keySystemAccessPromises[t]={keySystemAccess:l};return l.catch(d=>{this.log(`Failed to obtain access to key-system "${t}": ${d}`)}),l.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);let f=this.fetchServerCertificate(t);this.log(`Create media-keys for "${t}"`);let m=u.mediaKeys=d.createMediaKeys().then(y=>(this.log(`Media-keys created for "${t}"`),u.hasMediaKeys=!0,f.then(v=>v?this.setMediaKeysServerCertificate(y,t,v):y)));return m.catch(y=>{this.error(`Failed to create media-keys for "${t}"}: ${y}`)}),m})}return l.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:i,mediaKeys:r}){this.log(`Creating key-system session "${i}" keyId: ${si(t.keyId||[])} keyUri: ${t.uri}`);let s=r.createSession(),o={decryptdata:t,keySystem:i,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o}renewKeySession(t){let i=t.decryptdata;if(i.pssh){let r=this.createMediaKeySessionContext(t),s=o_(i),o="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(r,o,i.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}updateKeySession(t,i){let r=t.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${si(t.decryptdata.keyId||[])}
      } (data length: ${i.byteLength})`),r.update(i)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(t=>({keySystem:t,hasMediaKeys:this.keySystemAccessPromises[t].hasMediaKeys})).filter(({hasMediaKeys:t})=>!!t).map(({keySystem:t})=>cA(t)).filter(t=>!!t)}getKeySystemAccess(t){return this.getKeySystemSelectionPromise(t).then(({keySystem:i,mediaKeys:r})=>this.attemptSetMediaKeys(i,r))}selectKeySystem(t){return new Promise((i,r)=>{this.getKeySystemSelectionPromise(t).then(({keySystem:s})=>{let o=cA(s);o?i(o):r(new Error(`Unable to find format for key-system "${s}"`))}).catch(r)})}selectKeySystemFormat(t){let i=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)),this.keyFormatPromise}getKeyFormatPromise(t){let i=Pp(this.config),r=t.map(p_).filter(s=>!!s&&i.indexOf(s)!==-1);return this.selectKeySystem(r)}getKeyStatus(t){let{mediaKeySessions:i}=this;for(let r=0;r<i.length;r++){let s=wne(t,i[r]);if(s)return s}}loadKey(t){let i=t.keyInfo.decryptdata,r=o_(i),s=this.bannedKeyIds[r];if(s||this.getKeyStatus(i)==="internal-error"){let l=HB(s||"internal-error",i);return this.handleError(l,t.frag),Promise.reject(l)}let o=`(keyId: ${r} format: "${i.keyFormat}" method: ${i.method} uri: ${i.uri})`;this.log(`Starting session for key ${o}`);let a=this.keyIdToKeySessionPromise[r];if(!a){let l=this.getKeySystemForKeyPromise(i).then(({keySystem:u,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${o}`),this.attemptSetMediaKeys(u,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:u,mediaKeys:d,decryptdata:i}))))).then(u=>{let d="cenc",f=i.pssh?i.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(u,d,f,"playlist-key")});return l.catch(u=>this.handleError(u,t.frag)),this.keyIdToKeySessionPromise[r]=l,l}return a.catch(l=>{if(l instanceof Si){let u=jt({},l.data);this.getKeyStatus(i)==="internal-error"&&(u.decryptdata=i);let d=new Si(u,l.message);this.handleError(d,t.frag)}}),a}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t,i){if(this.hls)if(t instanceof Si){i&&(t.data.frag=i);let r=t.data.decryptdata;this.error(`${t.message}${r?` (${si(r.keyId||[])})`:""}`),this.hls.trigger(b.ERROR,t.data)}else this.error(t.message),this.hls.trigger(b.ERROR,{type:Oe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0})}getKeySystemForKeyPromise(t){let i=o_(t),r=this.keyIdToKeySessionPromise[i];if(!r){let s=p_(t.keyFormat),o=s?[s]:Pp(this.config);return this.attemptKeySystemAccess(o)}return r}getKeySystemSelectionPromise(t){if(t.length||(t=Pp(this.config)),t.length===0)throw new Si({type:Oe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Qt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}attemptSetMediaKeys(t,i){if(this.mediaResolved=void 0,this.mediaKeys===i)return Promise.resolve();let r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);let s=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(i):new Promise((o,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=i,this.media.setMediaKeys(i).then(o).catch(a)}}));return this.mediaKeys=i,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${t}"`),r.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(o=>r.indexOf(o)===-1)})}generateRequestWithPreferredKeySession(t,i,r,s){var o;let a=(o=this.config.drmSystems)==null||(o=o[t.keySystem])==null?void 0:o.generateRequest;if(a)try{let E=a.call(this.hls,i,r,t);if(!E)throw new Error("Invalid response from configured generateRequest filter");i=E.initDataType,r=E.initData?E.initData:null,t.decryptdata.pssh=r?new Uint8Array(r):null}catch(E){if(this.warn(E.message),this.hls&&this.hls.config.debug)throw E}if(r===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(t);let l=o_(t.decryptdata),u=t.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${l} URI: ${u} (init data type: ${i} length: ${r.byteLength})`);let d=new e1,f=t._onmessage=E=>{let T=t.mediaKeysSession;if(!T){d.emit("error",new Error("invalid state"));return}let{messageType:C,message:D}=E;this.log(`"${C}" message event for session "${T.sessionId}" message size: ${D.byteLength}`),C==="license-request"||C==="license-renewal"?this.renewLicense(t,D).catch(P=>{d.eventNames().length?d.emit("error",P):this.handleError(P)}):C==="license-release"?t.keySystem===fn.FAIRPLAY&&this.updateKeySession(t,zA("acknowledged")).then(()=>this.removeSession(t)).catch(P=>this.handleError(P)):this.warn(`unhandled media key message type "${C}"`)},m=(E,T)=>{T.keyStatus=E;let C;E.startsWith("usable")?d.emit("resolved"):E==="internal-error"||E==="output-restricted"||E==="output-downscaled"?C=HB(E,T.decryptdata):E==="expired"?C=new Error(`key expired (keyId: ${l})`):E==="released"?C=new Error("key released"):E==="status-pending"||this.warn(`unhandled key status change "${E}" (keyId: ${l})`),C&&(d.eventNames().length?d.emit("error",C):this.handleError(C))},y=t._onkeystatuseschange=E=>{if(!t.mediaKeysSession){d.emit("error",new Error("invalid state"));return}let C=this.getKeyStatuses(t);if(!Object.keys(C).some(G=>C[G]!=="status-pending"))return;if(C[l]==="expired"){this.log(`Expired key ${Qt(C)} in key-session "${t.mediaKeysSession.sessionId}"`),this.renewKeySession(t);return}let P=C[l];if(P)m(P,t);else{var V;t.keyStatusTimeouts||(t.keyStatusTimeouts={}),(V=t.keyStatusTimeouts)[l]||(V[l]=self.setTimeout(()=>{if(!t.mediaKeysSession||!this.mediaKeys)return;let H=this.getKeyStatus(t.decryptdata);if(H&&H!=="status-pending")return this.log(`No status for keyId ${l} in key-session "${t.mediaKeysSession.sessionId}". Using session key-status ${H} from other session.`),m(H,t);this.log(`key status for ${l} in key-session "${t.mediaKeysSession.sessionId}" timed out after 1000ms`),P="internal-error",m(P,t)},1e3)),this.log(`No status for keyId ${l} (${Qt(C)}).`)}};Ci(t.mediaKeysSession,"message",f),Ci(t.mediaKeysSession,"keystatuseschange",y);let v=new Promise((E,T)=>{d.on("error",T),d.on("resolved",E)});return t.mediaKeysSession.generateRequest(i,r).then(()=>{this.log(`Request generated for key-session "${t.mediaKeysSession.sessionId}" keyId: ${l} URI: ${u}`)}).catch(E=>{throw new Si({type:Oe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_SESSION,error:E,decryptdata:t.decryptdata,fatal:!1},`Error generating key-session request: ${E}`)}).then(()=>v).catch(E=>(d.removeAllListeners(),this.removeSession(t).then(()=>{throw E}))).then(()=>(d.removeAllListeners(),t))}getKeyStatuses(t){let i={};return t.mediaKeysSession.keyStatuses.forEach((r,s)=>{if(typeof s=="string"&&typeof r=="object"){let l=s;s=r,r=l}let o="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);if(t.keySystem===fn.PLAYREADY&&o.length===16){let l=si(o);i[l]=r,SU(o)}let a=si(o);r==="internal-error"&&(this.bannedKeyIds[a]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${a} key-session "${t.mediaKeysSession.sessionId}"`),i[a]=r}),i}fetchServerCertificate(t){let i=this.config,r=i.loader,s=new r(i),o=this.getServerCertificateUrl(t);return o?(this.log(`Fetching server certificate for "${t}"`),new Promise((a,l)=>{let u={responseType:"arraybuffer",url:o},d=i.certLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(y,v,E,T)=>{a(y.data)},onError:(y,v,E,T)=>{l(new Si({type:Oe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:jt({url:u.url,data:void 0},y)},`"${t}" certificate request failed (${o}). Status: ${y.code} (${y.text})`))},onTimeout:(y,v,E)=>{l(new Si({type:Oe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:{url:u.url,data:void 0}},`"${t}" certificate request timed out (${o})`))},onAbort:(y,v,E)=>{l(new Error("aborted"))}};s.load(u,f,m)})):Promise.resolve()}setMediaKeysServerCertificate(t,i,r){return new Promise((s,o)=>{t.setServerCertificate(r).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${r.byteLength}) on "${i}"`),s(t)}).catch(a=>{o(new Si({type:Oe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(t,i){return this.requestLicense(t,new Uint8Array(i)).then(r=>this.updateKeySession(t,new Uint8Array(r)).catch(s=>{throw new Si({type:Oe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:t.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(t,i){let r=String.fromCharCode.apply(null,new Uint16Array(i.buffer));if(!r.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),i;let s=new DOMParser().parseFromString(r,"application/xml"),o=s.querySelectorAll("HttpHeader");if(o.length>0){let f;for(let m=0,y=o.length;m<y;m++){var a,l;f=o[m];let v=(a=f.querySelector("name"))==null?void 0:a.textContent,E=(l=f.querySelector("value"))==null?void 0:l.textContent;v&&E&&t.setRequestHeader(v,E)}}let u=s.querySelector("Challenge"),d=u?.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return zA(atob(d))}setupLicenseXHR(t,i,r,s){let o=this.config.licenseXhrSetup;return o?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return o.call(this.hls,t,i,r,s)}).catch(a=>{if(!r.decryptdata)throw a;return t.open("POST",i,!0),o.call(this.hls,t,i,r,s)}).then(a=>(t.readyState||t.open("POST",i,!0),{xhr:t,licenseChallenge:a||s})):(t.open("POST",i,!0),Promise.resolve({xhr:t,licenseChallenge:s}))}requestLicense(t,i){let r=this.config.keyLoadPolicy.default;return new Promise((s,o)=>{let a=this.getLicenseServerUrlOrThrow(t.keySystem);this.log(`Sending license request to URL: ${a}`);let l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return o(new Error("invalid state"));if(l.readyState===4)if(l.status===200){this._requestLicenseFailureCount=0;let u=l.response;this.log(`License received ${u instanceof ArrayBuffer?u.byteLength:u}`);let d=this.config.licenseResponseCallback;if(d)try{u=d.call(this.hls,l,a,t)}catch(f){this.error(f)}s(u)}else{let u=r.errorRetry,d=u?u.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||l.status>=400&&l.status<500)o(new Si({type:Oe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:t.decryptdata,fatal:!0,networkDetails:l,response:{url:a,data:void 0,code:l.status,text:l.statusText}},`License Request XHR failed (${a}). Status: ${l.status} (${l.statusText})`));else{let f=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(t,i).then(s,o)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=l,this.setupLicenseXHR(l,a,t,i).then(({xhr:u,licenseChallenge:d})=>{t.keySystem==fn.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(u,d)),u.send(d)}).catch(o)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(t,i){if(!this.config.emeEnabled)return;let r=i.media;this.media=r,Ci(r,"encrypted",this.onMediaEncrypted),Ci(r,"waitingforkey",this.onWaitingForKey);let s=this.mediaResolved;s?s():this.mediaKeys=r.mediaKeys}onMediaDetached(){let t=this.media;t&&($i(t,"encrypted",this.onMediaEncrypted),$i(t,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var t;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};let i=this.mediaResolved;if(i&&i(),!this.mediaKeys&&!this.mediaKeySessions.length)return;let r=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Kd.clearKeyUriToKeyIdMap();let o=s.length;n.CDMCleanupPromise=Promise.all(s.map(a=>this.removeSession(a)).concat((r==null||(t=r.setMediaKeys(null))==null?void 0:t.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(b.ERROR,{type:Oe.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(b.ERROR,{type:Oe.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{o&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(t,{sessionKeys:i}){if(!(!i||!this.config.emeEnabled)&&!this.keyFormatPromise){let r=i.reduce((s,o)=>(s.indexOf(o.keyFormat)===-1&&s.push(o.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(t){let{mediaKeysSession:i,licenseXhr:r,decryptdata:s}=t;if(i){this.log(`Remove licenses and keys and close session "${i.sessionId}" keyId: ${si(s?.keyId||[])}`),t._onmessage&&(i.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(i.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;let o=this.mediaKeySessions.indexOf(t);o>-1&&this.mediaKeySessions.splice(o,1);let{keyStatusTimeouts:a}=t;a&&Object.keys(a).forEach(d=>self.clearTimeout(a[d]));let{drmSystemOptions:l}=this.config;return(Eee(l)?new Promise((d,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),i.remove().then(d).catch(f)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(b.ERROR,{type:Oe.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>i.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(b.ERROR,{type:Oe.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}return n.CDMCleanupPromise=void 0,n})();function o_(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return si(n.keyId)}function wne(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}var Si=class extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}};function HB(n,e){let t=n==="output-restricted",i=t?Q.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Q.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Si({type:Oe.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}var _D=class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(b.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(b.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){let i=this.hls.config;if(i.capLevelOnFPSDrop){let r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){let r=performance.now();if(t){if(this.lastTime){let s=r-this.lastTime,o=i-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/s,u=this.hls;if(u.trigger(b.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:i}),l>0&&o>u.config.fpsDroppedMonitoringThreshold*a){let d=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=d)&&(d=d-1,u.trigger(b.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:u.currentLevel}),u.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){let e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){let t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}};function f$(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function p$(n,e){let t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){Gt.debug(`[texttrack-utils]: ${i}`);try{let r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,n.addCue(r)}catch(r){Gt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(n.mode=t)}function $d(n,e){let t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let i=n.cues.length;i--;)e&&n.cues[i].removeEventListener("enter",e),n.removeCue(n.cues[i]);t==="disabled"&&(n.mode=t)}function ED(n,e,t,i){let r=n.mode;if(r==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){let s=bne(n.cues,e,t);for(let o=0;o<s.length;o++)(!i||i(s[o]))&&n.removeCue(s[o])}r==="disabled"&&(n.mode=r)}function Ine(n,e){if(e<=n[0].startTime)return 0;let t=n.length-1;if(e>n[t].endTime)return-1;let i=0,r=t,s;for(;i<=r;)if(s=Math.floor((r+i)/2),e<n[s].startTime)r=s-1;else if(e>n[s].startTime&&i<t)i=s+1;else return s;return n[i].startTime-e<e-n[r].startTime?i:r}function bne(n,e,t){let i=[],r=Ine(n,e);if(r>-1)for(let s=r,o=n.length;s<o;s++){let a=n[s];if(a.startTime>=e&&a.endTime<=t)i.push(a);else if(a.startTime>t)return i}return i}function y_(n){let e=[];for(let t=0;t<n.length;t++){let i=n[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(n[t])}return e}var TD=class extends Hp{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null,i=y_(this.media.textTracks);for(let s=0;s<i.length;s++)if(i[s].mode==="hidden")t=i[s];else if(i[s].mode==="showing"){t=i[s];break}let r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){let{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(b.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){let i=this.media;if(!i)return;let r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;y_(i.textTracks).forEach(o=>{$d(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){let{id:i,groupId:r,details:s}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==r){this.warn(`Subtitle track with id:${i} and group:${r} not found in active group ${o?.groupId}`);return}let a=o.details;o.details=t.details,this.log(`Subtitle track ${i} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!t)return;let i=t.subtitleGroups||null,r=this.groupIds,s=this.currentTrack;if(!i||r?.length!==i?.length||i!=null&&i.some(o=>r?.indexOf(o)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;let o=this.tracks.filter(d=>!i||i.indexOf(d.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(d=>d.default)&&(this.selectDefaultTrack=!1),o.forEach((d,f)=>{d.id=f});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;let a=this.hls.config.subtitlePreference;if(!s&&a){this.selectDefaultTrack=!1;let d=Xs(a,o);if(d>-1)s=o[d];else{let f=Xs(a,this.tracks);s=this.tracks[f]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));let u={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${i?.join(",")}" group-id`),this.hls.trigger(b.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){let t=this.tracksInGroup,i=this.selectDefaultTrack;for(let r=0;r<t.length;r++){let s=t[r];if(!(i&&!s.default||!i&&!e)&&(!e||Nc(s,e)))return r}if(e){for(let r=0;r<t.length;r++){let s=t[r];if(qp(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){let s=t[r];if(qp(e.attrs,s.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){let t=this.tracksInGroup;for(let i=0;i<t.length;i++){let r=t[i];if(lD(r,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===mt.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;let t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){let i=this.currentTrack;if(i&&Nc(e,i))return i;let r=Xs(e,this.tracksInGroup);if(r>-1){let s=this.tracksInGroup[r];return this.setSubtitleTrack(r),s}else{if(i)return null;{let s=Xs(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);let i=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),o=e.details,a=o?.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(b.SUBTITLE_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){let{media:e}=this;if(!e)return;let t=y_(e.textTracks),i=this.currentTrack,r;if(i&&(r=t.filter(s=>lD(i,s))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==r&&(s.mode="disabled")}),r){let s=this.subtitleDisplay?"showing":"hidden";r.mode!==s&&(r.mode=s)}}setSubtitleTrack(e){let t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Ie(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;let i=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:e});return}let s=!!r.details&&!r.details.live;if(e===this.trackId&&r===i&&s)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));let{id:o,groupId:a="",name:l,type:u,url:d}=r;this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:u,url:d});let f=this.switchParams(r.url,i?.details,r.details);this.loadPlaylist(f)}};function Sne(){try{return crypto.randomUUID()}catch{try{let e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?s:s&3|8).toString(16)})}}}function kp(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}var qd=.025,V_=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function Cne(n,e,t){return`${n.identifier}-${t+1}-${kp(e)}`}var wD=class{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;let i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){let e=this.dateRange.startTime;if(this.snapOptions.out){let t=this.dateRange.tagAnchor;if(t)return vA(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;let e=this.dateRange.tagAnchor;if(e){let t=this.dateRange.startTime,i=vA(t,e);return t-i<.1}return!1}get resumptionOffset(){let e=this.resumeOffset,t=Ie(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){let e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){let t=this.resumeAnchor;if(t)return vA(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<qd))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){let e=this.playoutLimit,t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?V_.Range:V_.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return xne(this)}};function vA(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<qd)?e.start:e.start+e.duration}function m$(n,e,t){let i=new self.URL(n,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function _A(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function xne(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function Ud(n){let e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}var ID=class{constructor(e,t,i,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(b.PLAYOUT_LIMIT_REACHED,{})};let s=this.hls=new e(t);this.interstitial=i,this.assetItem=r;let o=()=>{this.hasDetails=!0};s.once(b.LEVEL_LOADED,o),s.once(b.AUDIO_TRACK_LOADED,o),s.once(b.SUBTITLE_TRACK_LOADED,o),s.on(b.MEDIA_ATTACHING,(a,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(b.BUFFER_APPENDED,()=>{let d=this.bufferedEnd;this.reachedPlayout(d)&&(this._bufferedEosTime=d,s.trigger(b.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){let e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=m$(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;let i=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,s=ot.bufferInfo(e,r,0);return this.getAssetTime(s.end)>=i-.02}reachedPlayout(e){let i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){let e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;let t=ot.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){let e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){let e=this.assetItem.duration;if(!e)return 0;let t=this.interstitial.playoutLimit;if(t){let i=t-this.startOffset;if(i>0&&i<e)return i}return e}get remaining(){let e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){let t=this.timelineOffset;if(e!==t){let i=e-t;if(Math.abs(i)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){let t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){let e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){let e=this.hls;if(e&&this.hasDetails){e.stopLoad();let t=i=>delete i.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,i){var r;(r=this.hls)==null||r.on(e,t)}once(e,t,i){var r;(r=this.hls)==null||r.once(e,t)}off(e,t,i){var r;(r=this.hls)==null||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Ud(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}},qB=.033,bD=class extends ji{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,i+1):i,0):0}get duration(){let e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);let r=this.items;if(r)for(r[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(s=r[i])!=null&&s.event;){var s;i--}return i}findItemIndexAtTime(e,t){let i=this.items;if(i)for(let r=0;r<i.length;r++){let s=i[r];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return r}return-1}findJumpRestrictedIndex(e,t){let i=this.items;if(i)for(let r=e;r<=t&&i[r];r++){let s=i[r].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return r}return-1}findEventIndex(e){let t=this.items;if(t)for(let r=t.length;r--;){var i;if(((i=t[r].event)==null?void 0:i.identifier)===e)return r}return-1}findAssetIndex(e,t){let i=e.assetList,r=i.length;if(r>1)for(let s=0;s<r;s++){let o=i[s];if(!o.error){let a=o.timelineStart;if(t===a||t>a&&(t<a+(o.duration||0)||s===r-1))return s}}return 0}get assetIdAtEnd(){var e;let t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){let i=t.assetList,r=i[i.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){let i=e.main.details,{dateRanges:r}=i,s=this.events,o=this.parseDateRanges(r,{url:i.url},t),a=Object.keys(r),l=s?s.filter(u=>!a.includes(u.identifier)):[];o.length&&o.sort((u,d)=>{let f=u.cue.pre,m=u.cue.post,y=d.cue.pre,v=d.cue.post;if(f&&!y)return-1;if(y&&!f||m&&!v)return 1;if(v&&!m)return-1;if(!f&&!y&&!m&&!v){let E=u.startTime,T=d.startTime;if(E!==T)return E-T}return u.dateRange.tagOrder-d.dateRange.tagOrder}),this.events=o,l.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],i=!1){let r=this.events||[];if(r.length||t.length||this.length<2){let s=this.items,o=this.parseSchedule(r,e);(i||t.length||s?.length!==o.length||o.some((l,u)=>Math.abs(l.playout.start-s[u].playout.start)>.005||Math.abs(l.playout.end-s[u].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,i){let r=[],s=Object.keys(e);for(let o=0;o<s.length;o++){let a=s[o],l=e[a];if(l.isInterstitial){let u=this.eventMap[a];u?u.setDateRange(l):(u=new wD(l,t),this.eventMap[a]=u,i===!1&&(u.appendInPlace=i)),r.push(u)}}return r}parseSchedule(e,t){let i=[],r=t.main.details,s=r.live?1/0:r.edge,o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,u=0;if(e.forEach((d,f)=>{let m=d.cue.pre,y=d.cue.post,v=e[f-1]||null,E=d.appendInPlace,T=y?s:d.startOffset,C=d.duration,D=d.timelineOccupancy===V_.Range?C:0,P=d.resumptionOffset,V=v?.startTime===T,G=T+d.cumulativeDuration,H=E?G+C:T+P;if(m||!y&&T<=0){let x=u;u+=D,d.timelineStart=G;let R=o;o+=C,i.push({event:d,start:G,end:H,playout:{start:R,end:o},integrated:{start:x,end:u}})}else if(T<=s){if(!V){let M=T-l;if(M>qB){let F=l,j=u;u+=M;let B=o;o+=M;let pe={previousEvent:e[f-1]||null,nextEvent:d,start:F,end:F+M,playout:{start:B,end:o},integrated:{start:j,end:u}};i.push(pe)}else M>0&&v&&(v.cumulativeDuration+=M,i[i.length-1].end=T)}y&&(H=G),d.timelineStart=G;let x=u;u+=D;let R=o;o+=C,i.push({event:d,start:G,end:H,playout:{start:R,end:o},integrated:{start:x,end:u}})}else return;let A=d.resumeTime;y||A>s?l=s:l=A}),l<s){var a;let d=l,f=u,m=s-l;u+=m;let y=o;o+=m,i.push({previousEvent:((a=i[i.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:d+m,playout:{start:y,end:o},integrated:{start:f,end:u}})}this.setDurations(s,o,u)}else i.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){let i=t.main.details,r=i.live?1/0:i.edge,s=0,o=-1;e.forEach((a,l)=>{let u=a.cue.pre,d=a.cue.post,f=u?0:d?r:a.startTime;this.updateAssetDurations(a),o===f?a.cumulativeDuration=s:(s=0,o=f),!d&&a.snapOptions.in&&(a.resumeAnchor=Bc(null,i.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<qB&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));let y=Ie(a.resumeOffset)?a.resumeOffset:a.duration;s+=y})}primaryCanResumeInPlaceAt(e,t){let i=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(i-r)>qd?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${r}`),!1):!Object.keys(t).some(o=>{let a=t[o].details,l=a.edge;if(i>=l)return this.log(`"${e.identifier}" resumption ${i} past ${o} playlist end ${l}`),!1;let u=Bc(null,a.fragments,i);if(!u)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;let d=o==="audio"?.175:0;return Math.abs(u.start-i)<qd+d||Math.abs(u.end-i)<qd+d?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${o} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;let t=e.timelineStart,i=0,r=!1,s=!1;for(let o=0;o<e.assetList.length;o++){let a=e.assetList[o],l=t+i;a.startOffset=i,a.timelineStart=l,r||(r=a.duration===null),s||(s=!!a.error);let u=a.error?0:a.duration||0;i+=u}r&&!s?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}};function rs(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}var SD=class{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){let i=e.assetListUrl,r;try{r=m$(i,this.hls.sessionId,e.baseUrl)}catch(m){let y=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_ERROR,m,i);this.hls.trigger(b.ERROR,y);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);let s=this.hls.config,o=s.loader,a=new o(s),l={responseType:"json",url:r.href},u=s.interstitialAssetListLoadPolicy.default,d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(m,y,v,E)=>{let T=m.data,C=T?.ASSETS;if(!Array.isArray(C)){let D=this.assignAssetListError(e,Q.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),v.url,y,E);this.hls.trigger(b.ERROR,D);return}e.assetListResponse=T,this.hls.trigger(b.ASSET_LIST_LOADED,{event:e,assetListResponse:T,networkDetails:E})},onError:(m,y,v,E)=>{let T=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${m.code} ${m.text} (${y.url})`),y.url,E,v);this.hls.trigger(b.ERROR,T)},onTimeout:(m,y,v)=>{let E=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${y.url})`),y.url,m,v);this.hls.trigger(b.ERROR,E)}};return a.load(l,d,f),this.hls.trigger(b.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,i,r,s,o){return e.error=i,{type:Oe.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:i,networkDetails:o,stats:s}}};function WB(n){var e;n==null||(e=n.play())==null||e.catch(()=>{})}function a_(n,e){return`[${n}] Advancing timeline position to ${e}`}var CD=class extends ji{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{let i=this.currentTime;if(i===void 0||this.playbackDisabled||!this.schedule)return;let r=i-this.timelinePos;if(Math.abs(r)<1/7056e5)return;let o=r<=-.01;this.timelinePos=i,this.bufferedPos=i;let a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(i,i-r)&&this.updateSchedule(!0),this.checkBuffer(),o&&i<a.start||i>=a.end){var l;let y=this.findItemIndex(a),v=this.schedule.findItemIndexAtTime(i);if(v===-1&&(v=y+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${i} (resolving from ${y} to ${v})`)),!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o&&v>y){let E=this.schedule.findJumpRestrictedIndex(y+1,v);if(E>y){this.setSchedulePosition(E);return}}this.setSchedulePosition(v);return}let u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(a)){let y=a.event.assetList[0];y&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,y))}return}let d=u.timelineStart,f=u.duration||0;if(o&&i<d||i>=d+f){var m;(m=a.event)!=null&&m.appendInPlace&&(this.clearAssetPlayers(a.event,a),this.flushFrontBuffer(i)),this.setScheduleToAssetAtTime(i,u)}},this.onTimeupdate=()=>{let i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;let r=this.playingItem;if(!r||this.playingLastItem)return;if(i>=r.end){this.timelinePos=r.end;let a=this.findItemIndex(r);this.setSchedulePosition(a+1)}let s=this.playingAsset;if(!s)return;let o=s.timelineStart+(s.duration||0);i>=o&&this.setScheduleToAssetAtTime(i,s)},this.onScheduleUpdate=(i,r)=>{let s=this.schedule;if(!s)return;let o=this.playingItem,a=s.events||[],l=s.items||[],u=s.durations,d=i.map(E=>E.identifier),f=!!(a.length||d.length);(f||r)&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(E=>rs(E))} pos: ${this.timelinePos}`),d.length&&this.log(`Removed events ${d}`);let m=null,y=null;o&&(m=this.updateItem(o,this.timelinePos),this.itemsMatch(o,m)?this.playingItem=m:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);let v=this.bufferingItem;if(v&&(y=this.updateItem(v,this.bufferedPos),this.itemsMatch(v,y)?this.bufferingItem=y:v.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(v.event,null))),i.forEach(E=>{E.assetList.forEach(T=>{this.clearAssetPlayer(T.identifier,null)})}),this.playerQueue.forEach(E=>{if(E.interstitial.appendInPlace){let T=E.assetItem.timelineStart,C=E.timelineOffset-T;if(C)try{E.timelineOffset=T}catch(D){Math.abs(C)>qd&&this.warn(`${D} ("${E.assetId}" ${E.timelineOffset}->${T})`)}}}),f||r){if(this.hls.trigger(b.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:u,removedIds:d}),this.isInterstitial(o)&&d.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(m,o),v&&y!==m&&this.trimInPlace(y,v),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new SD(e),this.schedule=new bD(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){let e=this.hls;e&&(e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(b.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(b.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(b.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(b.BUFFER_APPENDED,this.onBufferAppended,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(b.MEDIA_ENDED,this.onMediaEnded,this),e.on(b.ERROR,this.onError,this),e.on(b.DESTROYING,this.onDestroying,this))}unregisterListeners(){let e=this.hls;e&&(e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(b.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(b.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(b.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.BUFFER_APPENDED,this.onBufferAppended,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(b.MEDIA_ENDED,this.onMediaEnded,this),e.off(b.ERROR,this.onError,this),e.off(b.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){let e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){$i(e,"play",this.onPlay),$i(e,"pause",this.onPause),$i(e,"seeking",this.onSeeking),$i(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){let i=this.media=t.media;Ci(i,"seeking",this.onSeeking),Ci(i,"timeupdate",this.onTimeupdate),Ci(i,"play",this.onPlay),Ci(i,"pause",this.onPause)}onMediaAttached(e,t){let i=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!r){this.clearScheduleState();let s=this.findItemIndex(i);this.setSchedulePosition(s)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){let i=!!t.transferMedia,r=this.media;if(this.media=null,!i&&(r&&this.removeMediaListeners(r),this.detachedData)){let s=this.getBufferingPlayer();s&&(this.log(`Removing schedule state for detachedData and ${s}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;let e=this,t=()=>e.bufferingItem||e.waitingItem,i=f=>f&&e.getAssetPlayer(f.identifier),r=(f,m,y,v,E)=>{if(f){let T=f[m].start,C=f.event;if(C){if(m==="playout"||C.timelineOccupancy!==V_.Point){let D=i(y);D?.interstitial===C&&(T+=D.assetItem.startOffset+D[E])}}else{let D=v==="bufferedPos"?o():e[v];T+=D-f.start}return T}return 0},s=(f,m)=>{var y;if(f!==0&&m!=="primary"&&(y=e.schedule)!=null&&y.length){var v;let E=e.schedule.findItemIndexAtTime(f),T=(v=e.schedule.items)==null?void 0:v[E];if(T){let C=T[m].start-T.start;return f+C}}return f},o=()=>{let f=e.bufferedPos;return f===Number.MAX_VALUE?a("primary"):Math.max(f,0)},a=f=>{var m,y;return(m=e.primaryDetails)!=null&&m.live?e.primaryDetails.edge:((y=e.schedule)==null?void 0:y.durations[f])||0},l=(f,m)=>{var y,v;let E=e.effectivePlayingItem;if(E!=null&&(y=E.event)!=null&&y.restrictions.skip||!e.schedule)return;e.log(`seek to ${f} "${m}"`);let T=e.effectivePlayingItem,C=e.schedule.findItemIndexAtTime(f,m),D=(v=e.schedule.items)==null?void 0:v[C],P=e.getBufferingPlayer(),V=P?.interstitial,G=V?.appendInPlace,H=T&&e.itemsMatch(T,D);if(T&&(G||H)){let A=i(e.playingAsset),x=A?.media||e.primaryMedia;if(x){let R=m==="primary"?x.currentTime:r(T,m,e.playingAsset,"timelinePos","currentTime"),M=f-R,F=(G?R:x.currentTime)+M;if(F>=0&&(!A||G||F<=A.duration)){x.currentTime=F;return}}}if(D){let A=f;if(m!=="primary"){let R=D[m].start,M=f-R;A=D.start+M}let x=!e.isInterstitial(D);if((!e.isInterstitial(T)||T.event.appendInPlace)&&(x||D.event.appendInPlace)){let R=e.media||(G?P?.media:null);R&&(R.currentTime=A)}else if(T){let R=e.findItemIndex(T);if(C>R){let F=e.schedule.findJumpRestrictedIndex(R+1,C);if(F>R){e.setSchedulePosition(F);return}}let M=0;if(x)e.timelinePos=A,e.checkBuffer();else{let F=D.event.assetList,j=f-(D[m]||D).start;for(let B=F.length;B--;){let pe=F[B];if(pe.duration&&j>=pe.startOffset&&j<pe.startOffset+pe.duration){M=B;break}}}e.setSchedulePosition(C,M)}}},u=()=>{let f=e.effectivePlayingItem;if(e.isInterstitial(f))return f;let m=t();return e.isInterstitial(m)?m:null},d={get bufferedEnd(){let f=t(),m=e.bufferingItem;if(m&&m===f){var y;return r(m,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-m.playout.start||((y=e.bufferingAsset)==null?void 0:y.startOffset)||0}return 0},get currentTime(){let f=u(),m=e.effectivePlayingItem;return m&&m===f?r(m,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-m.playout.start:0},set currentTime(f){let m=u(),y=e.effectivePlayingItem;y&&y===m&&l(f+y.playout.start,"playout")},get duration(){let f=u();return f?f.playout.end-f.playout.start:0},get assetPlayers(){var f;let m=(f=u())==null?void 0:f.event.assetList;return m?m.map(y=>e.getAssetPlayer(y.identifier)):[]},get playingIndex(){var f;let m=(f=u())==null?void 0:f.event;return m&&e.effectivePlayingAsset?m.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var f;return((f=e.schedule)==null||(f=f.events)==null?void 0:f.slice(0))||[]},get schedule(){var f;return((f=e.schedule)==null||(f=f.items)==null?void 0:f.slice(0))||[]},get interstitialPlayer(){return u()?d:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){let f=t();return e.findItemIndex(f)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){let f=e.effectivePlayingItem;return e.findItemIndex(f)},primary:{get bufferedEnd(){return o()},get currentTime(){let f=e.timelinePos;return f>0?f:0},set currentTime(f){l(f,"primary")},get duration(){return a("primary")},get seekableStart(){var f;return((f=e.primaryDetails)==null?void 0:f.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(f){l(f,"integrated")},get duration(){return a("integrated")},get seekableStart(){var f;return s(((f=e.primaryDetails)==null?void 0:f.fragmentStart)||0,"integrated")}},skip:()=>{let f=e.effectivePlayingItem,m=f?.event;if(m&&!m.restrictions.skip){let y=e.findItemIndex(f);if(m.appendInPlace){let v=f.playout.start+f.event.duration;l(v+.001,"playout")}else e.advanceAfterAssetEnded(m,y,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;let t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;let i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);let s=(t=r)==null?void 0:t.currentTime;if(!(s===void 0||!Ie(s)))return s}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){let i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){let i=e.interstitial.appendInPlace,r=e.media;if(i&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}let s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Qt(s)}`),this.detachedData=s}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var i,r;if(e.media===t)return;let s=null,o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,u=(i=this.detachedData)==null?void 0:i.mediaSource,d;if(o.media)l&&(s=o.transferMedia(),this.detachedData=s),d="Primary";else if(u){let v=this.getBufferingPlayer();v?(s=v.transferMedia(),d=`${v}`):d="detached MediaSource"}else d="detached media";if(!s){if(u)s=this.detachedData,this.log(`using detachedData: MediaSource ${Qt(s)}`);else if(!this.detachedData||o.media===t){let v=this.playerQueue;v.length>1&&v.forEach(E=>{if(a&&E.interstitial.appendInPlace!==l){let T=E.interstitial;this.clearInterstitial(E.interstitial,null),T.appendInPlace=!1,T.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${T}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}let f=s&&"mediaSource"in s&&((r=s.mediaSource)==null?void 0:r.readyState)!=="closed",m=f&&s?s:t;this.log(`${f?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${d} (media.currentTime: ${t.currentTime})`);let y=this.schedule;if(m===s&&y){let v=a&&e.assetId===y.assetIdAtEnd;m.overrides={duration:y.duration,endOfStream:!a||v,cueRemoval:!a}}e.attachMedia(m)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){let e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);let i=this.timelinePos,r=this.effectivePlayingItem;if(i===-1){let s=this.hls.startPosition;if(this.log(a_("checkStart",s)),this.timelinePos=s,t.length&&t[0].cue.pre){let o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(s>=0||!this.primaryLive){let o=this.timelinePos=s>0?s:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(r&&!this.playingItem){let s=e.findItemIndex(r);this.setSchedulePosition(s)}}advanceAssetBuffering(e,t){let i=e.event,r=i.findAssetIndex(t),s=_A(i,r);if(!i.isAssetPastPlayoutLimit(s))this.bufferedToEvent(e,s);else if(this.schedule){var o;let a=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];a&&this.bufferedToItem(a)}}advanceAfterAssetEnded(e,t,i){let r=_A(e,i);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){let s=this.schedule.items;if(s){let o=t+1,a=s.length;if(o>=a){this.setSchedulePosition(-1);return}let l=e.resumeTime;this.timelinePos<l&&(this.log(a_("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){let s=e.assetList[r];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){let i=this.schedule;if(!i)return;let r=t.parentIdentifier,s=i.getEvent(r);if(s){let o=i.findEventIndex(r),a=i.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,o,a-1)}}setSchedulePosition(e,t){var i;let r=(i=this.schedule)==null?void 0:i.items;if(!r||this.playbackDisabled)return;let s=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${s&&rs(s)}) pos: ${this.timelinePos}`);let o=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(o)){let d=o.event,f=this.playingAsset,m=f?.identifier,y=m?this.getAssetPlayer(m):null;if(y&&m&&(!this.eventItemsMatch(o,s)||t!==void 0&&m!==d.assetList[t].identifier)){var l;let v=d.findAssetIndex(f);if(this.log(`INTERSTITIAL_ASSET_ENDED ${v+1}/${d.assetList.length} ${Ud(f)}`),this.endedAsset=f,this.playingAsset=null,this.hls.trigger(b.INTERSTITIAL_ASSET_ENDED,{asset:f,assetListIndex:v,event:d,schedule:r.slice(0),scheduleIndex:e,player:y}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(d,this.findItemIndex(this.playingItem),v);return}this.retreiveMediaSource(m,s),y.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&y.detachMedia()}if(!this.eventItemsMatch(o,s)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${d} ${rs(o)}`),d.hasPlayed=!0,this.hls.trigger(b.INTERSTITIAL_ENDED,{event:d,schedule:r.slice(0),scheduleIndex:e}),d.cue.once)){var u;this.updateSchedule();let v=(u=this.schedule)==null?void 0:u.items;if(s&&v){let E=this.findItemIndex(s);this.advanceSchedule(E,v,t,o,a)}return}}this.advanceSchedule(e,r,t,o,a)}advanceSchedule(e,t,i,r,s){let o=this.schedule;if(!o)return;let a=t[e]||null,l=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(d=>{let f=d.interstitial,m=o.findEventIndex(f.identifier);(m<e||m>e+1)&&this.clearInterstitial(f,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);let d=a.event;if(i===void 0){i=o.findAssetIndex(d,this.timelinePos);let v=_A(d,i-1);if(d.isAssetPastPlayoutLimit(v)||d.appendInPlace&&this.timelinePos===a.end){this.advanceAfterAssetEnded(d,e,i);return}i=v}let f=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let m=this.preloadAssets(d,i);if(this.eventItemsMatch(a,f||r)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${rs(a)} ${d.appendInPlace?"append in place":""}`),this.hls.trigger(b.INTERSTITIAL_STARTED,{event:d,schedule:t.slice(0),scheduleIndex:e})),!d.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${d}`);return}if(d.assetListLoader&&(d.assetListLoader.destroy(),d.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${d}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;let y=d.assetList[i];if(!y){this.advanceAfterAssetEnded(d,e,i||0);return}if(m||(m=this.getAssetPlayer(y.identifier)),m===null||m.destroyed){let v=d.assetList.length;this.warn(`asset ${i+1}/${v} player destroyed ${d}`),m=this.createAssetPlayer(d,y,i),m.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&d.appendInPlace&&this.isAssetBuffered(y))return;this.startAssetPlayer(m,i,t,e,l),this.shouldPlay&&WB(m.media)}else a?(this.resumePrimary(a,e,r),this.shouldPlay&&WB(this.hls.media)):s&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var r,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${rs(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.log(a_("resumePrimary",a)),this.timelinePos=a),this.attachPrimary(a,e)}if(!i)return;let o=(s=this.schedule)==null?void 0:s.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${rs(e)}`),this.hls.trigger(b.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){let i=e.start;if(this.primaryLive){let r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(i<r.fragmentStart||i>r.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){let t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:ot.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;let r=this.primaryMedia;if(!r)return;let s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,r),i&&this.startLoadingPrimaryAt(e,i)),i||(this.log(a_("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;let r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((i=r.mainForwardBufferInfo)==null?void 0:i.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(b.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(b.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;let i=this.hls.levels[t.level];if(!i.details)return;let r=jt(jt({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){let i=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=jt(jt({},this.altSelection),{},{audio:i});return}let s=jt(jt({},r),{},{audio:i});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){let i=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=jt(jt({},this.altSelection),{},{subtitles:i});return}let s=jt(jt({},r),{},{subtitles:i});this.mediaSelection=s}onAudioTrackSwitching(e,t){let i=iB(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(t)||r.setAudioOption(i)))}onSubtitleTrackSwitch(e,t){let i=iB(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(t)||t.id!==-1&&r.setSubtitleOption(i)))}onBufferCodecs(e,t){let i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){let i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){let r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;let t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){let s=t[r];if(s.cue.post){var i;let o=this.schedule.findEventIndex(s.identifier),a=(i=this.schedule.items)==null?void 0:i[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){let t=this.playingItem;if(!this.playingLastItem&&t){let i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){var i;let r=(i=this.schedule)==null?void 0:i.items;if(e&&r){let s=this.findItemIndex(e,t);return r[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(s.identifier,null)});let i=e.end+.25,r=ot.bufferInfo(this.primaryMedia,i,0);(r.end>i||(r.nextStart||0)>i)&&(this.log(`trim buffered interstitial ${rs(e)} (was ${rs(t)})`),this.attachPrimary(i,null,!0),this.flushFrontBuffer(i))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;let i=this.mediaSelection;i&&((t=this.schedule)==null||t.updateSchedule(i,[],e))}checkBuffer(e){var t;let i=(t=this.schedule)==null?void 0:t.items;if(!i)return;let r=ot.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,i,e)}updateBufferedPos(e,t,i){let r=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}let o=this.playingItem,a=this.findItemIndex(o),l=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;let d=this.findItemIndex(s),f=Math.min(d+1,t.length-1),m=t[f];if((l===-1&&s&&e>=s.end||(u=m.event)!=null&&u.appendInPlace&&e+.01>=m.start)&&(l=f),this.isInterstitial(s)){let y=s.event;if(f-a>1&&y.appendInPlace===!1||y.assetList.length===0&&y.assetListLoader)return}if(this.bufferedPos=e,l>d&&l>a)this.bufferedToItem(m);else{let y=this.primaryDetails;this.primaryLive&&y&&e>y.edge-y.targetduration&&m.start<y.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(m)&&this.preloadAssets(m.event,0)}}else i&&o&&!this.itemsMatch(o,s)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{let s=this.getAssetPlayer(r.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){let t=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(e,t)&&i){let{items:r,events:s}=i;if(!r||!s)return t;let o=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));let l=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${rs(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){let u=i.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((d,f)=>{let m=this.getAssetPlayer(d.identifier);m&&(f===u&&m.loadSource(),m.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(b.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){let i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;let r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){let t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){let i=e.event,r=i.assetList.length===0&&!i.assetListLoader,s=i.cue.once;if(r||!s){let o=this.preloadAssets(i,t);if(o!=null&&o.interstitial.appendInPlace){let a=this.primaryMedia;a&&this.bufferAssetPlayer(o,a)}}}preloadAssets(e,t){let i=e.assetUrl,r=e.assetList.length,s=r===0&&!e.assetListLoader,o=e.cue.once;if(s){let l=e.timelineStart;if(e.appendInPlace){var a;let m=this.playingItem;!this.isInterstitial(m)&&(m==null||(a=m.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let u,d=0;if(!this.playingItem&&this.primaryLive&&(d=this.hls.startPosition,d===-1&&(d=this.hls.liveSyncPosition||0)),d&&!(e.cue.pre||e.cue.post)){let m=d-l;m>0&&(u=Math.round(m*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:r} ${e}${u?` live-start: ${d} start-offset: ${u}`:""}`),i)return this.createAsset(e,0,0,l,e.duration,i);let f=this.assetListLoader.loadAssetList(e,u);f&&(e.assetListLoader=f)}else if(!o&&r){for(let u=t;u<r;u++){let d=e.assetList[u],f=this.getAssetPlayerQueueIndex(d.identifier);(f===-1||this.playerQueue[f].destroyed)&&!d.error&&this.createAssetPlayer(e,d,u)}let l=e.assetList[t];if(l){let u=this.getAssetPlayer(l.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){let t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){let t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){let t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){let{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,r,s,o){let a={parentIdentifier:e.identifier,identifier:Cne(e,o,t),duration:s,startOffset:i,timelineStart:r,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,i){let r=this.hls,s=r.userConfig,o=s.videoPreference,a=r.loadLevelObj||r.levels[r.currentLevel];(o||a)&&(o=zt({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));let l=r.audioTracks[r.audioTrack],u=r.subtitleTracks[r.subtitleTrack],d=0;if(this.primaryLive||e.appendInPlace){let V=this.timelinePos-t.timelineStart;if(V>1){let G=t.duration;G&&V<G&&(d=V)}}let f=t.identifier,m=jt(jt({},s),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:f,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:d,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||s.audioPreference,subtitlePreference:u||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(m.timelineOffset=t.timelineStart));let y=m.cmcd;y!=null&&y.sessionId&&y.contentId&&(m.cmcd=zt({},y,{contentId:kp(t.uri)})),this.getAssetPlayer(f)&&this.warn(`Duplicate date range identifier ${e} and asset ${f}`);let v=new ID(this.HlsPlayerClass,m,e,t);this.playerQueue.push(v),e.assetList[i]=t;let E=!0,T=V=>{if(V.live){var G;let x=new Error(`Interstitials MUST be VOD assets ${e}`),R={fatal:!0,type:Oe.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:x},M=((G=this.schedule)==null?void 0:G.findEventIndex(e.identifier))||-1;this.handleAssetItemError(R,e,M,i,x.message);return}let H=V.edge-V.fragmentStart,A=t.duration;(E||A===null||H>A)&&(E=!1,this.log(`Interstitial asset "${f}" duration change ${A} > ${H}`),t.duration=H,this.updateSchedule())};v.on(b.LEVEL_UPDATED,(V,{details:G})=>T(G)),v.on(b.LEVEL_PTS_UPDATED,(V,{details:G})=>T(G)),v.on(b.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());let C=(V,G)=>{let H=this.getAssetPlayer(f);if(H&&G.tracks){H.off(b.BUFFER_CODECS,C),H.tracks=G.tracks;let A=this.primaryMedia;this.bufferingAsset===H.assetItem&&A&&!H.media&&this.bufferAssetPlayer(H,A)}};v.on(b.BUFFER_CODECS,C);let D=()=>{var V;let G=this.getAssetPlayer(f);if(this.log(`buffered to end of asset ${G}`),!G||!this.schedule)return;let H=this.schedule.findEventIndex(e.identifier),A=(V=this.schedule.items)==null?void 0:V[H];this.isInterstitial(A)&&this.advanceAssetBuffering(A,t)};v.on(b.BUFFERED_TO_END,D);let P=V=>()=>{if(!this.getAssetPlayer(f)||!this.schedule)return;this.shouldPlay=!0;let H=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,H,V)};return v.once(b.MEDIA_ENDED,P(i)),v.once(b.PLAYOUT_LIMIT_REACHED,P(1/0)),v.on(b.ERROR,(V,G)=>{if(!this.schedule)return;let H=this.getAssetPlayer(f);if(G.details===Q.BUFFER_STALLED_ERROR){if(H!=null&&H.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(G,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${G.error} ${e}`)}),v.on(b.DESTROYING,()=>{if(!this.getAssetPlayer(f)||!this.schedule)return;let G=new Error(`Asset player destroyed unexpectedly ${f}`),H={fatal:!0,type:Oe.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:G};this.handleAssetItemError(H,e,this.schedule.findEventIndex(e.identifier),i,G.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Ud(t)}`),this.hls.trigger(b.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:v}),v}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)})}resetAssetPlayer(e){let t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);let i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,t){let i=this.getAssetPlayerQueueIndex(e);if(i!==-1){let r=this.playerQueue[i];this.log(`clear ${r} toSegment: ${t&&rs(t)}`),this.transferMediaFromPlayer(r,t),this.playerQueue.splice(i,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,r,s){let{interstitial:o,assetItem:a,assetId:l}=e,u=o.assetList.length,d=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!d||d.identifier!==l)&&(d&&(this.clearAssetPlayer(d.identifier,i[r]),delete d.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${Ud(a)}`),this.hls.trigger(b.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:i.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var i,r;if(!this.schedule)return;let{interstitial:s,assetItem:o}=e,a=this.schedule.findEventIndex(s.identifier),l=(i=this.schedule.items)==null?void 0:i[a];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=o;let u=this.getBufferingPlayer();if(u===e)return;let d=s.appendInPlace;if(d&&u?.interstitial.appendInPlace===!1)return;let f=u?.tracks||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(d&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(f&&!rU(f,e.tracks)){let m=new Error(`Asset ${Ud(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(f)}')`),y={fatal:!0,type:Oe.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:m},v=s.findAssetIndex(o);this.handleAssetItemError(y,s,a,v,m.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){let t=this.schedule,i=this.primaryMedia;if(!t||!i)return;let r=i.currentTime,s=t.findAssetIndex(e,r),o=e.assetList[s];if(o){let a=this.getAssetPlayer(o.identifier);if(a){let l=a.currentTime||r-o.timelineStart,u=a.duration-l;if(this.warn(`Stalled at ${l} of ${l+u} in ${a} ${e} (media.currentTime: ${r})`),l&&(u/i.playbackRate<.5||a.bufferedInPlaceToEnd(i))&&a.hls){let d=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,d,s)}}}}advanceInPlace(e){let t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,i,r,s){if(e.details===Q.BUFFER_STALLED_ERROR)return;let o=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&Ud(o)} ${e.error}`),!this.schedule)return;let a=o?.identifier||"",l=this.getAssetPlayerQueueIndex(a),u=this.playerQueue[l]||null,d=this.schedule.items,f=zt({},e,{fatal:!1,errorAction:Gd(!0),asset:o,assetListIndex:r,event:t,schedule:d,scheduleIndex:i,player:u});if(this.hls.trigger(b.INTERSTITIAL_ASSET_ERROR,f),!e.fatal)return;let m=this.playingAsset,y=this.bufferingAsset,v=new Error(s);if(o&&(this.clearAssetPlayer(a,null),o.error=v),!t.assetList.some(E=>!E.error))t.error=v;else for(let E=r;E<t.assetList.length;E++)this.resetAssetPlayer(t.assetList[E].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):m&&m.identifier===a?this.advanceAfterAssetEnded(t,i,r):y&&y.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,y)}primaryFallback(e){let t=e.timelineStart,i=this.effectivePlayingItem,r=this.timelinePos;if(i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${r} playing: ${rs(i)} error: ${e.error}`),r===-1&&(r=this.hls.startPosition);let o=this.updateItem(i,r);this.itemsMatch(i,o)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(r===-1){this.checkStart();return}if(!this.schedule)return;let s=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(s)}onAssetListLoaded(e,t){var i,r;let s=t.event,o=s.identifier,a=t.assetListResponse.ASSETS;if(!((i=this.schedule)!=null&&i.hasEvent(o)))return;let l=s.timelineStart,u=s.duration,d=0;a.forEach((E,T)=>{let C=parseFloat(E.DURATION);this.createAsset(s,T,d,l+d,C,E.URI),d+=C}),s.duration=d,this.log(`Loaded asset-list with duration: ${d} (was: ${u}) ${s}`);let f=this.waitingItem,m=f?.event.identifier===o;this.updateSchedule();let y=(r=this.bufferingItem)==null?void 0:r.event;if(m){var v;let E=this.schedule.findEventIndex(o),T=(v=this.schedule.items)==null?void 0:v[E];if(T){if(!this.playingItem&&this.timelinePos>T.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==E){s.error=new Error(`Interstitial ${a.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${s}`),this.log(s.error.message),this.updateSchedule(!0),this.primaryFallback(s);return}this.setBufferingItem(T)}this.setSchedulePosition(E)}else if(y?.identifier===o){let E=s.assetList[0];if(E){let T=this.getAssetPlayer(E.identifier);if(y.appendInPlace){let C=this.primaryMedia;T&&C&&this.bufferAssetPlayer(T,C)}else T&&T.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Q.ASSET_LIST_PARSING_ERROR:case Q.ASSET_LIST_LOAD_ERROR:case Q.ASSET_LIST_LOAD_TIMEOUT:{let i=t.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break}case Q.BUFFER_STALLED_ERROR:{let i=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&i.event.appendInPlace){this.handleInPlaceStall(i.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}},KB=500,xD=class extends Up{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",De.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();let{hls:e}=this;e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();let{hls:e}=this;e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=re.IDLE,this.setInterval(KB),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){let{frag:i,success:r}=t;if(this.fragContextChanged(i)||(In(i)&&(this.fragPrevious=i),this.state=re.IDLE),!r)return;let s=this.tracksBuffered[this.currentTrackId];if(!s)return;let o,a=i.start;for(let u=0;u<s.length;u++)if(a>=s[u].start&&a<=s[u].end){o=s[u];break}let l=i.start+i.duration;o?o.end=l:(o={start:a,end:l},s.push(o)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){let{startOffset:i,endOffset:r}=t;if(i===0&&r!==Number.POSITIVE_INFINITY){let s=r-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=s){o.shift();continue}else if(o[a].start<s)o[a].start=s;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(i,s,De.SUBTITLE)}}onError(e,t){let i=t.frag;i?.type===De.SUBTITLE&&(t.details===Q.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==re.STOPPED&&(this.state=re.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&t$(this.levels,t)){this.levels=t.map(i=>new Vc(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{let r=new Vc(i);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,De.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}let r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==re.STOPPED&&this.setInterval(KB)}onSubtitleTrackLoaded(e,t){var i;let{currentTrackId:r,levels:s}=this,{details:o,id:a}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}let l=s[a];if(a>=s.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(o.live||(i=l.details)!=null&&i.live){if(o.deltaUpdateFailed)return;let f=this.mainDetails;if(!f){this.startFragRequested=!1;return}let m=f.fragments[0];if(!l.details)o.hasProgramDateTime&&f.hasProgramDateTime?(R_(o,f),u=o.fragmentStart):m&&(u=m.start,qA(o,u));else{var d;u=this.alignPlaylists(o,l.details,(d=this.levelLastLoaded)==null?void 0:d.details),u===0&&m&&(u=m.start,qA(o,u))}f&&!this.startFragRequested&&this.setStartPosition(f,u)}l.details=o,this.levelLastLoaded=l,a===r&&(this.hls.trigger(b.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===re.IDLE&&(Bc(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){let{frag:t,payload:i}=e,r=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&r!=null&&r.key&&r.iv&&zd(r.method)){let o=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,XD(r.method)).catch(a=>{throw s.trigger(b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{let l=performance.now();s.trigger(b.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=re.IDLE})}}doTick(){if(!this.media){this.state=re.IDLE;return}if(this.state===re.IDLE){let{currentTrackId:e,levels:t}=this,i=t?.[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;let{config:r}=this,s=this.getLoadPosition(),o=ot.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:a,len:l}=o,u=i.details,d=this.hls.maxBufferLength+u.levelTargetDuration;if(l>d)return;let f=u.fragments,m=f.length,y=u.edge,v=null,E=this.fragPrevious;if(a<y){let D=r.maxFragLookUpTolerance,P=a>y-D?0:D;v=Bc(E,f,Math.max(f[0].start,a),P),!v&&E&&E.start<f[0].start&&(v=f[0])}else v=f[m-1];if(v=this.filterReplacedPrimary(v,i.details),!v)return;let T=v.sn-u.startSN,C=f[T-1];if(C&&C.cc===v.cc&&this.fragmentTracker.getState(C)===jn.NOT_LOADED&&(v=C),this.fragmentTracker.getState(v)===jn.NOT_LOADED){let D=this.mapToInitFragWhenRequired(v);D&&this.loadFragment(D,i,a)}}}loadFragment(e,t,i){In(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new AD(this.tracksBuffered[this.currentTrackId]||[])}},AD=class{constructor(e){this.buffered=void 0;let t=(i,r,s)=>{if(r=r>>>0,r>s-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return e[r][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}},Ane={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},g$=n=>String.fromCharCode(Ane[n]||n),ss=15,Yo=100,Dne={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Pne={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Rne={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Mne={25:2,26:4,29:6,30:8,31:10,27:13,28:15},kne=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],DD=class{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){let i=typeof t=="function"?t():t;Gt.log(`${this.time} [${e}] ${i}`)}}},kc=function(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t},B_=class{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){let t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){let r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}},PD=class{constructor(){this.uchar=" ",this.penState=new B_}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}},RD=class{constructor(e){this.chars=[],this.pos=0,this.currPenState=new B_,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Yo;t++)this.chars.push(new PD);this.logger=e}equals(e){for(let t=0;t<Yo;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Yo;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Yo;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Yo&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Yo)}moveCursor(e){let t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();let t=g$(e);if(this.pos>=Yo){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Yo;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){let e=[],t=!0;for(let i=0;i<Yo;i++){let r=this.chars[i].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}},Lp=class{constructor(e){this.rows=[],this.currRow=ss-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<ss;t++)this.rows.push(new RD(e));this.logger=e}reset(){for(let e=0;e<ss;e++)this.rows[e].clear();this.currRow=ss-1}equals(e){let t=!0;for(let i=0;i<ss;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<ss;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<ss;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Qt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<ss;a++)this.rows[a].clear();let s=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){let a=o.rows[s].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(o.rows[s+u])}}this.currRow=t;let i=this.rows[this.currRow];if(e.indent!==null){let s=e.indent,o=Math.max(s-1,0);i.setCursor(e.indent),e.color=i.chars[o].penState.foreground}let r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Qt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());let e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;let t=[],i="",r=-1;for(let s=0;s<ss;s++){let o=this.rows[s].getTextString();o&&(r=s+1,e?t.push("Row "+r+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}},U_=class{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Lp(i),this.nonDisplayedMemory=new Lp(i),this.lastOutputScreen=new Lp(i),this.currRollUpRow=this.displayedMemory.rows[ss-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[ss-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);let t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){let e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){let t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{let i=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[i]}this.logger.log(2,"MIDROW: "+Qt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){let t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}},$_=class{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=One(),this.logger=void 0;let r=this.logger=new DD;this.channels=[null,new U_(e,t,r),new U_(e+1,i,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){let r=t[i]&127,s=t[i+1]&127,o=!1,a=null;if(r===0&&s===0)continue;this.logger.log(3,()=>"["+kc([t[i],t[i+1]])+"] -> ("+kc([r,s])+")");let l=this.cmdHistory;if(r>=16&&r<=31){if(Lne(r,s,l)){l_(null,null,l),this.logger.log(3,()=>"Repeated command ("+kc([r,s])+") is dropped");continue}l_(r,s,this.cmdHistory),o=this.parseCmd(r,s),o||(o=this.parseMidrow(r,s)),o||(o=this.parsePAC(r,s)),o||(o=this.parseBackgroundAttributes(r,s))}else l_(null,null,l);if(!o&&(a=this.parseChars(r,s),a)){let d=this.currentChannel;d&&d>0?this.channels[d].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+kc([r,s])+" orig: "+kc([t[i],t[i+1]]))}}parseCmd(e,t){let i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(i||r))return!1;let s=e===20||e===21||e===23?1:2,o=this.channels[s];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;let r=this.channels[i];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+kc([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i,r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(r||s))return!1;let o=e<=23?1:2;t>=64&&t<=95?i=o===1?Dne[e]:Rne[e]:i=o===1?Pne[e]:Mne[e];let a=this.channels[o];return a?(a.setPAC(this.interpretPAC(i,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let i,r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,r.underline=(i&1)===1,i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((i-16)/2)*4,r}parseChars(e,t){let i,r=null,s=null;if(e>=25?(i=2,s=e-8):(i=1,s=e),s>=17&&s<=19){let o;s===17?o=t+80:s===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+g$(o)+"' in channel "+i),r=[o]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+kc(r).join(",")),r}parseBackgroundAttributes(e,t){let i=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(i||r))return!1;let s,o={};e===16||e===24?(s=Math.floor((t-32)/2),o.background=kne[s],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));let a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){let t=this.channels[e];t&&t.reset()}l_(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){let i=this.channels[t];i&&i.cueSplitAtTime(e)}}};function l_(n,e,t){t.a=n,t.b=e}function Lne(n,e,t){return t.a===n&&t.b===e}function One(){return{a:null,b:null}}var l1=function(){if(P_!=null&&P_.VTTCue)return self.VTTCue;let n=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;let u=l.toLowerCase();return~a.indexOf(u)?u:!1}function i(a){return t(n,a)}function r(a){return t(e,a)}function s(a,...l){let u=1;for(;u<arguments.length;u++){let d=arguments[u];for(let f in d)a[f]=d[f]}return a}function o(a,l,u){let d=this,f={enumerable:!0};d.hasBeenReset=!1;let m="",y=!1,v=a,E=l,T=u,C=null,D="",P=!0,V="auto",G="start",H=50,A="middle",x=50,R="middle";Object.defineProperty(d,"id",s({},f,{get:function(){return m},set:function(M){m=""+M}})),Object.defineProperty(d,"pauseOnExit",s({},f,{get:function(){return y},set:function(M){y=!!M}})),Object.defineProperty(d,"startTime",s({},f,{get:function(){return v},set:function(M){if(typeof M!="number")throw new TypeError("Start time must be set to a number.");v=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"endTime",s({},f,{get:function(){return E},set:function(M){if(typeof M!="number")throw new TypeError("End time must be set to a number.");E=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"text",s({},f,{get:function(){return T},set:function(M){T=""+M,this.hasBeenReset=!0}})),Object.defineProperty(d,"region",s({},f,{get:function(){return C},set:function(M){C=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"vertical",s({},f,{get:function(){return D},set:function(M){let F=i(M);if(F===!1)throw new SyntaxError("An invalid or illegal string was specified.");D=F,this.hasBeenReset=!0}})),Object.defineProperty(d,"snapToLines",s({},f,{get:function(){return P},set:function(M){P=!!M,this.hasBeenReset=!0}})),Object.defineProperty(d,"line",s({},f,{get:function(){return V},set:function(M){if(typeof M!="number"&&M!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");V=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"lineAlign",s({},f,{get:function(){return G},set:function(M){let F=r(M);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");G=F,this.hasBeenReset=!0}})),Object.defineProperty(d,"position",s({},f,{get:function(){return H},set:function(M){if(M<0||M>100)throw new Error("Position must be between 0 and 100.");H=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"positionAlign",s({},f,{get:function(){return A},set:function(M){let F=r(M);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");A=F,this.hasBeenReset=!0}})),Object.defineProperty(d,"size",s({},f,{get:function(){return x},set:function(M){if(M<0||M>100)throw new Error("Size must be between 0 and 100.");x=M,this.hasBeenReset=!0}})),Object.defineProperty(d,"align",s({},f,{get:function(){return R},set:function(M){let F=r(M);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");R=F,this.hasBeenReset=!0}})),d.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}(),MD=class{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}};function y$(n){function e(i,r,s,o){return(i|0)*3600+(r|0)*60+(s|0)+parseFloat(o||0)}let t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}var kD=class{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){let i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}};function v$(n,e,t,i){let r=i?n.split(i):[n];for(let s in r){if(typeof r[s]!="string")continue;let o=r[s].split(t);if(o.length!==2)continue;let a=o[0],l=o[1];e(a,l)}}var LD=new l1(0,0,""),c_=LD.align==="middle"?"middle":"center";function Nne(n,e,t){let i=n;function r(){let a=y$(n);if(a===null)throw new Error("Malformed timestamp: "+i);return n=n.replace(/^[^\sa-zA-Z-]+/,""),a}function s(a,l){let u=new kD;v$(a,function(m,y){let v;switch(m){case"region":for(let E=t.length-1;E>=0;E--)if(t[E].id===y){u.set(m,t[E].region);break}break;case"vertical":u.alt(m,y,["rl","lr"]);break;case"line":v=y.split(","),u.integer(m,v[0]),u.percent(m,v[0])&&u.set("snapToLines",!1),u.alt(m,v[0],["auto"]),v.length===2&&u.alt("lineAlign",v[1],["start",c_,"end"]);break;case"position":v=y.split(","),u.percent(m,v[0]),v.length===2&&u.alt("positionAlign",v[1],["start",c_,"end","line-left","line-right","auto"]);break;case"size":u.percent(m,y);break;case"align":u.alt(m,y,["start",c_,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let d=u.get("line","auto");d==="auto"&&LD.line===-1&&(d=-1),l.line=d,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",c_);let f=u.get("position","auto");f==="auto"&&LD.position===50&&(f=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=f}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=r(),o(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);n=n.slice(3),o(),e.endTime=r(),o(),s(n,e)}function _$(n){return n.replace(/<br(?: \/)?>/gi,`
`)}var OD=class{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new MD,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){let t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let s=t.buffer,o=0;for(s=_$(s);o<s.length&&s[o]!=="\r"&&s[o]!==`
`;)++o;let a=s.slice(0,o);return s[o]==="\r"&&++o,s[o]===`
`&&++o,t.buffer=s.slice(o),a}function r(s){v$(s,function(o,a){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=i();let a=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:s=i(),t.state){case"HEADER":/:/.test(s)?r(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new l1(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Nne(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{let a=s.indexOf("-->")!==-1;if(!s||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){let e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}},Fne=/\r\n|\n\r|\n|\r/g,EA=function(e,t,i=0){return e.slice(i,i+t.length)===t},Vne=function(e){let t=parseInt(e.slice(-3)),i=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Ie(t)||!Ie(i)||!Ie(r)||!Ie(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*r,t+=60*60*1e3*s,t};function c1(n,e,t){return kp(n.toString())+kp(e.toString())+kp(t)}var Bne=function(e,t,i){let r=e[t],s=e[r.prevCC];if(!s||!s.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(o=s)!=null&&o.new;){var o;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=i};function Une(n,e,t,i,r,s,o){let a=new OD,l=mr(new Uint8Array(n)).trim().replace(Fne,`
`).split(`
`),u=[],d=e?gte(e.baseTime,e.timescale):0,f="00:00.000",m=0,y=0,v,E=!0;a.oncue=function(T){let C=t[i],D=t.ccOffset,P=(m-d)/9e4;if(C!=null&&C.new&&(y!==void 0?D=t.ccOffset=C.start:Bne(t,i,P)),P){if(!e){v=new Error("Missing initPTS for VTT MPEGTS");return}D=P-t.presentationOffset}let V=T.endTime-T.startTime,G=fr((T.startTime+D-y)*9e4,r*9e4)/9e4;T.startTime=Math.max(G,0),T.endTime=Math.max(G+V,0);let H=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(H)),T.id||(T.id=c1(T.startTime,T.endTime,H)),T.endTime>0&&u.push(T)},a.onparsingerror=function(T){v=T},a.onflush=function(){if(v){o(v);return}s(u)},l.forEach(T=>{if(E)if(EA(T,"X-TIMESTAMP-MAP=")){E=!1,T.slice(16).split(",").forEach(C=>{EA(C,"LOCAL:")?f=C.slice(6):EA(C,"MPEGTS:")&&(m=parseInt(C.slice(7)))});try{y=Vne(f)/1e3}catch(C){v=C}return}else T===""&&(E=!1);a.parse(T+`
`)}),a.flush()}var TA="stpp.ttml.im1t",E$=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,T$=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,$ne={left:"start",center:"center",right:"end",start:"start",end:"end"};function YB(n,e,t,i){let r=ht(new Uint8Array(n),["mdat"]);if(r.length===0){i(new Error("Could not parse IMSC1 mdat"));return}let s=r.map(a=>mr(a)),o=mte(e.baseTime,1,e.timescale);try{s.forEach(a=>t(jne(a,o)))}catch(a){i(a)}}function jne(n,e){let r=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");let s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(s).reduce((f,m)=>(f[m]=r.getAttribute(`ttp:${m}`)||s[m],f),{}),a=r.getAttribute("xml:space")!=="preserve",l=QB(wA(r,"styling","style")),u=QB(wA(r,"layout","region")),d=wA(r,"body","[begin]");return[].map.call(d,f=>{let m=w$(f,a);if(!m||!f.hasAttribute("begin"))return null;let y=bA(f.getAttribute("begin"),o),v=bA(f.getAttribute("dur"),o),E=bA(f.getAttribute("end"),o);if(y===null)throw ZB(f);if(E===null){if(v===null)throw ZB(f);E=y+v}let T=new l1(y-e,E-e,m);T.id=c1(T.startTime,T.endTime,T.text);let C=u[f.getAttribute("region")],D=l[f.getAttribute("style")],P=Gne(C,D,l),{textAlign:V}=P;if(V){let G=$ne[V];G&&(T.lineAlign=G),T.align=V}return zt(T,P),T}).filter(f=>f!==null)}function wA(n,e,t){let i=n.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function QB(n){return n.reduce((e,t)=>{let i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function w$(n,e){return[].slice.call(n.childNodes).reduce((t,i,r)=>{var s;return i.nodeName==="br"&&r?t+`
`:(s=i.childNodes)!=null&&s.length?w$(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function Gne(n,e,t){let i="http://www.w3.org/ns/ttml#styling",r=null,s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(r=t[o]),s.reduce((a,l)=>{let u=IA(e,i,l)||IA(n,i,l)||IA(r,i,l);return u&&(a[l]=u),a},{})}function IA(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function ZB(n){return new Error(`Could not parse ttml timestamp ${n}`)}function bA(n,e){if(!n)return null;let t=y$(n);return t===null&&(E$.test(n)?t=zne(n,e):T$.test(n)&&(t=Hne(n,e))),t}function zne(n,e){let t=E$.exec(n),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function Hne(n,e){let t=T$.exec(n),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}var jd=class{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}},ND=class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=JB(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(b.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){let{hls:e}=this;e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(b.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){let e=new jd(this,"textTrack1"),t=new jd(this,"textTrack2"),i=new jd(this,"textTrack3"),r=new jd(this,"textTrack4");this.cea608Parser1=new $_(1,e,t),this.cea608Parser2=new $_(3,i,r)}addCues(e,t,i,r,s){let o=!1;for(let a=s.length;a--;){let l=s[a],u=qne(l[0],l[1],t,i);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],i),o=!0,u/(i-t)>.5))return}if(o||s.push([t,i]),this.config.renderTextTracksNatively){let a=this.captionsTracks[e];this.Cues.newCue(a,t,i,r)}else{let a=this.Cues.newCue(null,t,i,r);this.hls.trigger(b.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s,trackId:o}){let{unparsedVttFrags:a}=this;i===De.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:s,trackId:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(b.FRAG_LOADED,l):this.hls.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){let{media:i}=this;if(i)for(let r=0;r<i.textTracks.length;r++){let s=i.textTracks[r];if(XB(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;let{captionsProperties:t,captionsTracks:i,media:r}=this,{label:s,languageCode:o}=t[e],a=this.getExistingTrack(s,o);if(a)i[e]=a,$d(i[e]),f$(i[e],r);else{let l=this.createTextTrack("captions",s,o);l&&(l[e]=!0,i[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;let t=this.captionsProperties[e];if(!t)return;let i=t.label,r={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,i){let r=this.media;if(r)return r.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){let i=!!t.transferMedia;if(this.media=null,i)return;let{captionsTracks:r}=this;Object.keys(r).forEach(s=>{$d(r[s]),delete r[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=JB(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){let{media:e}=this;if(!e)return;let t=e.textTracks;if(t)for(let i=0;i<t.length;i++)$d(t[i])}onSubtitleTracksUpdated(e,t){let i=t.subtitleTracks||[],r=i.some(s=>s.textCodec===TA);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(t$(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){let o=this.media,a=o?y_(o.textTracks):null;if(this.tracks.forEach((l,u)=>{let d;if(a){let f=null;for(let m=0;m<a.length;m++)if(a[m]&&XB(a[m],l)){f=a[m],a[m]=null;break}f&&(d=f)}if(d)$d(d);else{let f=I$(l);d=this.createTextTrack(f,l.name,l.lang),d&&(d.mode="disabled")}d&&this.textTracks.push(d)}),a!=null&&a.length){let l=a.filter(u=>u!==null).map(u=>u.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){let o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{let r=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!r)return;let s=`textTrack${r[1]}`,o=this.captionsProperties[s];o&&(o.label=i.name,i.lang&&(o.languageCode=i.lang),o.media=i)})}closedCaptionsForLevel(e){let t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===De.MAIN){var i,r;let{cea608Parser1:s,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:u}=t.frag,d=(i=(r=t.part)==null?void 0:r.index)!=null?i:-1;s&&o&&(u!==a+1||u===a&&d!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),o.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=d}}onFragLoaded(e,t){let{frag:i,payload:r}=t;if(i.type===De.SUBTITLE)if(r.byteLength){let s=i.decryptdata,o="stats"in t;if(s==null||!s.encrypted||o){let a=this.tracks[i.level],l=this.vttCCs;l[i.cc]||(l[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),a&&a.textCodec===TA?this._parseIMSC1(i,r):this._parseVTTs(t)}}else this.hls.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){let i=this.hls;YB(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),i.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{i.logger.log(`Failed to parse IMSC1: ${r}`),i.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;let{frag:i,payload:r}=e,{initPTS:s,unparsedVttFrags:o}=this,a=s.length-1;if(!s[i.cc]&&a===-1){o.push(e);return}let l=this.hls,u=(t=i.initSegment)!=null&&t.data?Nr(i.initSegment.data,new Uint8Array(r)).buffer:r;Une(u,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,d=>{this._appendCues(d,i.level),l.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},d=>{let f=d.message==="Missing initPTS for VTT MPEGTS";f?o.push(e):this._fallbackToIMSC1(i,r),l.logger.log(`Failed to parse VTT cue: ${d}`),!(f&&a>i.cc)&&l.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:d})})}_fallbackToIMSC1(e,t){let i=this.tracks[e.level];i.textCodec||YB(t,this.initPTS[e.cc],()=>{i.textCodec=TA,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){let i=this.hls;if(this.config.renderTextTracksNatively){let r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(s=>p$(r,s))}else{let r=this.tracks[t];if(!r)return;let s=r.default?"default":"subtitles"+t;i.trigger(b.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){let{frag:i}=t;i.type===De.SUBTITLE&&this.onFragLoaded(b.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;let{frag:i,samples:r}=t;if(!(i.type===De.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let s=0;s<r.length;s++){let o=r[s].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();let a=this.extractCea608Data(o);this.cea608Parser1.addData(r[s].pts,a[0]),this.cea608Parser2.addData(r[s].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:r,type:s}){let{media:o}=this;if(!(!o||o.currentTime<i)){if(!s||s==="video"){let{captionsTracks:a}=this;Object.keys(a).forEach(l=>ED(a[l],t,i))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){let{textTracks:a}=this;Object.keys(a).forEach(l=>ED(a[l],t,r))}}}extractCea608Data(e){let t=[[],[]],i=e[0]&31,r=2;for(let s=0;s<i;s++){let o=e[r++],a=127&e[r++],l=127&e[r++];if(a===0&&l===0)continue;if((4&o)!==0){let d=3&o;(d===0||d===1)&&(t[d].push(a),t[d].push(l))}}return t}};function I$(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function XB(n,e){return!!n&&n.kind===I$(e)&&lD(e,n)}function qne(n,e,t,i){return Math.min(e,i)-Math.max(n,t)}function JB(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}var Wne=/\s/,Kne={newCue(n,e,t,i){let r=[],s,o,a,l,u,d=self.VTTCue||self.TextTrackCue;for(let m=0;m<i.rows.length;m++)if(s=i.rows[m],a=!0,l=0,u="",!s.isEmpty()){var f;for(let E=0;E<s.chars.length;E++)Wne.test(s.chars[E].uchar)&&a?l++:(u+=s.chars[E].uchar,a=!1);s.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;let y=_$(u.trim()),v=c1(e,t,y);n!=null&&(f=n.cues)!=null&&f.getCueById(v)||(o=new d(e,t,y),o.id=v,o.line=m+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),r.push(o))}return n&&r.length&&(r.sort((m,y)=>m.line==="auto"||y.line==="auto"?0:m.line>8&&y.line>8?y.line-m.line:m.line-y.line),r.forEach(m=>p$(n,m))),r}};function Yne(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var Qne=/(\d+)-(\d+)\/(\d+)/,j_=class{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||eie,this.controller=new self.AbortController,this.stats=new Op}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){let r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();let s=Zne(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=l&&Ie(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(zp(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(f=>{var m;this.response=this.loader=f;let y=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},u-(y-r.loading.start)),!f.ok){let{status:E,statusText:T}=f;throw new FD(T||"fetch, bad network response",E,f)}r.loading.first=y,r.total=Jne(f.headers)||r.total;let v=(m=this.callbacks)==null?void 0:m.onProgress;return v&&Ie(t.highWaterMark)?this.loadProgressively(f,r,e,t.highWaterMark,v):o?f.arrayBuffer():e.responseType==="json"?f.json():f.text()}).then(f=>{var m,y;let v=this.response;if(!v)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);let E=f[a];E&&(r.loaded=r.total=E);let T={url:v.url,data:f,code:v.status},C=(m=this.callbacks)==null?void 0:m.onProgress;C&&!Ie(t.highWaterMark)&&C(r,e,f,v),(y=this.callbacks)==null||y.onSuccess(T,r,e,v)}).catch(f=>{var m;if(self.clearTimeout(this.requestTimeout),r.aborted)return;let y=f&&f.code||0,v=f?f.message:null;(m=this.callbacks)==null||m.onError({code:y,text:v},e,f?f.details:null,r)})}getCacheAge(){let e=null;if(this.response){let t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,r=0,s){let o=new M_,a=e.body.getReader(),l=()=>a.read().then(u=>{if(u.done)return o.dataLength&&s(t,i,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));let d=u.value,f=d.length;return t.loaded+=f,f<r||o.dataLength?(o.push(d),o.dataLength>=r&&s(t,i,o.flush().buffer,e)):s(t,i,d.buffer,e),l()}).catch(()=>Promise.reject());return l()}};function Zne(n,e){let t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(zt({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function Xne(n){let e=Qne.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function Jne(n){let e=n.get("Content-Range");if(e){let i=Xne(e);if(Ie(i))return i}let t=n.get("Content-Length");if(t)return parseInt(t)}function eie(n,e){return new self.Request(n.url,e)}var FD=class extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}},tie=/^age:\s*[\d.]+\s*$/im,G_=class{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Op,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){let e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){let{config:e,context:t}=this;if(!e||!t)return;let i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;let s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return s(i,t.url)}).catch(o=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),s(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:i.status,text:o.message},t,i,r)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);let r=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:o}=i.loadPolicy;if(r)for(let a in r)e.setRequestHeader(a,r[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=s&&Ie(s)?s:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){let{context:e,loader:t,stats:i}=this;if(!e||!t)return;let r=t.readyState,s=this.config;if(!i.aborted&&r>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;let u=t.status,d=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){let v=d??t.response;if(v!=null){var o,a;i.loading.end=Math.max(self.performance.now(),i.loading.first);let E=t.responseType==="arraybuffer"?v.byteLength:v.length;i.loaded=i.total=E,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);let T=(o=this.callbacks)==null?void 0:o.onProgress;T&&T(i,e,v,t);let C={url:t.responseURL,data:v,code:u};(a=this.callbacks)==null||a.onSuccess(C,i,e,t);return}}let f=s.loadPolicy.errorRetry,m=i.retry,y={url:e.url,data:void 0,code:u};if(C_(f,m,!1,y))this.retry(f);else{var l;Gt.error(`${u} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:u,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;let e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(C_(e,t,!0))this.retry(e);else{var i;Gt.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);let r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){let{context:t,stats:i}=this;this.retryDelay=ZD(e,i.retry),i.retry++,Gt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){let t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&tie.test(this.loader.getAllResponseHeaders())){let t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}},nie={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},iie=jt(jt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:G_,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:LA,bufferController:hD,capLevelController:fD,errorController:NA,fpsController:_D,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:xU,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:nie},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},rie()),{},{subtitleStreamController:xD,subtitleTrackController:TD,timelineController:ND,audioStreamController:aD,audioTrackController:cD,emeController:Tne,cmcdController:yD,contentSteeringController:vD,interstitialsController:CD});function rie(){return{cueHandler:Kne,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function sie(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');let i=VD(n),r=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(o=>{let a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,u=[];s.forEach(d=>{let f=`${o}Loading${d}`,m=e[f];if(m!==void 0&&l){u.push(f);let y=i[a].default;switch(e[a]={default:y},d){case"TimeOut":y.maxLoadTimeMs=m,y.maxTimeToFirstByteMs=m;break;case"MaxRetry":y.errorRetry.maxNumRetry=m,y.timeoutRetry.maxNumRetry=m;break;case"RetryDelay":y.errorRetry.retryDelayMs=m,y.timeoutRetry.retryDelayMs=m;break;case"MaxRetryTimeout":y.errorRetry.maxRetryDelayMs=m,y.timeoutRetry.maxRetryDelayMs=m;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${a}": ${Qt(e[a])}`)}),jt(jt({},i),e)}function VD(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(VD):Object.keys(n).reduce((e,t)=>(e[t]=VD(n[t]),e),{}):n}function oie(n,e){let t=n.loader;t!==j_&&t!==G_?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):Yne()&&(n.loader=j_,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}var v_=2,aie=.1,lie=.05,cie=100,BD=class extends x_{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(b.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){let{hls:e}=this;e&&(e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){let{hls:e}=this;e&&(e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(cie),this.mediaSource=t.mediaSource;let i=this.media=t.media;Ci(i,"playing",this.onMediaPlaying),Ci(i,"waiting",this.onMediaWaiting),Ci(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();let{media:i}=this;i&&($i(i,"playing",this.onMediaPlaying),$i(i,"waiting",this.onMediaWaiting),$i(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;let t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,r;let s=(i=this.hls)==null?void 0:i.config;if(!s)return;let o=this.media;if(!o)return;let{seeking:a}=o,l=this.seeking&&!a,u=!this.seeking&&a,d=o.paused&&!a||o.ended||o.playbackRate===0;if(this.seeking=a,e!==t){t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!d&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||l){l&&this.stallResolved(e);return}if(d){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(b.MEDIA_ENDED,{stalled:!1}));return}if(!ot.getBuffered(o).length){this.nudgeRetry=0;return}let f=ot.bufferInfo(o,e,0),m=f.nextStart||0,y=this.fragmentTracker;if(a&&y&&this.hls){let H=eU(this.hls.inFlightFragments,e),A=f.len>v_,x=!m||H||m-e>v_&&!y.getPartialFragment(e);if(A||x)return;this.moved=!1}let v=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&y){if(!(f.len>0)&&!m)return;let A=Math.max(m,f.start||0)-e,R=!!(v!=null&&v.live)?v.targetduration*2:v_,M=u_(e,y);if(A>0&&(A<=R||M)){o.paused||this._trySkipBufferHole(M);return}}let E=s.detectStallWithCurrentTimeMs,T=self.performance.now(),C=this.waiting,D=this.stalled;if(D===null)if(C>0&&T-C<E)D=this.stalled=C;else{this.stalled=T;return}let P=T-D;if(!a&&(P>=E||C)&&this.hls){var V;if(((V=this.mediaSource)==null?void 0:V.readyState)==="ended"&&!(v!=null&&v.live)&&Math.abs(e-(v?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(b.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(f),!this.media||!this.hls)return}let G=ot.bufferInfo(o,e,s.maxBufferHole);this._tryFixBufferStall(G,P,e)}stallResolved(e){let t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){let i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(b.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;let r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&r&&r.length>1&&e>r.end(0)){let s=ot.bufferedInfo(ot.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){let o=ot.timeRangesToArray(r),a=ot.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){let l=ot.bufferedInfo(o,e,0).bufferedIndex,u=o[a].end,d=o[a+1].start;if((l===-1||l>a)&&d-u<1&&e-u<2){let f=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${d} buffered index: ${l}`);this.warn(f.message),this.media.currentTime+=1e-6;let m=u_(e,this.fragmentTracker);m&&"fragment"in m?m=m.fragment:m||(m=void 0);let y=ot.bufferInfo(this.media,e,0);this.hls.trigger(b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:f,reason:f.message,frag:m,buffer:y.len,bufferInfo:y})}}}}}_tryFixBufferStall(e,t,i){var r,s;let{fragmentTracker:o,media:a}=this,l=(r=this.hls)==null?void 0:r.config;if(!a||!o||!l)return;let u=(s=this.hls)==null?void 0:s.latestLevelDetails,d=u_(i,o);if((d||u!=null&&u.live&&i<u.fragmentStart)&&(this._trySkipBufferHole(d)||!this.media))return;let f=e.buffered,m=this.adjacentTraversal(e,i);(f&&f.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-i<l.maxBufferHole||m))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){let i=this.fragmentTracker,r=e.nextStart;if(i&&r){let s=i.getFragAtPos(t,De.MAIN),o=i.getFragAtPos(r,De.MAIN);if(s&&o)return o.sn-s.sn<2}return!1}_reportStall(e){let{hls:t,media:i,stallReported:r,stalled:s}=this;if(!r&&s!==null&&i&&t){this.stallReported=!0;let o=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${Qt(e)})`);this.warn(o.message),t.trigger(b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;let{fragmentTracker:i,media:r}=this,s=(t=this.hls)==null?void 0:t.config;if(!r||!i||!s)return 0;let o=r.currentTime,a=ot.bufferInfo(r,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){let d=a.len<=s.maxBufferHole,f=a.len>0&&a.len<1&&r.readyState<3,m=l-o;if(m>0&&(d||f)){if(m>s.maxBufferHole){let v=!1;if(o===0){let E=i.getAppendedFrag(0,De.MAIN);E&&l<E.end&&(v=!0)}if(!v&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||eU(this.hls.inFlightFragments,l))return 0;let T=!1,C=e.end;for(;C<l;){let D=u_(C,i);if(D)C+=D.duration;else{T=!0;break}}if(T)return 0}}let y=Math.max(l+lie,o+aie);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${y}`),this.moved=!0,r.currentTime=y,!(e!=null&&e.gap)){let v=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${y}`),E={type:Oe.MEDIA_ERROR,details:Q.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:v,reason:v.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?E.part=e:E.frag=e),this.hls.trigger(b.ERROR,E)}return y}}return 0}_tryNudgeBuffer(e){let{hls:t,media:i,nudgeRetry:r}=this,s=t?.config;if(!i||!s)return 0;let o=i.currentTime;if(this.nudgeRetry++,r<s.nudgeMaxRetry){let a=o+(r+1)*s.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),i.currentTime=a,t.trigger(b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{let a=new Error(`Playhead still not moving while enough data buffered @${o} after ${s.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}};function eU(n,e){let t=tU(n.main);if(t&&t.start<=e)return t;let i=tU(n.audio);return i&&i.start<=e?i:null}function tU(n){if(!n)return null;switch(n.state){case re.IDLE:case re.STOPPED:case re.ENDED:case re.ERROR:return null}return n.frag}function u_(n,e){return e.getAppendedFrag(n,De.MAIN)||e.getPartialFragment(n)}var uie=.25;function UD(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function SA(n,e,t,i,r){let s=new n(e,t,"");try{s.value=i,r&&(s.type=r)}catch{s=new n(e,t,Qt(r?jt({type:r},i):i))}return s}var d_=(()=>{let n=UD();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})(),$D=class{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(b.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){let{hls:e}=this;e&&(e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){let{hls:e}=this;e&&(e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;let t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&$d(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){let t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){let i=e[t];if(i.kind==="metadata"&&i.label==="id3")return f$(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;let{enableEmsgMetadataCues:i,enableID3MetadataCues:r}=this.hls.config;if(!i&&!r)return;let{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));let o=UD();if(o)for(let a=0;a<s.length;a++){let l=s[a].type;if(l===pr.emsg&&!i||!r)continue;let u=zU(s[a].data),d=s[a].pts,f=d+s[a].duration;f>d_&&(f=d_),f-d<=0&&(f=d+uie);for(let y=0;y<u.length;y++){let v=u[y];if(!HU(v)){this.updateId3CueEnds(d,l);let E=SA(o,d,f,v,l);E&&this.id3Track.addCue(E)}}}}updateId3CueEnds(e,t){var i;let r=(i=this.id3Track)==null?void 0:i.cues;if(r)for(let s=r.length;s--;){let o=r[s];o.type===t&&o.startTime<e&&o.endTime===d_&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:r}){let{id3Track:s,hls:o}=this;if(!o)return;let{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(s&&(a||l)){let u;r==="audio"?u=d=>d.type===pr.audioId3&&l:r==="video"?u=d=>d.type===pr.emsg&&a:u=d=>d.type===pr.audioId3&&l||d.type===pr.emsg&&a,ED(s,t,i,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;let{assetPlayerId:i,timelineOffset:r,enableDateRangeMetadataCues:s,interstitialsController:o}=this.hls.config;if(!s)return;let a=UD();if(i&&r&&!o){let{fragmentStart:E,fragmentEnd:T}=e,C=this.assetCue;C?(C.startTime=E,C.endTime=T):a&&(C=this.assetCue=SA(a,E,T,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),C&&(C.id=i,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(C),C.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;let{id3Track:l}=this,{dateRanges:u}=e,d=Object.keys(u),f=this.dateRangeCuesAppended;if(l&&t){var m;if((m=l.cues)!=null&&m.length){let E=Object.keys(f).filter(T=>!d.includes(T));for(let T=E.length;T--;){var y;let C=E[T],D=(y=f[C])==null?void 0:y.cues;delete f[C],D&&Object.keys(D).forEach(P=>{let V=D[P];if(V){V.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(V)}catch{}}})}}else f=this.dateRangeCuesAppended={}}let v=e.fragments[e.fragments.length-1];if(!(d.length===0||!Ie(v?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let E=0;E<d.length;E++){let T=d[E],C=u[T],D=C.startTime,P=f[T],V=P?.cues||{},G=P?.durationKnown||!1,H=d_,{duration:A,endDate:x}=C;if(x&&A!==null)H=D+A,G=!0;else if(C.endOnNext&&!G){let M=d.reduce((F,j)=>{if(j!==C.id){let B=u[j];if(B.class===C.class&&B.startDate>C.startDate&&(!F||C.startDate<F.startDate))return B}return F},null);M&&(H=M.startTime,G=!0)}let R=Object.keys(C.attr);for(let M=0;M<R.length;M++){let F=R[M];if(!pee(F))continue;let j=V[F];if(j)G&&!(P!=null&&P.durationKnown)?j.endTime=H:Math.abs(j.startTime-D)>.01&&(j.startTime=D,j.endTime=H);else if(a){let B=C.attr[F];mee(F)&&(B=sU(B));let Ee=SA(a,D,H,{key:F,data:B},pr.dateRange);Ee&&(Ee.id=T,this.id3Track.addCue(Ee),V[F]=Ee,o&&(F==="X-ASSET-LIST"||F==="X-ASSET-URL")&&Ee.addEventListener("enter",this.onEventCueEnter))}}f[T]={cues:V,dateRange:C,durationKnown:G}}}}},jD=class{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{let{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;let r=this.computeLatency();if(r===null)return;this._latency=r;let{lowLatencyMode:s,maxLiveSyncPlaybackRate:o}=this.config;if(!s||o===1||!i.live)return;let a=this.targetLatency;if(a===null)return;let l=r-a,u=Math.min(this.maxLatency,a+i.targetduration);if(l<u&&l>.05&&this.forwardBufferLength>1){let f=Math.min(2,Math.max(1,o)),m=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,y=Math.min(f,Math.max(1,m));this.changeMediaPlaybackRate(t,y)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){let{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;let t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){let e=this.levelDetails;if(e===null||this.hls===null)return null;let{holdBack:t,partHoldBack:i,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig,u=a&&i||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=s!==void 0?s:o*r);let d=r;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,d)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){let e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;let i=this.levelDetails;if(i===null)return null;let r=i.edge,s=e-t-this.edgeStalled,o=r-i.totalduration,a=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(o,s),a)}get drift(){let e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){let e=this.levelDetails;if(e===null)return 0;let t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){let{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;let i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){let{hls:e}=this;e&&(e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.ERROR,this.onError,this))}unregisterListeners(){let{hls:e}=this;e&&(e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===Q.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,r;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){let e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){let e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}},GD=class extends Hp{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.ERROR,this.onError,this)}_unregisterListeners(){let{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){let i=this.hls.config.preferManagedMediaSource,r=[],s={},o={},a=!1,l=!1,u=!1;t.levels.forEach(d=>{let f=d.attrs,{audioCodec:m,videoCodec:y}=d;m&&(d.audioCodec=m=T_(m,i)||void 0),y&&(y=d.videoCodec=VJ(y));let{width:v,height:E,unknownCodecs:T}=d,C=T?.length||0;if(a||(a=!!(v&&E)),l||(l=!!y),u||(u=!!m),C||m&&!this.isAudioSupported(m)||y&&!this.isVideoSupported(y)){this.log(`Some or all CODECS not supported "${f.CODECS}"`);return}let{CODECS:D,"FRAME-RATE":P,"HDCP-LEVEL":V,"PATHWAY-ID":G,RESOLUTION:H,"VIDEO-RANGE":A}=f,R=`${`${G||"."}-`}${d.bitrate}-${H}-${P}-${D}-${A}-${V}`;if(s[R])if(s[R].uri!==d.url&&!d.attrs["PATHWAY-ID"]){let M=o[R]+=1;d.attrs["PATHWAY-ID"]=new Array(M+1).join(".");let F=this.createLevel(d);s[R]=F,r.push(F)}else s[R].addGroupId("audio",f.AUDIO),s[R].addGroupId("text",f.SUBTITLES);else{let M=this.createLevel(d);s[R]=M,o[R]=1,r.push(M)}}),this.filterAndSortMediaOptions(r,t,a,l,u)}createLevel(e){let t=new Vc(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){let r=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(r.message),t.supportedResult=gU(r,[])}return t}isAudioSupported(e){return Np(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Np(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,r,s){var o;let a=[],l=[],u=e,d=((o=t.stats)==null?void 0:o.parsing)||{};if((i||r)&&s&&(u=u.filter(({videoCodec:D,videoRange:P,width:V,height:G})=>(!!D||!!(V&&G))&&KJ(P))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let D="no level with compatible codecs found in manifest",P=D;t.levels.length&&(P=`one or more CODECS in variant not supported: ${Qt(t.levels.map(G=>G.attrs.CODECS).filter((G,H,A)=>A.indexOf(G)===H))}`,this.warn(P),D+=` (${P})`);let V=new Error(D);this.hls.trigger(b.ERROR,{type:Oe.MEDIA_ERROR,details:Q.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:V,reason:P})}}),d.end=performance.now();return}t.audioTracks&&(a=t.audioTracks.filter(D=>!D.audioCodec||this.isAudioSupported(D.audioCodec)),nU(a)),t.subtitles&&(l=t.subtitles,nU(l));let f=u.slice(0);u.sort((D,P)=>{if(D.attrs["HDCP-LEVEL"]!==P.attrs["HDCP-LEVEL"])return(D.attrs["HDCP-LEVEL"]||"")>(P.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&D.height!==P.height)return D.height-P.height;if(D.frameRate!==P.frameRate)return D.frameRate-P.frameRate;if(D.videoRange!==P.videoRange)return w_.indexOf(D.videoRange)-w_.indexOf(P.videoRange);if(D.videoCodec!==P.videoCodec){let V=XV(D.videoCodec),G=XV(P.videoCodec);if(V!==G)return G-V}if(D.uri===P.uri&&D.codecSet!==P.codecSet){let V=E_(D.codecSet),G=E_(P.codecSet);if(V!==G)return G-V}return D.averageBitrate!==P.averageBitrate?D.averageBitrate-P.averageBitrate:0});let m=f[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==f.length)){for(let D=0;D<f.length;D++)if(f[D].pathwayId===u[0].pathwayId){m=f[D];break}}this._levels=u;for(let D=0;D<u.length;D++)if(u[D]===m){var y;this._firstLevel=D;let P=m.bitrate,V=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${P}`),((y=this.hls.userConfig)==null?void 0:y.abrEwmaDefaultEstimate)===void 0){let G=Math.min(P,this.hls.config.abrEwmaDefaultEstimateMax);G>V&&V===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=G)}break}let v=s&&!r,E=this.hls.config,T=!!(E.audioStreamController&&E.audioTrackController),C={levels:u,audioTracks:a,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:r,altAudio:T&&!v&&a.some(D=>!!D.url)};d.end=performance.now(),this.hls.trigger(b.MANIFEST_PARSED,C)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){let t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){let d=new Error("invalid level idx"),f=e<0;if(this.hls.trigger(b.ERROR,{type:Oe.OTHER_ERROR,details:Q.LEVEL_SWITCH_ERROR,level:e,fatal:f,error:d,reason:d.message}),f)return;e=Math.min(e,t.length-1)}let i=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,i===e&&r&&s===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${i}${s?" with Pathway "+s:""}`);let l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(b.LEVEL_SWITCHING,l);let u=o.details;if(!u||u.live){let d=this.switchParams(o.uri,r?.details,u);this.loadPlaylist(d)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){let e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){let t=this.steering.pathways(),i=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===mt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===De.MAIN){let i=t.elementaryStreams;if(!Object.keys(i).some(s=>!!i[s]))return;let r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var i;let{level:r,details:s}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${r}`),(a=t.deliveryDirectives)!=null&&a.skip&&(s.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(r,t,l)}else(i=t.deliveryDirectives)!=null&&i.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);let i=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],o=e.details,a=o?.age;this.log(`Loading level index ${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(b.LEVEL_LOADING,{url:i,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;let i=this._levels.filter((s,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(a=>a.level=-1)),!1));OU(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);let r=i.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(b.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){let{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(b.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}};function nU(n){let e={};n.forEach(t=>{let i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function b$(){return self.SourceBuffer||self.WebKitSourceBuffer}function S$(){if(!al())return!1;let e=b$();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function die(){if(!S$())return!1;let n=al();return typeof n?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Fp(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Fp(e,"audio"))))}function hie(){var n;let e=b$();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}var fie=100,zD=class extends Up{constructor(e,t,i){super(e,t,i,"stream-controller",De.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{let r=this.media,s=r?r.currentTime:null;if(s===null||!Ie(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;let o=this.getFwdBufferInfoAtPos(r,s,De.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();let{hls:e}=this;e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();let{hls:e}=this;e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){let{lastCurrentTime:i,hls:r}=this;if(this.stopLoad(),this.setInterval(fie),this.level=-1,!this.startFragRequested){let s=r.startLevel;s===-1&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.firstAutoLevel),r.nextLoadLevel=s,this.level=r.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=re.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=re.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case re.WAITING_LEVEL:{let{levels:e,level:t}=this,i=e?.[t],r=i?.details;if(r&&(!r.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(r))break;this.state=re.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=re.IDLE;break}break}case re.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===re.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){let{hls:e,levelLastLoaded:t,levels:i,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;let s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[s]))return;let o=i[s],a=this.getMainFwdBufferInfo();if(a===null)return;let l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){let E={};this.altAudio===2&&(E.type="video"),this.hls.trigger(b.BUFFER_EOS,E),this.state=re.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;let u=o.details;if(!u||this.state===re.WAITING_LEVEL||this.waitForLive(o)){this.level=s,this.state=re.WAITING_LEVEL,this.startFragRequested=!1;return}let d=a.len,f=this.getMaxBufferLength(o.maxBitrate);if(d>=f)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);let m=this.backtrackFragment?this.backtrackFragment.start:a.end,y=this.getNextFragment(m,u);if(this.couldBacktrack&&!this.fragPrevious&&y&&In(y)&&this.fragmentTracker.getState(y)!==jn.OK){var v;let T=((v=this.backtrackFragment)!=null?v:y).sn-u.startSN,C=u.fragments[T-1];C&&y.cc===C.cc&&(y=C,this.fragmentTracker.removeFragment(C))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(y&&this.isLoopLoading(y,m)){if(!y.gap){let T=this.audioOnly&&!this.altAudio?Yt.AUDIO:Yt.VIDEO,C=(T===Yt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;C&&this.afterBufferFlushed(C,T,De.MAIN)}y=this.getNextFragmentLoopLoading(y,u,a,De.MAIN,f)}y&&(y.initSegment&&!y.initSegment.data&&!this.bitrateTest&&(y=y.initSegment),this.loadFragment(y,o,m))}loadFragment(e,t,i){let r=this.fragmentTracker.getState(e);r===jn.NOT_LOADED||r===jn.PARTIAL?In(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,De.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){let{levels:e,media:t}=this;if(t!=null&&t.readyState){let i,r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);let s=this.getLevelDetails();if(s!=null&&s.live){let a=this.getMainFwdBufferInfo();if(!a||a.len<s.targetduration*2)return}if(!t.paused&&e){let a=this.hls.nextLoadLevel,l=e[a],u=this.fragLastKbps;u&&this.fragCurrent?i=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:i=0}else i=0;let o=this.getBufferedFrag(t.currentTime+i);if(o){let a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();let l=a.maxStartPTS?a.maxStartPTS:a.start,u=a.duration,d=Math.max(o.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(d,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){let e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case re.KEY_LOADING:case re.FRAG_LOADING:case re.FRAG_LOADING_WAITING_RETRY:case re.PARSING:case re.PARSED:this.state=re.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);let i=t.media;Ci(i,"playing",this.onMediaPlaying),Ci(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){let{media:i}=this;i&&($i(i,"playing",this.onMediaPlaying),$i(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,r=!1;for(let s=0;s<t.levels.length;s++){let o=t.levels[s].audioCodec;o&&(i=i||o.indexOf("mp4a.40.2")!==-1,r=r||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=i&&r&&!hie(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){let{levels:i}=this;if(!i||this.state!==re.IDLE)return;let r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=re.WAITING_LEVEL)}onLevelLoaded(e,t){var i;let{levels:r,startFragRequested:s}=this,o=t.level,a=t.details,l=a.totalduration;if(!r){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);let u=t.levelInfo,d=this.fragCurrent;d&&(this.state===re.FRAG_LOADING||this.state===re.FRAG_LOADING_WAITING_RETRY)&&d.level!==t.level&&d.loader&&this.abortCurrentFrag();let f=0;if(a.live||(i=u.details)!=null&&i.live){var m;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;f=this.alignPlaylists(a,u.details,(m=this.levelLastLoaded)==null?void 0:m.details)}if(u.details=a,this.levelLastLoaded=u,s||this.setStartPosition(a,f),this.hls.trigger(b.LEVEL_UPDATED,{details:a,level:o}),this.state===re.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=re.IDLE}s&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){let{config:t,media:i}=this;if(!i)return;let r=this.hls.liveSyncPosition,s=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=s>=o-t.maxFragLookUpTolerance&&s<=a;if(r!==null&&i.duration>r&&(s<r||!l)){let d=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&i.readyState<4||s<a-d)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),i.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;let f=ot.bufferInfo(i,r,0);if(!((u=f.buffered)!=null&&u.length)){i.currentTime=r;return}if(f.start<=s){i.currentTime=r;return}let{nextStart:y}=ot.bufferedInfo(f.buffered,s,0);y&&(i.currentTime=y)}else i.currentTime=r}}_handleFragmentLoadProgress(e){var t;let i=e.frag,{part:r,payload:s}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}let a=o[i.level];if(!a){this.warn(`Level ${i.level} not found on progress`);return}let l=a.details;if(!l){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}let u=a.videoCodec,d=l.PTSKnown||!l.live,f=(t=i.initSegment)==null?void 0:t.data,m=this._getAudioCodec(a),y=this.transmuxer=this.transmuxer||new N_(this.hls,De.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),v=r?r.index:-1,E=v!==-1,T=new Bp(i.level,i.sn,i.stats.chunkCount,s.byteLength,v,E),C=this.initPTS[i.cc];y.push(s,f,m,u,i,r,l.totalduration,d,T,C)}onAudioTrackSwitching(e,t){let i=this.hls,r=this.altAudio!==0;if(b_(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;let o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.altAudio=0,this.fragmentTracker.removeAllFragments(),i.once(b.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(b.AUDIO_TRACK_SWITCHED,t)}),i.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(b.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){let i=b_(t.url,this.hls);if(i){let r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){let i=t.tracks,r,s,o=!1;for(let a in i){let l=i[a];if(l.id==="main"){if(s=a,r=l,a==="video"){let u=i[a];u&&(this.videoBuffer=u.buffer)}}else o=!0}o&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){let{frag:i,part:r}=t,s=i.type===De.MAIN;if(s){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===re.PARSED&&(this.state=re.IDLE);return}let a=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),In(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}let o=this.media;o&&(!this._hasEnoughToStart&&ot.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=re.ERROR;return}switch(t.details){case Q.FRAG_GAP:case Q.FRAG_PARSING_ERROR:case Q.FRAG_DECRYPT_ERROR:case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(De.MAIN,t);break;case Q.LEVEL_LOAD_ERROR:case Q.LEVEL_LOAD_TIMEOUT:case Q.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===re.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===mt.LEVEL&&(this.state=re.IDLE);break;case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Q.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Q.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=re.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Yt.AUDIO||!this.altAudio){let i=(t===Yt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,De.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){let{media:e}=this;if(!e)return;let t=e.currentTime,i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}let r=this.timelineOffset;r&&i&&(i+=r);let s=this.getLevelDetails(),o=ot.getBuffered(e),a=o.length?o.start(0):0,l=a-i,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<u||this.loadingParts&&l<2*(s?.partTarget||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),i+=l,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${a}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{let{hls:r}=this,s=i?.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=re.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;let o=s.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),r.trigger(b.FRAG_LOADED,i),s.bitrateTest=!1}).catch(i=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){let t=this.playlistType,{hls:i}=this,{remuxResult:r,chunkMeta:s}=e,o=this.getCurrentContext(s);if(!o){this.resetWhenMissingContext(s);return}let{frag:a,part:l,level:u}=o,{video:d,text:f,id3:m,initSegment:y}=r,{details:v}=u,E=this.altAudio?void 0:r.audio;if(this.fragContextChanged(a)){this.fragmentTracker.removeFragment(a);return}if(this.state=re.PARSING,y){let T=y.tracks;if(T){let V=a.initSegment||a;if(this.unhandledEncryptionError(y,a))return;this._bufferInitSegment(u,T,V,s),i.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:V,id:t,tracks:T})}let C=y.initPTS,D=y.timescale,P=this.initPTS[a.cc];if(Ie(C)&&(!P||P.baseTime!==C||P.timescale!==D)){let V=y.trackId;this.initPTS[a.cc]={baseTime:C,timescale:D,trackId:V},i.trigger(b.INIT_PTS_FOUND,{frag:a,id:t,initPTS:C,timescale:D,trackId:V})}}if(d&&v){E&&d.type==="audiovideo"&&this.logMuxedErr(a);let T=v.fragments[a.sn-1-v.startSN],C=a.sn===v.startSN,D=!T||a.cc>T.cc;if(r.independent!==!1){let{startPTS:P,endPTS:V,startDTS:G,endDTS:H}=d;if(l)l.elementaryStreams[d.type]={startPTS:P,endPTS:V,startDTS:G,endDTS:H};else if(d.firstKeyFrame&&d.independent&&s.id===1&&!D&&(this.couldBacktrack=!0),d.dropped&&d.independent){let A=this.getMainFwdBufferInfo(),x=(A?A.end:this.getLoadPosition())+this.config.maxBufferHole,R=d.firstKeyFramePTS?d.firstKeyFramePTS:P;if(!C&&x<R-this.config.maxBufferHole&&!D){this.backtrack(a);return}else D&&(a.gap=!0);a.setElementaryStreamInfo(d.type,a.start,V,a.start,H,!0)}else C&&P-(v.appliedTimelineOffset||0)>v_&&(a.gap=!0);a.setElementaryStreamInfo(d.type,P,V,G,H),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(d,a,l,s,C||D)}else if(C||D)a.gap=!0;else{this.backtrack(a);return}}if(E){let{startPTS:T,endPTS:C,startDTS:D,endDTS:P}=E;l&&(l.elementaryStreams[Yt.AUDIO]={startPTS:T,endPTS:C,startDTS:D,endDTS:P}),a.setElementaryStreamInfo(Yt.AUDIO,T,C,D,P),this.bufferFragmentData(E,a,l,s)}if(v&&m!=null&&m.samples.length){let T={id:t,frag:a,details:v,samples:m.samples};i.trigger(b.FRAG_PARSING_METADATA,T)}if(v&&f){let T={id:t,frag:a,details:v,samples:f.samples};i.trigger(b.FRAG_PARSING_USERDATA,T)}}logMuxedErr(e){this.warn(`${In(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,r){if(this.state!==re.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));let{audio:s,video:o,audiovideo:a}=t;if(s){let u=e.audioCodec,d=h_(s.codec,u);d==="mp4a"&&(d="mp4a.40.5");let f=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){d&&(d.indexOf("mp4a.40.5")!==-1?d="mp4a.40.2":d="mp4a.40.5");let m=s.metadata;m&&"channelCount"in m&&(m.channelCount||1)!==1&&f.indexOf("firefox")===-1&&(d="mp4a.40.5")}d&&d.indexOf("mp4a.40.5")!==-1&&f.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(d="mp4a.40.2",this.log(`Android: force audio codec to ${d}`)),u&&u!==d&&this.log(`Swapping manifest audio codec "${u}" for "${d}"`),s.levelCodec=d,s.id=De.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${d||""}/${u||""}/${s.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=De.MAIN;let u=o.codec;if(u?.length===4)switch(u){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${o.codec!==u?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);let l=Object.keys(t);if(l.length){if(this.hls.trigger(b.BUFFER_CODECS,t),!this.hls)return;l.forEach(u=>{let f=t[u].initSegment;f!=null&&f.byteLength&&this.hls.trigger(b.BUFFER_APPENDING,{type:u,data:f,frag:i,part:null,chunkMeta:r,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){let e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,De.MAIN)}get maxBufferLength(){let{levels:e,level:t}=this,i=e?.[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=re.IDLE}checkFragmentChanged(){let e=this.media,t=null;if(e&&e.readyState>1&&e.seeking===!1){let i=e.currentTime;if(ot.isBuffered(e,i)?t=this.getAppendedFrag(i):ot.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;let r=this.fragPlaying,s=t.level;(!r||t.sn!==r.sn||r.level!==s)&&(this.fragPlaying=t,this.hls.trigger(b.FRAG_CHANGED,{frag:t}),(!r||r.level!==s)&&this.hls.trigger(b.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){let e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;let t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Ie(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;let t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Ie(t)){let i=this.getLevelDetails(),r=this.currentFrag||(i?Bc(null,i.fragments,t):null);if(r){let s=r.programDateTime;if(s!==null){let o=s+(t-r.start)*1e3;return new Date(o)}}}return null}get currentLevel(){let e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){let e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}},HD=class extends ji{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(let i in this.keyIdToKeyInfo){let r=this.keyIdToKeyInfo[i].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(let e in this.keyIdToKeyInfo){let t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(let e in this.keyIdToKeyInfo){let t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=Q.KEY_LOAD_ERROR,i,r,s){return new os({type:Oe.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:i,networkDetails:r})}loadClear(e,t,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,s=t.length;r<s;r++){let o=t[r];if(e.cc<=o.cc&&(!In(e)||!In(o)||e.sn<o.sn)||!i&&r==s-1)return this.emeController.selectKeySystemFormat(o).then(a=>{if(!this.emeController)return;o.setKeyFormat(a);let l=p_(a);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){let r=Pp(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,r;t&&e.setKeyFormat(t);let s=e.decryptdata;if(!s){let u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,u))}let o=s.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let a=CA(s),l=this.keyIdToKeyInfo[a];if((i=l)!=null&&i.decryptdata.key)return s.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(r=l)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(d=>{let{keyInfo:f}=d;return s.key=f.decryptdata.key,{frag:e,keyInfo:f}})}switch(this.log(`${this.keyIdToKeyInfo[a]?"Rel":"L"}oading${s.keyId?" keyId: "+si(s.keyId):""} URI: ${s.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){let i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&(r=t.initSegment)!=null&&r.data){let o=CJ(t.initSegment.data);if(o.length){let a=o[0];a.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${si(a)}`),Kd.setKeyIdForUri(e.decryptdata.uri,a)):(a=Kd.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${si(a)}`)),e.decryptdata.keyId=a}}if(!e.decryptdata.keyId&&!In(t))return Promise.resolve(i);let s=this.emeController.loadKey(i);return(e.keyLoadPromise=s.then(o=>(e.mediaKeySessionContext=o,i))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(i)}loadKeyHTTP(e,t){let i=this.config,r=i.loader,s=new r(i);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((o,a)=>{let l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=i.keyLoadPolicy.default,d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(m,y,v,E)=>{let{frag:T,keyInfo:C}=v,D=CA(C.decryptdata);if(!T.decryptdata||C!==this.keyIdToKeyInfo[D])return a(this.createKeyLoadError(T,Q.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),E));C.decryptdata.key=T.decryptdata.key=new Uint8Array(m.data),T.keyLoader=null,C.loader=null,o({frag:T,keyInfo:C})},onError:(m,y,v,E)=>{this.resetLoader(y),a(this.createKeyLoadError(t,Q.KEY_LOAD_ERROR,new Error(`HTTP Error ${m.code} loading key ${m.text}`),v,jt({url:l.url,data:void 0},m)))},onTimeout:(m,y,v)=>{this.resetLoader(y),a(this.createKeyLoadError(t,Q.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),v))},onAbort:(m,y,v)=>{this.resetLoader(y),a(this.createKeyLoadError(t,Q.INTERNAL_ABORTED,new Error("key loading aborted"),v))}};s.load(l,d,f)})}resetLoader(e){let{frag:t,keyInfo:i,url:r}=e,s=i.loader;t.keyLoader===s&&(t.keyLoader=null,i.loader=null);let o=CA(i.decryptdata)||r;delete this.keyIdToKeyInfo[o],s&&s.destroy()}};function CA(n){if(n.keyFormat!==oi.FAIRPLAY){let e=n.keyId;if(e)return si(e)}return n.uri}function iU(n){let{type:e}=n;switch(e){case mt.AUDIO_TRACK:return De.AUDIO;case mt.SUBTITLE_TRACK:return De.SUBTITLE;default:return De.MAIN}}function xA(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}var qD=class{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){let{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){let{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){let t=this.hls.config,i=t.pLoader,r=t.loader,s=i||r,o=new s(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(let e in this.loaders){let t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){let{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:mt.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){let{id:i,level:r,pathwayId:s,url:o,deliveryDirectives:a,levelInfo:l}=t;this.load({id:i,level:r,pathwayId:s,responseType:"text",type:mt.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,t){let{id:i,groupId:r,url:s,deliveryDirectives:o,track:a}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:mt.AUDIO_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){let{id:i,groupId:r,url:s,deliveryDirectives:o,track:a}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:mt.SUBTITLE_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){let i=this.loaders[mt.LEVEL];if(i){let r=i.context;r&&!t.levels.some(s=>s===r.levelOrTrack)&&(i.abort(),delete this.loaders[mt.LEVEL])}}load(e){var t;let i=this.hls.config,r=this.getInternalLoader(e);if(r){let u=this.hls.logger,d=r.context;if(d&&d.levelOrTrack===e.levelOrTrack&&(d.url===e.url||d.deliveryDirectives&&!e.deliveryDirectives)){d.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${d.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let s;if(e.type===mt.MANIFEST?s=i.manifestLoadPolicy.default:s=zt({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),Ie((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===mt.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===mt.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===mt.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){let d=u.partTarget,f=u.targetduration;if(d&&f){let m=Math.max(d*3,f*.8)*1e3;s=zt({},s,{maxTimeToFirstByteMs:Math.min(m,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(m,s.maxTimeToFirstByteMs)})}}}let o=s.errorRetry||s.timeoutRetry||{},a={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(u,d,f,m)=>{let y=this.getInternalLoader(f);this.resetInternalLoader(f.type);let v=u.data;d.parsing.start=performance.now(),Oc.isMediaPlaylist(v)||f.type!==mt.MANIFEST?this.handleTrackOrLevelPlaylist(u,d,f,m||null,y):this.handleMasterPlaylist(u,d,f,m)},onError:(u,d,f,m)=>{this.handleNetworkError(d,f,!1,u,m)},onTimeout:(u,d,f)=>{this.handleNetworkError(d,f,!0,void 0,u)}};r.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;let{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,r){let s=this.hls,o=e.data,a=xA(e,i),l=Oc.parseMasterPlaylist(o,a);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,i,l.playlistParsingError,r,t);return}let{contentSteering:u,levels:d,sessionData:f,sessionKeys:m,startTimeOffset:y,variableList:v}=l;this.variableList=v,d.forEach(D=>{let{unknownCodecs:P}=D;if(P){let{preferManagedMediaSource:V}=this.hls.config,{audioCodec:G,videoCodec:H}=D;for(let A=P.length;A--;){let x=P[A];Np(x,"audio",V)?(D.audioCodec=G=G?`${G},${x}`:x,Wd.audio[G.substring(0,4)]=2,P.splice(A,1)):Np(x,"video",V)&&(D.videoCodec=H=H?`${H},${x}`:x,Wd.video[H.substring(0,4)]=2,P.splice(A,1))}}});let{AUDIO:E=[],SUBTITLES:T,"CLOSED-CAPTIONS":C}=Oc.parseMasterPlaylistMedia(o,a,l);E.length&&!E.some(P=>!P.url)&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),E.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new hn({}),bitrate:0,url:""})),s.trigger(b.MANIFEST_LOADED,{levels:d,audioTracks:E,subtitles:T,captions:C,contentSteering:u,url:a,stats:t,networkDetails:r,sessionData:f,sessionKeys:m,startTimeOffset:y,variableList:v})}handleTrackOrLevelPlaylist(e,t,i,r,s){let o=this.hls,{id:a,level:l,type:u}=i,d=xA(e,i),f=Ie(l)?l:Ie(a)?a:0,m=iU(i),y=Oc.parseLevelPlaylist(e.data,d,f,m,0,this.variableList);if(u===mt.MANIFEST){let v={attrs:new hn({}),bitrate:0,details:y,name:"",url:d};y.requestScheduled=t.loading.start+MU(y,0),o.trigger(b.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:d,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=y,this.handlePlaylistLoaded(y,e,t,i,r,s)}handleManifestParsingError(e,t,i,r,s){this.hls.trigger(b.ERROR,{type:Oe.NETWORK_ERROR,details:Q.MANIFEST_PARSING_ERROR,fatal:t.type===mt.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:r,stats:s})}handleNetworkError(e,t,i=!1,r,s){let o=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===mt.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===mt.AUDIO_TRACK||e.type===mt.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);let a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=Q.UNKNOWN,u=!1,d=this.getInternalLoader(e);switch(e.type){case mt.MANIFEST:l=i?Q.MANIFEST_LOAD_TIMEOUT:Q.MANIFEST_LOAD_ERROR,u=!0;break;case mt.LEVEL:l=i?Q.LEVEL_LOAD_TIMEOUT:Q.LEVEL_LOAD_ERROR,u=!1;break;case mt.AUDIO_TRACK:l=i?Q.AUDIO_TRACK_LOAD_TIMEOUT:Q.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case mt.SUBTITLE_TRACK:l=i?Q.SUBTITLE_TRACK_LOAD_TIMEOUT:Q.SUBTITLE_LOAD_ERROR,u=!1;break}d&&this.resetInternalLoader(e.type);let f={type:Oe.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:d,context:e,error:a,networkDetails:t,stats:s};if(r){let m=t?.url||e.url;f.response=jt({url:m,data:void 0},r)}this.hls.trigger(b.ERROR,f)}handlePlaylistLoaded(e,t,i,r,s,o){let a=this.hls,{type:l,level:u,levelOrTrack:d,id:f,groupId:m,deliveryDirectives:y}=r,v=xA(t,r),E=iU(r),T=typeof r.level=="number"&&E===De.MAIN?u:void 0,C=e.playlistParsingError;if(C){if(this.hls.logger.warn(`${C} ${e.url}`),!a.config.ignorePlaylistParsingErrors){a.trigger(b.ERROR,{type:Oe.NETWORK_ERROR,details:Q.LEVEL_PARSING_ERROR,fatal:!1,url:v,error:C,reason:C.message,response:t,context:r,level:T,parent:E,networkDetails:s,stats:i});return}e.playlistParsingError=null}if(!e.fragments.length){let D=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(b.ERROR,{type:Oe.NETWORK_ERROR,details:Q.LEVEL_EMPTY_ERROR,fatal:!1,url:v,error:D,reason:D.message,response:t,context:r,level:T,parent:E,networkDetails:s,stats:i});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case mt.MANIFEST:case mt.LEVEL:if(T){if(!d)T=0;else if(d!==a.levels[T]){let D=a.levels.indexOf(d);D>-1&&(T=D)}}a.trigger(b.LEVEL_LOADED,{details:e,levelInfo:d||a.levels[0],level:T||0,id:f||0,stats:i,networkDetails:s,deliveryDirectives:y,withoutMultiVariant:l===mt.MANIFEST});break;case mt.AUDIO_TRACK:a.trigger(b.AUDIO_TRACK_LOADED,{details:e,track:d,id:f||0,groupId:m||"",stats:i,networkDetails:s,deliveryDirectives:y});break;case mt.SUBTITLE_TRACK:a.trigger(b.SUBTITLE_TRACK_LOADED,{details:e,track:d,id:f||0,groupId:m||"",stats:i,networkDetails:s,deliveryDirectives:y});break}}},cl=(()=>{class n{static get version(){return $p}static isMSESupported(){return S$()}static isSupported(){return die()}static getMediaSource(){return al()}static get Events(){return b}static get MetadataSchema(){return pr}static get ErrorTypes(){return Oe}static get ErrorDetails(){return Q}static get DefaultConfig(){return n.defaultConfig?n.defaultConfig:iie}static set DefaultConfig(t){n.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new e1,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;let i=this.logger=mJ(t.debug||!1,"Hls instance",t.assetPlayerId),r=this.config=sie(n.DefaultConfig,t,i);this.userConfig=t,r.progressive&&oie(r,i);let{abrController:s,bufferController:o,capLevelController:a,errorController:l,fpsController:u}=r,d=new l(this),f=this.abrController=new s(this),m=new FA(this),y=r.interstitialsController,v=y?this.interstitialsController=new y(this,n):null,E=this.bufferController=new o(this,m),T=this.capLevelController=new a(this),C=new u(this),D=new qD(this),P=r.contentSteeringController,V=P?new P(this):null,G=this.levelController=new GD(this,V),H=new $D(this),A=new HD(this.config,this.logger),x=this.streamController=new zD(this,m,A),R=this.gapController=new BD(this,m);T.setStreamController(x),C.setStreamController(x);let M=[D,G,x];v&&M.splice(1,0,v),V&&M.splice(1,0,V),this.networkControllers=M;let F=[f,E,R,T,C,H,m];this.audioTrackController=this.createController(r.audioTrackController,M);let j=r.audioStreamController;j&&M.push(this.audioStreamController=new j(this,m,A)),this.subtitleTrackController=this.createController(r.subtitleTrackController,M);let B=r.subtitleStreamController;B&&M.push(this.subtititleStreamController=new B(this,m,A)),this.createController(r.timelineController,F),A.emeController=this.emeController=this.createController(r.emeController,F),this.cmcdController=this.createController(r.cmcdController,F),this.latencyController=this.createController(jD,F),this.coreComponents=F,M.push(d);let pe=d.onErrorOut;typeof pe=="function"&&this.on(b.ERROR,pe,d),this.on(b.MANIFEST_LOADED,D.onManifestLoaded,D)}createController(t,i){if(t){let r=new t(this);return i&&i.push(r),r}return null}on(t,i,r=this){this._emitter.on(t,i,r)}once(t,i,r=this){this._emitter.once(t,i,r)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,i,r=this,s){this._emitter.off(t,i,r,s)}listeners(t){return this._emitter.listeners(t)}emit(t,i,r){return this._emitter.emit(t,i,r)}trigger(t,i){if(this.config.debug)return this.emit(t,t,i);try{return this.emit(t,t,i)}catch(r){if(this.logger.error("An internal error happened while handling event "+t+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;let s=t===b.ERROR;this.trigger(b.ERROR,{type:Oe.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,fatal:s,event:t,error:r}),this.triggeringException=!1}}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){this.logger.log("destroy"),this.trigger(b.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(i=>i.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(i=>i.destroy()),this.coreComponents.length=0;let t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){if(!t||"media"in t&&!t.media){let o=new Error(`attachMedia failed: invalid argument (${t})`);this.trigger(b.ERROR,{type:Oe.OTHER_ERROR,details:Q.ATTACH_MEDIA_ERROR,fatal:!0,error:o});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());let i="media"in t,r=i?t.media:t,s=i?t:{media:r};this._media=r,this.trigger(b.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(b.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;let t=this.bufferController.transferMedia();return this.trigger(b.MEDIA_DETACHING,{transferMedia:t}),t}loadSource(t){this.stopLoad();let i=this.media,r=this._url,s=this._url=WD.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),i&&r&&(r!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(i)),this.trigger(b.MANIFEST_LOADING,{url:t})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(t=-1,i){this.logger.log(`startLoad(${t+(i?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(t,i),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let t=0;t<this.networkControllers.length&&(this.networkControllers[t].stopLoad(),!(this.started||!this.networkControllers));t++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(t=>{t.resumeBuffering&&t.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(t=>{t.pauseBuffering&&t.pauseBuffering()}))}get inFlightFragments(){let t={[De.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(t[De.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(t[De.SUBTITLE]=this.subtititleStreamController.inFlightFrag),t}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");let t=this._media,i=t?.currentTime;this.detachMedia(),t&&(this.attachMedia(t),i&&this.startLoad(i))}removeLevel(t){this.levelController.removeLevel(t)}get sessionId(){let t=this._sessionId;return t||(t=this._sessionId=Sne()),t}get levels(){let t=this.levelController.levels;return t||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){this.logger.log(`set currentLevel:${t}`),this.levelController.manualLevel=t,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){this.logger.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){this.logger.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){this.logger.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){let t=this.levelController.startLevel;return t===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:t}set startLevel(t){this.logger.log(`set startLevel:${t}`),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){let i=!!t;i!==this.config.capLevelToPlayerSize&&(i?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=i)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){let{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}set bandwidthEstimate(t){this.abrController.resetEstimator(t)}get abrEwmaDefaultEstimate(){let{bwEstimator:t}=this.abrController;return t?t.defaultEstimate:NaN}get ttfbEstimate(){let{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(this.logger.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){WJ(t)&&this._maxHdcpLevel!==t&&(this._maxHdcpLevel=t,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){let{levels:t,config:{minAutoBitrate:i}}=this;if(!t)return 0;let r=t.length;for(let s=0;s<r;s++)if(t[s].maxBitrate>=i)return s;return 0}get maxAutoLevel(){let{levels:t,autoLevelCapping:i,maxHdcpLevel:r}=this,s;if(i===-1&&t!=null&&t.length?s=t.length-1:s=i,r)for(let o=s;o--;){let a=t[o].attrs["HDCP-LEVEL"];if(a&&a<=r)return o}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(t){this.abrController.nextAutoLevel=t}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(t){var i;return((i=this.audioTrackController)==null?void 0:i.setAudioOption(t))||null}setSubtitleOption(t){var i;return((i=this.subtitleTrackController)==null?void 0:i.setSubtitleOption(t))||null}get allAudioTracks(){let t=this.audioTrackController;return t?t.allAudioTracks:[]}get audioTracks(){let t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){let t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){let i=this.audioTrackController;i&&(i.audioTrack=t)}get allSubtitleTracks(){let t=this.subtitleTrackController;return t?t.allSubtitleTracks:[]}get subtitleTracks(){let t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){let t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){let i=this.subtitleTrackController;i&&(i.subtitleTrack=t)}get subtitleDisplay(){let t=this.subtitleTrackController;return t?t.subtitleDisplay:!1}set subtitleDisplay(t){let i=this.subtitleTrackController;i&&(i.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(t){this.latencyController.targetLatency=t}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(t){this.levelController.pathwayPriority=t}get bufferedToEnd(){var t;return!!((t=this.bufferController)!=null&&t.bufferedToEnd)}get interstitialsManager(){var t;return((t=this.interstitialsController)==null?void 0:t.interstitialsManager)||null}getMediaDecodingInfo(t,i=this.allAudioTracks){let r=_U(i);return yU(t,r,navigator.mediaCapabilities)}}return n.defaultConfig=void 0,n})();var pie=["videoEl"];function mie(n,e){n&1&&(N(0,"div",29),fe(1,"div",30),$())}function gie(n,e){n&1&&(N(0,"div",31),Fe(),N(1,"svg",32),fe(2,"path",33),$()())}function yie(n,e){n&1&&(Fe(),N(0,"svg",37),fe(1,"path",38),$())}function vie(n,e){n&1&&(Fe(),N(0,"svg",37),fe(1,"path",39),$())}function _ie(n,e){if(n&1&&(N(0,"div",34)(1,"div",35),Be(2,yie,2,0,"svg",36)(3,vie,2,0,"svg",36),$()()),n&2){let t=Ce();K(2),ce("ngIf",t.isMuted),K(),ce("ngIf",!t.isMuted)}}function Eie(n,e){if(n&1&&(N(0,"div",40),Fe(),N(1,"svg",41),fe(2,"path",42)(3,"circle",43),$(),Ge(),N(4,"span",44),X(5),$()()),n&2){let t=Ce();K(5),Ot(t.formatViewCount(t.displayViewCount))}}function Tie(n,e){if(n&1&&(N(0,"span",45),X(1),$()),n&2){let t=Ce();K(),Ot(t.displayLikes)}}function wie(n,e){if(n&1){let t=Tt();N(0,"button",46),ve("click",function(r){xe(t);let s=Ce();return Ae(s.onDelete(r))}),Fe(),N(1,"svg",47),fe(2,"path",48)(3,"line",49)(4,"line",50),$()()}}var Wp=class n{reel;src="";poster="";title="";vendor="";price="";distance="";active=!1;relativeIndex=0;priority="low";likes=0;viewCount=0;isLiked=!1;isBookmarked=!1;liked=new lt;bookmarked=new lt;shared=new lt;deleted=new lt;canDelete=!1;videoEl;lastTapTime=0;showLikeAnimation=!1;isProgressBarVisible=!1;progressBarHideTimeout;singleTapTimeout;hls=null;isBrowser=!1;get displaySrc(){let e=this.reel?.videoUrl||this.src;return e&&e.includes("videos.bengaluru-swada.com")&&(e=e.replace("https://videos.bengaluru-swada.com","https://r2-video-uploader.bengaluru-swada.workers.dev")),e}get displayPoster(){return this.reel?.thumbnailUrl||this.poster}get displayTitle(){return this.reel?.title||this.title}get displayVendor(){return this.reel?.vendor||this.vendor}get displayPrice(){return this.reel?.price||this.price}get displayDistance(){return this.reel?.distance||this.distance}get displayLikes(){return this.reel?.likes||this.likes}get displayViewCount(){return this.reel?.viewCount||this.viewCount}get displayIsLiked(){return this.reel?this.reel.isLiked||!1:this.isLiked}get displayIsBookmarked(){return this.reel?this.reel.isBookmarked||!1:this.isBookmarked}isLoading=!0;progress=0;isSeeking=!1;isMuted=!0;muteChanged=new lt;showMuteIcon=!1;progressInterval;constructor(e){this.isBrowser=Yw(e)}ngOnChanges(e){if(this.isBrowser){if(e.reel||e.src){let t=this.displaySrc,i=e.reel?.previousValue?.videoUrl||e.src?.previousValue;t!==i&&(this.isLoading=!0,this.initVideo())}e.priority&&this.updateHlsPriority(),e.active&&(this.active?this.play():this.pause()),this.videoEl?.nativeElement&&(this.videoEl.nativeElement.muted=!this.active||this.isMuted)}}ngOnDestroy(){this.destroyHls(),this.progressInterval&&clearInterval(this.progressInterval),this.progressBarHideTimeout&&clearTimeout(this.progressBarHideTimeout)}ngAfterViewInit(){this.isBrowser&&(this.initVideo(),this.setupNativeListeners())}initVideo(){if(!this.videoEl?.nativeElement||!this.displaySrc||this.priority==="low")return;let e=this.videoEl.nativeElement,t=this.displaySrc;if(this.destroyHls(),!t.endsWith(".m3u8"))throw new Error("[VideoCard] MP4 playback is forbidden");if(cl.isSupported()){let i={debug:!1,enableWorker:!0,startLevel:0,autoStartLoad:!1,maxBufferLength:6,maxMaxBufferLength:12,backBufferLength:3,fragLoadingTimeOut:2e3,fragLoadingMaxRetry:3};this.hls=new cl(i),this.hls.attachMedia(e),this.hls.on(cl.Events.MEDIA_ATTACHED,()=>{this.hls?.loadSource(t)}),this.hls.on(cl.Events.MANIFEST_PARSED,()=>{this.updateHlsPriority()}),this.hls.on(cl.Events.ERROR,(r,s)=>{if(s.fatal)switch(s.type){case cl.ErrorTypes.NETWORK_ERROR:this.hls?.startLoad();break;case cl.ErrorTypes.MEDIA_ERROR:this.hls?.recoverMediaError();break;default:this.destroyHls();break}})}else e.canPlayType("application/vnd.apple.mpegurl")==="probably"&&(e.src=t)}updateHlsPriority(){if(!this.hls&&(this.priority==="high"||this.priority==="auto")){this.initVideo();return}if(this.hls)switch(this.priority){case"high":this.hls.startLoad(0),this.videoEl?.nativeElement.play().catch(()=>{});break;case"auto":this.hls.startLoad(0),this.videoEl?.nativeElement.pause();break;case"low":this.destroyHls(),this.videoEl?.nativeElement&&(this.videoEl.nativeElement.src="",this.videoEl.nativeElement.load());break}}destroyHls(){this.hls&&(this.hls.destroy(),this.hls=null)}setupNativeListeners(){let e=this.videoEl.nativeElement;["error","ended","timeupdate","waiting","playing"].forEach(i=>{e.addEventListener(i,()=>{i==="timeupdate"&&(!this.isSeeking&&e.duration&&(this.progress=e.currentTime/e.duration*100),this.isLoading=!1),i==="waiting"&&(this.isLoading=!0),i==="playing"&&(this.isLoading=!1),i==="ended"&&(this.progress=0,this.play())})})}play(){let e=this.videoEl?.nativeElement;if(!e)return;this.videoEl.nativeElement.muted=!this.active||this.isMuted,this.hls&&this.hls.startLoad();let t=e.play();t!==void 0&&t.catch(i=>{})}pause(){this.videoEl?.nativeElement.pause()}resetVideo(){let e=this.videoEl?.nativeElement;e&&e.pause()}preload(){}bookmark(){this.reel||(this.isBookmarked=!this.isBookmarked),this.bookmarked.emit()}onDelete(e){e.stopPropagation(),this.deleted.emit()}openGoogleMaps(){if(this.reel?.latitude&&this.reel?.longitude){let{latitude:e,longitude:t}=this.reel,i=`https://www.google.com/maps?q=${e},${t}`;window.open(i,"_blank")}}share(){this.shared.emit()}toggleLike(){this.reel||(this.isLiked=!this.isLiked),this.liked.emit(),this.isLiked&&this.showLikeAnimationEffect()}toggleMute(){let e=this.videoEl?.nativeElement;if(e){e.paused&&e.play().catch(i=>console.error("[VideoCard] Error playing on tap:",i));let t=!this.isMuted;e.muted=!this.active||t,this.isMuted=t,this.muteChanged.emit(t),this.showMuteAnimation(),this.isProgressBarVisible=!0,this.progressBarHideTimeout&&clearTimeout(this.progressBarHideTimeout),this.progressBarHideTimeout=setTimeout(()=>{this.isProgressBarVisible=!1},2e3)}}showMuteAnimation(){this.showMuteIcon=!0,setTimeout(()=>{this.showMuteIcon=!1},1e3)}doubleTapLike(){this.isLiked?this.showLikeAnimationEffect():this.toggleLike()}onVideoTap(e){e.preventDefault();let t=new Date().getTime(),i=t-this.lastTapTime;i<300&&i>0?(this.singleTapTimeout&&(clearTimeout(this.singleTapTimeout),this.singleTapTimeout=void 0),this.doubleTapLike(),this.lastTapTime=0):(this.lastTapTime=t,this.singleTapTimeout=setTimeout(()=>{this.toggleMute(),this.singleTapTimeout=void 0},300))}showLikeAnimationEffect(){this.showLikeAnimation=!0,setTimeout(()=>{this.showLikeAnimation=!1},1e3)}formatViewCount(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}onProgressBarClick(e){e.stopPropagation(),this.seekToPosition(e)}onProgressBarTouchStart(e){this.isSeeking=!0,this.seekToPosition(e)}onProgressBarTouchMove(e){this.isSeeking&&this.seekToPosition(e)}onProgressBarTouchEnd(){this.isSeeking=!1}seekToPosition(e){let i=e.currentTarget.getBoundingClientRect(),r;if(e.type.indexOf("touch")===-1)r=e.clientX;else{let l=e.touches[0]||e.changedTouches[0];if(!l)return;r=l.clientX}let o=Math.max(0,Math.min(r-i.left,i.width))/i.width,a=this.videoEl?.nativeElement;a&&a.readyState>0&&(a.currentTime=o*a.duration,this.progress=o*100)}static \u0275fac=function(t){return new(t||n)(Te(Li))};static \u0275cmp=Dt({type:n,selectors:[["app-video-card"]],viewQuery:function(t,i){if(t&1&&er(pie,5),t&2){let r;Oi(r=Ni())&&(i.videoEl=r.first)}},inputs:{reel:"reel",src:"src",poster:"poster",title:"title",vendor:"vendor",price:"price",distance:"distance",active:"active",relativeIndex:"relativeIndex",priority:"priority",likes:"likes",viewCount:"viewCount",isLiked:"isLiked",isBookmarked:"isBookmarked",canDelete:"canDelete",isMuted:"isMuted"},outputs:{liked:"liked",bookmarked:"bookmarked",shared:"shared",deleted:"deleted",muteChanged:"muteChanged"},standalone:!0,features:[Cr,Pt],decls:34,vars:28,consts:[["videoEl",""],[1,"video-card"],["loop","","playsinline","","webkit-playsinline","","x-webkit-airplay","allow","disablePictureInPicture","","poster","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII=",1,"video-player",3,"click","touchend","muted","preload"],["class","loading-spinner",4,"ngIf"],["class","like-animation",4,"ngIf"],["class","mute-animation",4,"ngIf"],[1,"video-overlay"],[1,"video-info"],[1,"food-details"],[1,"title-category-row"],[1,"dish-name"],[1,"vendor-name"],[1,"price-distance"],[1,"price"],[1,"distance"],[1,"action-buttons"],["class","view-count-action",4,"ngIf"],[1,"action-btn","like-btn",3,"click"],["width","28","height","28","viewBox","0 0 24 24",1,"action-icon"],["d","M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["class","like-count",4,"ngIf"],[1,"action-btn","bookmark-btn",3,"click"],["d","M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"action-btn","map-btn",3,"click"],["width","28","height","28","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"action-icon","navigate-icon"],["points","3 11 22 2 13 21 11 13 3 11"],["class","action-btn delete-btn",3,"click",4,"ngIf"],[1,"progress-container",3,"click","touchstart","touchmove","touchend","mouseenter","mouseleave"],[1,"progress-bar"],[1,"loading-spinner"],[1,"spinner"],[1,"like-animation"],["width","100","height","100","viewBox","0 0 24 24","fill","white"],["d","M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"],[1,"mute-animation"],[1,"mute-icon-bg"],["width","40","height","40","viewBox","0 0 24 24","fill","white",4,"ngIf"],["width","40","height","40","viewBox","0 0 24 24","fill","white"],["d","M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"],["d","M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"],[1,"view-count-action"],["width","24","height","24","viewBox","0 0 24 24","fill","none"],["d","M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z","stroke","currentColor","stroke-width","2"],["cx","12","cy","12","r","3","stroke","currentColor","stroke-width","2"],[1,"count-text"],[1,"like-count"],[1,"action-btn","delete-btn",3,"click"],["width","26","height","26","viewBox","0 0 24 24","fill","none","stroke","#ff4444","stroke-width","2",1,"action-icon"],["d","M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"],["x1","10","y1","11","x2","10","y2","17"],["x1","14","y1","11","x2","14","y2","17"]],template:function(t,i){if(t&1){let r=Tt();N(0,"div",1)(1,"video",2,0),ve("click",function(o){return xe(r),Ae(i.onVideoTap(o))})("touchend",function(o){return xe(r),Ae(i.onVideoTap(o))}),$(),Be(3,mie,2,0,"div",3)(4,gie,3,0,"div",4)(5,_ie,4,2,"div",5),N(6,"div",6)(7,"div",7)(8,"div",8)(9,"div",9)(10,"h3",10),X(11),$()(),N(12,"p",11),X(13),$(),N(14,"div",12)(15,"span",13),X(16),$(),N(17,"span",14),X(18),$()()()(),N(19,"div",15),Be(20,Eie,6,1,"div",16),N(21,"button",17),ve("click",function(){return xe(r),Ae(i.toggleLike())}),Fe(),N(22,"svg",18),fe(23,"path",19),$(),Be(24,Tie,2,1,"span",20),$(),Ge(),N(25,"button",21),ve("click",function(){return xe(r),Ae(i.bookmark())}),Fe(),N(26,"svg",18),fe(27,"path",22),$()(),Ge(),N(28,"button",23),ve("click",function(){return xe(r),Ae(i.openGoogleMaps())}),Fe(),N(29,"svg",24),fe(30,"polygon",25),$()(),Be(31,wie,5,0,"button",26),$()(),Ge(),N(32,"div",27),ve("click",function(o){return xe(r),Ae(i.onProgressBarClick(o))})("touchstart",function(o){return xe(r),Ae(i.onProgressBarTouchStart(o))})("touchmove",function(o){return xe(r),Ae(i.onProgressBarTouchMove(o))})("touchend",function(){return xe(r),Ae(i.onProgressBarTouchEnd())})("mouseenter",function(){return xe(r),Ae(i.isProgressBarVisible=!0)})("mouseleave",function(){return xe(r),Ae(i.isProgressBarVisible=!1)}),fe(33,"div",28),$()()}t&2&&(ct("active",i.active)("prev",i.relativeIndex<0)("next",i.relativeIndex>0),K(),ce("muted",!i.active||i.isMuted)("preload",i.priority==="high"?"auto":"metadata"),K(2),ce("ngIf",i.isLoading),K(),ce("ngIf",i.showLikeAnimation),K(),ce("ngIf",i.showMuteIcon),K(6),Ot(i.displayTitle),K(2),Ot(i.displayVendor),K(3),pt("\u20B9",i.displayPrice,""),K(2),pt("",i.displayDistance," away"),K(2),ce("ngIf",i.displayViewCount>0),K(),ct("liked",i.displayIsLiked),K(),Ds("fill",i.displayIsLiked?"currentColor":"none"),K(2),ce("ngIf",i.displayLikes>0),K(),ct("bookmarked",i.displayIsBookmarked),K(),Ds("fill",i.displayIsBookmarked?"currentColor":"none"),K(5),ce("ngIf",i.canDelete),K(),ct("visible",i.isProgressBarVisible),K(),Io("width",i.progress,"%"))},dependencies:[Ut,nn],styles:[".video-card[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;transform:translateY(100%);transition:transform .4s cubic-bezier(.25,1,.5,1);background:#000;overflow:hidden;z-index:1}.video-card.prev[_ngcontent-%COMP%]{transform:translateY(-100%)}.video-card.next[_ngcontent-%COMP%]{transform:translateY(100%)}.video-card.active[_ngcontent-%COMP%]{transform:translateY(0);z-index:2}.video-player[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background:#000}.video-player[_ngcontent-%COMP%]::-webkit-media-controls{display:none!important}.video-player[_ngcontent-%COMP%]::-webkit-media-controls-enclosure{display:none!important}.video-player[_ngcontent-%COMP%]::-webkit-media-controls-panel{display:none!important}.video-player[_ngcontent-%COMP%]:before{display:none!important}.progress-container[_ngcontent-%COMP%]{position:absolute;bottom:53px;left:0;width:100%;height:3px;background-color:#fff3;z-index:95;cursor:pointer;transition:opacity .3s ease;opacity:1;pointer-events:auto;margin:0;padding:0}.progress-container[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{height:100%;background-color:#fff;width:0%;transition:width .1s linear;box-shadow:0 0 10px #ffffff80}.progress-container[_ngcontent-%COMP%]:hover, .progress-container[_ngcontent-%COMP%]:active{height:4px;background-color:#ffffff4d}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.video-overlay[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;width:100%;padding:20px;background:linear-gradient(to top,rgba(0,0,0,.8),transparent);display:flex;justify-content:space-between;align-items:flex-end;pointer-events:none}.video-info[_ngcontent-%COMP%]{flex:1;color:#fff;padding-right:20px;pointer-events:auto;margin-bottom:50px}.title-category-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:5px;flex-wrap:wrap}.dish-name[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin:0;text-shadow:0 1px 2px rgba(0,0,0,.5)}.category-badge[_ngcontent-%COMP%]{font-size:.65rem;font-weight:800;text-transform:uppercase;letter-spacing:.6px;background:linear-gradient(135deg,#ff6b354d,#ff8c424d);backdrop-filter:blur(8px);padding:3px 10px;border-radius:6px;border:1px solid rgba(255,107,53,.4);color:#fff;box-shadow:0 4px 8px #0000004d;text-shadow:0 1px 2px rgba(0,0,0,.5)}.vendor-name[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;margin:0 0 10px;opacity:.9}.price-distance[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px;font-size:.9rem;padding-bottom:20px}.price[_ngcontent-%COMP%]{font-weight:600;color:#ffffffe6;background:#ff6b35;padding:2px 8px;border-radius:4px}.distance[_ngcontent-%COMP%]{opacity:.8}.view-count[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;margin-top:8px;font-size:.85rem;opacity:.8}.view-count[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:.9}.action-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;pointer-events:auto;padding-bottom:60px}.action-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#fff;display:flex;flex-direction:column;align-items:center;gap:5px;cursor:pointer;padding:0;transition:transform .2s}.action-btn[_ngcontent-%COMP%]:active{transform:scale(.9)}.action-icon[_ngcontent-%COMP%]{filter:drop-shadow(0 2px 4px rgba(0,0,0,.3))}.like-count[_ngcontent-%COMP%]{font-size:.8rem;font-weight:600}.like-btn.liked[_ngcontent-%COMP%]{color:#ff4757}.like-btn.liked[_ngcontent-%COMP%]   .action-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse .3s cubic-bezier(.175,.885,.32,1.275)}.bookmark-btn.bookmarked[_ngcontent-%COMP%]{color:#ff6b35}.like-animation[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10;pointer-events:none;animation:_ngcontent-%COMP%_pop-in-out .8s cubic-bezier(.175,.885,.32,1.275) forwards}@keyframes _ngcontent-%COMP%_pop-in-out{0%{transform:translate(-50%,-50%) scale(0);opacity:0}20%{transform:translate(-50%,-50%) scale(1.2);opacity:1}40%{transform:translate(-50%,-50%) scale(.9);opacity:1}80%{transform:translate(-50%,-50%) scale(1);opacity:1}to{transform:translate(-50%,-50%) scale(1.5);opacity:0}}@keyframes _ngcontent-%COMP%_pulse{0%{transform:scale(1)}50%{transform:scale(1.2)}to{transform:scale(1)}}.mute-animation[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10;pointer-events:none;animation:_ngcontent-%COMP%_fade-in-out 1s ease-in-out forwards}.mute-icon-bg[_ngcontent-%COMP%]{background:#0009;border-radius:50%;padding:15px;display:flex;align-items:center;justify-content:center}@keyframes _ngcontent-%COMP%_fade-in-out{0%{opacity:0;transform:translate(-50%,-50%) scale(.8)}20%{opacity:1;transform:translate(-50%,-50%) scale(1)}80%{opacity:1;transform:translate(-50%,-50%) scale(1)}to{opacity:0;transform:translate(-50%,-50%) scale(.8)}}.view-count-action[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:2px;color:#fff;margin-bottom:5px}.view-count-action[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{filter:drop-shadow(0 2px 4px rgba(0,0,0,.3))}.view-count-action[_ngcontent-%COMP%]   .count-text[_ngcontent-%COMP%]{font-size:.8rem;font-weight:600;text-shadow:0 1px 2px rgba(0,0,0,.5)}"]})};var Fr=class n{constructor(e,t){this.firestore=e;this.http=t}collectionName="reels";getTrendingReels(e=20){return U(this,null,function*(){try{let t=Ad(this.firestore,this.collectionName),i=Dd(t,Ep("createdAt","desc"),$v(e*3)),s=(yield Bv(i)).docs.map(u=>{let d=u.data();return d.videoUrl&&d.videoUrl.includes("videos.bengaluru-swada.com")&&(d.videoUrl=d.videoUrl.replace("https://videos.bengaluru-swada.com","https://r2-video-uploader.bengaluru-swada.workers.dev")),ue({id:u.id},d)}),o=Date.now(),a=s.map(u=>{let d=u.viewCount||0,f=u.likes||0,m=u.bookmarkedBy?.length||0,y=d*1+f*3+m*5,v=u.createdAt.toDate().getTime(),E=Math.max(0,(o-v)/(1e3*60*60)),T=y/Math.pow(E+2,1.5);return Ye(ue({},u),{_score:T})});a.sort((u,d)=>d._score-u._score);let l=a.slice(0,e);return this.shuffleArray(l)}catch(t){return console.error("Error fetching trending:",t),[]}})}getNewArrivals(e=20){return U(this,null,function*(){return yield this.getReels(e)})}shuffleArray(e){for(let t=e.length-1;t>0;t--){let i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}getReels(e=10,t){return U(this,null,function*(){try{let i=Ad(this.firestore,this.collectionName),r=Dd(i,Ep("createdAt","desc"),$v(e));return t&&(r=Dd(r,SV(t))),(yield Bv(r)).docs.map(o=>ue({id:o.id},o.data()))}catch(i){return console.error("Error fetching reels:",i),[]}})}getReelsByUser(e){return U(this,null,function*(){try{let t=Ad(this.firestore,this.collectionName),i=Dd(t,CV("uploadedBy","==",e),Ep("createdAt","desc"));return(yield Bv(i)).docs.map(s=>ue({id:s.id},s.data()))}catch(t){return console.error("Error fetching user reels:",t),[]}})}getReelById(e){return U(this,null,function*(){try{let t=Ac(this.firestore,this.collectionName,e),i=yield wV(t);return i.exists()?ue({id:i.id},i.data()):null}catch(t){return console.error("Error fetching reel:",t),null}})}createReel(e){return U(this,null,function*(){try{let t=Ad(this.firestore,this.collectionName);return(yield EV(t,Ye(ue({},e),{createdAt:gn.now(),viewCount:0,likes:0,likedBy:[],bookmarkedBy:[]}))).id}catch(t){throw console.error("Error creating reel:",t),t}})}updateReel(e,t){return U(this,null,function*(){try{let i=Ac(this.firestore,this.collectionName,e);yield Dc(i,t)}catch(i){throw console.error("Error updating reel:",i),i}})}deleteReel(e){return U(this,null,function*(){try{let t=yield this.getReelById(e);if(!t){console.warn("Reel not found, cannot delete");return}let i="";if(t.videoUrl)if(t.videoUrl.includes("bengaluru-swada.workers.dev")){let s="bengaluru-swada.workers.dev/",o=t.videoUrl.indexOf(s);o!==-1&&(i=t.videoUrl.substring(o+s.length))}else{let s=t.videoUrl.split("/");i=s[s.length-1]}if(i)try{yield pa(this.deleteFromR2(i)),console.log(`Deleted ${i} from R2`)}catch(s){console.error("Failed to delete from R2, proceeding with DB delete:",s)}let r=Ac(this.firestore,this.collectionName,e);yield TV(r),console.log("Deleted reel metadata from Firestore")}catch(t){throw console.error("Error deleting reel:",t),t}})}toggleLike(e,t,i){return U(this,null,function*(){try{let r=Ac(this.firestore,this.collectionName,e);i?yield Dc(r,{likedBy:qx(t),likes:Uv(-1)}):yield Dc(r,{likedBy:Wx(t),likes:Uv(1)})}catch(r){throw console.error("Error toggling like:",r),r}})}toggleBookmark(e,t,i){return U(this,null,function*(){try{let r=Ac(this.firestore,this.collectionName,e);i?yield Dc(r,{bookmarkedBy:qx(t)}):yield Dc(r,{bookmarkedBy:Wx(t)})}catch(r){throw console.error("Error toggling bookmark:",r),r}})}incrementViewCount(e){return U(this,null,function*(){try{let t=Ac(this.firestore,this.collectionName,e);yield Dc(t,{viewCount:Uv(1)})}catch(t){console.error("Error incrementing view count:",t)}})}getReelsRealtime(e=10){return new nt(t=>{let i=Ad(this.firestore,this.collectionName),r=Dd(i,Ep("createdAt","desc"),$v(e)),s=bV(r,o=>{let a=o.docs.map(l=>ue({id:l.id},l.data()));t.next(a)},o=>{console.error("Error in realtime reels:",o),t.error(o)});return()=>s()})}getUploadUrl(e,t){return this.http.post(Tp.cloudflare.workerUrl,{fileName:e,contentType:t})}uploadToR2(e,t){return this.http.put(e,t,{headers:{"Content-Type":t.type},reportProgress:!0,observe:"events"})}deleteFromR2(e){return this.http.delete(`${Tp.cloudflare.workerUrl}/${e}`)}isLikedByUser(e,t){return e.likedBy?.includes(t)||!1}isBookmarkedByUser(e,t){return e.bookmarkedBy?.includes(t)||!1}static \u0275fac=function(t){return new(t||n)(Me(xc),Me(tI))};static \u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})};function Iie(n,e){n&1&&(N(0,"div",16),fe(1,"div",17),$())}function bie(n,e){if(n&1){let t=Tt();N(0,"div",18)(1,"div",19)(2,"h2"),X(3,"No Reels Found"),$(),N(4,"p"),X(5,"Be the first to share a tasty bite!"),$(),N(6,"div",20)(7,"button",21),ve("click",function(){xe(t);let r=Ce();return Ae(r.seedData())}),X(8,"Seed Sample Data"),$(),N(9,"a",22),X(10,"Upload Reel"),$()()()()}}function Sie(n,e){if(n&1){let t=Tt();N(0,"app-video-card",25),ve("muteChanged",function(r){xe(t);let s=Ce(2);return Ae(s.onMuteChanged(r))})("deleted",function(){let r=xe(t).$implicit,s=Ce(2);return Ae(s.onReelDeleted(r))})("liked",function(){let r=xe(t).index,s=Ce(2);return Ae(s.onLike(r))})("bookmarked",function(){let r=xe(t).index,s=Ce(2);return Ae(s.onBookmark(r))})("shared",function(){let r=xe(t).index,s=Ce(2);return Ae(s.onShare(r))}),$()}if(n&2){let t=e.$implicit,i=e.index,r=Ce(2);ce("reel",t)("active",i===r.currentIndex&&r.isActive)("relativeIndex",i-r.currentIndex)("priority",r.getPriority(i))("isMuted",r.isGlobalMuted)("canDelete",r.isOwner(t))}}function Cie(n,e){if(n&1&&(N(0,"div",23),Be(1,Sie,1,6,"app-video-card",24),$()),n&2){let t=Ce();K(),ce("ngForOf",t.reels)}}var Uc=class n{constructor(e,t,i,r){this.reelsService=e;this.auth=t;this.cdr=i;this.locationService=r}isActive=!0;activeTab="all";isGlobalMuted=!0;reels=[];currentIndex=0;touchStartY=0;touchStartX=0;pullStartY=0;pullMoveY=0;isRefreshing=!1;hasTriggeredHaptic=!1;pullThreshold=150;swipeThresholdX=50;isLoading=!0;viewedReels=new Set;viewTrackingTimeout;cards;ngOnInit(){return U(this,null,function*(){yield this.loadReels()})}ngAfterViewInit(){setTimeout(()=>{this.reels.length>0&&this.trackView()},50)}ngOnChanges(e){e.isActive}onMuteChanged(e){this.isGlobalMuted=e}ngOnDestroy(){this.viewTrackingTimeout&&clearTimeout(this.viewTrackingTimeout)}reloadReelsForNewLocation(){return U(this,null,function*(){console.log("[VideoFeed] Reloading reels for new location...");let e=[...this.reels],t=yield Promise.all(e.map(i=>U(this,null,function*(){let r="-- km";if(i.latitude&&i.longitude)try{r=yield this.locationService.getDistanceFromUser(i.latitude,i.longitude)}catch(s){console.error("[VideoFeed] Error calculating distance:",s)}return Ye(ue({},i),{distance:r})})));this.activeTab==="all"&&t.sort((i,r)=>{let s=i.distance==="-- km"?1/0:parseFloat(i.distance.split(" ")[0]),o=r.distance==="-- km"?1/0:parseFloat(r.distance.split(" ")[0]);return s-o}),this.reels=t,this.currentIndex=0,this.cdr.detectChanges()})}isOwner(e){return this.auth.currentUser?.uid===e.uploadedBy}onReelDeleted(e){return U(this,null,function*(){if(confirm("Are you sure you want to delete this reel permanently?"))try{yield this.reelsService.deleteReel(e.id),this.reels=this.reels.filter(t=>t.id!==e.id),this.currentIndex>=this.reels.length&&(this.currentIndex=Math.max(0,this.reels.length-1))}catch(t){console.error("Failed to delete reel:",t),alert("Failed to delete reel. Please try again.")}})}switchTab(e){return U(this,null,function*(){this.activeTab!==e&&(this.activeTab=e,this.reels=[],this.currentIndex=0,this.isLoading=!0,yield this.loadReels())})}loadReels(){return U(this,null,function*(){console.log(`[VideoFeed] Loading ${this.activeTab} reels...`),this.isLoading=!0;try{let e=[];this.activeTab==="trending"?e=yield this.reelsService.getTrendingReels(20):this.activeTab==="new"?e=yield this.reelsService.getNewArrivals(20):e=yield this.reelsService.getReels(50),console.log("[VideoFeed] Fetched reels:",e.length);let t=this.auth.currentUser;console.log("[VideoFeed] Current user:",t?.uid||"Not logged in");let i=yield Promise.all(e.map(r=>U(this,null,function*(){let s="-- km";if(r.latitude&&r.longitude)try{s=yield this.locationService.getDistanceFromUser(r.latitude,r.longitude)}catch(o){console.error("[VideoFeed] Error calculating distance:",o)}return Ye(ue({},r),{distance:s,isLiked:t?this.reelsService.isLikedByUser(r,t.uid):!1,isBookmarked:t?this.reelsService.isBookmarkedByUser(r,t.uid):!1})})));this.activeTab==="all"&&i.sort((r,s)=>{let o=r.distance==="-- km"?1/0:parseFloat(r.distance.split(" ")[0]),a=s.distance==="-- km"?1/0:parseFloat(s.distance.split(" ")[0]);return o-a}),this.reels=i,console.log("[VideoFeed] Final reels count:",this.reels.length)}catch(e){console.error("[VideoFeed] Error loading reels:",e)}finally{setTimeout(()=>{this.isLoading=!1,this.cdr.detectChanges(),this.reels.length>0&&this.trackView()},500)}})}trackView(){this.viewTrackingTimeout&&clearTimeout(this.viewTrackingTimeout);let e=this.reels[this.currentIndex];!e||!e.id||this.viewedReels.has(e.id)||(this.viewTrackingTimeout=window.setTimeout(()=>{e.id&&(this.reelsService.incrementViewCount(e.id),this.viewedReels.add(e.id),e.viewCount=(e.viewCount||0)+1)},3e3))}onTouchStart(e){this.touchStartY=e.touches[0].clientY,this.touchStartX=e.touches[0].clientX,this.currentIndex===0&&!this.isRefreshing&&(this.pullStartY=e.touches[0].clientY,this.hasTriggeredHaptic=!1)}onTouchMove(e){if(this.currentIndex===0&&!this.isRefreshing&&this.pullStartY>0){let i=e.touches[0].clientY-this.pullStartY;i>0&&(this.pullMoveY=i*.5,i>10&&e.preventDefault(),this.pullMoveY>=this.pullThreshold&&!this.hasTriggeredHaptic?(this.hasTriggeredHaptic=!0,navigator.vibrate&&navigator.vibrate(15)):this.pullMoveY<this.pullThreshold&&this.hasTriggeredHaptic&&(this.hasTriggeredHaptic=!1))}}onTouchEnd(e){return U(this,null,function*(){let t=e.changedTouches[0].clientY,i=e.changedTouches[0].clientX,r=this.touchStartY-t,s=this.touchStartX-i;if(Math.abs(s)>this.swipeThresholdX&&Math.abs(s)>Math.abs(r)){s>0?this.activeTab==="all"?this.switchTab("trending"):this.activeTab==="trending"&&this.switchTab("new"):this.activeTab==="new"?this.switchTab("trending"):this.activeTab==="trending"&&this.switchTab("all");return}let o=80;r>o?this.next():r<-o&&this.pullMoveY<this.pullThreshold&&this.prev(),this.pullMoveY>=this.pullThreshold&&!this.isRefreshing&&(yield this.refresh()),this.pullStartY=0,this.pullMoveY=0,this.hasTriggeredHaptic=!1})}scrollToTopAndRefresh(){return U(this,null,function*(){if(console.log("[VideoFeed] Animated scroll to top and refreshing..."),this.currentIndex>0){this.isGlobalMuted=!0;let e=this.currentIndex,t=Math.max(30,80-e*2);for(let i=e-1;i>=0;i--)this.currentIndex=i,this.cdr.detectChanges(),yield new Promise(r=>setTimeout(r,t))}yield this.refresh()})}refresh(){return U(this,null,function*(){this.isRefreshing=!0,navigator.vibrate&&navigator.vibrate(50);try{yield this.loadReels()}finally{setTimeout(()=>{this.isRefreshing=!1},500)}})}next(){this.currentIndex<this.reels.length-1&&(this.isGlobalMuted=!0,this.currentIndex++,this.trackView())}prev(){this.currentIndex>0&&(this.isGlobalMuted=!0,this.currentIndex--,this.trackView())}onLike(e){return U(this,null,function*(){let t=this.reels[e];if(!t||!t.id)return;let i=this.auth.currentUser;if(!i){console.warn("User must be logged in to like");return}let r=t.isLiked||!1;t.isLiked=!r,t.likes=(t.likes||0)+(r?-1:1);try{yield this.reelsService.toggleLike(t.id,i.uid,r)}catch(s){t.isLiked=r,t.likes=(t.likes||0)+(r?1:-1),console.error("Error toggling like:",s)}})}onBookmark(e){return U(this,null,function*(){let t=this.reels[e];if(!t||!t.id)return;let i=this.auth.currentUser;if(!i){console.warn("User must be logged in to bookmark");return}let r=t.isBookmarked||!1;t.isBookmarked=!r;try{yield this.reelsService.toggleBookmark(t.id,i.uid,r)}catch(s){t.isBookmarked=r,console.error("Error toggling bookmark:",s)}})}onShare(e){let t=this.reels[e];if(t)if(navigator.share)navigator.share({title:t.title,text:`Check out ${t.title} from ${t.vendor}!`,url:window.location.href}).catch(i=>console.log("Error sharing:",i));else{let i=`Check out ${t.title} from ${t.vendor}! \u20B9${t.price}`;navigator.clipboard.writeText(i).then(()=>console.log("Link copied to clipboard!")).catch(r=>console.error("Error copying:",r))}}seedData(){return U(this,null,function*(){this.isLoading=!0;let e=[{title:"Masala Dosa",vendor:"CTR",videoUrl:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",thumbnailUrl:"https://images.unsplash.com/photo-1668236543090-82eba5ee5976?q=80&w=2070&auto=format&fit=crop",price:120,categories:["South Indian","Breakfast"],latitude:12.9352,longitude:77.6245,uploadedBy:this.auth.currentUser?.uid||"system",cloudflareVideoId:"sample-id-1",duration:596,createdAt:gn.now(),viewCount:0,likes:0,likedBy:[],bookmarkedBy:[]},{title:"Filter Coffee",vendor:"Brahmins Coffee Bar",videoUrl:"https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8",thumbnailUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/11/Idli_Sambar.JPG/1200px-Idli_Sambar.JPG",price:80,categories:["South Indian","Beverages"],latitude:12.9716,longitude:77.6412,uploadedBy:this.auth.currentUser?.uid||"system",cloudflareVideoId:"sample-id-2",duration:600,createdAt:gn.now(),viewCount:0,likes:0,likedBy:[],bookmarkedBy:[]}];try{for(let t of e)yield this.reelsService.createReel(t);yield this.loadReels()}catch(t){console.error("Error seeding data:",t)}finally{this.isLoading=!1}})}navigateToReel(e){if(console.log(`[VideoFeed] Attempting to navigate to reel: ${e}`),console.log(`[VideoFeed] Total reels loaded: ${this.reels.length}`),this.reels.length===0){console.warn(`[VideoFeed] No reels loaded yet, cannot navigate to ${e}`);return}let t=this.reels.findIndex(i=>i.id===e);t!==-1?(console.log(`[VideoFeed] Found reel at index ${t}, navigating...`),this.currentIndex=t,this.isGlobalMuted=!0,setTimeout(()=>{this.trackView()},100),console.log(`[VideoFeed] Successfully navigated to reel: ${e}`)):(console.warn(`[VideoFeed] Reel not found in loaded reels: ${e}`),console.log("[VideoFeed] Available reel IDs:",this.reels.map(i=>i.id)))}getPriority(e){let t=Math.abs(e-this.currentIndex);return t===0?"high":t===1?"auto":"low"}static \u0275fac=function(t){return new(t||n)(Te(Fr),Te(Kt),Te(tr),Te(Or))};static \u0275cmp=Dt({type:n,selectors:[["app-video-feed"]],viewQuery:function(t,i){if(t&1&&er(Wp,5),t&2){let r;Oi(r=Ni())&&(i.cards=r)}},inputs:{isActive:"isActive"},standalone:!0,features:[Cr,Pt],decls:27,vars:19,consts:[[1,"video-feed",3,"touchstart","touchmove","touchend"],[1,"feed-tabs"],[1,"tab-item",3,"click"],[1,"tab-separator"],[1,"tab-indicator"],[1,"refresh-indicator"],[1,"spinner-container"],[1,"carrot-spinner"],["viewBox","0 0 40 40",1,"carrot-svg"],["d","M20 35C20 35 14 25 14 15C14 10 17 7 20 7C23 7 26 10 26 15C26 25 20 35 20 35Z","fill","#ff6b35"],["d","M17 18h6M16 22h8M18 26h4","stroke","rgba(0,0,0,0.1)","stroke-width","1.5","stroke-linecap","round"],["d","M20 7V2M20 7L16 3M20 7L24 3","stroke","#4caf50","stroke-width","2.5","stroke-linecap","round"],[1,"loading-ripple"],["class","loading-container",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","reels-container",4,"ngIf"],[1,"loading-container"],[1,"simple-orange-loader"],[1,"empty-state"],[1,"empty-content"],[1,"button-group"],[1,"seed-btn",3,"click"],["routerLink","/upload-reel",1,"upload-btn"],[1,"reels-container"],[3,"reel","active","relativeIndex","priority","isMuted","canDelete","muteChanged","deleted","liked","bookmarked","shared",4,"ngFor","ngForOf"],[3,"muteChanged","deleted","liked","bookmarked","shared","reel","active","relativeIndex","priority","isMuted","canDelete"]],template:function(t,i){t&1&&(N(0,"div",0),ve("touchstart",function(s){return i.onTouchStart(s)})("touchmove",function(s){return i.onTouchMove(s)})("touchend",function(s){return i.onTouchEnd(s)}),N(1,"div",1)(2,"div",2),ve("click",function(){return i.switchTab("all")}),N(3,"span"),X(4,"All"),$()(),N(5,"div",3),X(6,"|"),$(),N(7,"div",2),ve("click",function(){return i.switchTab("trending")}),N(8,"span"),X(9,"Trending"),$()(),N(10,"div",3),X(11,"|"),$(),N(12,"div",2),ve("click",function(){return i.switchTab("new")}),N(13,"span"),X(14,"New Arrivals"),$()(),fe(15,"div",4),$(),N(16,"div",5)(17,"div",6)(18,"div",7),Fe(),N(19,"svg",8),fe(20,"path",9)(21,"path",10)(22,"path",11),$()(),Ge(),fe(23,"div",12),$()(),Be(24,Iie,2,0,"div",13)(25,bie,11,0,"div",14)(26,Cie,2,1,"div",15),$()),t&2&&(K(2),ct("active",i.activeTab==="all"),K(5),ct("active",i.activeTab==="trending"),K(5),ct("active",i.activeTab==="new"),K(3),ct("trending-active",i.activeTab==="trending")("new-active",i.activeTab==="new"),K(),Io("transform","translateY("+(i.isRefreshing?70:i.pullMoveY)+"px)"),ct("refreshing",i.isRefreshing)("visible",i.pullMoveY>10),K(8),ce("ngIf",i.isLoading),K(),ce("ngIf",!i.isLoading&&i.reels.length===0),K(),ce("ngIf",!i.isLoading&&i.reels.length>0))},dependencies:[Ut,di,nn,Wp,uO,iO],styles:[".video-feed[_ngcontent-%COMP%]{flex:1;position:relative;overflow:hidden;scroll-snap-type:y mandatory;-webkit-overflow-scrolling:touch;height:100vh;background:#000}.feed-tabs[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:60px;z-index:50;display:flex;align-items:center;justify-content:center;gap:15px;background:linear-gradient(to bottom,#000c,#0000);backdrop-filter:blur(2px);padding-top:10px}.tab-item[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#fff9;cursor:pointer;transition:color .3s ease,transform .2s ease;text-shadow:0 1px 4px rgba(0,0,0,.5)}.tab-item.active[_ngcontent-%COMP%]{color:#fff;transform:scale(1.05)}.tab-separator[_ngcontent-%COMP%]{color:#fff3;font-size:.9rem}.tab-indicator[_ngcontent-%COMP%]{position:absolute;bottom:12px;height:3px;width:20px;background:#fff;border-radius:2px;transition:transform .3s cubic-bezier(.4,0,.2,1);transform:translate(-125px);box-shadow:0 0 8px #fff6}.tab-indicator.trending-active[_ngcontent-%COMP%]{transform:translate(-42px)}.tab-indicator.new-active[_ngcontent-%COMP%]{transform:translate(85px)}.loading-container[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;z-index:10;background:#000}.simple-orange-loader[_ngcontent-%COMP%]{width:48px;height:48px;border:3px solid rgba(255,107,53,.1);border-top:3px solid #ff6b35;border-radius:50%;animation:_ngcontent-%COMP%_simple-spin .8s cubic-bezier(.5,.1,.5,.9) infinite;box-shadow:0 0 15px #ff6b351a}@keyframes _ngcontent-%COMP%_simple-spin{to{transform:rotate(360deg)}}.empty-content[_ngcontent-%COMP%]{text-align:center;padding:2rem}.empty-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:.5rem;color:#ff6b35}.empty-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#aaa;margin-bottom:2rem}.button-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;width:100%;max-width:250px}.seed-btn[_ngcontent-%COMP%], .upload-btn[_ngcontent-%COMP%]{padding:.8rem 1.5rem;border-radius:25px;font-weight:600;text-align:center;text-decoration:none;cursor:pointer;transition:all .2s;border:none;font-size:1rem}.seed-btn[_ngcontent-%COMP%]{background:#ffffff1a;color:#fff;border:1px solid rgba(255,255,255,.2)}.seed-btn[_ngcontent-%COMP%]:hover{background:#fff3}.upload-btn[_ngcontent-%COMP%]{background:#ff6b35;color:#fff}.upload-btn[_ngcontent-%COMP%]:hover{background:#e55a2b;transform:translateY(-2px)}.refresh-indicator[_ngcontent-%COMP%]{position:absolute;top:-60px;left:0;width:100%;height:60px;display:flex;align-items:center;justify-content:center;z-index:100;pointer-events:none;opacity:0;transition:transform .15s linear,opacity .2s ease}.refresh-indicator.visible[_ngcontent-%COMP%]{opacity:1}.refresh-indicator.refreshing[_ngcontent-%COMP%]{transition:transform .4s cubic-bezier(.175,.885,.32,1.275),opacity .2s}.refresh-indicator.refreshing[_ngcontent-%COMP%]   .spinner-outer-ring[_ngcontent-%COMP%]{animation:spin .8s linear infinite}.refresh-indicator.refreshing[_ngcontent-%COMP%]   .spinner-inner-ring[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin-reverse 1.2s linear infinite}.refresh-indicator.refreshing[_ngcontent-%COMP%]   .carrot-spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_carrot-jump .8s cubic-bezier(.175,.885,.32,1.275) infinite}.refresh-indicator.refreshing[_ngcontent-%COMP%]   .loading-ripple[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_ripple 1.2s ease-out infinite}.refresh-indicator[_ngcontent-%COMP%]   .spinner-container[_ngcontent-%COMP%]{width:64px;height:64px;background:#ffffff1a;backdrop-filter:blur(12px);border:1.5px solid rgba(255,255,255,.25);border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 32px #0006;position:relative;overflow:hidden}.refresh-indicator[_ngcontent-%COMP%]   .carrot-spinner[_ngcontent-%COMP%]{width:40px;height:40px;z-index:2;transition:transform .1s linear}.refresh-indicator[_ngcontent-%COMP%]   .loading-ripple[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;border-radius:50%;border:2px solid rgba(255,107,53,.3);opacity:0;z-index:1}@keyframes _ngcontent-%COMP%_spin-reverse{0%{transform:rotate(360deg)}to{transform:rotate(0)}}@keyframes _ngcontent-%COMP%_core-pulse{0%{transform:scale(.8);opacity:.5}to{transform:scale(1.2);opacity:1}}@keyframes _ngcontent-%COMP%_carrot-jump{0%,to{transform:translateY(0) scale(1)}30%{transform:translateY(0) scale(1.2,.8)}50%{transform:translateY(-12px) scale(.9,1.15)}80%{transform:translateY(0) scale(1.1,.9)}}@keyframes _ngcontent-%COMP%_ripple{0%{transform:scale(.5);opacity:1;border-width:4px}to{transform:scale(1.5);opacity:0;border-width:1px}}"]})};var Qd=class n{selectedReelId=new Tn(null);selectedReelId$=this.selectedReelId.asObservable();selectReel(e){console.log("[NavigationService] Setting selected reel:",e),this.selectedReelId.next(e)}clearSelection(){this.selectedReelId.next(null)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Se({token:n,factory:n.\u0275fac,providedIn:"root"})};function xie(n,e){n&1&&(N(0,"div",6)(1,"h1"),X(2,"Favorites"),$(),N(3,"p",7),X(4,"Your bookmarked reels"),$()())}function Aie(n,e){n&1&&(N(0,"div",8),fe(1,"div",9),N(2,"p"),X(3,"Loading favorites..."),$()())}function Die(n,e){n&1&&(N(0,"div",10),Fe(),N(1,"svg",11),fe(2,"path",12),$(),Ge(),N(3,"h2"),X(4,"No Favorites Yet"),$(),N(5,"p"),X(6,"Bookmark your favorite reels to see them here"),$()())}function Pie(n,e){if(n&1){let t=Tt();N(0,"video",33,0),ve("loadedmetadata",function(){xe(t);let r=Ql(1);return Ae(r.currentTime=.1)}),$()}if(n&2){let t=Ce().$implicit;ce("src",t.videoUrl,xa)}}function Rie(n,e){if(n&1){let t=Tt();N(0,"div",15),ve("click",function(){let r=xe(t).$implicit,s=Ce(2);return Ae(s.playReel(r))}),N(1,"div",16),Be(2,Pie,2,1,"video",17),N(3,"div",18),Fe(),N(4,"svg",19),fe(5,"path",20),$()(),Ge(),N(6,"div",21)(7,"span",22),Fe(),N(8,"svg",23),fe(9,"path",24)(10,"circle",25),$(),X(11),$(),Ge(),N(12,"span",22),Fe(),N(13,"svg",23),fe(14,"path",26),$(),X(15),$()()(),Ge(),N(16,"div",27)(17,"h3",28),X(18),$(),N(19,"p",29),X(20),$(),N(21,"div",30)(22,"span",31),X(23),$(),N(24,"span",32),X(25),$()()()()}if(n&2){let t=e.$implicit;K(2),ce("ngIf",t.videoUrl),K(9),pt(" ",t.viewCount||0," "),K(4),pt(" ",t.likes||0," "),K(3),Ot(t.title),K(2),Ot(t.vendor),K(3),pt("\u20B9",t.price,""),K(2),Ot(t.distance)}}function Mie(n,e){if(n&1&&(N(0,"div",13),Be(1,Rie,26,7,"div",14),$()),n&2){let t=Ce();K(),ce("ngForOf",t.bookmarkedReels)}}var ul=class n{constructor(e,t,i,r,s){this.reelsService=e;this.auth=t;this.router=i;this.cdr=r;this.navigationService=s}showHeader=!0;bookmarkedReels=[];isLoading=!0;ngOnInit(){return U(this,null,function*(){yield this.loadBookmarkedReels()})}loadBookmarkedReels(){return U(this,null,function*(){console.log("[Favorites] Starting to load bookmarked reels..."),this.isLoading=!0,this.cdr.detectChanges();try{let e=this.auth.currentUser;if(console.log("[Favorites] Current user:",e?.uid||"Not logged in"),!e){this.bookmarkedReels=[],console.log("[Favorites] No user logged in, clearing bookmarks");return}console.log("[Favorites] Fetching all reels...");let t=yield this.reelsService.getReels(100);console.log("[Favorites] Fetched reels count:",t.length),this.bookmarkedReels=t.filter(i=>this.reelsService.isBookmarkedByUser(i,e.uid)),console.log("[Favorites] Bookmarked reels count:",this.bookmarkedReels.length)}catch(e){console.error("[Favorites] Error loading bookmarked reels:",e)}finally{this.isLoading=!1,this.cdr.detectChanges(),console.log("[Favorites] Loading complete. isLoading:",this.isLoading)}})}playReel(e){console.log("[Favorites] Playing reel:",e.id,e.title),this.navigationService.selectReel(e.id),this.router.navigate(["/main-app"])}static \u0275fac=function(t){return new(t||n)(Te(Fr),Te(Kt),Te(xt),Te(tr),Te(Qd))};static \u0275cmp=Dt({type:n,selectors:[["app-favorites"]],inputs:{showHeader:"showHeader"},standalone:!0,features:[Pt],decls:5,vars:4,consts:[["videoThumb",""],[1,"favorites-container"],["class","favorites-header",4,"ngIf"],["class","loading-state",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","reels-grid",4,"ngIf"],[1,"favorites-header"],[1,"subtitle"],[1,"loading-state"],[1,"spinner"],[1,"empty-state"],["width","80","height","80","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z","stroke","currentColor","stroke-width","2","fill","none"],[1,"reels-grid"],["class","reel-card",3,"click",4,"ngFor","ngForOf"],[1,"reel-card",3,"click"],[1,"reel-thumbnail"],["muted","","playsinline","","preload","metadata",3,"src","loadedmetadata",4,"ngIf"],[1,"play-overlay"],["width","48","height","48","viewBox","0 0 24 24","fill","white"],["d","M8 5v14l11-7z"],[1,"reel-stats"],[1,"stat"],["width","16","height","16","viewBox","0 0 24 24","fill","white"],["d","M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z","stroke","white","stroke-width","2","fill","none"],["cx","12","cy","12","r","3","stroke","white","stroke-width","2","fill","none"],["d","M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"],[1,"reel-info"],[1,"reel-title"],[1,"reel-vendor"],[1,"reel-meta"],[1,"price"],[1,"distance"],["muted","","playsinline","","preload","metadata",3,"loadedmetadata","src"]],template:function(t,i){t&1&&(N(0,"div",1),Be(1,xie,5,0,"div",2)(2,Aie,4,0,"div",3)(3,Die,7,0,"div",4)(4,Mie,2,1,"div",5),$()),t&2&&(K(),ce("ngIf",i.showHeader),K(),ce("ngIf",i.isLoading),K(),ce("ngIf",!i.isLoading&&i.bookmarkedReels.length===0),K(),ce("ngIf",!i.isLoading&&i.bookmarkedReels.length>0))},dependencies:[Ut,di,nn],styles:['@charset "UTF-8";.favorites-container[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000;overflow-y:auto;padding:4rem 1rem 5rem}.favorites-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem;padding:1rem 0}.favorites-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#fff;margin-bottom:.5rem;background:linear-gradient(135deg,#ff6b35,#f7931e);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.favorites-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#888;font-size:.9rem}.loading-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;color:#fff;text-align:center;padding:2rem}.loading-state[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#ff6b35;margin-bottom:1.5rem;opacity:.5}.loading-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:.5rem;color:#fff}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#888;font-size:.95rem}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid rgba(255,255,255,.1);border-left-color:#ff6b35;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.reels-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:1rem;padding:0 .5rem}@media (min-width: 640px){.reels-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:1.5rem}}.reel-card[_ngcontent-%COMP%]{cursor:pointer;transition:transform .2s;animation:_ngcontent-%COMP%_fadeIn .3s ease-in}.reel-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px)}.reel-card[_ngcontent-%COMP%]:active{transform:scale(.98)}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.reel-thumbnail[_ngcontent-%COMP%]{position:relative;width:100%;aspect-ratio:9/16;border-radius:12px;overflow:hidden;background:linear-gradient(135deg,#1a1a1a,#2d2d2d);margin-bottom:.5rem;display:flex;align-items:center;justify-content:center}.reel-thumbnail[_ngcontent-%COMP%]:before{content:"\\1f3ac";font-size:3rem;opacity:.3;position:absolute}.reel-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .reel-thumbnail[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;position:relative;z-index:1}.reel-thumbnail[_ngcontent-%COMP%]   .play-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:#0000004d;opacity:0;transition:opacity .2s;z-index:2}.reel-thumbnail[_ngcontent-%COMP%]   .play-overlay[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{filter:drop-shadow(0 2px 8px rgba(0,0,0,.5))}.reel-thumbnail[_ngcontent-%COMP%]:hover   .play-overlay[_ngcontent-%COMP%]{opacity:1}.reel-thumbnail[_ngcontent-%COMP%]   .reel-stats[_ngcontent-%COMP%]{position:absolute;bottom:.5rem;left:.5rem;right:.5rem;display:flex;gap:.75rem;font-size:.75rem;color:#fff;z-index:2}.reel-thumbnail[_ngcontent-%COMP%]   .reel-stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem;background:#0009;backdrop-filter:blur(1px);padding:.25rem .5rem;border-radius:12px;font-weight:600}.reel-thumbnail[_ngcontent-%COMP%]   .reel-stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0}.reel-info[_ngcontent-%COMP%]   .reel-title[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:#fff;margin-bottom:.25rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.reel-info[_ngcontent-%COMP%]   .reel-vendor[_ngcontent-%COMP%]{font-size:.8rem;color:#888;margin-bottom:.5rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.reel-info[_ngcontent-%COMP%]   .reel-meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.75rem}.reel-info[_ngcontent-%COMP%]   .reel-meta[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff6b35,#f7931e);color:#fff;padding:.25rem .5rem;border-radius:8px;font-weight:600}.reel-info[_ngcontent-%COMP%]   .reel-meta[_ngcontent-%COMP%]   .distance[_ngcontent-%COMP%]{color:#666}']})};var dl=d3(A$());function kie(n,e){n&1&&(N(0,"span"),X(1,"Search"),$())}function Lie(n,e){n&1&&(N(0,"span"),X(1,"..."),$())}function Oie(n,e){if(n&1){let t=Tt();N(0,"div",20),ve("click",function(){let r=xe(t).$implicit,s=Ce(2);return Ae(s.selectSearchResult(r))}),X(1),$()}if(n&2){let t=e.$implicit;K(),pt(" ",t.display_name," ")}}function Nie(n,e){if(n&1&&(N(0,"div",18),Be(1,Oie,2,1,"div",19),$()),n&2){let t=Ce();K(),ce("ngForOf",t.searchResults)}}var K_=class n{locationSelected=new lt;cancel=new lt;map;marker;searchQuery="";searchResults=[];isSearching=!1;selectedLat=12.9716;selectedLng=77.5946;constructor(){}ngOnInit(){}ngAfterViewInit(){this.initMap()}ngOnDestroy(){this.map&&this.map.remove()}initMap(){this.map=dl.map("map").setView([this.selectedLat,this.selectedLng],13),dl.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xA9 OpenStreetMap contributors"}).addTo(this.map),this.addMarker(this.selectedLat,this.selectedLng),this.map.on("click",e=>{this.updateLocation(e.latlng.lat,e.latlng.lng)}),setTimeout(()=>{this.map?.invalidateSize()},100)}addMarker(e,t){if(this.marker)this.marker.setLatLng([e,t]);else{let i=dl.divIcon({className:"custom-pin",html:`<svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="#ff4757" stroke="white" stroke-width="2"/>
               </svg>`,iconSize:[30,30],iconAnchor:[15,30]});this.marker=dl.marker([e,t],{icon:i,draggable:!0}).addTo(this.map),this.marker.on("dragend",()=>{let r=this.marker.getLatLng();this.updateLocation(r.lat,r.lng,!1)})}}updateLocation(e,t,i=!1){this.selectedLat=e,this.selectedLng=t,this.marker?this.marker.setLatLng([e,t]):this.addMarker(e,t),i&&this.map&&this.map.panTo([e,t])}searchLocation(){return U(this,null,function*(){if(this.searchQuery.trim()){this.isSearching=!0,this.searchResults=[];try{let t=yield(yield fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(this.searchQuery)}`)).json();this.searchResults=t}catch(e){console.error("Error searching location:",e)}finally{this.isSearching=!1}}})}selectSearchResult(e){let t=parseFloat(e.lat),i=parseFloat(e.lon);this.updateLocation(t,i,!0),this.searchResults=[],this.searchQuery=e.display_name.split(",")[0]}confirmSelection(){this.locationSelected.emit({lat:this.selectedLat,lng:this.selectedLng})}onCancel(){this.cancel.emit()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=Dt({type:n,selectors:[["app-location-picker"]],outputs:{locationSelected:"locationSelected",cancel:"cancel"},standalone:!0,features:[Pt],decls:27,vars:13,consts:[[1,"picker-overlay"],[1,"picker-container"],[1,"picker-header"],[1,"close-btn",3,"click"],["width","24","height","24","viewBox","0 0 24 24","fill","none"],["d","M18 6L6 18M6 6l12 12","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"search-bar"],["type","text","placeholder","Search for a place...",3,"ngModelChange","keyup.enter","ngModel"],[1,"search-btn",3,"click","disabled"],[4,"ngIf"],["class","search-results",4,"ngIf"],[1,"map-container"],["id","map"],[1,"picker-footer"],[1,"coords"],[1,"actions"],[1,"cancel-btn",3,"click"],[1,"confirm-btn",3,"click"],[1,"search-results"],["class","result-item",3,"click",4,"ngFor","ngForOf"],[1,"result-item",3,"click"]],template:function(t,i){t&1&&(N(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3"),X(4,"Pick Location"),$(),N(5,"button",3),ve("click",function(){return i.onCancel()}),Fe(),N(6,"svg",4),fe(7,"path",5),$()()(),Ge(),N(8,"div",6)(9,"input",7),Bn("ngModelChange",function(s){return qn(i.searchQuery,s)||(i.searchQuery=s),s}),ve("keyup.enter",function(){return i.searchLocation()}),$(),N(10,"button",8),ve("click",function(){return i.searchLocation()}),Be(11,kie,2,0,"span",9)(12,Lie,2,0,"span",9),$()(),Be(13,Nie,2,1,"div",10),N(14,"div",11),fe(15,"div",12),$(),N(16,"div",13)(17,"div",14)(18,"small"),X(19),Gh(20,"number"),Gh(21,"number"),$()(),N(22,"div",15)(23,"button",16),ve("click",function(){return i.onCancel()}),X(24,"Cancel"),$(),N(25,"button",17),ve("click",function(){return i.confirmSelection()}),X(26,"Confirm Location"),$()()()()()),t&2&&(K(9),Vn("ngModel",i.searchQuery),K(),ce("disabled",i.isSearching),K(),ce("ngIf",!i.isSearching),K(),ce("ngIf",i.isSearching),K(),ce("ngIf",i.searchResults.length>0),K(6),Lw("",zh(20,7,i.selectedLat,"1.4-4"),", ",zh(21,10,i.selectedLng,"1.4-4"),""))},dependencies:[Ut,di,nn,Yk,Bi,Vi,Lr,dr],styles:[".picker-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000c;z-index:2000;display:flex;align-items:center;justify-content:center;padding:20px}.picker-container[_ngcontent-%COMP%]{background:#1a1a1a;width:100%;max-width:500px;height:80vh;border-radius:12px;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 4px 20px #00000080}.picker-header[_ngcontent-%COMP%]{padding:15px 20px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,.1)}.picker-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#fff;font-size:1.1rem}.picker-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;padding:5px;cursor:pointer}.search-bar[_ngcontent-%COMP%]{padding:15px;display:flex;gap:10px}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;background:#333;border:1px solid #444;border-radius:8px;padding:10px 15px;color:#fff;font-size:.95rem}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#ff4757}.search-bar[_ngcontent-%COMP%]   .search-btn[_ngcontent-%COMP%]{background:#ff4757;color:#fff;border:none;border-radius:8px;padding:0 20px;font-weight:600;cursor:pointer}.search-bar[_ngcontent-%COMP%]   .search-btn[_ngcontent-%COMP%]:disabled{opacity:.7}.search-results[_ngcontent-%COMP%]{background:#2a2a2a;max-height:150px;overflow-y:auto;border-bottom:1px solid #444}.search-results[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]{padding:12px 15px;color:#ddd;border-bottom:1px solid #333;cursor:pointer;font-size:.9rem}.search-results[_ngcontent-%COMP%]   .result-item[_ngcontent-%COMP%]:hover{background:#333}.map-container[_ngcontent-%COMP%]{flex:1;position:relative;background:#eee}.map-container[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:100%;height:100%}.picker-footer[_ngcontent-%COMP%]{padding:15px 20px;background:#1a1a1a;display:flex;justify-content:space-between;align-items:center;border-top:1px solid rgba(255,255,255,.1)}.picker-footer[_ngcontent-%COMP%]   .coords[_ngcontent-%COMP%]{color:#888;font-family:monospace}.picker-footer[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:10px}.picker-footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-weight:600;cursor:pointer;border:none}.picker-footer[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]{background:#333;color:#fff}.picker-footer[_ngcontent-%COMP%]   .confirm-btn[_ngcontent-%COMP%]{background:#ff4757;color:#fff}"]})};function Fie(n,e){if(n&1){let t=Tt();N(0,"div",45)(1,"div",46)(2,"div",47),Fe(),N(3,"svg",48),fe(4,"path",49)(5,"path",50),$()(),Ge(),N(6,"div",51)(7,"p",52),X(8),$(),N(9,"p",53),X(10),$()(),N(11,"button",54),ve("click",function(){xe(t);let r=Ce();return Ae(r.removeFile())}),Fe(),N(12,"svg",55),fe(13,"path",56),$()()(),Ge(),N(14,"div",57)(15,"div",58),fe(16,"div",59),$(),N(17,"p",60),X(18,"Ready to Upload"),$()()()}if(n&2){let t=Ce();K(8),Ot(t.selectedFile.name),K(2),pt("",(t.selectedFile.size/(1024*1024)).toFixed(2)," MB")}}function Vie(n,e){if(n&1){let t=Tt();N(0,"label",61)(1,"input",62),ve("change",function(r){xe(t);let s=Ce();return Ae(s.onFileSelected(r))}),$(),N(2,"div",63),Fe(),N(3,"svg",64),fe(4,"path",50)(5,"circle",65),$(),Ge(),N(6,"p",66),X(7,"Select Video"),$(),N(8,"p",67),X(9,"MP4, MOV, or WebM (max 100MB)"),$()()()}}function Bie(n,e){if(n&1){let t=Tt();N(0,"div",68),X(1),N(2,"button",69),ve("click",function(){let r=xe(t).index,s=Ce();return Ae(s.removeTag(r))}),Fe(),N(3,"svg",70),fe(4,"path",71),$()()()}if(n&2){let t=e.$implicit,i=Ce();K(),pt(" ",t," "),K(),ce("disabled",i.isUploading)}}function Uie(n,e){if(n&1&&(N(0,"div",72),Fe(),N(1,"svg",55),fe(2,"circle",73)(3,"path",74),$(),X(4),$()),n&2){let t=Ce();K(4),pt(" ",t.uploadError," ")}}function $ie(n,e){if(n&1){let t=Tt();N(0,"div",75)(1,"div",76),Fe(),N(2,"svg",55),fe(3,"path",77)(4,"path",78),$(),Ge(),N(5,"span"),X(6,"Upload successful! Redirecting..."),$()(),N(7,"button",79),ve("click",function(){xe(t);let r=Ce();return Ae(r.cancel())}),X(8,"Done"),$()()}}function jie(n,e){if(n&1&&(N(0,"div",80)(1,"div",81),fe(2,"div",82),$(),N(3,"p",83),X(4),$(),N(5,"small",14),X(6,"Optimizing for high-quality streaming (HLS)"),$()()),n&2){let t=Ce();K(2),Io("width",t.transcodeProgress,"%"),K(2),pt("Processing Video... ",t.transcodeProgress,"%")}}function Gie(n,e){if(n&1&&(N(0,"div",84)(1,"div",81),fe(2,"div",85),$(),N(3,"p",83),X(4),$()()),n&2){let t=Ce();K(2),Io("width",t.uploadProgress,"%"),K(2),pt("Uploading to Swada Cloud... ",t.uploadProgress,"%")}}function zie(n,e){n&1&&(N(0,"span"),X(1,"Upload Reel"),$())}function Hie(n,e){n&1&&(N(0,"span"),X(1,"Uploading..."),$())}function qie(n,e){if(n&1){let t=Tt();N(0,"app-location-picker",86),ve("locationSelected",function(r){xe(t);let s=Ce();return Ae(s.onLocationSelected(r))})("cancel",function(){xe(t);let r=Ce();return Ae(r.closeLocationPicker())}),$()}}var $c=class n{constructor(e,t,i,r){this.reelsService=e;this.auth=t;this.router=i;this.locationService=r}title="Test Reel";vendor="Test Vendor";price=100;categories=["Test"];tagInput="";latitude=12.9716;longitude=77.5946;uploadComplete=new lt;canceled=new lt;selectedFile=null;videoPreviewUrl=null;isUploading=!1;isTranscoding=!1;uploadProgress=0;transcodeProgress=0;uploadError=null;uploadSuccess=!1;transcodeIframe=null;transcodeResolver=null;transcodeRejecter=null;isTranscoderReady=!1;maxFileSize=200*1024*1024;acceptedFormats=["video/mp4","video/quicktime","video/webm"];ngOnInit(){}onFileSelected(e){let t=e.target;if(t.files&&t.files.length>0){let i=t.files[0];this.validateAndSetFile(i)}}validateAndSetFile(e){if(this.uploadError=null,!this.acceptedFormats.includes(e.type)){this.uploadError="Please select a valid video file (MP4, MOV, or WebM)";return}if(e.size>this.maxFileSize){this.uploadError=`File size must be less than ${this.maxFileSize/(1024*1024)}MB`;return}this.selectedFile=e,this.createVideoPreview(e)}createVideoPreview(e){this.videoPreviewUrl&&URL.revokeObjectURL(this.videoPreviewUrl),this.videoPreviewUrl=URL.createObjectURL(e)}removeFile(){this.videoPreviewUrl&&URL.revokeObjectURL(this.videoPreviewUrl),this.selectedFile=null,this.videoPreviewUrl=null,this.uploadError=null}resetForm(){this.removeFile(),this.title="",this.vendor="",this.price=null,this.categories=[],this.tagInput="",this.uploadProgress=0,this.uploadSuccess=!1,this.isUploading=!1,this.latitude=null,this.longitude=null}hasChanges(){return!!(this.selectedFile||this.title||this.vendor||this.price||this.categories.length>0||this.latitude||this.longitude)&&!this.uploadSuccess}isFormValid(){return!!(this.selectedFile&&this.title.trim()&&this.vendor.trim()&&this.price!==null&&this.price>0&&this.categories.length>0&&this.latitude!==null&&this.longitude!==null)}handleTagInput(){if(this.tagInput.includes(",")){let e=this.tagInput.split(",").map(t=>t.trim()).filter(t=>t!==""&&!this.categories.includes(t));e.length>0&&(this.categories=[...this.categories,...e]),this.tagInput=""}}removeTag(e){this.categories.splice(e,1)}showLocationPicker=!1;getCurrentLocation(){return U(this,null,function*(){try{let e=yield this.locationService.getUserLocation();this.latitude=e.latitude,this.longitude=e.longitude}catch(e){console.error("Error getting location:",e),this.uploadError="Failed to get current location. Please enter coordinates manually."}})}openLocationPicker(){this.showLocationPicker=!0}onLocationSelected(e){this.latitude=e.lat,this.longitude=e.lng,this.showLocationPicker=!1}closeLocationPicker(){this.showLocationPicker=!1}initTranscodeIframe(){return this.transcodeIframe?Promise.resolve():new Promise(e=>{this.transcodeIframe=document.createElement("iframe"),this.transcodeIframe.style.display="none",this.transcodeIframe.src="assets/transcoder/index.html",window.addEventListener("message",t=>{let i=t.data;if(!(!i||typeof i!="object"))switch(i.type){case"READY":this.isTranscoderReady=!0,e();break;case"PROGRESS":this.transcodeProgress=Math.round(i.progress*100);break;case"LOG":console.log("[Iframe Transcoder LOG]",i.message);break;case"COMPLETE":this.transcodeResolver&&(this.transcodeResolver({playlist:i.playlist,segments:i.segments}),this.transcodeResolver=null);break;case"ERROR":this.transcodeRejecter&&(this.transcodeRejecter(new Error(i.message)),this.transcodeRejecter=null);break}}),document.body.appendChild(this.transcodeIframe)})}transcodeToHls(e){return U(this,null,function*(){return console.log("[Upload] Starting transcoding process..."),yield this.initTranscodeIframe(),console.log("[Upload] Iframe initialized, sending file to transcode..."),new Promise((t,i)=>{this.transcodeResolver=t,this.transcodeRejecter=i,console.log("[Upload] Posting message to iframe:",{type:"TRANSCODE",fileName:e.name,fileSize:e.size,fileType:e.type}),this.transcodeIframe?.contentWindow?.postMessage({type:"TRANSCODE",file:e,name:e.name},"*")})})}uploadReel(){return U(this,null,function*(){if(!this.isFormValid()||!this.selectedFile){this.uploadError="Please fill in all fields and select a video";return}let t=this.auth.currentUser?.uid||"test-user-id";this.isUploading=!0,this.isTranscoding=!0,this.uploadError=null,this.uploadProgress=0,this.transcodeProgress=0,this.uploadSuccess=!1;try{let i=yield this.transcodeToHls(this.selectedFile);this.isTranscoding=!1;let r=Date.now(),s=`videos/${t}/${r}/`;for(let u=0;u<i.segments.length;u++){let d=i.segments[u],f=`${s}${d.name}`,m=yield pa(this.reelsService.getUploadUrl(f,d.blob.type));yield pa(this.reelsService.uploadToR2(m.uploadUrl,d.blob)),this.uploadProgress=Math.round((u+1)/(i.segments.length+1)*100)}let o=`${s}index.m3u8`,a=yield pa(this.reelsService.getUploadUrl(o,i.playlist.type));yield pa(this.reelsService.uploadToR2(a.uploadUrl,i.playlist)),this.uploadProgress=100;let l=`https://r2-video-uploader.bengaluru-swada.workers.dev/${o}`;yield this.reelsService.createReel({cloudflareVideoId:"",videoUrl:l,thumbnailUrl:"",duration:0,title:this.title.trim(),vendor:this.vendor.trim(),price:this.price,categories:this.categories,latitude:this.latitude,longitude:this.longitude,uploadedBy:t,createdAt:null,viewCount:0,likes:0,likedBy:[],bookmarkedBy:[]}),this.uploadSuccess=!0,this.isUploading=!1,this.uploadComplete.emit(),setTimeout(()=>{this.router.navigate(["/main-app"])},1500)}catch(i){console.error("Upload flow error:",i),this.uploadError=i instanceof Error?i.message:"Unknown error occurred during processing.",this.isUploading=!1,this.isTranscoding=!1}})}cancel(){this.canceled.emit(),this.resetForm(),this.router.navigate(["/main-app"])}ngOnDestroy(){this.videoPreviewUrl&&URL.revokeObjectURL(this.videoPreviewUrl)}static \u0275fac=function(t){return new(t||n)(Te(Fr),Te(Kt),Te(xt),Te(Or))};static \u0275cmp=Dt({type:n,selectors:[["app-upload-reel"]],outputs:{uploadComplete:"uploadComplete",canceled:"canceled"},standalone:!0,features:[Pt],decls:73,vars:27,consts:[["fileSelector",""],[1,"upload-container"],[1,"upload-header"],[1,"spacer"],[1,"upload-content"],[1,"video-preview-section"],["class","video-preview selected",4,"ngIf","ngIfElse"],[1,"form-section"],[1,"form-group"],["for","title"],["type","text","id","title","placeholder","e.g., Masala Dosa",3,"ngModelChange","ngModel","disabled"],[1,"tag-input-container"],["class","tag-pill",4,"ngFor","ngForOf"],["type","text","id","tagInput","placeholder","Add category (comma to separate)",3,"ngModelChange","input","ngModel","disabled"],[1,"helper-text"],["for","vendor"],["type","text","id","vendor","placeholder","e.g., Vidyarthi Bhavan",3,"ngModelChange","ngModel","disabled"],["for","price"],["type","number","id","price","placeholder","50","min","0",3,"ngModelChange","ngModel","disabled"],[1,"form-group","location-group"],[1,"location-actions"],["type","button",1,"location-card",3,"click","disabled"],[1,"card-icon"],["width","24","height","24","viewBox","0 0 24 24","fill","none"],["d","M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","9","r","2.5","fill","currentColor"],[1,"card-content"],[1,"card-title"],[1,"card-subtitle"],["type","button",1,"location-card","map-card",3,"click","disabled"],["d","M3 11V21H21V11M3 11L12 3L21 11M3 11H21","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","14","r","3","stroke","currentColor","stroke-width","2"],[1,"form-row"],["for","latitude"],["type","number","id","latitude","placeholder","12.9352","step","0.0001",3,"ngModelChange","ngModel","disabled"],["for","longitude"],["type","number","id","longitude","placeholder","77.6245","step","0.0001",3,"ngModelChange","ngModel","disabled"],["class","error-message",4,"ngIf"],["class","success-message",4,"ngIf"],["class","upload-progress transcoding",4,"ngIf"],["class","upload-progress",4,"ngIf"],[1,"action-buttons"],[1,"upload-btn",3,"click","disabled"],[4,"ngIf"],[3,"locationSelected","cancel",4,"ngIf"],[1,"video-preview","selected"],[1,"file-info-header"],[1,"file-icon"],["width","32","height","32","viewBox","0 0 24 24","fill","none"],["d","M15 10L19 14L15 18","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z","stroke","currentColor","stroke-width","2"],[1,"file-details"],[1,"file-name"],[1,"file-size"],[1,"remove-video-btn",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","none"],["d","M18 6L6 18M6 6l12 12","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"ready-progress"],[1,"progress-bar-container"],[1,"progress-bar-fill",2,"width","100%"],[1,"progress-status"],[1,"file-selector"],["type","file","accept","video/mp4,video/quicktime,video/webm","hidden","",3,"change"],[1,"file-selector-content"],["width","48","height","48","viewBox","0 0 24 24","fill","none"],["cx","12","cy","13","r","4","stroke","currentColor","stroke-width","2"],[1,"selector-title"],[1,"selector-subtitle"],[1,"tag-pill"],[1,"remove-tag",3,"click","disabled"],["width","12","height","12","viewBox","0 0 24 24","fill","none"],["d","M18 6L6 18M6 6l12 12","stroke","currentColor","stroke-width","2.5","stroke-linecap","round"],[1,"error-message"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","2"],["d","M12 8v4M12 16h.01","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"success-message"],[1,"success-info"],["d","M22 11.08V12a10 10 0 1 1-5.93-9.14","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["d","M22 4L12 14.01l-3-3","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"done-btn-fallback",3,"click"],[1,"upload-progress","transcoding"],[1,"progress-bar"],[1,"progress-fill","transcode-fill"],[1,"progress-text"],[1,"upload-progress"],[1,"progress-fill"],[3,"locationSelected","cancel"]],template:function(t,i){if(t&1){let r=Tt();N(0,"div",1)(1,"div",2)(2,"h1"),X(3,"Upload Reel"),$(),fe(4,"div",3),$(),N(5,"div",4)(6,"div",5),Be(7,Fie,19,2,"div",6)(8,Vie,10,0,"ng-template",null,0,s0),$(),N(10,"div",7)(11,"div",8)(12,"label",9),X(13,"Dish Name *"),$(),N(14,"input",10),Bn("ngModelChange",function(o){return xe(r),qn(i.title,o)||(i.title=o),Ae(o)}),$()(),N(15,"div",8)(16,"label"),X(17,"Categories *"),$(),N(18,"div",11),Be(19,Bie,5,2,"div",12),N(20,"input",13),Bn("ngModelChange",function(o){return xe(r),qn(i.tagInput,o)||(i.tagInput=o),Ae(o)}),ve("input",function(){return xe(r),Ae(i.handleTagInput())}),$()(),N(21,"small",14),X(22,"Add items like Breakfast, South Indian, Spicy, etc."),$()(),N(23,"div",8)(24,"label",15),X(25,"Vendor Name *"),$(),N(26,"input",16),Bn("ngModelChange",function(o){return xe(r),qn(i.vendor,o)||(i.vendor=o),Ae(o)}),$()(),N(27,"div",8)(28,"label",17),X(29,"Price (\u20B9) *"),$(),N(30,"input",18),Bn("ngModelChange",function(o){return xe(r),qn(i.price,o)||(i.price=o),Ae(o)}),$()(),N(31,"div",19)(32,"label"),X(33,"Store Location *"),$(),N(34,"div",20)(35,"button",21),ve("click",function(){return xe(r),Ae(i.getCurrentLocation())}),N(36,"div",22),Fe(),N(37,"svg",23),fe(38,"path",24)(39,"circle",25),$()(),Ge(),N(40,"div",26)(41,"span",27),X(42,"Current Location"),$(),N(43,"span",28),X(44,"Use GPS coordinates"),$()()(),N(45,"button",29),ve("click",function(){return xe(r),Ae(i.openLocationPicker())}),N(46,"div",22),Fe(),N(47,"svg",23),fe(48,"path",30)(49,"circle",31),$()(),Ge(),N(50,"div",26)(51,"span",27),X(52,"Pick on Map"),$(),N(53,"span",28),X(54,"Select manually"),$()()()()(),N(55,"div",32)(56,"div",8)(57,"label",33),X(58,"Latitude *"),$(),N(59,"input",34),Bn("ngModelChange",function(o){return xe(r),qn(i.latitude,o)||(i.latitude=o),Ae(o)}),$()(),N(60,"div",8)(61,"label",35),X(62,"Longitude *"),$(),N(63,"input",36),Bn("ngModelChange",function(o){return xe(r),qn(i.longitude,o)||(i.longitude=o),Ae(o)}),$()()(),Be(64,Uie,5,1,"div",37)(65,$ie,9,0,"div",38)(66,jie,7,3,"div",39)(67,Gie,5,3,"div",40),N(68,"div",41)(69,"button",42),ve("click",function(){return xe(r),Ae(i.uploadReel())}),Be(70,zie,2,0,"span",43)(71,Hie,2,0,"span",43),$()()()(),Be(72,qie,1,0,"app-location-picker",44),$()}if(t&2){let r=Ql(9);K(7),ce("ngIf",i.selectedFile)("ngIfElse",r),K(7),Vn("ngModel",i.title),ce("disabled",i.isUploading),K(4),ct("disabled",i.isUploading),K(),ce("ngForOf",i.categories),K(),Vn("ngModel",i.tagInput),ce("disabled",i.isUploading),K(6),Vn("ngModel",i.vendor),ce("disabled",i.isUploading),K(4),Vn("ngModel",i.price),ce("disabled",i.isUploading),K(5),ce("disabled",i.isUploading),K(10),ce("disabled",i.isUploading),K(14),Vn("ngModel",i.latitude),ce("disabled",i.isUploading),K(4),Vn("ngModel",i.longitude),ce("disabled",i.isUploading),K(),ce("ngIf",i.uploadError),K(),ce("ngIf",i.uploadSuccess),K(),ce("ngIf",i.isTranscoding),K(),ce("ngIf",i.isUploading&&!i.isTranscoding),K(2),ce("disabled",!i.isFormValid()||i.isUploading),K(),ce("ngIf",!i.isUploading),K(),ce("ngIf",i.isUploading),K(),ce("ngIf",i.showLocationPicker)}},dependencies:[Ut,di,nn,Bi,Vi,nA,Lr,rA,dr,K_],styles:['.upload-container[_ngcontent-%COMP%]{height:100vh;background:#0a0a0a;padding:0 0 100px;overflow-y:auto;position:relative}.upload-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:20px;background:#00000080;backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.1);position:sticky;top:0;z-index:10}.upload-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;font-weight:600;margin:0;color:#fff}.upload-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]{background:transparent;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#fff;cursor:pointer;transition:all .2s ease;border-radius:50%}.upload-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a}.upload-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]:active{transform:scale(.95)}.upload-header[_ngcontent-%COMP%]   .spacer[_ngcontent-%COMP%]{width:40px}.upload-content[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;padding:20px}.video-preview-section[_ngcontent-%COMP%]{margin-bottom:24px}.video-preview[_ngcontent-%COMP%]{position:relative;background:#1a1a1a;border-radius:16px;overflow:hidden;aspect-ratio:9/16;max-height:500px;border:1px solid rgba(255,255,255,.1)}.video-preview[_ngcontent-%COMP%]   .preview-video[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.video-preview.selected[_ngcontent-%COMP%]{aspect-ratio:auto;padding:24px;display:flex;flex-direction:column;gap:24px;background:#1a1a1a;min-height:auto}.video-preview[_ngcontent-%COMP%]   .file-info-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;position:relative}.video-preview[_ngcontent-%COMP%]   .file-icon[_ngcontent-%COMP%]{width:56px;height:56px;background:#ff6b351a;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#ff6b35}.video-preview[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]{flex:1}.video-preview[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#fff;margin:0 0 4px;word-break:break-all}.video-preview[_ngcontent-%COMP%]   .file-details[_ngcontent-%COMP%]   .file-size[_ngcontent-%COMP%]{font-size:14px;color:#888;margin:0}.video-preview[_ngcontent-%COMP%]   .ready-progress[_ngcontent-%COMP%]   .progress-bar-container[_ngcontent-%COMP%]{height:8px;background:#ffffff0d;border-radius:4px;overflow:hidden;margin-bottom:8px}.video-preview[_ngcontent-%COMP%]   .ready-progress[_ngcontent-%COMP%]   .progress-bar-container[_ngcontent-%COMP%]   .progress-bar-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#ff6b35,#ff8c42);border-radius:4px}.video-preview[_ngcontent-%COMP%]   .ready-progress[_ngcontent-%COMP%]   .progress-status[_ngcontent-%COMP%]{font-size:13px;font-weight:500;color:#34c759;margin:0}.video-preview[_ngcontent-%COMP%]   .remove-video-btn[_ngcontent-%COMP%]{position:static;background:#ffffff0d;border:1px solid rgba(255,255,255,.1);border-radius:50%;width:36px;height:36px;display:flex;align-items:center;justify-content:center;color:#888;cursor:pointer;transition:all .2s ease}.video-preview[_ngcontent-%COMP%]   .remove-video-btn[_ngcontent-%COMP%]:hover{background:#ff3b301a;color:#ff3b30;border-color:#ff3b3033}.file-selector[_ngcontent-%COMP%]{display:block;cursor:pointer}.file-selector[_ngcontent-%COMP%]   .file-selector-content[_ngcontent-%COMP%]{background:#1a1a1a;border-radius:16px;padding:60px 40px;text-align:center;border:2px dashed rgba(255,107,53,.3);transition:all .3s ease}.file-selector[_ngcontent-%COMP%]   .file-selector-content[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#ff6b35;margin-bottom:20px}.file-selector[_ngcontent-%COMP%]   .file-selector-content[_ngcontent-%COMP%]   .selector-title[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#fff;margin:0 0 8px}.file-selector[_ngcontent-%COMP%]   .file-selector-content[_ngcontent-%COMP%]   .selector-subtitle[_ngcontent-%COMP%]{font-size:14px;color:#888;margin:0}.file-selector[_ngcontent-%COMP%]   .file-selector-content[_ngcontent-%COMP%]:hover{border-color:#ff6b35;background:#222;transform:translateY(-2px);box-shadow:0 8px 24px #ff6b3533}.form-section[_ngcontent-%COMP%]{background:#1a1a1a;border-radius:16px;padding:24px;border:1px solid rgba(255,255,255,.1)}.form-section[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-section[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:13px;font-weight:600;color:#aaa;margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px}.form-section[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:14px 16px;background:#0a0a0a;border:1px solid rgba(255,255,255,.1);border-radius:12px;font-size:16px;color:#fff;transition:all .2s ease;box-sizing:border-box}.form-section[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#ff6b35;background:#111;box-shadow:0 0 0 3px #ff6b351a}.form-section[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled{background:#0a0a0a;opacity:.5;cursor:not-allowed}.form-section[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#555}.form-section[_ngcontent-%COMP%]   .tag-input-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;padding:10px 14px;background:#0a0a0a;border:1px solid rgba(255,255,255,.1);border-radius:12px;min-height:52px;align-items:center;transition:all .2s ease;box-sizing:border-box;margin-bottom:8px}.form-section[_ngcontent-%COMP%]   .tag-input-container[_ngcontent-%COMP%]:focus-within{border-color:#ff6b35;background:#111;box-shadow:0 0 0 3px #ff6b351a}.form-section[_ngcontent-%COMP%]   .tag-input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;min-width:120px;border:none!important;background:transparent!important;padding:4px 0!important;margin:0!important;box-shadow:none!important;height:auto!important;font-size:15px;color:#fff}.form-section[_ngcontent-%COMP%]   .tag-input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#555}.form-section[_ngcontent-%COMP%]   .tag-input-container.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.form-section[_ngcontent-%COMP%]   .tag-pill[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:linear-gradient(135deg,#ff6b35,#ff8c42);color:#fff;padding:6px 14px;border-radius:10px;font-size:14px;font-weight:700;box-shadow:0 4px 10px #ff6b3533;animation:_ngcontent-%COMP%_tag-pop .3s cubic-bezier(.175,.885,.32,1.275);border:1px solid rgba(255,255,255,.2)}.form-section[_ngcontent-%COMP%]   .tag-pill[_ngcontent-%COMP%]   .remove-tag[_ngcontent-%COMP%]{background:#00000026;border:none;color:#fff;padding:2px;cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all .2s}.form-section[_ngcontent-%COMP%]   .tag-pill[_ngcontent-%COMP%]   .remove-tag[_ngcontent-%COMP%]:hover{background:#fff3;transform:scale(1.1)}.form-section[_ngcontent-%COMP%]   .tag-pill[_ngcontent-%COMP%]   .remove-tag[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:12px;height:12px}.form-section[_ngcontent-%COMP%]   .helper-text[_ngcontent-%COMP%]{display:block;margin-top:8px;font-size:12px;color:#888;font-weight:400;padding-left:4px;margin-bottom:20px}.form-section[_ngcontent-%COMP%]   .location-actions[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:4px;margin-bottom:20px}.form-section[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]{background:#0a0a0a;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;display:flex;flex-direction:column;align-items:flex-start;gap:12px;cursor:pointer;transition:all .25s cubic-bezier(.4,0,.2,1);text-align:left;color:#fff;position:relative;overflow:hidden}.form-section[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:0;background:radial-gradient(circle at center,rgba(255,107,53,.1) 0%,transparent 70%);opacity:0;transition:opacity .3s ease}.form-section[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{width:44px;height:44px;background:#ffffff08;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#ff6b35;transition:all .3s ease}.form-section[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.form-section[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#fff}.form-section[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]   .card-subtitle[_ngcontent-%COMP%]{font-size:11px;color:#666;text-transform:none;letter-spacing:0}.form-section[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]:hover:not(:disabled){border-color:#ff6b3566;background:#111;transform:translateY(-2px);box-shadow:0 8px 16px #0006}.form-section[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]:hover:not(:disabled):after{opacity:1}.form-section[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]:hover:not(:disabled)   .card-icon[_ngcontent-%COMP%]{background:#ff6b351f;transform:scale(1.05)}.form-section[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]:hover:not(:disabled)   .card-subtitle[_ngcontent-%COMP%]{color:#888}.form-section[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]:active:not(:disabled){transform:scale(.97)}.form-section[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.form-section[_ngcontent-%COMP%]   .location-card.map-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{color:#4da3ff}.form-section[_ngcontent-%COMP%]   .location-card.map-card[_ngcontent-%COMP%]:hover:not(:disabled){border-color:#4da3ff66}.form-section[_ngcontent-%COMP%]   .location-card.map-card[_ngcontent-%COMP%]:hover:not(:disabled):after{background:radial-gradient(circle at center,rgba(77,163,255,.1) 0%,transparent 70%)}.form-section[_ngcontent-%COMP%]   .location-card.map-card[_ngcontent-%COMP%]:hover:not(:disabled)   .card-icon[_ngcontent-%COMP%]{background:#4da3ff1f}.form-section[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px}.form-section[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%], .form-section[_ngcontent-%COMP%]   .success-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:14px 16px;border-radius:12px;font-size:14px;margin-bottom:20px;font-weight:500}.form-section[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{background:#ff3b301a;color:#ff3b30;border:1px solid rgba(255,59,48,.3)}.form-section[_ngcontent-%COMP%]   .success-message[_ngcontent-%COMP%]{background:#34c7591a;color:#34c759;border:1px solid rgba(52,199,89,.3);flex-direction:column;align-items:stretch;gap:16px}.form-section[_ngcontent-%COMP%]   .success-message[_ngcontent-%COMP%]   .success-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.form-section[_ngcontent-%COMP%]   .success-message[_ngcontent-%COMP%]   .done-btn-fallback[_ngcontent-%COMP%]{background:#34c759;color:#fff;border:none;padding:10px 16px;border-radius:8px;font-weight:600;cursor:pointer;font-size:14px;transition:all .2s ease}.form-section[_ngcontent-%COMP%]   .success-message[_ngcontent-%COMP%]   .done-btn-fallback[_ngcontent-%COMP%]:hover{background:#2fb34f;transform:translateY(-1px)}.form-section[_ngcontent-%COMP%]   .upload-progress[_ngcontent-%COMP%]{margin-bottom:24px}.form-section[_ngcontent-%COMP%]   .upload-progress.transcoding[_ngcontent-%COMP%]   .helper-text[_ngcontent-%COMP%]{display:block;margin-top:4px;font-size:11px;color:#ff6b35;text-align:center;opacity:.8}.form-section[_ngcontent-%COMP%]   .upload-progress[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{height:6px;background:#ffffff1a;border-radius:3px;overflow:hidden;margin-bottom:8px}.form-section[_ngcontent-%COMP%]   .upload-progress[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]   .progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#ff6b35,#ff8c42);transition:width .3s ease;border-radius:3px}.form-section[_ngcontent-%COMP%]   .upload-progress[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]   .progress-fill.transcode-fill[_ngcontent-%COMP%]{background:linear-gradient(90deg,#4da3ff,#a855f7)}.form-section[_ngcontent-%COMP%]   .upload-progress[_ngcontent-%COMP%]   .progress-text[_ngcontent-%COMP%]{font-size:13px;color:#888;text-align:center;margin:0;font-weight:500}.form-section[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:12px;margin-top:24px}.form-section[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:16px 24px;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;transition:all .2s ease;border:none}.form-section[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.form-section[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active:not(:disabled){transform:scale(.98)}.form-section[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .upload-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff6b35,#ff8c42);color:#fff;box-shadow:0 4px 12px #ff6b354d}.form-section[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .upload-btn[_ngcontent-%COMP%]:hover:not(:disabled){box-shadow:0 6px 20px #ff6b3566;transform:translateY(-2px)}@media (max-width: 768px){.upload-container[_ngcontent-%COMP%]{padding-bottom:100px}.upload-content[_ngcontent-%COMP%]{padding:16px}.form-section[_ngcontent-%COMP%]{padding:20px}.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}@keyframes _ngcontent-%COMP%_tag-pop{0%{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}']})};function Wie(n,e){if(n&1){let t=Tt();N(0,"div",38),ve("click",function(){let r=xe(t).$implicit,s=Ce(2);return Ae(s.selectLocation(r))}),N(1,"div",39),Fe(),N(2,"svg",40),fe(3,"path",6),$()(),Ge(),N(4,"div",41)(5,"div",42),X(6),$(),N(7,"div",43),X(8),$()(),Fe(),N(9,"svg",44),fe(10,"path",45),$()()}if(n&2){let t=e.$implicit;K(6),Ot(t.name),K(2),pt("Pincode: ",t.pincode,"")}}function Kie(n,e){n&1&&(N(0,"div",46),Fe(),N(1,"svg",47),fe(2,"circle",32)(3,"path",33),$(),Ge(),N(4,"p"),X(5,"No locations found"),$(),N(6,"span"),X(7,"Try searching for a different area"),$()())}function Yie(n,e){if(n&1){let t=Tt();N(0,"div",24),ve("click",function(){xe(t);let r=Ce();return Ae(r.closeLocationModal())}),N(1,"div",25),ve("click",function(r){return xe(t),Ae(r.stopPropagation())}),N(2,"div",26)(3,"h2"),X(4,"Select Location"),$(),N(5,"button",27),ve("click",function(){xe(t);let r=Ce();return Ae(r.closeLocationModal())}),Fe(),N(6,"svg",28),fe(7,"path",29),$()()(),Ge(),N(8,"div",30),Fe(),N(9,"svg",31),fe(10,"circle",32)(11,"path",33),$(),Ge(),N(12,"input",34),Bn("ngModelChange",function(r){xe(t);let s=Ce();return qn(s.locationSearchQuery,r)||(s.locationSearchQuery=r),Ae(r)}),$()(),N(13,"div",35),Be(14,Wie,11,2,"div",36)(15,Kie,8,0,"div",37),$()()()}if(n&2){let t=Ce();K(12),Vn("ngModel",t.locationSearchQuery),K(2),ce("ngForOf",t.filteredLocations),K(),ce("ngIf",t.filteredLocations.length===0)}}function Qie(n,e){if(n&1){let t=Tt();N(0,"button",48),ve("click",function(){let r=xe(t).$implicit,s=Ce();return Ae(s.selectPrice(r))}),X(1),$()}if(n&2){let t=e.$implicit,i=Ce();ct("active",i.selectedPriceRange===t),K(),pt(" ",t.label," ")}}function Zie(n,e){if(n&1){let t=Tt();N(0,"button",48),ve("click",function(){let r=xe(t).$implicit,s=Ce();return Ae(s.selectDistance(r))}),X(1),$()}if(n&2){let t=e.$implicit,i=Ce();ct("active",i.selectedDistance===t),K(),pt(" ",t.label," ")}}function Xie(n,e){if(n&1){let t=Tt();N(0,"button",48),ve("click",function(){let r=xe(t).$implicit,s=Ce();return Ae(s.selectSort(r))}),X(1),$()}if(n&2){let t=e.$implicit,i=Ce();ct("active",i.selectedSort===t),K(),pt(" ",t," ")}}function Jie(n,e){n&1&&(N(0,"div",49),fe(1,"div",50),$())}function ere(n,e){n&1&&(N(0,"div")(1,"p"),X(2,"Search for your favorite food or browse categories!"),$()())}function tre(n,e){n&1&&(N(0,"p"),X(1,"No tasty bites found matching your search."),$())}function nre(n,e){if(n&1&&(N(0,"div",51),Be(1,ere,3,0,"div",52)(2,tre,2,0,"ng-template",null,0,s0),$()),n&2){let t=Ql(3),i=Ce();K(),ce("ngIf",i.reels.length===0)("ngIfElse",t)}}function ire(n,e){if(n&1){let t=Tt();N(0,"div",53),ve("click",function(){let r=xe(t).$implicit,s=Ce();return Ae(s.openReel(r))}),N(1,"div",54)(2,"video",55,1),ve("loadedmetadata",function(){xe(t);let r=Ql(3);return Ae(r.currentTime=.1)}),$(),N(4,"div",56),X(5),$()(),N(6,"div",57)(7,"div",58)(8,"h3",59),X(9),$()(),N(10,"p",60),X(11),$(),N(12,"div",61)(13,"span",62),X(14),$()()()()}if(n&2){let t=e.$implicit;K(2),ce("src",t.videoUrl,xa),K(3),Ot(t.distanceStr),K(4),Ot(t.title),K(2),Ot(t.vendor),K(3),pt("\u20B9",t.price,"")}}var Y_=class n{constructor(e,t,i){this.reelsService=e;this.locationService=t;this.router=i}searchQuery="";reels=[];filteredReels=[];isLoading=!1;locationName="Koramangala, Bangalore";showLocationModal=!1;locationSearchQuery="";categories=["All","South Indian","North Indian","Street Food","Desserts","Beverages"];selectedCategory="All";priceRanges=[{label:"All",min:0,max:1/0},{label:"\u20B90-30",min:0,max:30},{label:"\u20B931-60",min:31,max:60},{label:"\u20B961-100",min:61,max:100},{label:"\u20B9100+",min:101,max:1/0}];selectedPriceRange=this.priceRanges[0];distances=[{label:"All",max:1/0},{label:"< 1 km",max:1},{label:"1-3 km",max:3},{label:"3-5 km",max:5},{label:"5+ km",max:1/0}];selectedDistance=this.distances[0];sortOptions=["Nearest First","Price: Low to High","Price: High to Low"];selectedSort="Nearest First";ngOnInit(){return U(this,null,function*(){this.locationService.currentLocation$.subscribe(e=>{e&&(this.locationName=`${e.name}, Bangalore`,this.reels.length>0&&this.loadReels())});try{let e=yield this.locationService.getUserLocation();this.locationName=this.locationService.getAreaName(e.latitude,e.longitude)+", Bangalore"}catch(e){console.warn("Could not get initial location name",e)}})}loadReels(){return U(this,null,function*(){this.isLoading=!0;try{let e=yield this.reelsService.getReels(50);this.reels=yield Promise.all(e.map(t=>U(this,null,function*(){let i=1/0,r="-- km";if(t.latitude&&t.longitude)try{let s=yield this.locationService.getUserLocation();i=this.locationService.calculateDistance(s.latitude,s.longitude,t.latitude,t.longitude),r=i.toFixed(1)+" km"}catch(s){console.error("Error calculating distance",s)}return Ye(ue({},t),{distanceVal:i,distanceStr:r,rating:(4+Math.random()).toFixed(1)})})))}catch(e){console.error("Error loading reels for search:",e)}finally{this.isLoading=!1}})}applyFilters(){return U(this,null,function*(){if(this.reels.length===0&&!this.isLoading){let t=this.searchQuery.trim().length>0,i=this.selectedCategory!=="All"||this.selectedPriceRange.label!=="All"||this.selectedDistance.label!=="All";if(t||i)yield this.loadReels();else{this.filteredReels=[];return}}let e=this.reels;if(this.searchQuery.trim()){let t=this.searchQuery.toLowerCase();e=e.filter(i=>i.title?.toLowerCase().includes(t)||i.vendor?.toLowerCase().includes(t))}if(this.selectedCategory!=="All"&&(e=e.filter(t=>t.categories&&Array.isArray(t.categories)&&t.categories.includes(this.selectedCategory))),e=e.filter(t=>{let i=Number(t.price);return i>=this.selectedPriceRange.min&&i<=this.selectedPriceRange.max}),this.selectedDistance.label!=="All")if(this.selectedDistance.label==="5+ km")e=e.filter(t=>t.distanceVal>5&&t.distanceVal!==1/0);else if(this.selectedDistance.label==="< 1 km")e=e.filter(t=>t.distanceVal<1);else{let t=this.selectedDistance.max,i=this.distances[this.distances.indexOf(this.selectedDistance)-1]?.max||0;this.selectedDistance.label==="1-3 km"?e=e.filter(r=>r.distanceVal>=1&&r.distanceVal<=3):this.selectedDistance.label==="3-5 km"&&(e=e.filter(r=>r.distanceVal>=3&&r.distanceVal<=5))}this.selectedSort==="Nearest First"?e.sort((t,i)=>t.distanceVal-i.distanceVal):this.selectedSort==="Price: Low to High"?e.sort((t,i)=>Number(t.price)-Number(i.price)):this.selectedSort==="Price: High to Low"&&e.sort((t,i)=>Number(i.price)-Number(t.price)),this.filteredReels=e})}selectCategory(e){this.selectedCategory=e,this.applyFilters()}selectPrice(e){this.selectedPriceRange=e,this.applyFilters()}selectDistance(e){this.selectedDistance=e,this.applyFilters()}selectSort(e){this.selectedSort=e,this.applyFilters()}openReel(e){this.router.navigate(["/main-app"],{state:{openFeed:!0,reelId:e.id}})}openLocationModal(){this.showLocationModal=!0,this.locationSearchQuery=""}closeLocationModal(){this.showLocationModal=!1,this.locationSearchQuery=""}selectLocation(e){this.locationService.updateLocation(e.name,e.lat,e.lng),this.closeLocationModal()}get filteredLocations(){let e=this.locationSearchQuery.toLowerCase().trim();return e?this.locationService.AREAS.filter(t=>t.name.toLowerCase().includes(e)||t.pincode.includes(e)):this.locationService.AREAS}static \u0275fac=function(t){return new(t||n)(Te(Fr),Te(Or),Te(xt))};static \u0275cmp=Dt({type:n,selectors:[["app-search"]],standalone:!0,features:[Pt],decls:32,vars:9,consts:[["noResults",""],["videoThumb",""],[1,"search-container"],[1,"search-header"],[1,"location-context",3,"click"],["width","16","height","16","viewBox","0 0 24 24","fill","none",1,"location-pin"],["d","M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z","fill","currentColor"],[1,"location-text"],["width","12","height","12","viewBox","0 0 24 24","fill","none",1,"chevron-down"],["d","M6 9l6 6 6-6","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"search-bar"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"search-icon"],["cx","11","cy","11","r","8"],["x1","21","y1","21","x2","16.65","y2","16.65"],["type","text","placeholder","Search dosa, vada pav, biryani...",3,"ngModelChange","ngModel"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"filters-scroll"],[1,"filter-section-title"],[1,"filter-group"],["class","chip",3,"active","click",4,"ngFor","ngForOf"],[1,"results-grid"],["class","loading-spinner",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","food-card",3,"click",4,"ngFor","ngForOf"],[1,"modal-overlay",3,"click"],[1,"location-modal",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],["width","24","height","24","viewBox","0 0 24 24","fill","none"],["d","M18 6L6 18M6 6l12 12","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"modal-search-box"],["width","20","height","20","viewBox","0 0 24 24","fill","none",1,"search-icon"],["cx","11","cy","11","r","8","stroke","currentColor","stroke-width","2"],["d","M21 21l-4.35-4.35","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["type","text","placeholder","Search for a location...",1,"search-input",3,"ngModelChange","ngModel"],[1,"locations-list"],["class","location-item",3,"click",4,"ngFor","ngForOf"],["class","no-results",4,"ngIf"],[1,"location-item",3,"click"],[1,"location-icon"],["width","20","height","20","viewBox","0 0 24 24","fill","none"],[1,"location-info"],[1,"location-name"],[1,"location-area"],["width","20","height","20","viewBox","0 0 24 24","fill","none",1,"chevron-right"],["d","M9 18l6-6-6-6","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"no-results"],["width","48","height","48","viewBox","0 0 24 24","fill","none"],[1,"chip",3,"click"],[1,"loading-spinner"],[1,"spinner"],[1,"empty-state"],[4,"ngIf","ngIfElse"],[1,"food-card",3,"click"],[1,"card-image"],["muted","","playsinline","","preload","metadata",3,"loadedmetadata","src"],[1,"distance-badge"],[1,"card-details"],[1,"header-row"],[1,"dish-name"],[1,"vendor-name"],[1,"price-row"],[1,"price"]],template:function(t,i){t&1&&(N(0,"div",2)(1,"div",3)(2,"div",4),ve("click",function(){return i.openLocationModal()}),Fe(),N(3,"svg",5),fe(4,"path",6),$(),Ge(),N(5,"span",7),X(6),$(),Fe(),N(7,"svg",8),fe(8,"path",9),$()(),Ge(),N(9,"div",10),Fe(),N(10,"svg",11),fe(11,"circle",12)(12,"line",13),$(),Ge(),N(13,"input",14),Bn("ngModelChange",function(s){return qn(i.searchQuery,s)||(i.searchQuery=s),s}),ve("ngModelChange",function(){return i.applyFilters()}),$()()(),Be(14,Yie,16,3,"div",15),N(15,"div",16)(16,"div",17),X(17,"Price Range"),$(),N(18,"div",18),Be(19,Qie,2,3,"button",19),$(),N(20,"div",17),X(21,"Distance"),$(),N(22,"div",18),Be(23,Zie,2,3,"button",19),$(),N(24,"div",17),X(25,"Sort By"),$(),N(26,"div",18),Be(27,Xie,2,3,"button",19),$()(),N(28,"div",20),Be(29,Jie,2,0,"div",21)(30,nre,4,2,"div",22)(31,ire,15,5,"div",23),$()()),t&2&&(K(6),Ot(i.locationName),K(7),Vn("ngModel",i.searchQuery),K(),ce("ngIf",i.showLocationModal),K(5),ce("ngForOf",i.priceRanges),K(4),ce("ngForOf",i.distances),K(4),ce("ngForOf",i.sortOptions),K(2),ce("ngIf",i.isLoading),K(),ce("ngIf",!i.isLoading&&i.filteredReels.length===0),K(),ce("ngForOf",i.filteredReels))},dependencies:[Ut,di,nn,Bi,Vi,Lr,dr],styles:["[_nghost-%COMP%]{display:block;height:100%;width:100%;overflow:hidden}.search-container[_ngcontent-%COMP%]{height:100%;overflow-y:auto;background:#000;padding-bottom:100px;color:#fff;-webkit-overflow-scrolling:touch}.search-header[_ngcontent-%COMP%]{padding:16px;background:#000;position:sticky;top:0;z-index:10;display:flex;flex-direction:column;gap:12px}.location-context[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:#ffffff0d;padding:8px 16px;border-radius:12px;color:#ff6b35;font-size:.9rem;font-weight:500;cursor:pointer;width:fit-content;border:1px solid rgba(255,107,53,.2)}.location-context[_ngcontent-%COMP%]   .location-text[_ngcontent-%COMP%]{color:#fff}.location-context[_ngcontent-%COMP%]   .chevron-down[_ngcontent-%COMP%]{color:#888}.search-bar[_ngcontent-%COMP%]{display:flex;align-items:center;background:#1a1a1a;border-radius:12px;padding:12px 16px;border:1px solid rgba(255,255,255,.1)}.search-bar[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{color:#888;margin-right:12px}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:transparent;border:none;color:#fff;font-size:15px;width:100%;outline:none}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#666}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000d9;backdrop-filter:blur(4px);z-index:1000;display:flex;align-items:flex-end}.location-modal[_ngcontent-%COMP%]{background:#121212;width:100%;max-height:80vh;border-radius:24px 24px 0 0;display:flex;flex-direction:column;border:1px solid rgba(255,255,255,.1)}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:24px 20px 16px;border-bottom:1px solid rgba(255,255,255,.05)}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#fff;margin:0}.modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#888;cursor:pointer}.modal-search-box[_ngcontent-%COMP%]{padding:16px 20px;position:relative}.modal-search-box[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{position:absolute;left:36px;top:50%;transform:translateY(-50%);color:#666}.modal-search-box[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{width:100%;padding:14px 16px 14px 48px;background:#1e1e1e;border:1px solid rgba(255,255,255,.1);border-radius:12px;color:#fff;box-sizing:border-box}.modal-search-box[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#ff6b35}.locations-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding-bottom:24px}.location-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:16px 20px;cursor:pointer;border-bottom:1px solid rgba(255,255,255,.05)}.location-item[_ngcontent-%COMP%]:hover{background:#ffffff0d}.location-item[_ngcontent-%COMP%]   .location-icon[_ngcontent-%COMP%]{width:40px;height:40px;background:#ff6b351a;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#ff6b35}.location-item[_ngcontent-%COMP%]   .location-info[_ngcontent-%COMP%]{flex:1}.location-item[_ngcontent-%COMP%]   .location-info[_ngcontent-%COMP%]   .location-name[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#fff}.location-item[_ngcontent-%COMP%]   .location-info[_ngcontent-%COMP%]   .location-area[_ngcontent-%COMP%]{font-size:13px;color:#888}.no-results[_ngcontent-%COMP%]{padding:60px 20px;text-align:center;color:#666}.no-results[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin-bottom:8px}.filters-scroll[_ngcontent-%COMP%]{padding:0 16px 16px}.filters-scroll[_ngcontent-%COMP%]   .filter-section-title[_ngcontent-%COMP%]{font-size:13px;font-weight:600;color:#fff;margin:12px 0 8px}.filters-scroll[_ngcontent-%COMP%]   .filter-group[_ngcontent-%COMP%]{display:flex;gap:8px;overflow-x:auto;padding-bottom:4px;scrollbar-width:none}.filters-scroll[_ngcontent-%COMP%]   .filter-group[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.filters-scroll[_ngcontent-%COMP%]   .chip[_ngcontent-%COMP%]{background:#1a1a1a;color:#aaa;border:1px solid rgba(255,255,255,.1);padding:6px 14px;border-radius:20px;font-size:13px;white-space:nowrap;cursor:pointer;transition:all .2s}.filters-scroll[_ngcontent-%COMP%]   .chip.active[_ngcontent-%COMP%]{background:#ff6b35;color:#fff;border-color:#ff6b35}.results-grid[_ngcontent-%COMP%]{padding:0 16px;display:grid;grid-template-columns:1fr;grid-template-columns:repeat(2,1fr);gap:16px}.food-card[_ngcontent-%COMP%]{background:#1a1a1a;border-radius:16px;overflow:hidden;cursor:pointer;transition:transform .2s}.food-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.food-card[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]{position:relative;aspect-ratio:4/3;background:#222}.food-card[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.food-card[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]   .distance-badge[_ngcontent-%COMP%]{position:absolute;bottom:8px;right:8px;background:#0009;backdrop-filter:blur(4px);padding:4px 8px;border-radius:6px;font-size:11px;font-weight:600}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]{padding:12px}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:4px}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .dish-name[_ngcontent-%COMP%]{font-size:15px;font-weight:600;margin:0 8px 0 0;color:#fff;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]{display:flex;align-items:center;background:#2ecc71;color:#fff;padding:2px 4px;border-radius:4px;font-size:11px;font-weight:700}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]   .star[_ngcontent-%COMP%]{font-size:10px;margin-left:2px}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .vendor-name[_ngcontent-%COMP%]{font-size:13px;color:#888;margin-bottom:8px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .price-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .price-row[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#fff}.food-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .price-row[_ngcontent-%COMP%]   .offer[_ngcontent-%COMP%]{font-size:10px;color:#ff9f43;font-weight:700;text-transform:uppercase}.loading-spinner[_ngcontent-%COMP%]{grid-column:1/-1;display:flex;justify-content:center;padding:40px}.spinner[_ngcontent-%COMP%]{width:30px;height:30px;border:3px solid rgba(255,255,255,.1);border-top-color:#ff6b35;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.empty-state[_ngcontent-%COMP%]{grid-column:1/-1;text-align:center;padding:40px;color:#666;font-size:14px}"]})};function rre(n,e){n&1&&(N(0,"div",7),fe(1,"div",8),$())}function sre(n,e){if(n&1&&(N(0,"div",12)(1,"div",13),X(2),$(),N(3,"div",14)(4,"div",15),fe(5,"video",16),$(),N(6,"div",17)(7,"h3"),X(8),$(),N(9,"p",18),X(10),$(),N(11,"div",19)(12,"span"),X(13),$(),N(14,"span"),X(15),$()()()()()),n&2){let t=e.$implicit,i=e.index;K(2),pt("#",i+1,""),K(3),ce("src",t.videoUrl,xa),K(3),Ot(t.title),K(2),Ot(t.vendor),K(3),pt("\u{1F441}\uFE0F ",t.viewCount||0,""),K(2),pt("\u2764\uFE0F ",t.likes||0,"")}}function ore(n,e){n&1&&(N(0,"div",20)(1,"p"),X(2,"No trending reels yet!"),$()())}function are(n,e){if(n&1&&(N(0,"div",9),Be(1,sre,16,6,"div",10)(2,ore,3,0,"div",11),$()),n&2){let t=Ce();K(),ce("ngForOf",t.trendingReels),K(),ce("ngIf",!t.isLoading&&t.trendingReels.length===0)}}function lre(n,e){if(n&1&&(N(0,"div",12)(1,"div",21),X(2,"\u{1F195}"),$(),N(3,"div",14)(4,"div",15),fe(5,"video",16),$(),N(6,"div",17)(7,"h3"),X(8),$(),N(9,"p",18),X(10),$(),N(11,"div",19)(12,"span"),X(13),Gh(14,"date"),$()()()()()),n&2){let t=e.$implicit;K(5),ce("src",t.videoUrl,xa),K(3),Ot(t.title),K(2),Ot(t.vendor),K(3),pt("\u{1F4C5} ",zh(14,4,t.createdAt==null?null:t.createdAt.toDate(),"shortDate"),"")}}function cre(n,e){n&1&&(N(0,"div",20)(1,"p"),X(2,"No new arrivals yet!"),$()())}function ure(n,e){if(n&1&&(N(0,"div",9),Be(1,lre,15,7,"div",10)(2,cre,3,0,"div",11),$()),n&2){let t=Ce();K(),ce("ngForOf",t.newArrivalsReels),K(),ce("ngIf",!t.isLoading&&t.newArrivalsReels.length===0)}}var Q_=class n{constructor(e){this.reelsService=e}trendingReels=[];newArrivalsReels=[];activeTab="trending";isLoading=!0;touchStartX=0;touchEndX=0;ngOnInit(){return U(this,null,function*(){yield this.loadTrending()})}loadTrending(){return U(this,null,function*(){this.isLoading=!0;try{let e=yield this.reelsService.getReels(50);this.trendingReels=[...e].sort((t,i)=>(i.viewCount||0)-(t.viewCount||0)).slice(0,10),this.newArrivalsReels=[...e].sort((t,i)=>{let r=t.createdAt?.toDate?t.createdAt.toDate().getTime():0;return(i.createdAt?.toDate?i.createdAt.toDate().getTime():0)-r}).slice(0,10)}catch(e){console.error("Error loading trending:",e)}finally{this.isLoading=!1}})}switchTab(e){this.activeTab=e,window.scrollTo({top:0,behavior:"smooth"})}onTouchStart(e){this.touchStartX=e.changedTouches[0].screenX}onTouchEnd(e){this.touchEndX=e.changedTouches[0].screenX,this.handleSwipe()}handleSwipe(){this.touchStartX-this.touchEndX>50&&this.activeTab==="trending"&&this.switchTab("new"),this.touchEndX-this.touchStartX>50&&this.activeTab==="new"&&this.switchTab("trending")}static \u0275fac=function(t){return new(t||n)(Te(Fr))};static \u0275cmp=Dt({type:n,selectors:[["app-trending"]],standalone:!0,features:[Pt],decls:13,vars:9,consts:[[1,"trending-page"],[1,"tabs-header"],[1,"tab",3,"click"],[1,"slider"],[1,"content-container",3,"touchstart","touchend"],["class","loading-spinner",4,"ngIf"],["class","reels-list",4,"ngIf"],[1,"loading-spinner"],[1,"spinner"],[1,"reels-list"],["class","ranking-item",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[1,"ranking-item"],[1,"rank"],[1,"reel-card"],[1,"thumbnail"],["muted","","loop","","playsinline","",3,"src"],[1,"info"],[1,"vendor"],[1,"stats"],[1,"empty-state"],[1,"rank","new"]],template:function(t,i){t&1&&(N(0,"div",0)(1,"div",1)(2,"div",2),ve("click",function(){return i.switchTab("trending")}),N(3,"span"),X(4,"Trending \u{1F525}"),$()(),N(5,"div",2),ve("click",function(){return i.switchTab("new")}),N(6,"span"),X(7,"New Arrivals \u2728"),$()(),fe(8,"div",3),$(),N(9,"div",4),ve("touchstart",function(s){return i.onTouchStart(s)})("touchend",function(s){return i.onTouchEnd(s)}),Be(10,rre,2,0,"div",5)(11,are,3,2,"div",6)(12,ure,3,2,"div",6),$()()),t&2&&(K(2),ct("active",i.activeTab==="trending"),K(3),ct("active",i.activeTab==="new"),K(3),ct("right",i.activeTab==="new"),K(2),ce("ngIf",i.isLoading),K(),ce("ngIf",!i.isLoading&&i.activeTab==="trending"),K(),ce("ngIf",!i.isLoading&&i.activeTab==="new"))},dependencies:[Ut,di,nn,Kk],styles:[".trending-page[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;background:#000;color:#fff}.tabs-header[_ngcontent-%COMP%]{display:flex;position:relative;background:#000000e6;padding-top:max(12px,env(safe-area-inset-top));border-bottom:1px solid rgba(255,255,255,.1);z-index:10}.tabs-header[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]{flex:1;text-align:center;padding:16px 0;font-weight:600;font-size:15px;color:#888;cursor:pointer;transition:color .3s}.tabs-header[_ngcontent-%COMP%]   .tab.active[_ngcontent-%COMP%]{color:#ff6b35}.tabs-header[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;width:50%;height:2px;background:#ff6b35;transition:transform .3s ease}.tabs-header[_ngcontent-%COMP%]   .slider.right[_ngcontent-%COMP%]{transform:translate(100%)}.content-container[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding-bottom:80px;min-height:0}.reels-list[_ngcontent-%COMP%]{padding:16px;display:flex;flex-direction:column;gap:16px}.ranking-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;background:#111;border-radius:12px;padding:12px}.ranking-item[_ngcontent-%COMP%]   .rank[_ngcontent-%COMP%]{font-size:24px;font-weight:900;color:#ff6b35;min-width:40px;text-align:center;font-style:italic}.ranking-item[_ngcontent-%COMP%]   .rank.new[_ngcontent-%COMP%]{font-size:20px}.ranking-item[_ngcontent-%COMP%]   .reel-card[_ngcontent-%COMP%]{flex:1;display:flex;gap:12px}.ranking-item[_ngcontent-%COMP%]   .reel-card[_ngcontent-%COMP%]   .thumbnail[_ngcontent-%COMP%]{width:80px;height:120px;border-radius:8px;overflow:hidden;background:#222}.ranking-item[_ngcontent-%COMP%]   .reel-card[_ngcontent-%COMP%]   .thumbnail[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.ranking-item[_ngcontent-%COMP%]   .reel-card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:center}.ranking-item[_ngcontent-%COMP%]   .reel-card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 4px;font-size:16px;color:#fff}.ranking-item[_ngcontent-%COMP%]   .reel-card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .vendor[_ngcontent-%COMP%]{margin:0 0 8px;font-size:14px;color:#ccc}.ranking-item[_ngcontent-%COMP%]   .reel-card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]{display:flex;gap:12px;font-size:12px;color:#888}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:40px}.loading-spinner[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:30px;height:30px;border:3px solid rgba(255,255,255,.1);border-top-color:#ff6b35;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#888}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})};function dre(n,e){n&1&&(N(0,"div",24),fe(1,"app-favorites",25),$()),n&2&&(K(),ce("showHeader",!1))}var Yp=class n{constructor(e,t){this.auth=e;this.router=t;let i=this.auth.currentUser;if(i){if(this.userEmail=i.email,i.phoneNumber){let r=i.phoneNumber.replace(/\D/g,""),s=r.length===12&&r.startsWith("91")?r.substring(2):r;s.length===10?this.userPhoneNumber=`+91 ${s.substring(0,5)}-${s.substring(5)}`:this.userPhoneNumber=i.phoneNumber}else this.userPhoneNumber=null;i.displayName&&(this.fullName=i.displayName,this.userName=i.displayName.toLowerCase().replace(/\s+/g,"_"))}}favoritesComponent;userEmail=null;userPhoneNumber="+1 555-123-4567";userName="foodie_explorer";fullName="Bengaluru Foodie";stats={posts:12,followers:"1.2k",following:248};logout(){return U(this,null,function*(){try{yield this.auth.signOut(),this.router.navigate(["/"])}catch(e){console.error("Error signing out:",e)}})}reloadFavorites(){this.favoritesComponent&&this.favoritesComponent.loadBookmarkedReels()}static \u0275fac=function(t){return new(t||n)(Te(Kt),Te(xt))};static \u0275cmp=Dt({type:n,selectors:[["app-profile"]],viewQuery:function(t,i){if(t&1&&er(ul,5),t&2){let r;Oi(r=Ni())&&(i.favoritesComponent=r.first)}},standalone:!0,features:[Pt],decls:43,vars:2,consts:[[1,"profile-page","premium-theme"],[1,"scroll-content"],[1,"hero-section"],["src","assets/dosa-header.png","alt","Vibrant Dosa Illustration",1,"header-image"],[1,"header-overlay"],[1,"profile-card"],[1,"avatar-wrapper"],["src","assets/premium-avatar.png","alt","Avatar","onerror","this.src='https://ui-avatars.com/api/?name=User&background=333&color=fff'",1,"profile-avatar"],[1,"phone-number"],[1,"logout-btn",3,"click"],[1,"menu-list"],[1,"menu-item"],[1,"menu-icon"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["x","3","y","11","width","18","height","11","rx","2","ry","2"],["d","M7 11V7a5 5 0 0 1 10 0v4"],[1,"menu-text"],["d","M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"],["cx","12","cy","12","r","10"],["d","M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"],["x1","12","y1","17","x2","12.01","y2","17"],["x1","12","y1","16","x2","12","y2","12"],["x1","12","y1","8","x2","12.01","y2","8"],["class","hidden-content",4,"ngIf"],[1,"hidden-content"],[3,"showHeader"]],template:function(t,i){t&1&&(N(0,"div",0)(1,"div",1)(2,"div",2),fe(3,"img",3)(4,"div",4),$(),N(5,"div",5)(6,"div",6),fe(7,"img",7),$(),N(8,"h1",8),X(9),$(),N(10,"button",9),ve("click",function(){return i.logout()}),X(11," Logout "),$(),N(12,"div",10)(13,"div",11)(14,"div",12),Fe(),N(15,"svg",13),fe(16,"rect",14)(17,"path",15),$()(),Ge(),N(18,"span",16),X(19,"Terms and Conditions"),$()(),N(20,"div",11)(21,"div",12),Fe(),N(22,"svg",13),fe(23,"path",17),$()(),Ge(),N(24,"span",16),X(25,"Privacy Policy"),$()(),N(26,"div",11)(27,"div",12),Fe(),N(28,"svg",13),fe(29,"circle",18)(30,"path",19)(31,"line",20),$()(),Ge(),N(32,"span",16),X(33,"Help & Support"),$()(),N(34,"div",11)(35,"div",12),Fe(),N(36,"svg",13),fe(37,"circle",18)(38,"line",21)(39,"line",22),$()(),Ge(),N(40,"span",16),X(41,"About Us"),$()()()(),Be(42,dre,2,1,"div",23),$()()),t&2&&(K(9),Ot(i.userPhoneNumber||i.userEmail),K(33),ce("ngIf",!1))},dependencies:[Ut,nn,ul],styles:['.profile-page.premium-theme[_ngcontent-%COMP%]{height:100vh;background:#000;color:#fff;font-family:Inter,sans-serif}.profile-page.premium-theme[_ngcontent-%COMP%]   .scroll-content[_ngcontent-%COMP%]{height:100%;overflow-y:auto;padding-bottom:env(safe-area-inset-bottom)}.profile-page.premium-theme[_ngcontent-%COMP%]   .hero-section[_ngcontent-%COMP%]{position:relative;width:100%;height:420px;overflow:hidden}.profile-page.premium-theme[_ngcontent-%COMP%]   .hero-section[_ngcontent-%COMP%]   .header-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain;background:#000}.profile-page.premium-theme[_ngcontent-%COMP%]   .hero-section[_ngcontent-%COMP%]   .header-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:linear-gradient(to bottom,transparent 60%,#000 100%)}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]{position:relative;margin-top:-60px;padding:0 24px 40px;display:flex;flex-direction:column;align-items:center;z-index:2}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .avatar-wrapper[_ngcontent-%COMP%]{position:relative;width:140px;height:140px;margin-bottom:24px;display:flex;align-items:center;justify-content:center}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .avatar-wrapper[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:-6px;background:linear-gradient(45deg,#ff6b35,#ff8c42,#ff3b30,#ff6b35);background-size:300% 300%;border-radius:50%;padding:3px;animation:_ngcontent-%COMP%_rotateGradient 6s linear infinite;-webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;mask-composite:exclude}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .avatar-wrapper[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:0;border-radius:50%;box-shadow:0 0 30px #ff6b354d;pointer-events:none}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .avatar-wrapper[_ngcontent-%COMP%]   .profile-avatar[_ngcontent-%COMP%]{width:124px;height:124px;border-radius:50%;object-fit:cover;background:#222;border:4px solid #000;box-shadow:0 8px 32px #0009;transition:transform .3s cubic-bezier(.175,.885,.32,1.275);z-index:1}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .avatar-wrapper[_ngcontent-%COMP%]:hover   .profile-avatar[_ngcontent-%COMP%]{transform:scale(1.05)}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .phone-number[_ngcontent-%COMP%]{font-size:26px;font-weight:700;margin:0 0 32px;letter-spacing:-.5px;text-shadow:0 2px 10px rgba(0,0,0,.5)}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .logout-btn[_ngcontent-%COMP%]{width:160px;background:#ff6b35;color:#fff;border:none;padding:14px 0;border-radius:14px;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s ease;margin-bottom:48px;box-shadow:0 8px 20px #ff6b354d}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .logout-btn[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 12px 25px #ff6b3566;filter:brightness(1.1)}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .logout-btn[_ngcontent-%COMP%]:active{transform:scale(.95)}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .menu-list[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:4px}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .menu-list[_ngcontent-%COMP%]   .menu-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:18px 12px;border-radius:12px;border-bottom:1px solid rgba(255,255,255,.05);cursor:pointer;transition:all .2s ease}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .menu-list[_ngcontent-%COMP%]   .menu-item[_ngcontent-%COMP%]:hover{background:#ffffff08}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .menu-list[_ngcontent-%COMP%]   .menu-item[_ngcontent-%COMP%]:active{transform:scale(.98);background:#ffffff0d}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .menu-list[_ngcontent-%COMP%]   .menu-item[_ngcontent-%COMP%]   .menu-icon[_ngcontent-%COMP%]{color:#fff6;display:flex;align-items:center;justify-content:center}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .menu-list[_ngcontent-%COMP%]   .menu-item[_ngcontent-%COMP%]   .menu-text[_ngcontent-%COMP%]{font-size:16px;font-weight:500;color:#efefef}.profile-page.premium-theme[_ngcontent-%COMP%]   .profile-card[_ngcontent-%COMP%]   .menu-list[_ngcontent-%COMP%]   .menu-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.hidden-content[_ngcontent-%COMP%]{display:none}@keyframes _ngcontent-%COMP%_rotateGradient{0%{background-position:0% 50%}50%{background-position:100% 50%}to{background-position:0% 50%}}']})};function hre(n,e){if(n&1){let t=Tt();N(0,"button",10),ve("click",function(){xe(t);let r=Ce();return Ae(r.onCancel())}),X(1),$()}if(n&2){let t=Ce();K(),pt(" ",t.secondText," ")}}var Z_=class n{message="By going outside all your changes will be lost.";confirmText="Discard Changes";secondText="Stay Here";showCancel=!0;confirm=new lt;cancel=new lt;onConfirm(){this.confirm.emit()}onCancel(){this.cancel.emit()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=Dt({type:n,selectors:[["app-confirmation-modal"]],inputs:{message:"message",confirmText:"confirmText",secondText:"secondText",showCancel:"showCancel"},outputs:{confirm:"confirm",cancel:"cancel"},standalone:!0,features:[Pt],decls:15,vars:4,consts:[[1,"modal-overlay",3,"click"],[1,"modal-container",3,"click"],[1,"modal-icon"],["width","40","height","40","viewBox","0 0 24 24","fill","none"],["d","M12 9V14M12 17.01L12.01 16.998","stroke","#ff6b35","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z","stroke","#ff6b35","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"modal-content"],[1,"modal-actions"],[1,"confirm-btn",3,"click"],["class","cancel-btn",3,"click",4,"ngIf"],[1,"cancel-btn",3,"click"]],template:function(t,i){t&1&&(N(0,"div",0),ve("click",function(){return i.onCancel()}),N(1,"div",1),ve("click",function(s){return s.stopPropagation()}),N(2,"div",2),Fe(),N(3,"svg",3),fe(4,"path",4)(5,"path",5),$()(),Ge(),N(6,"div",6)(7,"h3"),X(8,"Unsaved Changes"),$(),N(9,"p"),X(10),$()(),N(11,"div",7)(12,"button",8),ve("click",function(){return i.onConfirm()}),X(13),$(),Be(14,hre,2,1,"button",9),$()()()),t&2&&(ce("@fadeInOut",void 0),K(10),Ot(i.message),K(3),pt(" ",i.confirmText," "),K(),ce("ngIf",i.showCancel))},dependencies:[Ut,nn],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000000d9;backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;z-index:9999;padding:20px;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.modal-container[_ngcontent-%COMP%]{background:#1e1e1ecc;backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,.1);border-radius:28px;padding:32px;width:100%;max-width:380px;text-align:center;box-shadow:0 25px 50px -12px #00000080;animation:_ngcontent-%COMP%_slideUp .3s cubic-bezier(.34,1.56,.64,1)}.modal-icon[_ngcontent-%COMP%]{width:64px;height:64px;background:#ff6b351a;border-radius:20px;display:flex;align-items:center;justify-content:center;margin:0 auto 20px}.modal-content[_ngcontent-%COMP%]{margin-bottom:28px}.modal-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;font-size:20px;font-weight:700;margin:0 0 10px}.modal-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#aaa;font-size:15px;line-height:1.6;margin:0}.modal-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.modal-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:16px;border-radius:16px;font-size:16px;font-weight:600;cursor:pointer;transition:all .2s ease;border:none}.modal-actions[_ngcontent-%COMP%]   .confirm-btn[_ngcontent-%COMP%]{background:#ff3b30;color:#fff;box-shadow:0 4px 12px #ff3b304d}.modal-actions[_ngcontent-%COMP%]   .confirm-btn[_ngcontent-%COMP%]:hover{background:#ff453a;transform:translateY(-2px);box-shadow:0 6px 16px #ff3b3066}.modal-actions[_ngcontent-%COMP%]   .confirm-btn[_ngcontent-%COMP%]:active{transform:scale(.98)}.modal-actions[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]{background:#ffffff0d;color:#ddd;border:1px solid rgba(255,255,255,.1)}.modal-actions[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#fff}.modal-actions[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]:active{transform:scale(.98)}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}"]})};function fre(n,e){if(n&1){let t=Tt();N(0,"app-confirmation-modal",20),ve("confirm",function(){xe(t);let r=Ce();return Ae(r.onConfirmLeave())})("cancel",function(){xe(t);let r=Ce();return Ae(r.onCancelLeave())}),$()}}var X_=class n{constructor(e,t,i,r){this.router=e;this.locationService=t;this.navigationService=i;this.auth=r;let s=this.router.getCurrentNavigation();if(s?.extras?.state){let o=s.extras.state;if(o.location&&(this.location=`${o.location}, Bangalore`),o.latitude&&o.longitude&&this.locationService.setUserLocation(o.latitude,o.longitude),o.openFeed&&o.reelId){this.activeTab="feed";let a=o.reelId,l=(u=0)=>{setTimeout(()=>{this.videoFeedComponent&&this.videoFeedComponent.reels&&this.videoFeedComponent.reels.length>0?(console.log("[MainApp] Video feed loaded, navigating to reel:",a),this.videoFeedComponent.navigateToReel(a)):u<10?(console.log("[MainApp] Waiting for video feed to load... attempt",u+1),l(u+1)):console.error("[MainApp] Failed to navigate to reel - video feed did not load")},500)};l()}}}location="Koramangala, Bangalore";navigate=new lt;activeTab="feed";showProfileMenu=!1;showConfirmModal=!1;pendingTab=null;favoritesComponent;profileComponent;videoFeedComponent;uploadReelComponent;ngOnInit(){return U(this,null,function*(){if(this.location==="Koramangala, Bangalore")try{let e=yield this.locationService.getUserLocation(),t=this.locationService.findNearestArea(e.latitude,e.longitude);this.location=`${t}, Bangalore`}catch(e){console.error("Error getting location:",e)}this.locationService.currentLocation$.subscribe(e=>{e&&(this.location=`${e.name}, Bangalore`,this.videoFeedComponent&&this.activeTab==="feed"&&this.videoFeedComponent.reloadReelsForNewLocation())}),this.navigationService.selectedReelId$.subscribe(e=>{if(e){console.log("[MainApp] Received reel selection:",e),this.activeTab="feed";let t=(i=0)=>{setTimeout(()=>{this.videoFeedComponent&&this.videoFeedComponent.reels&&this.videoFeedComponent.reels.length>0?(console.log("[MainApp] Navigating to reel:",e),this.videoFeedComponent.navigateToReel(e),this.navigationService.clearSelection()):i<15?(console.log("[MainApp] Waiting for reels... attempt",i+1),t(i+1)):console.error("[MainApp] Failed to navigate - reels not loaded")},400)};t()}})})}select(e){if(this.activeTab===e){e==="feed"&&this.videoFeedComponent&&this.videoFeedComponent.scrollToTopAndRefresh();return}if(this.activeTab==="upload"&&e!=="upload"&&this.uploadReelComponent?.hasChanges()){this.pendingTab=e,this.showConfirmModal=!0;return}this.executeTabChange(e)}executeTabChange(e){this.activeTab=e,this.navigate.emit(e),e==="profile"&&this.profileComponent&&this.profileComponent.reloadFavorites(),e==="favorites"&&this.favoritesComponent&&this.favoritesComponent.loadBookmarkedReels()}onConfirmLeave(){this.showConfirmModal=!1,this.pendingTab&&(this.uploadReelComponent.resetForm(),this.executeTabChange(this.pendingTab),this.pendingTab=null)}onCancelLeave(){this.showConfirmModal=!1,this.pendingTab=null}goToUpload(){this.select("upload")}logout(){return U(this,null,function*(){try{yield this.auth.signOut(),this.router.navigate(["/"])}catch(e){console.error("Error signing out:",e)}})}toggleProfileMenu(){this.showProfileMenu=!this.showProfileMenu}static \u0275fac=function(t){return new(t||n)(Te(xt),Te(Or),Te(Qd),Te(Kt))};static \u0275cmp=Dt({type:n,selectors:[["app-main-app"]],viewQuery:function(t,i){if(t&1&&(er(ul,5),er(Yp,5),er(Uc,5),er($c,5)),t&2){let r;Oi(r=Ni())&&(i.favoritesComponent=r.first),Oi(r=Ni())&&(i.profileComponent=r.first),Oi(r=Ni())&&(i.videoFeedComponent=r.first),Oi(r=Ni())&&(i.uploadReelComponent=r.first)}},outputs:{navigate:"navigate"},standalone:!0,features:[Pt],decls:32,vars:24,consts:[[1,"main-app"],[1,"top-nav"],[1,"nav-left"],[1,"nav-right"],[3,"isActive"],[3,"uploadComplete","canceled"],[1,"bottom-nav"],[1,"bottom-nav-btn",3,"click"],["width","24","height","24","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",1,"nav-icon"],["x","2","y","2","width","20","height","20","rx","5","ry","5","stroke","currentColor","stroke-width","2"],["d","M10 8L16 12L10 16V8Z","fill","currentColor","stroke","none"],["cx","11","cy","11","r","8","stroke","currentColor","stroke-width","2"],["d","M21 21L16.65 16.65","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"bottom-nav-btn","upload-btn",3,"click"],["d","M12 7v10M7 12h10","stroke","currentColor","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round"],["d","M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"profile-container-bottom"],["d","M20 21C20 18.2386 17.7614 16 15 16H9C6.23858 16 4 18.2386 4 21","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","7","r","4","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["message","By going outside all your changes will be lost.","confirmText","Discard Changes","secondText","Stay Here",3,"confirm","cancel",4,"ngIf"],["message","By going outside all your changes will be lost.","confirmText","Discard Changes","secondText","Stay Here",3,"confirm","cancel"]],template:function(t,i){t&1&&(N(0,"div",0)(1,"div",1),fe(2,"div",2)(3,"div",3),$(),fe(4,"app-video-feed",4)(5,"app-search")(6,"app-trending")(7,"app-profile")(8,"app-favorites"),N(9,"app-upload-reel",5),ve("uploadComplete",function(){return i.select("feed")})("canceled",function(){return i.select("feed")}),$(),N(10,"div",6)(11,"button",7),ve("click",function(){return i.select("feed")}),Fe(),N(12,"svg",8),fe(13,"rect",9)(14,"path",10),$()(),Ge(),N(15,"button",7),ve("click",function(){return i.select("search")}),Fe(),N(16,"svg",8),fe(17,"circle",11)(18,"path",12),$()(),Ge(),N(19,"button",13),ve("click",function(){return i.goToUpload()}),Fe(),N(20,"svg",8),fe(21,"rect",9)(22,"path",14),$()(),Ge(),N(23,"button",7),ve("click",function(){return i.select("favorites")}),Fe(),N(24,"svg",8),fe(25,"path",15),$()(),Ge(),N(26,"div",16)(27,"button",7),ve("click",function(){return i.select("profile")}),Fe(),N(28,"svg",8),fe(29,"path",17)(30,"circle",18),$()()()(),Be(31,fre,1,0,"app-confirmation-modal",19),$()),t&2&&(K(4),ct("hidden",i.activeTab!=="feed"),ce("isActive",i.activeTab==="feed"),K(),ct("hidden",i.activeTab!=="search"),K(),ct("hidden",i.activeTab!=="trending"),K(),ct("hidden",i.activeTab!=="profile"),K(),ct("hidden",i.activeTab!=="favorites"),K(),ct("hidden",i.activeTab!=="upload"),K(2),ct("active",i.activeTab==="feed"),K(4),ct("active",i.activeTab==="search"),K(4),ct("active",i.activeTab==="upload"),K(4),ct("active",i.activeTab==="favorites"),K(4),ct("active",i.activeTab==="profile"),K(4),ce("ngIf",i.showConfirmModal))},dependencies:[Ut,nn,Uc,ul,$c,Y_,Q_,Yp,Z_,Bi],styles:['.main-app[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;flex-direction:column;background:#000;font-family:Poppins,sans-serif}.hidden[_ngcontent-%COMP%]{display:none!important}.top-nav[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;z-index:10;display:flex;justify-content:space-between;padding:1rem;padding-top:max(1rem,env(safe-area-inset-top));background:linear-gradient(to bottom,rgba(0,0,0,.8) 0%,transparent 100%)}.profile-container-bottom[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center}.bottom-nav[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;display:flex;justify-content:space-around;padding:.75rem 0;padding-bottom:0;background:#0003;backdrop-filter:blur(1px);-webkit-backdrop-filter:blur(1px);border-top:1px solid rgba(255,255,255,.1);z-index:20}.bottom-nav-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#888;font-size:.7rem;display:flex;flex-direction:column;align-items:center;gap:.25rem;cursor:pointer;transition:color .2s;padding:.5rem 1rem;font-weight:400}.bottom-nav-btn.active[_ngcontent-%COMP%]{color:#ff6b35}.bottom-nav-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-top:2px}.nav-icon[_ngcontent-%COMP%]{width:24px;height:24px;color:inherit;transition:all .2s}.bottom-nav-btn.active[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]:has(path[d*="M3 9.5"])   path[_ngcontent-%COMP%]{fill:currentColor;stroke:currentColor}.bottom-nav-btn.active[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]:has(path[d*="19 21l-7-5"])   path[_ngcontent-%COMP%]{stroke:currentColor}.bottom-nav-btn.active[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]:has(polyline[points*="23 6"])   polyline[_ngcontent-%COMP%]{fill:none;stroke-width:3px}.bottom-nav-btn.active[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]:has(path[d*="M20 21C20"])   path[_ngcontent-%COMP%], .bottom-nav-btn.active[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]:has(path[d*="M20 21C20"])   circle[_ngcontent-%COMP%]{stroke:currentColor}@media (min-width: 768px){.location-modal[_ngcontent-%COMP%]{max-width:500px;margin:0 auto;border-radius:24px;max-height:70vh}.modal-overlay[_ngcontent-%COMP%]{align-items:center}}']})};var Qp=()=>{let n=le(Kt),e=le(xt);return Uy(n).pipe(qe(t=>t?!0:(e.navigate(["/phone-input"]),!1)))};var u1=()=>{let n=le(Kt),e=le(xt);return Uy(n).pipe(qe(t=>t?(console.log("[NoAuthGuard] User is authenticated, redirecting to main-app"),e.createUrlTree(["/main-app"])):!0))};var D$=[{path:"",component:jv},{path:"phone-input",component:Yv,canActivate:[Rc,u1]},{path:"otp",component:Qv,canActivate:[Rc,u1]},{path:"location-permission",component:Zv,canActivate:[Qp,Rc]},{path:"main-app",component:X_,canActivate:[Qp,Rc]},{path:"video-feed",component:Uc,canActivate:[Qp,Rc]},{path:"upload-reel",component:$c,canActivate:[Qp,Rc]}];var P$={providers:[sO(D$),aL(),UO(),mN(()=>gN(Tp.firebase)),hF(()=>fF()),_V(()=>IV()),Pc]};var J_=class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=Dt({type:n,selectors:[["app-root"]],standalone:!0,features:[Pt],decls:1,vars:0,template:function(t,i){t&1&&fe(0,"router-outlet")},dependencies:[UI]})};pL(J_,P$).catch(n=>console.error(n));
